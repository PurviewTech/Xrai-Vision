function Wse(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function zse(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yN={exports:{}},mE={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o4;function qse(){if(o4)return mE;o4=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:s}}return mE.Fragment=e,mE.jsx=n,mE.jsxs=n,mE}var a4;function Yse(){return a4||(a4=1,yN.exports=qse()),yN.exports}var D=Yse(),vN={exports:{}},Yt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c4;function Xse(){if(c4)return Yt;c4=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function p(j){return j===null||typeof j!="object"?null:(j=f&&j[f]||j["@@iterator"],typeof j=="function"?j:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,E={};function w(j,C,L){this.props=j,this.context=C,this.refs=E,this.updater=L||g}w.prototype.isReactComponent={},w.prototype.setState=function(j,C){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,C,"setState")},w.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function b(){}b.prototype=w.prototype;function I(j,C,L){this.props=j,this.context=C,this.refs=E,this.updater=L||g}var B=I.prototype=new b;B.constructor=I,y(B,w.prototype),B.isPureReactComponent=!0;var U=Array.isArray,H={H:null,A:null,T:null,S:null,V:null},K=Object.prototype.hasOwnProperty;function x(j,C,L,k,ee,_e){return L=_e.ref,{$$typeof:t,type:j,key:C,ref:L!==void 0?L:null,props:_e}}function V(j,C){return x(j.type,C,void 0,void 0,void 0,j.props)}function M(j){return typeof j=="object"&&j!==null&&j.$$typeof===t}function O(j){var C={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(L){return C[L]})}var z=/\/+/g;function $(j,C){return typeof j=="object"&&j!==null&&j.key!=null?O(""+j.key):C.toString(36)}function q(){}function Ue(j){switch(j.status){case"fulfilled":return j.value;case"rejected":throw j.reason;default:switch(typeof j.status=="string"?j.then(q,q):(j.status="pending",j.then(function(C){j.status==="pending"&&(j.status="fulfilled",j.value=C)},function(C){j.status==="pending"&&(j.status="rejected",j.reason=C)})),j.status){case"fulfilled":return j.value;case"rejected":throw j.reason}}throw j}function fe(j,C,L,k,ee){var _e=typeof j;(_e==="undefined"||_e==="boolean")&&(j=null);var ke=!1;if(j===null)ke=!0;else switch(_e){case"bigint":case"string":case"number":ke=!0;break;case"object":switch(j.$$typeof){case t:case e:ke=!0;break;case d:return ke=j._init,fe(ke(j._payload),C,L,k,ee)}}if(ke)return ee=ee(j),ke=k===""?"."+$(j,0):k,U(ee)?(L="",ke!=null&&(L=ke.replace(z,"$&/")+"/"),fe(ee,C,L,"",function(Gr){return Gr})):ee!=null&&(M(ee)&&(ee=V(ee,L+(ee.key==null||j&&j.key===ee.key?"":(""+ee.key).replace(z,"$&/")+"/")+ke)),C.push(ee)),1;ke=0;var ft=k===""?".":k+":";if(U(j))for(var Rt=0;Rt<j.length;Rt++)k=j[Rt],_e=ft+$(k,Rt),ke+=fe(k,C,L,_e,ee);else if(Rt=p(j),typeof Rt=="function")for(j=Rt.call(j),Rt=0;!(k=j.next()).done;)k=k.value,_e=ft+$(k,Rt++),ke+=fe(k,C,L,_e,ee);else if(_e==="object"){if(typeof j.then=="function")return fe(Ue(j),C,L,k,ee);throw C=String(j),Error("Objects are not valid as a React child (found: "+(C==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":C)+"). If you meant to render a collection of children, use an array instead.")}return ke}function re(j,C,L){if(j==null)return j;var k=[],ee=0;return fe(j,k,"","",function(_e){return C.call(L,_e,ee++)}),k}function Y(j){if(j._status===-1){var C=j._result;C=C(),C.then(function(L){(j._status===0||j._status===-1)&&(j._status=1,j._result=L)},function(L){(j._status===0||j._status===-1)&&(j._status=2,j._result=L)}),j._status===-1&&(j._status=0,j._result=C)}if(j._status===1)return j._result.default;throw j._result}var Z=typeof reportError=="function"?reportError:function(j){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var C=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof j=="object"&&j!==null&&typeof j.message=="string"?String(j.message):String(j),error:j});if(!window.dispatchEvent(C))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",j);return}console.error(j)};function ae(){}return Yt.Children={map:re,forEach:function(j,C,L){re(j,function(){C.apply(this,arguments)},L)},count:function(j){var C=0;return re(j,function(){C++}),C},toArray:function(j){return re(j,function(C){return C})||[]},only:function(j){if(!M(j))throw Error("React.Children.only expected to receive a single React element child.");return j}},Yt.Component=w,Yt.Fragment=n,Yt.Profiler=i,Yt.PureComponent=I,Yt.StrictMode=r,Yt.Suspense=A,Yt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,Yt.__COMPILER_RUNTIME={__proto__:null,c:function(j){return H.H.useMemoCache(j)}},Yt.cache=function(j){return function(){return j.apply(null,arguments)}},Yt.cloneElement=function(j,C,L){if(j==null)throw Error("The argument must be a React element, but you passed "+j+".");var k=y({},j.props),ee=j.key,_e=void 0;if(C!=null)for(ke in C.ref!==void 0&&(_e=void 0),C.key!==void 0&&(ee=""+C.key),C)!K.call(C,ke)||ke==="key"||ke==="__self"||ke==="__source"||ke==="ref"&&C.ref===void 0||(k[ke]=C[ke]);var ke=arguments.length-2;if(ke===1)k.children=L;else if(1<ke){for(var ft=Array(ke),Rt=0;Rt<ke;Rt++)ft[Rt]=arguments[Rt+2];k.children=ft}return x(j.type,ee,void 0,void 0,_e,k)},Yt.createContext=function(j){return j={$$typeof:o,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null},j.Provider=j,j.Consumer={$$typeof:s,_context:j},j},Yt.createElement=function(j,C,L){var k,ee={},_e=null;if(C!=null)for(k in C.key!==void 0&&(_e=""+C.key),C)K.call(C,k)&&k!=="key"&&k!=="__self"&&k!=="__source"&&(ee[k]=C[k]);var ke=arguments.length-2;if(ke===1)ee.children=L;else if(1<ke){for(var ft=Array(ke),Rt=0;Rt<ke;Rt++)ft[Rt]=arguments[Rt+2];ee.children=ft}if(j&&j.defaultProps)for(k in ke=j.defaultProps,ke)ee[k]===void 0&&(ee[k]=ke[k]);return x(j,_e,void 0,void 0,null,ee)},Yt.createRef=function(){return{current:null}},Yt.forwardRef=function(j){return{$$typeof:a,render:j}},Yt.isValidElement=M,Yt.lazy=function(j){return{$$typeof:d,_payload:{_status:-1,_result:j},_init:Y}},Yt.memo=function(j,C){return{$$typeof:l,type:j,compare:C===void 0?null:C}},Yt.startTransition=function(j){var C=H.T,L={};H.T=L;try{var k=j(),ee=H.S;ee!==null&&ee(L,k),typeof k=="object"&&k!==null&&typeof k.then=="function"&&k.then(ae,Z)}catch(_e){Z(_e)}finally{H.T=C}},Yt.unstable_useCacheRefresh=function(){return H.H.useCacheRefresh()},Yt.use=function(j){return H.H.use(j)},Yt.useActionState=function(j,C,L){return H.H.useActionState(j,C,L)},Yt.useCallback=function(j,C){return H.H.useCallback(j,C)},Yt.useContext=function(j){return H.H.useContext(j)},Yt.useDebugValue=function(){},Yt.useDeferredValue=function(j,C){return H.H.useDeferredValue(j,C)},Yt.useEffect=function(j,C,L){var k=H.H;if(typeof L=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return k.useEffect(j,C)},Yt.useId=function(){return H.H.useId()},Yt.useImperativeHandle=function(j,C,L){return H.H.useImperativeHandle(j,C,L)},Yt.useInsertionEffect=function(j,C){return H.H.useInsertionEffect(j,C)},Yt.useLayoutEffect=function(j,C){return H.H.useLayoutEffect(j,C)},Yt.useMemo=function(j,C){return H.H.useMemo(j,C)},Yt.useOptimistic=function(j,C){return H.H.useOptimistic(j,C)},Yt.useReducer=function(j,C,L){return H.H.useReducer(j,C,L)},Yt.useRef=function(j){return H.H.useRef(j)},Yt.useState=function(j){return H.H.useState(j)},Yt.useSyncExternalStore=function(j,C,L){return H.H.useSyncExternalStore(j,C,L)},Yt.useTransition=function(){return H.H.useTransition()},Yt.version="19.1.0",Yt}var A4;function RU(){return A4||(A4=1,vN.exports=Xse()),vN.exports}var J=RU();const qA=zse(J),l4=Wse({__proto__:null,default:qA},[J]);var wN={exports:{}},gE={},CN={exports:{}},TN={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u4;function Jse(){return u4||(u4=1,function(t){function e(re,Y){var Z=re.length;re.push(Y);e:for(;0<Z;){var ae=Z-1>>>1,j=re[ae];if(0<i(j,Y))re[ae]=Y,re[Z]=j,Z=ae;else break e}}function n(re){return re.length===0?null:re[0]}function r(re){if(re.length===0)return null;var Y=re[0],Z=re.pop();if(Z!==Y){re[0]=Z;e:for(var ae=0,j=re.length,C=j>>>1;ae<C;){var L=2*(ae+1)-1,k=re[L],ee=L+1,_e=re[ee];if(0>i(k,Z))ee<j&&0>i(_e,k)?(re[ae]=_e,re[ee]=Z,ae=ee):(re[ae]=k,re[L]=Z,ae=L);else if(ee<j&&0>i(_e,Z))re[ae]=_e,re[ee]=Z,ae=ee;else break e}}return Y}function i(re,Y){var Z=re.sortIndex-Y.sortIndex;return Z!==0?Z:re.id-Y.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var A=[],l=[],d=1,f=null,p=3,g=!1,y=!1,E=!1,w=!1,b=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function U(re){for(var Y=n(l);Y!==null;){if(Y.callback===null)r(l);else if(Y.startTime<=re)r(l),Y.sortIndex=Y.expirationTime,e(A,Y);else break;Y=n(l)}}function H(re){if(E=!1,U(re),!y)if(n(A)!==null)y=!0,K||(K=!0,$());else{var Y=n(l);Y!==null&&fe(H,Y.startTime-re)}}var K=!1,x=-1,V=5,M=-1;function O(){return w?!0:!(t.unstable_now()-M<V)}function z(){if(w=!1,K){var re=t.unstable_now();M=re;var Y=!0;try{e:{y=!1,E&&(E=!1,I(x),x=-1),g=!0;var Z=p;try{t:{for(U(re),f=n(A);f!==null&&!(f.expirationTime>re&&O());){var ae=f.callback;if(typeof ae=="function"){f.callback=null,p=f.priorityLevel;var j=ae(f.expirationTime<=re);if(re=t.unstable_now(),typeof j=="function"){f.callback=j,U(re),Y=!0;break t}f===n(A)&&r(A),U(re)}else r(A);f=n(A)}if(f!==null)Y=!0;else{var C=n(l);C!==null&&fe(H,C.startTime-re),Y=!1}}break e}finally{f=null,p=Z,g=!1}Y=void 0}}finally{Y?$():K=!1}}}var $;if(typeof B=="function")$=function(){B(z)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,Ue=q.port2;q.port1.onmessage=z,$=function(){Ue.postMessage(null)}}else $=function(){b(z,0)};function fe(re,Y){x=b(function(){re(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(re){re.callback=null},t.unstable_forceFrameRate=function(re){0>re||125<re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):V=0<re?Math.floor(1e3/re):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_next=function(re){switch(p){case 1:case 2:case 3:var Y=3;break;default:Y=p}var Z=p;p=Y;try{return re()}finally{p=Z}},t.unstable_requestPaint=function(){w=!0},t.unstable_runWithPriority=function(re,Y){switch(re){case 1:case 2:case 3:case 4:case 5:break;default:re=3}var Z=p;p=re;try{return Y()}finally{p=Z}},t.unstable_scheduleCallback=function(re,Y,Z){var ae=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?ae+Z:ae):Z=ae,re){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=Z+j,re={id:d++,callback:Y,priorityLevel:re,startTime:Z,expirationTime:j,sortIndex:-1},Z>ae?(re.sortIndex=Z,e(l,re),n(A)===null&&re===n(l)&&(E?(I(x),x=-1):E=!0,fe(H,Z-ae))):(re.sortIndex=j,e(A,re),y||g||(y=!0,K||(K=!0,$()))),re},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(re){var Y=p;return function(){var Z=p;p=Y;try{return re.apply(this,arguments)}finally{p=Z}}}}(TN)),TN}var d4;function $se(){return d4||(d4=1,CN.exports=Jse()),CN.exports}var SN={exports:{}},Zs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h4;function Zse(){if(h4)return Zs;h4=1;var t=RU();function e(A){var l="https://react.dev/errors/"+A;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)l+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+A+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(A,l,d){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:f==null?null:""+f,children:A,containerInfo:l,implementation:d}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(A,l){if(A==="font")return"";if(typeof l=="string")return l==="use-credentials"?l:""}return Zs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Zs.createPortal=function(A,l){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)throw Error(e(299));return s(A,l,null,d)},Zs.flushSync=function(A){var l=o.T,d=r.p;try{if(o.T=null,r.p=2,A)return A()}finally{o.T=l,r.p=d,r.d.f()}},Zs.preconnect=function(A,l){typeof A=="string"&&(l?(l=l.crossOrigin,l=typeof l=="string"?l==="use-credentials"?l:"":void 0):l=null,r.d.C(A,l))},Zs.prefetchDNS=function(A){typeof A=="string"&&r.d.D(A)},Zs.preinit=function(A,l){if(typeof A=="string"&&l&&typeof l.as=="string"){var d=l.as,f=a(d,l.crossOrigin),p=typeof l.integrity=="string"?l.integrity:void 0,g=typeof l.fetchPriority=="string"?l.fetchPriority:void 0;d==="style"?r.d.S(A,typeof l.precedence=="string"?l.precedence:void 0,{crossOrigin:f,integrity:p,fetchPriority:g}):d==="script"&&r.d.X(A,{crossOrigin:f,integrity:p,fetchPriority:g,nonce:typeof l.nonce=="string"?l.nonce:void 0})}},Zs.preinitModule=function(A,l){if(typeof A=="string")if(typeof l=="object"&&l!==null){if(l.as==null||l.as==="script"){var d=a(l.as,l.crossOrigin);r.d.M(A,{crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0})}}else l==null&&r.d.M(A)},Zs.preload=function(A,l){if(typeof A=="string"&&typeof l=="object"&&l!==null&&typeof l.as=="string"){var d=l.as,f=a(d,l.crossOrigin);r.d.L(A,d,{crossOrigin:f,integrity:typeof l.integrity=="string"?l.integrity:void 0,nonce:typeof l.nonce=="string"?l.nonce:void 0,type:typeof l.type=="string"?l.type:void 0,fetchPriority:typeof l.fetchPriority=="string"?l.fetchPriority:void 0,referrerPolicy:typeof l.referrerPolicy=="string"?l.referrerPolicy:void 0,imageSrcSet:typeof l.imageSrcSet=="string"?l.imageSrcSet:void 0,imageSizes:typeof l.imageSizes=="string"?l.imageSizes:void 0,media:typeof l.media=="string"?l.media:void 0})}},Zs.preloadModule=function(A,l){if(typeof A=="string")if(l){var d=a(l.as,l.crossOrigin);r.d.m(A,{as:typeof l.as=="string"&&l.as!=="script"?l.as:void 0,crossOrigin:d,integrity:typeof l.integrity=="string"?l.integrity:void 0})}else r.d.m(A)},Zs.requestFormReset=function(A){r.d.r(A)},Zs.unstable_batchedUpdates=function(A,l){return A(l)},Zs.useFormState=function(A,l,d){return o.H.useFormState(A,l,d)},Zs.useFormStatus=function(){return o.H.useHostTransitionStatus()},Zs.version="19.1.0",Zs}var f4;function eoe(){if(f4)return SN.exports;f4=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),SN.exports=Zse(),SN.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p4;function toe(){if(p4)return gE;p4=1;var t=$se(),e=RU(),n=eoe();function r(c){var u="https://react.dev/errors/"+c;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)u+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+c+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function s(c){var u=c,h=c;if(c.alternate)for(;u.return;)u=u.return;else{c=u;do u=c,(u.flags&4098)!==0&&(h=u.return),c=u.return;while(c)}return u.tag===3?h:null}function o(c){if(c.tag===13){var u=c.memoizedState;if(u===null&&(c=c.alternate,c!==null&&(u=c.memoizedState)),u!==null)return u.dehydrated}return null}function a(c){if(s(c)!==c)throw Error(r(188))}function A(c){var u=c.alternate;if(!u){if(u=s(c),u===null)throw Error(r(188));return u!==c?null:c}for(var h=c,m=u;;){var v=h.return;if(v===null)break;var T=v.alternate;if(T===null){if(m=v.return,m!==null){h=m;continue}break}if(v.child===T.child){for(T=v.child;T;){if(T===h)return a(v),c;if(T===m)return a(v),u;T=T.sibling}throw Error(r(188))}if(h.return!==m.return)h=v,m=T;else{for(var Q=!1,W=v.child;W;){if(W===h){Q=!0,h=v,m=T;break}if(W===m){Q=!0,m=v,h=T;break}W=W.sibling}if(!Q){for(W=T.child;W;){if(W===h){Q=!0,h=T,m=v;break}if(W===m){Q=!0,m=T,h=v;break}W=W.sibling}if(!Q)throw Error(r(189))}}if(h.alternate!==m)throw Error(r(190))}if(h.tag!==3)throw Error(r(188));return h.stateNode.current===h?c:u}function l(c){var u=c.tag;if(u===5||u===26||u===27||u===6)return c;for(c=c.child;c!==null;){if(u=l(c),u!==null)return u;c=c.sibling}return null}var d=Object.assign,f=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),I=Symbol.for("react.consumer"),B=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),K=Symbol.for("react.suspense_list"),x=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),M=Symbol.for("react.activity"),O=Symbol.for("react.memo_cache_sentinel"),z=Symbol.iterator;function $(c){return c===null||typeof c!="object"?null:(c=z&&c[z]||c["@@iterator"],typeof c=="function"?c:null)}var q=Symbol.for("react.client.reference");function Ue(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===q?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case y:return"Fragment";case w:return"Profiler";case E:return"StrictMode";case H:return"Suspense";case K:return"SuspenseList";case M:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case g:return"Portal";case B:return(c.displayName||"Context")+".Provider";case I:return(c._context.displayName||"Context")+".Consumer";case U:var u=c.render;return c=c.displayName,c||(c=u.displayName||u.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case x:return u=c.displayName||null,u!==null?u:Ue(c.type)||"Memo";case V:u=c._payload,c=c._init;try{return Ue(c(u))}catch{}}return null}var fe=Array.isArray,re=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},ae=[],j=-1;function C(c){return{current:c}}function L(c){0>j||(c.current=ae[j],ae[j]=null,j--)}function k(c,u){j++,ae[j]=c.current,c.current=u}var ee=C(null),_e=C(null),ke=C(null),ft=C(null);function Rt(c,u){switch(k(ke,u),k(_e,c),k(ee,null),u.nodeType){case 9:case 11:c=(c=u.documentElement)&&(c=c.namespaceURI)?PV(c):0;break;default:if(c=u.tagName,u=u.namespaceURI)u=PV(u),c=UV(u,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}L(ee),k(ee,c)}function Gr(){L(ee),L(_e),L(ke)}function Xi(c){c.memoizedState!==null&&k(ft,c);var u=ee.current,h=UV(u,c.type);u!==h&&(k(_e,c),k(ee,h))}function Ls(c){_e.current===c&&(L(ee),L(_e)),ft.current===c&&(L(ft),uE._currentValue=Z)}var Ur=Object.prototype.hasOwnProperty,Wr=t.unstable_scheduleCallback,kr=t.unstable_cancelCallback,qt=t.unstable_shouldYield,$t=t.unstable_requestPaint,pt=t.unstable_now,Gn=t.unstable_getCurrentPriorityLevel,br=t.unstable_ImmediatePriority,Kt=t.unstable_UserBlockingPriority,at=t.unstable_NormalPriority,er=t.unstable_LowPriority,xe=t.unstable_IdlePriority,ze=t.log,ut=t.unstable_setDisableYieldValue,$e=null,et=null;function on(c){if(typeof ze=="function"&&ut(c),et&&typeof et.setStrictMode=="function")try{et.setStrictMode($e,c)}catch{}}var mn=Math.clz32?Math.clz32:xr,Wn=Math.log,Ji=Math.LN2;function xr(c){return c>>>=0,c===0?32:31-(Wn(c)/Ji|0)|0}var Ps=256,na=4194304;function zr(c){var u=c&42;if(u!==0)return u;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function Us(c,u,h){var m=c.pendingLanes;if(m===0)return 0;var v=0,T=c.suspendedLanes,Q=c.pingedLanes;c=c.warmLanes;var W=m&134217727;return W!==0?(m=W&~T,m!==0?v=zr(m):(Q&=W,Q!==0?v=zr(Q):h||(h=W&~c,h!==0&&(v=zr(h))))):(W=m&~T,W!==0?v=zr(W):Q!==0?v=zr(Q):h||(h=m&~c,h!==0&&(v=zr(h)))),v===0?0:u!==0&&u!==v&&(u&T)===0&&(T=v&-v,h=u&-u,T>=h||T===32&&(h&4194048)!==0)?u:v}function bc(c,u){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&u)===0}function sA(c,u){switch(c){case 1:case 2:case 4:case 8:case 64:return u+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Cu(){var c=Ps;return Ps<<=1,(Ps&4194048)===0&&(Ps=256),c}function Tu(){var c=na;return na<<=1,(na&62914560)===0&&(na=4194304),c}function oA(c){for(var u=[],h=0;31>h;h++)u.push(c);return u}function Ic(c,u){c.pendingLanes|=u,u!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function tp(c,u,h,m,v,T){var Q=c.pendingLanes;c.pendingLanes=h,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=h,c.entangledLanes&=h,c.errorRecoveryDisabledLanes&=h,c.shellSuspendCounter=0;var W=c.entanglements,ne=c.expirationTimes,he=c.hiddenUpdates;for(h=Q&~h;0<h;){var Ce=31-mn(h),Ne=1<<Ce;W[Ce]=0,ne[Ce]=-1;var pe=he[Ce];if(pe!==null)for(he[Ce]=null,Ce=0;Ce<pe.length;Ce++){var me=pe[Ce];me!==null&&(me.lane&=-536870913)}h&=~Ne}m!==0&&Pa(c,m,0),T!==0&&v===0&&c.tag!==0&&(c.suspendedLanes|=T&~(Q&~u))}function Pa(c,u,h){c.pendingLanes|=u,c.suspendedLanes&=~u;var m=31-mn(u);c.entangledLanes|=u,c.entanglements[m]=c.entanglements[m]|1073741824|h&4194090}function fo(c,u){var h=c.entangledLanes|=u;for(c=c.entanglements;h;){var m=31-mn(h),v=1<<m;v&u|c[m]&u&&(c[m]|=u),h&=~v}}function ra(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function fh(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function aA(){var c=Y.p;return c!==0?c:(c=window.event,c===void 0?32:e4(c.type))}function Rc(c,u){var h=Y.p;try{return Y.p=c,u()}finally{Y.p=h}}var Ir=Math.random().toString(36).slice(2),Vi="__reactFiber$"+Ir,bi="__reactProps$"+Ir,$i="__reactContainer$"+Ir,ph="__reactEvents$"+Ir,Su="__reactListeners$"+Ir,cA="__reactHandles$"+Ir,np="__reactResources$"+Ir,Oc="__reactMarker$"+Ir;function ia(c){delete c[Vi],delete c[bi],delete c[ph],delete c[Su],delete c[cA]}function Pn(c){var u=c[Vi];if(u)return u;for(var h=c.parentNode;h;){if(u=h[$i]||h[Vi]){if(h=u.alternate,u.child!==null||h!==null&&h.child!==null)for(c=FV(c);c!==null;){if(h=c[Vi])return h;c=FV(c)}return u}c=h,h=c.parentNode}return null}function Qi(c){if(c=c[Vi]||c[$i]){var u=c.tag;if(u===5||u===6||u===13||u===26||u===27||u===3)return c}return null}function po(c){var u=c.tag;if(u===5||u===26||u===27||u===6)return c.stateNode;throw Error(r(33))}function gr(c){var u=c[np];return u||(u=c[np]={hoistableStyles:new Map,hoistableScripts:new Map}),u}function qr(c){c[Oc]=!0}var mh=new Set,Ii={};function ks(c,u){mo(c,u),mo(c+"Capture",u)}function mo(c,u){for(Ii[c]=u,c=0;c<u.length;c++)mh.add(u[c])}var gh=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),_h={},AA={};function lA(c){return Ur.call(AA,c)?!0:Ur.call(_h,c)?!1:gh.test(c)?AA[c]=!0:(_h[c]=!0,!1)}function Ge(c,u,h){if(lA(u))if(h===null)c.removeAttribute(u);else{switch(typeof h){case"undefined":case"function":case"symbol":c.removeAttribute(u);return;case"boolean":var m=u.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){c.removeAttribute(u);return}}c.setAttribute(u,""+h)}}function mt(c,u,h){if(h===null)c.removeAttribute(u);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(u);return}c.setAttribute(u,""+h)}}function Ri(c,u,h,m){if(m===null)c.removeAttribute(h);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(h);return}c.setAttributeNS(u,h,""+m)}}var uA,rp;function Nc(c){if(uA===void 0)try{throw Error()}catch(h){var u=h.stack.trim().match(/\n( *(at )?)/);uA=u&&u[1]||"",rp=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+uA+c+rp}var dA=!1;function bu(c,u){if(!c||dA)return"";dA=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(u){var Ne=function(){throw Error()};if(Object.defineProperty(Ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ne,[])}catch(me){var pe=me}Reflect.construct(c,[],Ne)}else{try{Ne.call()}catch(me){pe=me}c.call(Ne.prototype)}}else{try{throw Error()}catch(me){pe=me}(Ne=c())&&typeof Ne.catch=="function"&&Ne.catch(function(){})}}catch(me){if(me&&pe&&typeof me.stack=="string")return[me.stack,pe.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var v=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");v&&v.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=m.DetermineComponentFrameRoot(),Q=T[0],W=T[1];if(Q&&W){var ne=Q.split(`
`),he=W.split(`
`);for(v=m=0;m<ne.length&&!ne[m].includes("DetermineComponentFrameRoot");)m++;for(;v<he.length&&!he[v].includes("DetermineComponentFrameRoot");)v++;if(m===ne.length||v===he.length)for(m=ne.length-1,v=he.length-1;1<=m&&0<=v&&ne[m]!==he[v];)v--;for(;1<=m&&0<=v;m--,v--)if(ne[m]!==he[v]){if(m!==1||v!==1)do if(m--,v--,0>v||ne[m]!==he[v]){var Ce=`
`+ne[m].replace(" at new "," at ");return c.displayName&&Ce.includes("<anonymous>")&&(Ce=Ce.replace("<anonymous>",c.displayName)),Ce}while(1<=m&&0<=v);break}}}finally{dA=!1,Error.prepareStackTrace=h}return(h=c?c.displayName||c.name:"")?Nc(h):""}function Ua(c){switch(c.tag){case 26:case 27:case 5:return Nc(c.type);case 16:return Nc("Lazy");case 13:return Nc("Suspense");case 19:return Nc("SuspenseList");case 0:case 15:return bu(c.type,!1);case 11:return bu(c.type.render,!1);case 1:return bu(c.type,!0);case 31:return Nc("Activity");default:return""}}function Iu(c){try{var u="";do u+=Ua(c),c=c.return;while(c);return u}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}function us(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function Eh(c){var u=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function C_(c){var u=Eh(c)?"checked":"value",h=Object.getOwnPropertyDescriptor(c.constructor.prototype,u),m=""+c[u];if(!c.hasOwnProperty(u)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var v=h.get,T=h.set;return Object.defineProperty(c,u,{configurable:!0,get:function(){return v.call(this)},set:function(Q){m=""+Q,T.call(this,Q)}}),Object.defineProperty(c,u,{enumerable:h.enumerable}),{getValue:function(){return m},setValue:function(Q){m=""+Q},stopTracking:function(){c._valueTracker=null,delete c[u]}}}}function pl(c){c._valueTracker||(c._valueTracker=C_(c))}function yh(c){if(!c)return!1;var u=c._valueTracker;if(!u)return!0;var h=u.getValue(),m="";return c&&(m=Eh(c)?c.checked?"true":"false":c.value),c=m,c!==h?(u.setValue(c),!0):!1}function ml(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var T_=/[\n"\\]/g;function Ai(c){return c.replace(T_,function(u){return"\\"+u.charCodeAt(0).toString(16)+" "})}function go(c,u,h,m,v,T,Q,W){c.name="",Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"?c.type=Q:c.removeAttribute("type"),u!=null?Q==="number"?(u===0&&c.value===""||c.value!=u)&&(c.value=""+us(u)):c.value!==""+us(u)&&(c.value=""+us(u)):Q!=="submit"&&Q!=="reset"||c.removeAttribute("value"),u!=null?hA(c,Q,us(u)):h!=null?hA(c,Q,us(h)):m!=null&&c.removeAttribute("value"),v==null&&T!=null&&(c.defaultChecked=!!T),v!=null&&(c.checked=v&&typeof v!="function"&&typeof v!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?c.name=""+us(W):c.removeAttribute("name")}function gl(c,u,h,m,v,T,Q,W){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(c.type=T),u!=null||h!=null){if(!(T!=="submit"&&T!=="reset"||u!=null))return;h=h!=null?""+us(h):"",u=u!=null?""+us(u):h,W||u===c.value||(c.value=u),c.defaultValue=u}m=m??v,m=typeof m!="function"&&typeof m!="symbol"&&!!m,c.checked=W?c.checked:!!m,c.defaultChecked=!!m,Q!=null&&typeof Q!="function"&&typeof Q!="symbol"&&typeof Q!="boolean"&&(c.name=Q)}function hA(c,u,h){u==="number"&&ml(c.ownerDocument)===c||c.defaultValue===""+h||(c.defaultValue=""+h)}function ka(c,u,h,m){if(c=c.options,u){u={};for(var v=0;v<h.length;v++)u["$"+h[v]]=!0;for(h=0;h<c.length;h++)v=u.hasOwnProperty("$"+c[h].value),c[h].selected!==v&&(c[h].selected=v),v&&m&&(c[h].defaultSelected=!0)}else{for(h=""+us(h),u=null,v=0;v<c.length;v++){if(c[v].value===h){c[v].selected=!0,m&&(c[v].defaultSelected=!0);return}u!==null||c[v].disabled||(u=c[v])}u!==null&&(u.selected=!0)}}function zn(c,u,h){if(u!=null&&(u=""+us(u),u!==c.value&&(c.value=u),h==null)){c.defaultValue!==u&&(c.defaultValue=u);return}c.defaultValue=h!=null?""+us(h):""}function _l(c,u,h,m){if(u==null){if(m!=null){if(h!=null)throw Error(r(92));if(fe(m)){if(1<m.length)throw Error(r(93));m=m[0]}h=m}h==null&&(h=""),u=h}h=us(u),c.defaultValue=h,m=c.textContent,m===h&&m!==""&&m!==null&&(c.value=m)}function Bo(c,u){if(u){var h=c.firstChild;if(h&&h===c.lastChild&&h.nodeType===3){h.nodeValue=u;return}}c.textContent=u}var El=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ip(c,u,h){var m=u.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?m?c.setProperty(u,""):u==="float"?c.cssFloat="":c[u]="":m?c.setProperty(u,h):typeof h!="number"||h===0||El.has(u)?u==="float"?c.cssFloat=h:c[u]=(""+h).trim():c[u]=h+"px"}function vh(c,u,h){if(u!=null&&typeof u!="object")throw Error(r(62));if(c=c.style,h!=null){for(var m in h)!h.hasOwnProperty(m)||u!=null&&u.hasOwnProperty(m)||(m.indexOf("--")===0?c.setProperty(m,""):m==="float"?c.cssFloat="":c[m]="");for(var v in u)m=u[v],u.hasOwnProperty(v)&&h[v]!==m&&ip(c,v,m)}else for(var T in u)u.hasOwnProperty(T)&&ip(c,T,u[T])}function wh(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ch=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),S_=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ru(c){return S_.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}var Dc=null;function Lo(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var sa=null,oa=null;function Th(c){var u=Qi(c);if(u&&(c=u.stateNode)){var h=c[bi]||null;e:switch(c=u.stateNode,u.type){case"input":if(go(c,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),u=h.name,h.type==="radio"&&u!=null){for(h=c;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+Ai(""+u)+'"][type="radio"]'),u=0;u<h.length;u++){var m=h[u];if(m!==c&&m.form===c.form){var v=m[bi]||null;if(!v)throw Error(r(90));go(m,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name)}}for(u=0;u<h.length;u++)m=h[u],m.form===c.form&&yh(m)}break e;case"textarea":zn(c,h.value,h.defaultValue);break e;case"select":u=h.value,u!=null&&ka(c,!!h.multiple,u,!1)}}}var xa=!1;function Sh(c,u,h){if(xa)return c(u,h);xa=!0;try{var m=c(u);return m}finally{if(xa=!1,(sa!==null||oa!==null)&&(yC(),sa&&(u=sa,c=oa,oa=sa=null,Th(u),c)))for(u=0;u<c.length;u++)Th(c[u])}}function fA(c,u){var h=c.stateNode;if(h===null)return null;var m=h[bi]||null;if(m===null)return null;h=m[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(c=c.type,m=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!m;break e;default:c=!1}if(c)return null;if(h&&typeof h!="function")throw Error(r(231,u,typeof h));return h}var Po=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ce=!1;if(Po)try{var Ee={};Object.defineProperty(Ee,"passive",{get:function(){ce=!0}}),window.addEventListener("test",Ee,Ee),window.removeEventListener("test",Ee,Ee)}catch{ce=!1}var ye=null,Me=null,it=null;function yn(){if(it)return it;var c,u=Me,h=u.length,m,v="value"in ye?ye.value:ye.textContent,T=v.length;for(c=0;c<h&&u[c]===v[c];c++);var Q=h-c;for(m=1;m<=Q&&u[h-m]===v[T-m];m++);return it=v.slice(c,1<m?1-m:void 0)}function Gt(c){var u=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&u===13&&(c=13)):c=u,c===10&&(c=13),32<=c||c===13?c:0}function Tt(){return!0}function Zt(){return!1}function Nt(c){function u(h,m,v,T,Q){this._reactName=h,this._targetInst=v,this.type=m,this.nativeEvent=T,this.target=Q,this.currentTarget=null;for(var W in c)c.hasOwnProperty(W)&&(h=c[W],this[W]=h?h(T):T[W]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?Tt:Zt,this.isPropagationStopped=Zt,this}return d(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=Tt)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=Tt)},persist:function(){},isPersistent:Tt}),u}var Ht={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xs=Nt(Ht),ds=d({},Ht,{view:0,detail:0}),pA=Nt(ds),Js,_o,mA,bh=d({},ds,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Oh,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==mA&&(mA&&c.type==="mousemove"?(Js=c.screenX-mA.screenX,_o=c.screenY-mA.screenY):_o=Js=0,mA=c),Js)},movementY:function(c){return"movementY"in c?c.movementY:_o}}),Ma=Nt(bh),Ow=d({},bh,{dataTransfer:0}),RR=Nt(Ow),Ih=d({},ds,{relatedTarget:0}),sp=Nt(Ih),b_=d({},Ht,{animationName:0,elapsedTime:0,pseudoElement:0}),op=Nt(b_),Nw=d({},Ht,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),ap=Nt(Nw),OR=d({},Ht,{data:0}),I_=Nt(OR),Rh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Bw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function R_(c){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(c):(c=Bw[c])?!!u[c]:!1}function Oh(){return R_}var Lw=d({},ds,{key:function(c){if(c.key){var u=Rh[c.key]||c.key;if(u!=="Unidentified")return u}return c.type==="keypress"?(c=Gt(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?Dw[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Oh,charCode:function(c){return c.type==="keypress"?Gt(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Gt(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),cp=Nt(Lw),Pw=d({},bh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),O_=Nt(Pw),yl=d({},ds,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Oh}),Uw=Nt(yl),kw=d({},Ht,{propertyName:0,elapsedTime:0,pseudoElement:0}),xw=Nt(kw),Mw=d({},bh,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),Ap=Nt(Mw),Eo=d({},Ht,{newState:0,oldState:0}),Fw=Nt(Eo),Vw=[9,13,27,32],gA=Po&&"CompositionEvent"in window,_=null;Po&&"documentMode"in document&&(_=document.documentMode);var R=Po&&"TextEvent"in window&&!_,F=Po&&(!gA||_&&8<_&&11>=_),X=" ",ue=!1;function ge(c,u){switch(c){case"keyup":return Vw.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function He(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Cn=!1;function Zi(c,u){switch(c){case"compositionend":return He(u);case"keypress":return u.which!==32?null:(ue=!0,X);case"textInput":return c=u.data,c===X&&ue?null:c;default:return null}}function Tn(c,u){if(Cn)return c==="compositionend"||!gA&&ge(c,u)?(c=yn(),it=Me=ye=null,Cn=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return F&&u.locale!=="ko"?null:u.data;default:return null}}var hs={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function es(c){var u=c&&c.nodeName&&c.nodeName.toLowerCase();return u==="input"?!!hs[c.type]:u==="textarea"}function vl(c,u,h,m){sa?oa?oa.push(m):oa=[m]:sa=m,u=bC(u,"onChange"),0<u.length&&(h=new xs("onChange","change",null,h,m),c.push({event:h,listeners:u}))}var Ms=null,_A=null;function N_(c){OV(c,0)}function Qw(c){var u=po(c);if(yh(u))return c}function X2(c,u){if(c==="change")return u}var J2=!1;if(Po){var NR;if(Po){var DR="oninput"in document;if(!DR){var $2=document.createElement("div");$2.setAttribute("oninput","return;"),DR=typeof $2.oninput=="function"}NR=DR}else NR=!1;J2=NR&&(!document.documentMode||9<document.documentMode)}function Z2(){Ms&&(Ms.detachEvent("onpropertychange",eM),_A=Ms=null)}function eM(c){if(c.propertyName==="value"&&Qw(_A)){var u=[];vl(u,_A,c,Lo(c)),Sh(N_,u)}}function wie(c,u,h){c==="focusin"?(Z2(),Ms=u,_A=h,Ms.attachEvent("onpropertychange",eM)):c==="focusout"&&Z2()}function Cie(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return Qw(_A)}function Tie(c,u){if(c==="click")return Qw(u)}function Sie(c,u){if(c==="input"||c==="change")return Qw(u)}function bie(c,u){return c===u&&(c!==0||1/c===1/u)||c!==c&&u!==u}var aa=typeof Object.is=="function"?Object.is:bie;function D_(c,u){if(aa(c,u))return!0;if(typeof c!="object"||c===null||typeof u!="object"||u===null)return!1;var h=Object.keys(c),m=Object.keys(u);if(h.length!==m.length)return!1;for(m=0;m<h.length;m++){var v=h[m];if(!Ur.call(u,v)||!aa(c[v],u[v]))return!1}return!0}function tM(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function nM(c,u){var h=tM(c);c=0;for(var m;h;){if(h.nodeType===3){if(m=c+h.textContent.length,c<=u&&m>=u)return{node:h,offset:u-c};c=m}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=tM(h)}}function rM(c,u){return c&&u?c===u?!0:c&&c.nodeType===3?!1:u&&u.nodeType===3?rM(c,u.parentNode):"contains"in c?c.contains(u):c.compareDocumentPosition?!!(c.compareDocumentPosition(u)&16):!1:!1}function iM(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var u=ml(c.document);u instanceof c.HTMLIFrameElement;){try{var h=typeof u.contentWindow.location.href=="string"}catch{h=!1}if(h)c=u.contentWindow;else break;u=ml(c.document)}return u}function BR(c){var u=c&&c.nodeName&&c.nodeName.toLowerCase();return u&&(u==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||u==="textarea"||c.contentEditable==="true")}var Iie=Po&&"documentMode"in document&&11>=document.documentMode,lp=null,LR=null,B_=null,PR=!1;function sM(c,u,h){var m=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;PR||lp==null||lp!==ml(m)||(m=lp,"selectionStart"in m&&BR(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),B_&&D_(B_,m)||(B_=m,m=bC(LR,"onSelect"),0<m.length&&(u=new xs("onSelect","select",null,u,h),c.push({event:u,listeners:m}),u.target=lp)))}function Nh(c,u){var h={};return h[c.toLowerCase()]=u.toLowerCase(),h["Webkit"+c]="webkit"+u,h["Moz"+c]="moz"+u,h}var up={animationend:Nh("Animation","AnimationEnd"),animationiteration:Nh("Animation","AnimationIteration"),animationstart:Nh("Animation","AnimationStart"),transitionrun:Nh("Transition","TransitionRun"),transitionstart:Nh("Transition","TransitionStart"),transitioncancel:Nh("Transition","TransitionCancel"),transitionend:Nh("Transition","TransitionEnd")},UR={},oM={};Po&&(oM=document.createElement("div").style,"AnimationEvent"in window||(delete up.animationend.animation,delete up.animationiteration.animation,delete up.animationstart.animation),"TransitionEvent"in window||delete up.transitionend.transition);function Dh(c){if(UR[c])return UR[c];if(!up[c])return c;var u=up[c],h;for(h in u)if(u.hasOwnProperty(h)&&h in oM)return UR[c]=u[h];return c}var aM=Dh("animationend"),cM=Dh("animationiteration"),AM=Dh("animationstart"),Rie=Dh("transitionrun"),Oie=Dh("transitionstart"),Nie=Dh("transitioncancel"),lM=Dh("transitionend"),uM=new Map,kR="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");kR.push("scrollEnd");function Bc(c,u){uM.set(c,u),ks(u,[c])}var dM=new WeakMap;function Fa(c,u){if(typeof c=="object"&&c!==null){var h=dM.get(c);return h!==void 0?h:(u={value:c,source:u,stack:Iu(u)},dM.set(c,u),u)}return{value:c,source:u,stack:Iu(u)}}var Va=[],dp=0,xR=0;function Hw(){for(var c=dp,u=xR=dp=0;u<c;){var h=Va[u];Va[u++]=null;var m=Va[u];Va[u++]=null;var v=Va[u];Va[u++]=null;var T=Va[u];if(Va[u++]=null,m!==null&&v!==null){var Q=m.pending;Q===null?v.next=v:(v.next=Q.next,Q.next=v),m.pending=v}T!==0&&hM(h,v,T)}}function jw(c,u,h,m){Va[dp++]=c,Va[dp++]=u,Va[dp++]=h,Va[dp++]=m,xR|=m,c.lanes|=m,c=c.alternate,c!==null&&(c.lanes|=m)}function MR(c,u,h,m){return jw(c,u,h,m),Kw(c)}function hp(c,u){return jw(c,null,null,u),Kw(c)}function hM(c,u,h){c.lanes|=h;var m=c.alternate;m!==null&&(m.lanes|=h);for(var v=!1,T=c.return;T!==null;)T.childLanes|=h,m=T.alternate,m!==null&&(m.childLanes|=h),T.tag===22&&(c=T.stateNode,c===null||c._visibility&1||(v=!0)),c=T,T=T.return;return c.tag===3?(T=c.stateNode,v&&u!==null&&(v=31-mn(h),c=T.hiddenUpdates,m=c[v],m===null?c[v]=[u]:m.push(u),u.lane=h|536870912),T):null}function Kw(c){if(50<rE)throw rE=0,KO=null,Error(r(185));for(var u=c.return;u!==null;)c=u,u=c.return;return c.tag===3?c.stateNode:null}var fp={};function Die(c,u,h,m){this.tag=c,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ca(c,u,h,m){return new Die(c,u,h,m)}function FR(c){return c=c.prototype,!(!c||!c.isReactComponent)}function wl(c,u){var h=c.alternate;return h===null?(h=ca(c.tag,u,c.key,c.mode),h.elementType=c.elementType,h.type=c.type,h.stateNode=c.stateNode,h.alternate=c,c.alternate=h):(h.pendingProps=u,h.type=c.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=c.flags&65011712,h.childLanes=c.childLanes,h.lanes=c.lanes,h.child=c.child,h.memoizedProps=c.memoizedProps,h.memoizedState=c.memoizedState,h.updateQueue=c.updateQueue,u=c.dependencies,h.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},h.sibling=c.sibling,h.index=c.index,h.ref=c.ref,h.refCleanup=c.refCleanup,h}function fM(c,u){c.flags&=65011714;var h=c.alternate;return h===null?(c.childLanes=0,c.lanes=u,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=h.childLanes,c.lanes=h.lanes,c.child=h.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=h.memoizedProps,c.memoizedState=h.memoizedState,c.updateQueue=h.updateQueue,c.type=h.type,u=h.dependencies,c.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),c}function Gw(c,u,h,m,v,T){var Q=0;if(m=c,typeof c=="function")FR(c)&&(Q=1);else if(typeof c=="string")Q=Lse(c,h,ee.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case M:return c=ca(31,h,u,v),c.elementType=M,c.lanes=T,c;case y:return Bh(h.children,v,T,u);case E:Q=8,v|=24;break;case w:return c=ca(12,h,u,v|2),c.elementType=w,c.lanes=T,c;case H:return c=ca(13,h,u,v),c.elementType=H,c.lanes=T,c;case K:return c=ca(19,h,u,v),c.elementType=K,c.lanes=T,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case b:case B:Q=10;break e;case I:Q=9;break e;case U:Q=11;break e;case x:Q=14;break e;case V:Q=16,m=null;break e}Q=29,h=Error(r(130,c===null?"null":typeof c,"")),m=null}return u=ca(Q,h,u,v),u.elementType=c,u.type=m,u.lanes=T,u}function Bh(c,u,h,m){return c=ca(7,c,m,u),c.lanes=h,c}function VR(c,u,h){return c=ca(6,c,null,u),c.lanes=h,c}function QR(c,u,h){return u=ca(4,c.children!==null?c.children:[],c.key,u),u.lanes=h,u.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},u}var pp=[],mp=0,Ww=null,zw=0,Qa=[],Ha=0,Lh=null,Cl=1,Tl="";function Ph(c,u){pp[mp++]=zw,pp[mp++]=Ww,Ww=c,zw=u}function pM(c,u,h){Qa[Ha++]=Cl,Qa[Ha++]=Tl,Qa[Ha++]=Lh,Lh=c;var m=Cl;c=Tl;var v=32-mn(m)-1;m&=~(1<<v),h+=1;var T=32-mn(u)+v;if(30<T){var Q=v-v%5;T=(m&(1<<Q)-1).toString(32),m>>=Q,v-=Q,Cl=1<<32-mn(u)+v|h<<v|m,Tl=T+c}else Cl=1<<T|h<<v|m,Tl=c}function HR(c){c.return!==null&&(Ph(c,1),pM(c,1,0))}function jR(c){for(;c===Ww;)Ww=pp[--mp],pp[mp]=null,zw=pp[--mp],pp[mp]=null;for(;c===Lh;)Lh=Qa[--Ha],Qa[Ha]=null,Tl=Qa[--Ha],Qa[Ha]=null,Cl=Qa[--Ha],Qa[Ha]=null}var yo=null,li=null,Vn=!1,Uh=null,EA=!1,KR=Error(r(519));function kh(c){var u=Error(r(418,""));throw U_(Fa(u,c)),KR}function mM(c){var u=c.stateNode,h=c.type,m=c.memoizedProps;switch(u[Vi]=c,u[bi]=m,h){case"dialog":hn("cancel",u),hn("close",u);break;case"iframe":case"object":case"embed":hn("load",u);break;case"video":case"audio":for(h=0;h<sE.length;h++)hn(sE[h],u);break;case"source":hn("error",u);break;case"img":case"image":case"link":hn("error",u),hn("load",u);break;case"details":hn("toggle",u);break;case"input":hn("invalid",u),gl(u,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0),pl(u);break;case"select":hn("invalid",u);break;case"textarea":hn("invalid",u),_l(u,m.value,m.defaultValue,m.children),pl(u)}h=m.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||u.textContent===""+h||m.suppressHydrationWarning===!0||LV(u.textContent,h)?(m.popover!=null&&(hn("beforetoggle",u),hn("toggle",u)),m.onScroll!=null&&hn("scroll",u),m.onScrollEnd!=null&&hn("scrollend",u),m.onClick!=null&&(u.onclick=IC),u=!0):u=!1,u||kh(c)}function gM(c){for(yo=c.return;yo;)switch(yo.tag){case 5:case 13:EA=!1;return;case 27:case 3:EA=!0;return;default:yo=yo.return}}function L_(c){if(c!==yo)return!1;if(!Vn)return gM(c),Vn=!0,!1;var u=c.tag,h;if((h=u!==3&&u!==27)&&((h=u===5)&&(h=c.type,h=!(h!=="form"&&h!=="button")||oN(c.type,c.memoizedProps)),h=!h),h&&li&&kh(c),gM(c),u===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));e:{for(c=c.nextSibling,u=0;c;){if(c.nodeType===8)if(h=c.data,h==="/$"){if(u===0){li=Pc(c.nextSibling);break e}u--}else h!=="$"&&h!=="$!"&&h!=="$?"||u++;c=c.nextSibling}li=null}}else u===27?(u=li,Ku(c.type)?(c=lN,lN=null,li=c):li=u):li=yo?Pc(c.stateNode.nextSibling):null;return!0}function P_(){li=yo=null,Vn=!1}function _M(){var c=Uh;return c!==null&&(xo===null?xo=c:xo.push.apply(xo,c),Uh=null),c}function U_(c){Uh===null?Uh=[c]:Uh.push(c)}var GR=C(null),xh=null,Sl=null;function Ou(c,u,h){k(GR,u._currentValue),u._currentValue=h}function bl(c){c._currentValue=GR.current,L(GR)}function WR(c,u,h){for(;c!==null;){var m=c.alternate;if((c.childLanes&u)!==u?(c.childLanes|=u,m!==null&&(m.childLanes|=u)):m!==null&&(m.childLanes&u)!==u&&(m.childLanes|=u),c===h)break;c=c.return}}function zR(c,u,h,m){var v=c.child;for(v!==null&&(v.return=c);v!==null;){var T=v.dependencies;if(T!==null){var Q=v.child;T=T.firstContext;e:for(;T!==null;){var W=T;T=v;for(var ne=0;ne<u.length;ne++)if(W.context===u[ne]){T.lanes|=h,W=T.alternate,W!==null&&(W.lanes|=h),WR(T.return,h,c),m||(Q=null);break e}T=W.next}}else if(v.tag===18){if(Q=v.return,Q===null)throw Error(r(341));Q.lanes|=h,T=Q.alternate,T!==null&&(T.lanes|=h),WR(Q,h,c),Q=null}else Q=v.child;if(Q!==null)Q.return=v;else for(Q=v;Q!==null;){if(Q===c){Q=null;break}if(v=Q.sibling,v!==null){v.return=Q.return,Q=v;break}Q=Q.return}v=Q}}function k_(c,u,h,m){c=null;for(var v=u,T=!1;v!==null;){if(!T){if((v.flags&524288)!==0)T=!0;else if((v.flags&262144)!==0)break}if(v.tag===10){var Q=v.alternate;if(Q===null)throw Error(r(387));if(Q=Q.memoizedProps,Q!==null){var W=v.type;aa(v.pendingProps.value,Q.value)||(c!==null?c.push(W):c=[W])}}else if(v===ft.current){if(Q=v.alternate,Q===null)throw Error(r(387));Q.memoizedState.memoizedState!==v.memoizedState.memoizedState&&(c!==null?c.push(uE):c=[uE])}v=v.return}c!==null&&zR(u,c,h,m),u.flags|=262144}function qw(c){for(c=c.firstContext;c!==null;){if(!aa(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function Mh(c){xh=c,Sl=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function $s(c){return EM(xh,c)}function Yw(c,u){return xh===null&&Mh(c),EM(c,u)}function EM(c,u){var h=u._currentValue;if(u={context:u,memoizedValue:h,next:null},Sl===null){if(c===null)throw Error(r(308));Sl=u,c.dependencies={lanes:0,firstContext:u},c.flags|=524288}else Sl=Sl.next=u;return h}var Bie=typeof AbortController<"u"?AbortController:function(){var c=[],u=this.signal={aborted:!1,addEventListener:function(h,m){c.push(m)}};this.abort=function(){u.aborted=!0,c.forEach(function(h){return h()})}},Lie=t.unstable_scheduleCallback,Pie=t.unstable_NormalPriority,ts={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function qR(){return{controller:new Bie,data:new Map,refCount:0}}function x_(c){c.refCount--,c.refCount===0&&Lie(Pie,function(){c.controller.abort()})}var M_=null,YR=0,gp=0,_p=null;function Uie(c,u){if(M_===null){var h=M_=[];YR=0,gp=JO(),_p={status:"pending",value:void 0,then:function(m){h.push(m)}}}return YR++,u.then(yM,yM),u}function yM(){if(--YR===0&&M_!==null){_p!==null&&(_p.status="fulfilled");var c=M_;M_=null,gp=0,_p=null;for(var u=0;u<c.length;u++)(0,c[u])()}}function kie(c,u){var h=[],m={status:"pending",value:null,reason:null,then:function(v){h.push(v)}};return c.then(function(){m.status="fulfilled",m.value=u;for(var v=0;v<h.length;v++)(0,h[v])(u)},function(v){for(m.status="rejected",m.reason=v,v=0;v<h.length;v++)(0,h[v])(void 0)}),m}var vM=re.S;re.S=function(c,u){typeof u=="object"&&u!==null&&typeof u.then=="function"&&Uie(c,u),vM!==null&&vM(c,u)};var Fh=C(null);function XR(){var c=Fh.current;return c!==null?c:Rr.pooledCache}function Xw(c,u){u===null?k(Fh,Fh.current):k(Fh,u.pool)}function wM(){var c=XR();return c===null?null:{parent:ts._currentValue,pool:c}}var F_=Error(r(460)),CM=Error(r(474)),Jw=Error(r(542)),JR={then:function(){}};function TM(c){return c=c.status,c==="fulfilled"||c==="rejected"}function $w(){}function SM(c,u,h){switch(h=c[h],h===void 0?c.push(u):h!==u&&(u.then($w,$w),u=h),u.status){case"fulfilled":return u.value;case"rejected":throw c=u.reason,IM(c),c;default:if(typeof u.status=="string")u.then($w,$w);else{if(c=Rr,c!==null&&100<c.shellSuspendCounter)throw Error(r(482));c=u,c.status="pending",c.then(function(m){if(u.status==="pending"){var v=u;v.status="fulfilled",v.value=m}},function(m){if(u.status==="pending"){var v=u;v.status="rejected",v.reason=m}})}switch(u.status){case"fulfilled":return u.value;case"rejected":throw c=u.reason,IM(c),c}throw V_=u,F_}}var V_=null;function bM(){if(V_===null)throw Error(r(459));var c=V_;return V_=null,c}function IM(c){if(c===F_||c===Jw)throw Error(r(483))}var Nu=!1;function $R(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ZR(c,u){c=c.updateQueue,u.updateQueue===c&&(u.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function Du(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function Bu(c,u,h){var m=c.updateQueue;if(m===null)return null;if(m=m.shared,(tr&2)!==0){var v=m.pending;return v===null?u.next=u:(u.next=v.next,v.next=u),m.pending=u,u=Kw(c),hM(c,null,h),u}return jw(c,m,u,h),Kw(c)}function Q_(c,u,h){if(u=u.updateQueue,u!==null&&(u=u.shared,(h&4194048)!==0)){var m=u.lanes;m&=c.pendingLanes,h|=m,u.lanes=h,fo(c,h)}}function eO(c,u){var h=c.updateQueue,m=c.alternate;if(m!==null&&(m=m.updateQueue,h===m)){var v=null,T=null;if(h=h.firstBaseUpdate,h!==null){do{var Q={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};T===null?v=T=Q:T=T.next=Q,h=h.next}while(h!==null);T===null?v=T=u:T=T.next=u}else v=T=u;h={baseState:m.baseState,firstBaseUpdate:v,lastBaseUpdate:T,shared:m.shared,callbacks:m.callbacks},c.updateQueue=h;return}c=h.lastBaseUpdate,c===null?h.firstBaseUpdate=u:c.next=u,h.lastBaseUpdate=u}var tO=!1;function H_(){if(tO){var c=_p;if(c!==null)throw c}}function j_(c,u,h,m){tO=!1;var v=c.updateQueue;Nu=!1;var T=v.firstBaseUpdate,Q=v.lastBaseUpdate,W=v.shared.pending;if(W!==null){v.shared.pending=null;var ne=W,he=ne.next;ne.next=null,Q===null?T=he:Q.next=he,Q=ne;var Ce=c.alternate;Ce!==null&&(Ce=Ce.updateQueue,W=Ce.lastBaseUpdate,W!==Q&&(W===null?Ce.firstBaseUpdate=he:W.next=he,Ce.lastBaseUpdate=ne))}if(T!==null){var Ne=v.baseState;Q=0,Ce=he=ne=null,W=T;do{var pe=W.lane&-536870913,me=pe!==W.lane;if(me?(Sn&pe)===pe:(m&pe)===pe){pe!==0&&pe===gp&&(tO=!0),Ce!==null&&(Ce=Ce.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Dt=c,wt=W;pe=u;var dr=h;switch(wt.tag){case 1:if(Dt=wt.payload,typeof Dt=="function"){Ne=Dt.call(dr,Ne,pe);break e}Ne=Dt;break e;case 3:Dt.flags=Dt.flags&-65537|128;case 0:if(Dt=wt.payload,pe=typeof Dt=="function"?Dt.call(dr,Ne,pe):Dt,pe==null)break e;Ne=d({},Ne,pe);break e;case 2:Nu=!0}}pe=W.callback,pe!==null&&(c.flags|=64,me&&(c.flags|=8192),me=v.callbacks,me===null?v.callbacks=[pe]:me.push(pe))}else me={lane:pe,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Ce===null?(he=Ce=me,ne=Ne):Ce=Ce.next=me,Q|=pe;if(W=W.next,W===null){if(W=v.shared.pending,W===null)break;me=W,W=me.next,me.next=null,v.lastBaseUpdate=me,v.shared.pending=null}}while(!0);Ce===null&&(ne=Ne),v.baseState=ne,v.firstBaseUpdate=he,v.lastBaseUpdate=Ce,T===null&&(v.shared.lanes=0),Vu|=Q,c.lanes=Q,c.memoizedState=Ne}}function RM(c,u){if(typeof c!="function")throw Error(r(191,c));c.call(u)}function OM(c,u){var h=c.callbacks;if(h!==null)for(c.callbacks=null,c=0;c<h.length;c++)RM(h[c],u)}var Ep=C(null),Zw=C(0);function NM(c,u){c=Ll,k(Zw,c),k(Ep,u),Ll=c|u.baseLanes}function nO(){k(Zw,Ll),k(Ep,Ep.current)}function rO(){Ll=Zw.current,L(Ep),L(Zw)}var Lu=0,en=null,lr=null,Hi=null,eC=!1,yp=!1,Vh=!1,tC=0,K_=0,vp=null,xie=0;function Oi(){throw Error(r(321))}function iO(c,u){if(u===null)return!1;for(var h=0;h<u.length&&h<c.length;h++)if(!aa(c[h],u[h]))return!1;return!0}function sO(c,u,h,m,v,T){return Lu=T,en=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,re.H=c===null||c.memoizedState===null?hF:fF,Vh=!1,T=h(m,v),Vh=!1,yp&&(T=BM(u,h,m,v)),DM(c),T}function DM(c){re.H=aC;var u=lr!==null&&lr.next!==null;if(Lu=0,Hi=lr=en=null,eC=!1,K_=0,vp=null,u)throw Error(r(300));c===null||fs||(c=c.dependencies,c!==null&&qw(c)&&(fs=!0))}function BM(c,u,h,m){en=c;var v=0;do{if(yp&&(vp=null),K_=0,yp=!1,25<=v)throw Error(r(301));if(v+=1,Hi=lr=null,c.updateQueue!=null){var T=c.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}re.H=Kie,T=u(h,m)}while(yp);return T}function Mie(){var c=re.H,u=c.useState()[0];return u=typeof u.then=="function"?G_(u):u,c=c.useState()[0],(lr!==null?lr.memoizedState:null)!==c&&(en.flags|=1024),u}function oO(){var c=tC!==0;return tC=0,c}function aO(c,u,h){u.updateQueue=c.updateQueue,u.flags&=-2053,c.lanes&=~h}function cO(c){if(eC){for(c=c.memoizedState;c!==null;){var u=c.queue;u!==null&&(u.pending=null),c=c.next}eC=!1}Lu=0,Hi=lr=en=null,yp=!1,K_=tC=0,vp=null}function Uo(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Hi===null?en.memoizedState=Hi=c:Hi=Hi.next=c,Hi}function ji(){if(lr===null){var c=en.alternate;c=c!==null?c.memoizedState:null}else c=lr.next;var u=Hi===null?en.memoizedState:Hi.next;if(u!==null)Hi=u,lr=c;else{if(c===null)throw en.alternate===null?Error(r(467)):Error(r(310));lr=c,c={memoizedState:lr.memoizedState,baseState:lr.baseState,baseQueue:lr.baseQueue,queue:lr.queue,next:null},Hi===null?en.memoizedState=Hi=c:Hi=Hi.next=c}return Hi}function AO(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function G_(c){var u=K_;return K_+=1,vp===null&&(vp=[]),c=SM(vp,c,u),u=en,(Hi===null?u.memoizedState:Hi.next)===null&&(u=u.alternate,re.H=u===null||u.memoizedState===null?hF:fF),c}function nC(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return G_(c);if(c.$$typeof===B)return $s(c)}throw Error(r(438,String(c)))}function lO(c){var u=null,h=en.updateQueue;if(h!==null&&(u=h.memoCache),u==null){var m=en.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(u={data:m.data.map(function(v){return v.slice()}),index:0})))}if(u==null&&(u={data:[],index:0}),h===null&&(h=AO(),en.updateQueue=h),h.memoCache=u,h=u.data[u.index],h===void 0)for(h=u.data[u.index]=Array(c),m=0;m<c;m++)h[m]=O;return u.index++,h}function Il(c,u){return typeof u=="function"?u(c):u}function rC(c){var u=ji();return uO(u,lr,c)}function uO(c,u,h){var m=c.queue;if(m===null)throw Error(r(311));m.lastRenderedReducer=h;var v=c.baseQueue,T=m.pending;if(T!==null){if(v!==null){var Q=v.next;v.next=T.next,T.next=Q}u.baseQueue=v=T,m.pending=null}if(T=c.baseState,v===null)c.memoizedState=T;else{u=v.next;var W=Q=null,ne=null,he=u,Ce=!1;do{var Ne=he.lane&-536870913;if(Ne!==he.lane?(Sn&Ne)===Ne:(Lu&Ne)===Ne){var pe=he.revertLane;if(pe===0)ne!==null&&(ne=ne.next={lane:0,revertLane:0,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null}),Ne===gp&&(Ce=!0);else if((Lu&pe)===pe){he=he.next,pe===gp&&(Ce=!0);continue}else Ne={lane:0,revertLane:he.revertLane,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null},ne===null?(W=ne=Ne,Q=T):ne=ne.next=Ne,en.lanes|=pe,Vu|=pe;Ne=he.action,Vh&&h(T,Ne),T=he.hasEagerState?he.eagerState:h(T,Ne)}else pe={lane:Ne,revertLane:he.revertLane,action:he.action,hasEagerState:he.hasEagerState,eagerState:he.eagerState,next:null},ne===null?(W=ne=pe,Q=T):ne=ne.next=pe,en.lanes|=Ne,Vu|=Ne;he=he.next}while(he!==null&&he!==u);if(ne===null?Q=T:ne.next=W,!aa(T,c.memoizedState)&&(fs=!0,Ce&&(h=_p,h!==null)))throw h;c.memoizedState=T,c.baseState=Q,c.baseQueue=ne,m.lastRenderedState=T}return v===null&&(m.lanes=0),[c.memoizedState,m.dispatch]}function dO(c){var u=ji(),h=u.queue;if(h===null)throw Error(r(311));h.lastRenderedReducer=c;var m=h.dispatch,v=h.pending,T=u.memoizedState;if(v!==null){h.pending=null;var Q=v=v.next;do T=c(T,Q.action),Q=Q.next;while(Q!==v);aa(T,u.memoizedState)||(fs=!0),u.memoizedState=T,u.baseQueue===null&&(u.baseState=T),h.lastRenderedState=T}return[T,m]}function LM(c,u,h){var m=en,v=ji(),T=Vn;if(T){if(h===void 0)throw Error(r(407));h=h()}else h=u();var Q=!aa((lr||v).memoizedState,h);Q&&(v.memoizedState=h,fs=!0),v=v.queue;var W=kM.bind(null,m,v,c);if(W_(2048,8,W,[c]),v.getSnapshot!==u||Q||Hi!==null&&Hi.memoizedState.tag&1){if(m.flags|=2048,wp(9,iC(),UM.bind(null,m,v,h,u),null),Rr===null)throw Error(r(349));T||(Lu&124)!==0||PM(m,u,h)}return h}function PM(c,u,h){c.flags|=16384,c={getSnapshot:u,value:h},u=en.updateQueue,u===null?(u=AO(),en.updateQueue=u,u.stores=[c]):(h=u.stores,h===null?u.stores=[c]:h.push(c))}function UM(c,u,h,m){u.value=h,u.getSnapshot=m,xM(u)&&MM(c)}function kM(c,u,h){return h(function(){xM(u)&&MM(c)})}function xM(c){var u=c.getSnapshot;c=c.value;try{var h=u();return!aa(c,h)}catch{return!0}}function MM(c){var u=hp(c,2);u!==null&&ha(u,c,2)}function hO(c){var u=Uo();if(typeof c=="function"){var h=c;if(c=h(),Vh){on(!0);try{h()}finally{on(!1)}}}return u.memoizedState=u.baseState=c,u.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Il,lastRenderedState:c},u}function FM(c,u,h,m){return c.baseState=h,uO(c,lr,typeof m=="function"?m:Il)}function Fie(c,u,h,m,v){if(oC(c))throw Error(r(485));if(c=u.action,c!==null){var T={payload:v,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(Q){T.listeners.push(Q)}};re.T!==null?h(!0):T.isTransition=!1,m(T),h=u.pending,h===null?(T.next=u.pending=T,VM(u,T)):(T.next=h.next,u.pending=h.next=T)}}function VM(c,u){var h=u.action,m=u.payload,v=c.state;if(u.isTransition){var T=re.T,Q={};re.T=Q;try{var W=h(v,m),ne=re.S;ne!==null&&ne(Q,W),QM(c,u,W)}catch(he){fO(c,u,he)}finally{re.T=T}}else try{T=h(v,m),QM(c,u,T)}catch(he){fO(c,u,he)}}function QM(c,u,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(m){HM(c,u,m)},function(m){return fO(c,u,m)}):HM(c,u,h)}function HM(c,u,h){u.status="fulfilled",u.value=h,jM(u),c.state=h,u=c.pending,u!==null&&(h=u.next,h===u?c.pending=null:(h=h.next,u.next=h,VM(c,h)))}function fO(c,u,h){var m=c.pending;if(c.pending=null,m!==null){m=m.next;do u.status="rejected",u.reason=h,jM(u),u=u.next;while(u!==m)}c.action=null}function jM(c){c=c.listeners;for(var u=0;u<c.length;u++)(0,c[u])()}function KM(c,u){return u}function GM(c,u){if(Vn){var h=Rr.formState;if(h!==null){e:{var m=en;if(Vn){if(li){t:{for(var v=li,T=EA;v.nodeType!==8;){if(!T){v=null;break t}if(v=Pc(v.nextSibling),v===null){v=null;break t}}T=v.data,v=T==="F!"||T==="F"?v:null}if(v){li=Pc(v.nextSibling),m=v.data==="F!";break e}}kh(m)}m=!1}m&&(u=h[0])}}return h=Uo(),h.memoizedState=h.baseState=u,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:KM,lastRenderedState:u},h.queue=m,h=lF.bind(null,en,m),m.dispatch=h,m=hO(!1),T=EO.bind(null,en,!1,m.queue),m=Uo(),v={state:u,dispatch:null,action:c,pending:null},m.queue=v,h=Fie.bind(null,en,v,T,h),v.dispatch=h,m.memoizedState=c,[u,h,!1]}function WM(c){var u=ji();return zM(u,lr,c)}function zM(c,u,h){if(u=uO(c,u,KM)[0],c=rC(Il)[0],typeof u=="object"&&u!==null&&typeof u.then=="function")try{var m=G_(u)}catch(Q){throw Q===F_?Jw:Q}else m=u;u=ji();var v=u.queue,T=v.dispatch;return h!==u.memoizedState&&(en.flags|=2048,wp(9,iC(),Vie.bind(null,v,h),null)),[m,T,c]}function Vie(c,u){c.action=u}function qM(c){var u=ji(),h=lr;if(h!==null)return zM(u,h,c);ji(),u=u.memoizedState,h=ji();var m=h.queue.dispatch;return h.memoizedState=c,[u,m,!1]}function wp(c,u,h,m){return c={tag:c,create:h,deps:m,inst:u,next:null},u=en.updateQueue,u===null&&(u=AO(),en.updateQueue=u),h=u.lastEffect,h===null?u.lastEffect=c.next=c:(m=h.next,h.next=c,c.next=m,u.lastEffect=c),c}function iC(){return{destroy:void 0,resource:void 0}}function YM(){return ji().memoizedState}function sC(c,u,h,m){var v=Uo();m=m===void 0?null:m,en.flags|=c,v.memoizedState=wp(1|u,iC(),h,m)}function W_(c,u,h,m){var v=ji();m=m===void 0?null:m;var T=v.memoizedState.inst;lr!==null&&m!==null&&iO(m,lr.memoizedState.deps)?v.memoizedState=wp(u,T,h,m):(en.flags|=c,v.memoizedState=wp(1|u,T,h,m))}function XM(c,u){sC(8390656,8,c,u)}function JM(c,u){W_(2048,8,c,u)}function $M(c,u){return W_(4,2,c,u)}function ZM(c,u){return W_(4,4,c,u)}function eF(c,u){if(typeof u=="function"){c=c();var h=u(c);return function(){typeof h=="function"?h():u(null)}}if(u!=null)return c=c(),u.current=c,function(){u.current=null}}function tF(c,u,h){h=h!=null?h.concat([c]):null,W_(4,4,eF.bind(null,u,c),h)}function pO(){}function nF(c,u){var h=ji();u=u===void 0?null:u;var m=h.memoizedState;return u!==null&&iO(u,m[1])?m[0]:(h.memoizedState=[c,u],c)}function rF(c,u){var h=ji();u=u===void 0?null:u;var m=h.memoizedState;if(u!==null&&iO(u,m[1]))return m[0];if(m=c(),Vh){on(!0);try{c()}finally{on(!1)}}return h.memoizedState=[m,u],m}function mO(c,u,h){return h===void 0||(Lu&1073741824)!==0?c.memoizedState=u:(c.memoizedState=h,c=oV(),en.lanes|=c,Vu|=c,h)}function iF(c,u,h,m){return aa(h,u)?h:Ep.current!==null?(c=mO(c,h,m),aa(c,u)||(fs=!0),c):(Lu&42)===0?(fs=!0,c.memoizedState=h):(c=oV(),en.lanes|=c,Vu|=c,u)}function sF(c,u,h,m,v){var T=Y.p;Y.p=T!==0&&8>T?T:8;var Q=re.T,W={};re.T=W,EO(c,!1,u,h);try{var ne=v(),he=re.S;if(he!==null&&he(W,ne),ne!==null&&typeof ne=="object"&&typeof ne.then=="function"){var Ce=kie(ne,m);z_(c,u,Ce,da(c))}else z_(c,u,m,da(c))}catch(Ne){z_(c,u,{then:function(){},status:"rejected",reason:Ne},da())}finally{Y.p=T,re.T=Q}}function Qie(){}function gO(c,u,h,m){if(c.tag!==5)throw Error(r(476));var v=oF(c).queue;sF(c,v,u,Z,h===null?Qie:function(){return aF(c),h(m)})}function oF(c){var u=c.memoizedState;if(u!==null)return u;u={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Il,lastRenderedState:Z},next:null};var h={};return u.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Il,lastRenderedState:h},next:null},c.memoizedState=u,c=c.alternate,c!==null&&(c.memoizedState=u),u}function aF(c){var u=oF(c).next.queue;z_(c,u,{},da())}function _O(){return $s(uE)}function cF(){return ji().memoizedState}function AF(){return ji().memoizedState}function Hie(c){for(var u=c.return;u!==null;){switch(u.tag){case 24:case 3:var h=da();c=Du(h);var m=Bu(u,c,h);m!==null&&(ha(m,u,h),Q_(m,u,h)),u={cache:qR()},c.payload=u;return}u=u.return}}function jie(c,u,h){var m=da();h={lane:m,revertLane:0,action:h,hasEagerState:!1,eagerState:null,next:null},oC(c)?uF(u,h):(h=MR(c,u,h,m),h!==null&&(ha(h,c,m),dF(h,u,m)))}function lF(c,u,h){var m=da();z_(c,u,h,m)}function z_(c,u,h,m){var v={lane:m,revertLane:0,action:h,hasEagerState:!1,eagerState:null,next:null};if(oC(c))uF(u,v);else{var T=c.alternate;if(c.lanes===0&&(T===null||T.lanes===0)&&(T=u.lastRenderedReducer,T!==null))try{var Q=u.lastRenderedState,W=T(Q,h);if(v.hasEagerState=!0,v.eagerState=W,aa(W,Q))return jw(c,u,v,0),Rr===null&&Hw(),!1}catch{}finally{}if(h=MR(c,u,v,m),h!==null)return ha(h,c,m),dF(h,u,m),!0}return!1}function EO(c,u,h,m){if(m={lane:2,revertLane:JO(),action:m,hasEagerState:!1,eagerState:null,next:null},oC(c)){if(u)throw Error(r(479))}else u=MR(c,h,m,2),u!==null&&ha(u,c,2)}function oC(c){var u=c.alternate;return c===en||u!==null&&u===en}function uF(c,u){yp=eC=!0;var h=c.pending;h===null?u.next=u:(u.next=h.next,h.next=u),c.pending=u}function dF(c,u,h){if((h&4194048)!==0){var m=u.lanes;m&=c.pendingLanes,h|=m,u.lanes=h,fo(c,h)}}var aC={readContext:$s,use:nC,useCallback:Oi,useContext:Oi,useEffect:Oi,useImperativeHandle:Oi,useLayoutEffect:Oi,useInsertionEffect:Oi,useMemo:Oi,useReducer:Oi,useRef:Oi,useState:Oi,useDebugValue:Oi,useDeferredValue:Oi,useTransition:Oi,useSyncExternalStore:Oi,useId:Oi,useHostTransitionStatus:Oi,useFormState:Oi,useActionState:Oi,useOptimistic:Oi,useMemoCache:Oi,useCacheRefresh:Oi},hF={readContext:$s,use:nC,useCallback:function(c,u){return Uo().memoizedState=[c,u===void 0?null:u],c},useContext:$s,useEffect:XM,useImperativeHandle:function(c,u,h){h=h!=null?h.concat([c]):null,sC(4194308,4,eF.bind(null,u,c),h)},useLayoutEffect:function(c,u){return sC(4194308,4,c,u)},useInsertionEffect:function(c,u){sC(4,2,c,u)},useMemo:function(c,u){var h=Uo();u=u===void 0?null:u;var m=c();if(Vh){on(!0);try{c()}finally{on(!1)}}return h.memoizedState=[m,u],m},useReducer:function(c,u,h){var m=Uo();if(h!==void 0){var v=h(u);if(Vh){on(!0);try{h(u)}finally{on(!1)}}}else v=u;return m.memoizedState=m.baseState=v,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:v},m.queue=c,c=c.dispatch=jie.bind(null,en,c),[m.memoizedState,c]},useRef:function(c){var u=Uo();return c={current:c},u.memoizedState=c},useState:function(c){c=hO(c);var u=c.queue,h=lF.bind(null,en,u);return u.dispatch=h,[c.memoizedState,h]},useDebugValue:pO,useDeferredValue:function(c,u){var h=Uo();return mO(h,c,u)},useTransition:function(){var c=hO(!1);return c=sF.bind(null,en,c.queue,!0,!1),Uo().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,u,h){var m=en,v=Uo();if(Vn){if(h===void 0)throw Error(r(407));h=h()}else{if(h=u(),Rr===null)throw Error(r(349));(Sn&124)!==0||PM(m,u,h)}v.memoizedState=h;var T={value:h,getSnapshot:u};return v.queue=T,XM(kM.bind(null,m,T,c),[c]),m.flags|=2048,wp(9,iC(),UM.bind(null,m,T,h,u),null),h},useId:function(){var c=Uo(),u=Rr.identifierPrefix;if(Vn){var h=Tl,m=Cl;h=(m&~(1<<32-mn(m)-1)).toString(32)+h,u=""+u+"R"+h,h=tC++,0<h&&(u+="H"+h.toString(32)),u+=""}else h=xie++,u=""+u+"r"+h.toString(32)+"";return c.memoizedState=u},useHostTransitionStatus:_O,useFormState:GM,useActionState:GM,useOptimistic:function(c){var u=Uo();u.memoizedState=u.baseState=c;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return u.queue=h,u=EO.bind(null,en,!0,h),h.dispatch=u,[c,u]},useMemoCache:lO,useCacheRefresh:function(){return Uo().memoizedState=Hie.bind(null,en)}},fF={readContext:$s,use:nC,useCallback:nF,useContext:$s,useEffect:JM,useImperativeHandle:tF,useInsertionEffect:$M,useLayoutEffect:ZM,useMemo:rF,useReducer:rC,useRef:YM,useState:function(){return rC(Il)},useDebugValue:pO,useDeferredValue:function(c,u){var h=ji();return iF(h,lr.memoizedState,c,u)},useTransition:function(){var c=rC(Il)[0],u=ji().memoizedState;return[typeof c=="boolean"?c:G_(c),u]},useSyncExternalStore:LM,useId:cF,useHostTransitionStatus:_O,useFormState:WM,useActionState:WM,useOptimistic:function(c,u){var h=ji();return FM(h,lr,c,u)},useMemoCache:lO,useCacheRefresh:AF},Kie={readContext:$s,use:nC,useCallback:nF,useContext:$s,useEffect:JM,useImperativeHandle:tF,useInsertionEffect:$M,useLayoutEffect:ZM,useMemo:rF,useReducer:dO,useRef:YM,useState:function(){return dO(Il)},useDebugValue:pO,useDeferredValue:function(c,u){var h=ji();return lr===null?mO(h,c,u):iF(h,lr.memoizedState,c,u)},useTransition:function(){var c=dO(Il)[0],u=ji().memoizedState;return[typeof c=="boolean"?c:G_(c),u]},useSyncExternalStore:LM,useId:cF,useHostTransitionStatus:_O,useFormState:qM,useActionState:qM,useOptimistic:function(c,u){var h=ji();return lr!==null?FM(h,lr,c,u):(h.baseState=c,[c,h.queue.dispatch])},useMemoCache:lO,useCacheRefresh:AF},Cp=null,q_=0;function cC(c){var u=q_;return q_+=1,Cp===null&&(Cp=[]),SM(Cp,c,u)}function Y_(c,u){u=u.props.ref,c.ref=u!==void 0?u:null}function AC(c,u){throw u.$$typeof===f?Error(r(525)):(c=Object.prototype.toString.call(u),Error(r(31,c==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":c)))}function pF(c){var u=c._init;return u(c._payload)}function mF(c){function u(Ae,oe){if(c){var de=Ae.deletions;de===null?(Ae.deletions=[oe],Ae.flags|=16):de.push(oe)}}function h(Ae,oe){if(!c)return null;for(;oe!==null;)u(Ae,oe),oe=oe.sibling;return null}function m(Ae){for(var oe=new Map;Ae!==null;)Ae.key!==null?oe.set(Ae.key,Ae):oe.set(Ae.index,Ae),Ae=Ae.sibling;return oe}function v(Ae,oe){return Ae=wl(Ae,oe),Ae.index=0,Ae.sibling=null,Ae}function T(Ae,oe,de){return Ae.index=de,c?(de=Ae.alternate,de!==null?(de=de.index,de<oe?(Ae.flags|=67108866,oe):de):(Ae.flags|=67108866,oe)):(Ae.flags|=1048576,oe)}function Q(Ae){return c&&Ae.alternate===null&&(Ae.flags|=67108866),Ae}function W(Ae,oe,de,Ie){return oe===null||oe.tag!==6?(oe=VR(de,Ae.mode,Ie),oe.return=Ae,oe):(oe=v(oe,de),oe.return=Ae,oe)}function ne(Ae,oe,de,Ie){var rt=de.type;return rt===y?Ce(Ae,oe,de.props.children,Ie,de.key):oe!==null&&(oe.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===V&&pF(rt)===oe.type)?(oe=v(oe,de.props),Y_(oe,de),oe.return=Ae,oe):(oe=Gw(de.type,de.key,de.props,null,Ae.mode,Ie),Y_(oe,de),oe.return=Ae,oe)}function he(Ae,oe,de,Ie){return oe===null||oe.tag!==4||oe.stateNode.containerInfo!==de.containerInfo||oe.stateNode.implementation!==de.implementation?(oe=QR(de,Ae.mode,Ie),oe.return=Ae,oe):(oe=v(oe,de.children||[]),oe.return=Ae,oe)}function Ce(Ae,oe,de,Ie,rt){return oe===null||oe.tag!==7?(oe=Bh(de,Ae.mode,Ie,rt),oe.return=Ae,oe):(oe=v(oe,de),oe.return=Ae,oe)}function Ne(Ae,oe,de){if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return oe=VR(""+oe,Ae.mode,de),oe.return=Ae,oe;if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case p:return de=Gw(oe.type,oe.key,oe.props,null,Ae.mode,de),Y_(de,oe),de.return=Ae,de;case g:return oe=QR(oe,Ae.mode,de),oe.return=Ae,oe;case V:var Ie=oe._init;return oe=Ie(oe._payload),Ne(Ae,oe,de)}if(fe(oe)||$(oe))return oe=Bh(oe,Ae.mode,de,null),oe.return=Ae,oe;if(typeof oe.then=="function")return Ne(Ae,cC(oe),de);if(oe.$$typeof===B)return Ne(Ae,Yw(Ae,oe),de);AC(Ae,oe)}return null}function pe(Ae,oe,de,Ie){var rt=oe!==null?oe.key:null;if(typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint")return rt!==null?null:W(Ae,oe,""+de,Ie);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case p:return de.key===rt?ne(Ae,oe,de,Ie):null;case g:return de.key===rt?he(Ae,oe,de,Ie):null;case V:return rt=de._init,de=rt(de._payload),pe(Ae,oe,de,Ie)}if(fe(de)||$(de))return rt!==null?null:Ce(Ae,oe,de,Ie,null);if(typeof de.then=="function")return pe(Ae,oe,cC(de),Ie);if(de.$$typeof===B)return pe(Ae,oe,Yw(Ae,de),Ie);AC(Ae,de)}return null}function me(Ae,oe,de,Ie,rt){if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return Ae=Ae.get(de)||null,W(oe,Ae,""+Ie,rt);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case p:return Ae=Ae.get(Ie.key===null?de:Ie.key)||null,ne(oe,Ae,Ie,rt);case g:return Ae=Ae.get(Ie.key===null?de:Ie.key)||null,he(oe,Ae,Ie,rt);case V:var an=Ie._init;return Ie=an(Ie._payload),me(Ae,oe,de,Ie,rt)}if(fe(Ie)||$(Ie))return Ae=Ae.get(de)||null,Ce(oe,Ae,Ie,rt,null);if(typeof Ie.then=="function")return me(Ae,oe,de,cC(Ie),rt);if(Ie.$$typeof===B)return me(Ae,oe,de,Yw(oe,Ie),rt);AC(oe,Ie)}return null}function Dt(Ae,oe,de,Ie){for(var rt=null,an=null,lt=oe,St=oe=0,ms=null;lt!==null&&St<de.length;St++){lt.index>St?(ms=lt,lt=null):ms=lt.sibling;var Un=pe(Ae,lt,de[St],Ie);if(Un===null){lt===null&&(lt=ms);break}c&&lt&&Un.alternate===null&&u(Ae,lt),oe=T(Un,oe,St),an===null?rt=Un:an.sibling=Un,an=Un,lt=ms}if(St===de.length)return h(Ae,lt),Vn&&Ph(Ae,St),rt;if(lt===null){for(;St<de.length;St++)lt=Ne(Ae,de[St],Ie),lt!==null&&(oe=T(lt,oe,St),an===null?rt=lt:an.sibling=lt,an=lt);return Vn&&Ph(Ae,St),rt}for(lt=m(lt);St<de.length;St++)ms=me(lt,Ae,St,de[St],Ie),ms!==null&&(c&&ms.alternate!==null&&lt.delete(ms.key===null?St:ms.key),oe=T(ms,oe,St),an===null?rt=ms:an.sibling=ms,an=ms);return c&&lt.forEach(function(Yu){return u(Ae,Yu)}),Vn&&Ph(Ae,St),rt}function wt(Ae,oe,de,Ie){if(de==null)throw Error(r(151));for(var rt=null,an=null,lt=oe,St=oe=0,ms=null,Un=de.next();lt!==null&&!Un.done;St++,Un=de.next()){lt.index>St?(ms=lt,lt=null):ms=lt.sibling;var Yu=pe(Ae,lt,Un.value,Ie);if(Yu===null){lt===null&&(lt=ms);break}c&&lt&&Yu.alternate===null&&u(Ae,lt),oe=T(Yu,oe,St),an===null?rt=Yu:an.sibling=Yu,an=Yu,lt=ms}if(Un.done)return h(Ae,lt),Vn&&Ph(Ae,St),rt;if(lt===null){for(;!Un.done;St++,Un=de.next())Un=Ne(Ae,Un.value,Ie),Un!==null&&(oe=T(Un,oe,St),an===null?rt=Un:an.sibling=Un,an=Un);return Vn&&Ph(Ae,St),rt}for(lt=m(lt);!Un.done;St++,Un=de.next())Un=me(lt,Ae,St,Un.value,Ie),Un!==null&&(c&&Un.alternate!==null&&lt.delete(Un.key===null?St:Un.key),oe=T(Un,oe,St),an===null?rt=Un:an.sibling=Un,an=Un);return c&&lt.forEach(function(Gse){return u(Ae,Gse)}),Vn&&Ph(Ae,St),rt}function dr(Ae,oe,de,Ie){if(typeof de=="object"&&de!==null&&de.type===y&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case p:e:{for(var rt=de.key;oe!==null;){if(oe.key===rt){if(rt=de.type,rt===y){if(oe.tag===7){h(Ae,oe.sibling),Ie=v(oe,de.props.children),Ie.return=Ae,Ae=Ie;break e}}else if(oe.elementType===rt||typeof rt=="object"&&rt!==null&&rt.$$typeof===V&&pF(rt)===oe.type){h(Ae,oe.sibling),Ie=v(oe,de.props),Y_(Ie,de),Ie.return=Ae,Ae=Ie;break e}h(Ae,oe);break}else u(Ae,oe);oe=oe.sibling}de.type===y?(Ie=Bh(de.props.children,Ae.mode,Ie,de.key),Ie.return=Ae,Ae=Ie):(Ie=Gw(de.type,de.key,de.props,null,Ae.mode,Ie),Y_(Ie,de),Ie.return=Ae,Ae=Ie)}return Q(Ae);case g:e:{for(rt=de.key;oe!==null;){if(oe.key===rt)if(oe.tag===4&&oe.stateNode.containerInfo===de.containerInfo&&oe.stateNode.implementation===de.implementation){h(Ae,oe.sibling),Ie=v(oe,de.children||[]),Ie.return=Ae,Ae=Ie;break e}else{h(Ae,oe);break}else u(Ae,oe);oe=oe.sibling}Ie=QR(de,Ae.mode,Ie),Ie.return=Ae,Ae=Ie}return Q(Ae);case V:return rt=de._init,de=rt(de._payload),dr(Ae,oe,de,Ie)}if(fe(de))return Dt(Ae,oe,de,Ie);if($(de)){if(rt=$(de),typeof rt!="function")throw Error(r(150));return de=rt.call(de),wt(Ae,oe,de,Ie)}if(typeof de.then=="function")return dr(Ae,oe,cC(de),Ie);if(de.$$typeof===B)return dr(Ae,oe,Yw(Ae,de),Ie);AC(Ae,de)}return typeof de=="string"&&de!==""||typeof de=="number"||typeof de=="bigint"?(de=""+de,oe!==null&&oe.tag===6?(h(Ae,oe.sibling),Ie=v(oe,de),Ie.return=Ae,Ae=Ie):(h(Ae,oe),Ie=VR(de,Ae.mode,Ie),Ie.return=Ae,Ae=Ie),Q(Ae)):h(Ae,oe)}return function(Ae,oe,de,Ie){try{q_=0;var rt=dr(Ae,oe,de,Ie);return Cp=null,rt}catch(lt){if(lt===F_||lt===Jw)throw lt;var an=ca(29,lt,null,Ae.mode);return an.lanes=Ie,an.return=Ae,an}finally{}}}var Tp=mF(!0),gF=mF(!1),ja=C(null),yA=null;function Pu(c){var u=c.alternate;k(ns,ns.current&1),k(ja,c),yA===null&&(u===null||Ep.current!==null||u.memoizedState!==null)&&(yA=c)}function _F(c){if(c.tag===22){if(k(ns,ns.current),k(ja,c),yA===null){var u=c.alternate;u!==null&&u.memoizedState!==null&&(yA=c)}}else Uu()}function Uu(){k(ns,ns.current),k(ja,ja.current)}function Rl(c){L(ja),yA===c&&(yA=null),L(ns)}var ns=C(0);function lC(c){for(var u=c;u!==null;){if(u.tag===13){var h=u.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||AN(h)))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===c)break;for(;u.sibling===null;){if(u.return===null||u.return===c)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}function yO(c,u,h,m){u=c.memoizedState,h=h(m,u),h=h==null?u:d({},u,h),c.memoizedState=h,c.lanes===0&&(c.updateQueue.baseState=h)}var vO={enqueueSetState:function(c,u,h){c=c._reactInternals;var m=da(),v=Du(m);v.payload=u,h!=null&&(v.callback=h),u=Bu(c,v,m),u!==null&&(ha(u,c,m),Q_(u,c,m))},enqueueReplaceState:function(c,u,h){c=c._reactInternals;var m=da(),v=Du(m);v.tag=1,v.payload=u,h!=null&&(v.callback=h),u=Bu(c,v,m),u!==null&&(ha(u,c,m),Q_(u,c,m))},enqueueForceUpdate:function(c,u){c=c._reactInternals;var h=da(),m=Du(h);m.tag=2,u!=null&&(m.callback=u),u=Bu(c,m,h),u!==null&&(ha(u,c,h),Q_(u,c,h))}};function EF(c,u,h,m,v,T,Q){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(m,T,Q):u.prototype&&u.prototype.isPureReactComponent?!D_(h,m)||!D_(v,T):!0}function yF(c,u,h,m){c=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(h,m),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(h,m),u.state!==c&&vO.enqueueReplaceState(u,u.state,null)}function Qh(c,u){var h=u;if("ref"in u){h={};for(var m in u)m!=="ref"&&(h[m]=u[m])}if(c=c.defaultProps){h===u&&(h=d({},h));for(var v in c)h[v]===void 0&&(h[v]=c[v])}return h}var uC=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var u=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(u))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)};function vF(c){uC(c)}function wF(c){console.error(c)}function CF(c){uC(c)}function dC(c,u){try{var h=c.onUncaughtError;h(u.value,{componentStack:u.stack})}catch(m){setTimeout(function(){throw m})}}function TF(c,u,h){try{var m=c.onCaughtError;m(h.value,{componentStack:h.stack,errorBoundary:u.tag===1?u.stateNode:null})}catch(v){setTimeout(function(){throw v})}}function wO(c,u,h){return h=Du(h),h.tag=3,h.payload={element:null},h.callback=function(){dC(c,u)},h}function SF(c){return c=Du(c),c.tag=3,c}function bF(c,u,h,m){var v=h.type.getDerivedStateFromError;if(typeof v=="function"){var T=m.value;c.payload=function(){return v(T)},c.callback=function(){TF(u,h,m)}}var Q=h.stateNode;Q!==null&&typeof Q.componentDidCatch=="function"&&(c.callback=function(){TF(u,h,m),typeof v!="function"&&(Qu===null?Qu=new Set([this]):Qu.add(this));var W=m.stack;this.componentDidCatch(m.value,{componentStack:W!==null?W:""})})}function Gie(c,u,h,m,v){if(h.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(u=h.alternate,u!==null&&k_(u,h,v,!0),h=ja.current,h!==null){switch(h.tag){case 13:return yA===null?WO():h.alternate===null&&ui===0&&(ui=3),h.flags&=-257,h.flags|=65536,h.lanes=v,m===JR?h.flags|=16384:(u=h.updateQueue,u===null?h.updateQueue=new Set([m]):u.add(m),qO(c,m,v)),!1;case 22:return h.flags|=65536,m===JR?h.flags|=16384:(u=h.updateQueue,u===null?(u={transitions:null,markerInstances:null,retryQueue:new Set([m])},h.updateQueue=u):(h=u.retryQueue,h===null?u.retryQueue=new Set([m]):h.add(m)),qO(c,m,v)),!1}throw Error(r(435,h.tag))}return qO(c,m,v),WO(),!1}if(Vn)return u=ja.current,u!==null?((u.flags&65536)===0&&(u.flags|=256),u.flags|=65536,u.lanes=v,m!==KR&&(c=Error(r(422),{cause:m}),U_(Fa(c,h)))):(m!==KR&&(u=Error(r(423),{cause:m}),U_(Fa(u,h))),c=c.current.alternate,c.flags|=65536,v&=-v,c.lanes|=v,m=Fa(m,h),v=wO(c.stateNode,m,v),eO(c,v),ui!==4&&(ui=2)),!1;var T=Error(r(520),{cause:m});if(T=Fa(T,h),nE===null?nE=[T]:nE.push(T),ui!==4&&(ui=2),u===null)return!0;m=Fa(m,h),h=u;do{switch(h.tag){case 3:return h.flags|=65536,c=v&-v,h.lanes|=c,c=wO(h.stateNode,m,c),eO(h,c),!1;case 1:if(u=h.type,T=h.stateNode,(h.flags&128)===0&&(typeof u.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(Qu===null||!Qu.has(T))))return h.flags|=65536,v&=-v,h.lanes|=v,v=SF(v),bF(v,c,h,m),eO(h,v),!1}h=h.return}while(h!==null);return!1}var IF=Error(r(461)),fs=!1;function Fs(c,u,h,m){u.child=c===null?gF(u,null,h,m):Tp(u,c.child,h,m)}function RF(c,u,h,m,v){h=h.render;var T=u.ref;if("ref"in m){var Q={};for(var W in m)W!=="ref"&&(Q[W]=m[W])}else Q=m;return Mh(u),m=sO(c,u,h,Q,T,v),W=oO(),c!==null&&!fs?(aO(c,u,v),Ol(c,u,v)):(Vn&&W&&HR(u),u.flags|=1,Fs(c,u,m,v),u.child)}function OF(c,u,h,m,v){if(c===null){var T=h.type;return typeof T=="function"&&!FR(T)&&T.defaultProps===void 0&&h.compare===null?(u.tag=15,u.type=T,NF(c,u,T,m,v)):(c=Gw(h.type,null,m,u,u.mode,v),c.ref=u.ref,c.return=u,u.child=c)}if(T=c.child,!NO(c,v)){var Q=T.memoizedProps;if(h=h.compare,h=h!==null?h:D_,h(Q,m)&&c.ref===u.ref)return Ol(c,u,v)}return u.flags|=1,c=wl(T,m),c.ref=u.ref,c.return=u,u.child=c}function NF(c,u,h,m,v){if(c!==null){var T=c.memoizedProps;if(D_(T,m)&&c.ref===u.ref)if(fs=!1,u.pendingProps=m=T,NO(c,v))(c.flags&131072)!==0&&(fs=!0);else return u.lanes=c.lanes,Ol(c,u,v)}return CO(c,u,h,m,v)}function DF(c,u,h){var m=u.pendingProps,v=m.children,T=c!==null?c.memoizedState:null;if(m.mode==="hidden"){if((u.flags&128)!==0){if(m=T!==null?T.baseLanes|h:h,c!==null){for(v=u.child=c.child,T=0;v!==null;)T=T|v.lanes|v.childLanes,v=v.sibling;u.childLanes=T&~m}else u.childLanes=0,u.child=null;return BF(c,u,m,h)}if((h&536870912)!==0)u.memoizedState={baseLanes:0,cachePool:null},c!==null&&Xw(u,T!==null?T.cachePool:null),T!==null?NM(u,T):nO(),_F(u);else return u.lanes=u.childLanes=536870912,BF(c,u,T!==null?T.baseLanes|h:h,h)}else T!==null?(Xw(u,T.cachePool),NM(u,T),Uu(),u.memoizedState=null):(c!==null&&Xw(u,null),nO(),Uu());return Fs(c,u,v,h),u.child}function BF(c,u,h,m){var v=XR();return v=v===null?null:{parent:ts._currentValue,pool:v},u.memoizedState={baseLanes:h,cachePool:v},c!==null&&Xw(u,null),nO(),_F(u),c!==null&&k_(c,u,m,!0),null}function hC(c,u){var h=u.ref;if(h===null)c!==null&&c.ref!==null&&(u.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(r(284));(c===null||c.ref!==h)&&(u.flags|=4194816)}}function CO(c,u,h,m,v){return Mh(u),h=sO(c,u,h,m,void 0,v),m=oO(),c!==null&&!fs?(aO(c,u,v),Ol(c,u,v)):(Vn&&m&&HR(u),u.flags|=1,Fs(c,u,h,v),u.child)}function LF(c,u,h,m,v,T){return Mh(u),u.updateQueue=null,h=BM(u,m,h,v),DM(c),m=oO(),c!==null&&!fs?(aO(c,u,T),Ol(c,u,T)):(Vn&&m&&HR(u),u.flags|=1,Fs(c,u,h,T),u.child)}function PF(c,u,h,m,v){if(Mh(u),u.stateNode===null){var T=fp,Q=h.contextType;typeof Q=="object"&&Q!==null&&(T=$s(Q)),T=new h(m,T),u.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=vO,u.stateNode=T,T._reactInternals=u,T=u.stateNode,T.props=m,T.state=u.memoizedState,T.refs={},$R(u),Q=h.contextType,T.context=typeof Q=="object"&&Q!==null?$s(Q):fp,T.state=u.memoizedState,Q=h.getDerivedStateFromProps,typeof Q=="function"&&(yO(u,h,Q,m),T.state=u.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(Q=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),Q!==T.state&&vO.enqueueReplaceState(T,T.state,null),j_(u,m,T,v),H_(),T.state=u.memoizedState),typeof T.componentDidMount=="function"&&(u.flags|=4194308),m=!0}else if(c===null){T=u.stateNode;var W=u.memoizedProps,ne=Qh(h,W);T.props=ne;var he=T.context,Ce=h.contextType;Q=fp,typeof Ce=="object"&&Ce!==null&&(Q=$s(Ce));var Ne=h.getDerivedStateFromProps;Ce=typeof Ne=="function"||typeof T.getSnapshotBeforeUpdate=="function",W=u.pendingProps!==W,Ce||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(W||he!==Q)&&yF(u,T,m,Q),Nu=!1;var pe=u.memoizedState;T.state=pe,j_(u,m,T,v),H_(),he=u.memoizedState,W||pe!==he||Nu?(typeof Ne=="function"&&(yO(u,h,Ne,m),he=u.memoizedState),(ne=Nu||EF(u,h,ne,m,pe,he,Q))?(Ce||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(u.flags|=4194308)):(typeof T.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=m,u.memoizedState=he),T.props=m,T.state=he,T.context=Q,m=ne):(typeof T.componentDidMount=="function"&&(u.flags|=4194308),m=!1)}else{T=u.stateNode,ZR(c,u),Q=u.memoizedProps,Ce=Qh(h,Q),T.props=Ce,Ne=u.pendingProps,pe=T.context,he=h.contextType,ne=fp,typeof he=="object"&&he!==null&&(ne=$s(he)),W=h.getDerivedStateFromProps,(he=typeof W=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(Q!==Ne||pe!==ne)&&yF(u,T,m,ne),Nu=!1,pe=u.memoizedState,T.state=pe,j_(u,m,T,v),H_();var me=u.memoizedState;Q!==Ne||pe!==me||Nu||c!==null&&c.dependencies!==null&&qw(c.dependencies)?(typeof W=="function"&&(yO(u,h,W,m),me=u.memoizedState),(Ce=Nu||EF(u,h,Ce,m,pe,me,ne)||c!==null&&c.dependencies!==null&&qw(c.dependencies))?(he||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(m,me,ne),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(m,me,ne)),typeof T.componentDidUpdate=="function"&&(u.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof T.componentDidUpdate!="function"||Q===c.memoizedProps&&pe===c.memoizedState||(u.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||Q===c.memoizedProps&&pe===c.memoizedState||(u.flags|=1024),u.memoizedProps=m,u.memoizedState=me),T.props=m,T.state=me,T.context=ne,m=Ce):(typeof T.componentDidUpdate!="function"||Q===c.memoizedProps&&pe===c.memoizedState||(u.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||Q===c.memoizedProps&&pe===c.memoizedState||(u.flags|=1024),m=!1)}return T=m,hC(c,u),m=(u.flags&128)!==0,T||m?(T=u.stateNode,h=m&&typeof h.getDerivedStateFromError!="function"?null:T.render(),u.flags|=1,c!==null&&m?(u.child=Tp(u,c.child,null,v),u.child=Tp(u,null,h,v)):Fs(c,u,h,v),u.memoizedState=T.state,c=u.child):c=Ol(c,u,v),c}function UF(c,u,h,m){return P_(),u.flags|=256,Fs(c,u,h,m),u.child}var TO={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function SO(c){return{baseLanes:c,cachePool:wM()}}function bO(c,u,h){return c=c!==null?c.childLanes&~h:0,u&&(c|=Ka),c}function kF(c,u,h){var m=u.pendingProps,v=!1,T=(u.flags&128)!==0,Q;if((Q=T)||(Q=c!==null&&c.memoizedState===null?!1:(ns.current&2)!==0),Q&&(v=!0,u.flags&=-129),Q=(u.flags&32)!==0,u.flags&=-33,c===null){if(Vn){if(v?Pu(u):Uu(),Vn){var W=li,ne;if(ne=W){e:{for(ne=W,W=EA;ne.nodeType!==8;){if(!W){W=null;break e}if(ne=Pc(ne.nextSibling),ne===null){W=null;break e}}W=ne}W!==null?(u.memoizedState={dehydrated:W,treeContext:Lh!==null?{id:Cl,overflow:Tl}:null,retryLane:536870912,hydrationErrors:null},ne=ca(18,null,null,0),ne.stateNode=W,ne.return=u,u.child=ne,yo=u,li=null,ne=!0):ne=!1}ne||kh(u)}if(W=u.memoizedState,W!==null&&(W=W.dehydrated,W!==null))return AN(W)?u.lanes=32:u.lanes=536870912,null;Rl(u)}return W=m.children,m=m.fallback,v?(Uu(),v=u.mode,W=fC({mode:"hidden",children:W},v),m=Bh(m,v,h,null),W.return=u,m.return=u,W.sibling=m,u.child=W,v=u.child,v.memoizedState=SO(h),v.childLanes=bO(c,Q,h),u.memoizedState=TO,m):(Pu(u),IO(u,W))}if(ne=c.memoizedState,ne!==null&&(W=ne.dehydrated,W!==null)){if(T)u.flags&256?(Pu(u),u.flags&=-257,u=RO(c,u,h)):u.memoizedState!==null?(Uu(),u.child=c.child,u.flags|=128,u=null):(Uu(),v=m.fallback,W=u.mode,m=fC({mode:"visible",children:m.children},W),v=Bh(v,W,h,null),v.flags|=2,m.return=u,v.return=u,m.sibling=v,u.child=m,Tp(u,c.child,null,h),m=u.child,m.memoizedState=SO(h),m.childLanes=bO(c,Q,h),u.memoizedState=TO,u=v);else if(Pu(u),AN(W)){if(Q=W.nextSibling&&W.nextSibling.dataset,Q)var he=Q.dgst;Q=he,m=Error(r(419)),m.stack="",m.digest=Q,U_({value:m,source:null,stack:null}),u=RO(c,u,h)}else if(fs||k_(c,u,h,!1),Q=(h&c.childLanes)!==0,fs||Q){if(Q=Rr,Q!==null&&(m=h&-h,m=(m&42)!==0?1:ra(m),m=(m&(Q.suspendedLanes|h))!==0?0:m,m!==0&&m!==ne.retryLane))throw ne.retryLane=m,hp(c,m),ha(Q,c,m),IF;W.data==="$?"||WO(),u=RO(c,u,h)}else W.data==="$?"?(u.flags|=192,u.child=c.child,u=null):(c=ne.treeContext,li=Pc(W.nextSibling),yo=u,Vn=!0,Uh=null,EA=!1,c!==null&&(Qa[Ha++]=Cl,Qa[Ha++]=Tl,Qa[Ha++]=Lh,Cl=c.id,Tl=c.overflow,Lh=u),u=IO(u,m.children),u.flags|=4096);return u}return v?(Uu(),v=m.fallback,W=u.mode,ne=c.child,he=ne.sibling,m=wl(ne,{mode:"hidden",children:m.children}),m.subtreeFlags=ne.subtreeFlags&65011712,he!==null?v=wl(he,v):(v=Bh(v,W,h,null),v.flags|=2),v.return=u,m.return=u,m.sibling=v,u.child=m,m=v,v=u.child,W=c.child.memoizedState,W===null?W=SO(h):(ne=W.cachePool,ne!==null?(he=ts._currentValue,ne=ne.parent!==he?{parent:he,pool:he}:ne):ne=wM(),W={baseLanes:W.baseLanes|h,cachePool:ne}),v.memoizedState=W,v.childLanes=bO(c,Q,h),u.memoizedState=TO,m):(Pu(u),h=c.child,c=h.sibling,h=wl(h,{mode:"visible",children:m.children}),h.return=u,h.sibling=null,c!==null&&(Q=u.deletions,Q===null?(u.deletions=[c],u.flags|=16):Q.push(c)),u.child=h,u.memoizedState=null,h)}function IO(c,u){return u=fC({mode:"visible",children:u},c.mode),u.return=c,c.child=u}function fC(c,u){return c=ca(22,c,null,u),c.lanes=0,c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},c}function RO(c,u,h){return Tp(u,c.child,null,h),c=IO(u,u.pendingProps.children),c.flags|=2,u.memoizedState=null,c}function xF(c,u,h){c.lanes|=u;var m=c.alternate;m!==null&&(m.lanes|=u),WR(c.return,u,h)}function OO(c,u,h,m,v){var T=c.memoizedState;T===null?c.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:m,tail:h,tailMode:v}:(T.isBackwards=u,T.rendering=null,T.renderingStartTime=0,T.last=m,T.tail=h,T.tailMode=v)}function MF(c,u,h){var m=u.pendingProps,v=m.revealOrder,T=m.tail;if(Fs(c,u,m.children,h),m=ns.current,(m&2)!==0)m=m&1|2,u.flags|=128;else{if(c!==null&&(c.flags&128)!==0)e:for(c=u.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&xF(c,h,u);else if(c.tag===19)xF(c,h,u);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===u)break e;for(;c.sibling===null;){if(c.return===null||c.return===u)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}m&=1}switch(k(ns,m),v){case"forwards":for(h=u.child,v=null;h!==null;)c=h.alternate,c!==null&&lC(c)===null&&(v=h),h=h.sibling;h=v,h===null?(v=u.child,u.child=null):(v=h.sibling,h.sibling=null),OO(u,!1,v,h,T);break;case"backwards":for(h=null,v=u.child,u.child=null;v!==null;){if(c=v.alternate,c!==null&&lC(c)===null){u.child=v;break}c=v.sibling,v.sibling=h,h=v,v=c}OO(u,!0,h,null,T);break;case"together":OO(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function Ol(c,u,h){if(c!==null&&(u.dependencies=c.dependencies),Vu|=u.lanes,(h&u.childLanes)===0)if(c!==null){if(k_(c,u,h,!1),(h&u.childLanes)===0)return null}else return null;if(c!==null&&u.child!==c.child)throw Error(r(153));if(u.child!==null){for(c=u.child,h=wl(c,c.pendingProps),u.child=h,h.return=u;c.sibling!==null;)c=c.sibling,h=h.sibling=wl(c,c.pendingProps),h.return=u;h.sibling=null}return u.child}function NO(c,u){return(c.lanes&u)!==0?!0:(c=c.dependencies,!!(c!==null&&qw(c)))}function Wie(c,u,h){switch(u.tag){case 3:Rt(u,u.stateNode.containerInfo),Ou(u,ts,c.memoizedState.cache),P_();break;case 27:case 5:Xi(u);break;case 4:Rt(u,u.stateNode.containerInfo);break;case 10:Ou(u,u.type,u.memoizedProps.value);break;case 13:var m=u.memoizedState;if(m!==null)return m.dehydrated!==null?(Pu(u),u.flags|=128,null):(h&u.child.childLanes)!==0?kF(c,u,h):(Pu(u),c=Ol(c,u,h),c!==null?c.sibling:null);Pu(u);break;case 19:var v=(c.flags&128)!==0;if(m=(h&u.childLanes)!==0,m||(k_(c,u,h,!1),m=(h&u.childLanes)!==0),v){if(m)return MF(c,u,h);u.flags|=128}if(v=u.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),k(ns,ns.current),m)break;return null;case 22:case 23:return u.lanes=0,DF(c,u,h);case 24:Ou(u,ts,c.memoizedState.cache)}return Ol(c,u,h)}function FF(c,u,h){if(c!==null)if(c.memoizedProps!==u.pendingProps)fs=!0;else{if(!NO(c,h)&&(u.flags&128)===0)return fs=!1,Wie(c,u,h);fs=(c.flags&131072)!==0}else fs=!1,Vn&&(u.flags&1048576)!==0&&pM(u,zw,u.index);switch(u.lanes=0,u.tag){case 16:e:{c=u.pendingProps;var m=u.elementType,v=m._init;if(m=v(m._payload),u.type=m,typeof m=="function")FR(m)?(c=Qh(m,c),u.tag=1,u=PF(null,u,m,c,h)):(u.tag=0,u=CO(null,u,m,c,h));else{if(m!=null){if(v=m.$$typeof,v===U){u.tag=11,u=RF(null,u,m,c,h);break e}else if(v===x){u.tag=14,u=OF(null,u,m,c,h);break e}}throw u=Ue(m)||m,Error(r(306,u,""))}}return u;case 0:return CO(c,u,u.type,u.pendingProps,h);case 1:return m=u.type,v=Qh(m,u.pendingProps),PF(c,u,m,v,h);case 3:e:{if(Rt(u,u.stateNode.containerInfo),c===null)throw Error(r(387));m=u.pendingProps;var T=u.memoizedState;v=T.element,ZR(c,u),j_(u,m,null,h);var Q=u.memoizedState;if(m=Q.cache,Ou(u,ts,m),m!==T.cache&&zR(u,[ts],h,!0),H_(),m=Q.element,T.isDehydrated)if(T={element:m,isDehydrated:!1,cache:Q.cache},u.updateQueue.baseState=T,u.memoizedState=T,u.flags&256){u=UF(c,u,m,h);break e}else if(m!==v){v=Fa(Error(r(424)),u),U_(v),u=UF(c,u,m,h);break e}else{switch(c=u.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(li=Pc(c.firstChild),yo=u,Vn=!0,Uh=null,EA=!0,h=gF(u,null,m,h),u.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling}else{if(P_(),m===v){u=Ol(c,u,h);break e}Fs(c,u,m,h)}u=u.child}return u;case 26:return hC(c,u),c===null?(h=jV(u.type,null,u.pendingProps,null))?u.memoizedState=h:Vn||(h=u.type,c=u.pendingProps,m=RC(ke.current).createElement(h),m[Vi]=u,m[bi]=c,Qs(m,h,c),qr(m),u.stateNode=m):u.memoizedState=jV(u.type,c.memoizedProps,u.pendingProps,c.memoizedState),null;case 27:return Xi(u),c===null&&Vn&&(m=u.stateNode=VV(u.type,u.pendingProps,ke.current),yo=u,EA=!0,v=li,Ku(u.type)?(lN=v,li=Pc(m.firstChild)):li=v),Fs(c,u,u.pendingProps.children,h),hC(c,u),c===null&&(u.flags|=4194304),u.child;case 5:return c===null&&Vn&&((v=m=li)&&(m=yse(m,u.type,u.pendingProps,EA),m!==null?(u.stateNode=m,yo=u,li=Pc(m.firstChild),EA=!1,v=!0):v=!1),v||kh(u)),Xi(u),v=u.type,T=u.pendingProps,Q=c!==null?c.memoizedProps:null,m=T.children,oN(v,T)?m=null:Q!==null&&oN(v,Q)&&(u.flags|=32),u.memoizedState!==null&&(v=sO(c,u,Mie,null,null,h),uE._currentValue=v),hC(c,u),Fs(c,u,m,h),u.child;case 6:return c===null&&Vn&&((c=h=li)&&(h=vse(h,u.pendingProps,EA),h!==null?(u.stateNode=h,yo=u,li=null,c=!0):c=!1),c||kh(u)),null;case 13:return kF(c,u,h);case 4:return Rt(u,u.stateNode.containerInfo),m=u.pendingProps,c===null?u.child=Tp(u,null,m,h):Fs(c,u,m,h),u.child;case 11:return RF(c,u,u.type,u.pendingProps,h);case 7:return Fs(c,u,u.pendingProps,h),u.child;case 8:return Fs(c,u,u.pendingProps.children,h),u.child;case 12:return Fs(c,u,u.pendingProps.children,h),u.child;case 10:return m=u.pendingProps,Ou(u,u.type,m.value),Fs(c,u,m.children,h),u.child;case 9:return v=u.type._context,m=u.pendingProps.children,Mh(u),v=$s(v),m=m(v),u.flags|=1,Fs(c,u,m,h),u.child;case 14:return OF(c,u,u.type,u.pendingProps,h);case 15:return NF(c,u,u.type,u.pendingProps,h);case 19:return MF(c,u,h);case 31:return m=u.pendingProps,h=u.mode,m={mode:m.mode,children:m.children},c===null?(h=fC(m,h),h.ref=u.ref,u.child=h,h.return=u,u=h):(h=wl(c.child,m),h.ref=u.ref,u.child=h,h.return=u,u=h),u;case 22:return DF(c,u,h);case 24:return Mh(u),m=$s(ts),c===null?(v=XR(),v===null&&(v=Rr,T=qR(),v.pooledCache=T,T.refCount++,T!==null&&(v.pooledCacheLanes|=h),v=T),u.memoizedState={parent:m,cache:v},$R(u),Ou(u,ts,v)):((c.lanes&h)!==0&&(ZR(c,u),j_(u,null,null,h),H_()),v=c.memoizedState,T=u.memoizedState,v.parent!==m?(v={parent:m,cache:m},u.memoizedState=v,u.lanes===0&&(u.memoizedState=u.updateQueue.baseState=v),Ou(u,ts,m)):(m=T.cache,Ou(u,ts,m),m!==v.cache&&zR(u,[ts],h,!0))),Fs(c,u,u.pendingProps.children,h),u.child;case 29:throw u.pendingProps}throw Error(r(156,u.tag))}function Nl(c){c.flags|=4}function VF(c,u){if(u.type!=="stylesheet"||(u.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!qV(u)){if(u=ja.current,u!==null&&((Sn&4194048)===Sn?yA!==null:(Sn&62914560)!==Sn&&(Sn&536870912)===0||u!==yA))throw V_=JR,CM;c.flags|=8192}}function pC(c,u){u!==null&&(c.flags|=4),c.flags&16384&&(u=c.tag!==22?Tu():536870912,c.lanes|=u,Rp|=u)}function X_(c,u){if(!Vn)switch(c.tailMode){case"hidden":u=c.tail;for(var h=null;u!==null;)u.alternate!==null&&(h=u),u=u.sibling;h===null?c.tail=null:h.sibling=null;break;case"collapsed":h=c.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?u||c.tail===null?c.tail=null:c.tail.sibling=null:m.sibling=null}}function Yr(c){var u=c.alternate!==null&&c.alternate.child===c.child,h=0,m=0;if(u)for(var v=c.child;v!==null;)h|=v.lanes|v.childLanes,m|=v.subtreeFlags&65011712,m|=v.flags&65011712,v.return=c,v=v.sibling;else for(v=c.child;v!==null;)h|=v.lanes|v.childLanes,m|=v.subtreeFlags,m|=v.flags,v.return=c,v=v.sibling;return c.subtreeFlags|=m,c.childLanes=h,u}function zie(c,u,h){var m=u.pendingProps;switch(jR(u),u.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Yr(u),null;case 1:return Yr(u),null;case 3:return h=u.stateNode,m=null,c!==null&&(m=c.memoizedState.cache),u.memoizedState.cache!==m&&(u.flags|=2048),bl(ts),Gr(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(c===null||c.child===null)&&(L_(u)?Nl(u):c===null||c.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,_M())),Yr(u),null;case 26:return h=u.memoizedState,c===null?(Nl(u),h!==null?(Yr(u),VF(u,h)):(Yr(u),u.flags&=-16777217)):h?h!==c.memoizedState?(Nl(u),Yr(u),VF(u,h)):(Yr(u),u.flags&=-16777217):(c.memoizedProps!==m&&Nl(u),Yr(u),u.flags&=-16777217),null;case 27:Ls(u),h=ke.current;var v=u.type;if(c!==null&&u.stateNode!=null)c.memoizedProps!==m&&Nl(u);else{if(!m){if(u.stateNode===null)throw Error(r(166));return Yr(u),null}c=ee.current,L_(u)?mM(u):(c=VV(v,m,h),u.stateNode=c,Nl(u))}return Yr(u),null;case 5:if(Ls(u),h=u.type,c!==null&&u.stateNode!=null)c.memoizedProps!==m&&Nl(u);else{if(!m){if(u.stateNode===null)throw Error(r(166));return Yr(u),null}if(c=ee.current,L_(u))mM(u);else{switch(v=RC(ke.current),c){case 1:c=v.createElementNS("http://www.w3.org/2000/svg",h);break;case 2:c=v.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;default:switch(h){case"svg":c=v.createElementNS("http://www.w3.org/2000/svg",h);break;case"math":c=v.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;case"script":c=v.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild);break;case"select":c=typeof m.is=="string"?v.createElement("select",{is:m.is}):v.createElement("select"),m.multiple?c.multiple=!0:m.size&&(c.size=m.size);break;default:c=typeof m.is=="string"?v.createElement(h,{is:m.is}):v.createElement(h)}}c[Vi]=u,c[bi]=m;e:for(v=u.child;v!==null;){if(v.tag===5||v.tag===6)c.appendChild(v.stateNode);else if(v.tag!==4&&v.tag!==27&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===u)break e;for(;v.sibling===null;){if(v.return===null||v.return===u)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}u.stateNode=c;e:switch(Qs(c,h,m),h){case"button":case"input":case"select":case"textarea":c=!!m.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&Nl(u)}}return Yr(u),u.flags&=-16777217,null;case 6:if(c&&u.stateNode!=null)c.memoizedProps!==m&&Nl(u);else{if(typeof m!="string"&&u.stateNode===null)throw Error(r(166));if(c=ke.current,L_(u)){if(c=u.stateNode,h=u.memoizedProps,m=null,v=yo,v!==null)switch(v.tag){case 27:case 5:m=v.memoizedProps}c[Vi]=u,c=!!(c.nodeValue===h||m!==null&&m.suppressHydrationWarning===!0||LV(c.nodeValue,h)),c||kh(u)}else c=RC(c).createTextNode(m),c[Vi]=u,u.stateNode=c}return Yr(u),null;case 13:if(m=u.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(v=L_(u),m!==null&&m.dehydrated!==null){if(c===null){if(!v)throw Error(r(318));if(v=u.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(r(317));v[Vi]=u}else P_(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;Yr(u),v=!1}else v=_M(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=v),v=!0;if(!v)return u.flags&256?(Rl(u),u):(Rl(u),null)}if(Rl(u),(u.flags&128)!==0)return u.lanes=h,u;if(h=m!==null,c=c!==null&&c.memoizedState!==null,h){m=u.child,v=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(v=m.alternate.memoizedState.cachePool.pool);var T=null;m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(T=m.memoizedState.cachePool.pool),T!==v&&(m.flags|=2048)}return h!==c&&h&&(u.child.flags|=8192),pC(u,u.updateQueue),Yr(u),null;case 4:return Gr(),c===null&&tN(u.stateNode.containerInfo),Yr(u),null;case 10:return bl(u.type),Yr(u),null;case 19:if(L(ns),v=u.memoizedState,v===null)return Yr(u),null;if(m=(u.flags&128)!==0,T=v.rendering,T===null)if(m)X_(v,!1);else{if(ui!==0||c!==null&&(c.flags&128)!==0)for(c=u.child;c!==null;){if(T=lC(c),T!==null){for(u.flags|=128,X_(v,!1),c=T.updateQueue,u.updateQueue=c,pC(u,c),u.subtreeFlags=0,c=h,h=u.child;h!==null;)fM(h,c),h=h.sibling;return k(ns,ns.current&1|2),u.child}c=c.sibling}v.tail!==null&&pt()>_C&&(u.flags|=128,m=!0,X_(v,!1),u.lanes=4194304)}else{if(!m)if(c=lC(T),c!==null){if(u.flags|=128,m=!0,c=c.updateQueue,u.updateQueue=c,pC(u,c),X_(v,!0),v.tail===null&&v.tailMode==="hidden"&&!T.alternate&&!Vn)return Yr(u),null}else 2*pt()-v.renderingStartTime>_C&&h!==536870912&&(u.flags|=128,m=!0,X_(v,!1),u.lanes=4194304);v.isBackwards?(T.sibling=u.child,u.child=T):(c=v.last,c!==null?c.sibling=T:u.child=T,v.last=T)}return v.tail!==null?(u=v.tail,v.rendering=u,v.tail=u.sibling,v.renderingStartTime=pt(),u.sibling=null,c=ns.current,k(ns,m?c&1|2:c&1),u):(Yr(u),null);case 22:case 23:return Rl(u),rO(),m=u.memoizedState!==null,c!==null?c.memoizedState!==null!==m&&(u.flags|=8192):m&&(u.flags|=8192),m?(h&536870912)!==0&&(u.flags&128)===0&&(Yr(u),u.subtreeFlags&6&&(u.flags|=8192)):Yr(u),h=u.updateQueue,h!==null&&pC(u,h.retryQueue),h=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(h=c.memoizedState.cachePool.pool),m=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(m=u.memoizedState.cachePool.pool),m!==h&&(u.flags|=2048),c!==null&&L(Fh),null;case 24:return h=null,c!==null&&(h=c.memoizedState.cache),u.memoizedState.cache!==h&&(u.flags|=2048),bl(ts),Yr(u),null;case 25:return null;case 30:return null}throw Error(r(156,u.tag))}function qie(c,u){switch(jR(u),u.tag){case 1:return c=u.flags,c&65536?(u.flags=c&-65537|128,u):null;case 3:return bl(ts),Gr(),c=u.flags,(c&65536)!==0&&(c&128)===0?(u.flags=c&-65537|128,u):null;case 26:case 27:case 5:return Ls(u),null;case 13:if(Rl(u),c=u.memoizedState,c!==null&&c.dehydrated!==null){if(u.alternate===null)throw Error(r(340));P_()}return c=u.flags,c&65536?(u.flags=c&-65537|128,u):null;case 19:return L(ns),null;case 4:return Gr(),null;case 10:return bl(u.type),null;case 22:case 23:return Rl(u),rO(),c!==null&&L(Fh),c=u.flags,c&65536?(u.flags=c&-65537|128,u):null;case 24:return bl(ts),null;case 25:return null;default:return null}}function QF(c,u){switch(jR(u),u.tag){case 3:bl(ts),Gr();break;case 26:case 27:case 5:Ls(u);break;case 4:Gr();break;case 13:Rl(u);break;case 19:L(ns);break;case 10:bl(u.type);break;case 22:case 23:Rl(u),rO(),c!==null&&L(Fh);break;case 24:bl(ts)}}function J_(c,u){try{var h=u.updateQueue,m=h!==null?h.lastEffect:null;if(m!==null){var v=m.next;h=v;do{if((h.tag&c)===c){m=void 0;var T=h.create,Q=h.inst;m=T(),Q.destroy=m}h=h.next}while(h!==v)}}catch(W){_r(u,u.return,W)}}function ku(c,u,h){try{var m=u.updateQueue,v=m!==null?m.lastEffect:null;if(v!==null){var T=v.next;m=T;do{if((m.tag&c)===c){var Q=m.inst,W=Q.destroy;if(W!==void 0){Q.destroy=void 0,v=u;var ne=h,he=W;try{he()}catch(Ce){_r(v,ne,Ce)}}}m=m.next}while(m!==T)}}catch(Ce){_r(u,u.return,Ce)}}function HF(c){var u=c.updateQueue;if(u!==null){var h=c.stateNode;try{OM(u,h)}catch(m){_r(c,c.return,m)}}}function jF(c,u,h){h.props=Qh(c.type,c.memoizedProps),h.state=c.memoizedState;try{h.componentWillUnmount()}catch(m){_r(c,u,m)}}function $_(c,u){try{var h=c.ref;if(h!==null){switch(c.tag){case 26:case 27:case 5:var m=c.stateNode;break;case 30:m=c.stateNode;break;default:m=c.stateNode}typeof h=="function"?c.refCleanup=h(m):h.current=m}}catch(v){_r(c,u,v)}}function vA(c,u){var h=c.ref,m=c.refCleanup;if(h!==null)if(typeof m=="function")try{m()}catch(v){_r(c,u,v)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(v){_r(c,u,v)}else h.current=null}function KF(c){var u=c.type,h=c.memoizedProps,m=c.stateNode;try{e:switch(u){case"button":case"input":case"select":case"textarea":h.autoFocus&&m.focus();break e;case"img":h.src?m.src=h.src:h.srcSet&&(m.srcset=h.srcSet)}}catch(v){_r(c,c.return,v)}}function DO(c,u,h){try{var m=c.stateNode;pse(m,c.type,h,u),m[bi]=u}catch(v){_r(c,c.return,v)}}function GF(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&Ku(c.type)||c.tag===4}function BO(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||GF(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&Ku(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function LO(c,u,h){var m=c.tag;if(m===5||m===6)c=c.stateNode,u?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(c,u):(u=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,u.appendChild(c),h=h._reactRootContainer,h!=null||u.onclick!==null||(u.onclick=IC));else if(m!==4&&(m===27&&Ku(c.type)&&(h=c.stateNode,u=null),c=c.child,c!==null))for(LO(c,u,h),c=c.sibling;c!==null;)LO(c,u,h),c=c.sibling}function mC(c,u,h){var m=c.tag;if(m===5||m===6)c=c.stateNode,u?h.insertBefore(c,u):h.appendChild(c);else if(m!==4&&(m===27&&Ku(c.type)&&(h=c.stateNode),c=c.child,c!==null))for(mC(c,u,h),c=c.sibling;c!==null;)mC(c,u,h),c=c.sibling}function WF(c){var u=c.stateNode,h=c.memoizedProps;try{for(var m=c.type,v=u.attributes;v.length;)u.removeAttributeNode(v[0]);Qs(u,m,h),u[Vi]=c,u[bi]=h}catch(T){_r(c,c.return,T)}}var Dl=!1,Ni=!1,PO=!1,zF=typeof WeakSet=="function"?WeakSet:Set,ps=null;function Yie(c,u){if(c=c.containerInfo,iN=PC,c=iM(c),BR(c)){if("selectionStart"in c)var h={start:c.selectionStart,end:c.selectionEnd};else e:{h=(h=c.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&m.rangeCount!==0){h=m.anchorNode;var v=m.anchorOffset,T=m.focusNode;m=m.focusOffset;try{h.nodeType,T.nodeType}catch{h=null;break e}var Q=0,W=-1,ne=-1,he=0,Ce=0,Ne=c,pe=null;t:for(;;){for(var me;Ne!==h||v!==0&&Ne.nodeType!==3||(W=Q+v),Ne!==T||m!==0&&Ne.nodeType!==3||(ne=Q+m),Ne.nodeType===3&&(Q+=Ne.nodeValue.length),(me=Ne.firstChild)!==null;)pe=Ne,Ne=me;for(;;){if(Ne===c)break t;if(pe===h&&++he===v&&(W=Q),pe===T&&++Ce===m&&(ne=Q),(me=Ne.nextSibling)!==null)break;Ne=pe,pe=Ne.parentNode}Ne=me}h=W===-1||ne===-1?null:{start:W,end:ne}}else h=null}h=h||{start:0,end:0}}else h=null;for(sN={focusedElem:c,selectionRange:h},PC=!1,ps=u;ps!==null;)if(u=ps,c=u.child,(u.subtreeFlags&1024)!==0&&c!==null)c.return=u,ps=c;else for(;ps!==null;){switch(u=ps,T=u.alternate,c=u.flags,u.tag){case 0:break;case 11:case 15:break;case 1:if((c&1024)!==0&&T!==null){c=void 0,h=u,v=T.memoizedProps,T=T.memoizedState,m=h.stateNode;try{var Dt=Qh(h.type,v,h.elementType===h.type);c=m.getSnapshotBeforeUpdate(Dt,T),m.__reactInternalSnapshotBeforeUpdate=c}catch(wt){_r(h,h.return,wt)}}break;case 3:if((c&1024)!==0){if(c=u.stateNode.containerInfo,h=c.nodeType,h===9)cN(c);else if(h===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":cN(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(r(163))}if(c=u.sibling,c!==null){c.return=u.return,ps=c;break}ps=u.return}}function qF(c,u,h){var m=h.flags;switch(h.tag){case 0:case 11:case 15:xu(c,h),m&4&&J_(5,h);break;case 1:if(xu(c,h),m&4)if(c=h.stateNode,u===null)try{c.componentDidMount()}catch(Q){_r(h,h.return,Q)}else{var v=Qh(h.type,u.memoizedProps);u=u.memoizedState;try{c.componentDidUpdate(v,u,c.__reactInternalSnapshotBeforeUpdate)}catch(Q){_r(h,h.return,Q)}}m&64&&HF(h),m&512&&$_(h,h.return);break;case 3:if(xu(c,h),m&64&&(c=h.updateQueue,c!==null)){if(u=null,h.child!==null)switch(h.child.tag){case 27:case 5:u=h.child.stateNode;break;case 1:u=h.child.stateNode}try{OM(c,u)}catch(Q){_r(h,h.return,Q)}}break;case 27:u===null&&m&4&&WF(h);case 26:case 5:xu(c,h),u===null&&m&4&&KF(h),m&512&&$_(h,h.return);break;case 12:xu(c,h);break;case 13:xu(c,h),m&4&&JF(c,h),m&64&&(c=h.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(h=ise.bind(null,h),wse(c,h))));break;case 22:if(m=h.memoizedState!==null||Dl,!m){u=u!==null&&u.memoizedState!==null||Ni,v=Dl;var T=Ni;Dl=m,(Ni=u)&&!T?Mu(c,h,(h.subtreeFlags&8772)!==0):xu(c,h),Dl=v,Ni=T}break;case 30:break;default:xu(c,h)}}function YF(c){var u=c.alternate;u!==null&&(c.alternate=null,YF(u)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(u=c.stateNode,u!==null&&ia(u)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var Mr=null,ko=!1;function Bl(c,u,h){for(h=h.child;h!==null;)XF(c,u,h),h=h.sibling}function XF(c,u,h){if(et&&typeof et.onCommitFiberUnmount=="function")try{et.onCommitFiberUnmount($e,h)}catch{}switch(h.tag){case 26:Ni||vA(h,u),Bl(c,u,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:Ni||vA(h,u);var m=Mr,v=ko;Ku(h.type)&&(Mr=h.stateNode,ko=!1),Bl(c,u,h),aE(h.stateNode),Mr=m,ko=v;break;case 5:Ni||vA(h,u);case 6:if(m=Mr,v=ko,Mr=null,Bl(c,u,h),Mr=m,ko=v,Mr!==null)if(ko)try{(Mr.nodeType===9?Mr.body:Mr.nodeName==="HTML"?Mr.ownerDocument.body:Mr).removeChild(h.stateNode)}catch(T){_r(h,u,T)}else try{Mr.removeChild(h.stateNode)}catch(T){_r(h,u,T)}break;case 18:Mr!==null&&(ko?(c=Mr,MV(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,h.stateNode),pE(c)):MV(Mr,h.stateNode));break;case 4:m=Mr,v=ko,Mr=h.stateNode.containerInfo,ko=!0,Bl(c,u,h),Mr=m,ko=v;break;case 0:case 11:case 14:case 15:Ni||ku(2,h,u),Ni||ku(4,h,u),Bl(c,u,h);break;case 1:Ni||(vA(h,u),m=h.stateNode,typeof m.componentWillUnmount=="function"&&jF(h,u,m)),Bl(c,u,h);break;case 21:Bl(c,u,h);break;case 22:Ni=(m=Ni)||h.memoizedState!==null,Bl(c,u,h),Ni=m;break;default:Bl(c,u,h)}}function JF(c,u){if(u.memoizedState===null&&(c=u.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{pE(c)}catch(h){_r(u,u.return,h)}}function Xie(c){switch(c.tag){case 13:case 19:var u=c.stateNode;return u===null&&(u=c.stateNode=new zF),u;case 22:return c=c.stateNode,u=c._retryCache,u===null&&(u=c._retryCache=new zF),u;default:throw Error(r(435,c.tag))}}function UO(c,u){var h=Xie(c);u.forEach(function(m){var v=sse.bind(null,c,m);h.has(m)||(h.add(m),m.then(v,v))})}function Aa(c,u){var h=u.deletions;if(h!==null)for(var m=0;m<h.length;m++){var v=h[m],T=c,Q=u,W=Q;e:for(;W!==null;){switch(W.tag){case 27:if(Ku(W.type)){Mr=W.stateNode,ko=!1;break e}break;case 5:Mr=W.stateNode,ko=!1;break e;case 3:case 4:Mr=W.stateNode.containerInfo,ko=!0;break e}W=W.return}if(Mr===null)throw Error(r(160));XF(T,Q,v),Mr=null,ko=!1,T=v.alternate,T!==null&&(T.return=null),v.return=null}if(u.subtreeFlags&13878)for(u=u.child;u!==null;)$F(u,c),u=u.sibling}var Lc=null;function $F(c,u){var h=c.alternate,m=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:Aa(u,c),la(c),m&4&&(ku(3,c,c.return),J_(3,c),ku(5,c,c.return));break;case 1:Aa(u,c),la(c),m&512&&(Ni||h===null||vA(h,h.return)),m&64&&Dl&&(c=c.updateQueue,c!==null&&(m=c.callbacks,m!==null&&(h=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=h===null?m:h.concat(m))));break;case 26:var v=Lc;if(Aa(u,c),la(c),m&512&&(Ni||h===null||vA(h,h.return)),m&4){var T=h!==null?h.memoizedState:null;if(m=c.memoizedState,h===null)if(m===null)if(c.stateNode===null){e:{m=c.type,h=c.memoizedProps,v=v.ownerDocument||v;t:switch(m){case"title":T=v.getElementsByTagName("title")[0],(!T||T[Oc]||T[Vi]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=v.createElement(m),v.head.insertBefore(T,v.querySelector("head > title"))),Qs(T,m,h),T[Vi]=c,qr(T),m=T;break e;case"link":var Q=WV("link","href",v).get(m+(h.href||""));if(Q){for(var W=0;W<Q.length;W++)if(T=Q[W],T.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&T.getAttribute("rel")===(h.rel==null?null:h.rel)&&T.getAttribute("title")===(h.title==null?null:h.title)&&T.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){Q.splice(W,1);break t}}T=v.createElement(m),Qs(T,m,h),v.head.appendChild(T);break;case"meta":if(Q=WV("meta","content",v).get(m+(h.content||""))){for(W=0;W<Q.length;W++)if(T=Q[W],T.getAttribute("content")===(h.content==null?null:""+h.content)&&T.getAttribute("name")===(h.name==null?null:h.name)&&T.getAttribute("property")===(h.property==null?null:h.property)&&T.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&T.getAttribute("charset")===(h.charSet==null?null:h.charSet)){Q.splice(W,1);break t}}T=v.createElement(m),Qs(T,m,h),v.head.appendChild(T);break;default:throw Error(r(468,m))}T[Vi]=c,qr(T),m=T}c.stateNode=m}else zV(v,c.type,c.stateNode);else c.stateNode=GV(v,m,c.memoizedProps);else T!==m?(T===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):T.count--,m===null?zV(v,c.type,c.stateNode):GV(v,m,c.memoizedProps)):m===null&&c.stateNode!==null&&DO(c,c.memoizedProps,h.memoizedProps)}break;case 27:Aa(u,c),la(c),m&512&&(Ni||h===null||vA(h,h.return)),h!==null&&m&4&&DO(c,c.memoizedProps,h.memoizedProps);break;case 5:if(Aa(u,c),la(c),m&512&&(Ni||h===null||vA(h,h.return)),c.flags&32){v=c.stateNode;try{Bo(v,"")}catch(me){_r(c,c.return,me)}}m&4&&c.stateNode!=null&&(v=c.memoizedProps,DO(c,v,h!==null?h.memoizedProps:v)),m&1024&&(PO=!0);break;case 6:if(Aa(u,c),la(c),m&4){if(c.stateNode===null)throw Error(r(162));m=c.memoizedProps,h=c.stateNode;try{h.nodeValue=m}catch(me){_r(c,c.return,me)}}break;case 3:if(DC=null,v=Lc,Lc=OC(u.containerInfo),Aa(u,c),Lc=v,la(c),m&4&&h!==null&&h.memoizedState.isDehydrated)try{pE(u.containerInfo)}catch(me){_r(c,c.return,me)}PO&&(PO=!1,ZF(c));break;case 4:m=Lc,Lc=OC(c.stateNode.containerInfo),Aa(u,c),la(c),Lc=m;break;case 12:Aa(u,c),la(c);break;case 13:Aa(u,c),la(c),c.child.flags&8192&&c.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(QO=pt()),m&4&&(m=c.updateQueue,m!==null&&(c.updateQueue=null,UO(c,m)));break;case 22:v=c.memoizedState!==null;var ne=h!==null&&h.memoizedState!==null,he=Dl,Ce=Ni;if(Dl=he||v,Ni=Ce||ne,Aa(u,c),Ni=Ce,Dl=he,la(c),m&8192)e:for(u=c.stateNode,u._visibility=v?u._visibility&-2:u._visibility|1,v&&(h===null||ne||Dl||Ni||Hh(c)),h=null,u=c;;){if(u.tag===5||u.tag===26){if(h===null){ne=h=u;try{if(T=ne.stateNode,v)Q=T.style,typeof Q.setProperty=="function"?Q.setProperty("display","none","important"):Q.display="none";else{W=ne.stateNode;var Ne=ne.memoizedProps.style,pe=Ne!=null&&Ne.hasOwnProperty("display")?Ne.display:null;W.style.display=pe==null||typeof pe=="boolean"?"":(""+pe).trim()}}catch(me){_r(ne,ne.return,me)}}}else if(u.tag===6){if(h===null){ne=u;try{ne.stateNode.nodeValue=v?"":ne.memoizedProps}catch(me){_r(ne,ne.return,me)}}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===c)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===c)break e;for(;u.sibling===null;){if(u.return===null||u.return===c)break e;h===u&&(h=null),u=u.return}h===u&&(h=null),u.sibling.return=u.return,u=u.sibling}m&4&&(m=c.updateQueue,m!==null&&(h=m.retryQueue,h!==null&&(m.retryQueue=null,UO(c,h))));break;case 19:Aa(u,c),la(c),m&4&&(m=c.updateQueue,m!==null&&(c.updateQueue=null,UO(c,m)));break;case 30:break;case 21:break;default:Aa(u,c),la(c)}}function la(c){var u=c.flags;if(u&2){try{for(var h,m=c.return;m!==null;){if(GF(m)){h=m;break}m=m.return}if(h==null)throw Error(r(160));switch(h.tag){case 27:var v=h.stateNode,T=BO(c);mC(c,T,v);break;case 5:var Q=h.stateNode;h.flags&32&&(Bo(Q,""),h.flags&=-33);var W=BO(c);mC(c,W,Q);break;case 3:case 4:var ne=h.stateNode.containerInfo,he=BO(c);LO(c,he,ne);break;default:throw Error(r(161))}}catch(Ce){_r(c,c.return,Ce)}c.flags&=-3}u&4096&&(c.flags&=-4097)}function ZF(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var u=c;ZF(u),u.tag===5&&u.flags&1024&&u.stateNode.reset(),c=c.sibling}}function xu(c,u){if(u.subtreeFlags&8772)for(u=u.child;u!==null;)qF(c,u.alternate,u),u=u.sibling}function Hh(c){for(c=c.child;c!==null;){var u=c;switch(u.tag){case 0:case 11:case 14:case 15:ku(4,u,u.return),Hh(u);break;case 1:vA(u,u.return);var h=u.stateNode;typeof h.componentWillUnmount=="function"&&jF(u,u.return,h),Hh(u);break;case 27:aE(u.stateNode);case 26:case 5:vA(u,u.return),Hh(u);break;case 22:u.memoizedState===null&&Hh(u);break;case 30:Hh(u);break;default:Hh(u)}c=c.sibling}}function Mu(c,u,h){for(h=h&&(u.subtreeFlags&8772)!==0,u=u.child;u!==null;){var m=u.alternate,v=c,T=u,Q=T.flags;switch(T.tag){case 0:case 11:case 15:Mu(v,T,h),J_(4,T);break;case 1:if(Mu(v,T,h),m=T,v=m.stateNode,typeof v.componentDidMount=="function")try{v.componentDidMount()}catch(he){_r(m,m.return,he)}if(m=T,v=m.updateQueue,v!==null){var W=m.stateNode;try{var ne=v.shared.hiddenCallbacks;if(ne!==null)for(v.shared.hiddenCallbacks=null,v=0;v<ne.length;v++)RM(ne[v],W)}catch(he){_r(m,m.return,he)}}h&&Q&64&&HF(T),$_(T,T.return);break;case 27:WF(T);case 26:case 5:Mu(v,T,h),h&&m===null&&Q&4&&KF(T),$_(T,T.return);break;case 12:Mu(v,T,h);break;case 13:Mu(v,T,h),h&&Q&4&&JF(v,T);break;case 22:T.memoizedState===null&&Mu(v,T,h),$_(T,T.return);break;case 30:break;default:Mu(v,T,h)}u=u.sibling}}function kO(c,u){var h=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(h=c.memoizedState.cachePool.pool),c=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(c=u.memoizedState.cachePool.pool),c!==h&&(c!=null&&c.refCount++,h!=null&&x_(h))}function xO(c,u){c=null,u.alternate!==null&&(c=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==c&&(u.refCount++,c!=null&&x_(c))}function wA(c,u,h,m){if(u.subtreeFlags&10256)for(u=u.child;u!==null;)eV(c,u,h,m),u=u.sibling}function eV(c,u,h,m){var v=u.flags;switch(u.tag){case 0:case 11:case 15:wA(c,u,h,m),v&2048&&J_(9,u);break;case 1:wA(c,u,h,m);break;case 3:wA(c,u,h,m),v&2048&&(c=null,u.alternate!==null&&(c=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==c&&(u.refCount++,c!=null&&x_(c)));break;case 12:if(v&2048){wA(c,u,h,m),c=u.stateNode;try{var T=u.memoizedProps,Q=T.id,W=T.onPostCommit;typeof W=="function"&&W(Q,u.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(ne){_r(u,u.return,ne)}}else wA(c,u,h,m);break;case 13:wA(c,u,h,m);break;case 23:break;case 22:T=u.stateNode,Q=u.alternate,u.memoizedState!==null?T._visibility&2?wA(c,u,h,m):Z_(c,u):T._visibility&2?wA(c,u,h,m):(T._visibility|=2,Sp(c,u,h,m,(u.subtreeFlags&10256)!==0)),v&2048&&kO(Q,u);break;case 24:wA(c,u,h,m),v&2048&&xO(u.alternate,u);break;default:wA(c,u,h,m)}}function Sp(c,u,h,m,v){for(v=v&&(u.subtreeFlags&10256)!==0,u=u.child;u!==null;){var T=c,Q=u,W=h,ne=m,he=Q.flags;switch(Q.tag){case 0:case 11:case 15:Sp(T,Q,W,ne,v),J_(8,Q);break;case 23:break;case 22:var Ce=Q.stateNode;Q.memoizedState!==null?Ce._visibility&2?Sp(T,Q,W,ne,v):Z_(T,Q):(Ce._visibility|=2,Sp(T,Q,W,ne,v)),v&&he&2048&&kO(Q.alternate,Q);break;case 24:Sp(T,Q,W,ne,v),v&&he&2048&&xO(Q.alternate,Q);break;default:Sp(T,Q,W,ne,v)}u=u.sibling}}function Z_(c,u){if(u.subtreeFlags&10256)for(u=u.child;u!==null;){var h=c,m=u,v=m.flags;switch(m.tag){case 22:Z_(h,m),v&2048&&kO(m.alternate,m);break;case 24:Z_(h,m),v&2048&&xO(m.alternate,m);break;default:Z_(h,m)}u=u.sibling}}var eE=8192;function bp(c){if(c.subtreeFlags&eE)for(c=c.child;c!==null;)tV(c),c=c.sibling}function tV(c){switch(c.tag){case 26:bp(c),c.flags&eE&&c.memoizedState!==null&&Use(Lc,c.memoizedState,c.memoizedProps);break;case 5:bp(c);break;case 3:case 4:var u=Lc;Lc=OC(c.stateNode.containerInfo),bp(c),Lc=u;break;case 22:c.memoizedState===null&&(u=c.alternate,u!==null&&u.memoizedState!==null?(u=eE,eE=16777216,bp(c),eE=u):bp(c));break;default:bp(c)}}function nV(c){var u=c.alternate;if(u!==null&&(c=u.child,c!==null)){u.child=null;do u=c.sibling,c.sibling=null,c=u;while(c!==null)}}function tE(c){var u=c.deletions;if((c.flags&16)!==0){if(u!==null)for(var h=0;h<u.length;h++){var m=u[h];ps=m,iV(m,c)}nV(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)rV(c),c=c.sibling}function rV(c){switch(c.tag){case 0:case 11:case 15:tE(c),c.flags&2048&&ku(9,c,c.return);break;case 3:tE(c);break;case 12:tE(c);break;case 22:var u=c.stateNode;c.memoizedState!==null&&u._visibility&2&&(c.return===null||c.return.tag!==13)?(u._visibility&=-3,gC(c)):tE(c);break;default:tE(c)}}function gC(c){var u=c.deletions;if((c.flags&16)!==0){if(u!==null)for(var h=0;h<u.length;h++){var m=u[h];ps=m,iV(m,c)}nV(c)}for(c=c.child;c!==null;){switch(u=c,u.tag){case 0:case 11:case 15:ku(8,u,u.return),gC(u);break;case 22:h=u.stateNode,h._visibility&2&&(h._visibility&=-3,gC(u));break;default:gC(u)}c=c.sibling}}function iV(c,u){for(;ps!==null;){var h=ps;switch(h.tag){case 0:case 11:case 15:ku(8,h,u);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var m=h.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:x_(h.memoizedState.cache)}if(m=h.child,m!==null)m.return=h,ps=m;else e:for(h=c;ps!==null;){m=ps;var v=m.sibling,T=m.return;if(YF(m),m===h){ps=null;break e}if(v!==null){v.return=T,ps=v;break e}ps=T}}}var Jie={getCacheForType:function(c){var u=$s(ts),h=u.data.get(c);return h===void 0&&(h=c(),u.data.set(c,h)),h}},$ie=typeof WeakMap=="function"?WeakMap:Map,tr=0,Rr=null,dn=null,Sn=0,nr=0,ua=null,Fu=!1,Ip=!1,MO=!1,Ll=0,ui=0,Vu=0,jh=0,FO=0,Ka=0,Rp=0,nE=null,xo=null,VO=!1,QO=0,_C=1/0,EC=null,Qu=null,Vs=0,Hu=null,Op=null,Np=0,HO=0,jO=null,sV=null,rE=0,KO=null;function da(){if((tr&2)!==0&&Sn!==0)return Sn&-Sn;if(re.T!==null){var c=gp;return c!==0?c:JO()}return aA()}function oV(){Ka===0&&(Ka=(Sn&536870912)===0||Vn?Cu():536870912);var c=ja.current;return c!==null&&(c.flags|=32),Ka}function ha(c,u,h){(c===Rr&&(nr===2||nr===9)||c.cancelPendingCommit!==null)&&(Dp(c,0),ju(c,Sn,Ka,!1)),Ic(c,h),((tr&2)===0||c!==Rr)&&(c===Rr&&((tr&2)===0&&(jh|=h),ui===4&&ju(c,Sn,Ka,!1)),CA(c))}function aV(c,u,h){if((tr&6)!==0)throw Error(r(327));var m=!h&&(u&124)===0&&(u&c.expiredLanes)===0||bc(c,u),v=m?tse(c,u):zO(c,u,!0),T=m;do{if(v===0){Ip&&!m&&ju(c,u,0,!1);break}else{if(h=c.current.alternate,T&&!Zie(h)){v=zO(c,u,!1),T=!1;continue}if(v===2){if(T=u,c.errorRecoveryDisabledLanes&T)var Q=0;else Q=c.pendingLanes&-536870913,Q=Q!==0?Q:Q&536870912?536870912:0;if(Q!==0){u=Q;e:{var W=c;v=nE;var ne=W.current.memoizedState.isDehydrated;if(ne&&(Dp(W,Q).flags|=256),Q=zO(W,Q,!1),Q!==2){if(MO&&!ne){W.errorRecoveryDisabledLanes|=T,jh|=T,v=4;break e}T=xo,xo=v,T!==null&&(xo===null?xo=T:xo.push.apply(xo,T))}v=Q}if(T=!1,v!==2)continue}}if(v===1){Dp(c,0),ju(c,u,0,!0);break}e:{switch(m=c,T=v,T){case 0:case 1:throw Error(r(345));case 4:if((u&4194048)!==u)break;case 6:ju(m,u,Ka,!Fu);break e;case 2:xo=null;break;case 3:case 5:break;default:throw Error(r(329))}if((u&62914560)===u&&(v=QO+300-pt(),10<v)){if(ju(m,u,Ka,!Fu),Us(m,0,!0)!==0)break e;m.timeoutHandle=kV(cV.bind(null,m,h,xo,EC,VO,u,Ka,jh,Rp,Fu,T,2,-0,0),v);break e}cV(m,h,xo,EC,VO,u,Ka,jh,Rp,Fu,T,0,-0,0)}}break}while(!0);CA(c)}function cV(c,u,h,m,v,T,Q,W,ne,he,Ce,Ne,pe,me){if(c.timeoutHandle=-1,Ne=u.subtreeFlags,(Ne&8192||(Ne&16785408)===16785408)&&(lE={stylesheets:null,count:0,unsuspend:Pse},tV(u),Ne=kse(),Ne!==null)){c.cancelPendingCommit=Ne(pV.bind(null,c,u,T,h,m,v,Q,W,ne,Ce,1,pe,me)),ju(c,T,Q,!he);return}pV(c,u,T,h,m,v,Q,W,ne)}function Zie(c){for(var u=c;;){var h=u.tag;if((h===0||h===11||h===15)&&u.flags&16384&&(h=u.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var m=0;m<h.length;m++){var v=h[m],T=v.getSnapshot;v=v.value;try{if(!aa(T(),v))return!1}catch{return!1}}if(h=u.child,u.subtreeFlags&16384&&h!==null)h.return=u,u=h;else{if(u===c)break;for(;u.sibling===null;){if(u.return===null||u.return===c)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function ju(c,u,h,m){u&=~FO,u&=~jh,c.suspendedLanes|=u,c.pingedLanes&=~u,m&&(c.warmLanes|=u),m=c.expirationTimes;for(var v=u;0<v;){var T=31-mn(v),Q=1<<T;m[T]=-1,v&=~Q}h!==0&&Pa(c,h,u)}function yC(){return(tr&6)===0?(iE(0),!1):!0}function GO(){if(dn!==null){if(nr===0)var c=dn.return;else c=dn,Sl=xh=null,cO(c),Cp=null,q_=0,c=dn;for(;c!==null;)QF(c.alternate,c),c=c.return;dn=null}}function Dp(c,u){var h=c.timeoutHandle;h!==-1&&(c.timeoutHandle=-1,gse(h)),h=c.cancelPendingCommit,h!==null&&(c.cancelPendingCommit=null,h()),GO(),Rr=c,dn=h=wl(c.current,null),Sn=u,nr=0,ua=null,Fu=!1,Ip=bc(c,u),MO=!1,Rp=Ka=FO=jh=Vu=ui=0,xo=nE=null,VO=!1,(u&8)!==0&&(u|=u&32);var m=c.entangledLanes;if(m!==0)for(c=c.entanglements,m&=u;0<m;){var v=31-mn(m),T=1<<v;u|=c[v],m&=~T}return Ll=u,Hw(),h}function AV(c,u){en=null,re.H=aC,u===F_||u===Jw?(u=bM(),nr=3):u===CM?(u=bM(),nr=4):nr=u===IF?8:u!==null&&typeof u=="object"&&typeof u.then=="function"?6:1,ua=u,dn===null&&(ui=1,dC(c,Fa(u,c.current)))}function lV(){var c=re.H;return re.H=aC,c===null?aC:c}function uV(){var c=re.A;return re.A=Jie,c}function WO(){ui=4,Fu||(Sn&4194048)!==Sn&&ja.current!==null||(Ip=!0),(Vu&134217727)===0&&(jh&134217727)===0||Rr===null||ju(Rr,Sn,Ka,!1)}function zO(c,u,h){var m=tr;tr|=2;var v=lV(),T=uV();(Rr!==c||Sn!==u)&&(EC=null,Dp(c,u)),u=!1;var Q=ui;e:do try{if(nr!==0&&dn!==null){var W=dn,ne=ua;switch(nr){case 8:GO(),Q=6;break e;case 3:case 2:case 9:case 6:ja.current===null&&(u=!0);var he=nr;if(nr=0,ua=null,Bp(c,W,ne,he),h&&Ip){Q=0;break e}break;default:he=nr,nr=0,ua=null,Bp(c,W,ne,he)}}ese(),Q=ui;break}catch(Ce){AV(c,Ce)}while(!0);return u&&c.shellSuspendCounter++,Sl=xh=null,tr=m,re.H=v,re.A=T,dn===null&&(Rr=null,Sn=0,Hw()),Q}function ese(){for(;dn!==null;)dV(dn)}function tse(c,u){var h=tr;tr|=2;var m=lV(),v=uV();Rr!==c||Sn!==u?(EC=null,_C=pt()+500,Dp(c,u)):Ip=bc(c,u);e:do try{if(nr!==0&&dn!==null){u=dn;var T=ua;t:switch(nr){case 1:nr=0,ua=null,Bp(c,u,T,1);break;case 2:case 9:if(TM(T)){nr=0,ua=null,hV(u);break}u=function(){nr!==2&&nr!==9||Rr!==c||(nr=7),CA(c)},T.then(u,u);break e;case 3:nr=7;break e;case 4:nr=5;break e;case 7:TM(T)?(nr=0,ua=null,hV(u)):(nr=0,ua=null,Bp(c,u,T,7));break;case 5:var Q=null;switch(dn.tag){case 26:Q=dn.memoizedState;case 5:case 27:var W=dn;if(!Q||qV(Q)){nr=0,ua=null;var ne=W.sibling;if(ne!==null)dn=ne;else{var he=W.return;he!==null?(dn=he,vC(he)):dn=null}break t}}nr=0,ua=null,Bp(c,u,T,5);break;case 6:nr=0,ua=null,Bp(c,u,T,6);break;case 8:GO(),ui=6;break e;default:throw Error(r(462))}}nse();break}catch(Ce){AV(c,Ce)}while(!0);return Sl=xh=null,re.H=m,re.A=v,tr=h,dn!==null?0:(Rr=null,Sn=0,Hw(),ui)}function nse(){for(;dn!==null&&!qt();)dV(dn)}function dV(c){var u=FF(c.alternate,c,Ll);c.memoizedProps=c.pendingProps,u===null?vC(c):dn=u}function hV(c){var u=c,h=u.alternate;switch(u.tag){case 15:case 0:u=LF(h,u,u.pendingProps,u.type,void 0,Sn);break;case 11:u=LF(h,u,u.pendingProps,u.type.render,u.ref,Sn);break;case 5:cO(u);default:QF(h,u),u=dn=fM(u,Ll),u=FF(h,u,Ll)}c.memoizedProps=c.pendingProps,u===null?vC(c):dn=u}function Bp(c,u,h,m){Sl=xh=null,cO(u),Cp=null,q_=0;var v=u.return;try{if(Gie(c,v,u,h,Sn)){ui=1,dC(c,Fa(h,c.current)),dn=null;return}}catch(T){if(v!==null)throw dn=v,T;ui=1,dC(c,Fa(h,c.current)),dn=null;return}u.flags&32768?(Vn||m===1?c=!0:Ip||(Sn&536870912)!==0?c=!1:(Fu=c=!0,(m===2||m===9||m===3||m===6)&&(m=ja.current,m!==null&&m.tag===13&&(m.flags|=16384))),fV(u,c)):vC(u)}function vC(c){var u=c;do{if((u.flags&32768)!==0){fV(u,Fu);return}c=u.return;var h=zie(u.alternate,u,Ll);if(h!==null){dn=h;return}if(u=u.sibling,u!==null){dn=u;return}dn=u=c}while(u!==null);ui===0&&(ui=5)}function fV(c,u){do{var h=qie(c.alternate,c);if(h!==null){h.flags&=32767,dn=h;return}if(h=c.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!u&&(c=c.sibling,c!==null)){dn=c;return}dn=c=h}while(c!==null);ui=6,dn=null}function pV(c,u,h,m,v,T,Q,W,ne){c.cancelPendingCommit=null;do wC();while(Vs!==0);if((tr&6)!==0)throw Error(r(327));if(u!==null){if(u===c.current)throw Error(r(177));if(T=u.lanes|u.childLanes,T|=xR,tp(c,h,T,Q,W,ne),c===Rr&&(dn=Rr=null,Sn=0),Op=u,Hu=c,Np=h,HO=T,jO=v,sV=m,(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,ose(at,function(){return yV(),null})):(c.callbackNode=null,c.callbackPriority=0),m=(u.flags&13878)!==0,(u.subtreeFlags&13878)!==0||m){m=re.T,re.T=null,v=Y.p,Y.p=2,Q=tr,tr|=4;try{Yie(c,u,h)}finally{tr=Q,Y.p=v,re.T=m}}Vs=1,mV(),gV(),_V()}}function mV(){if(Vs===1){Vs=0;var c=Hu,u=Op,h=(u.flags&13878)!==0;if((u.subtreeFlags&13878)!==0||h){h=re.T,re.T=null;var m=Y.p;Y.p=2;var v=tr;tr|=4;try{$F(u,c);var T=sN,Q=iM(c.containerInfo),W=T.focusedElem,ne=T.selectionRange;if(Q!==W&&W&&W.ownerDocument&&rM(W.ownerDocument.documentElement,W)){if(ne!==null&&BR(W)){var he=ne.start,Ce=ne.end;if(Ce===void 0&&(Ce=he),"selectionStart"in W)W.selectionStart=he,W.selectionEnd=Math.min(Ce,W.value.length);else{var Ne=W.ownerDocument||document,pe=Ne&&Ne.defaultView||window;if(pe.getSelection){var me=pe.getSelection(),Dt=W.textContent.length,wt=Math.min(ne.start,Dt),dr=ne.end===void 0?wt:Math.min(ne.end,Dt);!me.extend&&wt>dr&&(Q=dr,dr=wt,wt=Q);var Ae=nM(W,wt),oe=nM(W,dr);if(Ae&&oe&&(me.rangeCount!==1||me.anchorNode!==Ae.node||me.anchorOffset!==Ae.offset||me.focusNode!==oe.node||me.focusOffset!==oe.offset)){var de=Ne.createRange();de.setStart(Ae.node,Ae.offset),me.removeAllRanges(),wt>dr?(me.addRange(de),me.extend(oe.node,oe.offset)):(de.setEnd(oe.node,oe.offset),me.addRange(de))}}}}for(Ne=[],me=W;me=me.parentNode;)me.nodeType===1&&Ne.push({element:me,left:me.scrollLeft,top:me.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<Ne.length;W++){var Ie=Ne[W];Ie.element.scrollLeft=Ie.left,Ie.element.scrollTop=Ie.top}}PC=!!iN,sN=iN=null}finally{tr=v,Y.p=m,re.T=h}}c.current=u,Vs=2}}function gV(){if(Vs===2){Vs=0;var c=Hu,u=Op,h=(u.flags&8772)!==0;if((u.subtreeFlags&8772)!==0||h){h=re.T,re.T=null;var m=Y.p;Y.p=2;var v=tr;tr|=4;try{qF(c,u.alternate,u)}finally{tr=v,Y.p=m,re.T=h}}Vs=3}}function _V(){if(Vs===4||Vs===3){Vs=0,$t();var c=Hu,u=Op,h=Np,m=sV;(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?Vs=5:(Vs=0,Op=Hu=null,EV(c,c.pendingLanes));var v=c.pendingLanes;if(v===0&&(Qu=null),fh(h),u=u.stateNode,et&&typeof et.onCommitFiberRoot=="function")try{et.onCommitFiberRoot($e,u,void 0,(u.current.flags&128)===128)}catch{}if(m!==null){u=re.T,v=Y.p,Y.p=2,re.T=null;try{for(var T=c.onRecoverableError,Q=0;Q<m.length;Q++){var W=m[Q];T(W.value,{componentStack:W.stack})}}finally{re.T=u,Y.p=v}}(Np&3)!==0&&wC(),CA(c),v=c.pendingLanes,(h&4194090)!==0&&(v&42)!==0?c===KO?rE++:(rE=0,KO=c):rE=0,iE(0)}}function EV(c,u){(c.pooledCacheLanes&=u)===0&&(u=c.pooledCache,u!=null&&(c.pooledCache=null,x_(u)))}function wC(c){return mV(),gV(),_V(),yV()}function yV(){if(Vs!==5)return!1;var c=Hu,u=HO;HO=0;var h=fh(Np),m=re.T,v=Y.p;try{Y.p=32>h?32:h,re.T=null,h=jO,jO=null;var T=Hu,Q=Np;if(Vs=0,Op=Hu=null,Np=0,(tr&6)!==0)throw Error(r(331));var W=tr;if(tr|=4,rV(T.current),eV(T,T.current,Q,h),tr=W,iE(0,!1),et&&typeof et.onPostCommitFiberRoot=="function")try{et.onPostCommitFiberRoot($e,T)}catch{}return!0}finally{Y.p=v,re.T=m,EV(c,u)}}function vV(c,u,h){u=Fa(h,u),u=wO(c.stateNode,u,2),c=Bu(c,u,2),c!==null&&(Ic(c,2),CA(c))}function _r(c,u,h){if(c.tag===3)vV(c,c,h);else for(;u!==null;){if(u.tag===3){vV(u,c,h);break}else if(u.tag===1){var m=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Qu===null||!Qu.has(m))){c=Fa(h,c),h=SF(2),m=Bu(u,h,2),m!==null&&(bF(h,m,u,c),Ic(m,2),CA(m));break}}u=u.return}}function qO(c,u,h){var m=c.pingCache;if(m===null){m=c.pingCache=new $ie;var v=new Set;m.set(u,v)}else v=m.get(u),v===void 0&&(v=new Set,m.set(u,v));v.has(h)||(MO=!0,v.add(h),c=rse.bind(null,c,u,h),u.then(c,c))}function rse(c,u,h){var m=c.pingCache;m!==null&&m.delete(u),c.pingedLanes|=c.suspendedLanes&h,c.warmLanes&=~h,Rr===c&&(Sn&h)===h&&(ui===4||ui===3&&(Sn&62914560)===Sn&&300>pt()-QO?(tr&2)===0&&Dp(c,0):FO|=h,Rp===Sn&&(Rp=0)),CA(c)}function wV(c,u){u===0&&(u=Tu()),c=hp(c,u),c!==null&&(Ic(c,u),CA(c))}function ise(c){var u=c.memoizedState,h=0;u!==null&&(h=u.retryLane),wV(c,h)}function sse(c,u){var h=0;switch(c.tag){case 13:var m=c.stateNode,v=c.memoizedState;v!==null&&(h=v.retryLane);break;case 19:m=c.stateNode;break;case 22:m=c.stateNode._retryCache;break;default:throw Error(r(314))}m!==null&&m.delete(u),wV(c,h)}function ose(c,u){return Wr(c,u)}var CC=null,Lp=null,YO=!1,TC=!1,XO=!1,Kh=0;function CA(c){c!==Lp&&c.next===null&&(Lp===null?CC=Lp=c:Lp=Lp.next=c),TC=!0,YO||(YO=!0,cse())}function iE(c,u){if(!XO&&TC){XO=!0;do for(var h=!1,m=CC;m!==null;){if(c!==0){var v=m.pendingLanes;if(v===0)var T=0;else{var Q=m.suspendedLanes,W=m.pingedLanes;T=(1<<31-mn(42|c)+1)-1,T&=v&~(Q&~W),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(h=!0,bV(m,T))}else T=Sn,T=Us(m,m===Rr?T:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(T&3)===0||bc(m,T)||(h=!0,bV(m,T));m=m.next}while(h);XO=!1}}function ase(){CV()}function CV(){TC=YO=!1;var c=0;Kh!==0&&(mse()&&(c=Kh),Kh=0);for(var u=pt(),h=null,m=CC;m!==null;){var v=m.next,T=TV(m,u);T===0?(m.next=null,h===null?CC=v:h.next=v,v===null&&(Lp=h)):(h=m,(c!==0||(T&3)!==0)&&(TC=!0)),m=v}iE(c)}function TV(c,u){for(var h=c.suspendedLanes,m=c.pingedLanes,v=c.expirationTimes,T=c.pendingLanes&-62914561;0<T;){var Q=31-mn(T),W=1<<Q,ne=v[Q];ne===-1?((W&h)===0||(W&m)!==0)&&(v[Q]=sA(W,u)):ne<=u&&(c.expiredLanes|=W),T&=~W}if(u=Rr,h=Sn,h=Us(c,c===u?h:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),m=c.callbackNode,h===0||c===u&&(nr===2||nr===9)||c.cancelPendingCommit!==null)return m!==null&&m!==null&&kr(m),c.callbackNode=null,c.callbackPriority=0;if((h&3)===0||bc(c,h)){if(u=h&-h,u===c.callbackPriority)return u;switch(m!==null&&kr(m),fh(h)){case 2:case 8:h=Kt;break;case 32:h=at;break;case 268435456:h=xe;break;default:h=at}return m=SV.bind(null,c),h=Wr(h,m),c.callbackPriority=u,c.callbackNode=h,u}return m!==null&&m!==null&&kr(m),c.callbackPriority=2,c.callbackNode=null,2}function SV(c,u){if(Vs!==0&&Vs!==5)return c.callbackNode=null,c.callbackPriority=0,null;var h=c.callbackNode;if(wC()&&c.callbackNode!==h)return null;var m=Sn;return m=Us(c,c===Rr?m:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),m===0?null:(aV(c,m,u),TV(c,pt()),c.callbackNode!=null&&c.callbackNode===h?SV.bind(null,c):null)}function bV(c,u){if(wC())return null;aV(c,u,!0)}function cse(){_se(function(){(tr&6)!==0?Wr(br,ase):CV()})}function JO(){return Kh===0&&(Kh=Cu()),Kh}function IV(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:Ru(""+c)}function RV(c,u){var h=u.ownerDocument.createElement("input");return h.name=u.name,h.value=u.value,c.id&&h.setAttribute("form",c.id),u.parentNode.insertBefore(h,u),c=new FormData(c),h.parentNode.removeChild(h),c}function Ase(c,u,h,m,v){if(u==="submit"&&h&&h.stateNode===v){var T=IV((v[bi]||null).action),Q=m.submitter;Q&&(u=(u=Q[bi]||null)?IV(u.formAction):Q.getAttribute("formAction"),u!==null&&(T=u,Q=null));var W=new xs("action","action",null,m,v);c.push({event:W,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Kh!==0){var ne=Q?RV(v,Q):new FormData(v);gO(h,{pending:!0,data:ne,method:v.method,action:T},null,ne)}}else typeof T=="function"&&(W.preventDefault(),ne=Q?RV(v,Q):new FormData(v),gO(h,{pending:!0,data:ne,method:v.method,action:T},T,ne))},currentTarget:v}]})}}for(var $O=0;$O<kR.length;$O++){var ZO=kR[$O],lse=ZO.toLowerCase(),use=ZO[0].toUpperCase()+ZO.slice(1);Bc(lse,"on"+use)}Bc(aM,"onAnimationEnd"),Bc(cM,"onAnimationIteration"),Bc(AM,"onAnimationStart"),Bc("dblclick","onDoubleClick"),Bc("focusin","onFocus"),Bc("focusout","onBlur"),Bc(Rie,"onTransitionRun"),Bc(Oie,"onTransitionStart"),Bc(Nie,"onTransitionCancel"),Bc(lM,"onTransitionEnd"),mo("onMouseEnter",["mouseout","mouseover"]),mo("onMouseLeave",["mouseout","mouseover"]),mo("onPointerEnter",["pointerout","pointerover"]),mo("onPointerLeave",["pointerout","pointerover"]),ks("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ks("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ks("onBeforeInput",["compositionend","keypress","textInput","paste"]),ks("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ks("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ks("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sE="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dse=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(sE));function OV(c,u){u=(u&4)!==0;for(var h=0;h<c.length;h++){var m=c[h],v=m.event;m=m.listeners;e:{var T=void 0;if(u)for(var Q=m.length-1;0<=Q;Q--){var W=m[Q],ne=W.instance,he=W.currentTarget;if(W=W.listener,ne!==T&&v.isPropagationStopped())break e;T=W,v.currentTarget=he;try{T(v)}catch(Ce){uC(Ce)}v.currentTarget=null,T=ne}else for(Q=0;Q<m.length;Q++){if(W=m[Q],ne=W.instance,he=W.currentTarget,W=W.listener,ne!==T&&v.isPropagationStopped())break e;T=W,v.currentTarget=he;try{T(v)}catch(Ce){uC(Ce)}v.currentTarget=null,T=ne}}}}function hn(c,u){var h=u[ph];h===void 0&&(h=u[ph]=new Set);var m=c+"__bubble";h.has(m)||(NV(u,c,2,!1),h.add(m))}function eN(c,u,h){var m=0;u&&(m|=4),NV(h,c,m,u)}var SC="_reactListening"+Math.random().toString(36).slice(2);function tN(c){if(!c[SC]){c[SC]=!0,mh.forEach(function(h){h!=="selectionchange"&&(dse.has(h)||eN(h,!1,c),eN(h,!0,c))});var u=c.nodeType===9?c:c.ownerDocument;u===null||u[SC]||(u[SC]=!0,eN("selectionchange",!1,u))}}function NV(c,u,h,m){switch(e4(u)){case 2:var v=Fse;break;case 8:v=Vse;break;default:v=pN}h=v.bind(null,u,h,c),v=void 0,!ce||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(v=!0),m?v!==void 0?c.addEventListener(u,h,{capture:!0,passive:v}):c.addEventListener(u,h,!0):v!==void 0?c.addEventListener(u,h,{passive:v}):c.addEventListener(u,h,!1)}function nN(c,u,h,m,v){var T=m;if((u&1)===0&&(u&2)===0&&m!==null)e:for(;;){if(m===null)return;var Q=m.tag;if(Q===3||Q===4){var W=m.stateNode.containerInfo;if(W===v)break;if(Q===4)for(Q=m.return;Q!==null;){var ne=Q.tag;if((ne===3||ne===4)&&Q.stateNode.containerInfo===v)return;Q=Q.return}for(;W!==null;){if(Q=Pn(W),Q===null)return;if(ne=Q.tag,ne===5||ne===6||ne===26||ne===27){m=T=Q;continue e}W=W.parentNode}}m=m.return}Sh(function(){var he=T,Ce=Lo(h),Ne=[];e:{var pe=uM.get(c);if(pe!==void 0){var me=xs,Dt=c;switch(c){case"keypress":if(Gt(h)===0)break e;case"keydown":case"keyup":me=cp;break;case"focusin":Dt="focus",me=sp;break;case"focusout":Dt="blur",me=sp;break;case"beforeblur":case"afterblur":me=sp;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":me=Ma;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":me=RR;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":me=Uw;break;case aM:case cM:case AM:me=op;break;case lM:me=xw;break;case"scroll":case"scrollend":me=pA;break;case"wheel":me=Ap;break;case"copy":case"cut":case"paste":me=ap;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":me=O_;break;case"toggle":case"beforetoggle":me=Fw}var wt=(u&4)!==0,dr=!wt&&(c==="scroll"||c==="scrollend"),Ae=wt?pe!==null?pe+"Capture":null:pe;wt=[];for(var oe=he,de;oe!==null;){var Ie=oe;if(de=Ie.stateNode,Ie=Ie.tag,Ie!==5&&Ie!==26&&Ie!==27||de===null||Ae===null||(Ie=fA(oe,Ae),Ie!=null&&wt.push(oE(oe,Ie,de))),dr)break;oe=oe.return}0<wt.length&&(pe=new me(pe,Dt,null,h,Ce),Ne.push({event:pe,listeners:wt}))}}if((u&7)===0){e:{if(pe=c==="mouseover"||c==="pointerover",me=c==="mouseout"||c==="pointerout",pe&&h!==Dc&&(Dt=h.relatedTarget||h.fromElement)&&(Pn(Dt)||Dt[$i]))break e;if((me||pe)&&(pe=Ce.window===Ce?Ce:(pe=Ce.ownerDocument)?pe.defaultView||pe.parentWindow:window,me?(Dt=h.relatedTarget||h.toElement,me=he,Dt=Dt?Pn(Dt):null,Dt!==null&&(dr=s(Dt),wt=Dt.tag,Dt!==dr||wt!==5&&wt!==27&&wt!==6)&&(Dt=null)):(me=null,Dt=he),me!==Dt)){if(wt=Ma,Ie="onMouseLeave",Ae="onMouseEnter",oe="mouse",(c==="pointerout"||c==="pointerover")&&(wt=O_,Ie="onPointerLeave",Ae="onPointerEnter",oe="pointer"),dr=me==null?pe:po(me),de=Dt==null?pe:po(Dt),pe=new wt(Ie,oe+"leave",me,h,Ce),pe.target=dr,pe.relatedTarget=de,Ie=null,Pn(Ce)===he&&(wt=new wt(Ae,oe+"enter",Dt,h,Ce),wt.target=de,wt.relatedTarget=dr,Ie=wt),dr=Ie,me&&Dt)t:{for(wt=me,Ae=Dt,oe=0,de=wt;de;de=Pp(de))oe++;for(de=0,Ie=Ae;Ie;Ie=Pp(Ie))de++;for(;0<oe-de;)wt=Pp(wt),oe--;for(;0<de-oe;)Ae=Pp(Ae),de--;for(;oe--;){if(wt===Ae||Ae!==null&&wt===Ae.alternate)break t;wt=Pp(wt),Ae=Pp(Ae)}wt=null}else wt=null;me!==null&&DV(Ne,pe,me,wt,!1),Dt!==null&&dr!==null&&DV(Ne,dr,Dt,wt,!0)}}e:{if(pe=he?po(he):window,me=pe.nodeName&&pe.nodeName.toLowerCase(),me==="select"||me==="input"&&pe.type==="file")var rt=X2;else if(es(pe))if(J2)rt=Sie;else{rt=Cie;var an=wie}else me=pe.nodeName,!me||me.toLowerCase()!=="input"||pe.type!=="checkbox"&&pe.type!=="radio"?he&&wh(he.elementType)&&(rt=X2):rt=Tie;if(rt&&(rt=rt(c,he))){vl(Ne,rt,h,Ce);break e}an&&an(c,pe,he),c==="focusout"&&he&&pe.type==="number"&&he.memoizedProps.value!=null&&hA(pe,"number",pe.value)}switch(an=he?po(he):window,c){case"focusin":(es(an)||an.contentEditable==="true")&&(lp=an,LR=he,B_=null);break;case"focusout":B_=LR=lp=null;break;case"mousedown":PR=!0;break;case"contextmenu":case"mouseup":case"dragend":PR=!1,sM(Ne,h,Ce);break;case"selectionchange":if(Iie)break;case"keydown":case"keyup":sM(Ne,h,Ce)}var lt;if(gA)e:{switch(c){case"compositionstart":var St="onCompositionStart";break e;case"compositionend":St="onCompositionEnd";break e;case"compositionupdate":St="onCompositionUpdate";break e}St=void 0}else Cn?ge(c,h)&&(St="onCompositionEnd"):c==="keydown"&&h.keyCode===229&&(St="onCompositionStart");St&&(F&&h.locale!=="ko"&&(Cn||St!=="onCompositionStart"?St==="onCompositionEnd"&&Cn&&(lt=yn()):(ye=Ce,Me="value"in ye?ye.value:ye.textContent,Cn=!0)),an=bC(he,St),0<an.length&&(St=new I_(St,c,null,h,Ce),Ne.push({event:St,listeners:an}),lt?St.data=lt:(lt=He(h),lt!==null&&(St.data=lt)))),(lt=R?Zi(c,h):Tn(c,h))&&(St=bC(he,"onBeforeInput"),0<St.length&&(an=new I_("onBeforeInput","beforeinput",null,h,Ce),Ne.push({event:an,listeners:St}),an.data=lt)),Ase(Ne,c,he,h,Ce)}OV(Ne,u)})}function oE(c,u,h){return{instance:c,listener:u,currentTarget:h}}function bC(c,u){for(var h=u+"Capture",m=[];c!==null;){var v=c,T=v.stateNode;if(v=v.tag,v!==5&&v!==26&&v!==27||T===null||(v=fA(c,h),v!=null&&m.unshift(oE(c,v,T)),v=fA(c,u),v!=null&&m.push(oE(c,v,T))),c.tag===3)return m;c=c.return}return[]}function Pp(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function DV(c,u,h,m,v){for(var T=u._reactName,Q=[];h!==null&&h!==m;){var W=h,ne=W.alternate,he=W.stateNode;if(W=W.tag,ne!==null&&ne===m)break;W!==5&&W!==26&&W!==27||he===null||(ne=he,v?(he=fA(h,T),he!=null&&Q.unshift(oE(h,he,ne))):v||(he=fA(h,T),he!=null&&Q.push(oE(h,he,ne)))),h=h.return}Q.length!==0&&c.push({event:u,listeners:Q})}var hse=/\r\n?/g,fse=/\u0000|\uFFFD/g;function BV(c){return(typeof c=="string"?c:""+c).replace(hse,`
`).replace(fse,"")}function LV(c,u){return u=BV(u),BV(c)===u}function IC(){}function ur(c,u,h,m,v,T){switch(h){case"children":typeof m=="string"?u==="body"||u==="textarea"&&m===""||Bo(c,m):(typeof m=="number"||typeof m=="bigint")&&u!=="body"&&Bo(c,""+m);break;case"className":mt(c,"class",m);break;case"tabIndex":mt(c,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":mt(c,h,m);break;case"style":vh(c,m,T);break;case"data":if(u!=="object"){mt(c,"data",m);break}case"src":case"href":if(m===""&&(u!=="a"||h!=="href")){c.removeAttribute(h);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){c.removeAttribute(h);break}m=Ru(""+m),c.setAttribute(h,m);break;case"action":case"formAction":if(typeof m=="function"){c.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(h==="formAction"?(u!=="input"&&ur(c,u,"name",v.name,v,null),ur(c,u,"formEncType",v.formEncType,v,null),ur(c,u,"formMethod",v.formMethod,v,null),ur(c,u,"formTarget",v.formTarget,v,null)):(ur(c,u,"encType",v.encType,v,null),ur(c,u,"method",v.method,v,null),ur(c,u,"target",v.target,v,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){c.removeAttribute(h);break}m=Ru(""+m),c.setAttribute(h,m);break;case"onClick":m!=null&&(c.onclick=IC);break;case"onScroll":m!=null&&hn("scroll",c);break;case"onScrollEnd":m!=null&&hn("scrollend",c);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(h=m.__html,h!=null){if(v.children!=null)throw Error(r(60));c.innerHTML=h}}break;case"multiple":c.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":c.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){c.removeAttribute("xlink:href");break}h=Ru(""+m),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?c.setAttribute(h,""+m):c.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?c.setAttribute(h,""):c.removeAttribute(h);break;case"capture":case"download":m===!0?c.setAttribute(h,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?c.setAttribute(h,m):c.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?c.setAttribute(h,m):c.removeAttribute(h);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?c.removeAttribute(h):c.setAttribute(h,m);break;case"popover":hn("beforetoggle",c),hn("toggle",c),Ge(c,"popover",m);break;case"xlinkActuate":Ri(c,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":Ri(c,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":Ri(c,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":Ri(c,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":Ri(c,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":Ri(c,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":Ri(c,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":Ri(c,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":Ri(c,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":Ge(c,"is",m);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=Ch.get(h)||h,Ge(c,h,m))}}function rN(c,u,h,m,v,T){switch(h){case"style":vh(c,m,T);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(r(61));if(h=m.__html,h!=null){if(v.children!=null)throw Error(r(60));c.innerHTML=h}}break;case"children":typeof m=="string"?Bo(c,m):(typeof m=="number"||typeof m=="bigint")&&Bo(c,""+m);break;case"onScroll":m!=null&&hn("scroll",c);break;case"onScrollEnd":m!=null&&hn("scrollend",c);break;case"onClick":m!=null&&(c.onclick=IC);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ii.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(v=h.endsWith("Capture"),u=h.slice(2,v?h.length-7:void 0),T=c[bi]||null,T=T!=null?T[h]:null,typeof T=="function"&&c.removeEventListener(u,T,v),typeof m=="function")){typeof T!="function"&&T!==null&&(h in c?c[h]=null:c.hasAttribute(h)&&c.removeAttribute(h)),c.addEventListener(u,m,v);break e}h in c?c[h]=m:m===!0?c.setAttribute(h,""):Ge(c,h,m)}}}function Qs(c,u,h){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":hn("error",c),hn("load",c);var m=!1,v=!1,T;for(T in h)if(h.hasOwnProperty(T)){var Q=h[T];if(Q!=null)switch(T){case"src":m=!0;break;case"srcSet":v=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,u));default:ur(c,u,T,Q,h,null)}}v&&ur(c,u,"srcSet",h.srcSet,h,null),m&&ur(c,u,"src",h.src,h,null);return;case"input":hn("invalid",c);var W=T=Q=v=null,ne=null,he=null;for(m in h)if(h.hasOwnProperty(m)){var Ce=h[m];if(Ce!=null)switch(m){case"name":v=Ce;break;case"type":Q=Ce;break;case"checked":ne=Ce;break;case"defaultChecked":he=Ce;break;case"value":T=Ce;break;case"defaultValue":W=Ce;break;case"children":case"dangerouslySetInnerHTML":if(Ce!=null)throw Error(r(137,u));break;default:ur(c,u,m,Ce,h,null)}}gl(c,T,W,ne,he,Q,v,!1),pl(c);return;case"select":hn("invalid",c),m=Q=T=null;for(v in h)if(h.hasOwnProperty(v)&&(W=h[v],W!=null))switch(v){case"value":T=W;break;case"defaultValue":Q=W;break;case"multiple":m=W;default:ur(c,u,v,W,h,null)}u=T,h=Q,c.multiple=!!m,u!=null?ka(c,!!m,u,!1):h!=null&&ka(c,!!m,h,!0);return;case"textarea":hn("invalid",c),T=v=m=null;for(Q in h)if(h.hasOwnProperty(Q)&&(W=h[Q],W!=null))switch(Q){case"value":m=W;break;case"defaultValue":v=W;break;case"children":T=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(91));break;default:ur(c,u,Q,W,h,null)}_l(c,m,v,T),pl(c);return;case"option":for(ne in h)if(h.hasOwnProperty(ne)&&(m=h[ne],m!=null))switch(ne){case"selected":c.selected=m&&typeof m!="function"&&typeof m!="symbol";break;default:ur(c,u,ne,m,h,null)}return;case"dialog":hn("beforetoggle",c),hn("toggle",c),hn("cancel",c),hn("close",c);break;case"iframe":case"object":hn("load",c);break;case"video":case"audio":for(m=0;m<sE.length;m++)hn(sE[m],c);break;case"image":hn("error",c),hn("load",c);break;case"details":hn("toggle",c);break;case"embed":case"source":case"link":hn("error",c),hn("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(he in h)if(h.hasOwnProperty(he)&&(m=h[he],m!=null))switch(he){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,u));default:ur(c,u,he,m,h,null)}return;default:if(wh(u)){for(Ce in h)h.hasOwnProperty(Ce)&&(m=h[Ce],m!==void 0&&rN(c,u,Ce,m,h,void 0));return}}for(W in h)h.hasOwnProperty(W)&&(m=h[W],m!=null&&ur(c,u,W,m,h,null))}function pse(c,u,h,m){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var v=null,T=null,Q=null,W=null,ne=null,he=null,Ce=null;for(me in h){var Ne=h[me];if(h.hasOwnProperty(me)&&Ne!=null)switch(me){case"checked":break;case"value":break;case"defaultValue":ne=Ne;default:m.hasOwnProperty(me)||ur(c,u,me,null,m,Ne)}}for(var pe in m){var me=m[pe];if(Ne=h[pe],m.hasOwnProperty(pe)&&(me!=null||Ne!=null))switch(pe){case"type":T=me;break;case"name":v=me;break;case"checked":he=me;break;case"defaultChecked":Ce=me;break;case"value":Q=me;break;case"defaultValue":W=me;break;case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(r(137,u));break;default:me!==Ne&&ur(c,u,pe,me,m,Ne)}}go(c,Q,W,ne,he,Ce,T,v);return;case"select":me=Q=W=pe=null;for(T in h)if(ne=h[T],h.hasOwnProperty(T)&&ne!=null)switch(T){case"value":break;case"multiple":me=ne;default:m.hasOwnProperty(T)||ur(c,u,T,null,m,ne)}for(v in m)if(T=m[v],ne=h[v],m.hasOwnProperty(v)&&(T!=null||ne!=null))switch(v){case"value":pe=T;break;case"defaultValue":W=T;break;case"multiple":Q=T;default:T!==ne&&ur(c,u,v,T,m,ne)}u=W,h=Q,m=me,pe!=null?ka(c,!!h,pe,!1):!!m!=!!h&&(u!=null?ka(c,!!h,u,!0):ka(c,!!h,h?[]:"",!1));return;case"textarea":me=pe=null;for(W in h)if(v=h[W],h.hasOwnProperty(W)&&v!=null&&!m.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:ur(c,u,W,null,m,v)}for(Q in m)if(v=m[Q],T=h[Q],m.hasOwnProperty(Q)&&(v!=null||T!=null))switch(Q){case"value":pe=v;break;case"defaultValue":me=v;break;case"children":break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(r(91));break;default:v!==T&&ur(c,u,Q,v,m,T)}zn(c,pe,me);return;case"option":for(var Dt in h)if(pe=h[Dt],h.hasOwnProperty(Dt)&&pe!=null&&!m.hasOwnProperty(Dt))switch(Dt){case"selected":c.selected=!1;break;default:ur(c,u,Dt,null,m,pe)}for(ne in m)if(pe=m[ne],me=h[ne],m.hasOwnProperty(ne)&&pe!==me&&(pe!=null||me!=null))switch(ne){case"selected":c.selected=pe&&typeof pe!="function"&&typeof pe!="symbol";break;default:ur(c,u,ne,pe,m,me)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var wt in h)pe=h[wt],h.hasOwnProperty(wt)&&pe!=null&&!m.hasOwnProperty(wt)&&ur(c,u,wt,null,m,pe);for(he in m)if(pe=m[he],me=h[he],m.hasOwnProperty(he)&&pe!==me&&(pe!=null||me!=null))switch(he){case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(r(137,u));break;default:ur(c,u,he,pe,m,me)}return;default:if(wh(u)){for(var dr in h)pe=h[dr],h.hasOwnProperty(dr)&&pe!==void 0&&!m.hasOwnProperty(dr)&&rN(c,u,dr,void 0,m,pe);for(Ce in m)pe=m[Ce],me=h[Ce],!m.hasOwnProperty(Ce)||pe===me||pe===void 0&&me===void 0||rN(c,u,Ce,pe,m,me);return}}for(var Ae in h)pe=h[Ae],h.hasOwnProperty(Ae)&&pe!=null&&!m.hasOwnProperty(Ae)&&ur(c,u,Ae,null,m,pe);for(Ne in m)pe=m[Ne],me=h[Ne],!m.hasOwnProperty(Ne)||pe===me||pe==null&&me==null||ur(c,u,Ne,pe,m,me)}var iN=null,sN=null;function RC(c){return c.nodeType===9?c:c.ownerDocument}function PV(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function UV(c,u){if(c===0)switch(u){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&u==="foreignObject"?0:c}function oN(c,u){return c==="textarea"||c==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.children=="bigint"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var aN=null;function mse(){var c=window.event;return c&&c.type==="popstate"?c===aN?!1:(aN=c,!0):(aN=null,!1)}var kV=typeof setTimeout=="function"?setTimeout:void 0,gse=typeof clearTimeout=="function"?clearTimeout:void 0,xV=typeof Promise=="function"?Promise:void 0,_se=typeof queueMicrotask=="function"?queueMicrotask:typeof xV<"u"?function(c){return xV.resolve(null).then(c).catch(Ese)}:kV;function Ese(c){setTimeout(function(){throw c})}function Ku(c){return c==="head"}function MV(c,u){var h=u,m=0,v=0;do{var T=h.nextSibling;if(c.removeChild(h),T&&T.nodeType===8)if(h=T.data,h==="/$"){if(0<m&&8>m){h=m;var Q=c.ownerDocument;if(h&1&&aE(Q.documentElement),h&2&&aE(Q.body),h&4)for(h=Q.head,aE(h),Q=h.firstChild;Q;){var W=Q.nextSibling,ne=Q.nodeName;Q[Oc]||ne==="SCRIPT"||ne==="STYLE"||ne==="LINK"&&Q.rel.toLowerCase()==="stylesheet"||h.removeChild(Q),Q=W}}if(v===0){c.removeChild(T),pE(u);return}v--}else h==="$"||h==="$?"||h==="$!"?v++:m=h.charCodeAt(0)-48;else m=0;h=T}while(h);pE(u)}function cN(c){var u=c.firstChild;for(u&&u.nodeType===10&&(u=u.nextSibling);u;){var h=u;switch(u=u.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":cN(h),ia(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}c.removeChild(h)}}function yse(c,u,h,m){for(;c.nodeType===1;){var v=h;if(c.nodeName.toLowerCase()!==u.toLowerCase()){if(!m&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(m){if(!c[Oc])switch(u){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(T=c.getAttribute("rel"),T==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(T!==v.rel||c.getAttribute("href")!==(v.href==null||v.href===""?null:v.href)||c.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin)||c.getAttribute("title")!==(v.title==null?null:v.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(T=c.getAttribute("src"),(T!==(v.src==null?null:v.src)||c.getAttribute("type")!==(v.type==null?null:v.type)||c.getAttribute("crossorigin")!==(v.crossOrigin==null?null:v.crossOrigin))&&T&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(u==="input"&&c.type==="hidden"){var T=v.name==null?null:""+v.name;if(v.type==="hidden"&&c.getAttribute("name")===T)return c}else return c;if(c=Pc(c.nextSibling),c===null)break}return null}function vse(c,u,h){if(u==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!h||(c=Pc(c.nextSibling),c===null))return null;return c}function AN(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState==="complete"}function wse(c,u){var h=c.ownerDocument;if(c.data!=="$?"||h.readyState==="complete")u();else{var m=function(){u(),h.removeEventListener("DOMContentLoaded",m)};h.addEventListener("DOMContentLoaded",m),c._reactRetry=m}}function Pc(c){for(;c!=null;c=c.nextSibling){var u=c.nodeType;if(u===1||u===3)break;if(u===8){if(u=c.data,u==="$"||u==="$!"||u==="$?"||u==="F!"||u==="F")break;if(u==="/$")return null}}return c}var lN=null;function FV(c){c=c.previousSibling;for(var u=0;c;){if(c.nodeType===8){var h=c.data;if(h==="$"||h==="$!"||h==="$?"){if(u===0)return c;u--}else h==="/$"&&u++}c=c.previousSibling}return null}function VV(c,u,h){switch(u=RC(h),c){case"html":if(c=u.documentElement,!c)throw Error(r(452));return c;case"head":if(c=u.head,!c)throw Error(r(453));return c;case"body":if(c=u.body,!c)throw Error(r(454));return c;default:throw Error(r(451))}}function aE(c){for(var u=c.attributes;u.length;)c.removeAttributeNode(u[0]);ia(c)}var Ga=new Map,QV=new Set;function OC(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var Pl=Y.d;Y.d={f:Cse,r:Tse,D:Sse,C:bse,L:Ise,m:Rse,X:Nse,S:Ose,M:Dse};function Cse(){var c=Pl.f(),u=yC();return c||u}function Tse(c){var u=Qi(c);u!==null&&u.tag===5&&u.type==="form"?aF(u):Pl.r(c)}var Up=typeof document>"u"?null:document;function HV(c,u,h){var m=Up;if(m&&typeof u=="string"&&u){var v=Ai(u);v='link[rel="'+c+'"][href="'+v+'"]',typeof h=="string"&&(v+='[crossorigin="'+h+'"]'),QV.has(v)||(QV.add(v),c={rel:c,crossOrigin:h,href:u},m.querySelector(v)===null&&(u=m.createElement("link"),Qs(u,"link",c),qr(u),m.head.appendChild(u)))}}function Sse(c){Pl.D(c),HV("dns-prefetch",c,null)}function bse(c,u){Pl.C(c,u),HV("preconnect",c,u)}function Ise(c,u,h){Pl.L(c,u,h);var m=Up;if(m&&c&&u){var v='link[rel="preload"][as="'+Ai(u)+'"]';u==="image"&&h&&h.imageSrcSet?(v+='[imagesrcset="'+Ai(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(v+='[imagesizes="'+Ai(h.imageSizes)+'"]')):v+='[href="'+Ai(c)+'"]';var T=v;switch(u){case"style":T=kp(c);break;case"script":T=xp(c)}Ga.has(T)||(c=d({rel:"preload",href:u==="image"&&h&&h.imageSrcSet?void 0:c,as:u},h),Ga.set(T,c),m.querySelector(v)!==null||u==="style"&&m.querySelector(cE(T))||u==="script"&&m.querySelector(AE(T))||(u=m.createElement("link"),Qs(u,"link",c),qr(u),m.head.appendChild(u)))}}function Rse(c,u){Pl.m(c,u);var h=Up;if(h&&c){var m=u&&typeof u.as=="string"?u.as:"script",v='link[rel="modulepreload"][as="'+Ai(m)+'"][href="'+Ai(c)+'"]',T=v;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=xp(c)}if(!Ga.has(T)&&(c=d({rel:"modulepreload",href:c},u),Ga.set(T,c),h.querySelector(v)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(AE(T)))return}m=h.createElement("link"),Qs(m,"link",c),qr(m),h.head.appendChild(m)}}}function Ose(c,u,h){Pl.S(c,u,h);var m=Up;if(m&&c){var v=gr(m).hoistableStyles,T=kp(c);u=u||"default";var Q=v.get(T);if(!Q){var W={loading:0,preload:null};if(Q=m.querySelector(cE(T)))W.loading=5;else{c=d({rel:"stylesheet",href:c,"data-precedence":u},h),(h=Ga.get(T))&&uN(c,h);var ne=Q=m.createElement("link");qr(ne),Qs(ne,"link",c),ne._p=new Promise(function(he,Ce){ne.onload=he,ne.onerror=Ce}),ne.addEventListener("load",function(){W.loading|=1}),ne.addEventListener("error",function(){W.loading|=2}),W.loading|=4,NC(Q,u,m)}Q={type:"stylesheet",instance:Q,count:1,state:W},v.set(T,Q)}}}function Nse(c,u){Pl.X(c,u);var h=Up;if(h&&c){var m=gr(h).hoistableScripts,v=xp(c),T=m.get(v);T||(T=h.querySelector(AE(v)),T||(c=d({src:c,async:!0},u),(u=Ga.get(v))&&dN(c,u),T=h.createElement("script"),qr(T),Qs(T,"link",c),h.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},m.set(v,T))}}function Dse(c,u){Pl.M(c,u);var h=Up;if(h&&c){var m=gr(h).hoistableScripts,v=xp(c),T=m.get(v);T||(T=h.querySelector(AE(v)),T||(c=d({src:c,async:!0,type:"module"},u),(u=Ga.get(v))&&dN(c,u),T=h.createElement("script"),qr(T),Qs(T,"link",c),h.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},m.set(v,T))}}function jV(c,u,h,m){var v=(v=ke.current)?OC(v):null;if(!v)throw Error(r(446));switch(c){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(u=kp(h.href),h=gr(v).hoistableStyles,m=h.get(u),m||(m={type:"style",instance:null,count:0,state:null},h.set(u,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){c=kp(h.href);var T=gr(v).hoistableStyles,Q=T.get(c);if(Q||(v=v.ownerDocument||v,Q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(c,Q),(T=v.querySelector(cE(c)))&&!T._p&&(Q.instance=T,Q.state.loading=5),Ga.has(c)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},Ga.set(c,h),T||Bse(v,c,h,Q.state))),u&&m===null)throw Error(r(528,""));return Q}if(u&&m!==null)throw Error(r(529,""));return null;case"script":return u=h.async,h=h.src,typeof h=="string"&&u&&typeof u!="function"&&typeof u!="symbol"?(u=xp(h),h=gr(v).hoistableScripts,m=h.get(u),m||(m={type:"script",instance:null,count:0,state:null},h.set(u,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,c))}}function kp(c){return'href="'+Ai(c)+'"'}function cE(c){return'link[rel="stylesheet"]['+c+"]"}function KV(c){return d({},c,{"data-precedence":c.precedence,precedence:null})}function Bse(c,u,h,m){c.querySelector('link[rel="preload"][as="style"]['+u+"]")?m.loading=1:(u=c.createElement("link"),m.preload=u,u.addEventListener("load",function(){return m.loading|=1}),u.addEventListener("error",function(){return m.loading|=2}),Qs(u,"link",h),qr(u),c.head.appendChild(u))}function xp(c){return'[src="'+Ai(c)+'"]'}function AE(c){return"script[async]"+c}function GV(c,u,h){if(u.count++,u.instance===null)switch(u.type){case"style":var m=c.querySelector('style[data-href~="'+Ai(h.href)+'"]');if(m)return u.instance=m,qr(m),m;var v=d({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return m=(c.ownerDocument||c).createElement("style"),qr(m),Qs(m,"style",v),NC(m,h.precedence,c),u.instance=m;case"stylesheet":v=kp(h.href);var T=c.querySelector(cE(v));if(T)return u.state.loading|=4,u.instance=T,qr(T),T;m=KV(h),(v=Ga.get(v))&&uN(m,v),T=(c.ownerDocument||c).createElement("link"),qr(T);var Q=T;return Q._p=new Promise(function(W,ne){Q.onload=W,Q.onerror=ne}),Qs(T,"link",m),u.state.loading|=4,NC(T,h.precedence,c),u.instance=T;case"script":return T=xp(h.src),(v=c.querySelector(AE(T)))?(u.instance=v,qr(v),v):(m=h,(v=Ga.get(T))&&(m=d({},h),dN(m,v)),c=c.ownerDocument||c,v=c.createElement("script"),qr(v),Qs(v,"link",m),c.head.appendChild(v),u.instance=v);case"void":return null;default:throw Error(r(443,u.type))}else u.type==="stylesheet"&&(u.state.loading&4)===0&&(m=u.instance,u.state.loading|=4,NC(m,h.precedence,c));return u.instance}function NC(c,u,h){for(var m=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),v=m.length?m[m.length-1]:null,T=v,Q=0;Q<m.length;Q++){var W=m[Q];if(W.dataset.precedence===u)T=W;else if(T!==v)break}T?T.parentNode.insertBefore(c,T.nextSibling):(u=h.nodeType===9?h.head:h,u.insertBefore(c,u.firstChild))}function uN(c,u){c.crossOrigin==null&&(c.crossOrigin=u.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=u.referrerPolicy),c.title==null&&(c.title=u.title)}function dN(c,u){c.crossOrigin==null&&(c.crossOrigin=u.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=u.referrerPolicy),c.integrity==null&&(c.integrity=u.integrity)}var DC=null;function WV(c,u,h){if(DC===null){var m=new Map,v=DC=new Map;v.set(h,m)}else v=DC,m=v.get(h),m||(m=new Map,v.set(h,m));if(m.has(c))return m;for(m.set(c,null),h=h.getElementsByTagName(c),v=0;v<h.length;v++){var T=h[v];if(!(T[Oc]||T[Vi]||c==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var Q=T.getAttribute(u)||"";Q=c+Q;var W=m.get(Q);W?W.push(T):m.set(Q,[T])}}return m}function zV(c,u,h){c=c.ownerDocument||c,c.head.insertBefore(h,u==="title"?c.querySelector("head > title"):null)}function Lse(c,u,h){if(h===1||u.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof u.precedence!="string"||typeof u.href!="string"||u.href==="")break;return!0;case"link":if(typeof u.rel!="string"||typeof u.href!="string"||u.href===""||u.onLoad||u.onError)break;switch(u.rel){case"stylesheet":return c=u.disabled,typeof u.precedence=="string"&&c==null;default:return!0}case"script":if(u.async&&typeof u.async!="function"&&typeof u.async!="symbol"&&!u.onLoad&&!u.onError&&u.src&&typeof u.src=="string")return!0}return!1}function qV(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}var lE=null;function Pse(){}function Use(c,u,h){if(lE===null)throw Error(r(475));var m=lE;if(u.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var v=kp(h.href),T=c.querySelector(cE(v));if(T){c=T._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(m.count++,m=BC.bind(m),c.then(m,m)),u.state.loading|=4,u.instance=T,qr(T);return}T=c.ownerDocument||c,h=KV(h),(v=Ga.get(v))&&uN(h,v),T=T.createElement("link"),qr(T);var Q=T;Q._p=new Promise(function(W,ne){Q.onload=W,Q.onerror=ne}),Qs(T,"link",h),u.instance=T}m.stylesheets===null&&(m.stylesheets=new Map),m.stylesheets.set(u,c),(c=u.state.preload)&&(u.state.loading&3)===0&&(m.count++,u=BC.bind(m),c.addEventListener("load",u),c.addEventListener("error",u))}}function kse(){if(lE===null)throw Error(r(475));var c=lE;return c.stylesheets&&c.count===0&&hN(c,c.stylesheets),0<c.count?function(u){var h=setTimeout(function(){if(c.stylesheets&&hN(c,c.stylesheets),c.unsuspend){var m=c.unsuspend;c.unsuspend=null,m()}},6e4);return c.unsuspend=u,function(){c.unsuspend=null,clearTimeout(h)}}:null}function BC(){if(this.count--,this.count===0){if(this.stylesheets)hN(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var LC=null;function hN(c,u){c.stylesheets=null,c.unsuspend!==null&&(c.count++,LC=new Map,u.forEach(xse,c),LC=null,BC.call(c))}function xse(c,u){if(!(u.state.loading&4)){var h=LC.get(c);if(h)var m=h.get(null);else{h=new Map,LC.set(c,h);for(var v=c.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<v.length;T++){var Q=v[T];(Q.nodeName==="LINK"||Q.getAttribute("media")!=="not all")&&(h.set(Q.dataset.precedence,Q),m=Q)}m&&h.set(null,m)}v=u.instance,Q=v.getAttribute("data-precedence"),T=h.get(Q)||m,T===m&&h.set(null,v),h.set(Q,v),this.count++,m=BC.bind(this),v.addEventListener("load",m),v.addEventListener("error",m),T?T.parentNode.insertBefore(v,T.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(v,c.firstChild)),u.state.loading|=4}}var uE={$$typeof:B,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function Mse(c,u,h,m,v,T,Q,W){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=oA(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=oA(0),this.hiddenUpdates=oA(null),this.identifierPrefix=m,this.onUncaughtError=v,this.onCaughtError=T,this.onRecoverableError=Q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=W,this.incompleteTransitions=new Map}function YV(c,u,h,m,v,T,Q,W,ne,he,Ce,Ne){return c=new Mse(c,u,h,Q,W,ne,he,Ne),u=1,T===!0&&(u|=24),T=ca(3,null,null,u),c.current=T,T.stateNode=c,u=qR(),u.refCount++,c.pooledCache=u,u.refCount++,T.memoizedState={element:m,isDehydrated:h,cache:u},$R(T),c}function XV(c){return c?(c=fp,c):fp}function JV(c,u,h,m,v,T){v=XV(v),m.context===null?m.context=v:m.pendingContext=v,m=Du(u),m.payload={element:h},T=T===void 0?null:T,T!==null&&(m.callback=T),h=Bu(c,m,u),h!==null&&(ha(h,c,u),Q_(h,c,u))}function $V(c,u){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var h=c.retryLane;c.retryLane=h!==0&&h<u?h:u}}function fN(c,u){$V(c,u),(c=c.alternate)&&$V(c,u)}function ZV(c){if(c.tag===13){var u=hp(c,67108864);u!==null&&ha(u,c,67108864),fN(c,67108864)}}var PC=!0;function Fse(c,u,h,m){var v=re.T;re.T=null;var T=Y.p;try{Y.p=2,pN(c,u,h,m)}finally{Y.p=T,re.T=v}}function Vse(c,u,h,m){var v=re.T;re.T=null;var T=Y.p;try{Y.p=8,pN(c,u,h,m)}finally{Y.p=T,re.T=v}}function pN(c,u,h,m){if(PC){var v=mN(m);if(v===null)nN(c,u,m,UC,h),t4(c,m);else if(Hse(v,c,u,h,m))m.stopPropagation();else if(t4(c,m),u&4&&-1<Qse.indexOf(c)){for(;v!==null;){var T=Qi(v);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var Q=zr(T.pendingLanes);if(Q!==0){var W=T;for(W.pendingLanes|=2,W.entangledLanes|=2;Q;){var ne=1<<31-mn(Q);W.entanglements[1]|=ne,Q&=~ne}CA(T),(tr&6)===0&&(_C=pt()+500,iE(0))}}break;case 13:W=hp(T,2),W!==null&&ha(W,T,2),yC(),fN(T,2)}if(T=mN(m),T===null&&nN(c,u,m,UC,h),T===v)break;v=T}v!==null&&m.stopPropagation()}else nN(c,u,m,null,h)}}function mN(c){return c=Lo(c),gN(c)}var UC=null;function gN(c){if(UC=null,c=Pn(c),c!==null){var u=s(c);if(u===null)c=null;else{var h=u.tag;if(h===13){if(c=o(u),c!==null)return c;c=null}else if(h===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;c=null}else u!==c&&(c=null)}}return UC=c,null}function e4(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Gn()){case br:return 2;case Kt:return 8;case at:case er:return 32;case xe:return 268435456;default:return 32}default:return 32}}var _N=!1,Gu=null,Wu=null,zu=null,dE=new Map,hE=new Map,qu=[],Qse="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function t4(c,u){switch(c){case"focusin":case"focusout":Gu=null;break;case"dragenter":case"dragleave":Wu=null;break;case"mouseover":case"mouseout":zu=null;break;case"pointerover":case"pointerout":dE.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":hE.delete(u.pointerId)}}function fE(c,u,h,m,v,T){return c===null||c.nativeEvent!==T?(c={blockedOn:u,domEventName:h,eventSystemFlags:m,nativeEvent:T,targetContainers:[v]},u!==null&&(u=Qi(u),u!==null&&ZV(u)),c):(c.eventSystemFlags|=m,u=c.targetContainers,v!==null&&u.indexOf(v)===-1&&u.push(v),c)}function Hse(c,u,h,m,v){switch(u){case"focusin":return Gu=fE(Gu,c,u,h,m,v),!0;case"dragenter":return Wu=fE(Wu,c,u,h,m,v),!0;case"mouseover":return zu=fE(zu,c,u,h,m,v),!0;case"pointerover":var T=v.pointerId;return dE.set(T,fE(dE.get(T)||null,c,u,h,m,v)),!0;case"gotpointercapture":return T=v.pointerId,hE.set(T,fE(hE.get(T)||null,c,u,h,m,v)),!0}return!1}function n4(c){var u=Pn(c.target);if(u!==null){var h=s(u);if(h!==null){if(u=h.tag,u===13){if(u=o(h),u!==null){c.blockedOn=u,Rc(c.priority,function(){if(h.tag===13){var m=da();m=ra(m);var v=hp(h,m);v!==null&&ha(v,h,m),fN(h,m)}});return}}else if(u===3&&h.stateNode.current.memoizedState.isDehydrated){c.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}c.blockedOn=null}function kC(c){if(c.blockedOn!==null)return!1;for(var u=c.targetContainers;0<u.length;){var h=mN(c.nativeEvent);if(h===null){h=c.nativeEvent;var m=new h.constructor(h.type,h);Dc=m,h.target.dispatchEvent(m),Dc=null}else return u=Qi(h),u!==null&&ZV(u),c.blockedOn=h,!1;u.shift()}return!0}function r4(c,u,h){kC(c)&&h.delete(u)}function jse(){_N=!1,Gu!==null&&kC(Gu)&&(Gu=null),Wu!==null&&kC(Wu)&&(Wu=null),zu!==null&&kC(zu)&&(zu=null),dE.forEach(r4),hE.forEach(r4)}function xC(c,u){c.blockedOn===u&&(c.blockedOn=null,_N||(_N=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,jse)))}var MC=null;function i4(c){MC!==c&&(MC=c,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){MC===c&&(MC=null);for(var u=0;u<c.length;u+=3){var h=c[u],m=c[u+1],v=c[u+2];if(typeof m!="function"){if(gN(m||h)===null)continue;break}var T=Qi(h);T!==null&&(c.splice(u,3),u-=3,gO(T,{pending:!0,data:v,method:h.method,action:m},m,v))}}))}function pE(c){function u(ne){return xC(ne,c)}Gu!==null&&xC(Gu,c),Wu!==null&&xC(Wu,c),zu!==null&&xC(zu,c),dE.forEach(u),hE.forEach(u);for(var h=0;h<qu.length;h++){var m=qu[h];m.blockedOn===c&&(m.blockedOn=null)}for(;0<qu.length&&(h=qu[0],h.blockedOn===null);)n4(h),h.blockedOn===null&&qu.shift();if(h=(c.ownerDocument||c).$$reactFormReplay,h!=null)for(m=0;m<h.length;m+=3){var v=h[m],T=h[m+1],Q=v[bi]||null;if(typeof T=="function")Q||i4(h);else if(Q){var W=null;if(T&&T.hasAttribute("formAction")){if(v=T,Q=T[bi]||null)W=Q.formAction;else if(gN(v)!==null)continue}else W=Q.action;typeof W=="function"?h[m+1]=W:(h.splice(m,3),m-=3),i4(h)}}}function EN(c){this._internalRoot=c}FC.prototype.render=EN.prototype.render=function(c){var u=this._internalRoot;if(u===null)throw Error(r(409));var h=u.current,m=da();JV(h,m,c,u,null,null)},FC.prototype.unmount=EN.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var u=c.containerInfo;JV(c.current,2,null,c,null,null),yC(),u[$i]=null}};function FC(c){this._internalRoot=c}FC.prototype.unstable_scheduleHydration=function(c){if(c){var u=aA();c={blockedOn:null,target:c,priority:u};for(var h=0;h<qu.length&&u!==0&&u<qu[h].priority;h++);qu.splice(h,0,c),h===0&&n4(c)}};var s4=e.version;if(s4!=="19.1.0")throw Error(r(527,s4,"19.1.0"));Y.findDOMNode=function(c){var u=c._reactInternals;if(u===void 0)throw typeof c.render=="function"?Error(r(188)):(c=Object.keys(c).join(","),Error(r(268,c)));return c=A(u),c=c!==null?l(c):null,c=c===null?null:c.stateNode,c};var Kse={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:re,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var VC=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!VC.isDisabled&&VC.supportsFiber)try{$e=VC.inject(Kse),et=VC}catch{}}return gE.createRoot=function(c,u){if(!i(c))throw Error(r(299));var h=!1,m="",v=vF,T=wF,Q=CF,W=null;return u!=null&&(u.unstable_strictMode===!0&&(h=!0),u.identifierPrefix!==void 0&&(m=u.identifierPrefix),u.onUncaughtError!==void 0&&(v=u.onUncaughtError),u.onCaughtError!==void 0&&(T=u.onCaughtError),u.onRecoverableError!==void 0&&(Q=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(W=u.unstable_transitionCallbacks)),u=YV(c,1,!1,null,null,h,m,v,T,Q,W,null),c[$i]=u.current,tN(c),new EN(u)},gE.hydrateRoot=function(c,u,h){if(!i(c))throw Error(r(299));var m=!1,v="",T=vF,Q=wF,W=CF,ne=null,he=null;return h!=null&&(h.unstable_strictMode===!0&&(m=!0),h.identifierPrefix!==void 0&&(v=h.identifierPrefix),h.onUncaughtError!==void 0&&(T=h.onUncaughtError),h.onCaughtError!==void 0&&(Q=h.onCaughtError),h.onRecoverableError!==void 0&&(W=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&(ne=h.unstable_transitionCallbacks),h.formState!==void 0&&(he=h.formState)),u=YV(c,1,!0,u,h??null,m,v,T,Q,W,ne,he),u.context=XV(null),h=u.current,m=da(),m=ra(m),v=Du(m),v.callback=null,Bu(h,v,m),h=m,u.current.lanes=h,Ic(u,h),CA(u),c[$i]=u.current,tN(c),new FC(u)},gE.version="19.1.0",gE}var m4;function noe(){if(m4)return wN.exports;m4=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),wN.exports=toe(),wN.exports}var roe=noe(),_E={},g4;function ioe(){if(g4)return _E;g4=1,Object.defineProperty(_E,"__esModule",{value:!0}),_E.parse=o,_E.serialize=l;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,n=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,i=Object.prototype.toString,s=(()=>{const p=function(){};return p.prototype=Object.create(null),p})();function o(p,g){const y=new s,E=p.length;if(E<2)return y;const w=(g==null?void 0:g.decode)||d;let b=0;do{const I=p.indexOf("=",b);if(I===-1)break;const B=p.indexOf(";",b),U=B===-1?E:B;if(I>U){b=p.lastIndexOf(";",I-1)+1;continue}const H=a(p,b,I),K=A(p,I,H),x=p.slice(H,K);if(y[x]===void 0){let V=a(p,I+1,U),M=A(p,U,V);const O=w(p.slice(V,M));y[x]=O}b=U+1}while(b<E);return y}function a(p,g,y){do{const E=p.charCodeAt(g);if(E!==32&&E!==9)return g}while(++g<y);return y}function A(p,g,y){for(;g>y;){const E=p.charCodeAt(--g);if(E!==32&&E!==9)return g+1}return y}function l(p,g,y){const E=(y==null?void 0:y.encode)||encodeURIComponent;if(!t.test(p))throw new TypeError(`argument name is invalid: ${p}`);const w=E(g);if(!e.test(w))throw new TypeError(`argument val is invalid: ${g}`);let b=p+"="+w;if(!y)return b;if(y.maxAge!==void 0){if(!Number.isInteger(y.maxAge))throw new TypeError(`option maxAge is invalid: ${y.maxAge}`);b+="; Max-Age="+y.maxAge}if(y.domain){if(!n.test(y.domain))throw new TypeError(`option domain is invalid: ${y.domain}`);b+="; Domain="+y.domain}if(y.path){if(!r.test(y.path))throw new TypeError(`option path is invalid: ${y.path}`);b+="; Path="+y.path}if(y.expires){if(!f(y.expires)||!Number.isFinite(y.expires.valueOf()))throw new TypeError(`option expires is invalid: ${y.expires}`);b+="; Expires="+y.expires.toUTCString()}if(y.httpOnly&&(b+="; HttpOnly"),y.secure&&(b+="; Secure"),y.partitioned&&(b+="; Partitioned"),y.priority)switch(typeof y.priority=="string"?y.priority.toLowerCase():void 0){case"low":b+="; Priority=Low";break;case"medium":b+="; Priority=Medium";break;case"high":b+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${y.priority}`)}if(y.sameSite)switch(typeof y.sameSite=="string"?y.sameSite.toLowerCase():y.sameSite){case!0:case"strict":b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"none":b+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${y.sameSite}`)}return b}function d(p){if(p.indexOf("%")===-1)return p;try{return decodeURIComponent(p)}catch{return p}}function f(p){return i.call(p)==="[object Date]"}return _E}ioe();var _4="popstate";function soe(t={}){function e(i,s){let{pathname:o="/",search:a="",hash:A=""}=Gf(i.location.hash.substring(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),W1("",{pathname:o,search:a,hash:A},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(i,s){let o=i.document.querySelector("base"),a="";if(o&&o.getAttribute("href")){let A=i.location.href,l=A.indexOf("#");a=l===-1?A:A.slice(0,l)}return a+"#"+(typeof s=="string"?s:Yy(s))}function r(i,s){Na(i.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(s)})`)}return aoe(e,n,r,t)}function jr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Na(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function ooe(){return Math.random().toString(36).substring(2,10)}function E4(t,e){return{usr:t.state,key:t.key,idx:e}}function W1(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Gf(e):e,state:n,key:e&&e.key||r||ooe()}}function Yy({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Gf(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function aoe(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a="POP",A=null,l=d();l==null&&(l=0,o.replaceState({...o.state,idx:l},""));function d(){return(o.state||{idx:null}).idx}function f(){a="POP";let w=d(),b=w==null?null:w-l;l=w,A&&A({action:a,location:E.location,delta:b})}function p(w,b){a="PUSH";let I=W1(E.location,w,b);n&&n(I,w),l=d()+1;let B=E4(I,l),U=E.createHref(I);try{o.pushState(B,"",U)}catch(H){if(H instanceof DOMException&&H.name==="DataCloneError")throw H;i.location.assign(U)}s&&A&&A({action:a,location:E.location,delta:1})}function g(w,b){a="REPLACE";let I=W1(E.location,w,b);n&&n(I,w),l=d();let B=E4(I,l),U=E.createHref(I);o.replaceState(B,"",U),s&&A&&A({action:a,location:E.location,delta:0})}function y(w){let b=i.location.origin!=="null"?i.location.origin:i.location.href,I=typeof w=="string"?w:Yy(w);return I=I.replace(/ $/,"%20"),jr(b,`No window.location.(origin|href) available to create URL for href: ${I}`),new URL(I,b)}let E={get action(){return a},get location(){return t(i,o)},listen(w){if(A)throw new Error("A history only accepts one active listener");return i.addEventListener(_4,f),A=w,()=>{i.removeEventListener(_4,f),A=null}},createHref(w){return e(i,w)},createURL:y,encodeLocation(w){let b=y(w);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:p,replace:g,go(w){return o.go(w)}};return E}function s7(t,e,n="/"){return coe(t,e,n,!1)}function coe(t,e,n,r){let i=typeof e=="string"?Gf(e):e,s=Au(i.pathname||"/",n);if(s==null)return null;let o=o7(t);Aoe(o);let a=null;for(let A=0;a==null&&A<o.length;++A){let l=yoe(s);a=_oe(o[A],l,r)}return a}function o7(t,e=[],n=[],r=""){let i=(s,o,a)=>{let A={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};A.relativePath.startsWith("/")&&(jr(A.relativePath.startsWith(r),`Absolute route path "${A.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),A.relativePath=A.relativePath.slice(r.length));let l=ru([r,A.relativePath]),d=n.concat(A);s.children&&s.children.length>0&&(jr(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${l}".`),o7(s.children,e,d,l)),!(s.path==null&&!s.index)&&e.push({path:l,score:moe(l,s.index),routesMeta:d})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,o);else for(let A of a7(s.path))i(s,o,A)}),e}function a7(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=a7(r.join("/")),a=[];return a.push(...o.map(A=>A===""?s:[s,A].join("/"))),i&&a.push(...o),a.map(A=>t.startsWith("/")&&A===""?"/":A)}function Aoe(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:goe(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var loe=/^:[\w-]+$/,uoe=3,doe=2,hoe=1,foe=10,poe=-2,y4=t=>t==="*";function moe(t,e){let n=t.split("/"),r=n.length;return n.some(y4)&&(r+=poe),e&&(r+=doe),n.filter(i=>!y4(i)).reduce((i,s)=>i+(loe.test(s)?uoe:s===""?hoe:foe),r)}function goe(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function _oe(t,e,n=!1){let{routesMeta:r}=t,i={},s="/",o=[];for(let a=0;a<r.length;++a){let A=r[a],l=a===r.length-1,d=s==="/"?e:e.slice(s.length)||"/",f=gS({path:A.relativePath,caseSensitive:A.caseSensitive,end:l},d),p=A.route;if(!f&&l&&n&&!r[r.length-1].route.index&&(f=gS({path:A.relativePath,caseSensitive:A.caseSensitive,end:!1},d)),!f)return null;Object.assign(i,f.params),o.push({params:i,pathname:ru([s,f.pathname]),pathnameBase:Toe(ru([s,f.pathnameBase])),route:p}),f.pathnameBase!=="/"&&(s=ru([s,f.pathnameBase]))}return o}function gS(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=Eoe(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((l,{paramName:d,isOptional:f},p)=>{if(d==="*"){let y=a[p]||"";o=s.slice(0,s.length-y.length).replace(/(.)\/+$/,"$1")}const g=a[p];return f&&!g?l[d]=void 0:l[d]=(g||"").replace(/%2F/g,"/"),l},{}),pathname:s,pathnameBase:o,pattern:t}}function Eoe(t,e=!1,n=!0){Na(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,A)=>(r.push({paramName:a,isOptional:A!=null}),A?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function yoe(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Na(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Au(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function voe(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?Gf(t):t;return{pathname:n?n.startsWith("/")?n:woe(n,e):e,search:Soe(r),hash:boe(i)}}function woe(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function bN(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Coe(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function OU(t){let e=Coe(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function NU(t,e,n,r=!1){let i;typeof t=="string"?i=Gf(t):(i={...t},jr(!i.pathname||!i.pathname.includes("?"),bN("?","pathname","search",i)),jr(!i.pathname||!i.pathname.includes("#"),bN("#","pathname","hash",i)),jr(!i.search||!i.search.includes("#"),bN("#","search","hash",i)));let s=t===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let p=o.split("/");for(;p[0]==="..";)p.shift(),f-=1;i.pathname=p.join("/")}a=f>=0?e[f]:"/"}let A=voe(i,a),l=o&&o!=="/"&&o.endsWith("/"),d=(s||o===".")&&n.endsWith("/");return!A.pathname.endsWith("/")&&(l||d)&&(A.pathname+="/"),A}var ru=t=>t.join("/").replace(/\/\/+/g,"/"),Toe=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Soe=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,boe=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Ioe(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var c7=["POST","PUT","PATCH","DELETE"];new Set(c7);var Roe=["GET",...c7];new Set(Roe);var Gg=J.createContext(null);Gg.displayName="DataRouter";var Kb=J.createContext(null);Kb.displayName="DataRouterState";var A7=J.createContext({isTransitioning:!1});A7.displayName="ViewTransition";var Ooe=J.createContext(new Map);Ooe.displayName="Fetchers";var Noe=J.createContext(null);Noe.displayName="Await";var eA=J.createContext(null);eA.displayName="Navigation";var Kv=J.createContext(null);Kv.displayName="Location";var il=J.createContext({outlet:null,matches:[],isDataRoute:!1});il.displayName="Route";var DU=J.createContext(null);DU.displayName="RouteError";function Doe(t,{relative:e}={}){jr(Wg(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=J.useContext(eA),{hash:i,pathname:s,search:o}=Gv(t,{relative:e}),a=s;return n!=="/"&&(a=s==="/"?n:ru([n,s])),r.createHref({pathname:a,search:o,hash:i})}function Wg(){return J.useContext(Kv)!=null}function Eu(){return jr(Wg(),"useLocation() may be used only in the context of a <Router> component."),J.useContext(Kv).location}var l7="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function u7(t){J.useContext(eA).static||J.useLayoutEffect(t)}function zg(){let{isDataRoute:t}=J.useContext(il);return t?Koe():Boe()}function Boe(){jr(Wg(),"useNavigate() may be used only in the context of a <Router> component.");let t=J.useContext(Gg),{basename:e,navigator:n}=J.useContext(eA),{matches:r}=J.useContext(il),{pathname:i}=Eu(),s=JSON.stringify(OU(r)),o=J.useRef(!1);return u7(()=>{o.current=!0}),J.useCallback((A,l={})=>{if(Na(o.current,l7),!o.current)return;if(typeof A=="number"){n.go(A);return}let d=NU(A,JSON.parse(s),i,l.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:ru([e,d.pathname])),(l.replace?n.replace:n.push)(d,l.state,l)},[e,n,s,i,t])}J.createContext(null);function Gv(t,{relative:e}={}){let{matches:n}=J.useContext(il),{pathname:r}=Eu(),i=JSON.stringify(OU(n));return J.useMemo(()=>NU(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function Loe(t,e){return d7(t,e)}function d7(t,e,n,r){var I;jr(Wg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i,static:s}=J.useContext(eA),{matches:o}=J.useContext(il),a=o[o.length-1],A=a?a.params:{},l=a?a.pathname:"/",d=a?a.pathnameBase:"/",f=a&&a.route;{let B=f&&f.path||"";h7(l,!f||B.endsWith("*")||B.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${l}" (under <Route path="${B}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${B}"> to <Route path="${B==="/"?"*":`${B}/*`}">.`)}let p=Eu(),g;if(e){let B=typeof e=="string"?Gf(e):e;jr(d==="/"||((I=B.pathname)==null?void 0:I.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${B.pathname}" was given in the \`location\` prop.`),g=B}else g=p;let y=g.pathname||"/",E=y;if(d!=="/"){let B=d.replace(/^\//,"").split("/");E="/"+y.replace(/^\//,"").split("/").slice(B.length).join("/")}let w=!s&&n&&n.matches&&n.matches.length>0?n.matches:s7(t,{pathname:E});Na(f||w!=null,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),Na(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=Moe(w&&w.map(B=>Object.assign({},B,{params:Object.assign({},A,B.params),pathname:ru([d,i.encodeLocation?i.encodeLocation(B.pathname).pathname:B.pathname]),pathnameBase:B.pathnameBase==="/"?d:ru([d,i.encodeLocation?i.encodeLocation(B.pathnameBase).pathname:B.pathnameBase])})),o,n,r);return e&&b?J.createElement(Kv.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},b):b}function Poe(){let t=joe(),e=Ioe(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=J.createElement(J.Fragment,null,J.createElement("p",null," Hey developer "),J.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",J.createElement("code",{style:s},"ErrorBoundary")," or"," ",J.createElement("code",{style:s},"errorElement")," prop on your route.")),J.createElement(J.Fragment,null,J.createElement("h2",null,"Unexpected Application Error!"),J.createElement("h3",{style:{fontStyle:"italic"}},e),n?J.createElement("pre",{style:i},n):null,o)}var Uoe=J.createElement(Poe,null),koe=class extends J.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?J.createElement(il.Provider,{value:this.props.routeContext},J.createElement(DU.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function xoe({routeContext:t,match:e,children:n}){let r=J.useContext(Gg);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),J.createElement(il.Provider,{value:t},n)}function Moe(t,e=[],n=null,r=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,s=n==null?void 0:n.errors;if(s!=null){let A=i.findIndex(l=>l.route.id&&(s==null?void 0:s[l.route.id])!==void 0);jr(A>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),i=i.slice(0,Math.min(i.length,A+1))}let o=!1,a=-1;if(n)for(let A=0;A<i.length;A++){let l=i[A];if((l.route.HydrateFallback||l.route.hydrateFallbackElement)&&(a=A),l.route.id){let{loaderData:d,errors:f}=n,p=l.route.loader&&!d.hasOwnProperty(l.route.id)&&(!f||f[l.route.id]===void 0);if(l.route.lazy||p){o=!0,a>=0?i=i.slice(0,a+1):i=[i[0]];break}}}return i.reduceRight((A,l,d)=>{let f,p=!1,g=null,y=null;n&&(f=s&&l.route.id?s[l.route.id]:void 0,g=l.route.errorElement||Uoe,o&&(a<0&&d===0?(h7("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),p=!0,y=null):a===d&&(p=!0,y=l.route.hydrateFallbackElement||null)));let E=e.concat(i.slice(0,d+1)),w=()=>{let b;return f?b=g:p?b=y:l.route.Component?b=J.createElement(l.route.Component,null):l.route.element?b=l.route.element:b=A,J.createElement(xoe,{match:l,routeContext:{outlet:A,matches:E,isDataRoute:n!=null},children:b})};return n&&(l.route.ErrorBoundary||l.route.errorElement||d===0)?J.createElement(koe,{location:n.location,revalidation:n.revalidation,component:g,error:f,children:w(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):w()},null)}function BU(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Foe(t){let e=J.useContext(Gg);return jr(e,BU(t)),e}function Voe(t){let e=J.useContext(Kb);return jr(e,BU(t)),e}function Qoe(t){let e=J.useContext(il);return jr(e,BU(t)),e}function LU(t){let e=Qoe(t),n=e.matches[e.matches.length-1];return jr(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function Hoe(){return LU("useRouteId")}function joe(){var r;let t=J.useContext(DU),e=Voe("useRouteError"),n=LU("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function Koe(){let{router:t}=Foe("useNavigate"),e=LU("useNavigate"),n=J.useRef(!1);return u7(()=>{n.current=!0}),J.useCallback(async(i,s={})=>{Na(n.current,l7),n.current&&(typeof i=="number"?t.navigate(i):await t.navigate(i,{fromRouteId:e,...s}))},[t,e])}var v4={};function h7(t,e,n){!e&&!v4[t]&&(v4[t]=!0,Na(!1,n))}J.memo(Goe);function Goe({routes:t,future:e,state:n}){return d7(t,void 0,n,e)}function QC({to:t,replace:e,state:n,relative:r}){jr(Wg(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=J.useContext(eA);Na(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:s}=J.useContext(il),{pathname:o}=Eu(),a=zg(),A=NU(t,OU(s),o,r==="path"),l=JSON.stringify(A);return J.useEffect(()=>{a(JSON.parse(l),{replace:e,state:n,relative:r})},[a,l,r,e,n]),null}function gm(t){jr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Woe({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:s=!1}){jr(!Wg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),a=J.useMemo(()=>({basename:o,navigator:i,static:s,future:{}}),[o,i,s]);typeof n=="string"&&(n=Gf(n));let{pathname:A="/",search:l="",hash:d="",state:f=null,key:p="default"}=n,g=J.useMemo(()=>{let y=Au(A,o);return y==null?null:{location:{pathname:y,search:l,hash:d,state:f,key:p},navigationType:r}},[o,A,l,d,f,p,r]);return Na(g!=null,`<Router basename="${o}"> is not able to match the URL "${A}${l}${d}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:J.createElement(eA.Provider,{value:a},J.createElement(Kv.Provider,{children:e,value:g}))}function zoe({children:t,location:e}){return Loe(z1(t),e)}function z1(t,e=[]){let n=[];return J.Children.forEach(t,(r,i)=>{if(!J.isValidElement(r))return;let s=[...e,i];if(r.type===J.Fragment){n.push.apply(n,z1(r.props.children,s));return}jr(r.type===gm,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),jr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=z1(r.props.children,s)),n.push(o)}),n}var v0="get",w0="application/x-www-form-urlencoded";function Gb(t){return t!=null&&typeof t.tagName=="string"}function qoe(t){return Gb(t)&&t.tagName.toLowerCase()==="button"}function Yoe(t){return Gb(t)&&t.tagName.toLowerCase()==="form"}function Xoe(t){return Gb(t)&&t.tagName.toLowerCase()==="input"}function Joe(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function $oe(t,e){return t.button===0&&(!e||e==="_self")&&!Joe(t)}function q1(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function Zoe(t,e){let n=q1(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(s=>{n.append(i,s)})}),n}var HC=null;function eae(){if(HC===null)try{new FormData(document.createElement("form"),0),HC=!1}catch{HC=!0}return HC}var tae=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function IN(t){return t!=null&&!tae.has(t)?(Na(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${w0}"`),null):t}function nae(t,e){let n,r,i,s,o;if(Yoe(t)){let a=t.getAttribute("action");r=a?Au(a,e):null,n=t.getAttribute("method")||v0,i=IN(t.getAttribute("enctype"))||w0,s=new FormData(t)}else if(qoe(t)||Xoe(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let A=t.getAttribute("formaction")||a.getAttribute("action");if(r=A?Au(A,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||v0,i=IN(t.getAttribute("formenctype"))||IN(a.getAttribute("enctype"))||w0,s=new FormData(a,t),!eae()){let{name:l,type:d,value:f}=t;if(d==="image"){let p=l?`${l}.`:"";s.append(`${p}x`,"0"),s.append(`${p}y`,"0")}else l&&s.append(l,f)}}else{if(Gb(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=v0,r=null,i=w0,o=t}return s&&i==="text/plain"&&(o=s,s=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:s,body:o}}function PU(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function rae(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function iae(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function sae(t,e,n){let r=await Promise.all(t.map(async i=>{let s=e.routes[i.route.id];if(s){let o=await rae(s,n);return o.links?o.links():[]}return[]}));return Aae(r.flat(1).filter(iae).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function w4(t,e,n,r,i,s){let o=(A,l)=>n[l]?A.route.id!==n[l].route.id:!0,a=(A,l)=>{var d;return n[l].pathname!==A.pathname||((d=n[l].route.path)==null?void 0:d.endsWith("*"))&&n[l].params["*"]!==A.params["*"]};return s==="assets"?e.filter((A,l)=>o(A,l)||a(A,l)):s==="data"?e.filter((A,l)=>{var f;let d=r.routes[A.route.id];if(!d||!d.hasLoader)return!1;if(o(A,l)||a(A,l))return!0;if(A.route.shouldRevalidate){let p=A.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:A.params,defaultShouldRevalidate:!0});if(typeof p=="boolean")return p}return!0}):[]}function oae(t,e,{includeHydrateFallback:n}={}){return aae(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function aae(t){return[...new Set(t)]}function cae(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function Aae(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let s=JSON.stringify(cae(i));return n.has(s)||(n.add(s),r.push({key:s,link:i})),r},[])}var lae=new Set([100,101,204,205]);function uae(t,e){let n=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n.pathname==="/"?n.pathname="_root.data":e&&Au(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.data`:n.pathname=`${n.pathname.replace(/\/$/,"")}.data`,n}function f7(){let t=J.useContext(Gg);return PU(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function dae(){let t=J.useContext(Kb);return PU(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var UU=J.createContext(void 0);UU.displayName="FrameworkContext";function p7(){let t=J.useContext(UU);return PU(t,"You must render this element inside a <HydratedRouter> element"),t}function hae(t,e){let n=J.useContext(UU),[r,i]=J.useState(!1),[s,o]=J.useState(!1),{onFocus:a,onBlur:A,onMouseEnter:l,onMouseLeave:d,onTouchStart:f}=e,p=J.useRef(null);J.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let E=b=>{b.forEach(I=>{o(I.isIntersecting)})},w=new IntersectionObserver(E,{threshold:.5});return p.current&&w.observe(p.current),()=>{w.disconnect()}}},[t]),J.useEffect(()=>{if(r){let E=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(E)}}},[r]);let g=()=>{i(!0)},y=()=>{i(!1),o(!1)};return n?t!=="intent"?[s,p,{}]:[s,p,{onFocus:EE(a,g),onBlur:EE(A,y),onMouseEnter:EE(l,g),onMouseLeave:EE(d,y),onTouchStart:EE(f,g)}]:[!1,p,{}]}function EE(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function fae({page:t,...e}){let{router:n}=f7(),r=J.useMemo(()=>s7(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?J.createElement(mae,{page:t,matches:r,...e}):null}function pae(t){let{manifest:e,routeModules:n}=p7(),[r,i]=J.useState([]);return J.useEffect(()=>{let s=!1;return sae(t,e,n).then(o=>{s||i(o)}),()=>{s=!0}},[t,e,n]),r}function mae({page:t,matches:e,...n}){let r=Eu(),{manifest:i,routeModules:s}=p7(),{basename:o}=f7(),{loaderData:a,matches:A}=dae(),l=J.useMemo(()=>w4(t,e,A,i,r,"data"),[t,e,A,i,r]),d=J.useMemo(()=>w4(t,e,A,i,r,"assets"),[t,e,A,i,r]),f=J.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let y=new Set,E=!1;if(e.forEach(b=>{var B;let I=i.routes[b.route.id];!I||!I.hasLoader||(!l.some(U=>U.route.id===b.route.id)&&b.route.id in a&&((B=s[b.route.id])!=null&&B.shouldRevalidate)||I.hasClientLoader?E=!0:y.add(b.route.id))}),y.size===0)return[];let w=uae(t,o);return E&&y.size>0&&w.searchParams.set("_routes",e.filter(b=>y.has(b.route.id)).map(b=>b.route.id).join(",")),[w.pathname+w.search]},[o,a,r,i,l,e,t,s]),p=J.useMemo(()=>oae(d,i),[d,i]),g=pae(d);return J.createElement(J.Fragment,null,f.map(y=>J.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...n})),p.map(y=>J.createElement("link",{key:y,rel:"modulepreload",href:y,...n})),g.map(({key:y,link:E})=>J.createElement("link",{key:y,...E})))}function gae(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var m7=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{m7&&(window.__reactRouterVersion="7.5.3")}catch{}function _ae({basename:t,children:e,window:n}){let r=J.useRef();r.current==null&&(r.current=soe({window:n,v5Compat:!0}));let i=r.current,[s,o]=J.useState({action:i.action,location:i.location}),a=J.useCallback(A=>{J.startTransition(()=>o(A))},[o]);return J.useLayoutEffect(()=>i.listen(a),[i,a]),J.createElement(Woe,{basename:t,children:e,location:s.location,navigationType:s.action,navigator:i})}var g7=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,kU=J.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:s,replace:o,state:a,target:A,to:l,preventScrollReset:d,viewTransition:f,...p},g){let{basename:y}=J.useContext(eA),E=typeof l=="string"&&g7.test(l),w,b=!1;if(typeof l=="string"&&E&&(w=l,m7))try{let M=new URL(window.location.href),O=l.startsWith("//")?new URL(M.protocol+l):new URL(l),z=Au(O.pathname,y);O.origin===M.origin&&z!=null?l=z+O.search+O.hash:b=!0}catch{Na(!1,`<Link to="${l}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let I=Doe(l,{relative:i}),[B,U,H]=hae(r,p),K=wae(l,{replace:o,state:a,target:A,preventScrollReset:d,relative:i,viewTransition:f});function x(M){e&&e(M),M.defaultPrevented||K(M)}let V=J.createElement("a",{...p,...H,href:w||I,onClick:b||s?e:x,ref:gae(g,U),target:A,"data-discover":!E&&n==="render"?"true":void 0});return B&&!E?J.createElement(J.Fragment,null,V,J.createElement(fae,{page:I})):V});kU.displayName="Link";var Eae=J.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:s,to:o,viewTransition:a,children:A,...l},d){let f=Gv(o,{relative:l.relative}),p=Eu(),g=J.useContext(Kb),{navigator:y,basename:E}=J.useContext(eA),w=g!=null&&Rae(f)&&a===!0,b=y.encodeLocation?y.encodeLocation(f).pathname:f.pathname,I=p.pathname,B=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;n||(I=I.toLowerCase(),B=B?B.toLowerCase():null,b=b.toLowerCase()),B&&E&&(B=Au(B,E)||B);const U=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let H=I===b||!i&&I.startsWith(b)&&I.charAt(U)==="/",K=B!=null&&(B===b||!i&&B.startsWith(b)&&B.charAt(b.length)==="/"),x={isActive:H,isPending:K,isTransitioning:w},V=H?e:void 0,M;typeof r=="function"?M=r(x):M=[r,H?"active":null,K?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let O=typeof s=="function"?s(x):s;return J.createElement(kU,{...l,"aria-current":V,className:M,ref:d,style:O,to:o,viewTransition:a},typeof A=="function"?A(x):A)});Eae.displayName="NavLink";var yae=J.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:s,method:o=v0,action:a,onSubmit:A,relative:l,preventScrollReset:d,viewTransition:f,...p},g)=>{let y=bae(),E=Iae(a,{relative:l}),w=o.toLowerCase()==="get"?"get":"post",b=typeof a=="string"&&g7.test(a),I=B=>{if(A&&A(B),B.defaultPrevented)return;B.preventDefault();let U=B.nativeEvent.submitter,H=(U==null?void 0:U.getAttribute("formmethod"))||o;y(U||B.currentTarget,{fetcherKey:e,method:H,navigate:n,replace:i,state:s,relative:l,preventScrollReset:d,viewTransition:f})};return J.createElement("form",{ref:g,method:w,action:E,onSubmit:r?A:I,...p,"data-discover":!b&&t==="render"?"true":void 0})});yae.displayName="Form";function vae(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function _7(t){let e=J.useContext(Gg);return jr(e,vae(t)),e}function wae(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:s,viewTransition:o}={}){let a=zg(),A=Eu(),l=Gv(t,{relative:s});return J.useCallback(d=>{if($oe(d,e)){d.preventDefault();let f=n!==void 0?n:Yy(A)===Yy(l);a(t,{replace:f,state:r,preventScrollReset:i,relative:s,viewTransition:o})}},[A,a,l,n,r,e,t,i,s,o])}function Cae(t){Na(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=J.useRef(q1(t)),n=J.useRef(!1),r=Eu(),i=J.useMemo(()=>Zoe(r.search,n.current?null:e.current),[r.search]),s=zg(),o=J.useCallback((a,A)=>{const l=q1(typeof a=="function"?a(i):a);n.current=!0,s("?"+l,A)},[s,i]);return[i,o]}var Tae=0,Sae=()=>`__${String(++Tae)}__`;function bae(){let{router:t}=_7("useSubmit"),{basename:e}=J.useContext(eA),n=Hoe();return J.useCallback(async(r,i={})=>{let{action:s,method:o,encType:a,formData:A,body:l}=nae(r,e);if(i.navigate===!1){let d=i.fetcherKey||Sae();await t.fetch(d,n,i.action||s,{preventScrollReset:i.preventScrollReset,formData:A,body:l,formMethod:i.method||o,formEncType:i.encType||a,flushSync:i.flushSync})}else await t.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:A,body:l,formMethod:i.method||o,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[t,e,n])}function Iae(t,{relative:e}={}){let{basename:n}=J.useContext(eA),r=J.useContext(il);jr(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),s={...Gv(t||".",{relative:e})},o=Eu();if(t==null){s.search=o.search;let a=new URLSearchParams(s.search),A=a.getAll("index");if(A.some(d=>d==="")){a.delete("index"),A.filter(f=>f).forEach(f=>a.append("index",f));let d=a.toString();s.search=d?`?${d}`:""}}return(!t||t===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(s.pathname=s.pathname==="/"?n:ru([n,s.pathname])),Yy(s)}function Rae(t,e={}){let n=J.useContext(A7);jr(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=_7("useViewTransitionState"),i=Gv(t,{relative:e.relative});if(!n.isTransitioning)return!1;let s=Au(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=Au(n.nextLocation.pathname,r)||n.nextLocation.pathname;return gS(i.pathname,o)!=null||gS(i.pathname,s)!=null}new TextEncoder;[...lae];const Oae=()=>{};var C4={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E7={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fe=function(t,e){if(!t)throw qg(e)},qg=function(t){return new Error("Firebase Database ("+E7.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y7=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},Nae=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],o=t[n++],a=t[n++],A=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(A>>10)),e[r++]=String.fromCharCode(56320+(A&1023))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},xU={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],o=i+1<t.length,a=o?t[i+1]:0,A=i+2<t.length,l=A?t[i+2]:0,d=s>>2,f=(s&3)<<4|a>>4;let p=(a&15)<<2|l>>6,g=l&63;A||(g=64,o||(p=64)),r.push(n[d],n[f],n[p],n[g])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(y7(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Nae(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const l=i<t.length?n[t.charAt(i)]:64;++i;const f=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||l==null||f==null)throw new Dae;const p=s<<2|a>>4;if(r.push(p),l!==64){const g=a<<4&240|l>>2;if(r.push(g),f!==64){const y=l<<6&192|f;r.push(y)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Dae extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const v7=function(t){const e=y7(t);return xU.encodeByteArray(e,!0)},_S=function(t){return v7(t).replace(/\./g,"")},ES=function(t){try{return xU.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bae(t){return w7(void 0,t)}function w7(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!Lae(n)||(t[n]=w7(t[n],e[n]));return t}function Lae(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pae(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uae=()=>Pae().__FIREBASE_DEFAULTS__,kae=()=>{if(typeof process>"u"||typeof C4>"u")return;const t=C4.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},xae=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&ES(t[1]);return e&&JSON.parse(e)},Wb=()=>{try{return Oae()||Uae()||kae()||xae()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},C7=t=>{var e,n;return(n=(e=Wb())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},MU=t=>{const e=C7(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},T7=()=>{var t;return(t=Wb())===null||t===void 0?void 0:t.config},S7=t=>{var e;return(e=Wb())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FA{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sl(t){return t.endsWith(".cloudworkstations.dev")}async function zb(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FU(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[_S(JSON.stringify(n)),_S(JSON.stringify(o)),""].join(".")}const my={};function Mae(){const t={prod:[],emulator:[]};for(const e of Object.keys(my))my[e]?t.emulator.push(e):t.prod.push(e);return t}function Fae(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let T4=!1;function qb(t,e){if(typeof window>"u"||typeof document>"u"||!sl(window.location.host)||my[t]===e||my[t]||T4)return;my[t]=e;function n(p){return`__firebase__banner__${p}`}const r="__firebase__banner",s=Mae().prod.length>0;function o(){const p=document.getElementById(r);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function A(p,g){p.setAttribute("width","24"),p.setAttribute("id",g),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function l(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{T4=!0,o()},p}function d(p,g){p.setAttribute("id",g),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function f(){const p=Fae(r),g=n("text"),y=document.getElementById(g)||document.createElement("span"),E=n("learnmore"),w=document.getElementById(E)||document.createElement("a"),b=n("preprendIcon"),I=document.getElementById(b)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const B=p.element;a(B),d(w,E);const U=l();A(I,b),B.append(I,y,w,U),document.body.appendChild(B)}s?(y.innerText="Preview backend disconnected.",I.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(I.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,y.innerText="Preview backend running in this workspace."),y.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",f):f()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uo(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function VU(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(uo())}function Vae(){var t;const e=(t=Wb())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Qae(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function b7(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function I7(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Hae(){const t=uo();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function jae(){return E7.NODE_ADMIN===!0}function Kae(){return!Vae()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function R7(){try{return typeof indexedDB=="object"}catch{return!1}}function O7(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}function Gae(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wae="FirebaseError";class yc extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=Wae,Object.setPrototypeOf(this,yc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Wf.prototype.create)}}class Wf{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?zae(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new yc(i,a,r)}}function zae(t,e){return t.replace(qae,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const qae=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xy(t){return JSON.parse(t)}function As(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N7=function(t){let e={},n={},r={},i="";try{const s=t.split(".");e=Xy(ES(s[0])||""),n=Xy(ES(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:i}},Yae=function(t){const e=N7(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},Xae=function(t){const e=N7(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ol(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ug(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function yS(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function vS(t,e,n){const r={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}function lu(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],o=e[i];if(S4(s)&&S4(o)){if(!lu(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function S4(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yg(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jae{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let f=0;f<16;f++)r[f]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let f=16;f<80;f++){const p=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(p<<1|p>>>31)&4294967295}let i=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],A=this.chain_[4],l,d;for(let f=0;f<80;f++){f<40?f<20?(l=a^s&(o^a),d=1518500249):(l=s^o^a,d=1859775393):f<60?(l=s&o|a&(s|o),d=2400959708):(l=s^o^a,d=3395469782);const p=(i<<5|i>>>27)+l+A+d+r[f]&4294967295;A=a,a=o,o=(s<<30|s>>>2)&4294967295,s=i,i=p}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+A&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let i=0;const s=this.buf_;let o=this.inbuf_;for(;i<n;){if(o===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<n;)if(s[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}else for(;i<n;)if(s[o]=e[i],++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let s=24;s>=0;s-=8)e[r]=this.chain_[i]>>s&255,++r;return e}}function $ae(t,e){const n=new Zae(t,e);return n.subscribe.bind(n)}class Zae{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");ece(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=RN),i.error===void 0&&(i.error=RN),i.complete===void 0&&(i.complete=RN);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ece(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function RN(){}function dg(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tce=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);if(i>=55296&&i<=56319){const s=i-55296;r++,Fe(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;i=65536+(s<<10)+o}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},Yb=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nce=1e3,rce=2,ice=4*60*60*1e3,sce=.5;function b4(t,e=nce,n=rce){const r=e*Math.pow(n,t),i=Math.round(sce*r*(Math.random()-.5)*2);return Math.min(ice,r+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ci(t){return t&&t._delegate?t._delegate:t}class Da{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $h="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oce{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new FA;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(cce(e))try{this.getOrInitializeService({instanceIdentifier:$h})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=$h){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=$h){return this.instances.has(e)}getOptions(e=$h){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){var r;const i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:ace(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=$h){return this.component?this.component.multipleInstances?e:$h:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ace(t){return t===$h?void 0:t}function cce(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ace{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new oce(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fn;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(fn||(fn={}));const lce={debug:fn.DEBUG,verbose:fn.VERBOSE,info:fn.INFO,warn:fn.WARN,error:fn.ERROR,silent:fn.SILENT},uce=fn.INFO,dce={[fn.DEBUG]:"log",[fn.VERBOSE]:"log",[fn.INFO]:"info",[fn.WARN]:"warn",[fn.ERROR]:"error"},hce=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=dce[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let Wv=class{constructor(e){this.name=e,this._logLevel=uce,this._logHandler=hce,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in fn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?lce[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,fn.DEBUG,...e),this._logHandler(this,fn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,fn.VERBOSE,...e),this._logHandler(this,fn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,fn.INFO,...e),this._logHandler(this,fn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,fn.WARN,...e),this._logHandler(this,fn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,fn.ERROR,...e),this._logHandler(this,fn.ERROR,...e)}};const fce=(t,e)=>e.some(n=>t instanceof n);let I4,R4;function pce(){return I4||(I4=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function mce(){return R4||(R4=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const D7=new WeakMap,Y1=new WeakMap,B7=new WeakMap,ON=new WeakMap,QU=new WeakMap;function gce(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(Bd(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&D7.set(n,t)}).catch(()=>{}),QU.set(e,t),e}function _ce(t){if(Y1.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});Y1.set(t,e)}let X1={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Y1.get(t);if(e==="objectStoreNames")return t.objectStoreNames||B7.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Bd(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Ece(t){X1=t(X1)}function yce(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(NN(this),e,...n);return B7.set(r,e.sort?e.sort():[e]),Bd(r)}:mce().includes(t)?function(...e){return t.apply(NN(this),e),Bd(D7.get(this))}:function(...e){return Bd(t.apply(NN(this),e))}}function vce(t){return typeof t=="function"?yce(t):(t instanceof IDBTransaction&&_ce(t),fce(t,pce())?new Proxy(t,X1):t)}function Bd(t){if(t instanceof IDBRequest)return gce(t);if(ON.has(t))return ON.get(t);const e=vce(t);return e!==t&&(ON.set(t,e),QU.set(e,t)),e}const NN=t=>QU.get(t);function L7(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=Bd(o);return r&&o.addEventListener("upgradeneeded",A=>{r(Bd(o.result),A.oldVersion,A.newVersion,Bd(o.transaction),A)}),n&&o.addEventListener("blocked",A=>n(A.oldVersion,A.newVersion,A)),a.then(A=>{s&&A.addEventListener("close",()=>s()),i&&A.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const wce=["get","getKey","getAll","getAllKeys","count"],Cce=["put","add","delete","clear"],DN=new Map;function O4(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(DN.get(e))return DN.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=Cce.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||wce.includes(n)))return;const s=async function(o,...a){const A=this.transaction(o,i?"readwrite":"readonly");let l=A.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),i&&A.done]))[0]};return DN.set(e,s),s}Ece(t=>({...t,get:(e,n,r)=>O4(e,n)||t.get(e,n,r),has:(e,n)=>!!O4(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tce{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Sce(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function Sce(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const J1="@firebase/app",N4="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uu=new Wv("@firebase/app"),bce="@firebase/app-compat",Ice="@firebase/analytics-compat",Rce="@firebase/analytics",Oce="@firebase/app-check-compat",Nce="@firebase/app-check",Dce="@firebase/auth",Bce="@firebase/auth-compat",Lce="@firebase/database",Pce="@firebase/data-connect",Uce="@firebase/database-compat",kce="@firebase/functions",xce="@firebase/functions-compat",Mce="@firebase/installations",Fce="@firebase/installations-compat",Vce="@firebase/messaging",Qce="@firebase/messaging-compat",Hce="@firebase/performance",jce="@firebase/performance-compat",Kce="@firebase/remote-config",Gce="@firebase/remote-config-compat",Wce="@firebase/storage",zce="@firebase/storage-compat",qce="@firebase/firestore",Yce="@firebase/ai",Xce="@firebase/firestore-compat",Jce="firebase",$ce="11.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $1="[DEFAULT]",Zce={[J1]:"fire-core",[bce]:"fire-core-compat",[Rce]:"fire-analytics",[Ice]:"fire-analytics-compat",[Nce]:"fire-app-check",[Oce]:"fire-app-check-compat",[Dce]:"fire-auth",[Bce]:"fire-auth-compat",[Lce]:"fire-rtdb",[Pce]:"fire-data-connect",[Uce]:"fire-rtdb-compat",[kce]:"fire-fn",[xce]:"fire-fn-compat",[Mce]:"fire-iid",[Fce]:"fire-iid-compat",[Vce]:"fire-fcm",[Qce]:"fire-fcm-compat",[Hce]:"fire-perf",[jce]:"fire-perf-compat",[Kce]:"fire-rc",[Gce]:"fire-rc-compat",[Wce]:"fire-gcs",[zce]:"fire-gcs-compat",[qce]:"fire-fst",[Xce]:"fire-fst-compat",[Yce]:"fire-vertex","fire-js":"fire-js",[Jce]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wS=new Map,eAe=new Map,Z1=new Map;function D4(t,e){try{t.container.addComponent(e)}catch(n){uu.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function _c(t){const e=t.name;if(Z1.has(e))return uu.debug(`There were multiple attempts to register component ${e}.`),!1;Z1.set(e,t);for(const n of wS.values())D4(n,t);for(const n of eAe.values())D4(n,t);return!0}function yu(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function cc(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tAe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ld=new Wf("app","Firebase",tAe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nAe{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Da("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ld.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ah=$ce;function P7(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:$1,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw Ld.create("bad-app-name",{appName:String(i)});if(n||(n=T7()),!n)throw Ld.create("no-options");const s=wS.get(i);if(s){if(lu(n,s.options)&&lu(r,s.config))return s;throw Ld.create("duplicate-app",{appName:i})}const o=new Ace(i);for(const A of Z1.values())o.addComponent(A);const a=new nAe(n,r,o);return wS.set(i,a),a}function zv(t=$1){const e=wS.get(t);if(!e&&t===$1&&T7())return P7();if(!e)throw Ld.create("no-app",{appName:t});return e}function lo(t,e,n){var r;let i=(r=Zce[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),uu.warn(a.join(" "));return}_c(new Da(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rAe="firebase-heartbeat-database",iAe=1,Jy="firebase-heartbeat-store";let BN=null;function U7(){return BN||(BN=L7(rAe,iAe,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Jy)}catch(n){console.warn(n)}}}}).catch(t=>{throw Ld.create("idb-open",{originalErrorMessage:t.message})})),BN}async function sAe(t){try{const n=(await U7()).transaction(Jy),r=await n.objectStore(Jy).get(k7(t));return await n.done,r}catch(e){if(e instanceof yc)uu.warn(e.message);else{const n=Ld.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});uu.warn(n.message)}}}async function B4(t,e){try{const r=(await U7()).transaction(Jy,"readwrite");await r.objectStore(Jy).put(e,k7(t)),await r.done}catch(n){if(n instanceof yc)uu.warn(n.message);else{const r=Ld.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});uu.warn(r.message)}}}function k7(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oAe=1024,aAe=30;class cAe{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new lAe(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=L4();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>aAe){const o=uAe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){uu.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=L4(),{heartbeatsToSend:r,unsentEntries:i}=AAe(this._heartbeatsCache.heartbeats),s=_S(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(n){return uu.warn(n),""}}}function L4(){return new Date().toISOString().substring(0,10)}function AAe(t,e=oAe){const n=[];let r=t.slice();for(const i of t){const s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),P4(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),P4(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class lAe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return R7()?O7().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await sAe(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return B4(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return B4(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function P4(t){return _S(JSON.stringify({version:2,heartbeats:t})).length}function uAe(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dAe(t){_c(new Da("platform-logger",e=>new Tce(e),"PRIVATE")),_c(new Da("heartbeat",e=>new cAe(e),"PRIVATE")),lo(J1,N4,t),lo(J1,N4,"esm2017"),lo("fire-js","")}dAe("");var hAe="firebase",fAe="11.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */lo(hAe,fAe,"app");const x7="@firebase/installations",HU="0.6.17";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M7=1e4,F7=`w:${HU}`,V7="FIS_v2",pAe="https://firebaseinstallations.googleapis.com/v1",mAe=60*60*1e3,gAe="installations",_Ae="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EAe={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Bf=new Wf(gAe,_Ae,EAe);function Q7(t){return t instanceof yc&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function H7({projectId:t}){return`${pAe}/projects/${t}/installations`}function j7(t){return{token:t.token,requestStatus:2,expiresIn:vAe(t.expiresIn),creationTime:Date.now()}}async function K7(t,e){const r=(await e.json()).error;return Bf.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function G7({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function yAe(t,{refreshToken:e}){const n=G7(t);return n.append("Authorization",wAe(e)),n}async function W7(t){const e=await t();return e.status>=500&&e.status<600?t():e}function vAe(t){return Number(t.replace("s","000"))}function wAe(t){return`${V7} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CAe({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=H7(t),i=G7(t),s=e.getImmediate({optional:!0});if(s){const l=await s.getHeartbeatsHeader();l&&i.append("x-firebase-client",l)}const o={fid:n,authVersion:V7,appId:t.appId,sdkVersion:F7},a={method:"POST",headers:i,body:JSON.stringify(o)},A=await W7(()=>fetch(r,a));if(A.ok){const l=await A.json();return{fid:l.fid||n,registrationStatus:2,refreshToken:l.refreshToken,authToken:j7(l.authToken)}}else throw await K7("Create Installation",A)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z7(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TAe(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SAe=/^[cdef][\w-]{21}$/,eL="";function bAe(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=IAe(t);return SAe.test(n)?n:eL}catch{return eL}}function IAe(t){return TAe(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xb(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q7=new Map;function Y7(t,e){const n=Xb(t);X7(n,e),RAe(n,e)}function X7(t,e){const n=q7.get(t);if(n)for(const r of n)r(e)}function RAe(t,e){const n=OAe();n&&n.postMessage({key:t,fid:e}),NAe()}let lf=null;function OAe(){return!lf&&"BroadcastChannel"in self&&(lf=new BroadcastChannel("[Firebase] FID Change"),lf.onmessage=t=>{X7(t.data.key,t.data.fid)}),lf}function NAe(){q7.size===0&&lf&&(lf.close(),lf=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DAe="firebase-installations-database",BAe=1,Lf="firebase-installations-store";let LN=null;function jU(){return LN||(LN=L7(DAe,BAe,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Lf)}}})),LN}async function CS(t,e){const n=Xb(t),i=(await jU()).transaction(Lf,"readwrite"),s=i.objectStore(Lf),o=await s.get(n);return await s.put(e,n),await i.done,(!o||o.fid!==e.fid)&&Y7(t,e.fid),e}async function J7(t){const e=Xb(t),r=(await jU()).transaction(Lf,"readwrite");await r.objectStore(Lf).delete(e),await r.done}async function Jb(t,e){const n=Xb(t),i=(await jU()).transaction(Lf,"readwrite"),s=i.objectStore(Lf),o=await s.get(n),a=e(o);return a===void 0?await s.delete(n):await s.put(a,n),await i.done,a&&(!o||o.fid!==a.fid)&&Y7(t,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KU(t){let e;const n=await Jb(t.appConfig,r=>{const i=LAe(r),s=PAe(t,i);return e=s.registrationPromise,s.installationEntry});return n.fid===eL?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function LAe(t){const e=t||{fid:bAe(),registrationStatus:0};return $7(e)}function PAe(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(Bf.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=UAe(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:kAe(t)}:{installationEntry:e}}async function UAe(t,e){try{const n=await CAe(t,e);return CS(t.appConfig,n)}catch(n){throw Q7(n)&&n.customData.serverCode===409?await J7(t.appConfig):await CS(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function kAe(t){let e=await U4(t.appConfig);for(;e.registrationStatus===1;)await z7(100),e=await U4(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await KU(t);return r||n}return e}function U4(t){return Jb(t,e=>{if(!e)throw Bf.create("installation-not-found");return $7(e)})}function $7(t){return xAe(t)?{fid:t.fid,registrationStatus:0}:t}function xAe(t){return t.registrationStatus===1&&t.registrationTime+M7<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MAe({appConfig:t,heartbeatServiceProvider:e},n){const r=FAe(t,n),i=yAe(t,n),s=e.getImmediate({optional:!0});if(s){const l=await s.getHeartbeatsHeader();l&&i.append("x-firebase-client",l)}const o={installation:{sdkVersion:F7,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},A=await W7(()=>fetch(r,a));if(A.ok){const l=await A.json();return j7(l)}else throw await K7("Generate Auth Token",A)}function FAe(t,{fid:e}){return`${H7(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GU(t,e=!1){let n;const r=await Jb(t.appConfig,s=>{if(!Z7(s))throw Bf.create("not-registered");const o=s.authToken;if(!e&&HAe(o))return s;if(o.requestStatus===1)return n=VAe(t,e),s;{if(!navigator.onLine)throw Bf.create("app-offline");const a=KAe(s);return n=QAe(t,a),a}});return n?await n:r.authToken}async function VAe(t,e){let n=await k4(t.appConfig);for(;n.authToken.requestStatus===1;)await z7(100),n=await k4(t.appConfig);const r=n.authToken;return r.requestStatus===0?GU(t,e):r}function k4(t){return Jb(t,e=>{if(!Z7(e))throw Bf.create("not-registered");const n=e.authToken;return GAe(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function QAe(t,e){try{const n=await MAe(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await CS(t.appConfig,r),n}catch(n){if(Q7(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await J7(t.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await CS(t.appConfig,r)}throw n}}function Z7(t){return t!==void 0&&t.registrationStatus===2}function HAe(t){return t.requestStatus===2&&!jAe(t)}function jAe(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+mAe}function KAe(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function GAe(t){return t.requestStatus===1&&t.requestTime+M7<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WAe(t){const e=t,{installationEntry:n,registrationPromise:r}=await KU(e);return r?r.catch(console.error):GU(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zAe(t,e=!1){const n=t;return await qAe(n),(await GU(n,e)).token}async function qAe(t){const{registrationPromise:e}=await KU(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YAe(t){if(!t||!t.options)throw PN("App Configuration");if(!t.name)throw PN("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw PN(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function PN(t){return Bf.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eq="installations",XAe="installations-internal",JAe=t=>{const e=t.getProvider("app").getImmediate(),n=YAe(e),r=yu(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},$Ae=t=>{const e=t.getProvider("app").getImmediate(),n=yu(e,eq).getImmediate();return{getId:()=>WAe(n),getToken:i=>zAe(n,i)}};function ZAe(){_c(new Da(eq,JAe,"PUBLIC")),_c(new Da(XAe,$Ae,"PRIVATE"))}ZAe();lo(x7,HU);lo(x7,HU,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TS="analytics",ele="firebase_id",tle="origin",nle=60*1e3,rle="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",WU="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $o=new Wv("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ile={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Ia=new Wf("analytics","Analytics",ile);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sle(t){if(!t.startsWith(WU)){const e=Ia.create("invalid-gtag-resource",{gtagURL:t});return $o.warn(e.message),""}return t}function tq(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function ole(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function ale(t,e){const n=ole("firebase-js-sdk-policy",{createScriptURL:sle}),r=document.createElement("script"),i=`${WU}?l=${t}&id=${e}`;r.src=n?n==null?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function cle(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function Ale(t,e,n,r,i,s){const o=r[i];try{if(o)await e[o];else{const A=(await tq(n)).find(l=>l.measurementId===i);A&&await e[A.appId]}}catch(a){$o.error(a)}t("config",i,s)}async function lle(t,e,n,r,i){try{let s=[];if(i&&i.send_to){let o=i.send_to;Array.isArray(o)||(o=[o]);const a=await tq(n);for(const A of o){const l=a.find(f=>f.measurementId===A),d=l&&e[l.appId];if(d)s.push(d);else{s=[];break}}}s.length===0&&(s=Object.values(e)),await Promise.all(s),t("event",r,i||{})}catch(s){$o.error(s)}}function ule(t,e,n,r){async function i(s,...o){try{if(s==="event"){const[a,A]=o;await lle(t,e,n,a,A)}else if(s==="config"){const[a,A]=o;await Ale(t,e,n,r,a,A)}else if(s==="consent"){const[a,A]=o;t("consent",a,A)}else if(s==="get"){const[a,A,l]=o;t("get",a,A,l)}else if(s==="set"){const[a]=o;t("set",a)}else t(s,...o)}catch(a){$o.error(a)}}return i}function dle(t,e,n,r,i){let s=function(...o){window[r].push(arguments)};return window[i]&&typeof window[i]=="function"&&(s=window[i]),window[i]=ule(s,t,e,n),{gtagCore:s,wrappedGtag:window[i]}}function hle(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(WU)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fle=30,ple=1e3;class mle{constructor(e={},n=ple){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const nq=new mle;function gle(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function _le(t){var e;const{appId:n,apiKey:r}=t,i={method:"GET",headers:gle(r)},s=rle.replace("{app-id}",n),o=await fetch(s,i);if(o.status!==200&&o.status!==304){let a="";try{const A=await o.json();!((e=A.error)===null||e===void 0)&&e.message&&(a=A.error.message)}catch{}throw Ia.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function Ele(t,e=nq,n){const{appId:r,apiKey:i,measurementId:s}=t.options;if(!r)throw Ia.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw Ia.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new wle;return setTimeout(async()=>{a.abort()},nle),rq({appId:r,apiKey:i,measurementId:s},o,a,e)}async function rq(t,{throttleEndTimeMillis:e,backoffCount:n},r,i=nq){var s;const{appId:o,measurementId:a}=t;try{await yle(r,e)}catch(A){if(a)return $o.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${A==null?void 0:A.message}]`),{appId:o,measurementId:a};throw A}try{const A=await _le(t);return i.deleteThrottleMetadata(o),A}catch(A){const l=A;if(!vle(l)){if(i.deleteThrottleMetadata(o),a)return $o.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:o,measurementId:a};throw A}const d=Number((s=l==null?void 0:l.customData)===null||s===void 0?void 0:s.httpStatus)===503?b4(n,i.intervalMillis,fle):b4(n,i.intervalMillis),f={throttleEndTimeMillis:Date.now()+d,backoffCount:n+1};return i.setThrottleMetadata(o,f),$o.debug(`Calling attemptFetch again in ${d} millis`),rq(t,f,r,i)}}function yle(t,e){return new Promise((n,r)=>{const i=Math.max(e-Date.now(),0),s=setTimeout(n,i);t.addEventListener(()=>{clearTimeout(s),r(Ia.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function vle(t){if(!(t instanceof yc)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class wle{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Cle(t,e,n,r,i){if(i&&i.global){t("event",n,r);return}else{const s=await e,o=Object.assign(Object.assign({},r),{send_to:s});t("event",n,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tle(){if(R7())try{await O7()}catch(t){return $o.warn(Ia.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return $o.warn(Ia.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Sle(t,e,n,r,i,s,o){var a;const A=Ele(t);A.then(g=>{n[g.measurementId]=g.appId,t.options.measurementId&&g.measurementId!==t.options.measurementId&&$o.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${g.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(g=>$o.error(g)),e.push(A);const l=Tle().then(g=>{if(g)return r.getId()}),[d,f]=await Promise.all([A,l]);hle(s)||ale(s,d.measurementId),i("js",new Date);const p=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return p[tle]="firebase",p.update=!0,f!=null&&(p[ele]=f),i("config",d.measurementId,p),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ble{constructor(e){this.app=e}_delete(){return delete gy[this.app.options.appId],Promise.resolve()}}let gy={},x4=[];const M4={};let UN="dataLayer",Ile="gtag",F4,iq,V4=!1;function Rle(){const t=[];if(b7()&&t.push("This is a browser extension environment."),Gae()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,i)=>`(${i+1}) ${r}`).join(" "),n=Ia.create("invalid-analytics-context",{errorInfo:e});$o.warn(n.message)}}function Ole(t,e,n){Rle();const r=t.options.appId;if(!r)throw Ia.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)$o.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Ia.create("no-api-key");if(gy[r]!=null)throw Ia.create("already-exists",{id:r});if(!V4){cle(UN);const{wrappedGtag:s,gtagCore:o}=dle(gy,x4,M4,UN,Ile);iq=s,F4=o,V4=!0}return gy[r]=Sle(t,x4,M4,e,F4,UN,n),new ble(t)}function Nle(t=zv()){t=ci(t);const e=yu(t,TS);return e.isInitialized()?e.getImmediate():Dle(t)}function Dle(t,e={}){const n=yu(t,TS);if(n.isInitialized()){const i=n.getImmediate();if(lu(e,n.getOptions()))return i;throw Ia.create("already-initialized")}return n.initialize({options:e})}function Ble(t,e,n,r){t=ci(t),Cle(iq,gy[t.app.options.appId],e,n,r).catch(i=>$o.error(i))}const Q4="@firebase/analytics",H4="0.10.16";function Lle(){_c(new Da(TS,(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return Ole(r,i,n)},"PUBLIC")),_c(new Da("analytics-internal",t,"PRIVATE")),lo(Q4,H4),lo(Q4,H4,"esm2017");function t(e){try{const n=e.getProvider(TS).getImmediate();return{logEvent:(r,i,s)=>Ble(n,r,i,s)}}catch(n){throw Ia.create("interop-component-reg-failed",{reason:n})}}}Lle();function zU(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function sq(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Ple=sq,oq=new Wf("auth","Firebase",sq());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SS=new Wv("@firebase/auth");function Ule(t,...e){SS.logLevel<=fn.WARN&&SS.warn(`Auth (${ah}): ${t}`,...e)}function C0(t,...e){SS.logLevel<=fn.ERROR&&SS.error(`Auth (${ah}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function du(t,...e){throw qU(t,...e)}function YA(t,...e){return qU(t,...e)}function aq(t,e,n){const r=Object.assign(Object.assign({},Ple()),{[e]:n});return new Wf("auth","Firebase",r).create(e,{appName:t.name})}function wf(t){return aq(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function qU(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return oq.create(t,...e)}function Pt(t,e,...n){if(!t)throw qU(e,...n)}function Zl(t){const e="INTERNAL ASSERTION FAILED: "+t;throw C0(e),new Error(e)}function hu(t,e){t||Zl(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tL(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function kle(){return j4()==="http:"||j4()==="https:"}function j4(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xle(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(kle()||b7()||"connection"in navigator)?navigator.onLine:!0}function Mle(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qv{constructor(e,n){this.shortDelay=e,this.longDelay=n,hu(n>e,"Short delay should be less than long delay!"),this.isMobile=VU()||I7()}get(){return xle()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YU(t,e){hu(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cq{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Zl("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Zl("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Zl("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fle={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vle=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Qle=new qv(3e4,6e4);function XU(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Xg(t,e,n,r,i={}){return Aq(t,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});const a=Yg(Object.assign({key:t.config.apiKey},o)).slice(1),A=await t._getAdditionalHeaders();A["Content-Type"]="application/json",t.languageCode&&(A["X-Firebase-Locale"]=t.languageCode);const l=Object.assign({method:e,headers:A},s);return Qae()||(l.referrerPolicy="no-referrer"),t.emulatorConfig&&sl(t.emulatorConfig.host)&&(l.credentials="include"),cq.fetch()(await lq(t,t.config.apiHost,n,a),l)})}async function Aq(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},Fle),e);try{const i=new jle(t),s=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw jC(t,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[A,l]=a.split(" : ");if(A==="FEDERATED_USER_ID_ALREADY_LINKED")throw jC(t,"credential-already-in-use",o);if(A==="EMAIL_EXISTS")throw jC(t,"email-already-in-use",o);if(A==="USER_DISABLED")throw jC(t,"user-disabled",o);const d=r[A]||A.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw aq(t,d,l);du(t,d)}}catch(i){if(i instanceof yc)throw i;du(t,"network-request-failed",{message:String(i)})}}async function Hle(t,e,n,r,i={}){const s=await Xg(t,e,n,r,i);return"mfaPendingCredential"in s&&du(t,"multi-factor-auth-required",{_serverResponse:s}),s}async function lq(t,e,n,r){const i=`${e}${n}?${r}`,s=t,o=s.config.emulator?YU(t.config,i):`${t.config.apiScheme}://${i}`;return Vle.includes(n)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o}class jle{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(YA(this.auth,"network-request-failed")),Qle.get())})}}function jC(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=YA(t,e,r);return i.customData._tokenResponse=n,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kle(t,e){return Xg(t,"POST","/v1/accounts:delete",e)}async function bS(t,e){return Xg(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _y(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Gle(t,e=!1){const n=ci(t),r=await n.getIdToken(e),i=JU(r);Pt(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:_y(kN(i.auth_time)),issuedAtTime:_y(kN(i.iat)),expirationTime:_y(kN(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function kN(t){return Number(t)*1e3}function JU(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return C0("JWT malformed, contained fewer than 3 sections"),null;try{const i=ES(n);return i?JSON.parse(i):(C0("Failed to decode base64 JWT payload"),null)}catch(i){return C0("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function K4(t){const e=JU(t);return Pt(e,"internal-error"),Pt(typeof e.exp<"u","internal-error"),Pt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $y(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof yc&&Wle(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function Wle({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zle{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nL{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=_y(this.lastLoginAt),this.creationTime=_y(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IS(t){var e;const n=t.auth,r=await t.getIdToken(),i=await $y(t,bS(n,{idToken:r}));Pt(i==null?void 0:i.users.length,n,"internal-error");const s=i.users[0];t._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?uq(s.providerUserInfo):[],a=Yle(t.providerData,o),A=t.isAnonymous,l=!(t.email&&s.passwordHash)&&!(a!=null&&a.length),d=A?l:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new nL(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,f)}async function qle(t){const e=ci(t);await IS(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Yle(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function uq(t){return t.map(e=>{var{providerId:n}=e,r=zU(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xle(t,e){const n=await Aq(t,{},async()=>{const r=Yg({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,o=await lq(t,i,"/v1/token",`key=${s}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const A={method:"POST",headers:a,body:r};return t.emulatorConfig&&sl(t.emulatorConfig.host)&&(A.credentials="include"),cq.fetch()(o,A)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function Jle(t,e){return Xg(t,"POST","/v2/accounts:revokeToken",XU(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Pt(e.idToken,"internal-error"),Pt(typeof e.idToken<"u","internal-error"),Pt(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):K4(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Pt(e.length!==0,"internal-error");const n=K4(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Pt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:s}=await Xle(e,n);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:s}=n,o=new Km;return r&&(Pt(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(Pt(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(Pt(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Km,this.toJSON())}_performRefresh(){return Zl("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xu(t,e){Pt(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class zc{constructor(e){var{uid:n,auth:r,stsTokenManager:i}=e,s=zU(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new zle(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new nL(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await $y(this,this.stsTokenManager.getToken(this.auth,e));return Pt(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return Gle(this,e)}reload(){return qle(this)}_assign(e){this!==e&&(Pt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new zc(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){Pt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await IS(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(cc(this.auth.app))return Promise.reject(wf(this.auth));const e=await this.getIdToken();return await $y(this,Kle(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,i,s,o,a,A,l,d;const f=(r=n.displayName)!==null&&r!==void 0?r:void 0,p=(i=n.email)!==null&&i!==void 0?i:void 0,g=(s=n.phoneNumber)!==null&&s!==void 0?s:void 0,y=(o=n.photoURL)!==null&&o!==void 0?o:void 0,E=(a=n.tenantId)!==null&&a!==void 0?a:void 0,w=(A=n._redirectEventId)!==null&&A!==void 0?A:void 0,b=(l=n.createdAt)!==null&&l!==void 0?l:void 0,I=(d=n.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:B,emailVerified:U,isAnonymous:H,providerData:K,stsTokenManager:x}=n;Pt(B&&x,e,"internal-error");const V=Km.fromJSON(this.name,x);Pt(typeof B=="string",e,"internal-error"),Xu(f,e.name),Xu(p,e.name),Pt(typeof U=="boolean",e,"internal-error"),Pt(typeof H=="boolean",e,"internal-error"),Xu(g,e.name),Xu(y,e.name),Xu(E,e.name),Xu(w,e.name),Xu(b,e.name),Xu(I,e.name);const M=new zc({uid:B,auth:e,email:p,emailVerified:U,displayName:f,isAnonymous:H,photoURL:y,phoneNumber:g,tenantId:E,stsTokenManager:V,createdAt:b,lastLoginAt:I});return K&&Array.isArray(K)&&(M.providerData=K.map(O=>Object.assign({},O))),w&&(M._redirectEventId=w),M}static async _fromIdTokenResponse(e,n,r=!1){const i=new Km;i.updateFromServerResponse(n);const s=new zc({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await IS(s),s}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Pt(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?uq(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),a=new Km;a.updateFromIdToken(r);const A=new zc({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new nL(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(A,l),A}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G4=new Map;function eu(t){hu(t instanceof Function,"Expected a class definition");let e=G4.get(t);return e?(hu(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,G4.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dq{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}dq.type="NONE";const W4=dq;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T0(t,e,n){return`firebase:${t}:${e}:${n}`}class Gm{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=T0(this.userKey,i.apiKey,s),this.fullPersistenceKey=T0("persistence",i.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await bS(this.auth,{idToken:e}).catch(()=>{});return n?zc._fromGetAccountInfoResponse(this.auth,n,e):null}return zc._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new Gm(eu(W4),e,r);const i=(await Promise.all(n.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let s=i[0]||eu(W4);const o=T0(r,e.config.apiKey,e.name);let a=null;for(const l of n)try{const d=await l._get(o);if(d){let f;if(typeof d=="string"){const p=await bS(e,{idToken:d}).catch(()=>{});if(!p)break;f=await zc._fromGetAccountInfoResponse(e,p,d)}else f=zc._fromJSON(e,d);l!==s&&(a=f),s=l;break}}catch{}const A=i.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!A.length?new Gm(s,e,r):(s=A[0],a&&await s._set(o,a.toJSON()),await Promise.all(n.map(async l=>{if(l!==s)try{await l._remove(o)}catch{}})),new Gm(s,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z4(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(mq(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(hq(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(_q(e))return"Blackberry";if(Eq(e))return"Webos";if(fq(e))return"Safari";if((e.includes("chrome/")||pq(e))&&!e.includes("edge/"))return"Chrome";if(gq(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function hq(t=uo()){return/firefox\//i.test(t)}function fq(t=uo()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function pq(t=uo()){return/crios\//i.test(t)}function mq(t=uo()){return/iemobile/i.test(t)}function gq(t=uo()){return/android/i.test(t)}function _q(t=uo()){return/blackberry/i.test(t)}function Eq(t=uo()){return/webos/i.test(t)}function $U(t=uo()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function $le(t=uo()){var e;return $U(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Zle(){return Hae()&&document.documentMode===10}function yq(t=uo()){return $U(t)||gq(t)||Eq(t)||_q(t)||/windows phone/i.test(t)||mq(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vq(t,e=[]){let n;switch(t){case"Browser":n=z4(uo());break;case"Worker":n=`${z4(uo())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ah}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eue{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=s=>new Promise((o,a)=>{try{const A=e(s);o(A)}catch(A){a(A)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tue(t,e={}){return Xg(t,"GET","/v2/passwordPolicy",XU(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nue=6;class rue{constructor(e){var n,r,i,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:nue,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,i,s,o,a;const A={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,A),this.validatePasswordCharacterOptions(e,A),A.isValid&&(A.isValid=(n=A.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),A.isValid&&(A.isValid=(r=A.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),A.isValid&&(A.isValid=(i=A.containsLowercaseLetter)!==null&&i!==void 0?i:!0),A.isValid&&(A.isValid=(s=A.containsUppercaseLetter)!==null&&s!==void 0?s:!0),A.isValid&&(A.isValid=(o=A.containsNumericCharacter)!==null&&o!==void 0?o:!0),A.isValid&&(A.isValid=(a=A.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),A}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iue{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new q4(this),this.idTokenSubscription=new q4(this),this.beforeStateQueue=new eue(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=oq,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=eu(n)),this._initializationPromise=this.queue(async()=>{var r,i,s;if(!this._deleted&&(this.persistenceManager=await Gm.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await bS(this,{idToken:e}),r=await zc._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(cc(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i==null?void 0:i._redirectEventId,A=await this.tryRedirectSignIn(e);(!o||o===a)&&(A!=null&&A.user)&&(i=A.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Pt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await IS(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Mle()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(cc(this.app))return Promise.reject(wf(this));const n=e?ci(e):null;return n&&Pt(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Pt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return cc(this.app)?Promise.reject(wf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return cc(this.app)?Promise.reject(wf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(eu(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await tue(this),n=new rue(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Wf("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await Jle(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&eu(e)||this._popupRedirectResolver;Pt(n,this,"argument-error"),this.redirectPersistenceManager=await Gm.create(this,[eu(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const s=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Pt(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof n=="function"){const A=e.addObserver(n,r,i);return()=>{o=!0,A()}}else{const A=e.addObserver(n);return()=>{o=!0,A()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Pt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=vq(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n}async _getAppCheckToken(){var e;if(cc(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&Ule(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function ZU(t){return ci(t)}class q4{constructor(e){this.auth=e,this.observer=null,this.addObserver=$ae(n=>this.observer=n)}get next(){return Pt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ek={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function sue(t){ek=t}function oue(t){return ek.loadJS(t)}function aue(){return ek.gapiScript}function cue(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aue(t,e){const n=yu(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),s=n.getOptions();if(lu(s,e??{}))return i;du(i,"already-initialized")}return n.initialize({options:e})}function lue(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(eu);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function uue(t,e,n){const r=ZU(t);Pt(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=wq(e),{host:o,port:a}=due(e),A=a===null?"":`:${a}`,l={url:`${s}//${o}${A}/`},d=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Pt(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Pt(lu(l,r.config.emulator)&&lu(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=l,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,sl(o)?(zb(`${s}//${o}${A}`),qb("Auth",!0)):hue()}function wq(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function due(t){const e=wq(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:Y4(r.substr(s.length+1))}}else{const[s,o]=r.split(":");return{host:s,port:Y4(o)}}}function Y4(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function hue(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cq{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Zl("not implemented")}_getIdTokenResponse(e){return Zl("not implemented")}_linkToIdToken(e,n){return Zl("not implemented")}_getReauthenticationResolver(e){return Zl("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wm(t,e){return Hle(t,"POST","/v1/accounts:signInWithIdp",XU(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fue="http://localhost";class Pf extends Cq{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Pf(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):du("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=n,s=zU(n,["providerId","signInMethod"]);if(!r||!i)return null;const o=new Pf(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return Wm(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,Wm(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,Wm(e,n)}buildRequest(){const e={requestUri:fue,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Yg(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tq{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yv extends Tq{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dd extends Yv{constructor(){super("facebook.com")}static credential(e){return Pf._fromParams({providerId:dd.PROVIDER_ID,signInMethod:dd.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return dd.credentialFromTaggedObject(e)}static credentialFromError(e){return dd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return dd.credential(e.oauthAccessToken)}catch{return null}}}dd.FACEBOOK_SIGN_IN_METHOD="facebook.com";dd.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hd extends Yv{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Pf._fromParams({providerId:hd.PROVIDER_ID,signInMethod:hd.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return hd.credentialFromTaggedObject(e)}static credentialFromError(e){return hd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return hd.credential(n,r)}catch{return null}}}hd.GOOGLE_SIGN_IN_METHOD="google.com";hd.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fd extends Yv{constructor(){super("github.com")}static credential(e){return Pf._fromParams({providerId:fd.PROVIDER_ID,signInMethod:fd.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fd.credentialFromTaggedObject(e)}static credentialFromError(e){return fd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return fd.credential(e.oauthAccessToken)}catch{return null}}}fd.GITHUB_SIGN_IN_METHOD="github.com";fd.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pd extends Yv{constructor(){super("twitter.com")}static credential(e,n){return Pf._fromParams({providerId:pd.PROVIDER_ID,signInMethod:pd.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return pd.credentialFromTaggedObject(e)}static credentialFromError(e){return pd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return pd.credential(n,r)}catch{return null}}}pd.TWITTER_SIGN_IN_METHOD="twitter.com";pd.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const s=await zc._fromIdTokenResponse(e,r,i),o=X4(r);return new hg({user:s,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=X4(r);return new hg({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function X4(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RS extends yc{constructor(e,n,r,i){var s;super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,RS.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new RS(e,n,r,i)}}function Sq(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?RS._fromErrorAndOperation(t,s,e,r):s})}async function pue(t,e,n=!1){const r=await $y(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return hg._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mue(t,e,n=!1){const{auth:r}=t;if(cc(r.app))return Promise.reject(wf(r));const i="reauthenticate";try{const s=await $y(t,Sq(r,i,e,t),n);Pt(s.idToken,r,"internal-error");const o=JU(s.idToken);Pt(o,r,"internal-error");const{sub:a}=o;return Pt(t.uid===a,r,"user-mismatch"),hg._forOperation(t,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&du(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gue(t,e,n=!1){if(cc(t.app))return Promise.reject(wf(t));const r="signIn",i=await Sq(t,r,e),s=await hg._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(s.user),s}function _ue(t,e,n,r){return ci(t).onIdTokenChanged(e,n,r)}function Eue(t,e,n){return ci(t).beforeAuthStateChanged(e,n)}const OS="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bq{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(OS,"1"),this.storage.removeItem(OS),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yue=1e3,vue=10;class Iq extends bq{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=yq(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,A)=>{this.notifyListeners(o,A)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);Zle()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,vue):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},yue)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}Iq.type="LOCAL";const wue=Iq;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rq extends bq{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}Rq.type="SESSION";const Oq=Rq;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cue(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new $b(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:s}=n.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(async l=>l(n.origin,s)),A=await Cue(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:A})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$b.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tk(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tue{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,A)=>{const l=tk("",20);i.port1.start();const d=setTimeout(()=>{A(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(f){const p=f;if(p.data.eventId===l)switch(p.data.status){case"ack":clearTimeout(d),s=setTimeout(()=>{A(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(p.data.response);break;default:clearTimeout(d),clearTimeout(s),A(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XA(){return window}function Sue(t){XA().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nq(){return typeof XA().WorkerGlobalScope<"u"&&typeof XA().importScripts=="function"}async function bue(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Iue(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function Rue(){return Nq()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dq="firebaseLocalStorageDb",Oue=1,NS="firebaseLocalStorage",Bq="fbase_key";class Xv{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Zb(t,e){return t.transaction([NS],e?"readwrite":"readonly").objectStore(NS)}function Nue(){const t=indexedDB.deleteDatabase(Dq);return new Xv(t).toPromise()}function rL(){const t=indexedDB.open(Dq,Oue);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(NS,{keyPath:Bq})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(NS)?e(r):(r.close(),await Nue(),e(await rL()))})})}async function J4(t,e,n){const r=Zb(t,!0).put({[Bq]:e,value:n});return new Xv(r).toPromise()}async function Due(t,e){const n=Zb(t,!1).get(e),r=await new Xv(n).toPromise();return r===void 0?null:r.value}function $4(t,e){const n=Zb(t,!0).delete(e);return new Xv(n).toPromise()}const Bue=800,Lue=3;class Lq{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await rL(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>Lue)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Nq()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$b._getInstance(Rue()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await bue(),!this.activeServiceWorker)return;this.sender=new Tue(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Iue()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await rL();return await J4(e,OS,"1"),await $4(e,OS),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>J4(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>Due(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>$4(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=Zb(i,!1).getAll();return new Xv(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Bue)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Lq.type="LOCAL";const Pue=Lq;new qv(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uue(t,e){return e?eu(e):(Pt(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nk extends Cq{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Wm(e,this._buildIdpRequest())}_linkToIdToken(e,n){return Wm(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return Wm(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function kue(t){return gue(t.auth,new nk(t),t.bypassAuthState)}function xue(t){const{auth:e,user:n}=t;return Pt(n,e,"internal-error"),mue(n,new nk(t),t.bypassAuthState)}async function Mue(t){const{auth:e,user:n}=t;return Pt(n,e,"internal-error"),pue(n,new nk(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pq{constructor(e,n,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const A={auth:this.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(A))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return kue;case"linkViaPopup":case"linkViaRedirect":return Mue;case"reauthViaPopup":case"reauthViaRedirect":return xue;default:du(this.auth,"internal-error")}}resolve(e){hu(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){hu(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fue=new qv(2e3,1e4);class Nm extends Pq{constructor(e,n,r,i,s){super(e,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,Nm.currentPopupAction&&Nm.currentPopupAction.cancel(),Nm.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Pt(e,this.auth,"internal-error"),e}async onExecution(){hu(this.filter.length===1,"Popup operations only handle one event");const e=tk();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(YA(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(YA(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Nm.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(YA(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Fue.get())};e()}}Nm.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vue="pendingRedirect",S0=new Map;class Que extends Pq{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=S0.get(this.auth._key());if(!e){try{const r=await Hue(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}S0.set(this.auth._key(),e)}return this.bypassAuthState||S0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Hue(t,e){const n=Gue(e),r=Kue(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function jue(t,e){S0.set(t._key(),e)}function Kue(t){return eu(t._redirectPersistence)}function Gue(t){return T0(Vue,t.config.apiKey,t.name)}async function Wue(t,e,n=!1){if(cc(t.app))return Promise.reject(wf(t));const r=ZU(t),i=Uue(r,e),o=await new Que(r,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zue=10*60*1e3;class que{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!Yue(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!Uq(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(YA(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=zue&&this.cachedEventUids.clear(),this.cachedEventUids.has(Z4(e))}saveEventToCache(e){this.cachedEventUids.add(Z4(e)),this.lastProcessedEventTime=Date.now()}}function Z4(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Uq({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function Yue(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Uq(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xue(t,e={}){return Xg(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jue=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,$ue=/^https?/;async function Zue(t){if(t.config.emulator)return;const{authorizedDomains:e}=await Xue(t);for(const n of e)try{if(ede(n))return}catch{}du(t,"unauthorized-domain")}function ede(t){const e=tL(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!$ue.test(n))return!1;if(Jue.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tde=new qv(3e4,6e4);function eQ(){const t=XA().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function nde(t){return new Promise((e,n)=>{var r,i,s;function o(){eQ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{eQ(),n(YA(t,"network-request-failed"))},timeout:tde.get()})}if(!((i=(r=XA().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=XA().gapi)===null||s===void 0)&&s.load)o();else{const a=cue("iframefcb");return XA()[a]=()=>{gapi.load?o():n(YA(t,"network-request-failed"))},oue(`${aue()}?onload=${a}`).catch(A=>n(A))}}).catch(e=>{throw b0=null,e})}let b0=null;function rde(t){return b0=b0||nde(t),b0}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ide=new qv(5e3,15e3),sde="__/auth/iframe",ode="emulator/auth/iframe",ade={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},cde=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ade(t){const e=t.config;Pt(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?YU(e,ode):`https://${t.config.authDomain}/${sde}`,r={apiKey:e.apiKey,appName:t.name,v:ah},i=cde.get(t.config.apiHost);i&&(r.eid=i);const s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${Yg(r).slice(1)}`}async function lde(t){const e=await rde(t),n=XA().gapi;return Pt(n,t,"internal-error"),e.open({where:document.body,url:Ade(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ade,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const o=YA(t,"network-request-failed"),a=XA().setTimeout(()=>{s(o)},ide.get());function A(){XA().clearTimeout(a),i(r)}r.ping(A).then(A,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ude={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},dde=500,hde=600,fde="_blank",pde="http://localhost";class tQ{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function mde(t,e,n,r=dde,i=hde){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const A=Object.assign(Object.assign({},ude),{width:r.toString(),height:i.toString(),top:s,left:o}),l=uo().toLowerCase();n&&(a=pq(l)?fde:n),hq(l)&&(e=e||pde,A.scrollbars="yes");const d=Object.entries(A).reduce((p,[g,y])=>`${p}${g}=${y},`,"");if($le(l)&&a!=="_self")return gde(e||"",a),new tQ(null);const f=window.open(e||"",a,d);Pt(f,t,"popup-blocked");try{f.focus()}catch{}return new tQ(f)}function gde(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _de="__/auth/handler",Ede="emulator/auth/handler",yde=encodeURIComponent("fac");async function nQ(t,e,n,r,i,s){Pt(t.config.authDomain,t,"auth-domain-config-required"),Pt(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:ah,eventId:i};if(e instanceof Tq){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",yS(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries({}))o[d]=f}if(e instanceof Yv){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const A=await t._getAppCheckToken(),l=A?`#${yde}=${encodeURIComponent(A)}`:"";return`${vde(t)}?${Yg(a).slice(1)}${l}`}function vde({config:t}){return t.emulator?YU(t,Ede):`https://${t.authDomain}/${_de}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xN="webStorageSupport";class wde{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Oq,this._completeRedirectFn=Wue,this._overrideRedirectResult=jue}async _openPopup(e,n,r,i){var s;hu((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await nQ(e,n,r,tL(),i);return mde(e,o,tk())}async _openRedirect(e,n,r,i){await this._originValidation(e);const s=await nQ(e,n,r,tL(),i);return Sue(s),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:s}=this.eventManagers[n];return i?Promise.resolve(i):(hu(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await lde(e),r=new que(e);return n.register("authEvent",i=>(Pt(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(xN,{type:xN},i=>{var s;const o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[xN];o!==void 0&&n(!!o),du(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=Zue(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return yq()||fq()||$U()}}const Cde=wde;var rQ="@firebase/auth",iQ="1.10.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tde{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Pt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sde(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function bde(t){_c(new Da("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Pt(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const A={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vq(t)},l=new iue(r,i,s,A);return lue(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),_c(new Da("auth-internal",e=>{const n=ZU(e.getProvider("auth").getImmediate());return(r=>new Tde(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),lo(rQ,iQ,Sde(t)),lo(rQ,iQ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ide=5*60,Rde=S7("authIdTokenMaxAge")||Ide;let sQ=null;const Ode=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>Rde)return;const i=n==null?void 0:n.token;sQ!==i&&(sQ=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Nde(t=zv()){const e=yu(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Aue(t,{popupRedirectResolver:Cde,persistence:[Pue,wue,Oq]}),r=S7("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const o=Ode(s.toString());Eue(n,o,()=>o(n.currentUser)),_ue(n,a=>o(a))}}const i=C7("auth");return i&&uue(n,`http://${i}`),n}function Dde(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}sue({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const s=YA("internal-error");s.customData=i,n(s)},r.type="text/javascript",r.charset="UTF-8",Dde().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});bde("Browser");var oQ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Pd,kq;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(x,V){function M(){}M.prototype=V.prototype,x.D=V.prototype,x.prototype=new M,x.prototype.constructor=x,x.C=function(O,z,$){for(var q=Array(arguments.length-2),Ue=2;Ue<arguments.length;Ue++)q[Ue-2]=arguments[Ue];return V.prototype[z].apply(O,q)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(x,V,M){M||(M=0);var O=Array(16);if(typeof V=="string")for(var z=0;16>z;++z)O[z]=V.charCodeAt(M++)|V.charCodeAt(M++)<<8|V.charCodeAt(M++)<<16|V.charCodeAt(M++)<<24;else for(z=0;16>z;++z)O[z]=V[M++]|V[M++]<<8|V[M++]<<16|V[M++]<<24;V=x.g[0],M=x.g[1],z=x.g[2];var $=x.g[3],q=V+($^M&(z^$))+O[0]+3614090360&4294967295;V=M+(q<<7&4294967295|q>>>25),q=$+(z^V&(M^z))+O[1]+3905402710&4294967295,$=V+(q<<12&4294967295|q>>>20),q=z+(M^$&(V^M))+O[2]+606105819&4294967295,z=$+(q<<17&4294967295|q>>>15),q=M+(V^z&($^V))+O[3]+3250441966&4294967295,M=z+(q<<22&4294967295|q>>>10),q=V+($^M&(z^$))+O[4]+4118548399&4294967295,V=M+(q<<7&4294967295|q>>>25),q=$+(z^V&(M^z))+O[5]+1200080426&4294967295,$=V+(q<<12&4294967295|q>>>20),q=z+(M^$&(V^M))+O[6]+2821735955&4294967295,z=$+(q<<17&4294967295|q>>>15),q=M+(V^z&($^V))+O[7]+4249261313&4294967295,M=z+(q<<22&4294967295|q>>>10),q=V+($^M&(z^$))+O[8]+1770035416&4294967295,V=M+(q<<7&4294967295|q>>>25),q=$+(z^V&(M^z))+O[9]+2336552879&4294967295,$=V+(q<<12&4294967295|q>>>20),q=z+(M^$&(V^M))+O[10]+4294925233&4294967295,z=$+(q<<17&4294967295|q>>>15),q=M+(V^z&($^V))+O[11]+2304563134&4294967295,M=z+(q<<22&4294967295|q>>>10),q=V+($^M&(z^$))+O[12]+1804603682&4294967295,V=M+(q<<7&4294967295|q>>>25),q=$+(z^V&(M^z))+O[13]+4254626195&4294967295,$=V+(q<<12&4294967295|q>>>20),q=z+(M^$&(V^M))+O[14]+2792965006&4294967295,z=$+(q<<17&4294967295|q>>>15),q=M+(V^z&($^V))+O[15]+1236535329&4294967295,M=z+(q<<22&4294967295|q>>>10),q=V+(z^$&(M^z))+O[1]+4129170786&4294967295,V=M+(q<<5&4294967295|q>>>27),q=$+(M^z&(V^M))+O[6]+3225465664&4294967295,$=V+(q<<9&4294967295|q>>>23),q=z+(V^M&($^V))+O[11]+643717713&4294967295,z=$+(q<<14&4294967295|q>>>18),q=M+($^V&(z^$))+O[0]+3921069994&4294967295,M=z+(q<<20&4294967295|q>>>12),q=V+(z^$&(M^z))+O[5]+3593408605&4294967295,V=M+(q<<5&4294967295|q>>>27),q=$+(M^z&(V^M))+O[10]+38016083&4294967295,$=V+(q<<9&4294967295|q>>>23),q=z+(V^M&($^V))+O[15]+3634488961&4294967295,z=$+(q<<14&4294967295|q>>>18),q=M+($^V&(z^$))+O[4]+3889429448&4294967295,M=z+(q<<20&4294967295|q>>>12),q=V+(z^$&(M^z))+O[9]+568446438&4294967295,V=M+(q<<5&4294967295|q>>>27),q=$+(M^z&(V^M))+O[14]+3275163606&4294967295,$=V+(q<<9&4294967295|q>>>23),q=z+(V^M&($^V))+O[3]+4107603335&4294967295,z=$+(q<<14&4294967295|q>>>18),q=M+($^V&(z^$))+O[8]+1163531501&4294967295,M=z+(q<<20&4294967295|q>>>12),q=V+(z^$&(M^z))+O[13]+2850285829&4294967295,V=M+(q<<5&4294967295|q>>>27),q=$+(M^z&(V^M))+O[2]+4243563512&4294967295,$=V+(q<<9&4294967295|q>>>23),q=z+(V^M&($^V))+O[7]+1735328473&4294967295,z=$+(q<<14&4294967295|q>>>18),q=M+($^V&(z^$))+O[12]+2368359562&4294967295,M=z+(q<<20&4294967295|q>>>12),q=V+(M^z^$)+O[5]+4294588738&4294967295,V=M+(q<<4&4294967295|q>>>28),q=$+(V^M^z)+O[8]+2272392833&4294967295,$=V+(q<<11&4294967295|q>>>21),q=z+($^V^M)+O[11]+1839030562&4294967295,z=$+(q<<16&4294967295|q>>>16),q=M+(z^$^V)+O[14]+4259657740&4294967295,M=z+(q<<23&4294967295|q>>>9),q=V+(M^z^$)+O[1]+2763975236&4294967295,V=M+(q<<4&4294967295|q>>>28),q=$+(V^M^z)+O[4]+1272893353&4294967295,$=V+(q<<11&4294967295|q>>>21),q=z+($^V^M)+O[7]+4139469664&4294967295,z=$+(q<<16&4294967295|q>>>16),q=M+(z^$^V)+O[10]+3200236656&4294967295,M=z+(q<<23&4294967295|q>>>9),q=V+(M^z^$)+O[13]+681279174&4294967295,V=M+(q<<4&4294967295|q>>>28),q=$+(V^M^z)+O[0]+3936430074&4294967295,$=V+(q<<11&4294967295|q>>>21),q=z+($^V^M)+O[3]+3572445317&4294967295,z=$+(q<<16&4294967295|q>>>16),q=M+(z^$^V)+O[6]+76029189&4294967295,M=z+(q<<23&4294967295|q>>>9),q=V+(M^z^$)+O[9]+3654602809&4294967295,V=M+(q<<4&4294967295|q>>>28),q=$+(V^M^z)+O[12]+3873151461&4294967295,$=V+(q<<11&4294967295|q>>>21),q=z+($^V^M)+O[15]+530742520&4294967295,z=$+(q<<16&4294967295|q>>>16),q=M+(z^$^V)+O[2]+3299628645&4294967295,M=z+(q<<23&4294967295|q>>>9),q=V+(z^(M|~$))+O[0]+4096336452&4294967295,V=M+(q<<6&4294967295|q>>>26),q=$+(M^(V|~z))+O[7]+1126891415&4294967295,$=V+(q<<10&4294967295|q>>>22),q=z+(V^($|~M))+O[14]+2878612391&4294967295,z=$+(q<<15&4294967295|q>>>17),q=M+($^(z|~V))+O[5]+4237533241&4294967295,M=z+(q<<21&4294967295|q>>>11),q=V+(z^(M|~$))+O[12]+1700485571&4294967295,V=M+(q<<6&4294967295|q>>>26),q=$+(M^(V|~z))+O[3]+2399980690&4294967295,$=V+(q<<10&4294967295|q>>>22),q=z+(V^($|~M))+O[10]+4293915773&4294967295,z=$+(q<<15&4294967295|q>>>17),q=M+($^(z|~V))+O[1]+2240044497&4294967295,M=z+(q<<21&4294967295|q>>>11),q=V+(z^(M|~$))+O[8]+1873313359&4294967295,V=M+(q<<6&4294967295|q>>>26),q=$+(M^(V|~z))+O[15]+4264355552&4294967295,$=V+(q<<10&4294967295|q>>>22),q=z+(V^($|~M))+O[6]+2734768916&4294967295,z=$+(q<<15&4294967295|q>>>17),q=M+($^(z|~V))+O[13]+1309151649&4294967295,M=z+(q<<21&4294967295|q>>>11),q=V+(z^(M|~$))+O[4]+4149444226&4294967295,V=M+(q<<6&4294967295|q>>>26),q=$+(M^(V|~z))+O[11]+3174756917&4294967295,$=V+(q<<10&4294967295|q>>>22),q=z+(V^($|~M))+O[2]+718787259&4294967295,z=$+(q<<15&4294967295|q>>>17),q=M+($^(z|~V))+O[9]+3951481745&4294967295,x.g[0]=x.g[0]+V&4294967295,x.g[1]=x.g[1]+(z+(q<<21&4294967295|q>>>11))&4294967295,x.g[2]=x.g[2]+z&4294967295,x.g[3]=x.g[3]+$&4294967295}r.prototype.u=function(x,V){V===void 0&&(V=x.length);for(var M=V-this.blockSize,O=this.B,z=this.h,$=0;$<V;){if(z==0)for(;$<=M;)i(this,x,$),$+=this.blockSize;if(typeof x=="string"){for(;$<V;)if(O[z++]=x.charCodeAt($++),z==this.blockSize){i(this,O),z=0;break}}else for(;$<V;)if(O[z++]=x[$++],z==this.blockSize){i(this,O),z=0;break}}this.h=z,this.o+=V},r.prototype.v=function(){var x=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);x[0]=128;for(var V=1;V<x.length-8;++V)x[V]=0;var M=8*this.o;for(V=x.length-8;V<x.length;++V)x[V]=M&255,M/=256;for(this.u(x),x=Array(16),V=M=0;4>V;++V)for(var O=0;32>O;O+=8)x[M++]=this.g[V]>>>O&255;return x};function s(x,V){var M=a;return Object.prototype.hasOwnProperty.call(M,x)?M[x]:M[x]=V(x)}function o(x,V){this.h=V;for(var M=[],O=!0,z=x.length-1;0<=z;z--){var $=x[z]|0;O&&$==V||(M[z]=$,O=!1)}this.g=M}var a={};function A(x){return-128<=x&&128>x?s(x,function(V){return new o([V|0],0>V?-1:0)}):new o([x|0],0>x?-1:0)}function l(x){if(isNaN(x)||!isFinite(x))return f;if(0>x)return w(l(-x));for(var V=[],M=1,O=0;x>=M;O++)V[O]=x/M|0,M*=4294967296;return new o(V,0)}function d(x,V){if(x.length==0)throw Error("number format error: empty string");if(V=V||10,2>V||36<V)throw Error("radix out of range: "+V);if(x.charAt(0)=="-")return w(d(x.substring(1),V));if(0<=x.indexOf("-"))throw Error('number format error: interior "-" character');for(var M=l(Math.pow(V,8)),O=f,z=0;z<x.length;z+=8){var $=Math.min(8,x.length-z),q=parseInt(x.substring(z,z+$),V);8>$?($=l(Math.pow(V,$)),O=O.j($).add(l(q))):(O=O.j(M),O=O.add(l(q)))}return O}var f=A(0),p=A(1),g=A(16777216);t=o.prototype,t.m=function(){if(E(this))return-w(this).m();for(var x=0,V=1,M=0;M<this.g.length;M++){var O=this.i(M);x+=(0<=O?O:4294967296+O)*V,V*=4294967296}return x},t.toString=function(x){if(x=x||10,2>x||36<x)throw Error("radix out of range: "+x);if(y(this))return"0";if(E(this))return"-"+w(this).toString(x);for(var V=l(Math.pow(x,6)),M=this,O="";;){var z=U(M,V).g;M=b(M,z.j(V));var $=((0<M.g.length?M.g[0]:M.h)>>>0).toString(x);if(M=z,y(M))return $+O;for(;6>$.length;)$="0"+$;O=$+O}},t.i=function(x){return 0>x?0:x<this.g.length?this.g[x]:this.h};function y(x){if(x.h!=0)return!1;for(var V=0;V<x.g.length;V++)if(x.g[V]!=0)return!1;return!0}function E(x){return x.h==-1}t.l=function(x){return x=b(this,x),E(x)?-1:y(x)?0:1};function w(x){for(var V=x.g.length,M=[],O=0;O<V;O++)M[O]=~x.g[O];return new o(M,~x.h).add(p)}t.abs=function(){return E(this)?w(this):this},t.add=function(x){for(var V=Math.max(this.g.length,x.g.length),M=[],O=0,z=0;z<=V;z++){var $=O+(this.i(z)&65535)+(x.i(z)&65535),q=($>>>16)+(this.i(z)>>>16)+(x.i(z)>>>16);O=q>>>16,$&=65535,q&=65535,M[z]=q<<16|$}return new o(M,M[M.length-1]&-2147483648?-1:0)};function b(x,V){return x.add(w(V))}t.j=function(x){if(y(this)||y(x))return f;if(E(this))return E(x)?w(this).j(w(x)):w(w(this).j(x));if(E(x))return w(this.j(w(x)));if(0>this.l(g)&&0>x.l(g))return l(this.m()*x.m());for(var V=this.g.length+x.g.length,M=[],O=0;O<2*V;O++)M[O]=0;for(O=0;O<this.g.length;O++)for(var z=0;z<x.g.length;z++){var $=this.i(O)>>>16,q=this.i(O)&65535,Ue=x.i(z)>>>16,fe=x.i(z)&65535;M[2*O+2*z]+=q*fe,I(M,2*O+2*z),M[2*O+2*z+1]+=$*fe,I(M,2*O+2*z+1),M[2*O+2*z+1]+=q*Ue,I(M,2*O+2*z+1),M[2*O+2*z+2]+=$*Ue,I(M,2*O+2*z+2)}for(O=0;O<V;O++)M[O]=M[2*O+1]<<16|M[2*O];for(O=V;O<2*V;O++)M[O]=0;return new o(M,0)};function I(x,V){for(;(x[V]&65535)!=x[V];)x[V+1]+=x[V]>>>16,x[V]&=65535,V++}function B(x,V){this.g=x,this.h=V}function U(x,V){if(y(V))throw Error("division by zero");if(y(x))return new B(f,f);if(E(x))return V=U(w(x),V),new B(w(V.g),w(V.h));if(E(V))return V=U(x,w(V)),new B(w(V.g),V.h);if(30<x.g.length){if(E(x)||E(V))throw Error("slowDivide_ only works with positive integers.");for(var M=p,O=V;0>=O.l(x);)M=H(M),O=H(O);var z=K(M,1),$=K(O,1);for(O=K(O,2),M=K(M,2);!y(O);){var q=$.add(O);0>=q.l(x)&&(z=z.add(M),$=q),O=K(O,1),M=K(M,1)}return V=b(x,z.j(V)),new B(z,V)}for(z=f;0<=x.l(V);){for(M=Math.max(1,Math.floor(x.m()/V.m())),O=Math.ceil(Math.log(M)/Math.LN2),O=48>=O?1:Math.pow(2,O-48),$=l(M),q=$.j(V);E(q)||0<q.l(x);)M-=O,$=l(M),q=$.j(V);y($)&&($=p),z=z.add($),x=b(x,q)}return new B(z,x)}t.A=function(x){return U(this,x).h},t.and=function(x){for(var V=Math.max(this.g.length,x.g.length),M=[],O=0;O<V;O++)M[O]=this.i(O)&x.i(O);return new o(M,this.h&x.h)},t.or=function(x){for(var V=Math.max(this.g.length,x.g.length),M=[],O=0;O<V;O++)M[O]=this.i(O)|x.i(O);return new o(M,this.h|x.h)},t.xor=function(x){for(var V=Math.max(this.g.length,x.g.length),M=[],O=0;O<V;O++)M[O]=this.i(O)^x.i(O);return new o(M,this.h^x.h)};function H(x){for(var V=x.g.length+1,M=[],O=0;O<V;O++)M[O]=x.i(O)<<1|x.i(O-1)>>>31;return new o(M,x.h)}function K(x,V){var M=V>>5;V%=32;for(var O=x.g.length-M,z=[],$=0;$<O;$++)z[$]=0<V?x.i($+M)>>>V|x.i($+M+1)<<32-V:x.i($+M);return new o(z,x.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,kq=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=d,Pd=o}).apply(typeof oQ<"u"?oQ:typeof self<"u"?self:typeof window<"u"?window:{});var KC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var xq,GE,Mq,I0,iL,Fq,Vq,Qq;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(_,R,F){return _==Array.prototype||_==Object.prototype||(_[R]=F.value),_};function n(_){_=[typeof globalThis=="object"&&globalThis,_,typeof window=="object"&&window,typeof self=="object"&&self,typeof KC=="object"&&KC];for(var R=0;R<_.length;++R){var F=_[R];if(F&&F.Math==Math)return F}throw Error("Cannot find global object")}var r=n(this);function i(_,R){if(R)e:{var F=r;_=_.split(".");for(var X=0;X<_.length-1;X++){var ue=_[X];if(!(ue in F))break e;F=F[ue]}_=_[_.length-1],X=F[_],R=R(X),R!=X&&R!=null&&e(F,_,{configurable:!0,writable:!0,value:R})}}function s(_,R){_ instanceof String&&(_+="");var F=0,X=!1,ue={next:function(){if(!X&&F<_.length){var ge=F++;return{value:R(ge,_[ge]),done:!1}}return X=!0,{done:!0,value:void 0}}};return ue[Symbol.iterator]=function(){return ue},ue}i("Array.prototype.values",function(_){return _||function(){return s(this,function(R,F){return F})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function A(_){var R=typeof _;return R=R!="object"?R:_?Array.isArray(_)?"array":R:"null",R=="array"||R=="object"&&typeof _.length=="number"}function l(_){var R=typeof _;return R=="object"&&_!=null||R=="function"}function d(_,R,F){return _.call.apply(_.bind,arguments)}function f(_,R,F){if(!_)throw Error();if(2<arguments.length){var X=Array.prototype.slice.call(arguments,2);return function(){var ue=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(ue,X),_.apply(R,ue)}}return function(){return _.apply(R,arguments)}}function p(_,R,F){return p=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,p.apply(null,arguments)}function g(_,R){var F=Array.prototype.slice.call(arguments,1);return function(){var X=F.slice();return X.push.apply(X,arguments),_.apply(this,X)}}function y(_,R){function F(){}F.prototype=R.prototype,_.aa=R.prototype,_.prototype=new F,_.prototype.constructor=_,_.Qb=function(X,ue,ge){for(var He=Array(arguments.length-2),Cn=2;Cn<arguments.length;Cn++)He[Cn-2]=arguments[Cn];return R.prototype[ue].apply(X,He)}}function E(_){const R=_.length;if(0<R){const F=Array(R);for(let X=0;X<R;X++)F[X]=_[X];return F}return[]}function w(_,R){for(let F=1;F<arguments.length;F++){const X=arguments[F];if(A(X)){const ue=_.length||0,ge=X.length||0;_.length=ue+ge;for(let He=0;He<ge;He++)_[ue+He]=X[He]}else _.push(X)}}class b{constructor(R,F){this.i=R,this.j=F,this.h=0,this.g=null}get(){let R;return 0<this.h?(this.h--,R=this.g,this.g=R.next,R.next=null):R=this.i(),R}}function I(_){return/^[\s\xa0]*$/.test(_)}function B(){var _=a.navigator;return _&&(_=_.userAgent)?_:""}function U(_){return U[" "](_),_}U[" "]=function(){};var H=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function K(_,R,F){for(const X in _)R.call(F,_[X],X,_)}function x(_,R){for(const F in _)R.call(void 0,_[F],F,_)}function V(_){const R={};for(const F in _)R[F]=_[F];return R}const M="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(_,R){let F,X;for(let ue=1;ue<arguments.length;ue++){X=arguments[ue];for(F in X)_[F]=X[F];for(let ge=0;ge<M.length;ge++)F=M[ge],Object.prototype.hasOwnProperty.call(X,F)&&(_[F]=X[F])}}function z(_){var R=1;_=_.split(":");const F=[];for(;0<R&&_.length;)F.push(_.shift()),R--;return _.length&&F.push(_.join(":")),F}function $(_){a.setTimeout(()=>{throw _},0)}function q(){var _=ae;let R=null;return _.g&&(R=_.g,_.g=_.g.next,_.g||(_.h=null),R.next=null),R}class Ue{constructor(){this.h=this.g=null}add(R,F){const X=fe.get();X.set(R,F),this.h?this.h.next=X:this.g=X,this.h=X}}var fe=new b(()=>new re,_=>_.reset());class re{constructor(){this.next=this.g=this.h=null}set(R,F){this.h=R,this.g=F,this.next=null}reset(){this.next=this.g=this.h=null}}let Y,Z=!1,ae=new Ue,j=()=>{const _=a.Promise.resolve(void 0);Y=()=>{_.then(C)}};var C=()=>{for(var _;_=q();){try{_.h.call(_.g)}catch(F){$(F)}var R=fe;R.j(_),100>R.h&&(R.h++,_.next=R.g,R.g=_)}Z=!1};function L(){this.s=this.s,this.C=this.C}L.prototype.s=!1,L.prototype.ma=function(){this.s||(this.s=!0,this.N())},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function k(_,R){this.type=_,this.g=this.target=R,this.defaultPrevented=!1}k.prototype.h=function(){this.defaultPrevented=!0};var ee=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var _=!1,R=Object.defineProperty({},"passive",{get:function(){_=!0}});try{const F=()=>{};a.addEventListener("test",F,R),a.removeEventListener("test",F,R)}catch{}return _}();function _e(_,R){if(k.call(this,_?_.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,_){var F=this.type=_.type,X=_.changedTouches&&_.changedTouches.length?_.changedTouches[0]:null;if(this.target=_.target||_.srcElement,this.g=R,R=_.relatedTarget){if(H){e:{try{U(R.nodeName);var ue=!0;break e}catch{}ue=!1}ue||(R=null)}}else F=="mouseover"?R=_.fromElement:F=="mouseout"&&(R=_.toElement);this.relatedTarget=R,X?(this.clientX=X.clientX!==void 0?X.clientX:X.pageX,this.clientY=X.clientY!==void 0?X.clientY:X.pageY,this.screenX=X.screenX||0,this.screenY=X.screenY||0):(this.clientX=_.clientX!==void 0?_.clientX:_.pageX,this.clientY=_.clientY!==void 0?_.clientY:_.pageY,this.screenX=_.screenX||0,this.screenY=_.screenY||0),this.button=_.button,this.key=_.key||"",this.ctrlKey=_.ctrlKey,this.altKey=_.altKey,this.shiftKey=_.shiftKey,this.metaKey=_.metaKey,this.pointerId=_.pointerId||0,this.pointerType=typeof _.pointerType=="string"?_.pointerType:ke[_.pointerType]||"",this.state=_.state,this.i=_,_.defaultPrevented&&_e.aa.h.call(this)}}y(_e,k);var ke={2:"touch",3:"pen",4:"mouse"};_e.prototype.h=function(){_e.aa.h.call(this);var _=this.i;_.preventDefault?_.preventDefault():_.returnValue=!1};var ft="closure_listenable_"+(1e6*Math.random()|0),Rt=0;function Gr(_,R,F,X,ue){this.listener=_,this.proxy=null,this.src=R,this.type=F,this.capture=!!X,this.ha=ue,this.key=++Rt,this.da=this.fa=!1}function Xi(_){_.da=!0,_.listener=null,_.proxy=null,_.src=null,_.ha=null}function Ls(_){this.src=_,this.g={},this.h=0}Ls.prototype.add=function(_,R,F,X,ue){var ge=_.toString();_=this.g[ge],_||(_=this.g[ge]=[],this.h++);var He=Wr(_,R,X,ue);return-1<He?(R=_[He],F||(R.fa=!1)):(R=new Gr(R,this.src,ge,!!X,ue),R.fa=F,_.push(R)),R};function Ur(_,R){var F=R.type;if(F in _.g){var X=_.g[F],ue=Array.prototype.indexOf.call(X,R,void 0),ge;(ge=0<=ue)&&Array.prototype.splice.call(X,ue,1),ge&&(Xi(R),_.g[F].length==0&&(delete _.g[F],_.h--))}}function Wr(_,R,F,X){for(var ue=0;ue<_.length;++ue){var ge=_[ue];if(!ge.da&&ge.listener==R&&ge.capture==!!F&&ge.ha==X)return ue}return-1}var kr="closure_lm_"+(1e6*Math.random()|0),qt={};function $t(_,R,F,X,ue){if(Array.isArray(R)){for(var ge=0;ge<R.length;ge++)$t(_,R[ge],F,X,ue);return null}return F=ut(F),_&&_[ft]?_.K(R,F,l(X)?!!X.capture:!1,ue):pt(_,R,F,!1,X,ue)}function pt(_,R,F,X,ue,ge){if(!R)throw Error("Invalid event type");var He=l(ue)?!!ue.capture:!!ue,Cn=xe(_);if(Cn||(_[kr]=Cn=new Ls(_)),F=Cn.add(R,F,X,He,ge),F.proxy)return F;if(X=Gn(),F.proxy=X,X.src=_,X.listener=F,_.addEventListener)ee||(ue=He),ue===void 0&&(ue=!1),_.addEventListener(R.toString(),X,ue);else if(_.attachEvent)_.attachEvent(at(R.toString()),X);else if(_.addListener&&_.removeListener)_.addListener(X);else throw Error("addEventListener and attachEvent are unavailable.");return F}function Gn(){function _(F){return R.call(_.src,_.listener,F)}const R=er;return _}function br(_,R,F,X,ue){if(Array.isArray(R))for(var ge=0;ge<R.length;ge++)br(_,R[ge],F,X,ue);else X=l(X)?!!X.capture:!!X,F=ut(F),_&&_[ft]?(_=_.i,R=String(R).toString(),R in _.g&&(ge=_.g[R],F=Wr(ge,F,X,ue),-1<F&&(Xi(ge[F]),Array.prototype.splice.call(ge,F,1),ge.length==0&&(delete _.g[R],_.h--)))):_&&(_=xe(_))&&(R=_.g[R.toString()],_=-1,R&&(_=Wr(R,F,X,ue)),(F=-1<_?R[_]:null)&&Kt(F))}function Kt(_){if(typeof _!="number"&&_&&!_.da){var R=_.src;if(R&&R[ft])Ur(R.i,_);else{var F=_.type,X=_.proxy;R.removeEventListener?R.removeEventListener(F,X,_.capture):R.detachEvent?R.detachEvent(at(F),X):R.addListener&&R.removeListener&&R.removeListener(X),(F=xe(R))?(Ur(F,_),F.h==0&&(F.src=null,R[kr]=null)):Xi(_)}}}function at(_){return _ in qt?qt[_]:qt[_]="on"+_}function er(_,R){if(_.da)_=!0;else{R=new _e(R,this);var F=_.listener,X=_.ha||_.src;_.fa&&Kt(_),_=F.call(X,R)}return _}function xe(_){return _=_[kr],_ instanceof Ls?_:null}var ze="__closure_events_fn_"+(1e9*Math.random()>>>0);function ut(_){return typeof _=="function"?_:(_[ze]||(_[ze]=function(R){return _.handleEvent(R)}),_[ze])}function $e(){L.call(this),this.i=new Ls(this),this.M=this,this.F=null}y($e,L),$e.prototype[ft]=!0,$e.prototype.removeEventListener=function(_,R,F,X){br(this,_,R,F,X)};function et(_,R){var F,X=_.F;if(X)for(F=[];X;X=X.F)F.push(X);if(_=_.M,X=R.type||R,typeof R=="string")R=new k(R,_);else if(R instanceof k)R.target=R.target||_;else{var ue=R;R=new k(X,_),O(R,ue)}if(ue=!0,F)for(var ge=F.length-1;0<=ge;ge--){var He=R.g=F[ge];ue=on(He,X,!0,R)&&ue}if(He=R.g=_,ue=on(He,X,!0,R)&&ue,ue=on(He,X,!1,R)&&ue,F)for(ge=0;ge<F.length;ge++)He=R.g=F[ge],ue=on(He,X,!1,R)&&ue}$e.prototype.N=function(){if($e.aa.N.call(this),this.i){var _=this.i,R;for(R in _.g){for(var F=_.g[R],X=0;X<F.length;X++)Xi(F[X]);delete _.g[R],_.h--}}this.F=null},$e.prototype.K=function(_,R,F,X){return this.i.add(String(_),R,!1,F,X)},$e.prototype.L=function(_,R,F,X){return this.i.add(String(_),R,!0,F,X)};function on(_,R,F,X){if(R=_.i.g[String(R)],!R)return!0;R=R.concat();for(var ue=!0,ge=0;ge<R.length;++ge){var He=R[ge];if(He&&!He.da&&He.capture==F){var Cn=He.listener,Zi=He.ha||He.src;He.fa&&Ur(_.i,He),ue=Cn.call(Zi,X)!==!1&&ue}}return ue&&!X.defaultPrevented}function mn(_,R,F){if(typeof _=="function")F&&(_=p(_,F));else if(_&&typeof _.handleEvent=="function")_=p(_.handleEvent,_);else throw Error("Invalid listener argument");return 2147483647<Number(R)?-1:a.setTimeout(_,R||0)}function Wn(_){_.g=mn(()=>{_.g=null,_.i&&(_.i=!1,Wn(_))},_.l);const R=_.h;_.h=null,_.m.apply(null,R)}class Ji extends L{constructor(R,F){super(),this.m=R,this.l=F,this.h=null,this.i=!1,this.g=null}j(R){this.h=arguments,this.g?this.i=!0:Wn(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function xr(_){L.call(this),this.h=_,this.g={}}y(xr,L);var Ps=[];function na(_){K(_.g,function(R,F){this.g.hasOwnProperty(F)&&Kt(R)},_),_.g={}}xr.prototype.N=function(){xr.aa.N.call(this),na(this)},xr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var zr=a.JSON.stringify,Us=a.JSON.parse,bc=class{stringify(_){return a.JSON.stringify(_,void 0)}parse(_){return a.JSON.parse(_,void 0)}};function sA(){}sA.prototype.h=null;function Cu(_){return _.h||(_.h=_.i())}function Tu(){}var oA={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ic(){k.call(this,"d")}y(Ic,k);function tp(){k.call(this,"c")}y(tp,k);var Pa={},fo=null;function ra(){return fo=fo||new $e}Pa.La="serverreachability";function fh(_){k.call(this,Pa.La,_)}y(fh,k);function aA(_){const R=ra();et(R,new fh(R))}Pa.STAT_EVENT="statevent";function Rc(_,R){k.call(this,Pa.STAT_EVENT,_),this.stat=R}y(Rc,k);function Ir(_){const R=ra();et(R,new Rc(R,_))}Pa.Ma="timingevent";function Vi(_,R){k.call(this,Pa.Ma,_),this.size=R}y(Vi,k);function bi(_,R){if(typeof _!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){_()},R)}function $i(){this.g=!0}$i.prototype.xa=function(){this.g=!1};function ph(_,R,F,X,ue,ge){_.info(function(){if(_.g)if(ge)for(var He="",Cn=ge.split("&"),Zi=0;Zi<Cn.length;Zi++){var Tn=Cn[Zi].split("=");if(1<Tn.length){var hs=Tn[0];Tn=Tn[1];var es=hs.split("_");He=2<=es.length&&es[1]=="type"?He+(hs+"="+Tn+"&"):He+(hs+"=redacted&")}}else He=null;else He=ge;return"XMLHTTP REQ ("+X+") [attempt "+ue+"]: "+R+`
`+F+`
`+He})}function Su(_,R,F,X,ue,ge,He){_.info(function(){return"XMLHTTP RESP ("+X+") [ attempt "+ue+"]: "+R+`
`+F+`
`+ge+" "+He})}function cA(_,R,F,X){_.info(function(){return"XMLHTTP TEXT ("+R+"): "+Oc(_,F)+(X?" "+X:"")})}function np(_,R){_.info(function(){return"TIMEOUT: "+R})}$i.prototype.info=function(){};function Oc(_,R){if(!_.g)return R;if(!R)return null;try{var F=JSON.parse(R);if(F){for(_=0;_<F.length;_++)if(Array.isArray(F[_])){var X=F[_];if(!(2>X.length)){var ue=X[1];if(Array.isArray(ue)&&!(1>ue.length)){var ge=ue[0];if(ge!="noop"&&ge!="stop"&&ge!="close")for(var He=1;He<ue.length;He++)ue[He]=""}}}}return zr(F)}catch{return R}}var ia={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Pn={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Qi;function po(){}y(po,sA),po.prototype.g=function(){return new XMLHttpRequest},po.prototype.i=function(){return{}},Qi=new po;function gr(_,R,F,X){this.j=_,this.i=R,this.l=F,this.R=X||1,this.U=new xr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new qr}function qr(){this.i=null,this.g="",this.h=!1}var mh={},Ii={};function ks(_,R,F){_.L=1,_.v=_l(go(R)),_.m=F,_.P=!0,mo(_,null)}function mo(_,R){_.F=Date.now(),AA(_),_.A=go(_.v);var F=_.A,X=_.R;Array.isArray(X)||(X=[String(X)]),Th(F.i,"t",X),_.C=0,F=_.j.J,_.h=new qr,_.g=xw(_.j,F?R:null,!_.m),0<_.O&&(_.M=new Ji(p(_.Y,_,_.g),_.O)),R=_.U,F=_.g,X=_.ca;var ue="readystatechange";Array.isArray(ue)||(ue&&(Ps[0]=ue.toString()),ue=Ps);for(var ge=0;ge<ue.length;ge++){var He=$t(F,ue[ge],X||R.handleEvent,!1,R.h||R);if(!He)break;R.g[He.key]=He}R=_.H?V(_.H):{},_.m?(_.u||(_.u="POST"),R["Content-Type"]="application/x-www-form-urlencoded",_.g.ea(_.A,_.u,_.m,R)):(_.u="GET",_.g.ea(_.A,_.u,null,R)),aA(),ph(_.i,_.u,_.A,_.l,_.R,_.m)}gr.prototype.ca=function(_){_=_.target;const R=this.M;R&&Ma(_)==3?R.j():this.Y(_)},gr.prototype.Y=function(_){try{if(_==this.g)e:{const es=Ma(this.g);var R=this.g.Ba();const vl=this.g.Z();if(!(3>es)&&(es!=3||this.g&&(this.h.h||this.g.oa()||Ow(this.g)))){this.J||es!=4||R==7||(R==8||0>=vl?aA(3):aA(2)),Ge(this);var F=this.g.Z();this.X=F;t:if(gh(this)){var X=Ow(this.g);_="";var ue=X.length,ge=Ma(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ri(this),mt(this);var He="";break t}this.h.i=new a.TextDecoder}for(R=0;R<ue;R++)this.h.h=!0,_+=this.h.i.decode(X[R],{stream:!(ge&&R==ue-1)});X.length=0,this.h.g+=_,this.C=0,He=this.h.g}else He=this.g.oa();if(this.o=F==200,Su(this.i,this.u,this.A,this.l,this.R,es,F),this.o){if(this.T&&!this.K){t:{if(this.g){var Cn,Zi=this.g;if((Cn=Zi.g?Zi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(Cn)){var Tn=Cn;break t}}Tn=null}if(F=Tn)cA(this.i,this.l,F,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,uA(this,F);else{this.o=!1,this.s=3,Ir(12),Ri(this),mt(this);break e}}if(this.P){F=!0;let Ms;for(;!this.J&&this.C<He.length;)if(Ms=_h(this,He),Ms==Ii){es==4&&(this.s=4,Ir(14),F=!1),cA(this.i,this.l,null,"[Incomplete Response]");break}else if(Ms==mh){this.s=4,Ir(15),cA(this.i,this.l,He,"[Invalid Chunk]"),F=!1;break}else cA(this.i,this.l,Ms,null),uA(this,Ms);if(gh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),es!=4||He.length!=0||this.h.h||(this.s=1,Ir(16),F=!1),this.o=this.o&&F,!F)cA(this.i,this.l,He,"[Invalid Chunked Response]"),Ri(this),mt(this);else if(0<He.length&&!this.W){this.W=!0;var hs=this.j;hs.g==this&&hs.ba&&!hs.M&&(hs.j.info("Great, no buffering proxy detected. Bytes received: "+He.length),Oh(hs),hs.M=!0,Ir(11))}}else cA(this.i,this.l,He,null),uA(this,He);es==4&&Ri(this),this.o&&!this.J&&(es==4?Pw(this.j,this):(this.o=!1,AA(this)))}else RR(this.g),F==400&&0<He.indexOf("Unknown SID")?(this.s=3,Ir(12)):(this.s=0,Ir(13)),Ri(this),mt(this)}}}catch{}finally{}};function gh(_){return _.g?_.u=="GET"&&_.L!=2&&_.j.Ca:!1}function _h(_,R){var F=_.C,X=R.indexOf(`
`,F);return X==-1?Ii:(F=Number(R.substring(F,X)),isNaN(F)?mh:(X+=1,X+F>R.length?Ii:(R=R.slice(X,X+F),_.C=X+F,R)))}gr.prototype.cancel=function(){this.J=!0,Ri(this)};function AA(_){_.S=Date.now()+_.I,lA(_,_.I)}function lA(_,R){if(_.B!=null)throw Error("WatchDog timer not null");_.B=bi(p(_.ba,_),R)}function Ge(_){_.B&&(a.clearTimeout(_.B),_.B=null)}gr.prototype.ba=function(){this.B=null;const _=Date.now();0<=_-this.S?(np(this.i,this.A),this.L!=2&&(aA(),Ir(17)),Ri(this),this.s=2,mt(this)):lA(this,this.S-_)};function mt(_){_.j.G==0||_.J||Pw(_.j,_)}function Ri(_){Ge(_);var R=_.M;R&&typeof R.ma=="function"&&R.ma(),_.M=null,na(_.U),_.g&&(R=_.g,_.g=null,R.abort(),R.ma())}function uA(_,R){try{var F=_.j;if(F.G!=0&&(F.g==_||Ua(F.h,_))){if(!_.K&&Ua(F.h,_)&&F.G==3){try{var X=F.Da.g.parse(R)}catch{X=null}if(Array.isArray(X)&&X.length==3){var ue=X;if(ue[0]==0){e:if(!F.u){if(F.g)if(F.g.F+3e3<_.F)cp(F),op(F);else break e;R_(F),Ir(18)}}else F.za=ue[1],0<F.za-F.T&&37500>ue[2]&&F.F&&F.v==0&&!F.C&&(F.C=bi(p(F.Za,F),6e3));if(1>=bu(F.h)&&F.ca){try{F.ca()}catch{}F.ca=void 0}}else yl(F,11)}else if((_.K||F.g==_)&&cp(F),!I(R))for(ue=F.Da.g.parse(R),R=0;R<ue.length;R++){let Tn=ue[R];if(F.T=Tn[0],Tn=Tn[1],F.G==2)if(Tn[0]=="c"){F.K=Tn[1],F.ia=Tn[2];const hs=Tn[3];hs!=null&&(F.la=hs,F.j.info("VER="+F.la));const es=Tn[4];es!=null&&(F.Aa=es,F.j.info("SVER="+F.Aa));const vl=Tn[5];vl!=null&&typeof vl=="number"&&0<vl&&(X=1.5*vl,F.L=X,F.j.info("backChannelRequestTimeoutMs_="+X)),X=F;const Ms=_.g;if(Ms){const _A=Ms.g?Ms.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(_A){var ge=X.h;ge.g||_A.indexOf("spdy")==-1&&_A.indexOf("quic")==-1&&_A.indexOf("h2")==-1||(ge.j=ge.l,ge.g=new Set,ge.h&&(Iu(ge,ge.h),ge.h=null))}if(X.D){const N_=Ms.g?Ms.g.getResponseHeader("X-HTTP-Session-Id"):null;N_&&(X.ya=N_,zn(X.I,X.D,N_))}}F.G=3,F.l&&F.l.ua(),F.ba&&(F.R=Date.now()-_.F,F.j.info("Handshake RTT: "+F.R+"ms")),X=F;var He=_;if(X.qa=kw(X,X.J?X.ia:null,X.W),He.K){us(X.h,He);var Cn=He,Zi=X.L;Zi&&(Cn.I=Zi),Cn.B&&(Ge(Cn),AA(Cn)),X.g=He}else Bw(X);0<F.i.length&&ap(F)}else Tn[0]!="stop"&&Tn[0]!="close"||yl(F,7);else F.G==3&&(Tn[0]=="stop"||Tn[0]=="close"?Tn[0]=="stop"?yl(F,7):b_(F):Tn[0]!="noop"&&F.l&&F.l.ta(Tn),F.v=0)}}aA(4)}catch{}}var rp=class{constructor(_,R){this.g=_,this.map=R}};function Nc(_){this.l=_||10,a.PerformanceNavigationTiming?(_=a.performance.getEntriesByType("navigation"),_=0<_.length&&(_[0].nextHopProtocol=="hq"||_[0].nextHopProtocol=="h2")):_=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=_?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function dA(_){return _.h?!0:_.g?_.g.size>=_.j:!1}function bu(_){return _.h?1:_.g?_.g.size:0}function Ua(_,R){return _.h?_.h==R:_.g?_.g.has(R):!1}function Iu(_,R){_.g?_.g.add(R):_.h=R}function us(_,R){_.h&&_.h==R?_.h=null:_.g&&_.g.has(R)&&_.g.delete(R)}Nc.prototype.cancel=function(){if(this.i=Eh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const _ of this.g.values())_.cancel();this.g.clear()}};function Eh(_){if(_.h!=null)return _.i.concat(_.h.D);if(_.g!=null&&_.g.size!==0){let R=_.i;for(const F of _.g.values())R=R.concat(F.D);return R}return E(_.i)}function C_(_){if(_.V&&typeof _.V=="function")return _.V();if(typeof Map<"u"&&_ instanceof Map||typeof Set<"u"&&_ instanceof Set)return Array.from(_.values());if(typeof _=="string")return _.split("");if(A(_)){for(var R=[],F=_.length,X=0;X<F;X++)R.push(_[X]);return R}R=[],F=0;for(X in _)R[F++]=_[X];return R}function pl(_){if(_.na&&typeof _.na=="function")return _.na();if(!_.V||typeof _.V!="function"){if(typeof Map<"u"&&_ instanceof Map)return Array.from(_.keys());if(!(typeof Set<"u"&&_ instanceof Set)){if(A(_)||typeof _=="string"){var R=[];_=_.length;for(var F=0;F<_;F++)R.push(F);return R}R=[],F=0;for(const X in _)R[F++]=X;return R}}}function yh(_,R){if(_.forEach&&typeof _.forEach=="function")_.forEach(R,void 0);else if(A(_)||typeof _=="string")Array.prototype.forEach.call(_,R,void 0);else for(var F=pl(_),X=C_(_),ue=X.length,ge=0;ge<ue;ge++)R.call(void 0,X[ge],F&&F[ge],_)}var ml=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function T_(_,R){if(_){_=_.split("&");for(var F=0;F<_.length;F++){var X=_[F].indexOf("="),ue=null;if(0<=X){var ge=_[F].substring(0,X);ue=_[F].substring(X+1)}else ge=_[F];R(ge,ue?decodeURIComponent(ue.replace(/\+/g," ")):"")}}}function Ai(_){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,_ instanceof Ai){this.h=_.h,gl(this,_.j),this.o=_.o,this.g=_.g,hA(this,_.s),this.l=_.l;var R=_.i,F=new Dc;F.i=R.i,R.g&&(F.g=new Map(R.g),F.h=R.h),ka(this,F),this.m=_.m}else _&&(R=String(_).match(ml))?(this.h=!1,gl(this,R[1]||"",!0),this.o=Bo(R[2]||""),this.g=Bo(R[3]||"",!0),hA(this,R[4]),this.l=Bo(R[5]||"",!0),ka(this,R[6]||"",!0),this.m=Bo(R[7]||"")):(this.h=!1,this.i=new Dc(null,this.h))}Ai.prototype.toString=function(){var _=[],R=this.j;R&&_.push(El(R,vh,!0),":");var F=this.g;return(F||R=="file")&&(_.push("//"),(R=this.o)&&_.push(El(R,vh,!0),"@"),_.push(encodeURIComponent(String(F)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F=this.s,F!=null&&_.push(":",String(F))),(F=this.l)&&(this.g&&F.charAt(0)!="/"&&_.push("/"),_.push(El(F,F.charAt(0)=="/"?Ch:wh,!0))),(F=this.i.toString())&&_.push("?",F),(F=this.m)&&_.push("#",El(F,Ru)),_.join("")};function go(_){return new Ai(_)}function gl(_,R,F){_.j=F?Bo(R,!0):R,_.j&&(_.j=_.j.replace(/:$/,""))}function hA(_,R){if(R){if(R=Number(R),isNaN(R)||0>R)throw Error("Bad port number "+R);_.s=R}else _.s=null}function ka(_,R,F){R instanceof Dc?(_.i=R,Sh(_.i,_.h)):(F||(R=El(R,S_)),_.i=new Dc(R,_.h))}function zn(_,R,F){_.i.set(R,F)}function _l(_){return zn(_,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),_}function Bo(_,R){return _?R?decodeURI(_.replace(/%25/g,"%2525")):decodeURIComponent(_):""}function El(_,R,F){return typeof _=="string"?(_=encodeURI(_).replace(R,ip),F&&(_=_.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_):null}function ip(_){return _=_.charCodeAt(0),"%"+(_>>4&15).toString(16)+(_&15).toString(16)}var vh=/[#\/\?@]/g,wh=/[#\?:]/g,Ch=/[#\?]/g,S_=/[#\?@]/g,Ru=/#/g;function Dc(_,R){this.h=this.g=null,this.i=_||null,this.j=!!R}function Lo(_){_.g||(_.g=new Map,_.h=0,_.i&&T_(_.i,function(R,F){_.add(decodeURIComponent(R.replace(/\+/g," ")),F)}))}t=Dc.prototype,t.add=function(_,R){Lo(this),this.i=null,_=xa(this,_);var F=this.g.get(_);return F||this.g.set(_,F=[]),F.push(R),this.h+=1,this};function sa(_,R){Lo(_),R=xa(_,R),_.g.has(R)&&(_.i=null,_.h-=_.g.get(R).length,_.g.delete(R))}function oa(_,R){return Lo(_),R=xa(_,R),_.g.has(R)}t.forEach=function(_,R){Lo(this),this.g.forEach(function(F,X){F.forEach(function(ue){_.call(R,ue,X,this)},this)},this)},t.na=function(){Lo(this);const _=Array.from(this.g.values()),R=Array.from(this.g.keys()),F=[];for(let X=0;X<R.length;X++){const ue=_[X];for(let ge=0;ge<ue.length;ge++)F.push(R[X])}return F},t.V=function(_){Lo(this);let R=[];if(typeof _=="string")oa(this,_)&&(R=R.concat(this.g.get(xa(this,_))));else{_=Array.from(this.g.values());for(let F=0;F<_.length;F++)R=R.concat(_[F])}return R},t.set=function(_,R){return Lo(this),this.i=null,_=xa(this,_),oa(this,_)&&(this.h-=this.g.get(_).length),this.g.set(_,[R]),this.h+=1,this},t.get=function(_,R){return _?(_=this.V(_),0<_.length?String(_[0]):R):R};function Th(_,R,F){sa(_,R),0<F.length&&(_.i=null,_.g.set(xa(_,R),E(F)),_.h+=F.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const _=[],R=Array.from(this.g.keys());for(var F=0;F<R.length;F++){var X=R[F];const ge=encodeURIComponent(String(X)),He=this.V(X);for(X=0;X<He.length;X++){var ue=ge;He[X]!==""&&(ue+="="+encodeURIComponent(String(He[X]))),_.push(ue)}}return this.i=_.join("&")};function xa(_,R){return R=String(R),_.j&&(R=R.toLowerCase()),R}function Sh(_,R){R&&!_.j&&(Lo(_),_.i=null,_.g.forEach(function(F,X){var ue=X.toLowerCase();X!=ue&&(sa(this,X),Th(this,ue,F))},_)),_.j=R}function fA(_,R){const F=new $i;if(a.Image){const X=new Image;X.onload=g(ce,F,"TestLoadImage: loaded",!0,R,X),X.onerror=g(ce,F,"TestLoadImage: error",!1,R,X),X.onabort=g(ce,F,"TestLoadImage: abort",!1,R,X),X.ontimeout=g(ce,F,"TestLoadImage: timeout",!1,R,X),a.setTimeout(function(){X.ontimeout&&X.ontimeout()},1e4),X.src=_}else R(!1)}function Po(_,R){const F=new $i,X=new AbortController,ue=setTimeout(()=>{X.abort(),ce(F,"TestPingServer: timeout",!1,R)},1e4);fetch(_,{signal:X.signal}).then(ge=>{clearTimeout(ue),ge.ok?ce(F,"TestPingServer: ok",!0,R):ce(F,"TestPingServer: server error",!1,R)}).catch(()=>{clearTimeout(ue),ce(F,"TestPingServer: error",!1,R)})}function ce(_,R,F,X,ue){try{ue&&(ue.onload=null,ue.onerror=null,ue.onabort=null,ue.ontimeout=null),X(F)}catch{}}function Ee(){this.g=new bc}function ye(_,R,F){const X=F||"";try{yh(_,function(ue,ge){let He=ue;l(ue)&&(He=zr(ue)),R.push(X+ge+"="+encodeURIComponent(He))})}catch(ue){throw R.push(X+"type="+encodeURIComponent("_badmap")),ue}}function Me(_){this.l=_.Ub||null,this.j=_.eb||!1}y(Me,sA),Me.prototype.g=function(){return new it(this.l,this.j)},Me.prototype.i=function(_){return function(){return _}}({});function it(_,R){$e.call(this),this.D=_,this.o=R,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}y(it,$e),t=it.prototype,t.open=function(_,R){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=_,this.A=R,this.readyState=1,Tt(this)},t.send=function(_){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const R={headers:this.u,method:this.B,credentials:this.m,cache:void 0};_&&(R.body=_),(this.D||a).fetch(new Request(this.A,R)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Gt(this)),this.readyState=0},t.Sa=function(_){if(this.g&&(this.l=_,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=_.headers,this.readyState=2,Tt(this)),this.g&&(this.readyState=3,Tt(this),this.g)))if(this.responseType==="arraybuffer")_.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in _){if(this.j=_.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;yn(this)}else _.text().then(this.Ra.bind(this),this.ga.bind(this))};function yn(_){_.j.read().then(_.Pa.bind(_)).catch(_.ga.bind(_))}t.Pa=function(_){if(this.g){if(this.o&&_.value)this.response.push(_.value);else if(!this.o){var R=_.value?_.value:new Uint8Array(0);(R=this.v.decode(R,{stream:!_.done}))&&(this.response=this.responseText+=R)}_.done?Gt(this):Tt(this),this.readyState==3&&yn(this)}},t.Ra=function(_){this.g&&(this.response=this.responseText=_,Gt(this))},t.Qa=function(_){this.g&&(this.response=_,Gt(this))},t.ga=function(){this.g&&Gt(this)};function Gt(_){_.readyState=4,_.l=null,_.j=null,_.v=null,Tt(_)}t.setRequestHeader=function(_,R){this.u.append(_,R)},t.getResponseHeader=function(_){return this.h&&this.h.get(_.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const _=[],R=this.h.entries();for(var F=R.next();!F.done;)F=F.value,_.push(F[0]+": "+F[1]),F=R.next();return _.join(`\r
`)};function Tt(_){_.onreadystatechange&&_.onreadystatechange.call(_)}Object.defineProperty(it.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(_){this.m=_?"include":"same-origin"}});function Zt(_){let R="";return K(_,function(F,X){R+=X,R+=":",R+=F,R+=`\r
`}),R}function Nt(_,R,F){e:{for(X in F){var X=!1;break e}X=!0}X||(F=Zt(F),typeof _=="string"?F!=null&&encodeURIComponent(String(F)):zn(_,R,F))}function Ht(_){$e.call(this),this.headers=new Map,this.o=_||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}y(Ht,$e);var xs=/^https?$/i,ds=["POST","PUT"];t=Ht.prototype,t.Ha=function(_){this.J=_},t.ea=function(_,R,F,X){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+_);R=R?R.toUpperCase():"GET",this.D=_,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Qi.g(),this.v=this.o?Cu(this.o):Cu(Qi),this.g.onreadystatechange=p(this.Ea,this);try{this.B=!0,this.g.open(R,String(_),!0),this.B=!1}catch(ge){pA(this,ge);return}if(_=F||"",F=new Map(this.headers),X)if(Object.getPrototypeOf(X)===Object.prototype)for(var ue in X)F.set(ue,X[ue]);else if(typeof X.keys=="function"&&typeof X.get=="function")for(const ge of X.keys())F.set(ge,X.get(ge));else throw Error("Unknown input type for opt_headers: "+String(X));X=Array.from(F.keys()).find(ge=>ge.toLowerCase()=="content-type"),ue=a.FormData&&_ instanceof a.FormData,!(0<=Array.prototype.indexOf.call(ds,R,void 0))||X||ue||F.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ge,He]of F)this.g.setRequestHeader(ge,He);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{bh(this),this.u=!0,this.g.send(_),this.u=!1}catch(ge){pA(this,ge)}};function pA(_,R){_.h=!1,_.g&&(_.j=!0,_.g.abort(),_.j=!1),_.l=R,_.m=5,Js(_),mA(_)}function Js(_){_.A||(_.A=!0,et(_,"complete"),et(_,"error"))}t.abort=function(_){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=_||7,et(this,"complete"),et(this,"abort"),mA(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),mA(this,!0)),Ht.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?_o(this):this.bb())},t.bb=function(){_o(this)};function _o(_){if(_.h&&typeof o<"u"&&(!_.v[1]||Ma(_)!=4||_.Z()!=2)){if(_.u&&Ma(_)==4)mn(_.Ea,0,_);else if(et(_,"readystatechange"),Ma(_)==4){_.h=!1;try{const He=_.Z();e:switch(He){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var R=!0;break e;default:R=!1}var F;if(!(F=R)){var X;if(X=He===0){var ue=String(_.D).match(ml)[1]||null;!ue&&a.self&&a.self.location&&(ue=a.self.location.protocol.slice(0,-1)),X=!xs.test(ue?ue.toLowerCase():"")}F=X}if(F)et(_,"complete"),et(_,"success");else{_.m=6;try{var ge=2<Ma(_)?_.g.statusText:""}catch{ge=""}_.l=ge+" ["+_.Z()+"]",Js(_)}}finally{mA(_)}}}}function mA(_,R){if(_.g){bh(_);const F=_.g,X=_.v[0]?()=>{}:null;_.g=null,_.v=null,R||et(_,"ready");try{F.onreadystatechange=X}catch{}}}function bh(_){_.I&&(a.clearTimeout(_.I),_.I=null)}t.isActive=function(){return!!this.g};function Ma(_){return _.g?_.g.readyState:0}t.Z=function(){try{return 2<Ma(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(_){if(this.g){var R=this.g.responseText;return _&&R.indexOf(_)==0&&(R=R.substring(_.length)),Us(R)}};function Ow(_){try{if(!_.g)return null;if("response"in _.g)return _.g.response;switch(_.H){case"":case"text":return _.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in _.g)return _.g.mozResponseArrayBuffer}return null}catch{return null}}function RR(_){const R={};_=(_.g&&2<=Ma(_)&&_.g.getAllResponseHeaders()||"").split(`\r
`);for(let X=0;X<_.length;X++){if(I(_[X]))continue;var F=z(_[X]);const ue=F[0];if(F=F[1],typeof F!="string")continue;F=F.trim();const ge=R[ue]||[];R[ue]=ge,ge.push(F)}x(R,function(X){return X.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ih(_,R,F){return F&&F.internalChannelParams&&F.internalChannelParams[_]||R}function sp(_){this.Aa=0,this.i=[],this.j=new $i,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ih("failFast",!1,_),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ih("baseRetryDelayMs",5e3,_),this.cb=Ih("retryDelaySeedMs",1e4,_),this.Wa=Ih("forwardChannelMaxRetries",2,_),this.wa=Ih("forwardChannelRequestTimeoutMs",2e4,_),this.pa=_&&_.xmlHttpFactory||void 0,this.Xa=_&&_.Tb||void 0,this.Ca=_&&_.useFetchStreams||!1,this.L=void 0,this.J=_&&_.supportsCrossDomainXhr||!1,this.K="",this.h=new Nc(_&&_.concurrentRequestLimit),this.Da=new Ee,this.P=_&&_.fastHandshake||!1,this.O=_&&_.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=_&&_.Rb||!1,_&&_.xa&&this.j.xa(),_&&_.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&_&&_.detectBufferingProxy||!1,this.ja=void 0,_&&_.longPollingTimeout&&0<_.longPollingTimeout&&(this.ja=_.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=sp.prototype,t.la=8,t.G=1,t.connect=function(_,R,F,X){Ir(0),this.W=_,this.H=R||{},F&&X!==void 0&&(this.H.OSID=F,this.H.OAID=X),this.F=this.X,this.I=kw(this,null,this.W),ap(this)};function b_(_){if(Nw(_),_.G==3){var R=_.U++,F=go(_.I);if(zn(F,"SID",_.K),zn(F,"RID",R),zn(F,"TYPE","terminate"),Rh(_,F),R=new gr(_,_.j,R),R.L=2,R.v=_l(go(F)),F=!1,a.navigator&&a.navigator.sendBeacon)try{F=a.navigator.sendBeacon(R.v.toString(),"")}catch{}!F&&a.Image&&(new Image().src=R.v,F=!0),F||(R.g=xw(R.j,null),R.g.ea(R.v)),R.F=Date.now(),AA(R)}Uw(_)}function op(_){_.g&&(Oh(_),_.g.cancel(),_.g=null)}function Nw(_){op(_),_.u&&(a.clearTimeout(_.u),_.u=null),cp(_),_.h.cancel(),_.s&&(typeof _.s=="number"&&a.clearTimeout(_.s),_.s=null)}function ap(_){if(!dA(_.h)&&!_.s){_.s=!0;var R=_.Ga;Y||j(),Z||(Y(),Z=!0),ae.add(R,_),_.B=0}}function OR(_,R){return bu(_.h)>=_.h.j-(_.s?1:0)?!1:_.s?(_.i=R.D.concat(_.i),!0):_.G==1||_.G==2||_.B>=(_.Va?0:_.Wa)?!1:(_.s=bi(p(_.Ga,_,R),O_(_,_.B)),_.B++,!0)}t.Ga=function(_){if(this.s)if(this.s=null,this.G==1){if(!_){this.U=Math.floor(1e5*Math.random()),_=this.U++;const ue=new gr(this,this.j,_);let ge=this.o;if(this.S&&(ge?(ge=V(ge),O(ge,this.S)):ge=this.S),this.m!==null||this.O||(ue.H=ge,ge=null),this.P)e:{for(var R=0,F=0;F<this.i.length;F++){t:{var X=this.i[F];if("__data__"in X.map&&(X=X.map.__data__,typeof X=="string")){X=X.length;break t}X=void 0}if(X===void 0)break;if(R+=X,4096<R){R=F;break e}if(R===4096||F===this.i.length-1){R=F+1;break e}}R=1e3}else R=1e3;R=Dw(this,ue,R),F=go(this.I),zn(F,"RID",_),zn(F,"CVER",22),this.D&&zn(F,"X-HTTP-Session-Id",this.D),Rh(this,F),ge&&(this.O?R="headers="+encodeURIComponent(String(Zt(ge)))+"&"+R:this.m&&Nt(F,this.m,ge)),Iu(this.h,ue),this.Ua&&zn(F,"TYPE","init"),this.P?(zn(F,"$req",R),zn(F,"SID","null"),ue.T=!0,ks(ue,F,null)):ks(ue,F,R),this.G=2}}else this.G==3&&(_?I_(this,_):this.i.length==0||dA(this.h)||I_(this))};function I_(_,R){var F;R?F=R.l:F=_.U++;const X=go(_.I);zn(X,"SID",_.K),zn(X,"RID",F),zn(X,"AID",_.T),Rh(_,X),_.m&&_.o&&Nt(X,_.m,_.o),F=new gr(_,_.j,F,_.B+1),_.m===null&&(F.H=_.o),R&&(_.i=R.D.concat(_.i)),R=Dw(_,F,1e3),F.I=Math.round(.5*_.wa)+Math.round(.5*_.wa*Math.random()),Iu(_.h,F),ks(F,X,R)}function Rh(_,R){_.H&&K(_.H,function(F,X){zn(R,X,F)}),_.l&&yh({},function(F,X){zn(R,X,F)})}function Dw(_,R,F){F=Math.min(_.i.length,F);var X=_.l?p(_.l.Na,_.l,_):null;e:{var ue=_.i;let ge=-1;for(;;){const He=["count="+F];ge==-1?0<F?(ge=ue[0].g,He.push("ofs="+ge)):ge=0:He.push("ofs="+ge);let Cn=!0;for(let Zi=0;Zi<F;Zi++){let Tn=ue[Zi].g;const hs=ue[Zi].map;if(Tn-=ge,0>Tn)ge=Math.max(0,ue[Zi].g-100),Cn=!1;else try{ye(hs,He,"req"+Tn+"_")}catch{X&&X(hs)}}if(Cn){X=He.join("&");break e}}}return _=_.i.splice(0,F),R.D=_,X}function Bw(_){if(!_.g&&!_.u){_.Y=1;var R=_.Fa;Y||j(),Z||(Y(),Z=!0),ae.add(R,_),_.v=0}}function R_(_){return _.g||_.u||3<=_.v?!1:(_.Y++,_.u=bi(p(_.Fa,_),O_(_,_.v)),_.v++,!0)}t.Fa=function(){if(this.u=null,Lw(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var _=2*this.R;this.j.info("BP detection timer enabled: "+_),this.A=bi(p(this.ab,this),_)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ir(10),op(this),Lw(this))};function Oh(_){_.A!=null&&(a.clearTimeout(_.A),_.A=null)}function Lw(_){_.g=new gr(_,_.j,"rpc",_.Y),_.m===null&&(_.g.H=_.o),_.g.O=0;var R=go(_.qa);zn(R,"RID","rpc"),zn(R,"SID",_.K),zn(R,"AID",_.T),zn(R,"CI",_.F?"0":"1"),!_.F&&_.ja&&zn(R,"TO",_.ja),zn(R,"TYPE","xmlhttp"),Rh(_,R),_.m&&_.o&&Nt(R,_.m,_.o),_.L&&(_.g.I=_.L);var F=_.g;_=_.ia,F.L=1,F.v=_l(go(R)),F.m=null,F.P=!0,mo(F,_)}t.Za=function(){this.C!=null&&(this.C=null,op(this),R_(this),Ir(19))};function cp(_){_.C!=null&&(a.clearTimeout(_.C),_.C=null)}function Pw(_,R){var F=null;if(_.g==R){cp(_),Oh(_),_.g=null;var X=2}else if(Ua(_.h,R))F=R.D,us(_.h,R),X=1;else return;if(_.G!=0){if(R.o)if(X==1){F=R.m?R.m.length:0,R=Date.now()-R.F;var ue=_.B;X=ra(),et(X,new Vi(X,F)),ap(_)}else Bw(_);else if(ue=R.s,ue==3||ue==0&&0<R.X||!(X==1&&OR(_,R)||X==2&&R_(_)))switch(F&&0<F.length&&(R=_.h,R.i=R.i.concat(F)),ue){case 1:yl(_,5);break;case 4:yl(_,10);break;case 3:yl(_,6);break;default:yl(_,2)}}}function O_(_,R){let F=_.Ta+Math.floor(Math.random()*_.cb);return _.isActive()||(F*=2),F*R}function yl(_,R){if(_.j.info("Error code "+R),R==2){var F=p(_.fb,_),X=_.Xa;const ue=!X;X=new Ai(X||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||gl(X,"https"),_l(X),ue?fA(X.toString(),F):Po(X.toString(),F)}else Ir(2);_.G=0,_.l&&_.l.sa(R),Uw(_),Nw(_)}t.fb=function(_){_?(this.j.info("Successfully pinged google.com"),Ir(2)):(this.j.info("Failed to ping google.com"),Ir(1))};function Uw(_){if(_.G=0,_.ka=[],_.l){const R=Eh(_.h);(R.length!=0||_.i.length!=0)&&(w(_.ka,R),w(_.ka,_.i),_.h.i.length=0,E(_.i),_.i.length=0),_.l.ra()}}function kw(_,R,F){var X=F instanceof Ai?go(F):new Ai(F);if(X.g!="")R&&(X.g=R+"."+X.g),hA(X,X.s);else{var ue=a.location;X=ue.protocol,R=R?R+"."+ue.hostname:ue.hostname,ue=+ue.port;var ge=new Ai(null);X&&gl(ge,X),R&&(ge.g=R),ue&&hA(ge,ue),F&&(ge.l=F),X=ge}return F=_.D,R=_.ya,F&&R&&zn(X,F,R),zn(X,"VER",_.la),Rh(_,X),X}function xw(_,R,F){if(R&&!_.J)throw Error("Can't create secondary domain capable XhrIo object.");return R=_.Ca&&!_.pa?new Ht(new Me({eb:F})):new Ht(_.pa),R.Ha(_.J),R}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Mw(){}t=Mw.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Ap(){}Ap.prototype.g=function(_,R){return new Eo(_,R)};function Eo(_,R){$e.call(this),this.g=new sp(R),this.l=_,this.h=R&&R.messageUrlParams||null,_=R&&R.messageHeaders||null,R&&R.clientProtocolHeaderRequired&&(_?_["X-Client-Protocol"]="webchannel":_={"X-Client-Protocol":"webchannel"}),this.g.o=_,_=R&&R.initMessageHeaders||null,R&&R.messageContentType&&(_?_["X-WebChannel-Content-Type"]=R.messageContentType:_={"X-WebChannel-Content-Type":R.messageContentType}),R&&R.va&&(_?_["X-WebChannel-Client-Profile"]=R.va:_={"X-WebChannel-Client-Profile":R.va}),this.g.S=_,(_=R&&R.Sb)&&!I(_)&&(this.g.m=_),this.v=R&&R.supportsCrossDomainXhr||!1,this.u=R&&R.sendRawJson||!1,(R=R&&R.httpSessionIdParam)&&!I(R)&&(this.g.D=R,_=this.h,_!==null&&R in _&&(_=this.h,R in _&&delete _[R])),this.j=new gA(this)}y(Eo,$e),Eo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Eo.prototype.close=function(){b_(this.g)},Eo.prototype.o=function(_){var R=this.g;if(typeof _=="string"){var F={};F.__data__=_,_=F}else this.u&&(F={},F.__data__=zr(_),_=F);R.i.push(new rp(R.Ya++,_)),R.G==3&&ap(R)},Eo.prototype.N=function(){this.g.l=null,delete this.j,b_(this.g),delete this.g,Eo.aa.N.call(this)};function Fw(_){Ic.call(this),_.__headers__&&(this.headers=_.__headers__,this.statusCode=_.__status__,delete _.__headers__,delete _.__status__);var R=_.__sm__;if(R){e:{for(const F in R){_=F;break e}_=void 0}(this.i=_)&&(_=this.i,R=R!==null&&_ in R?R[_]:void 0),this.data=R}else this.data=_}y(Fw,Ic);function Vw(){tp.call(this),this.status=1}y(Vw,tp);function gA(_){this.g=_}y(gA,Mw),gA.prototype.ua=function(){et(this.g,"a")},gA.prototype.ta=function(_){et(this.g,new Fw(_))},gA.prototype.sa=function(_){et(this.g,new Vw)},gA.prototype.ra=function(){et(this.g,"b")},Ap.prototype.createWebChannel=Ap.prototype.g,Eo.prototype.send=Eo.prototype.o,Eo.prototype.open=Eo.prototype.m,Eo.prototype.close=Eo.prototype.close,Qq=function(){return new Ap},Vq=function(){return ra()},Fq=Pa,iL={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ia.NO_ERROR=0,ia.TIMEOUT=8,ia.HTTP_ERROR=6,I0=ia,Pn.COMPLETE="complete",Mq=Pn,Tu.EventType=oA,oA.OPEN="a",oA.CLOSE="b",oA.ERROR="c",oA.MESSAGE="d",$e.prototype.listen=$e.prototype.K,GE=Tu,Ht.prototype.listenOnce=Ht.prototype.L,Ht.prototype.getLastError=Ht.prototype.Ka,Ht.prototype.getLastErrorCode=Ht.prototype.Ba,Ht.prototype.getStatus=Ht.prototype.Z,Ht.prototype.getResponseJson=Ht.prototype.Oa,Ht.prototype.getResponseText=Ht.prototype.oa,Ht.prototype.send=Ht.prototype.ea,Ht.prototype.setWithCredentials=Ht.prototype.Ha,xq=Ht}).apply(typeof KC<"u"?KC:typeof self<"u"?self:typeof window<"u"?window:{});const aQ="@firebase/firestore",cQ="4.7.17";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class so{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}so.UNAUTHENTICATED=new so(null),so.GOOGLE_CREDENTIALS=new so("google-credentials-uid"),so.FIRST_PARTY=new so("first-party-uid"),so.MOCK_USER=new so("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jg="11.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uf=new Wv("@firebase/firestore");function _m(){return Uf.logLevel}function nt(t,...e){if(Uf.logLevel<=fn.DEBUG){const n=e.map(rk);Uf.debug(`Firestore (${Jg}): ${t}`,...n)}}function fu(t,...e){if(Uf.logLevel<=fn.ERROR){const n=e.map(rk);Uf.error(`Firestore (${Jg}): ${t}`,...n)}}function fg(t,...e){if(Uf.logLevel<=fn.WARN){const n=e.map(rk);Uf.warn(`Firestore (${Jg}): ${t}`,...n)}}function rk(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qt(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,Hq(t,r,n)}function Hq(t,e,n){let r=`FIRESTORE (${Jg}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw fu(r),new Error(r)}function oi(t,e,n,r){let i="Unexpected state";typeof n=="string"?i=n:r=n,t||Hq(e,i,r)}function On(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qe={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ct extends yc{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cf{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jq{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Bde{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(so.UNAUTHENTICATED))}shutdown(){}}class Lde{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class Pde{constructor(e){this.t=e,this.currentUser=so.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){oi(this.o===void 0,42304);let r=this.i;const i=A=>this.i!==r?(r=this.i,n(A)):Promise.resolve();let s=new Cf;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Cf,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const A=s;e.enqueueRetryable(async()=>{await A.promise,await i(this.currentUser)})},a=A=>{nt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=A,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(A=>a(A)),setTimeout(()=>{if(!this.auth){const A=this.t.getImmediate({optional:!0});A?a(A):(nt("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Cf)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(nt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(oi(typeof r.accessToken=="string",31837,{l:r}),new jq(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return oi(e===null||typeof e=="string",2055,{h:e}),new so(e)}}class Ude{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=so.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class kde{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new Ude(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(so.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class AQ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class xde{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,cc(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){oi(this.o===void 0,3512);const r=s=>{s.error!=null&&nt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.m;return this.m=s.token,nt("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{nt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.V.getImmediate({optional:!0});s?i(s):nt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new AQ(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(oi(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new AQ(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mde(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kq(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fde{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=Mde(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%62))}return r}}function An(t,e){return t<e?-1:t>e?1:0}function sL(t,e){let n=0;for(;n<t.length&&n<e.length;){const r=t.codePointAt(n),i=e.codePointAt(n);if(r!==i){if(r<128&&i<128)return An(r,i);{const s=Kq(),o=Vde(s.encode(lQ(t,n)),s.encode(lQ(e,n)));return o!==0?o:An(r,i)}}n+=r>65535?2:1}return An(t.length,e.length)}function lQ(t,e){return t.codePointAt(e)>65535?t.substring(e,e+2):t.substring(e,e+1)}function Vde(t,e){for(let n=0;n<t.length&&n<e.length;++n)if(t[n]!==e[n])return An(t[n],e[n]);return An(t.length,e.length)}function pg(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uQ=-62135596800,dQ=1e6;class Os{static now(){return Os.fromMillis(Date.now())}static fromDate(e){return Os.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*dQ);return new Os(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ct(Qe.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ct(Qe.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<uQ)throw new ct(Qe.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ct(Qe.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/dQ}_compareTo(e){return this.seconds===e.seconds?An(this.nanoseconds,e.nanoseconds):An(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-uQ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vt{static fromTimestamp(e){return new Vt(e)}static min(){return new Vt(new Os(0,0))}static max(){return new Vt(new Os(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hQ="__name__";class kA{constructor(e,n,r){n===void 0?n=0:n>e.length&&Qt(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&Qt(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return kA.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof kA?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=kA.compareSegments(e.get(i),n.get(i));if(s!==0)return s}return An(e.length,n.length)}static compareSegments(e,n){const r=kA.isNumericId(e),i=kA.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?kA.extractNumericId(e).compare(kA.extractNumericId(n)):sL(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Pd.fromString(e.substring(4,e.length-2))}}class ti extends kA{construct(e,n,r){return new ti(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ct(Qe.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new ti(n)}static emptyPath(){return new ti([])}}const Qde=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ao extends kA{construct(e,n,r){return new Ao(e,n,r)}static isValidIdentifier(e){return Qde.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ao.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===hQ}static keyField(){return new Ao([hQ])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new ct(Qe.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new ct(Qe.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const A=e[i+1];if(A!=="\\"&&A!=="."&&A!=="`")throw new ct(Qe.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=A,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new ct(Qe.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ao(n)}static emptyPath(){return new Ao([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It{constructor(e){this.path=e}static fromPath(e){return new It(ti.fromString(e))}static fromName(e){return new It(ti.fromString(e).popFirst(5))}static empty(){return new It(ti.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ti.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return ti.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new It(new ti(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zy=-1;function Hde(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Vt.fromTimestamp(r===1e9?new Os(n+1,0):new Os(n,r));return new Wd(i,It.empty(),e)}function jde(t){return new Wd(t.readTime,t.key,Zy)}class Wd{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Wd(Vt.min(),It.empty(),Zy)}static max(){return new Wd(Vt.max(),It.empty(),Zy)}}function Kde(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=It.comparator(t.documentKey,e.documentKey),n!==0?n:An(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gde="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Wde{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eI(t){if(t.code!==Qe.FAILED_PRECONDITION||t.message!==Gde)throw t;nt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Qt(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new De((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof De?n:De.resolve(n)}catch(n){return De.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):De.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):De.reject(n)}static resolve(e){return new De((n,r)=>{n(e)})}static reject(e){return new De((n,r)=>{r(e)})}static waitFor(e){return new De((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},A=>r(A))}),o=!0,s===i&&n()})}static or(e){let n=De.resolve(!1);for(const r of e)n=n.next(i=>i?De.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new De((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let A=0;A<s;A++){const l=A;n(e[l]).next(d=>{o[l]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,n){return new De((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}function zde(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function $g(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ue(r),this.ce=r=>n.writeSequenceNumber(r))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ce&&this.ce(e),e}}tI.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qde=-1;function nI(t){return t==null}function DS(t){return t===0&&1/t==-1/0}function Yde(t){return typeof t=="number"&&Number.isInteger(t)&&!DS(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gq="";function Xde(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=fQ(e)),e=Jde(t.get(n),e);return fQ(e)}function Jde(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const s=t.charAt(i);switch(s){case"\0":n+="";break;case Gq:n+="";break;default:n+=s}}return n}function fQ(t){return t+Gq+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pQ(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Zg(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Wq(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ns=class oL{constructor(e,n){this.comparator=e,this.root=n||Ud.EMPTY}insert(e,n){return new oL(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Ud.BLACK,null,null))}remove(e){return new oL(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ud.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new GC(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new GC(this.root,e,this.comparator,!1)}getReverseIterator(){return new GC(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new GC(this.root,e,this.comparator,!0)}},GC=class{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Ud=class jl{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??jl.RED,this.left=i??jl.EMPTY,this.right=s??jl.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new jl(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return jl.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return jl.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,jl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,jl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Qt(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Qt(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Qt(27949);return e+(this.isRed()?0:1)}};Ud.EMPTY=null,Ud.RED=!0,Ud.BLACK=!1;Ud.EMPTY=new class{constructor(){this.size=0}get key(){throw Qt(57766)}get value(){throw Qt(16141)}get color(){throw Qt(16727)}get left(){throw Qt(29726)}get right(){throw Qt(36894)}copy(e,n,r,i,s){return this}insert(e,n,r){return new Ud(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ls{constructor(e){this.comparator=e,this.data=new Ns(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new mQ(this.data.getIterator())}getIteratorFrom(e){return new mQ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof ls)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ls(this.comparator);return n.data=e,n}}class mQ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vd{constructor(e){this.fields=e,e.sort(Ao.comparator)}static empty(){return new vd([])}unionWith(e){let n=new ls(Ao.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new vd(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return pg(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zq extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new zq("Invalid base64 string: "+s):s}}(e);return new Ys(n)}static fromUint8Array(e){const n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new Ys(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return An(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ys.EMPTY_BYTE_STRING=new Ys("");const $de=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function zd(t){if(oi(!!t,39018),typeof t=="string"){let e=0;const n=$de.exec(t);if(oi(!!n,46558,{timestamp:t}),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ui(t.seconds),nanos:Ui(t.nanos)}}function Ui(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function qd(t){return typeof t=="string"?Ys.fromBase64String(t):Ys.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qq="server_timestamp",Yq="__type__",Xq="__previous_value__",Jq="__local_write_time__";function ik(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[Yq])===null||n===void 0?void 0:n.stringValue)===qq}function rI(t){const e=t.mapValue.fields[Xq];return ik(e)?rI(e):e}function ev(t){const e=zd(t.mapValue.fields[Jq].timestampValue);return new Os(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zde{constructor(e,n,r,i,s,o,a,A,l,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=A,this.useFetchStreams=l,this.isUsingEmulator=d}}const BS="(default)";class tv{constructor(e,n){this.projectId=e,this.database=n||BS}static empty(){return new tv("","")}get isDefaultDatabase(){return this.database===BS}isEqual(e){return e instanceof tv&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $q="__type__",ehe="__max__",WC={mapValue:{}},Zq="__vector__",LS="value";function Yd(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ik(t)?4:nhe(t)?9007199254740991:the(t)?10:11:Qt(28295,{value:t})}function tl(t,e){if(t===e)return!0;const n=Yd(t);if(n!==Yd(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ev(t).isEqual(ev(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=zd(i.timestampValue),a=zd(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return qd(i.bytesValue).isEqual(qd(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return Ui(i.geoPointValue.latitude)===Ui(s.geoPointValue.latitude)&&Ui(i.geoPointValue.longitude)===Ui(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ui(i.integerValue)===Ui(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=Ui(i.doubleValue),a=Ui(s.doubleValue);return o===a?DS(o)===DS(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return pg(t.arrayValue.values||[],e.arrayValue.values||[],tl);case 10:case 11:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(pQ(o)!==pQ(a))return!1;for(const A in o)if(o.hasOwnProperty(A)&&(a[A]===void 0||!tl(o[A],a[A])))return!1;return!0}(t,e);default:return Qt(52216,{left:t})}}function nv(t,e){return(t.values||[]).find(n=>tl(n,e))!==void 0}function mg(t,e){if(t===e)return 0;const n=Yd(t),r=Yd(e);if(n!==r)return An(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return An(t.booleanValue,e.booleanValue);case 2:return function(s,o){const a=Ui(s.integerValue||s.doubleValue),A=Ui(o.integerValue||o.doubleValue);return a<A?-1:a>A?1:a===A?0:isNaN(a)?isNaN(A)?0:-1:1}(t,e);case 3:return gQ(t.timestampValue,e.timestampValue);case 4:return gQ(ev(t),ev(e));case 5:return sL(t.stringValue,e.stringValue);case 6:return function(s,o){const a=qd(s),A=qd(o);return a.compareTo(A)}(t.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),A=o.split("/");for(let l=0;l<a.length&&l<A.length;l++){const d=An(a[l],A[l]);if(d!==0)return d}return An(a.length,A.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,o){const a=An(Ui(s.latitude),Ui(o.latitude));return a!==0?a:An(Ui(s.longitude),Ui(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return _Q(t.arrayValue,e.arrayValue);case 10:return function(s,o){var a,A,l,d;const f=s.fields||{},p=o.fields||{},g=(a=f[LS])===null||a===void 0?void 0:a.arrayValue,y=(A=p[LS])===null||A===void 0?void 0:A.arrayValue,E=An(((l=g==null?void 0:g.values)===null||l===void 0?void 0:l.length)||0,((d=y==null?void 0:y.values)===null||d===void 0?void 0:d.length)||0);return E!==0?E:_Q(g,y)}(t.mapValue,e.mapValue);case 11:return function(s,o){if(s===WC.mapValue&&o===WC.mapValue)return 0;if(s===WC.mapValue)return 1;if(o===WC.mapValue)return-1;const a=s.fields||{},A=Object.keys(a),l=o.fields||{},d=Object.keys(l);A.sort(),d.sort();for(let f=0;f<A.length&&f<d.length;++f){const p=sL(A[f],d[f]);if(p!==0)return p;const g=mg(a[A[f]],l[d[f]]);if(g!==0)return g}return An(A.length,d.length)}(t.mapValue,e.mapValue);default:throw Qt(23264,{Pe:n})}}function gQ(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return An(t,e);const n=zd(t),r=zd(e),i=An(n.seconds,r.seconds);return i!==0?i:An(n.nanos,r.nanos)}function _Q(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const s=mg(n[i],r[i]);if(s)return s}return An(n.length,r.length)}function gg(t){return aL(t)}function aL(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=zd(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return qd(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return It.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const s of n.values||[])i?i=!1:r+=",",r+=aL(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${aL(n.fields[o])}`;return i+"}"}(t.mapValue):Qt(61005,{value:t})}function R0(t){switch(Yd(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=rI(t);return e?16+R0(e):16;case 5:return 2*t.stringValue.length;case 6:return qd(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+R0(s),0)}(t.arrayValue);case 10:case 11:return function(r){let i=0;return Zg(r.fields,(s,o)=>{i+=s.length+R0(o)}),i}(t.mapValue);default:throw Qt(13486,{value:t})}}function EQ(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function cL(t){return!!t&&"integerValue"in t}function sk(t){return!!t&&"arrayValue"in t}function yQ(t){return!!t&&"nullValue"in t}function vQ(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function MN(t){return!!t&&"mapValue"in t}function the(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[$q])===null||n===void 0?void 0:n.stringValue)===Zq}function Ey(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Zg(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Ey(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ey(t.arrayValue.values[n]);return e}return Object.assign({},t)}function nhe(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===ehe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VA{constructor(e){this.value=e}static empty(){return new VA({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!MN(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ey(n)}setAll(e){let n=Ao.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const A=this.getFieldsMap(n);this.applyChanges(A,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=Ey(o):i.push(a.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());MN(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return tl(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];MN(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Zg(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new VA(Ey(this.value))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class co{constructor(e,n,r,i,s,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new co(e,0,Vt.min(),Vt.min(),Vt.min(),VA.empty(),0)}static newFoundDocument(e,n,r,i){return new co(e,1,n,Vt.min(),r,i,0)}static newNoDocument(e,n){return new co(e,2,n,Vt.min(),Vt.min(),VA.empty(),0)}static newUnknownDocument(e,n){return new co(e,3,n,Vt.min(),Vt.min(),VA.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Vt.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=VA.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=VA.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Vt.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof co&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new co(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PS{constructor(e,n){this.position=e,this.inclusive=n}}function wQ(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(s.field.isKeyField()?r=It.comparator(It.fromName(o.referenceValue),n.key):r=mg(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function CQ(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!tl(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class US{constructor(e,n="asc"){this.field=e,this.dir=n}}function rhe(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eY{}class Yi extends eY{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new she(e,n,r):n==="array-contains"?new che(e,r):n==="in"?new Ahe(e,r):n==="not-in"?new lhe(e,r):n==="array-contains-any"?new uhe(e,r):new Yi(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new ohe(e,r):new ahe(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(mg(n,this.value)):n!==null&&Yd(this.value)===Yd(n)&&this.matchesComparison(mg(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Qt(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $c extends eY{constructor(e,n){super(),this.filters=e,this.op=n,this.Te=null}static create(e,n){return new $c(e,n)}matches(e){return tY(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function tY(t){return t.op==="and"}function nY(t){return ihe(t)&&tY(t)}function ihe(t){for(const e of t.filters)if(e instanceof $c)return!1;return!0}function AL(t){if(t instanceof Yi)return t.field.canonicalString()+t.op.toString()+gg(t.value);if(nY(t))return t.filters.map(e=>AL(e)).join(",");{const e=t.filters.map(n=>AL(n)).join(",");return`${t.op}(${e})`}}function rY(t,e){return t instanceof Yi?function(r,i){return i instanceof Yi&&r.op===i.op&&r.field.isEqual(i.field)&&tl(r.value,i.value)}(t,e):t instanceof $c?function(r,i){return i instanceof $c&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&rY(o,i.filters[a]),!0):!1}(t,e):void Qt(19439)}function iY(t){return t instanceof Yi?function(n){return`${n.field.canonicalString()} ${n.op} ${gg(n.value)}`}(t):t instanceof $c?function(n){return n.op.toString()+" {"+n.getFilters().map(iY).join(" ,")+"}"}(t):"Filter"}class she extends Yi{constructor(e,n,r){super(e,n,r),this.key=It.fromName(r.referenceValue)}matches(e){const n=It.comparator(e.key,this.key);return this.matchesComparison(n)}}class ohe extends Yi{constructor(e,n){super(e,"in",n),this.keys=sY("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class ahe extends Yi{constructor(e,n){super(e,"not-in",n),this.keys=sY("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function sY(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>It.fromName(r.referenceValue))}class che extends Yi{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return sk(n)&&nv(n.arrayValue,this.value)}}class Ahe extends Yi{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&nv(this.value.arrayValue,n)}}class lhe extends Yi{constructor(e,n){super(e,"not-in",n)}matches(e){if(nv(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!nv(this.value.arrayValue,n)}}class uhe extends Yi{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!sk(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>nv(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dhe{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.Ie=null}}function TQ(t,e=null,n=[],r=[],i=null,s=null,o=null){return new dhe(t,e,n,r,i,s,o)}function ok(t){const e=On(t);if(e.Ie===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>AL(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),nI(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>gg(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>gg(r)).join(",")),e.Ie=n}return e.Ie}function ak(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!rhe(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!rY(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!CQ(t.startAt,e.startAt)&&CQ(t.endAt,e.endAt)}function lL(t){return It.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,A=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=A,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function hhe(t,e,n,r,i,s,o,a){return new Jv(t,e,n,r,i,s,o,a)}function oY(t){return new Jv(t)}function SQ(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function aY(t){return t.collectionGroup!==null}function yy(t){const e=On(t);if(e.Ee===null){e.Ee=[];const n=new Set;for(const s of e.explicitOrderBy)e.Ee.push(s),n.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new ls(Ao.comparator);return o.filters.forEach(A=>{A.getFlattenedFilters().forEach(l=>{l.isInequality()&&(a=a.add(l.field))})}),a})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.Ee.push(new US(s,r))}),n.has(Ao.keyField().canonicalString())||e.Ee.push(new US(Ao.keyField(),r))}return e.Ee}function JA(t){const e=On(t);return e.de||(e.de=fhe(e,yy(t))),e.de}function fhe(t,e){if(t.limitType==="F")return TQ(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new US(i.field,s)});const n=t.endAt?new PS(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new PS(t.startAt.position,t.startAt.inclusive):null;return TQ(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function uL(t,e){const n=t.filters.concat([e]);return new Jv(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function dL(t,e,n){return new Jv(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function iI(t,e){return ak(JA(t),JA(e))&&t.limitType===e.limitType}function cY(t){return`${ok(JA(t))}|lt:${t.limitType}`}function Em(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>iY(i)).join(", ")}]`),nI(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>gg(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>gg(i)).join(",")),`Target(${r})`}(JA(t))}; limitType=${t.limitType})`}function sI(t,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):It.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(const s of yy(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(o,a,A){const l=wQ(o,a,A);return o.inclusive?l<=0:l<0}(r.startAt,yy(r),i)||r.endAt&&!function(o,a,A){const l=wQ(o,a,A);return o.inclusive?l>=0:l>0}(r.endAt,yy(r),i))}(t,e)}function phe(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function AY(t){return(e,n)=>{let r=!1;for(const i of yy(t)){const s=mhe(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function mhe(t,e,n){const r=t.field.isKeyField()?It.comparator(e.key,n.key):function(s,o,a){const A=o.data.field(s),l=a.data.field(s);return A!==null&&l!==null?mg(A,l):Qt(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Qt(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Zg(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Wq(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ghe=new Ns(It.comparator);function Xd(){return ghe}const lY=new Ns(It.comparator);function WE(...t){let e=lY;for(const n of t)e=e.insert(n.key,n);return e}function _he(t){let e=lY;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function uf(){return vy()}function uY(){return vy()}function vy(){return new zf(t=>t.toString(),(t,e)=>t.isEqual(e))}const Ehe=new ls(It.comparator);function Bn(...t){let e=Ehe;for(const n of t)e=e.add(n);return e}const yhe=new ls(An);function vhe(){return yhe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ck(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:DS(e)?"-0":e}}function dY(t){return{integerValue:""+t}}function whe(t,e){return Yde(e)?dY(e):ck(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oI{constructor(){this._=void 0}}function Che(t,e,n){return t instanceof hL?function(i,s){const o={fields:{[Yq]:{stringValue:qq},[Jq]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ik(s)&&(s=rI(s)),s&&(o.fields[Xq]=s),{mapValue:o}}(n,e):t instanceof kS?hY(t,e):t instanceof xS?fY(t,e):function(i,s){const o=She(i,s),a=bQ(o)+bQ(i.Re);return cL(o)&&cL(i.Re)?dY(a):ck(i.serializer,a)}(t,e)}function The(t,e,n){return t instanceof kS?hY(t,e):t instanceof xS?fY(t,e):n}function She(t,e){return t instanceof fL?function(r){return cL(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class hL extends oI{}class kS extends oI{constructor(e){super(),this.elements=e}}function hY(t,e){const n=pY(e);for(const r of t.elements)n.some(i=>tl(i,r))||n.push(r);return{arrayValue:{values:n}}}class xS extends oI{constructor(e){super(),this.elements=e}}function fY(t,e){let n=pY(e);for(const r of t.elements)n=n.filter(i=>!tl(i,r));return{arrayValue:{values:n}}}class fL extends oI{constructor(e,n){super(),this.serializer=e,this.Re=n}}function bQ(t){return Ui(t.integerValue||t.doubleValue)}function pY(t){return sk(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function bhe(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof kS&&i instanceof kS||r instanceof xS&&i instanceof xS?pg(r.elements,i.elements,tl):r instanceof fL&&i instanceof fL?tl(r.Re,i.Re):r instanceof hL&&i instanceof hL}(t.transform,e.transform)}class Tf{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Tf}static exists(e){return new Tf(void 0,e)}static updateTime(e){return new Tf(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function O0(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Ak{}function mY(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Rhe(t.key,Tf.none()):new lk(t.key,t.data,Tf.none());{const n=t.data,r=VA.empty();let i=new ls(Ao.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new aI(t.key,r,new vd(i.toArray()),Tf.none())}}function Ihe(t,e,n){t instanceof lk?function(i,s,o){const a=i.value.clone(),A=RQ(i.fieldTransforms,s,o.transformResults);a.setAll(A),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof aI?function(i,s,o){if(!O0(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=RQ(i.fieldTransforms,s,o.transformResults),A=s.data;A.setAll(gY(i)),A.setAll(a),s.convertToFoundDocument(o.version,A).setHasCommittedMutations()}(t,e,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function wy(t,e,n,r){return t instanceof lk?function(s,o,a,A){if(!O0(s.precondition,o))return a;const l=s.value.clone(),d=OQ(s.fieldTransforms,A,o);return l.setAll(d),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),null}(t,e,n,r):t instanceof aI?function(s,o,a,A){if(!O0(s.precondition,o))return a;const l=OQ(s.fieldTransforms,A,o),d=o.data;return d.setAll(gY(s)),d.setAll(l),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(t,e,n,r):function(s,o,a){return O0(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function IQ(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&pg(r,i,(s,o)=>bhe(s,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class lk extends Ak{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class aI extends Ak{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function gY(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function RQ(t,e,n){const r=new Map;oi(t.length===n.length,32656,{Ve:n.length,me:t.length});for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,The(o,a,n[i]))}return r}function OQ(t,e,n){const r=new Map;for(const i of t){const s=i.transform,o=n.data.field(i.field);r.set(i.field,Che(s,o,e))}return r}class Rhe extends Ak{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ohe{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Ihe(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=wy(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=wy(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=uY();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;const A=mY(o,a);A!==null&&r.set(i.key,A),o.isValidDocument()||o.convertToNoDocument(Vt.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Bn())}isEqual(e){return this.batchId===e.batchId&&pg(this.mutations,e.mutations,(n,r)=>IQ(n,r))&&pg(this.baseMutations,e.baseMutations,(n,r)=>IQ(n,r))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nhe{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dhe{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Wi,bn;function _Y(t){if(t===void 0)return fu("GRPC error has no .code"),Qe.UNKNOWN;switch(t){case Wi.OK:return Qe.OK;case Wi.CANCELLED:return Qe.CANCELLED;case Wi.UNKNOWN:return Qe.UNKNOWN;case Wi.DEADLINE_EXCEEDED:return Qe.DEADLINE_EXCEEDED;case Wi.RESOURCE_EXHAUSTED:return Qe.RESOURCE_EXHAUSTED;case Wi.INTERNAL:return Qe.INTERNAL;case Wi.UNAVAILABLE:return Qe.UNAVAILABLE;case Wi.UNAUTHENTICATED:return Qe.UNAUTHENTICATED;case Wi.INVALID_ARGUMENT:return Qe.INVALID_ARGUMENT;case Wi.NOT_FOUND:return Qe.NOT_FOUND;case Wi.ALREADY_EXISTS:return Qe.ALREADY_EXISTS;case Wi.PERMISSION_DENIED:return Qe.PERMISSION_DENIED;case Wi.FAILED_PRECONDITION:return Qe.FAILED_PRECONDITION;case Wi.ABORTED:return Qe.ABORTED;case Wi.OUT_OF_RANGE:return Qe.OUT_OF_RANGE;case Wi.UNIMPLEMENTED:return Qe.UNIMPLEMENTED;case Wi.DATA_LOSS:return Qe.DATA_LOSS;default:return Qt(39323,{code:t})}}(bn=Wi||(Wi={}))[bn.OK=0]="OK",bn[bn.CANCELLED=1]="CANCELLED",bn[bn.UNKNOWN=2]="UNKNOWN",bn[bn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",bn[bn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",bn[bn.NOT_FOUND=5]="NOT_FOUND",bn[bn.ALREADY_EXISTS=6]="ALREADY_EXISTS",bn[bn.PERMISSION_DENIED=7]="PERMISSION_DENIED",bn[bn.UNAUTHENTICATED=16]="UNAUTHENTICATED",bn[bn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",bn[bn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",bn[bn.ABORTED=10]="ABORTED",bn[bn.OUT_OF_RANGE=11]="OUT_OF_RANGE",bn[bn.UNIMPLEMENTED=12]="UNIMPLEMENTED",bn[bn.INTERNAL=13]="INTERNAL",bn[bn.UNAVAILABLE=14]="UNAVAILABLE",bn[bn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bhe=new Pd([4294967295,4294967295],0);function NQ(t){const e=Kq().encode(t),n=new kq;return n.update(e),new Uint8Array(n.digest())}function DQ(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Pd([n,r],0),new Pd([i,s],0)]}class uk{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new zE(`Invalid padding: ${n}`);if(r<0)throw new zE(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new zE(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new zE(`Invalid padding when bitmap length is 0: ${n}`);this.pe=8*e.length-n,this.ye=Pd.fromNumber(this.pe)}we(e,n,r){let i=e.add(n.multiply(Pd.fromNumber(r)));return i.compare(Bhe)===1&&(i=new Pd([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.pe===0)return!1;const n=NQ(e),[r,i]=DQ(n);for(let s=0;s<this.hashCount;s++){const o=this.we(r,i,s);if(!this.be(o))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new uk(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.pe===0)return;const n=NQ(e),[r,i]=DQ(n);for(let s=0;s<this.hashCount;s++){const o=this.we(r,i,s);this.Se(o)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class zE extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,$v.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new cI(Vt.min(),i,new Ns(An),Xd(),Bn())}}class $v{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new $v(r,n,Bn(),Bn(),Bn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N0{constructor(e,n,r,i){this.De=e,this.removedTargetIds=n,this.key=r,this.ve=i}}class EY{constructor(e,n){this.targetId=e,this.Ce=n}}class yY{constructor(e,n,r=Ys.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class BQ{constructor(){this.Fe=0,this.Me=LQ(),this.xe=Ys.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=Bn(),n=Bn(),r=Bn();return this.Me.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Qt(38017,{changeType:s})}}),new $v(this.xe,this.Oe,e,n,r)}Qe(){this.Ne=!1,this.Me=LQ()}$e(e,n){this.Ne=!0,this.Me=this.Me.insert(e,n)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,oi(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class Lhe{constructor(e){this.ze=e,this.je=new Map,this.He=Xd(),this.Je=zC(),this.Ye=zC(),this.Ze=new Ns(An)}Xe(e){for(const n of e.De)e.ve&&e.ve.isFoundDocument()?this.et(n,e.ve):this.tt(n,e.key,e.ve);for(const n of e.removedTargetIds)this.tt(n,e.key,e.ve)}nt(e){this.forEachTarget(e,n=>{const r=this.rt(n);switch(e.state){case 0:this.it(n)&&r.ke(e.resumeToken);break;case 1:r.We(),r.Be||r.Qe(),r.ke(e.resumeToken);break;case 2:r.We(),r.Be||this.removeTarget(n);break;case 3:this.it(n)&&(r.Ge(),r.ke(e.resumeToken));break;case 4:this.it(n)&&(this.st(n),r.ke(e.resumeToken));break;default:Qt(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.je.forEach((r,i)=>{this.it(i)&&n(i)})}ot(e){const n=e.targetId,r=e.Ce.count,i=this._t(n);if(i){const s=i.target;if(lL(s))if(r===0){const o=new It(s.path);this.tt(n,o,co.newNoDocument(o,Vt.min()))}else oi(r===1,20013,{expectedCount:r});else{const o=this.ut(n);if(o!==r){const a=this.ct(e),A=a?this.lt(a,e,o):1;if(A!==0){this.st(n);const l=A===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(n,l)}}}}}ct(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n;let o,a;try{o=qd(r).toUint8Array()}catch(A){if(A instanceof zq)return fg("Decoding the base64 bloom filter in existence filter failed ("+A.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw A}try{a=new uk(o,i,s)}catch(A){return fg(A instanceof zE?"BloomFilter error: ":"Applying bloom filter failed: ",A),null}return a.pe===0?null:a}lt(e,n,r){return n.Ce.count===r-this.Tt(e,n.targetId)?0:2}Tt(e,n){const r=this.ze.getRemoteKeysForTarget(n);let i=0;return r.forEach(s=>{const o=this.ze.Pt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.tt(n,s,null),i++)}),i}It(e){const n=new Map;this.je.forEach((s,o)=>{const a=this._t(o);if(a){if(s.current&&lL(a.target)){const A=new It(a.target.path);this.Et(A).has(o)||this.dt(o,A)||this.tt(o,A,co.newNoDocument(A,e))}s.Le&&(n.set(o,s.qe()),s.Qe())}});let r=Bn();this.Ye.forEach((s,o)=>{let a=!0;o.forEachWhile(A=>{const l=this._t(A);return!l||l.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.He.forEach((s,o)=>o.setReadTime(e));const i=new cI(e,n,this.Ze,this.He,r);return this.He=Xd(),this.Je=zC(),this.Ye=zC(),this.Ze=new Ns(An),i}et(e,n){if(!this.it(e))return;const r=this.dt(e,n.key)?2:0;this.rt(e).$e(n.key,r),this.He=this.He.insert(n.key,n),this.Je=this.Je.insert(n.key,this.Et(n.key).add(e)),this.Ye=this.Ye.insert(n.key,this.At(n.key).add(e))}tt(e,n,r){if(!this.it(e))return;const i=this.rt(e);this.dt(e,n)?i.$e(n,1):i.Ue(n),this.Ye=this.Ye.insert(n,this.At(n).delete(e)),this.Ye=this.Ye.insert(n,this.At(n).add(e)),r&&(this.He=this.He.insert(n,r))}removeTarget(e){this.je.delete(e)}ut(e){const n=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let n=this.je.get(e);return n||(n=new BQ,this.je.set(e,n)),n}At(e){let n=this.Ye.get(e);return n||(n=new ls(An),this.Ye=this.Ye.insert(e,n)),n}Et(e){let n=this.Je.get(e);return n||(n=new ls(An),this.Je=this.Je.insert(e,n)),n}it(e){const n=this._t(e)!==null;return n||nt("WatchChangeAggregator","Detected inactive target",e),n}_t(e){const n=this.je.get(e);return n&&n.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new BQ),this.ze.getRemoteKeysForTarget(e).forEach(n=>{this.tt(e,n,null)})}dt(e,n){return this.ze.getRemoteKeysForTarget(e).has(n)}}function zC(){return new Ns(It.comparator)}function LQ(){return new Ns(It.comparator)}const Phe={asc:"ASCENDING",desc:"DESCENDING"},Uhe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},khe={and:"AND",or:"OR"};class xhe{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function pL(t,e){return t.useProto3Json||nI(e)?e:{value:e}}function mL(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function vY(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function zm(t){return oi(!!t,49232),Vt.fromTimestamp(function(n){const r=zd(n);return new Os(r.seconds,r.nanos)}(t))}function wY(t,e){return gL(t,e).canonicalString()}function gL(t,e){const n=function(i){return new ti(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function CY(t){const e=ti.fromString(t);return oi(RY(e),10190,{key:e.toString()}),e}function FN(t,e){const n=CY(e);if(n.get(1)!==t.databaseId.projectId)throw new ct(Qe.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ct(Qe.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new It(SY(n))}function TY(t,e){return wY(t.databaseId,e)}function Mhe(t){const e=CY(t);return e.length===4?ti.emptyPath():SY(e)}function PQ(t){return new ti(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function SY(t){return oi(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function Fhe(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(l){return l==="NO_CHANGE"?0:l==="ADD"?1:l==="REMOVE"?2:l==="CURRENT"?3:l==="RESET"?4:Qt(39313,{state:l})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(l,d){return l.useProto3Json?(oi(d===void 0||typeof d=="string",58123),Ys.fromBase64String(d||"")):(oi(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Ys.fromUint8Array(d||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(l){const d=l.code===void 0?Qe.UNKNOWN:_Y(l.code);return new ct(d,l.message||"")}(o);n=new yY(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=FN(t,r.document.name),s=zm(r.document.updateTime),o=r.document.createTime?zm(r.document.createTime):Vt.min(),a=new VA({mapValue:{fields:r.document.fields}}),A=co.newFoundDocument(i,s,o,a),l=r.targetIds||[],d=r.removedTargetIds||[];n=new N0(l,d,A.key,A)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=FN(t,r.document),s=r.readTime?zm(r.readTime):Vt.min(),o=co.newNoDocument(i,s),a=r.removedTargetIds||[];n=new N0([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=FN(t,r.document),s=r.removedTargetIds||[];n=new N0([],s,i,null)}else{if(!("filter"in e))return Qt(11601,{Vt:e});{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new Dhe(i,s),a=r.targetId;n=new EY(a,o)}}return n}function Vhe(t,e){return{documents:[TY(t,e.path)]}}function Qhe(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=TY(t,i);const s=function(l){if(l.length!==0)return IY($c.create(l,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(l){if(l.length!==0)return l.map(d=>function(p){return{field:ym(p.field),direction:Khe(p.dir)}}(d))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=pL(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(l){return{before:l.inclusive,values:l.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(l){return{before:!l.inclusive,values:l.position}}(e.endAt)),{gt:n,parent:i}}function Hhe(t){let e=Mhe(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){oi(r===1,65062);const d=n.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];n.where&&(s=function(f){const p=bY(f);return p instanceof $c&&nY(p)?p.getFilters():[p]}(n.where));let o=[];n.orderBy&&(o=function(f){return f.map(p=>function(y){return new US(vm(y.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction))}(p))}(n.orderBy));let a=null;n.limit&&(a=function(f){let p;return p=typeof f=="object"?f.value:f,nI(p)?null:p}(n.limit));let A=null;n.startAt&&(A=function(f){const p=!!f.before,g=f.values||[];return new PS(g,p)}(n.startAt));let l=null;return n.endAt&&(l=function(f){const p=!f.before,g=f.values||[];return new PS(g,p)}(n.endAt)),hhe(e,i,o,s,a,"F",A,l)}function jhe(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qt(28987,{purpose:i})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function bY(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=vm(n.unaryFilter.field);return Yi.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=vm(n.unaryFilter.field);return Yi.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=vm(n.unaryFilter.field);return Yi.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=vm(n.unaryFilter.field);return Yi.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Qt(61313);default:return Qt(60726)}}(t):t.fieldFilter!==void 0?function(n){return Yi.create(vm(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Qt(58110);default:return Qt(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return $c.create(n.compositeFilter.filters.map(r=>bY(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Qt(1026)}}(n.compositeFilter.op))}(t):Qt(30097,{filter:t})}function Khe(t){return Phe[t]}function Ghe(t){return Uhe[t]}function Whe(t){return khe[t]}function ym(t){return{fieldPath:t.canonicalString()}}function vm(t){return Ao.fromServerFormat(t.fieldPath)}function IY(t){return t instanceof Yi?function(n){if(n.op==="=="){if(vQ(n.value))return{unaryFilter:{field:ym(n.field),op:"IS_NAN"}};if(yQ(n.value))return{unaryFilter:{field:ym(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(vQ(n.value))return{unaryFilter:{field:ym(n.field),op:"IS_NOT_NAN"}};if(yQ(n.value))return{unaryFilter:{field:ym(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ym(n.field),op:Ghe(n.op),value:n.value}}}(t):t instanceof $c?function(n){const r=n.getFilters().map(i=>IY(i));return r.length===1?r[0]:{compositeFilter:{op:Whe(n.op),filters:r}}}(t):Qt(54877,{filter:t})}function RY(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wd{constructor(e,n,r,i,s=Vt.min(),o=Vt.min(),a=Ys.EMPTY_BYTE_STRING,A=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=A}withSequenceNumber(e){return new wd(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new wd(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new wd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new wd(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zhe{constructor(e){this.wt=e}}function qhe(t){const e=Hhe({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?dL(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yhe{constructor(){this.Cn=new Xhe}addToCollectionParentIndex(e,n){return this.Cn.add(n),De.resolve()}getCollectionParents(e,n){return De.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return De.resolve()}deleteFieldIndex(e,n){return De.resolve()}deleteAllFieldIndexes(e){return De.resolve()}createTargetIndexes(e,n){return De.resolve()}getDocumentsMatchingTarget(e,n){return De.resolve(null)}getIndexType(e,n){return De.resolve(0)}getFieldIndexes(e,n){return De.resolve([])}getNextCollectionGroupToUpdate(e){return De.resolve(null)}getMinOffset(e,n){return De.resolve(Wd.min())}getMinOffsetFromCollectionGroup(e,n){return De.resolve(Wd.min())}updateCollectionGroup(e,n,r){return De.resolve()}updateIndexEntries(e,n){return De.resolve()}}class Xhe{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new ls(ti.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ls(ti.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UQ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},OY=41943040;class Qo{static withCacheSize(e){return new Qo(e,Qo.DEFAULT_COLLECTION_PERCENTILE,Qo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qo.DEFAULT_COLLECTION_PERCENTILE=10,Qo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qo.DEFAULT=new Qo(OY,Qo.DEFAULT_COLLECTION_PERCENTILE,Qo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qo.DISABLED=new Qo(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g{constructor(e){this.ur=e}next(){return this.ur+=2,this.ur}static cr(){return new _g(0)}static lr(){return new _g(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kQ="LruGarbageCollector",Jhe=1048576;function xQ([t,e],[n,r]){const i=An(t,n);return i===0?An(e,r):i}class $he{constructor(e){this.Er=e,this.buffer=new ls(xQ),this.dr=0}Ar(){return++this.dr}Rr(e){const n=[e,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();xQ(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class Zhe{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(e){nt(kQ,`Garbage collection scheduled in ${e}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){$g(n)?nt(kQ,"Ignoring IndexedDB error during garbage collection: ",n):await eI(n)}await this.mr(3e5)})}}class efe{constructor(e,n){this.gr=e,this.params=n}calculateTargetCount(e,n){return this.gr.pr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return De.resolve(tI.le);const r=new $he(n);return this.gr.forEachTarget(e,i=>r.Rr(i.sequenceNumber)).next(()=>this.gr.yr(e,i=>r.Rr(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.gr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.gr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(nt("LruGarbageCollector","Garbage collection skipped; disabled"),De.resolve(UQ)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(nt("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),UQ):this.wr(e,n))}getCacheSize(e){return this.gr.getCacheSize(e)}wr(e,n){let r,i,s,o,a,A,l;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(nt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,o=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,n))).next(f=>(s=f,A=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(l=Date.now(),_m()<=fn.DEBUG&&nt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(A-a)+`ms
	Removed ${f} documents in `+(l-A)+`ms
Total Duration: ${l-d}ms`),De.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:f})))}}function tfe(t,e){return new efe(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nfe{constructor(){this.changes=new zf(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,co.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?De.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rfe{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ife{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&wy(r.mutation,i,vd.empty(),Os.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Bn()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Bn()){const i=uf();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=WE();return s.forEach((a,A)=>{o=o.insert(a,A.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=uf();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Bn()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=Xd();const o=vy(),a=function(){return vy()}();return n.forEach((A,l)=>{const d=r.get(l.key);i.has(l.key)&&(d===void 0||d.mutation instanceof aI)?s=s.insert(l.key,l):d!==void 0?(o.set(l.key,d.mutation.getFieldMask()),wy(d.mutation,l,d.mutation.getFieldMask(),Os.now())):o.set(l.key,vd.empty())}),this.recalculateAndSaveOverlays(e,s).next(A=>(A.forEach((l,d)=>o.set(l,d)),n.forEach((l,d)=>{var f;return a.set(l,new rfe(d,(f=o.get(l))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,n){const r=vy();let i=new Ns((o,a)=>o-a),s=Bn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(A=>{const l=n.get(A);if(l===null)return;let d=r.get(A)||vd.empty();d=a.applyToLocalView(l,d),r.set(A,d);const f=(i.get(a.batchId)||Bn()).add(A);i=i.insert(a.batchId,f)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const A=a.getNext(),l=A.key,d=A.value,f=uY();d.forEach(p=>{if(!s.has(p)){const g=mY(n.get(p),r.get(p));g!==null&&f.set(p,g),s=s.add(p)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,f))}return De.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(o){return It.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):aY(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):De.resolve(uf());let a=Zy,A=s;return o.next(l=>De.forEach(l,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(d)?De.resolve():this.remoteDocumentCache.getEntry(e,d).next(p=>{A=A.insert(d,p)}))).next(()=>this.populateOverlays(e,l,s)).next(()=>this.computeViews(e,A,l,Bn())).next(d=>({batchId:a,changes:_he(d)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new It(n)).next(r=>{let i=WE();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const s=n.collectionGroup;let o=WE();return this.indexManager.getCollectionParents(e,s).next(a=>De.forEach(a,A=>{const l=function(f,p){return new Jv(p,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(n,A.child(s));return this.getDocumentsMatchingCollectionQuery(e,l,r,i).next(d=>{d.forEach((f,p)=>{o=o.insert(f,p)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(o=>{s.forEach((A,l)=>{const d=l.getKey();o.get(d)===null&&(o=o.insert(d,co.newInvalidDocument(d)))});let a=WE();return o.forEach((A,l)=>{const d=s.get(A);d!==void 0&&wy(d.mutation,l,vd.empty(),Os.now()),sI(n,l)&&(a=a.insert(A,l))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sfe{constructor(e){this.serializer=e,this.kr=new Map,this.qr=new Map}getBundleMetadata(e,n){return De.resolve(this.kr.get(n))}saveBundleMetadata(e,n){return this.kr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:zm(i.createTime)}}(n)),De.resolve()}getNamedQuery(e,n){return De.resolve(this.qr.get(n))}saveNamedQuery(e,n){return this.qr.set(n.name,function(i){return{name:i.name,query:qhe(i.bundledQuery),readTime:zm(i.readTime)}}(n)),De.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ofe{constructor(){this.overlays=new Ns(It.comparator),this.Qr=new Map}getOverlay(e,n){return De.resolve(this.overlays.get(n))}getOverlays(e,n){const r=uf();return De.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.St(e,n,s)}),De.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.Qr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Qr.delete(r)),De.resolve()}getOverlaysForCollection(e,n,r){const i=uf(),s=n.length+1,o=new It(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const A=a.getNext().value,l=A.getKey();if(!n.isPrefixOf(l.path))break;l.path.length===s&&A.largestBatchId>r&&i.set(A.getKey(),A)}return De.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new Ns((l,d)=>l-d);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===n&&l.largestBatchId>r){let d=s.get(l.largestBatchId);d===null&&(d=uf(),s=s.insert(l.largestBatchId,d)),d.set(l.getKey(),l)}}const a=uf(),A=s.getIterator();for(;A.hasNext()&&(A.getNext().value.forEach((l,d)=>a.set(l,d)),!(a.size()>=i)););return De.resolve(a)}St(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.Qr.get(i.largestBatchId).delete(r.key);this.Qr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Nhe(n,r));let s=this.Qr.get(n);s===void 0&&(s=Bn(),this.Qr.set(n,s)),this.Qr.set(n,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class afe{constructor(){this.sessionToken=Ys.EMPTY_BYTE_STRING}getSessionToken(e){return De.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,De.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dk{constructor(){this.$r=new ls(ws.Ur),this.Kr=new ls(ws.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(e,n){const r=new ws(e,n);this.$r=this.$r.add(r),this.Kr=this.Kr.add(r)}Gr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.zr(new ws(e,n))}jr(e,n){e.forEach(r=>this.removeReference(r,n))}Hr(e){const n=new It(new ti([])),r=new ws(n,e),i=new ws(n,e+1),s=[];return this.Kr.forEachInRange([r,i],o=>{this.zr(o),s.push(o.key)}),s}Jr(){this.$r.forEach(e=>this.zr(e))}zr(e){this.$r=this.$r.delete(e),this.Kr=this.Kr.delete(e)}Yr(e){const n=new It(new ti([])),r=new ws(n,e),i=new ws(n,e+1);let s=Bn();return this.Kr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const n=new ws(e,0),r=this.$r.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class ws{constructor(e,n){this.key=e,this.Zr=n}static Ur(e,n){return It.comparator(e.key,n.key)||An(e.Zr,n.Zr)}static Wr(e,n){return An(e.Zr,n.Zr)||It.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cfe{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.nr=1,this.Xr=new ls(ws.Ur)}checkEmpty(e){return De.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Ohe(s,n,r,i);this.mutationQueue.push(o);for(const a of i)this.Xr=this.Xr.add(new ws(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return De.resolve(o)}lookupMutationBatch(e,n){return De.resolve(this.ei(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.ti(r),s=i<0?0:i;return De.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return De.resolve(this.mutationQueue.length===0?qde:this.nr-1)}getAllMutationBatches(e){return De.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new ws(n,0),i=new ws(n,Number.POSITIVE_INFINITY),s=[];return this.Xr.forEachInRange([r,i],o=>{const a=this.ei(o.Zr);s.push(a)}),De.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ls(An);return n.forEach(i=>{const s=new ws(i,0),o=new ws(i,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([s,o],a=>{r=r.add(a.Zr)})}),De.resolve(this.ni(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;It.isDocumentKey(s)||(s=s.child(""));const o=new ws(new It(s),0);let a=new ls(An);return this.Xr.forEachWhile(A=>{const l=A.key.path;return!!r.isPrefixOf(l)&&(l.length===i&&(a=a.add(A.Zr)),!0)},o),De.resolve(this.ni(a))}ni(e){const n=[];return e.forEach(r=>{const i=this.ei(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){oi(this.ri(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Xr;return De.forEach(n.mutations,i=>{const s=new ws(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Xr=r})}sr(e){}containsKey(e,n){const r=new ws(n,0),i=this.Xr.firstAfterOrEqual(r);return De.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,De.resolve()}ri(e,n){return this.ti(e)}ti(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ei(e){const n=this.ti(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Afe{constructor(e){this.ii=e,this.docs=function(){return new Ns(It.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.ii(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return De.resolve(r?r.document.mutableCopy():co.newInvalidDocument(n))}getEntries(e,n){let r=Xd();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():co.newInvalidDocument(i))}),De.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=Xd();const o=n.path,a=new It(o.child("__id-9223372036854775808__")),A=this.docs.getIteratorFrom(a);for(;A.hasNext();){const{key:l,value:{document:d}}=A.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||Kde(jde(d),r)<=0||(i.has(d.key)||sI(n,d))&&(s=s.insert(d.key,d.mutableCopy()))}return De.resolve(s)}getAllFromCollectionGroup(e,n,r,i){Qt(9500)}si(e,n){return De.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new lfe(this)}getSize(e){return De.resolve(this.size)}}class lfe extends nfe{constructor(e){super(),this.Br=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.Br.addEntry(e,i)):this.Br.removeEntry(r)}),De.waitFor(n)}getFromCache(e,n){return this.Br.getEntry(e,n)}getAllFromCache(e,n){return this.Br.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ufe{constructor(e){this.persistence=e,this.oi=new zf(n=>ok(n),ak),this.lastRemoteSnapshotVersion=Vt.min(),this.highestTargetId=0,this._i=0,this.ai=new dk,this.targetCount=0,this.ui=_g.cr()}forEachTarget(e,n){return this.oi.forEach((r,i)=>n(i)),De.resolve()}getLastRemoteSnapshotVersion(e){return De.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return De.resolve(this._i)}allocateTargetId(e){return this.highestTargetId=this.ui.next(),De.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this._i&&(this._i=n),De.resolve()}Tr(e){this.oi.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ui=new _g(n),this.highestTargetId=n),e.sequenceNumber>this._i&&(this._i=e.sequenceNumber)}addTargetData(e,n){return this.Tr(n),this.targetCount+=1,De.resolve()}updateTargetData(e,n){return this.Tr(n),De.resolve()}removeTargetData(e,n){return this.oi.delete(n.target),this.ai.Hr(n.targetId),this.targetCount-=1,De.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.oi.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.oi.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),De.waitFor(s).next(()=>i)}getTargetCount(e){return De.resolve(this.targetCount)}getTargetData(e,n){const r=this.oi.get(n)||null;return De.resolve(r)}addMatchingKeys(e,n,r){return this.ai.Gr(n,r),De.resolve()}removeMatchingKeys(e,n,r){this.ai.jr(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),De.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.ai.Hr(n),De.resolve()}getMatchingKeysForTargetId(e,n){const r=this.ai.Yr(n);return De.resolve(r)}containsKey(e,n){return De.resolve(this.ai.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NY{constructor(e,n){this.ci={},this.overlays={},this.li=new tI(0),this.hi=!1,this.hi=!0,this.Pi=new afe,this.referenceDelegate=e(this),this.Ti=new ufe(this),this.indexManager=new Yhe,this.remoteDocumentCache=function(i){return new Afe(i)}(r=>this.referenceDelegate.Ii(r)),this.serializer=new zhe(n),this.Ei=new sfe(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new ofe,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ci[e.toKey()];return r||(r=new cfe(n,this.referenceDelegate),this.ci[e.toKey()]=r),r}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(e,n,r){nt("MemoryPersistence","Starting transaction:",e);const i=new dfe(this.li.next());return this.referenceDelegate.di(),r(i).next(s=>this.referenceDelegate.Ai(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ri(e,n){return De.or(Object.values(this.ci).map(r=>()=>r.containsKey(e,n)))}}class dfe extends Wde{constructor(e){super(),this.currentSequenceNumber=e}}class hk{constructor(e){this.persistence=e,this.Vi=new dk,this.mi=null}static fi(e){return new hk(e)}get gi(){if(this.mi)return this.mi;throw Qt(60996)}addReference(e,n,r){return this.Vi.addReference(r,n),this.gi.delete(r.toString()),De.resolve()}removeReference(e,n,r){return this.Vi.removeReference(r,n),this.gi.add(r.toString()),De.resolve()}markPotentiallyOrphaned(e,n){return this.gi.add(n.toString()),De.resolve()}removeTarget(e,n){this.Vi.Hr(n.targetId).forEach(i=>this.gi.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.gi.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}di(){this.mi=new Set}Ai(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return De.forEach(this.gi,r=>{const i=It.fromPath(r);return this.pi(e,i).next(s=>{s||n.removeEntry(i,Vt.min())})}).next(()=>(this.mi=null,n.apply(e)))}updateLimboDocument(e,n){return this.pi(e,n).next(r=>{r?this.gi.delete(n.toString()):this.gi.add(n.toString())})}Ii(e){return 0}pi(e,n){return De.or([()=>De.resolve(this.Vi.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ri(e,n)])}}class MS{constructor(e,n){this.persistence=e,this.yi=new zf(r=>Xde(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=tfe(this,n)}static fi(e,n){return new MS(e,n)}di(){}Ai(e){return De.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}pr(e){const n=this.br(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}br(e){let n=0;return this.yr(e,r=>{n++}).next(()=>n)}yr(e,n){return De.forEach(this.yi,(r,i)=>this.Dr(e,r,i).next(s=>s?De.resolve():n(i)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.si(e,o=>this.Dr(e,o,n).next(a=>{a||(r++,s.removeEntry(o,Vt.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.yi.set(n,e.currentSequenceNumber),De.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.yi.set(r,e.currentSequenceNumber),De.resolve()}removeReference(e,n,r){return this.yi.set(r,e.currentSequenceNumber),De.resolve()}updateLimboDocument(e,n){return this.yi.set(n,e.currentSequenceNumber),De.resolve()}Ii(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=R0(e.data.value)),n}Dr(e,n,r){return De.or([()=>this.persistence.Ri(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.yi.get(n);return De.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fk{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.ds=r,this.As=i}static Rs(e,n){let r=Bn(),i=Bn();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new fk(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hfe{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ffe{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return Kae()?8:zde(uo())>0?6:4}()}initialize(e,n){this.ys=e,this.indexManager=n,this.Vs=!0}getDocumentsMatchingQuery(e,n,r,i){const s={result:null};return this.ws(e,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.bs(e,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new hfe;return this.Ss(e,n,o).next(a=>{if(s.result=a,this.fs)return this.Ds(e,n,o,a.size)})}).next(()=>s.result)}Ds(e,n,r,i){return r.documentReadCount<this.gs?(_m()<=fn.DEBUG&&nt("QueryEngine","SDK will not create cache indexes for query:",Em(n),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),De.resolve()):(_m()<=fn.DEBUG&&nt("QueryEngine","Query:",Em(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ps*i?(_m()<=fn.DEBUG&&nt("QueryEngine","The SDK decides to create cache indexes for query:",Em(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,JA(n))):De.resolve())}ws(e,n){if(SQ(n))return De.resolve(null);let r=JA(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=dL(n,null,"F"),r=JA(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=Bn(...s);return this.ys.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(A=>{const l=this.vs(n,a);return this.Cs(n,l,o,A.readTime)?this.ws(e,dL(n,null,"F")):this.Fs(e,l,n,A)}))})))}bs(e,n,r,i){return SQ(n)||i.isEqual(Vt.min())?De.resolve(null):this.ys.getDocuments(e,r).next(s=>{const o=this.vs(n,s);return this.Cs(n,o,r,i)?De.resolve(null):(_m()<=fn.DEBUG&&nt("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Em(n)),this.Fs(e,o,n,Hde(i,Zy)).next(a=>a))})}vs(e,n){let r=new ls(AY(e));return n.forEach((i,s)=>{sI(e,s)&&(r=r.add(s))}),r}Cs(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ss(e,n,r){return _m()<=fn.DEBUG&&nt("QueryEngine","Using full collection scan to execute query:",Em(n)),this.ys.getDocumentsMatchingQuery(e,n,Wd.min(),r)}Fs(e,n,r,i){return this.ys.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk="LocalStore",pfe=3e8;class mfe{constructor(e,n,r,i){this.persistence=e,this.Ms=n,this.serializer=i,this.xs=new Ns(An),this.Os=new zf(s=>ok(s),ak),this.Ns=new Map,this.Bs=e.getRemoteDocumentCache(),this.Ti=e.getTargetCache(),this.Ei=e.getBundleCache(),this.Ls(r)}Ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ife(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.xs))}}function gfe(t,e,n,r){return new mfe(t,e,n,r)}async function DY(t,e){const n=On(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.Ls(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let A=Bn();for(const l of i){o.push(l.batchId);for(const d of l.mutations)A=A.add(d.key)}for(const l of s){a.push(l.batchId);for(const d of l.mutations)A=A.add(d.key)}return n.localDocuments.getDocuments(r,A).next(l=>({ks:l,removedBatchIds:o,addedBatchIds:a}))})})}function BY(t){const e=On(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ti.getLastRemoteSnapshotVersion(n))}function _fe(t,e){const n=On(t),r=e.snapshotVersion;let i=n.xs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=n.Bs.newChangeBuffer({trackRemovals:!0});i=n.xs;const a=[];e.targetChanges.forEach((d,f)=>{const p=i.get(f);if(!p)return;a.push(n.Ti.removeMatchingKeys(s,d.removedDocuments,f).next(()=>n.Ti.addMatchingKeys(s,d.addedDocuments,f)));let g=p.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?g=g.withResumeToken(Ys.EMPTY_BYTE_STRING,Vt.min()).withLastLimboFreeSnapshotVersion(Vt.min()):d.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(d.resumeToken,r)),i=i.insert(f,g),function(E,w,b){return E.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=pfe?!0:b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size>0}(p,g,d)&&a.push(n.Ti.updateTargetData(s,g))});let A=Xd(),l=Bn();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(Efe(s,o,e.documentUpdates).next(d=>{A=d.qs,l=d.Qs})),!r.isEqual(Vt.min())){const d=n.Ti.getLastRemoteSnapshotVersion(s).next(f=>n.Ti.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return De.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,A,l)).next(()=>A)}).then(s=>(n.xs=i,s))}function Efe(t,e,n){let r=Bn(),i=Bn();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=Xd();return n.forEach((a,A)=>{const l=s.get(a);A.isFoundDocument()!==l.isFoundDocument()&&(i=i.add(a)),A.isNoDocument()&&A.version.isEqual(Vt.min())?(e.removeEntry(a,A.readTime),o=o.insert(a,A)):!l.isValidDocument()||A.version.compareTo(l.version)>0||A.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(A),o=o.insert(a,A)):nt(pk,"Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",A.version)}),{qs:o,Qs:i}})}function yfe(t,e){const n=On(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Ti.getTargetData(r,e).next(s=>s?(i=s,De.resolve(i)):n.Ti.allocateTargetId(r).next(o=>(i=new wd(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Ti.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.xs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.xs=n.xs.insert(r.targetId,r),n.Os.set(e,r.targetId)),r})}async function _L(t,e,n){const r=On(t),i=r.xs.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!$g(o))throw o;nt(pk,`Failed to update sequence numbers for target ${e}: ${o}`)}r.xs=r.xs.remove(e),r.Os.delete(i.target)}function MQ(t,e,n){const r=On(t);let i=Vt.min(),s=Bn();return r.persistence.runTransaction("Execute query","readwrite",o=>function(A,l,d){const f=On(A),p=f.Os.get(d);return p!==void 0?De.resolve(f.xs.get(p)):f.Ti.getTargetData(l,d)}(r,o,JA(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Ti.getMatchingKeysForTargetId(o,a.targetId).next(A=>{s=A})}).next(()=>r.Ms.getDocumentsMatchingQuery(o,e,n?i:Vt.min(),n?s:Bn())).next(a=>(vfe(r,phe(e),a),{documents:a,$s:s})))}function vfe(t,e,n){let r=t.Ns.get(e)||Vt.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.Ns.set(e,r)}class FQ{constructor(){this.activeTargetIds=vhe()}js(e){this.activeTargetIds=this.activeTargetIds.add(e)}Hs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}zs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class wfe{constructor(){this.xo=new FQ,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.xo.js(e),this.Oo[e]||"not-current"}updateQueryState(e,n,r){this.Oo[e]=n}removeLocalQueryTarget(e){this.xo.Hs(e)}isLocalQueryTarget(e){return this.xo.activeTargetIds.has(e)}clearQueryState(e){delete this.Oo[e]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(e){return this.xo.activeTargetIds.has(e)}start(){return this.xo=new FQ,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cfe{No(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VQ="ConnectivityMonitor";class QQ{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(e){this.Qo.push(e)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){nt(VQ,"Network connectivity changed: AVAILABLE");for(const e of this.Qo)e(0)}qo(){nt(VQ,"Network connectivity changed: UNAVAILABLE");for(const e of this.Qo)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qC=null;function EL(){return qC===null?qC=function(){return 268435456+Math.round(2147483648*Math.random())}():qC++,"0x"+qC.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VN="RestConnection",Tfe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Sfe{get Uo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Ko=n+"://"+e.host,this.Wo=`projects/${r}/databases/${i}`,this.Go=this.databaseId.database===BS?`project_id=${r}`:`project_id=${r}&database_id=${i}`}zo(e,n,r,i,s){const o=EL(),a=this.jo(e,n.toUriEncodedString());nt(VN,`Sending RPC '${e}' ${o}:`,a,r);const A={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(A,i,s);const{host:l}=new URL(a),d=sl(l);return this.Jo(e,a,A,r,d).then(f=>(nt(VN,`Received RPC '${e}' ${o}: `,f),f),f=>{throw fg(VN,`RPC '${e}' ${o} failed with error: `,f,"url: ",a,"request:",r),f})}Yo(e,n,r,i,s,o){return this.zo(e,n,r,i,s)}Ho(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Jg}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}jo(e,n){const r=Tfe[e];return`${this.Ko}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bfe{constructor(e){this.Zo=e.Zo,this.Xo=e.Xo}e_(e){this.t_=e}n_(e){this.r_=e}i_(e){this.s_=e}onMessage(e){this.o_=e}close(){this.Xo()}send(e){this.Zo(e)}__(){this.t_()}a_(){this.r_()}u_(e){this.s_(e)}c_(e){this.o_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eo="WebChannelConnection";class Ife extends Sfe{constructor(e){super(e),this.l_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,i,s){const o=EL();return new Promise((a,A)=>{const l=new xq;l.setWithCredentials(!0),l.listenOnce(Mq.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case I0.NO_ERROR:const f=l.getResponseJson();nt(eo,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(f)),a(f);break;case I0.TIMEOUT:nt(eo,`RPC '${e}' ${o} timed out`),A(new ct(Qe.DEADLINE_EXCEEDED,"Request time out"));break;case I0.HTTP_ERROR:const p=l.getStatus();if(nt(eo,`RPC '${e}' ${o} failed with status:`,p,"response text:",l.getResponseText()),p>0){let g=l.getResponseJson();Array.isArray(g)&&(g=g[0]);const y=g==null?void 0:g.error;if(y&&y.status&&y.message){const E=function(b){const I=b.toLowerCase().replace(/_/g,"-");return Object.values(Qe).indexOf(I)>=0?I:Qe.UNKNOWN}(y.status);A(new ct(E,y.message))}else A(new ct(Qe.UNKNOWN,"Server responded with status "+l.getStatus()))}else A(new ct(Qe.UNAVAILABLE,"Connection failed."));break;default:Qt(9055,{h_:e,streamId:o,P_:l.getLastErrorCode(),T_:l.getLastError()})}}finally{nt(eo,`RPC '${e}' ${o} completed.`)}});const d=JSON.stringify(i);nt(eo,`RPC '${e}' ${o} sending request:`,i),l.send(n,"POST",d,r,15)})}I_(e,n,r){const i=EL(),s=[this.Ko,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Qq(),a=Vq(),A={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;l!==void 0&&(A.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(A.useFetchStreams=!0),this.Ho(A.initMessageHeaders,n,r),A.encodeInitMessageHeaders=!0;const d=s.join("");nt(eo,`Creating RPC '${e}' stream ${i}: ${d}`,A);const f=o.createWebChannel(d,A);this.E_(f);let p=!1,g=!1;const y=new bfe({Zo:w=>{g?nt(eo,`Not sending because RPC '${e}' stream ${i} is closed:`,w):(p||(nt(eo,`Opening RPC '${e}' stream ${i} transport.`),f.open(),p=!0),nt(eo,`RPC '${e}' stream ${i} sending:`,w),f.send(w))},Xo:()=>f.close()}),E=(w,b,I)=>{w.listen(b,B=>{try{I(B)}catch(U){setTimeout(()=>{throw U},0)}})};return E(f,GE.EventType.OPEN,()=>{g||(nt(eo,`RPC '${e}' stream ${i} transport opened.`),y.__())}),E(f,GE.EventType.CLOSE,()=>{g||(g=!0,nt(eo,`RPC '${e}' stream ${i} transport closed`),y.u_(),this.d_(f))}),E(f,GE.EventType.ERROR,w=>{g||(g=!0,fg(eo,`RPC '${e}' stream ${i} transport errored. Name:`,w.name,"Message:",w.message),y.u_(new ct(Qe.UNAVAILABLE,"The operation could not be completed")))}),E(f,GE.EventType.MESSAGE,w=>{var b;if(!g){const I=w.data[0];oi(!!I,16349);const B=I,U=(B==null?void 0:B.error)||((b=B[0])===null||b===void 0?void 0:b.error);if(U){nt(eo,`RPC '${e}' stream ${i} received error:`,U);const H=U.status;let K=function(M){const O=Wi[M];if(O!==void 0)return _Y(O)}(H),x=U.message;K===void 0&&(K=Qe.INTERNAL,x="Unknown error status: "+H+" with message "+U.message),g=!0,y.u_(new ct(K,x)),f.close()}else nt(eo,`RPC '${e}' stream ${i} received:`,I),y.c_(I)}}),E(a,Fq.STAT_EVENT,w=>{w.stat===iL.PROXY?nt(eo,`RPC '${e}' stream ${i} detected buffering proxy`):w.stat===iL.NOPROXY&&nt(eo,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{y.a_()},0),y}terminate(){this.l_.forEach(e=>e.close()),this.l_=[]}E_(e){this.l_.push(e)}d_(e){this.l_=this.l_.filter(n=>n===e)}}function QN(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AI(t){return new xhe(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LY{constructor(e,n,r=1e3,i=1.5,s=6e4){this.xi=e,this.timerId=n,this.A_=r,this.R_=i,this.V_=s,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(e){this.cancel();const n=Math.floor(this.m_+this.w_()),r=Math.max(0,Date.now()-this.g_),i=Math.max(0,n-r);i>0&&nt("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.m_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,i,()=>(this.g_=Date.now(),e())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){this.f_!==null&&(this.f_.skipDelay(),this.f_=null)}cancel(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HQ="PersistentStream";class Rfe{constructor(e,n,r,i,s,o,a,A){this.xi=e,this.S_=r,this.D_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=A,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new LY(e,n)}O_(){return this.state===1||this.state===5||this.N_()}N_(){return this.state===2||this.state===3}start(){this.M_=0,this.state!==4?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&this.C_===null&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(e){this.U_(),this.stream.send(e)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(e,n){this.U_(),this.K_(),this.x_.cancel(),this.v_++,e!==4?this.x_.reset():n&&n.code===Qe.RESOURCE_EXHAUSTED?(fu(n.toString()),fu("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):n&&n.code===Qe.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.W_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.i_(n)}W_(){}auth(){this.state=1;const e=this.G_(this.v_),n=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.v_===n&&this.z_(r,i)},r=>{e(()=>{const i=new ct(Qe.UNKNOWN,"Fetching auth token failed: "+r.message);return this.j_(i)})})}z_(e,n){const r=this.G_(this.v_);this.stream=this.H_(e,n),this.stream.e_(()=>{r(()=>this.listener.e_())}),this.stream.n_(()=>{r(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(i=>{r(()=>this.j_(i))}),this.stream.onMessage(i=>{r(()=>++this.M_==1?this.J_(i):this.onNext(i))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(e){return nt(HQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}G_(e){return n=>{this.xi.enqueueAndForget(()=>this.v_===e?n():(nt(HQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ofe extends Rfe{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}H_(e,n){return this.connection.I_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.x_.reset();const n=Fhe(this.serializer,e),r=function(s){if(!("targetChange"in s))return Vt.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?Vt.min():o.readTime?zm(o.readTime):Vt.min()}(e);return this.listener.Y_(n,r)}Z_(e){const n={};n.database=PQ(this.serializer),n.addTarget=function(s,o){let a;const A=o.target;if(a=lL(A)?{documents:Vhe(s,A)}:{query:Qhe(s,A).gt},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=vY(s,o.resumeToken);const l=pL(s,o.expectedCount);l!==null&&(a.expectedCount=l)}else if(o.snapshotVersion.compareTo(Vt.min())>0){a.readTime=mL(s,o.snapshotVersion.toTimestamp());const l=pL(s,o.expectedCount);l!==null&&(a.expectedCount=l)}return a}(this.serializer,e);const r=jhe(this.serializer,e);r&&(n.labels=r),this.Q_(n)}X_(e){const n={};n.database=PQ(this.serializer),n.removeTarget=e,this.Q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nfe{}class Dfe extends Nfe{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.sa=!1}oa(){if(this.sa)throw new ct(Qe.FAILED_PRECONDITION,"The client has already been terminated.")}zo(e,n,r,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.zo(e,gL(n,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===Qe.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new ct(Qe.UNKNOWN,s.toString())})}Yo(e,n,r,i,s){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Yo(e,gL(n,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Qe.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ct(Qe.UNKNOWN,o.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class Bfe{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){this._a===0&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(e){this.state==="Online"?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.la("Offline")))}set(e){this.Ta(),this._a=0,e==="Online"&&(this.ua=!1),this.la(e)}la(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ha(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(fu(n),this.ua=!1):nt("OnlineStateTracker",n)}Ta(){this.aa!==null&&(this.aa.cancel(),this.aa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eg="RemoteStore";class Lfe{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=s,this.Ra.No(o=>{r.enqueueAndForget(async()=>{ew(this)&&(nt(Eg,"Restarting streams for network reachability change."),await async function(A){const l=On(A);l.da.add(4),await Zv(l),l.Va.set("Unknown"),l.da.delete(4),await lI(l)}(this))})}),this.Va=new Bfe(r,i)}}async function lI(t){if(ew(t))for(const e of t.Aa)await e(!0)}async function Zv(t){for(const e of t.Aa)await e(!1)}function PY(t,e){const n=On(t);n.Ea.has(e.targetId)||(n.Ea.set(e.targetId,e),Ek(n)?_k(n):e_(n).N_()&&gk(n,e))}function mk(t,e){const n=On(t),r=e_(n);n.Ea.delete(e),r.N_()&&UY(n,e),n.Ea.size===0&&(r.N_()?r.k_():ew(n)&&n.Va.set("Unknown"))}function gk(t,e){if(t.ma.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Vt.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}e_(t).Z_(e)}function UY(t,e){t.ma.Ke(e),e_(t).X_(e)}function _k(t){t.ma=new Lhe({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>t.Ea.get(e)||null,Pt:()=>t.datastore.serializer.databaseId}),e_(t).start(),t.Va.ca()}function Ek(t){return ew(t)&&!e_(t).O_()&&t.Ea.size>0}function ew(t){return On(t).da.size===0}function kY(t){t.ma=void 0}async function Pfe(t){t.Va.set("Online")}async function Ufe(t){t.Ea.forEach((e,n)=>{gk(t,e)})}async function kfe(t,e){kY(t),Ek(t)?(t.Va.Pa(e),_k(t)):t.Va.set("Unknown")}async function xfe(t,e,n){if(t.Va.set("Online"),e instanceof yY&&e.state===2&&e.cause)try{await async function(i,s){const o=s.cause;for(const a of s.targetIds)i.Ea.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.Ea.delete(a),i.ma.removeTarget(a))}(t,e)}catch(r){nt(Eg,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await jQ(t,r)}else if(e instanceof N0?t.ma.Xe(e):e instanceof EY?t.ma.ot(e):t.ma.nt(e),!n.isEqual(Vt.min()))try{const r=await BY(t.localStore);n.compareTo(r)>=0&&await function(s,o){const a=s.ma.It(o);return a.targetChanges.forEach((A,l)=>{if(A.resumeToken.approximateByteSize()>0){const d=s.Ea.get(l);d&&s.Ea.set(l,d.withResumeToken(A.resumeToken,o))}}),a.targetMismatches.forEach((A,l)=>{const d=s.Ea.get(A);if(!d)return;s.Ea.set(A,d.withResumeToken(Ys.EMPTY_BYTE_STRING,d.snapshotVersion)),UY(s,A);const f=new wd(d.target,A,l,d.sequenceNumber);gk(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(r){nt(Eg,"Failed to raise snapshot:",r),await jQ(t,r)}}async function jQ(t,e,n){if(!$g(e))throw e;t.da.add(1),await Zv(t),t.Va.set("Offline"),n||(n=()=>BY(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{nt(Eg,"Retrying IndexedDB access"),await n(),t.da.delete(1),await lI(t)})}async function KQ(t,e){const n=On(t);n.asyncQueue.verifyOperationInProgress(),nt(Eg,"RemoteStore received new credentials");const r=ew(n);n.da.add(3),await Zv(n),r&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.da.delete(3),await lI(n)}async function Mfe(t,e){const n=On(t);e?(n.da.delete(2),await lI(n)):e||(n.da.add(2),await Zv(n),n.Va.set("Unknown"))}function e_(t){return t.fa||(t.fa=function(n,r,i){const s=On(n);return s.oa(),new Ofe(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{e_:Pfe.bind(null,t),n_:Ufe.bind(null,t),i_:kfe.bind(null,t),Y_:xfe.bind(null,t)}),t.Aa.push(async e=>{e?(t.fa.L_(),Ek(t)?_k(t):t.Va.set("Unknown")):(await t.fa.stop(),kY(t))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yk{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Cf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){const o=Date.now()+r,a=new yk(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ct(Qe.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function xY(t,e){if(fu("AsyncQueue",`${e}: ${t}`),$g(t))return new ct(Qe.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm{static emptySet(e){return new qm(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||It.comparator(n.key,r.key):(n,r)=>It.comparator(n.key,r.key),this.keyedMap=WE(),this.sortedSet=new Ns(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof qm)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new qm;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GQ{constructor(){this.pa=new Ns(It.comparator)}track(e){const n=e.doc.key,r=this.pa.get(n);r?e.type!==0&&r.type===3?this.pa=this.pa.insert(n,e):e.type===3&&r.type!==1?this.pa=this.pa.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.pa=this.pa.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.pa=this.pa.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.pa=this.pa.remove(n):e.type===1&&r.type===2?this.pa=this.pa.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.pa=this.pa.insert(n,{type:2,doc:e.doc}):Qt(63341,{Vt:e,ya:r}):this.pa=this.pa.insert(n,e)}wa(){const e=[];return this.pa.inorderTraversal((n,r)=>{e.push(r)}),e}}class yg{constructor(e,n,r,i,s,o,a,A,l){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=A,this.hasCachedResults=l}static fromInitialDocuments(e,n,r,i,s){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new yg(e,n,qm.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&iI(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ffe{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(e=>e.va())}}class Vfe{constructor(){this.queries=WQ(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const i=On(n),s=i.queries;i.queries=WQ(),s.forEach((o,a)=>{for(const A of a.Sa)A.onError(r)})})(this,new ct(Qe.ABORTED,"Firestore shutting down"))}}function WQ(){return new zf(t=>cY(t),iI)}async function Qfe(t,e){const n=On(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.Da()&&e.va()&&(r=2):(s=new Ffe,r=e.va()?0:1);try{switch(r){case 0:s.ba=await n.onListen(i,!0);break;case 1:s.ba=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(o){const a=xY(o,`Initialization of query '${Em(e.query)}' failed`);return void e.onError(a)}n.queries.set(i,s),s.Sa.push(e),e.Fa(n.onlineState),s.ba&&e.Ma(s.ba)&&vk(n)}async function Hfe(t,e){const n=On(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const o=s.Sa.indexOf(e);o>=0&&(s.Sa.splice(o,1),s.Sa.length===0?i=e.va()?0:1:!s.Da()&&e.va()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function jfe(t,e){const n=On(t);let r=!1;for(const i of e){const s=i.query,o=n.queries.get(s);if(o){for(const a of o.Sa)a.Ma(i)&&(r=!0);o.ba=i}}r&&vk(n)}function Kfe(t,e,n){const r=On(t),i=r.queries.get(e);if(i)for(const s of i.Sa)s.onError(n);r.queries.delete(e)}function vk(t){t.Ca.forEach(e=>{e.next()})}var yL,zQ;(zQ=yL||(yL={})).xa="default",zQ.Cache="cache";class Gfe{constructor(e,n,r){this.query=e,this.Oa=n,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=r||{}}Ma(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new yg(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Na?this.La(e)&&(this.Oa.next(e),n=!0):this.ka(e,this.onlineState)&&(this.qa(e),n=!0),this.Ba=e,n}onError(e){this.Oa.error(e)}Fa(e){this.onlineState=e;let n=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,e)&&(this.qa(this.Ba),n=!0),n}ka(e,n){if(!e.fromCache||!this.va())return!0;const r=n!=="Offline";return(!this.options.Qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}La(e){if(e.docChanges.length>0)return!0;const n=this.Ba&&this.Ba.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}qa(e){e=yg.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Na=!0,this.Oa.next(e)}va(){return this.options.source!==yL.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MY{constructor(e){this.key=e}}class FY{constructor(e){this.key=e}}class Wfe{constructor(e,n){this.query=e,this.Ha=n,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=Bn(),this.mutatedKeys=Bn(),this.Za=AY(e),this.Xa=new qm(this.Za)}get eu(){return this.Ha}tu(e,n){const r=n?n.nu:new GQ,i=n?n.Xa:this.Xa;let s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const A=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,l=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,f)=>{const p=i.get(d),g=sI(this.query,f)?f:null,y=!!p&&this.mutatedKeys.has(p.key),E=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let w=!1;p&&g?p.data.isEqual(g.data)?y!==E&&(r.track({type:3,doc:g}),w=!0):this.ru(p,g)||(r.track({type:2,doc:g}),w=!0,(A&&this.Za(g,A)>0||l&&this.Za(g,l)<0)&&(a=!0)):!p&&g?(r.track({type:0,doc:g}),w=!0):p&&!g&&(r.track({type:1,doc:p}),w=!0,(A||l)&&(a=!0)),w&&(g?(o=o.add(g),s=E?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{Xa:o,nu:r,Cs:a,mutatedKeys:s}}ru(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const s=this.Xa;this.Xa=e.Xa,this.mutatedKeys=e.mutatedKeys;const o=e.nu.wa();o.sort((d,f)=>function(g,y){const E=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qt(20277,{Vt:w})}};return E(g)-E(y)}(d.type,f.type)||this.Za(d.doc,f.doc)),this.iu(r),i=i!=null&&i;const a=n&&!i?this.su():[],A=this.Ya.size===0&&this.current&&!i?1:0,l=A!==this.Ja;return this.Ja=A,o.length!==0||l?{snapshot:new yg(this.query,e.Xa,s,o,e.mutatedKeys,A===0,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),ou:a}:{ou:a}}Fa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new GQ,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(e){return!this.Ha.has(e)&&!!this.Xa.has(e)&&!this.Xa.get(e).hasLocalMutations}iu(e){e&&(e.addedDocuments.forEach(n=>this.Ha=this.Ha.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ha=this.Ha.delete(n)),this.current=e.current)}su(){if(!this.current)return[];const e=this.Ya;this.Ya=Bn(),this.Xa.forEach(r=>{this._u(r.key)&&(this.Ya=this.Ya.add(r.key))});const n=[];return e.forEach(r=>{this.Ya.has(r)||n.push(new FY(r))}),this.Ya.forEach(r=>{e.has(r)||n.push(new MY(r))}),n}au(e){this.Ha=e.$s,this.Ya=Bn();const n=this.tu(e.documents);return this.applyChanges(n,!0)}uu(){return yg.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,this.Ja===0,this.hasCachedResults)}}const wk="SyncEngine";class zfe{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class qfe{constructor(e){this.key=e,this.cu=!1}}class Yfe{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.lu={},this.hu=new zf(a=>cY(a),iI),this.Pu=new Map,this.Tu=new Set,this.Iu=new Ns(It.comparator),this.Eu=new Map,this.du=new dk,this.Au={},this.Ru=new Map,this.Vu=_g.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return this.mu===!0}}async function Xfe(t,e,n=!0){const r=KY(t);let i;const s=r.hu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.uu()):i=await VY(r,e,n,!0),i}async function Jfe(t,e){const n=KY(t);await VY(n,e,!0,!1)}async function VY(t,e,n,r){const i=await yfe(t.localStore,JA(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await $fe(t,e,s,o==="current",i.resumeToken)),t.isPrimaryClient&&n&&PY(t.remoteStore,i),a}async function $fe(t,e,n,r,i){t.fu=(f,p,g)=>async function(E,w,b,I){let B=w.view.tu(b);B.Cs&&(B=await MQ(E.localStore,w.query,!1).then(({documents:x})=>w.view.tu(x,B)));const U=I&&I.targetChanges.get(w.targetId),H=I&&I.targetMismatches.get(w.targetId)!=null,K=w.view.applyChanges(B,E.isPrimaryClient,U,H);return YQ(E,w.targetId,K.ou),K.snapshot}(t,f,p,g);const s=await MQ(t.localStore,e,!0),o=new Wfe(e,s.$s),a=o.tu(s.documents),A=$v.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),l=o.applyChanges(a,t.isPrimaryClient,A);YQ(t,n,l.ou);const d=new zfe(e,n,o);return t.hu.set(e,d),t.Pu.has(n)?t.Pu.get(n).push(e):t.Pu.set(n,[e]),l.snapshot}async function Zfe(t,e,n){const r=On(t),i=r.hu.get(e),s=r.Pu.get(i.targetId);if(s.length>1)return r.Pu.set(i.targetId,s.filter(o=>!iI(o,e))),void r.hu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await _L(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&mk(r.remoteStore,i.targetId),vL(r,i.targetId)}).catch(eI)):(vL(r,i.targetId),await _L(r.localStore,i.targetId,!0))}async function epe(t,e){const n=On(t),r=n.hu.get(e),i=n.Pu.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),mk(n.remoteStore,r.targetId))}async function QY(t,e){const n=On(t);try{const r=await _fe(n.localStore,e);e.targetChanges.forEach((i,s)=>{const o=n.Eu.get(s);o&&(oi(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.cu=!0:i.modifiedDocuments.size>0?oi(o.cu,14607):i.removedDocuments.size>0&&(oi(o.cu,42227),o.cu=!1))}),await jY(n,r,e)}catch(r){await eI(r)}}function qQ(t,e,n){const r=On(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.hu.forEach((s,o)=>{const a=o.view.Fa(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const A=On(o);A.onlineState=a;let l=!1;A.queries.forEach((d,f)=>{for(const p of f.Sa)p.Fa(a)&&(l=!0)}),l&&vk(A)}(r.eventManager,e),i.length&&r.lu.Y_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function tpe(t,e,n){const r=On(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Eu.get(e),s=i&&i.key;if(s){let o=new Ns(It.comparator);o=o.insert(s,co.newNoDocument(s,Vt.min()));const a=Bn().add(s),A=new cI(Vt.min(),new Map,new Ns(An),o,a);await QY(r,A),r.Iu=r.Iu.remove(s),r.Eu.delete(e),Ck(r)}else await _L(r.localStore,e,!1).then(()=>vL(r,e,n)).catch(eI)}function vL(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Pu.get(e))t.hu.delete(r),n&&t.lu.gu(r,n);t.Pu.delete(e),t.isPrimaryClient&&t.du.Hr(e).forEach(r=>{t.du.containsKey(r)||HY(t,r)})}function HY(t,e){t.Tu.delete(e.path.canonicalString());const n=t.Iu.get(e);n!==null&&(mk(t.remoteStore,n),t.Iu=t.Iu.remove(e),t.Eu.delete(n),Ck(t))}function YQ(t,e,n){for(const r of n)r instanceof MY?(t.du.addReference(r.key,e),npe(t,r)):r instanceof FY?(nt(wk,"Document no longer in limbo: "+r.key),t.du.removeReference(r.key,e),t.du.containsKey(r.key)||HY(t,r.key)):Qt(19791,{pu:r})}function npe(t,e){const n=e.key,r=n.path.canonicalString();t.Iu.get(n)||t.Tu.has(r)||(nt(wk,"New document in limbo: "+n),t.Tu.add(r),Ck(t))}function Ck(t){for(;t.Tu.size>0&&t.Iu.size<t.maxConcurrentLimboResolutions;){const e=t.Tu.values().next().value;t.Tu.delete(e);const n=new It(ti.fromString(e)),r=t.Vu.next();t.Eu.set(r,new qfe(n)),t.Iu=t.Iu.insert(n,r),PY(t.remoteStore,new wd(JA(oY(n.path)),r,"TargetPurposeLimboResolution",tI.le))}}async function jY(t,e,n){const r=On(t),i=[],s=[],o=[];r.hu.isEmpty()||(r.hu.forEach((a,A)=>{o.push(r.fu(A,e,n).then(l=>{var d;if((l||n)&&r.isPrimaryClient){const f=l?!l.fromCache:(d=n==null?void 0:n.targetChanges.get(A.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(A.targetId,f?"current":"not-current")}if(l){i.push(l);const f=fk.Rs(A.targetId,l);s.push(f)}}))}),await Promise.all(o),r.lu.Y_(i),await async function(A,l){const d=On(A);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>De.forEach(l,p=>De.forEach(p.ds,g=>d.persistence.referenceDelegate.addReference(f,p.targetId,g)).next(()=>De.forEach(p.As,g=>d.persistence.referenceDelegate.removeReference(f,p.targetId,g)))))}catch(f){if(!$g(f))throw f;nt(pk,"Failed to update sequence numbers: "+f)}for(const f of l){const p=f.targetId;if(!f.fromCache){const g=d.xs.get(p),y=g.snapshotVersion,E=g.withLastLimboFreeSnapshotVersion(y);d.xs=d.xs.insert(p,E)}}}(r.localStore,s))}async function rpe(t,e){const n=On(t);if(!n.currentUser.isEqual(e)){nt(wk,"User change. New user:",e.toKey());const r=await DY(n.localStore,e);n.currentUser=e,function(s,o){s.Ru.forEach(a=>{a.forEach(A=>{A.reject(new ct(Qe.CANCELLED,o))})}),s.Ru.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await jY(n,r.ks)}}function ipe(t,e){const n=On(t),r=n.Eu.get(e);if(r&&r.cu)return Bn().add(r.key);{let i=Bn();const s=n.Pu.get(e);if(!s)return i;for(const o of s){const a=n.hu.get(o);i=i.unionWith(a.view.eu)}return i}}function KY(t){const e=On(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=QY.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ipe.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=tpe.bind(null,e),e.lu.Y_=jfe.bind(null,e.eventManager),e.lu.gu=Kfe.bind(null,e.eventManager),e}class FS{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=AI(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Su(e),await this.persistence.start(),this.localStore=this.Du(e),this.gcScheduler=this.vu(e,this.localStore),this.indexBackfillerScheduler=this.Cu(e,this.localStore)}vu(e,n){return null}Cu(e,n){return null}Du(e){return gfe(this.persistence,new ffe,e.initialUser,this.serializer)}Su(e){return new NY(hk.fi,this.serializer)}bu(e){return new wfe}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}FS.provider={build:()=>new FS};class spe extends FS{constructor(e){super(),this.cacheSizeBytes=e}vu(e,n){oi(this.persistence.referenceDelegate instanceof MS,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Zhe(r,e.asyncQueue,n)}Su(e){const n=this.cacheSizeBytes!==void 0?Qo.withCacheSize(this.cacheSizeBytes):Qo.DEFAULT;return new NY(r=>MS.fi(r,n),this.serializer)}}class wL{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>qQ(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=rpe.bind(null,this.syncEngine),await Mfe(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new Vfe}()}createDatastore(e){const n=AI(e.databaseInfo.databaseId),r=function(s){return new Ife(s)}(e.databaseInfo);return function(s,o,a,A){return new Dfe(s,o,a,A)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,o,a){return new Lfe(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>qQ(this.syncEngine,n,0),function(){return QQ.C()?new QQ:new Cfe}())}createSyncEngine(e,n){return function(i,s,o,a,A,l,d){const f=new Yfe(i,s,o,a,A,l);return d&&(f.mu=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const s=On(i);nt(Eg,"RemoteStore shutting down."),s.da.add(5),await Zv(s),s.Ra.shutdown(),s.Va.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}wL.provider={build:()=>new wL};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ope{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Mu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Mu(this.observer.error,e):fu("Uncaught Error in snapshot listener:",e.toString()))}xu(){this.muted=!0}Mu(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jd="FirestoreClient";class ape{constructor(e,n,r,i,s){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=so.UNAUTHENTICATED,this.clientId=Fde.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async o=>{nt(Jd,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(nt(Jd,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Cf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=xY(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function HN(t,e){t.asyncQueue.verifyOperationInProgress(),nt(Jd,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await DY(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function XQ(t,e){t.asyncQueue.verifyOperationInProgress();const n=await cpe(t);nt(Jd,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>KQ(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>KQ(e.remoteStore,i)),t._onlineComponents=e}async function cpe(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){nt(Jd,"Using user provided OfflineComponentProvider");try{await HN(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===Qe.FAILED_PRECONDITION||i.code===Qe.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;fg("Error using user provided cache. Falling back to memory cache: "+n),await HN(t,new FS)}}else nt(Jd,"Using default OfflineComponentProvider"),await HN(t,new spe(void 0));return t._offlineComponents}async function Ape(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(nt(Jd,"Using user provided OnlineComponentProvider"),await XQ(t,t._uninitializedComponentsProvider._online)):(nt(Jd,"Using default OnlineComponentProvider"),await XQ(t,new wL))),t._onlineComponents}async function lpe(t){const e=await Ape(t),n=e.eventManager;return n.onListen=Xfe.bind(null,e.syncEngine),n.onUnlisten=Zfe.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Jfe.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=epe.bind(null,e.syncEngine),n}function upe(t,e,n={}){const r=new Cf;return t.asyncQueue.enqueueAndForget(async()=>function(s,o,a,A,l){const d=new ope({next:p=>{d.xu(),o.enqueueAndForget(()=>Hfe(s,f)),p.fromCache&&A.source==="server"?l.reject(new ct(Qe.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):l.resolve(p)},error:p=>l.reject(p)}),f=new Gfe(a,d,{includeMetadataChanges:!0,Qa:!0});return Qfe(s,f)}(await lpe(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GY(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JQ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dpe(t,e,n){if(!n)throw new ct(Qe.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function hpe(t,e,n,r){if(e===!0&&r===!0)throw new ct(Qe.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function $Q(t){if(It.isDocumentKey(t))throw new ct(Qe.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function uI(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Qt(12329,{type:typeof t})}function CL(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ct(Qe.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=uI(t);throw new ct(Qe.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WY="firestore.googleapis.com",ZQ=!0;class eH{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new ct(Qe.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=WY,this.ssl=ZQ}else this.host=e.host,this.ssl=(n=e.ssl)!==null&&n!==void 0?n:ZQ;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=OY;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Jhe)throw new ct(Qe.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}hpe("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=GY((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new ct(Qe.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new ct(Qe.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new ct(Qe.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Tk{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new eH({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ct(Qe.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ct(Qe.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new eH(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Bde;switch(r.type){case"firstParty":return new kde(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ct(Qe.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=JQ.get(n);r&&(nt("ComponentProvider","Removing Datastore"),JQ.delete(n),r.terminate())}(this),Promise.resolve()}}function fpe(t,e,n,r={}){var i;t=CL(t,Tk);const s=sl(e),o=t._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:t._getEmulatorOptions()}),A=`${e}:${n}`;s&&(zb(`https://${A}`),qb("Firestore",!0)),o.host!==WY&&o.host!==A&&fg("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l=Object.assign(Object.assign({},o),{host:A,ssl:s,emulatorOptions:r});if(!lu(l,a)&&(t._setSettings(l),r.mockUserToken)){let d,f;if(typeof r.mockUserToken=="string")d=r.mockUserToken,f=so.MOCK_USER;else{d=FU(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const p=r.mockUserToken.sub||r.mockUserToken.user_id;if(!p)throw new ct(Qe.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new so(p)}t._authCredentials=new Lde(new jq(d,f))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t_{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new t_(this.firestore,e,this._query)}}class vu{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ym(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new vu(this.firestore,e,this._key)}}class Ym extends t_{constructor(e,n,r){super(e,n,oY(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new vu(this.firestore,null,new It(e))}withConverter(e){return new Ym(this.firestore,e,this._path)}}function zY(t,e,...n){if(t=ci(t),dpe("collection","path",e),t instanceof Tk){const r=ti.fromString(e,...n);return $Q(r),new Ym(t,null,r)}{if(!(t instanceof vu||t instanceof Ym))throw new ct(Qe.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ti.fromString(e,...n));return $Q(r),new Ym(t.firestore,null,r)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tH="AsyncQueue";class nH{constructor(e=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new LY(this,"async_queue_retry"),this.rc=()=>{const r=QN();r&&nt(tH,"Visibility state changed to "+r.visibilityState),this.x_.b_()},this.sc=e;const n=QN();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.oc(),this._c(e)}enterRestrictedMode(e){if(!this.Yu){this.Yu=!0,this.tc=e||!1;const n=QN();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.rc)}}enqueue(e){if(this.oc(),this.Yu)return new Promise(()=>{});const n=new Cf;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ju.push(e),this.ac()))}async ac(){if(this.Ju.length!==0){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(e){if(!$g(e))throw e;nt(tH,"Operation failed with retryable error: "+e)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(e){const n=this.sc.then(()=>(this.ec=!0,e().catch(r=>{throw this.Xu=r,this.ec=!1,fu("INTERNAL UNHANDLED ERROR: ",rH(r)),r}).then(r=>(this.ec=!1,r))));return this.sc=n,n}enqueueAfterDelay(e,n,r){this.oc(),this.nc.indexOf(e)>-1&&(n=0);const i=yk.createAndSchedule(this,e,n,r,s=>this.uc(s));return this.Zu.push(i),i}oc(){this.Xu&&Qt(47125,{cc:rH(this.Xu)})}verifyOperationInProgress(){}async lc(){let e;do e=this.sc,await e;while(e!==this.sc)}hc(e){for(const n of this.Zu)if(n.timerId===e)return!0;return!1}Pc(e){return this.lc().then(()=>{this.Zu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Zu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.lc()})}Tc(e){this.nc.push(e)}uc(e){const n=this.Zu.indexOf(e);this.Zu.splice(n,1)}}function rH(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class qY extends Tk{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new nH,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new nH(e),this._firestoreClient=void 0,await e}}}function ppe(t,e){const n=typeof t=="object"?t:zv(),r=typeof t=="string"?t:BS,i=yu(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=MU("firestore");s&&fpe(i,...s)}return i}function mpe(t){if(t._terminated)throw new ct(Qe.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||gpe(t),t._firestoreClient}function gpe(t){var e,n,r;const i=t._freezeSettings(),s=function(a,A,l,d){return new Zde(a,A,l,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,GY(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new ape(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(a){const A=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(A),_online:A}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vg(Ys.fromBase64String(e))}catch(n){throw new ct(Qe.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new vg(Ys.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YY{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ct(Qe.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ao(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XY{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sk{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ct(Qe.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ct(Qe.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return An(this._lat,e._lat)||An(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _pe=/^__.*__$/;function JY(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qt(40011,{Ic:t})}}class Ik{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ec(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(e){return new Ik(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.dc({path:r,Rc:!1});return i.Vc(e),i}mc(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.dc({path:r,Rc:!1});return i.Ec(),i}fc(e){return this.dc({path:void 0,Rc:!0})}gc(e){return TL(e,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Ec(){if(this.path)for(let e=0;e<this.path.length;e++)this.Vc(this.path.get(e))}Vc(e){if(e.length===0)throw this.gc("Document fields must not be empty");if(JY(this.Ic)&&_pe.test(e))throw this.gc('Document fields cannot begin and end with "__"')}}class Epe{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||AI(e)}bc(e,n,r,i=!1){return new Ik({Ic:e,methodName:n,wc:r,path:Ao.emptyPath(),Rc:!1,yc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ype(t){const e=t._freezeSettings(),n=AI(t._databaseId);return new Epe(t._databaseId,!!e.ignoreUndefinedProperties,n)}function vpe(t,e,n,r=!1){return Rk(n,t.bc(r?4:3,e))}function Rk(t,e){if($Y(t=ci(t)))return Cpe("Unsupported field value:",e,t),wpe(t,e);if(t instanceof XY)return function(r,i){if(!JY(i.Ic))throw i.gc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.gc(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Rc&&e.Ic!==4)throw e.gc("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let A=Rk(a,i.fc(o));A==null&&(A={nullValue:"NULL_VALUE"}),s.push(A),o++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=ci(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return whe(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=Os.fromDate(r);return{timestampValue:mL(i.serializer,s)}}if(r instanceof Os){const s=new Os(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:mL(i.serializer,s)}}if(r instanceof Sk)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof vg)return{bytesValue:vY(i.serializer,r._byteString)};if(r instanceof vu){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.gc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:wY(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof bk)return function(o,a){return{mapValue:{fields:{[$q]:{stringValue:Zq},[LS]:{arrayValue:{values:o.toArray().map(l=>{if(typeof l!="number")throw a.gc("VectorValues must only contain numeric values.");return ck(a.serializer,l)})}}}}}}(r,i);throw i.gc(`Unsupported field value: ${uI(r)}`)}(t,e)}function wpe(t,e){const n={};return Wq(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zg(t,(r,i)=>{const s=Rk(i,e.Ac(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function $Y(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Os||t instanceof Sk||t instanceof vg||t instanceof vu||t instanceof XY||t instanceof bk)}function Cpe(t,e,n){if(!$Y(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){const r=uI(n);throw r==="an object"?e.gc(t+" a custom object"):e.gc(t+" "+r)}}const Tpe=new RegExp("[~\\*/\\[\\]]");function Spe(t,e,n){if(e.search(Tpe)>=0)throw TL(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new YY(...e.split("."))._internalPath}catch{throw TL(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function TL(t,e,n,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let A="";return(s||o)&&(A+=" (found",s&&(A+=` in field ${r}`),o&&(A+=` in document ${i}`),A+=")"),new ct(Qe.INVALID_ARGUMENT,a+t+A)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZY{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new vu(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new bpe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Ok("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class bpe extends ZY{data(){return super.data()}}function Ok(t,e){return typeof e=="string"?Spe(t,e):e instanceof YY?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ipe(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ct(Qe.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Nk{}class Rpe extends Nk{}function eX(t,e,...n){let r=[];e instanceof Nk&&r.push(e),r=r.concat(n),function(s){const o=s.filter(A=>A instanceof Dk).length,a=s.filter(A=>A instanceof dI).length;if(o>1||o>0&&a>0)throw new ct(Qe.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class dI extends Rpe{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new dI(e,n,r)}_apply(e){const n=this._parse(e);return tX(e._query,n),new t_(e.firestore,e.converter,uL(e._query,n))}_parse(e){const n=ype(e.firestore);return function(s,o,a,A,l,d,f){let p;if(l.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new ct(Qe.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){sH(f,d);const y=[];for(const E of f)y.push(iH(A,s,E));p={arrayValue:{values:y}}}else p=iH(A,s,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||sH(f,d),p=vpe(a,o,f,d==="in"||d==="not-in");return Yi.create(l,d,p)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function SL(t,e,n){const r=e,i=Ok("where",t);return dI._create(i,r,n)}class Dk extends Nk{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Dk(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:$c.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const A of a)tX(o,A),o=uL(o,A)}(e._query,n),new t_(e.firestore,e.converter,uL(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function iH(t,e,n){if(typeof(n=ci(n))=="string"){if(n==="")throw new ct(Qe.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aY(e)&&n.indexOf("/")!==-1)throw new ct(Qe.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(ti.fromString(n));if(!It.isDocumentKey(r))throw new ct(Qe.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return EQ(t,new It(r))}if(n instanceof vu)return EQ(t,n._key);throw new ct(Qe.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uI(n)}.`)}function sH(t,e){if(!Array.isArray(t)||t.length===0)throw new ct(Qe.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function tX(t,e){const n=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new ct(Qe.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ct(Qe.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class Ope{convertValue(e,n="none"){switch(Yd(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ui(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(qd(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Qt(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Zg(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertVectorValue(e){var n,r,i;const s=(i=(r=(n=e.fields)===null||n===void 0?void 0:n[LS].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Ui(o.doubleValue));return new bk(s)}convertGeoPoint(e){return new Sk(Ui(e.latitude),Ui(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=rI(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(ev(e));default:return null}}convertTimestamp(e){const n=zd(e);return new Os(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=ti.fromString(e);oi(RY(r),9688,{name:e});const i=new tv(r.get(1),r.get(3)),s=new It(r.popFirst(5));return i.isEqual(n)||fu(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Npe extends ZY{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new D0(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Ok("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class D0 extends Npe{data(e={}){return super.data(e)}}class Dpe{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new YC(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new D0(this._firestore,this._userDataWriter,r.key,r,new YC(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ct(Qe.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const A=new D0(i._firestore,i._userDataWriter,a.doc.key,a.doc,new YC(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:A,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const A=new D0(i._firestore,i._userDataWriter,a.doc.key,a.doc,new YC(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let l=-1,d=-1;return a.type!==0&&(l=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:Bpe(a.type),doc:A,oldIndex:l,newIndex:d}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function Bpe(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qt(61501,{type:t})}}class Lpe extends Ope{constructor(e){super(),this.firestore=e}convertBytes(e){return new vg(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new vu(this.firestore,null,n)}}function nX(t){t=CL(t,t_);const e=CL(t.firestore,qY),n=mpe(e),r=new Lpe(e);return Ipe(t._query),upe(n,t._query).then(i=>new Dpe(e,r,t,i))}(function(e,n=!0){(function(i){Jg=i})(ah),_c(new Da("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new qY(new Pde(r.getProvider("auth-internal")),new xde(o,r.getProvider("app-check-internal")),function(l,d){if(!Object.prototype.hasOwnProperty.apply(l.options,["projectId"]))throw new ct(Qe.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new tv(l.options.projectId,d)}(o,i),o);return s=Object.assign({useFetchStreams:n},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),lo(aQ,cQ,e),lo(aQ,cQ,"esm2017")})();var oH={};const aH="@firebase/database",cH="1.0.19";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rX="";function Ppe(t){rX=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Upe{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),As(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Xy(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kpe{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return ol(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iX=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Upe(e)}}catch{}return new kpe},df=iX("localStorage"),xpe=iX("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xm=new Wv("@firebase/database"),Mpe=function(){let t=1;return function(){return t++}}(),sX=function(t){const e=tce(t),n=new Jae;n.update(e);const r=n.digest();return xU.encodeByteArray(r)},tw=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=tw.apply(null,r):typeof r=="object"?e+=As(r):e+=r,e+=" "}return e};let Cy=null,AH=!0;const Fpe=function(t,e){Fe(!0,"Can't turn on custom loggers persistently."),Xm.logLevel=fn.VERBOSE,Cy=Xm.log.bind(Xm)},Ss=function(...t){if(AH===!0&&(AH=!1,Cy===null&&xpe.get("logging_enabled")===!0&&Fpe()),Cy){const e=tw.apply(null,t);Cy(e)}},nw=function(t){return function(...e){Ss(t,...e)}},bL=function(...t){const e="FIREBASE INTERNAL ERROR: "+tw(...t);Xm.error(e)},pu=function(...t){const e=`FIREBASE FATAL ERROR: ${tw(...t)}`;throw Xm.error(e),new Error(e)},No=function(...t){const e="FIREBASE WARNING: "+tw(...t);Xm.warn(e)},Vpe=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&No("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},hI=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Qpe=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},wg="[MIN_NAME]",kf="[MAX_NAME]",qf=function(t,e){if(t===e)return 0;if(t===wg||e===kf)return-1;if(e===wg||t===kf)return 1;{const n=lH(t),r=lH(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},Hpe=function(t,e){return t===e?0:t<e?-1:1},yE=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+As(e))},Bk=function(t){if(typeof t!="object"||t===null)return As(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=As(e[r]),n+=":",n+=Bk(t[e[r]]);return n+="}",n},oX=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function Ds(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const aX=function(t){Fe(!hI(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let i,s,o,a,A;t===0?(s=0,o=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),r),s=a+r,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(s=0,o=Math.round(t/Math.pow(2,1-r-n))));const l=[];for(A=n;A;A-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(A=e;A;A-=1)l.push(s%2?1:0),s=Math.floor(s/2);l.push(i?1:0),l.reverse();const d=l.join("");let f="";for(A=0;A<64;A+=8){let p=parseInt(d.substr(A,8),2).toString(16);p.length===1&&(p="0"+p),f=f+p}return f.toLowerCase()},jpe=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Kpe=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Gpe(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const Wpe=new RegExp("^-?(0*)\\d{1,10}$"),zpe=-2147483648,qpe=2147483647,lH=function(t){if(Wpe.test(t)){const e=Number(t);if(e>=zpe&&e<=qpe)return e}return null},n_=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw No("Exception was thrown by user callback.",n),e},Math.floor(0))}},Ype=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ty=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xpe{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,cc(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){No(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jpe{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(Ss("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',No(e)}}class B0{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}B0.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lk="5",cX="v",AX="s",lX="r",uX="f",dX=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,hX="ls",fX="p",IL="ac",pX="websocket",mX="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gX{constructor(e,n,r,i,s=!1,o="",a=!1,A=!1,l=null){this.secure=n,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=A,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=df.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&df.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function $pe(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function _X(t,e,n){Fe(typeof e=="string","typeof type must == string"),Fe(typeof n=="object","typeof params must == object");let r;if(e===pX)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===mX)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);$pe(t)&&(n.ns=t.namespace);const i=[];return Ds(n,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zpe{constructor(){this.counters_={}}incrementCounter(e,n=1){ol(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return Bae(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jN={},KN={};function Pk(t){const e=t.toString();return jN[e]||(jN[e]=new Zpe),jN[e]}function eme(t,e){const n=t.toString();return KN[n]||(KN[n]=e()),KN[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tme{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&n_(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uH="start",nme="close",rme="pLPCommand",ime="pRTLPCB",EX="id",yX="pw",vX="ser",sme="cb",ome="seg",ame="ts",cme="d",Ame="dframe",wX=1870,CX=30,lme=wX-CX,ume=25e3,dme=3e4;class Dm{constructor(e,n,r,i,s,o,a){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=nw(e),this.stats_=Pk(n),this.urlFn=A=>(this.appCheckToken&&(A[IL]=this.appCheckToken),_X(n,mX,A))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new tme(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(dme)),Qpe(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Uk((...s)=>{const[o,a,A,l,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===uH)this.id=a,this.password=A;else if(o===nme)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[uH]="t",r[vX]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[sme]=this.scriptTagHolder.uniqueCallbackIdentifier),r[cX]=Lk,this.transportSessionId&&(r[AX]=this.transportSessionId),this.lastSessionId&&(r[hX]=this.lastSessionId),this.applicationId&&(r[fX]=this.applicationId),this.appCheckToken&&(r[IL]=this.appCheckToken),typeof location<"u"&&location.hostname&&dX.test(location.hostname)&&(r[lX]=uX);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Dm.forceAllow_=!0}static forceDisallow(){Dm.forceDisallow_=!0}static isAvailable(){return Dm.forceAllow_?!0:!Dm.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!jpe()&&!Kpe()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=As(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=v7(n),i=oX(r,lme);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[Ame]="t",r[EX]=e,r[yX]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=As(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Uk{constructor(e,n,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Mpe(),window[rme+this.uniqueCallbackIdentifier]=e,window[ime+this.uniqueCallbackIdentifier]=n,this.myIFrame=Uk.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Ss("frame writing exception"),a.stack&&Ss(a.stack),Ss(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Ss("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[EX]=this.myID,e[yX]=this.myPW,e[vX]=this.currentSerial;let n=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+CX+r.length<=wX;){const o=this.pendingSegs.shift();r=r+"&"+ome+i+"="+o.seg+"&"+ame+i+"="+o.ts+"&"+cme+i+"="+o.d,i++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(r,Math.floor(ume)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{Ss("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hme=16384,fme=45e3;let VS=null;typeof MozWebSocket<"u"?VS=MozWebSocket:typeof WebSocket<"u"&&(VS=WebSocket);class Wc{constructor(e,n,r,i,s,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=nw(this.connId),this.stats_=Pk(n),this.connURL=Wc.connectionURL_(n,o,a,i,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,i,s){const o={};return o[cX]=Lk,typeof location<"u"&&location.hostname&&dX.test(location.hostname)&&(o[lX]=uX),n&&(o[AX]=n),r&&(o[hX]=r),i&&(o[IL]=i),s&&(o[fX]=s),_X(e,pX,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,df.set("previous_websocket_failure",!0);try{let r;jae(),this.mySock=new VS(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Wc.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&VS!==null&&!Wc.forceDisallow_}static previouslyFailed(){return df.isInMemoryStorage||df.get("previous_websocket_failure")===!0}markConnectionHealthy(){df.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=Xy(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(Fe(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=As(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=oX(n,hme);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(fme))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Wc.responsesRequiredToBeHealthy=2;Wc.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rv{static get ALL_TRANSPORTS(){return[Dm,Wc]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=Wc&&Wc.isAvailable();let r=n&&!Wc.previouslyFailed();if(e.webSocketOnly&&(n||No("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Wc];else{const i=this.transports_=[];for(const s of rv.ALL_TRANSPORTS)s&&s.isAvailable()&&i.push(s);rv.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}rv.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pme=6e4,mme=5e3,gme=10*1024,_me=100*1024,GN="t",dH="d",Eme="s",hH="r",yme="e",fH="o",pH="a",mH="n",gH="p",vme="h";class wme{constructor(e,n,r,i,s,o,a,A,l,d){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=A,this.onKill_=l,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=nw("c:"+this.id+":"),this.transportManager_=new rv(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Ty(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>_me?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>gme?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(GN in e){const n=e[GN];n===pH?this.upgradeIfSecondaryHealthy_():n===hH?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===fH&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=yE("t",e),r=yE("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:gH,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:pH,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:mH,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=yE("t",e),r=yE("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=yE(GN,e);if(dH in e){const r=e[dH];if(n===vme){const i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===mH){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===Eme?this.onConnectionShutdown_(r):n===hH?this.onReset_(r):n===yme?bL("Server Error: "+r):n===fH?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):bL("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Lk!==r&&No("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Ty(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(pme))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ty(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(mme))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:gH,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(df.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TX{put(e,n,r,i){}merge(e,n,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SX{constructor(e){this.allowedEvents_=e,this.listeners_={},Fe(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const i=this.getInitialEvent(e);i&&n.apply(r,i)}off(e,n,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===n&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){Fe(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QS extends SX{static getInstance(){return new QS}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!VU()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return Fe(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _H=32,EH=768;class ar{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Mn(){return new ar("")}function rn(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function $d(t){return t.pieces_.length-t.pieceNum_}function Tr(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new ar(t.pieces_,e)}function kk(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Cme(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function iv(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function bX(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new ar(e,0)}function ii(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof ar)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&n.push(r[i])}return new ar(n,0)}function ln(t){return t.pieceNum_>=t.pieces_.length}function Ro(t,e){const n=rn(t),r=rn(e);if(n===null)return e;if(n===r)return Ro(Tr(t),Tr(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Tme(t,e){const n=iv(t,0),r=iv(e,0);for(let i=0;i<n.length&&i<r.length;i++){const s=qf(n[i],r[i]);if(s!==0)return s}return n.length===r.length?0:n.length<r.length?-1:1}function xk(t,e){if($d(t)!==$d(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function dc(t,e){let n=t.pieceNum_,r=e.pieceNum_;if($d(t)>$d(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class Sme{constructor(e,n){this.errorPrefix_=n,this.parts_=iv(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Yb(this.parts_[r]);IX(this)}}function bme(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Yb(e),IX(t)}function Ime(t){const e=t.parts_.pop();t.byteLength_-=Yb(e),t.parts_.length>0&&(t.byteLength_-=1)}function IX(t){if(t.byteLength_>EH)throw new Error(t.errorPrefix_+"has a key path longer than "+EH+" bytes ("+t.byteLength_+").");if(t.parts_.length>_H)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+_H+") or object contains a cycle "+Zh(t))}function Zh(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mk extends SX{static getInstance(){return new Mk}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return Fe(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vE=1e3,Rme=60*5*1e3,yH=30*1e3,Ome=1.3,Nme=3e4,Dme="server_kill",vH=3;class iu extends TX{constructor(e,n,r,i,s,o,a,A){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=A,this.id=iu.nextPersistentConnectionId_++,this.log_=nw("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=vE,this.maxReconnectDelay_=Rme,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,A)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Mk.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&QS.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const i=++this.requestNumber_,s={r:i,a:e,b:n};this.log_(As(s)),Fe(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const n=new FA,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),n.promise}listen(e,n,r,i){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),Fe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Fe(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:n,query:e,tag:r};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const s={p:r},o="q";e.tag&&(s.q=n._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const A=a.d,l=a.s;iu.warnOnListenWarnings_(A,n),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",a),l!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(l,A))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&ol(e,"w")){const r=ug(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+n._queryParams.getIndex().toString()+'"',s=n._path.toString();No(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||Xae(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=yH)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=Yae(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,i=>{const s=i.s,o=i.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),Fe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,n)}sendUnlisten_(e,n,r,i){this.log_("Unlisten on "+e+" for "+n);const s={p:e},o="n";i&&(s.q=r,s.t=i),this.sendRequest(o,s)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,i){const s={p:n,d:r};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,n,r,i){this.putInternal("p",e,n,r,i)}merge(e,n,r,i){this.putInternal("m",e,n,r,i)}putInternal(e,n,r,i,s){this.initConnection_();const o={p:n,d:r};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,s=>{this.log_(n+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(s.s,s.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const s=r.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+As(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):bL("Unrecognized action received from server: "+As(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){Fe(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=vE,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=vE,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Nme&&(this.reconnectDelay_=vE),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Ome)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+iu.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const A=function(){a?a.close():(o=!0,r())},l=function(f){Fe(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:A,sendRequest:l};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,p]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?Ss("getToken() completed but was canceled"):(Ss("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=p&&p.token,a=new wme(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,g=>{No(g+" ("+this.repoInfo_.toString()+")"),this.interrupt(Dme)},s))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&No(f),A())}}}interrupt(e){Ss("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Ss("Resuming connection for reason: "+e),delete this.interruptReasons_[e],yS(this.interruptReasons_)&&(this.reconnectDelay_=vE,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(s=>Bk(s)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,n){const r=new ar(e).toString();let i;if(this.listens.has(r)){const s=this.listens.get(r);i=s.get(n),s.delete(n),s.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,n){Ss("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=vH&&(this.reconnectDelay_=yH,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){Ss("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=vH&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+rX.replace(/\./g,"-")]=1,VU()?e["framework.cordova"]=1:I7()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=QS.getInstance().currentlyOnline();return yS(this.interruptReasons_)&&e}}iu.nextPersistentConnectionId_=0;iu.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new un(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fI{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new un(wg,e),i=new un(wg,n);return this.compare(r,i)!==0}minPost(){return un.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let XC;class RX extends fI{static get __EMPTY_NODE(){return XC}static set __EMPTY_NODE(e){XC=e}compare(e,n){return qf(e.name,n.name)}isDefinedOn(e){throw qg("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return un.MIN}maxPost(){return new un(kf,XC)}makePost(e,n){return Fe(typeof e=="string","KeyIndex indexValue must always be a string."),new un(e,XC)}toString(){return".key"}}const Jm=new RX;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e,n,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Cs{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??Cs.RED,this.left=i??Xo.EMPTY_NODE,this.right=s??Xo.EMPTY_NODE}copy(e,n,r,i,s){return new Cs(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return s<0?i=i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i=i.copy(null,n,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Xo.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,i;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Xo.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Cs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Cs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Cs.RED=!0;Cs.BLACK=!1;class Bme{copy(e,n,r,i,s){return this}insert(e,n,r){return new Cs(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Xo{constructor(e,n=Xo.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Xo(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,Cs.BLACK,null,null))}remove(e){return new Xo(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Cs.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,i=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new JC(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new JC(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new JC(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new JC(this.root_,null,this.comparator_,!0,e)}}Xo.EMPTY_NODE=new Bme;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lme(t,e){return qf(t.name,e.name)}function Fk(t,e){return qf(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let RL;function Pme(t){RL=t}const OX=function(t){return typeof t=="number"?"number:"+aX(t):"string:"+t},NX=function(t){if(t.isLeafNode()){const e=t.val();Fe(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ol(e,".sv"),"Priority must be a string or number.")}else Fe(t===RL||t.isEmpty(),"priority of unexpected type.");Fe(t===RL||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wH;class ys{static set __childrenNodeConstructor(e){wH=e}static get __childrenNodeConstructor(){return wH}constructor(e,n=ys.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,Fe(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),NX(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ys(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:ys.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return ln(e)?this:rn(e)===".priority"?this.priorityNode_:ys.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:ys.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=rn(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(Fe(r!==".priority"||$d(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,ys.__childrenNodeConstructor.EMPTY_NODE.updateChild(Tr(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+OX(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=aX(this.value_):e+=this.value_,this.lazyHash_=sX(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ys.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ys.__childrenNodeConstructor?-1:(Fe(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,i=ys.VALUE_TYPE_ORDER.indexOf(n),s=ys.VALUE_TYPE_ORDER.indexOf(r);return Fe(i>=0,"Unknown leaf type: "+n),Fe(s>=0,"Unknown leaf type: "+r),i===s?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}ys.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DX,BX;function Ume(t){DX=t}function kme(t){BX=t}class xme extends fI{compare(e,n){const r=e.node.getPriority(),i=n.node.getPriority(),s=r.compareTo(i);return s===0?qf(e.name,n.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return un.MIN}maxPost(){return new un(kf,new ys("[PRIORITY-POST]",BX))}makePost(e,n){const r=DX(e);return new un(n,new ys("[PRIORITY-POST]",r))}toString(){return".priority"}}const si=new xme;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mme=Math.log(2);class Fme{constructor(e){const n=s=>parseInt(Math.log(s)/Mme,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const HS=function(t,e,n,r){t.sort(e);const i=function(A,l){const d=l-A;let f,p;if(d===0)return null;if(d===1)return f=t[A],p=n?n(f):f,new Cs(p,f.node,Cs.BLACK,null,null);{const g=parseInt(d/2,10)+A,y=i(A,g),E=i(g+1,l);return f=t[g],p=n?n(f):f,new Cs(p,f.node,Cs.BLACK,y,E)}},s=function(A){let l=null,d=null,f=t.length;const p=function(y,E){const w=f-y,b=f;f-=y;const I=i(w+1,b),B=t[w],U=n?n(B):B;g(new Cs(U,B.node,E,null,I))},g=function(y){l?(l.left=y,l=y):(d=y,l=y)};for(let y=0;y<A.count;++y){const E=A.nextBitIsOne(),w=Math.pow(2,A.count-(y+1));E?p(w,Cs.BLACK):(p(w,Cs.BLACK),p(w,Cs.RED))}return d},o=new Fme(t.length),a=s(o);return new Xo(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let WN;const Mp={};class tu{static get Default(){return Fe(Mp&&si,"ChildrenNode.ts has not been loaded"),WN=WN||new tu({".priority":Mp},{".priority":si}),WN}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=ug(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Xo?n:null}hasIndex(e){return ol(this.indexSet_,e.toString())}addIndex(e,n){Fe(e!==Jm,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const s=n.getIterator(un.Wrap);let o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=HS(r,e.getCompare()):a=Mp;const A=e.toString(),l=Object.assign({},this.indexSet_);l[A]=e;const d=Object.assign({},this.indexes_);return d[A]=a,new tu(d,l)}addToIndexes(e,n){const r=vS(this.indexes_,(i,s)=>{const o=ug(this.indexSet_,s);if(Fe(o,"Missing index implementation for "+s),i===Mp)if(o.isDefinedOn(e.node)){const a=[],A=n.getIterator(un.Wrap);let l=A.getNext();for(;l;)l.name!==e.name&&a.push(l),l=A.getNext();return a.push(e),HS(a,o.getCompare())}else return Mp;else{const a=n.get(e.name);let A=i;return a&&(A=A.remove(new un(e.name,a))),A.insert(e,e.node)}});return new tu(r,this.indexSet_)}removeFromIndexes(e,n){const r=vS(this.indexes_,i=>{if(i===Mp)return i;{const s=n.get(e.name);return s?i.remove(new un(e.name,s)):i}});return new tu(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wE;class Ot{static get EMPTY_NODE(){return wE||(wE=new Ot(new Xo(Fk),null,tu.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&NX(this.priorityNode_),this.children_.isEmpty()&&Fe(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||wE}updatePriority(e){return this.children_.isEmpty()?this:new Ot(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?wE:n}}getChild(e){const n=rn(e);return n===null?this:this.getImmediateChild(n).getChild(Tr(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(Fe(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new un(e,n);let i,s;n.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?wE:this.priorityNode_;return new Ot(i,o,s)}}updateChild(e,n){const r=rn(e);if(r===null)return n;{Fe(rn(e)!==".priority"||$d(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(Tr(e),n);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,i=0,s=!0;if(this.forEachChild(si,(o,a)=>{n[o]=a.val(e),r++,s&&Ot.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!e&&s&&i<2*r){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+OX(this.getPriority().val())+":"),this.forEachChild(si,(n,r)=>{const i=r.hash();i!==""&&(e+=":"+n+":"+i)}),this.lazyHash_=e===""?"":sX(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const i=this.resolveIndex_(r);if(i){const s=i.getPredecessorKey(new un(e,n));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new un(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new un(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>n(i.name,i.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,un.Wrap);let s=i.peek();for(;s!=null&&n.compare(s,e)<0;)i.getNext(),s=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,un.Wrap);let s=i.peek();for(;s!=null&&n.compare(s,e)>0;)i.getNext(),s=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===rw?-1:0}withIndex(e){if(e===Jm||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Ot(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===Jm||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(si),i=n.getIterator(si);let s=r.getNext(),o=i.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=r.getNext(),o=i.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===Jm?null:this.indexMap_.get(e.toString())}}Ot.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Vme extends Ot{constructor(){super(new Xo(Fk),Ot.EMPTY_NODE,tu.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ot.EMPTY_NODE}isEmpty(){return!1}}const rw=new Vme;Object.defineProperties(un,{MIN:{value:new un(wg,Ot.EMPTY_NODE)},MAX:{value:new un(kf,rw)}});RX.__EMPTY_NODE=Ot.EMPTY_NODE;ys.__childrenNodeConstructor=Ot;Pme(rw);kme(rw);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qme=!0;function Ei(t,e=null){if(t===null)return Ot.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),Fe(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new ys(n,Ei(e))}if(!(t instanceof Array)&&Qme){const n=[];let r=!1;if(Ds(t,(o,a)=>{if(o.substring(0,1)!=="."){const A=Ei(a);A.isEmpty()||(r=r||!A.getPriority().isEmpty(),n.push(new un(o,A)))}}),n.length===0)return Ot.EMPTY_NODE;const s=HS(n,Lme,o=>o.name,Fk);if(r){const o=HS(n,si.getCompare());return new Ot(s,Ei(e),new tu({".priority":o},{".priority":si}))}else return new Ot(s,Ei(e),tu.Default)}else{let n=Ot.EMPTY_NODE;return Ds(t,(r,i)=>{if(ol(t,r)&&r.substring(0,1)!=="."){const s=Ei(i);(s.isLeafNode()||!s.isEmpty())&&(n=n.updateImmediateChild(r,s))}}),n.updatePriority(Ei(e))}}Ume(Ei);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hme extends fI{constructor(e){super(),this.indexPath_=e,Fe(!ln(e)&&rn(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),i=this.extractChild(n.node),s=r.compareTo(i);return s===0?qf(e.name,n.name):s}makePost(e,n){const r=Ei(e),i=Ot.EMPTY_NODE.updateChild(this.indexPath_,r);return new un(n,i)}maxPost(){const e=Ot.EMPTY_NODE.updateChild(this.indexPath_,rw);return new un(kf,e)}toString(){return iv(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jme extends fI{compare(e,n){const r=e.node.compareTo(n.node);return r===0?qf(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return un.MIN}maxPost(){return un.MAX}makePost(e,n){const r=Ei(e);return new un(n,r)}toString(){return".value"}}const Kme=new jme;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LX(t){return{type:"value",snapshotNode:t}}function Cg(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function sv(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function ov(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Gme(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vk{constructor(e){this.index_=e}updateChild(e,n,r,i,s,o){Fe(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(sv(n,a)):Fe(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Cg(n,r)):o.trackChildChange(ov(n,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(si,(i,s)=>{n.hasChild(i)||r.trackChildChange(sv(i,s))}),n.isLeafNode()||n.forEachChild(si,(i,s)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(ov(i,s,o))}else r.trackChildChange(Cg(i,s))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Ot.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class av{constructor(e){this.indexedFilter_=new Vk(e.getIndex()),this.index_=e.getIndex(),this.startPost_=av.getStartPost_(e),this.endPost_=av.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,i,s,o){return this.matches(new un(n,r))||(r=Ot.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,i,s,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=Ot.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(Ot.EMPTY_NODE);const s=this;return n.forEachChild(si,(o,a)=>{s.matches(new un(o,a))||(i=i.updateImmediateChild(o,Ot.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wme{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new av(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,i,s,o){return this.rangedFilter_.matches(new un(n,r))||(r=Ot.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,i,s,o):this.fullLimitUpdateChild_(e,n,r,s,o)}updateFullNode(e,n,r){let i;if(n.isLeafNode()||n.isEmpty())i=Ot.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=Ot.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=n.withIndex(this.index_),i=i.updatePriority(Ot.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){const a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,Ot.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,i,s){let o;if(this.reverse_){const f=this.index_.getCompare();o=(p,g)=>f(g,p)}else o=this.index_.getCompare();const a=e;Fe(a.numChildren()===this.limit_,"");const A=new un(n,r),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(A);if(a.hasChild(n)){const f=a.getImmediateChild(n);let p=i.getChildAfterChild(this.index_,l,this.reverse_);for(;p!=null&&(p.name===n||a.hasChild(p.name));)p=i.getChildAfterChild(this.index_,p,this.reverse_);const g=p==null?1:o(p,A);if(d&&!r.isEmpty()&&g>=0)return s!=null&&s.trackChildChange(ov(n,r,f)),a.updateImmediateChild(n,r);{s!=null&&s.trackChildChange(sv(n,f));const E=a.updateImmediateChild(n,Ot.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(s!=null&&s.trackChildChange(Cg(p.name,p.node)),E.updateImmediateChild(p.name,p.node)):E}}else return r.isEmpty()?e:d&&o(l,A)>=0?(s!=null&&(s.trackChildChange(sv(l.name,l.node)),s.trackChildChange(Cg(n,r))),a.updateImmediateChild(n,r).updateImmediateChild(l.name,Ot.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=si}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Fe(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Fe(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:wg}hasEnd(){return this.endSet_}getIndexEndValue(){return Fe(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Fe(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:kf}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Fe(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===si}copy(){const e=new Qk;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function zme(t){return t.loadsAllData()?new Vk(t.getIndex()):t.hasLimit()?new Wme(t):new av(t)}function CH(t){const e={};if(t.isDefault())return e;let n;if(t.index_===si?n="$priority":t.index_===Kme?n="$value":t.index_===Jm?n="$key":(Fe(t.index_ instanceof Hme,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=As(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=As(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+As(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=As(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+As(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function TH(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==si&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jS extends TX{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(Fe(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=nw("p:rest:"),this.listens_={}}listen(e,n,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=jS.getListenId_(e,r),a={};this.listens_[o]=a;const A=CH(e._queryParams);this.restRequest_(s+".json",A,(l,d)=>{let f=d;if(l===404&&(f=null,l=null),l===null&&this.onDataUpdate_(s,f,!1,r),ug(this.listens_,o)===a){let p;l?l===401?p="permission_denied":p="rest_error:"+l:p="ok",i(p,null)}})}unlisten(e,n){const r=jS.getListenId_(e,n);delete this.listens_[r]}get(e){const n=CH(e._queryParams),r=e._path.toString(),i=new FA;return this.restRequest_(r+".json",n,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(n.auth=i.accessToken),s&&s.token&&(n.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Yg(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let A=null;if(a.status>=200&&a.status<300){try{A=Xy(a.responseText)}catch{No("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,A)}else a.status!==401&&a.status!==404&&No("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qme{constructor(){this.rootNode_=Ot.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KS(){return{value:null,children:new Map}}function r_(t,e,n){if(ln(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=rn(e);t.children.has(r)||t.children.set(r,KS());const i=t.children.get(r);e=Tr(e),r_(i,e,n)}}function OL(t,e){if(ln(e))return t.value=null,t.children.clear(),!0;if(t.value!==null){if(t.value.isLeafNode())return!1;{const n=t.value;return t.value=null,n.forEachChild(si,(r,i)=>{r_(t,new ar(r),i)}),OL(t,e)}}else if(t.children.size>0){const n=rn(e);return e=Tr(e),t.children.has(n)&&OL(t.children.get(n),e)&&t.children.delete(n),t.children.size===0}else return!0}function NL(t,e,n){t.value!==null?n(e,t.value):Yme(t,(r,i)=>{const s=new ar(e.toString()+"/"+r);NL(i,s,n)})}function Yme(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xme{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n=Object.assign({},e);return this.last_&&Ds(this.last_,(r,i)=>{n[r]=n[r]-i}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SH=10*1e3,Jme=30*1e3,$me=5*60*1e3;class Zme{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new Xme(e);const r=SH+(Jme-SH)*Math.random();Ty(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;Ds(e,(i,s)=>{s>0&&ol(this.statsToReport_,i)&&(n[i]=s,r=!0)}),r&&this.server_.reportStats(n),Ty(this.reportStats_.bind(this),Math.floor(Math.random()*2*$me))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qc;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(qc||(qc={}));function Hk(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function jk(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Kk(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GS{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=qc.ACK_USER_WRITE,this.source=Hk()}operationForChild(e){if(ln(this.path)){if(this.affectedTree.value!=null)return Fe(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new ar(e));return new GS(Mn(),n,this.revert)}}else return Fe(rn(this.path)===e,"operationForChild called for unrelated child."),new GS(Tr(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(e,n){this.source=e,this.path=n,this.type=qc.LISTEN_COMPLETE}operationForChild(e){return ln(this.path)?new cv(this.source,Mn()):new cv(this.source,Tr(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xf{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=qc.OVERWRITE}operationForChild(e){return ln(this.path)?new xf(this.source,Mn(),this.snap.getImmediateChild(e)):new xf(this.source,Tr(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=qc.MERGE}operationForChild(e){if(ln(this.path)){const n=this.children.subtree(new ar(e));return n.isEmpty()?null:n.value?new xf(this.source,Mn(),n.value):new Tg(this.source,Mn(),n)}else return Fe(rn(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Tg(this.source,Tr(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(ln(e))return this.isFullyInitialized()&&!this.filtered_;const n=rn(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ege{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function tge(t,e,n,r){const i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(Gme(o.childName,o.snapshotNode))}),CE(t,i,"child_removed",e,r,n),CE(t,i,"child_added",e,r,n),CE(t,i,"child_moved",s,r,n),CE(t,i,"child_changed",e,r,n),CE(t,i,"value",e,r,n),i}function CE(t,e,n,r,i,s){const o=r.filter(a=>a.type===n);o.sort((a,A)=>rge(t,a,A)),o.forEach(a=>{const A=nge(t,a,s);i.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(A,t.query_))})})}function nge(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function rge(t,e,n){if(e.childName==null||n.childName==null)throw qg("Should only compare child_ events.");const r=new un(e.childName,e.snapshotNode),i=new un(n.childName,n.snapshotNode);return t.index_.compare(r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pI(t,e){return{eventCache:t,serverCache:e}}function Sy(t,e,n,r){return pI(new Zd(e,n,r),t.serverCache)}function PX(t,e,n,r){return pI(t.eventCache,new Zd(e,n,r))}function WS(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Mf(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zN;const ige=()=>(zN||(zN=new Xo(Hpe)),zN);class Nr{static fromObject(e){let n=new Nr(null);return Ds(e,(r,i)=>{n=n.set(new ar(r),i)}),n}constructor(e,n=ige()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Mn(),value:this.value};if(ln(e))return null;{const r=rn(e),i=this.children.get(r);if(i!==null){const s=i.findRootMostMatchingPathAndValue(Tr(e),n);return s!=null?{path:ii(new ar(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(ln(e))return this;{const n=rn(e),r=this.children.get(n);return r!==null?r.subtree(Tr(e)):new Nr(null)}}set(e,n){if(ln(e))return new Nr(n,this.children);{const r=rn(e),s=(this.children.get(r)||new Nr(null)).set(Tr(e),n),o=this.children.insert(r,s);return new Nr(this.value,o)}}remove(e){if(ln(e))return this.children.isEmpty()?new Nr(null):new Nr(null,this.children);{const n=rn(e),r=this.children.get(n);if(r){const i=r.remove(Tr(e));let s;return i.isEmpty()?s=this.children.remove(n):s=this.children.insert(n,i),this.value===null&&s.isEmpty()?new Nr(null):new Nr(this.value,s)}else return this}}get(e){if(ln(e))return this.value;{const n=rn(e),r=this.children.get(n);return r?r.get(Tr(e)):null}}setTree(e,n){if(ln(e))return n;{const r=rn(e),s=(this.children.get(r)||new Nr(null)).setTree(Tr(e),n);let o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new Nr(this.value,o)}}fold(e){return this.fold_(Mn(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(ii(e,i),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,Mn(),n)}findOnPath_(e,n,r){const i=this.value?r(n,this.value):!1;if(i)return i;if(ln(e))return null;{const s=rn(e),o=this.children.get(s);return o?o.findOnPath_(Tr(e),ii(n,s),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Mn(),n)}foreachOnPath_(e,n,r){if(ln(e))return this;{this.value&&r(n,this.value);const i=rn(e),s=this.children.get(i);return s?s.foreachOnPath_(Tr(e),ii(n,i),r):new Nr(null)}}foreach(e){this.foreach_(Mn(),e)}foreach_(e,n){this.children.inorderTraversal((r,i)=>{i.foreach_(ii(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(e){this.writeTree_=e}static empty(){return new Jc(new Nr(null))}}function by(t,e,n){if(ln(e))return new Jc(new Nr(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let s=r.value;const o=Ro(i,e);return s=s.updateChild(o,n),new Jc(t.writeTree_.set(i,s))}else{const i=new Nr(n),s=t.writeTree_.setTree(e,i);return new Jc(s)}}}function DL(t,e,n){let r=t;return Ds(n,(i,s)=>{r=by(r,ii(e,i),s)}),r}function bH(t,e){if(ln(e))return Jc.empty();{const n=t.writeTree_.setTree(e,new Nr(null));return new Jc(n)}}function BL(t,e){return Yf(t,e)!=null}function Yf(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Ro(n.path,e)):null}function IH(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(si,(r,i)=>{e.push(new un(r,i))}):t.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new un(r,i.value))}),e}function kd(t,e){if(ln(e))return t;{const n=Yf(t,e);return n!=null?new Jc(new Nr(n)):new Jc(t.writeTree_.subtree(e))}}function LL(t){return t.writeTree_.isEmpty()}function Sg(t,e){return UX(Mn(),t.writeTree_,e)}function UX(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(Fe(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):n=UX(ii(t,i),s,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(ii(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mI(t,e){return FX(e,t)}function sge(t,e,n,r,i){Fe(r>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:i}),i&&(t.visibleWrites=by(t.visibleWrites,e,n)),t.lastWriteId=r}function oge(t,e,n,r){Fe(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=DL(t.visibleWrites,e,n),t.lastWriteId=r}function age(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function cge(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);Fe(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let i=r.visible,s=!1,o=t.allWrites.length-1;for(;i&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&Age(a,r.path)?i=!1:dc(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return lge(t),!0;if(r.snap)t.visibleWrites=bH(t.visibleWrites,r.path);else{const a=r.children;Ds(a,A=>{t.visibleWrites=bH(t.visibleWrites,ii(r.path,A))})}return!0}else return!1}function Age(t,e){if(t.snap)return dc(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&dc(ii(t.path,n),e))return!0;return!1}function lge(t){t.visibleWrites=kX(t.allWrites,uge,Mn()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function uge(t){return t.visible}function kX(t,e,n){let r=Jc.empty();for(let i=0;i<t.length;++i){const s=t[i];if(e(s)){const o=s.path;let a;if(s.snap)dc(n,o)?(a=Ro(n,o),r=by(r,a,s.snap)):dc(o,n)&&(a=Ro(o,n),r=by(r,Mn(),s.snap.getChild(a)));else if(s.children){if(dc(n,o))a=Ro(n,o),r=DL(r,a,s.children);else if(dc(o,n))if(a=Ro(o,n),ln(a))r=DL(r,Mn(),s.children);else{const A=ug(s.children,rn(a));if(A){const l=A.getChild(Tr(a));r=by(r,Mn(),l)}}}else throw qg("WriteRecord should have .snap or .children")}}return r}function xX(t,e,n,r,i){if(!r&&!i){const s=Yf(t.visibleWrites,e);if(s!=null)return s;{const o=kd(t.visibleWrites,e);if(LL(o))return n;if(n==null&&!BL(o,Mn()))return null;{const a=n||Ot.EMPTY_NODE;return Sg(o,a)}}}else{const s=kd(t.visibleWrites,e);if(!i&&LL(s))return n;if(!i&&n==null&&!BL(s,Mn()))return null;{const o=function(l){return(l.visible||i)&&(!r||!~r.indexOf(l.writeId))&&(dc(l.path,e)||dc(e,l.path))},a=kX(t.allWrites,o,e),A=n||Ot.EMPTY_NODE;return Sg(a,A)}}}function dge(t,e,n){let r=Ot.EMPTY_NODE;const i=Yf(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(si,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(n){const s=kd(t.visibleWrites,e);return n.forEachChild(si,(o,a)=>{const A=Sg(kd(s,new ar(o)),a);r=r.updateImmediateChild(o,A)}),IH(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const s=kd(t.visibleWrites,e);return IH(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function hge(t,e,n,r,i){Fe(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=ii(e,n);if(BL(t.visibleWrites,s))return null;{const o=kd(t.visibleWrites,s);return LL(o)?i.getChild(n):Sg(o,i.getChild(n))}}function fge(t,e,n,r){const i=ii(e,n),s=Yf(t.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(n)){const o=kd(t.visibleWrites,i);return Sg(o,r.getNode().getImmediateChild(n))}else return null}function pge(t,e){return Yf(t.visibleWrites,e)}function mge(t,e,n,r,i,s,o){let a;const A=kd(t.visibleWrites,e),l=Yf(A,Mn());if(l!=null)a=l;else if(n!=null)a=Sg(A,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const d=[],f=o.getCompare(),p=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let g=p.getNext();for(;g&&d.length<i;)f(g,r)!==0&&d.push(g),g=p.getNext();return d}else return[]}function gge(){return{visibleWrites:Jc.empty(),allWrites:[],lastWriteId:-1}}function zS(t,e,n,r){return xX(t.writeTree,t.treePath,e,n,r)}function Gk(t,e){return dge(t.writeTree,t.treePath,e)}function RH(t,e,n,r){return hge(t.writeTree,t.treePath,e,n,r)}function qS(t,e){return pge(t.writeTree,ii(t.treePath,e))}function _ge(t,e,n,r,i,s){return mge(t.writeTree,t.treePath,e,n,r,i,s)}function Wk(t,e,n){return fge(t.writeTree,t.treePath,e,n)}function MX(t,e){return FX(ii(t.treePath,e),t.writeTree)}function FX(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ege{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;Fe(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),Fe(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const s=i.type;if(n==="child_added"&&s==="child_removed")this.changeMap.set(r,ov(r,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&s==="child_changed")this.changeMap.set(r,sv(r,i.oldSnap));else if(n==="child_changed"&&s==="child_added")this.changeMap.set(r,Cg(r,e.snapshotNode));else if(n==="child_changed"&&s==="child_changed")this.changeMap.set(r,ov(r,e.snapshotNode,i.oldSnap));else throw qg("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yge{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const VX=new yge;class zk{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Zd(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Wk(this.writes_,e,r)}}getChildAfterChild(e,n,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Mf(this.viewCache_),s=_ge(this.writes_,i,n,1,r,e);return s.length===0?null:s[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vge(t){return{filter:t}}function wge(t,e){Fe(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),Fe(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function Cge(t,e,n,r,i){const s=new Ege;let o,a;if(n.type===qc.OVERWRITE){const l=n;l.source.fromUser?o=PL(t,e,l.path,l.snap,r,i,s):(Fe(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!ln(l.path),o=YS(t,e,l.path,l.snap,r,i,a,s))}else if(n.type===qc.MERGE){const l=n;l.source.fromUser?o=Sge(t,e,l.path,l.children,r,i,s):(Fe(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=UL(t,e,l.path,l.children,r,i,a,s))}else if(n.type===qc.ACK_USER_WRITE){const l=n;l.revert?o=Rge(t,e,l.path,r,i,s):o=bge(t,e,l.path,l.affectedTree,r,i,s)}else if(n.type===qc.LISTEN_COMPLETE)o=Ige(t,e,n.path,r,s);else throw qg("Unknown operation type: "+n.type);const A=s.getChanges();return Tge(e,o,A),{viewCache:o,changes:A}}function Tge(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=WS(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(LX(WS(e)))}}function QX(t,e,n,r,i,s){const o=e.eventCache;if(qS(r,n)!=null)return e;{let a,A;if(ln(n))if(Fe(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const l=Mf(e),d=l instanceof Ot?l:Ot.EMPTY_NODE,f=Gk(r,d);a=t.filter.updateFullNode(e.eventCache.getNode(),f,s)}else{const l=zS(r,Mf(e));a=t.filter.updateFullNode(e.eventCache.getNode(),l,s)}else{const l=rn(n);if(l===".priority"){Fe($d(n)===1,"Can't have a priority with additional path components");const d=o.getNode();A=e.serverCache.getNode();const f=RH(r,n,d,A);f!=null?a=t.filter.updatePriority(d,f):a=o.getNode()}else{const d=Tr(n);let f;if(o.isCompleteForChild(l)){A=e.serverCache.getNode();const p=RH(r,n,o.getNode(),A);p!=null?f=o.getNode().getImmediateChild(l).updateChild(d,p):f=o.getNode().getImmediateChild(l)}else f=Wk(r,l,e.serverCache);f!=null?a=t.filter.updateChild(o.getNode(),l,f,d,i,s):a=o.getNode()}}return Sy(e,a,o.isFullyInitialized()||ln(n),t.filter.filtersNodes())}}function YS(t,e,n,r,i,s,o,a){const A=e.serverCache;let l;const d=o?t.filter:t.filter.getIndexedFilter();if(ln(n))l=d.updateFullNode(A.getNode(),r,null);else if(d.filtersNodes()&&!A.isFiltered()){const g=A.getNode().updateChild(n,r);l=d.updateFullNode(A.getNode(),g,null)}else{const g=rn(n);if(!A.isCompleteForPath(n)&&$d(n)>1)return e;const y=Tr(n),w=A.getNode().getImmediateChild(g).updateChild(y,r);g===".priority"?l=d.updatePriority(A.getNode(),w):l=d.updateChild(A.getNode(),g,w,y,VX,null)}const f=PX(e,l,A.isFullyInitialized()||ln(n),d.filtersNodes()),p=new zk(i,f,s);return QX(t,f,n,i,p,a)}function PL(t,e,n,r,i,s,o){const a=e.eventCache;let A,l;const d=new zk(i,e,s);if(ln(n))l=t.filter.updateFullNode(e.eventCache.getNode(),r,o),A=Sy(e,l,!0,t.filter.filtersNodes());else{const f=rn(n);if(f===".priority")l=t.filter.updatePriority(e.eventCache.getNode(),r),A=Sy(e,l,a.isFullyInitialized(),a.isFiltered());else{const p=Tr(n),g=a.getNode().getImmediateChild(f);let y;if(ln(p))y=r;else{const E=d.getCompleteChild(f);E!=null?kk(p)===".priority"&&E.getChild(bX(p)).isEmpty()?y=E:y=E.updateChild(p,r):y=Ot.EMPTY_NODE}if(g.equals(y))A=e;else{const E=t.filter.updateChild(a.getNode(),f,y,p,d,o);A=Sy(e,E,a.isFullyInitialized(),t.filter.filtersNodes())}}}return A}function OH(t,e){return t.eventCache.isCompleteForChild(e)}function Sge(t,e,n,r,i,s,o){let a=e;return r.foreach((A,l)=>{const d=ii(n,A);OH(e,rn(d))&&(a=PL(t,a,d,l,i,s,o))}),r.foreach((A,l)=>{const d=ii(n,A);OH(e,rn(d))||(a=PL(t,a,d,l,i,s,o))}),a}function NH(t,e,n){return n.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function UL(t,e,n,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let A=e,l;ln(n)?l=r:l=new Nr(null).setTree(n,r);const d=e.serverCache.getNode();return l.children.inorderTraversal((f,p)=>{if(d.hasChild(f)){const g=e.serverCache.getNode().getImmediateChild(f),y=NH(t,g,p);A=YS(t,A,new ar(f),y,i,s,o,a)}}),l.children.inorderTraversal((f,p)=>{const g=!e.serverCache.isCompleteForChild(f)&&p.value===null;if(!d.hasChild(f)&&!g){const y=e.serverCache.getNode().getImmediateChild(f),E=NH(t,y,p);A=YS(t,A,new ar(f),E,i,s,o,a)}}),A}function bge(t,e,n,r,i,s,o){if(qS(i,n)!=null)return e;const a=e.serverCache.isFiltered(),A=e.serverCache;if(r.value!=null){if(ln(n)&&A.isFullyInitialized()||A.isCompleteForPath(n))return YS(t,e,n,A.getNode().getChild(n),i,s,a,o);if(ln(n)){let l=new Nr(null);return A.getNode().forEachChild(Jm,(d,f)=>{l=l.set(new ar(d),f)}),UL(t,e,n,l,i,s,a,o)}else return e}else{let l=new Nr(null);return r.foreach((d,f)=>{const p=ii(n,d);A.isCompleteForPath(p)&&(l=l.set(d,A.getNode().getChild(p)))}),UL(t,e,n,l,i,s,a,o)}}function Ige(t,e,n,r,i){const s=e.serverCache,o=PX(e,s.getNode(),s.isFullyInitialized()||ln(n),s.isFiltered());return QX(t,o,n,r,VX,i)}function Rge(t,e,n,r,i,s){let o;if(qS(r,n)!=null)return e;{const a=new zk(r,e,i),A=e.eventCache.getNode();let l;if(ln(n)||rn(n)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=zS(r,Mf(e));else{const f=e.serverCache.getNode();Fe(f instanceof Ot,"serverChildren would be complete if leaf node"),d=Gk(r,f)}d=d,l=t.filter.updateFullNode(A,d,s)}else{const d=rn(n);let f=Wk(r,d,e.serverCache);f==null&&e.serverCache.isCompleteForChild(d)&&(f=A.getImmediateChild(d)),f!=null?l=t.filter.updateChild(A,d,f,Tr(n),a,s):e.eventCache.getNode().hasChild(d)?l=t.filter.updateChild(A,d,Ot.EMPTY_NODE,Tr(n),a,s):l=A,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=zS(r,Mf(e)),o.isLeafNode()&&(l=t.filter.updateFullNode(l,o,s)))}return o=e.serverCache.isFullyInitialized()||qS(r,Mn())!=null,Sy(e,l,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oge{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,i=new Vk(r.getIndex()),s=zme(r);this.processor_=vge(s);const o=n.serverCache,a=n.eventCache,A=i.updateFullNode(Ot.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(Ot.EMPTY_NODE,a.getNode(),null),d=new Zd(A,o.isFullyInitialized(),i.filtersNodes()),f=new Zd(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=pI(f,d),this.eventGenerator_=new ege(this.query_)}get query(){return this.query_}}function Nge(t){return t.viewCache_.serverCache.getNode()}function Dge(t){return WS(t.viewCache_)}function Bge(t,e){const n=Mf(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!ln(e)&&!n.getImmediateChild(rn(e)).isEmpty())?n.getChild(e):null}function DH(t){return t.eventRegistrations_.length===0}function Lge(t,e){t.eventRegistrations_.push(e)}function BH(t,e,n){const r=[];if(n){Fe(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(n,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<t.eventRegistrations_.length;++s){const o=t.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(s+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return r}function LH(t,e,n,r){e.type===qc.MERGE&&e.source.queryId!==null&&(Fe(Mf(t.viewCache_),"We should always have a full cache before handling merges"),Fe(WS(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,s=Cge(t.processor_,i,e,n,r);return wge(t.processor_,s.viewCache),Fe(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=s.viewCache,HX(t,s.changes,s.viewCache.eventCache.getNode(),null)}function Pge(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(si,(s,o)=>{r.push(Cg(s,o))}),n.isFullyInitialized()&&r.push(LX(n.getNode())),HX(t,r,n.getNode(),e)}function HX(t,e,n,r){const i=r?[r]:t.eventRegistrations_;return tge(t.eventGenerator_,e,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let XS;class jX{constructor(){this.views=new Map}}function Uge(t){Fe(!XS,"__referenceConstructor has already been defined"),XS=t}function kge(){return Fe(XS,"Reference.ts has not been loaded"),XS}function xge(t){return t.views.size===0}function qk(t,e,n,r){const i=e.source.queryId;if(i!==null){const s=t.views.get(i);return Fe(s!=null,"SyncTree gave us an op for an invalid query."),LH(s,e,n,r)}else{let s=[];for(const o of t.views.values())s=s.concat(LH(o,e,n,r));return s}}function KX(t,e,n,r,i){const s=e._queryIdentifier,o=t.views.get(s);if(!o){let a=zS(n,i?r:null),A=!1;a?A=!0:r instanceof Ot?(a=Gk(n,r),A=!1):(a=Ot.EMPTY_NODE,A=!1);const l=pI(new Zd(a,A,!1),new Zd(r,i,!1));return new Oge(e,l)}return o}function Mge(t,e,n,r,i,s){const o=KX(t,e,r,i,s);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),Lge(o,n),Pge(o,n)}function Fge(t,e,n,r){const i=e._queryIdentifier,s=[];let o=[];const a=eh(t);if(i==="default")for(const[A,l]of t.views.entries())o=o.concat(BH(l,n,r)),DH(l)&&(t.views.delete(A),l.query._queryParams.loadsAllData()||s.push(l.query));else{const A=t.views.get(i);A&&(o=o.concat(BH(A,n,r)),DH(A)&&(t.views.delete(i),A.query._queryParams.loadsAllData()||s.push(A.query)))}return a&&!eh(t)&&s.push(new(kge())(e._repo,e._path)),{removed:s,events:o}}function GX(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function xd(t,e){let n=null;for(const r of t.views.values())n=n||Bge(r,e);return n}function WX(t,e){if(e._queryParams.loadsAllData())return gI(t);{const r=e._queryIdentifier;return t.views.get(r)}}function zX(t,e){return WX(t,e)!=null}function eh(t){return gI(t)!=null}function gI(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let JS;function Vge(t){Fe(!JS,"__referenceConstructor has already been defined"),JS=t}function Qge(){return Fe(JS,"Reference.ts has not been loaded"),JS}let Hge=1;class PH{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Nr(null),this.pendingWriteTree_=gge(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function qX(t,e,n,r,i){return sge(t.pendingWriteTree_,e,n,r,i),i?i_(t,new xf(Hk(),e,n)):[]}function jge(t,e,n,r){oge(t.pendingWriteTree_,e,n,r);const i=Nr.fromObject(n);return i_(t,new Tg(Hk(),e,i))}function Cd(t,e,n=!1){const r=age(t.pendingWriteTree_,e);if(cge(t.pendingWriteTree_,e)){let s=new Nr(null);return r.snap!=null?s=s.set(Mn(),!0):Ds(r.children,o=>{s=s.set(new ar(o),!0)}),i_(t,new GS(r.path,s,n))}else return[]}function iw(t,e,n){return i_(t,new xf(jk(),e,n))}function Kge(t,e,n){const r=Nr.fromObject(n);return i_(t,new Tg(jk(),e,r))}function Gge(t,e){return i_(t,new cv(jk(),e))}function Wge(t,e,n){const r=Xk(t,n);if(r){const i=Jk(r),s=i.path,o=i.queryId,a=Ro(s,e),A=new cv(Kk(o),a);return $k(t,s,A)}else return[]}function $S(t,e,n,r,i=!1){const s=e._path,o=t.syncPointTree_.get(s);let a=[];if(o&&(e._queryIdentifier==="default"||zX(o,e))){const A=Fge(o,e,n,r);xge(o)&&(t.syncPointTree_=t.syncPointTree_.remove(s));const l=A.removed;if(a=A.events,!i){const d=l.findIndex(p=>p._queryParams.loadsAllData())!==-1,f=t.syncPointTree_.findOnPath(s,(p,g)=>eh(g));if(d&&!f){const p=t.syncPointTree_.subtree(s);if(!p.isEmpty()){const g=Yge(p);for(let y=0;y<g.length;++y){const E=g[y],w=E.query,b=$X(t,E);t.listenProvider_.startListening(Iy(w),Av(t,w),b.hashFn,b.onComplete)}}}!f&&l.length>0&&!r&&(d?t.listenProvider_.stopListening(Iy(e),null):l.forEach(p=>{const g=t.queryToTagMap.get(_I(p));t.listenProvider_.stopListening(Iy(p),g)}))}Xge(t,l)}return a}function YX(t,e,n,r){const i=Xk(t,r);if(i!=null){const s=Jk(i),o=s.path,a=s.queryId,A=Ro(o,e),l=new xf(Kk(a),A,n);return $k(t,o,l)}else return[]}function zge(t,e,n,r){const i=Xk(t,r);if(i){const s=Jk(i),o=s.path,a=s.queryId,A=Ro(o,e),l=Nr.fromObject(n),d=new Tg(Kk(a),A,l);return $k(t,o,d)}else return[]}function kL(t,e,n,r=!1){const i=e._path;let s=null,o=!1;t.syncPointTree_.foreachOnPath(i,(p,g)=>{const y=Ro(p,i);s=s||xd(g,y),o=o||eh(g)});let a=t.syncPointTree_.get(i);a?(o=o||eh(a),s=s||xd(a,Mn())):(a=new jX,t.syncPointTree_=t.syncPointTree_.set(i,a));let A;s!=null?A=!0:(A=!1,s=Ot.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((g,y)=>{const E=xd(y,Mn());E&&(s=s.updateImmediateChild(g,E))}));const l=zX(a,e);if(!l&&!e._queryParams.loadsAllData()){const p=_I(e);Fe(!t.queryToTagMap.has(p),"View does not exist, but we have a tag");const g=Jge();t.queryToTagMap.set(p,g),t.tagToQueryMap.set(g,p)}const d=mI(t.pendingWriteTree_,i);let f=Mge(a,e,n,d,s,A);if(!l&&!o&&!r){const p=WX(a,e);f=f.concat($ge(t,e,p))}return f}function Yk(t,e,n){const i=t.pendingWriteTree_,s=t.syncPointTree_.findOnPath(e,(o,a)=>{const A=Ro(o,e),l=xd(a,A);if(l)return l});return xX(i,e,s,n,!0)}function qge(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(l,d)=>{const f=Ro(l,n);r=r||xd(d,f)});let i=t.syncPointTree_.get(n);i?r=r||xd(i,Mn()):(i=new jX,t.syncPointTree_=t.syncPointTree_.set(n,i));const s=r!=null,o=s?new Zd(r,!0,!1):null,a=mI(t.pendingWriteTree_,e._path),A=KX(i,e,a,s?o.getNode():Ot.EMPTY_NODE,s);return Dge(A)}function i_(t,e){return XX(e,t.syncPointTree_,null,mI(t.pendingWriteTree_,Mn()))}function XX(t,e,n,r){if(ln(t.path))return JX(t,e,n,r);{const i=e.get(Mn());n==null&&i!=null&&(n=xd(i,Mn()));let s=[];const o=rn(t.path),a=t.operationForChild(o),A=e.children.get(o);if(A&&a){const l=n?n.getImmediateChild(o):null,d=MX(r,o);s=s.concat(XX(a,A,l,d))}return i&&(s=s.concat(qk(i,t,r,n))),s}}function JX(t,e,n,r){const i=e.get(Mn());n==null&&i!=null&&(n=xd(i,Mn()));let s=[];return e.children.inorderTraversal((o,a)=>{const A=n?n.getImmediateChild(o):null,l=MX(r,o),d=t.operationForChild(o);d&&(s=s.concat(JX(d,a,A,l)))}),i&&(s=s.concat(qk(i,t,r,n))),s}function $X(t,e){const n=e.query,r=Av(t,n);return{hashFn:()=>(Nge(e)||Ot.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?Wge(t,n._path,r):Gge(t,n._path);{const s=Gpe(i,n);return $S(t,n,null,s)}}}}function Av(t,e){const n=_I(e);return t.queryToTagMap.get(n)}function _I(t){return t._path.toString()+"$"+t._queryIdentifier}function Xk(t,e){return t.tagToQueryMap.get(e)}function Jk(t){const e=t.indexOf("$");return Fe(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new ar(t.substr(0,e))}}function $k(t,e,n){const r=t.syncPointTree_.get(e);Fe(r,"Missing sync point for query tag that we're tracking");const i=mI(t.pendingWriteTree_,e);return qk(r,n,i,null)}function Yge(t){return t.fold((e,n,r)=>{if(n&&eh(n))return[gI(n)];{let i=[];return n&&(i=GX(n)),Ds(r,(s,o)=>{i=i.concat(o)}),i}})}function Iy(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(Qge())(t._repo,t._path):t}function Xge(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const i=_I(r),s=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(s)}}}function Jge(){return Hge++}function $ge(t,e,n){const r=e._path,i=Av(t,e),s=$X(t,n),o=t.listenProvider_.startListening(Iy(e),i,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(r);if(i)Fe(!eh(a.value),"If we're adding a query, it shouldn't be shadowed");else{const A=a.fold((l,d,f)=>{if(!ln(l)&&d&&eh(d))return[gI(d).query];{let p=[];return d&&(p=p.concat(GX(d).map(g=>g.query))),Ds(f,(g,y)=>{p=p.concat(y)}),p}});for(let l=0;l<A.length;++l){const d=A[l];t.listenProvider_.stopListening(Iy(d),Av(t,d))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zk{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new Zk(n)}node(){return this.node_}}class ex{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=ii(this.path_,e);return new ex(this.syncTree_,n)}node(){return Yk(this.syncTree_,this.path_)}}const Zge=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},UH=function(t,e,n){if(!t||typeof t!="object")return t;if(Fe(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return e_e(t[".sv"],e,n);if(typeof t[".sv"]=="object")return t_e(t[".sv"],e);Fe(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},e_e=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:Fe(!1,"Unexpected server value: "+t)}},t_e=function(t,e,n){t.hasOwnProperty("increment")||Fe(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&Fe(!1,"Unexpected increment value: "+r);const i=e.node();if(Fe(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const o=i.getValue();return typeof o!="number"?r:o+r},ZX=function(t,e,n,r){return tx(e,new ex(n,t),r)},eJ=function(t,e,n){return tx(t,new Zk(e),n)};function tx(t,e,n){const r=t.getPriority().val(),i=UH(r,e.getImmediateChild(".priority"),n);let s;if(t.isLeafNode()){const o=t,a=UH(o.getValue(),e,n);return a!==o.getValue()||i!==o.getPriority().val()?new ys(a,Ei(i)):t}else{const o=t;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new ys(i))),o.forEachChild(si,(a,A)=>{const l=tx(A,e.getImmediateChild(a),n);l!==A&&(s=s.updateImmediateChild(a,l))}),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nx{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function rx(t,e){let n=e instanceof ar?e:new ar(e),r=t,i=rn(n);for(;i!==null;){const s=ug(r.node.children,i)||{children:{},childCount:0};r=new nx(i,r,s),n=Tr(n),i=rn(n)}return r}function s_(t){return t.node.value}function tJ(t,e){t.node.value=e,xL(t)}function nJ(t){return t.node.childCount>0}function n_e(t){return s_(t)===void 0&&!nJ(t)}function EI(t,e){Ds(t.node.children,(n,r)=>{e(new nx(n,t,r))})}function rJ(t,e,n,r){n&&e(t),EI(t,i=>{rJ(i,e,!0)})}function r_e(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function sw(t){return new ar(t.parent===null?t.name:sw(t.parent)+"/"+t.name)}function xL(t){t.parent!==null&&i_e(t.parent,t.name,t)}function i_e(t,e,n){const r=n_e(n),i=ol(t.node.children,e);r&&i?(delete t.node.children[e],t.node.childCount--,xL(t)):!r&&!i&&(t.node.children[e]=n.node,t.node.childCount++,xL(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s_e=/[\[\].#$\/\u0000-\u001F\u007F]/,o_e=/[\[\].#$\u0000-\u001F\u007F]/,qN=10*1024*1024,ix=function(t){return typeof t=="string"&&t.length!==0&&!s_e.test(t)},iJ=function(t){return typeof t=="string"&&t.length!==0&&!o_e.test(t)},a_e=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),iJ(t)},sJ=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!hI(t)||t&&typeof t=="object"&&ol(t,".sv")},ZS=function(t,e,n,r){r&&e===void 0||yI(dg(t,"value"),e,n)},yI=function(t,e,n){const r=n instanceof ar?new Sme(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Zh(r));if(typeof e=="function")throw new Error(t+"contains a function "+Zh(r)+" with contents = "+e.toString());if(hI(e))throw new Error(t+"contains "+e.toString()+" "+Zh(r));if(typeof e=="string"&&e.length>qN/3&&Yb(e)>qN)throw new Error(t+"contains a string greater than "+qN+" utf8 bytes "+Zh(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(Ds(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!ix(o)))throw new Error(t+" contains an invalid key ("+o+") "+Zh(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);bme(r,o),yI(t,a,r),Ime(r)}),i&&s)throw new Error(t+' contains ".value" child '+Zh(r)+" in addition to actual children.")}},c_e=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const s=iv(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!ix(s[o]))throw new Error(t+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Tme);let i=null;for(n=0;n<e.length;n++){if(r=e[n],i!==null&&dc(i,r))throw new Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},oJ=function(t,e,n,r){const i=dg(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const s=[];Ds(e,(o,a)=>{const A=new ar(o);if(yI(i,a,ii(n,A)),kk(A)===".priority"&&!sJ(a))throw new Error(i+"contains an invalid value for '"+A.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(A)}),c_e(i,s)},A_e=function(t,e,n){if(hI(e))throw new Error(dg(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!sJ(e))throw new Error(dg(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},aJ=function(t,e,n,r){if(!iJ(n))throw new Error(dg(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},l_e=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),aJ(t,e,n)},hf=function(t,e){if(rn(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},u_e=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!ix(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!a_e(n))throw new Error(dg(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_e{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function vI(t,e){let n=null;for(let r=0;r<e.length;r++){const i=e[r],s=i.getPath();n!==null&&!xk(s,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:s}),n.events.push(i)}n&&t.eventLists_.push(n)}function cJ(t,e,n){vI(t,n),AJ(t,r=>xk(r,e))}function Ec(t,e,n){vI(t,n),AJ(t,r=>dc(r,e)||dc(e,r))}function AJ(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const i=t.eventLists_[r];if(i){const s=i.path;e(s)?(h_e(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function h_e(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();Cy&&Ss("event: "+n.toString()),n_(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f_e="repo_interrupt",p_e=25;class m_e{constructor(e,n,r,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new d_e,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=KS(),this.transactionQueueTree_=new nx,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function g_e(t,e,n){if(t.stats_=Pk(t.repoInfo_),t.forceRestClient_||Ype())t.server_=new jS(t.repoInfo_,(r,i,s,o)=>{kH(t,r,i,s,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>xH(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{As(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new iu(t.repoInfo_,e,(r,i,s,o)=>{kH(t,r,i,s,o)},r=>{xH(t,r)},r=>{__e(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=eme(t.repoInfo_,()=>new Zme(t.stats_,t.server_)),t.infoData_=new qme,t.infoSyncTree_=new PH({startListening:(r,i,s,o)=>{let a=[];const A=t.infoData_.getNode(r._path);return A.isEmpty()||(a=iw(t.infoSyncTree_,r._path,A),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),sx(t,"connected",!1),t.serverSyncTree_=new PH({startListening:(r,i,s,o)=>(t.server_.listen(r,s,i,(a,A)=>{const l=o(a,A);Ec(t.eventQueue_,r._path,l)}),[]),stopListening:(r,i)=>{t.server_.unlisten(r,i)}})}function lJ(t){const n=t.infoData_.getNode(new ar(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function wI(t){return Zge({timestamp:lJ(t)})}function kH(t,e,n,r,i){t.dataUpdateCount++;const s=new ar(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(i)if(r){const A=vS(n,l=>Ei(l));o=zge(t.serverSyncTree_,s,A,i)}else{const A=Ei(n);o=YX(t.serverSyncTree_,s,A,i)}else if(r){const A=vS(n,l=>Ei(l));o=Kge(t.serverSyncTree_,s,A)}else{const A=Ei(n);o=iw(t.serverSyncTree_,s,A)}let a=s;o.length>0&&(a=bg(t,s)),Ec(t.eventQueue_,a,o)}function xH(t,e){sx(t,"connected",e),e===!1&&w_e(t)}function __e(t,e){Ds(e,(n,r)=>{sx(t,n,r)})}function sx(t,e,n){const r=new ar("/.info/"+e),i=Ei(n);t.infoData_.updateSnapshot(r,i);const s=iw(t.infoSyncTree_,r,i);Ec(t.eventQueue_,r,s)}function ox(t){return t.nextWriteId_++}function E_e(t,e,n){const r=qge(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(i=>{const s=Ei(i).withIndex(e._queryParams.getIndex());kL(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=iw(t.serverSyncTree_,e._path,s);else{const a=Av(t.serverSyncTree_,e);o=YX(t.serverSyncTree_,e._path,s,a)}return Ec(t.eventQueue_,e._path,o),$S(t.serverSyncTree_,e,n,null,!0),s},i=>(ow(t,"get for query "+As(e)+" failed: "+i),Promise.reject(new Error(i))))}function y_e(t,e,n,r,i){ow(t,"set",{path:e.toString(),value:n,priority:r});const s=wI(t),o=Ei(n,r),a=Yk(t.serverSyncTree_,e),A=eJ(o,a,s),l=ox(t),d=qX(t.serverSyncTree_,e,A,l,!0);vI(t.eventQueue_,d),t.server_.put(e.toString(),o.val(!0),(p,g)=>{const y=p==="ok";y||No("set at "+e+" failed: "+p);const E=Cd(t.serverSyncTree_,l,!y);Ec(t.eventQueue_,e,E),th(t,i,p,g)});const f=cx(t,e);bg(t,f),Ec(t.eventQueue_,f,[])}function v_e(t,e,n,r){ow(t,"update",{path:e.toString(),value:n});let i=!0;const s=wI(t),o={};if(Ds(n,(a,A)=>{i=!1,o[a]=ZX(ii(e,a),Ei(A),t.serverSyncTree_,s)}),i)Ss("update() called with empty data.  Don't do anything."),th(t,r,"ok",void 0);else{const a=ox(t),A=jge(t.serverSyncTree_,e,o,a);vI(t.eventQueue_,A),t.server_.merge(e.toString(),n,(l,d)=>{const f=l==="ok";f||No("update at "+e+" failed: "+l);const p=Cd(t.serverSyncTree_,a,!f),g=p.length>0?bg(t,e):e;Ec(t.eventQueue_,g,p),th(t,r,l,d)}),Ds(n,l=>{const d=cx(t,ii(e,l));bg(t,d)}),Ec(t.eventQueue_,e,[])}}function w_e(t){ow(t,"onDisconnectEvents");const e=wI(t),n=KS();NL(t.onDisconnect_,Mn(),(i,s)=>{const o=ZX(i,s,t.serverSyncTree_,e);r_(n,i,o)});let r=[];NL(n,Mn(),(i,s)=>{r=r.concat(iw(t.serverSyncTree_,i,s));const o=cx(t,i);bg(t,o)}),t.onDisconnect_=KS(),Ec(t.eventQueue_,Mn(),r)}function C_e(t,e,n){t.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&OL(t.onDisconnect_,e),th(t,n,r,i)})}function MH(t,e,n,r){const i=Ei(n);t.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&r_(t.onDisconnect_,e,i),th(t,r,s,o)})}function T_e(t,e,n,r,i){const s=Ei(n,r);t.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&r_(t.onDisconnect_,e,s),th(t,i,o,a)})}function S_e(t,e,n,r){if(yS(n)){Ss("onDisconnect().update() called with empty data.  Don't do anything."),th(t,r,"ok",void 0);return}t.server_.onDisconnectMerge(e.toString(),n,(i,s)=>{i==="ok"&&Ds(n,(o,a)=>{const A=Ei(a);r_(t.onDisconnect_,ii(e,o),A)}),th(t,r,i,s)})}function b_e(t,e,n){let r;rn(e._path)===".info"?r=kL(t.infoSyncTree_,e,n):r=kL(t.serverSyncTree_,e,n),cJ(t.eventQueue_,e._path,r)}function I_e(t,e,n){let r;rn(e._path)===".info"?r=$S(t.infoSyncTree_,e,n):r=$S(t.serverSyncTree_,e,n),cJ(t.eventQueue_,e._path,r)}function R_e(t){t.persistentConnection_&&t.persistentConnection_.interrupt(f_e)}function ow(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Ss(n,...e)}function th(t,e,n,r){e&&n_(()=>{if(n==="ok")e(null);else{const i=(n||"error").toUpperCase();let s=i;r&&(s+=": "+r);const o=new Error(s);o.code=i,e(o)}})}function uJ(t,e,n){return Yk(t.serverSyncTree_,e,n)||Ot.EMPTY_NODE}function ax(t,e=t.transactionQueueTree_){if(e||CI(t,e),s_(e)){const n=hJ(t,e);Fe(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&O_e(t,sw(e),n)}else nJ(e)&&EI(e,n=>{ax(t,n)})}function O_e(t,e,n){const r=n.map(l=>l.currentWriteId),i=uJ(t,e,r);let s=i;const o=i.hash();for(let l=0;l<n.length;l++){const d=n[l];Fe(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const f=Ro(e,d.path);s=s.updateChild(f,d.currentOutputSnapshotRaw)}const a=s.val(!0),A=e;t.server_.put(A.toString(),a,l=>{ow(t,"transaction put response",{path:A.toString(),status:l});let d=[];if(l==="ok"){const f=[];for(let p=0;p<n.length;p++)n[p].status=2,d=d.concat(Cd(t.serverSyncTree_,n[p].currentWriteId)),n[p].onComplete&&f.push(()=>n[p].onComplete(null,!0,n[p].currentOutputSnapshotResolved)),n[p].unwatcher();CI(t,rx(t.transactionQueueTree_,e)),ax(t,t.transactionQueueTree_),Ec(t.eventQueue_,e,d);for(let p=0;p<f.length;p++)n_(f[p])}else{if(l==="datastale")for(let f=0;f<n.length;f++)n[f].status===3?n[f].status=4:n[f].status=0;else{No("transaction at "+A.toString()+" failed: "+l);for(let f=0;f<n.length;f++)n[f].status=4,n[f].abortReason=l}bg(t,e)}},o)}function bg(t,e){const n=dJ(t,e),r=sw(n),i=hJ(t,n);return N_e(t,i,r),r}function N_e(t,e,n){if(e.length===0)return;const r=[];let i=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const A=e[a],l=Ro(n,A.path);let d=!1,f;if(Fe(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),A.status===4)d=!0,f=A.abortReason,i=i.concat(Cd(t.serverSyncTree_,A.currentWriteId,!0));else if(A.status===0)if(A.retryCount>=p_e)d=!0,f="maxretry",i=i.concat(Cd(t.serverSyncTree_,A.currentWriteId,!0));else{const p=uJ(t,A.path,o);A.currentInputSnapshot=p;const g=e[a].update(p.val());if(g!==void 0){yI("transaction failed: Data returned ",g,A.path);let y=Ei(g);typeof g=="object"&&g!=null&&ol(g,".priority")||(y=y.updatePriority(p.getPriority()));const w=A.currentWriteId,b=wI(t),I=eJ(y,p,b);A.currentOutputSnapshotRaw=y,A.currentOutputSnapshotResolved=I,A.currentWriteId=ox(t),o.splice(o.indexOf(w),1),i=i.concat(qX(t.serverSyncTree_,A.path,I,A.currentWriteId,A.applyLocally)),i=i.concat(Cd(t.serverSyncTree_,w,!0))}else d=!0,f="nodata",i=i.concat(Cd(t.serverSyncTree_,A.currentWriteId,!0))}Ec(t.eventQueue_,n,i),i=[],d&&(e[a].status=2,function(p){setTimeout(p,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}CI(t,t.transactionQueueTree_);for(let a=0;a<r.length;a++)n_(r[a]);ax(t,t.transactionQueueTree_)}function dJ(t,e){let n,r=t.transactionQueueTree_;for(n=rn(e);n!==null&&s_(r)===void 0;)r=rx(r,n),e=Tr(e),n=rn(e);return r}function hJ(t,e){const n=[];return fJ(t,e,n),n.sort((r,i)=>r.order-i.order),n}function fJ(t,e,n){const r=s_(e);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);EI(e,i=>{fJ(t,i,n)})}function CI(t,e){const n=s_(e);if(n){let r=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[r]=n[i],r++);n.length=r,tJ(e,n.length>0?n:void 0)}EI(e,r=>{CI(t,r)})}function cx(t,e){const n=sw(dJ(t,e)),r=rx(t.transactionQueueTree_,e);return r_e(r,i=>{YN(t,i)}),YN(t,r),rJ(r,i=>{YN(t,i)}),n}function YN(t,e){const n=s_(e);if(n){const r=[];let i=[],s=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(Fe(s===o-1,"All SENT items should be at beginning of queue."),s=o,n[o].status=3,n[o].abortReason="set"):(Fe(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat(Cd(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?tJ(e,void 0):n.length=s+1,Ec(t.eventQueue_,sw(e),i);for(let o=0;o<r.length;o++)n_(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D_e(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function B_e(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):No(`Invalid query segment '${n}' in query '${t}'`)}return e}const FH=function(t,e){const n=L_e(t),r=n.namespace;n.domain==="firebase.com"&&pu(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&pu("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Vpe();const i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new gX(n.host,n.secure,r,i,e,"",r!==n.subdomain),path:new ar(n.pathString)}},L_e=function(t){let e="",n="",r="",i="",s="",o=!0,a="https",A=443;if(typeof t=="string"){let l=t.indexOf("//");l>=0&&(a=t.substring(0,l-1),t=t.substring(l+2));let d=t.indexOf("/");d===-1&&(d=t.length);let f=t.indexOf("?");f===-1&&(f=t.length),e=t.substring(0,Math.min(d,f)),d<f&&(i=D_e(t.substring(d,f)));const p=B_e(t.substring(Math.min(t.length,f)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",A=parseInt(e.substring(l+1),10)):l=e.length;const g=e.slice(0,l);if(g.toLowerCase()==="localhost")n="localhost";else if(g.split(".").length<=2)n=g;else{const y=e.indexOf(".");r=e.substring(0,y).toLowerCase(),n=e.substring(y+1),s=r}"ns"in p&&(s=p.ns)}return{host:e,port:A,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VH="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",P_e=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let i;const s=new Array(8);for(i=7;i>=0;i--)s[i]=VH.charAt(n%64),n=Math.floor(n/64);Fe(n===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=VH.charAt(e[i]);return Fe(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pJ{constructor(e,n,r,i){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+As(this.snapshot.exportVal())}}class mJ{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gJ{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return Fe(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U_e{constructor(e,n){this._repo=e,this._path=n}cancel(){const e=new FA;return C_e(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){hf("OnDisconnect.remove",this._path);const e=new FA;return MH(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){hf("OnDisconnect.set",this._path),ZS("OnDisconnect.set",e,this._path,!1);const n=new FA;return MH(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}setWithPriority(e,n){hf("OnDisconnect.setWithPriority",this._path),ZS("OnDisconnect.setWithPriority",e,this._path,!1),A_e("OnDisconnect.setWithPriority",n);const r=new FA;return T_e(this._repo,this._path,e,n,r.wrapCallback(()=>{})),r.promise}update(e){hf("OnDisconnect.update",this._path),oJ("OnDisconnect.update",e,this._path);const n=new FA;return S_e(this._repo,this._path,e,n.wrapCallback(()=>{})),n.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ax{constructor(e,n,r,i){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=i}get key(){return ln(this._path)?null:kk(this._path)}get ref(){return new al(this._repo,this._path)}get _queryIdentifier(){const e=TH(this._queryParams),n=Bk(e);return n==="{}"?"default":n}get _queryObject(){return TH(this._queryParams)}isEqual(e){if(e=ci(e),!(e instanceof Ax))return!1;const n=this._repo===e._repo,r=xk(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Cme(this._path)}}class al extends Ax{constructor(e,n){super(e,n,new Qk,!1)}get parent(){const e=bX(this._path);return e===null?null:new al(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Ig{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new ar(e),r=Rg(this.ref,e);return new Ig(this._node.getChild(n),r,si)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new Ig(i,Rg(this.ref,r),si)))}hasChild(e){const n=new ar(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Xe(t,e){return t=ci(t),t._checkNotDeleted("ref"),e!==void 0?Rg(t._root,e):t._root}function Rg(t,e){return t=ci(t),rn(t._path)===null?l_e("child","path",e):aJ("child","path",e),new al(t._repo,ii(t._path,e))}function QH(t){return t=ci(t),new U_e(t._repo,t._path)}function ML(t,e){t=ci(t),hf("push",t._path),ZS("push",e,t._path,!0);const n=lJ(t._repo),r=P_e(n),i=Rg(t,r),s=Rg(t,r);let o;return o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function ld(t){return hf("remove",t._path),Zr(t,null)}function Zr(t,e){t=ci(t),hf("set",t._path),ZS("set",e,t._path,!1);const n=new FA;return y_e(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function Jr(t,e){oJ("update",e,t._path);const n=new FA;return v_e(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Pi(t){t=ci(t);const e=new gJ(()=>{}),n=new TI(e);return E_e(t._repo,t,n).then(r=>new Ig(r,new al(t._repo,t._path),t._queryParams.getIndex()))}class TI{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new pJ("value",this,new Ig(e.snapshotNode,new al(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new mJ(this,e,n):null}matches(e){return e instanceof TI?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class lx{constructor(e,n){this.eventType=e,this.callbackContext=n}respondsTo(e){let n=e==="children_added"?"child_added":e;return n=n==="children_removed"?"child_removed":n,this.eventType===n}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new mJ(this,e,n):null}createEvent(e,n){Fe(e.childName!=null,"Child events should have a childName.");const r=Rg(new al(n._repo,n._path),e.childName),i=n._queryParams.getIndex();return new pJ(e.type,this,new Ig(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof lx?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function _J(t,e,n,r,i){const s=new gJ(n,void 0),o=e==="value"?new TI(s):new lx(e,s);return b_e(t._repo,t,o),()=>I_e(t._repo,t,o)}function ya(t,e,n,r){return _J(t,"value",e)}function k_e(t,e,n,r){return _J(t,"child_added",e)}Uge(al);Vge(al);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x_e="FIREBASE_DATABASE_EMULATOR_HOST",FL={};let M_e=!1;function F_e(t,e,n,r){const i=e.lastIndexOf(":"),s=e.substring(0,i),o=sl(s);t.repoInfo_=new gX(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function V_e(t,e,n,r,i){let s=r||t.options.databaseURL;s===void 0&&(t.options.projectId||pu("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ss("Using default host for project ",t.options.projectId),s=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=FH(s,i),a=o.repoInfo,A;typeof process<"u"&&oH&&(A=oH[x_e]),A?(s=`http://${A}?ns=${a.namespace}`,o=FH(s,i),a=o.repoInfo):o.repoInfo.secure;const l=new Jpe(t.name,t.options,e);u_e("Invalid Firebase Database URL",o),ln(o.path)||pu("Database URL must point to the root of a Firebase Database (not including a child path).");const d=H_e(a,t,l,new Xpe(t,n));return new j_e(d,t)}function Q_e(t,e){const n=FL[e];(!n||n[t.key]!==t)&&pu(`Database ${e}(${t.repoInfo_}) has already been deleted.`),R_e(t),delete n[t.key]}function H_e(t,e,n,r){let i=FL[e.name];i||(i={},FL[e.name]=i);let s=i[t.toURLString()];return s&&pu("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new m_e(t,M_e,n,r),i[t.toURLString()]=s,s}class j_e{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(g_e(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new al(this._repo,Mn())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Q_e(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&pu("Cannot call "+e+" on a deleted database.")}}function EJ(t=zv(),e){const n=yu(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=MU("database");r&&K_e(n,...r)}return n}function K_e(t,e,n,r={}){t=ci(t),t._checkNotDeleted("useEmulator");const i=`${e}:${n}`,s=t._repoInternal;if(t._instanceStarted){if(i===t._repoInternal.repoInfo_.host&&lu(r,s.repoInfo_.emulatorOptions))return;pu("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)r.mockUserToken&&pu('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new B0(B0.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:FU(r.mockUserToken,t.app.options.projectId);o=new B0(a)}sl(e)&&(zb(e),qb("Database",!0)),F_e(s,i,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G_e(t){Ppe(ah),_c(new Da("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return V_e(r,i,s,n)},"PUBLIC").setMultipleInstances(!0)),lo(aH,cH,t),lo(aH,cH,"esm2017")}iu.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};iu.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};G_e();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yJ="firebasestorage.googleapis.com",W_e="storageBucket",z_e=2*60*1e3,q_e=10*60*1e3,Y_e=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi extends yc{constructor(e,n,r=0){super(XN(e),`Firebase Storage: ${n} (${XN(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,wi.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return XN(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Kr;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Kr||(Kr={}));function XN(t){return"storage/"+t}function ux(){const t="An unknown error occurred, please check the error payload for server response.";return new wi(Kr.UNKNOWN,t)}function X_e(t){return new wi(Kr.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function J_e(t){return new wi(Kr.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function $_e(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new wi(Kr.UNAUTHENTICATED,t)}function Z_e(){return new wi(Kr.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function eEe(t){return new wi(Kr.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function vJ(){return new wi(Kr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function wJ(){return new wi(Kr.CANCELED,"User canceled the upload/download.")}function tEe(t){return new wi(Kr.INVALID_URL,"Invalid URL '"+t+"'.")}function nEe(t){return new wi(Kr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function CJ(){return new wi(Kr.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function rEe(){return new wi(Kr.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function iEe(){return new wi(Kr.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function sEe(t){return new wi(Kr.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function HH(t){return new wi(Kr.INVALID_ARGUMENT,t)}function TJ(){return new wi(Kr.APP_DELETED,"The Firebase app was deleted.")}function oEe(t){return new wi(Kr.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Ry(t,e){return new wi(Kr.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function TE(t){throw new wi(Kr.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=hc.makeFromUrl(e,n)}catch{return new hc(e,"")}if(r.path==="")return r;throw nEe(e)}static makeFromUrl(e,n){let r=null;const i="([A-Za-z0-9.\\-_]+)";function s(U){U.path.charAt(U.path.length-1)==="/"&&(U.path_=U.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),A={bucket:1,path:3};function l(U){U.path_=decodeURIComponent(U.path)}const d="v[A-Za-z0-9_]+",f=n.replace(/[.]/g,"\\."),p="(/([^?#]*).*)?$",g=new RegExp(`^https?://${f}/${d}/b/${i}/o${p}`,"i"),y={bucket:1,path:3},E=n===yJ?"(?:storage.googleapis.com|storage.cloud.google.com)":n,w="([^?#]*)",b=new RegExp(`^https?://${E}/${i}/${w}`,"i"),B=[{regex:a,indices:A,postModify:s},{regex:g,indices:y,postModify:l},{regex:b,indices:{bucket:1,path:2},postModify:l}];for(let U=0;U<B.length;U++){const H=B[U],K=H.regex.exec(e);if(K){const x=K[H.indices.bucket];let V=K[H.indices.path];V||(V=""),r=new hc(x,V),H.postModify(r);break}}if(r==null)throw tEe(e);return r}}class aEe{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cEe(t,e,n){let r=1,i=null,s=null,o=!1,a=0;function A(){return a===2}let l=!1;function d(...w){l||(l=!0,e.apply(null,w))}function f(w){i=setTimeout(()=>{i=null,t(g,A())},w)}function p(){s&&clearTimeout(s)}function g(w,...b){if(l){p();return}if(w){p(),d.call(null,w,...b);return}if(A()||o){p(),d.call(null,w,...b);return}r<64&&(r*=2);let B;a===1?(a=2,B=0):B=(r+Math.random())*1e3,f(B)}let y=!1;function E(w){y||(y=!0,p(),!l&&(i!==null?(w||(a=2),clearTimeout(i),f(0)):w||(a=1)))}return f(0),s=setTimeout(()=>{o=!0,E(!0)},n),E}function AEe(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lEe(t){return t!==void 0}function uEe(t){return typeof t=="function"}function dEe(t){return typeof t=="object"&&!Array.isArray(t)}function SI(t){return typeof t=="string"||t instanceof String}function jH(t){return dx()&&t instanceof Blob}function dx(){return typeof Blob<"u"}function KH(t,e,n,r){if(r<e)throw HH(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw HH(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aw(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function SJ(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const i=e(r)+"="+e(t[r]);n=n+i+"&"}return n=n.slice(0,-1),n}var Sf;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Sf||(Sf={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bJ(t,e){const n=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,s=e.indexOf(t)!==-1;return n||i||s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hEe{constructor(e,n,r,i,s,o,a,A,l,d,f,p=!0,g=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=A,this.timeout_=l,this.progressCallback_=d,this.connectionFactory_=f,this.retry=p,this.isUsingEmulator=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((y,E)=>{this.resolve_=y,this.reject_=E,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new $C(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const o=a=>{const A=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(A,l)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;const a=s.getErrorCode()===Sf.NO_ERROR,A=s.getStatus();if(!a||bJ(A,this.additionalRetryCodes_)&&this.retry){const d=s.getErrorCode()===Sf.ABORT;r(!1,new $C(!1,null,d));return}const l=this.successCodes_.indexOf(A)!==-1;r(!0,new $C(l,s))})},n=(r,i)=>{const s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{const A=this.callback_(a,a.getResponse());lEe(A)?s(A):s()}catch(A){o(A)}else if(a!==null){const A=ux();A.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,A)):o(A)}else if(i.canceled){const A=this.appDelete_?TJ():wJ();o(A)}else{const A=vJ();o(A)}};this.canceled_?n(!1,new $C(!1,null,!0)):this.backoffId_=cEe(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&AEe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class $C{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function fEe(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function pEe(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function mEe(t,e){e&&(t["X-Firebase-GMPID"]=e)}function gEe(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function _Ee(t,e,n,r,i,s,o=!0,a=!1){const A=SJ(t.urlParams),l=t.url+A,d=Object.assign({},t.headers);return mEe(d,e),fEe(d,n),pEe(d,s),gEe(d,r),new hEe(l,t.method,d,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,o,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EEe(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function yEe(...t){const e=EEe();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(dx())return new Blob(t);throw new wi(Kr.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function vEe(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wEe(t){if(typeof atob>"u")throw sEe("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KA={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class JN{constructor(e,n){this.data=e,this.contentType=n||null}}function CEe(t,e){switch(t){case KA.RAW:return new JN(IJ(e));case KA.BASE64:case KA.BASE64URL:return new JN(RJ(t,e));case KA.DATA_URL:return new JN(SEe(e),bEe(e))}throw ux()}function IJ(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const s=r,o=t.charCodeAt(++n);r=65536|(s&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function TEe(t){let e;try{e=decodeURIComponent(t)}catch{throw Ry(KA.DATA_URL,"Malformed data URL.")}return IJ(e)}function RJ(t,e){switch(t){case KA.BASE64:{const i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw Ry(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case KA.BASE64URL:{const i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw Ry(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=wEe(e)}catch(i){throw i.message.includes("polyfill")?i:Ry(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class OJ{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw Ry(KA.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=IEe(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function SEe(t){const e=new OJ(t);return e.base64?RJ(KA.BASE64,e.rest):TEe(e.rest)}function bEe(t){return new OJ(t).contentType}function IEe(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md{constructor(e,n){let r=0,i="";jH(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,n){if(jH(this.data_)){const r=this.data_,i=vEe(r,e,n);return i===null?null:new md(i)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new md(r,!0)}}static getBlob(...e){if(dx()){const n=e.map(r=>r instanceof md?r.data_:r);return new md(yEe.apply(null,n))}else{const n=e.map(o=>SI(o)?CEe(KA.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const i=new Uint8Array(r);let s=0;return n.forEach(o=>{for(let a=0;a<o.length;a++)i[s++]=o[a]}),new md(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NJ(t){let e;try{e=JSON.parse(t)}catch{return null}return dEe(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function REe(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function DJ(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OEe(t,e){return e}class vo{constructor(e,n,r,i){this.server=e,this.local=n||e,this.writable=!!r,this.xform=i||OEe}}let ZC=null;function NEe(t){return!SI(t)||t.length<2?t:DJ(t)}function BJ(){if(ZC)return ZC;const t=[];t.push(new vo("bucket")),t.push(new vo("generation")),t.push(new vo("metageneration")),t.push(new vo("name","fullPath",!0));function e(s,o){return NEe(o)}const n=new vo("name");n.xform=e,t.push(n);function r(s,o){return o!==void 0?Number(o):o}const i=new vo("size");return i.xform=r,t.push(i),t.push(new vo("timeCreated")),t.push(new vo("updated")),t.push(new vo("md5Hash",null,!0)),t.push(new vo("cacheControl",null,!0)),t.push(new vo("contentDisposition",null,!0)),t.push(new vo("contentEncoding",null,!0)),t.push(new vo("contentLanguage",null,!0)),t.push(new vo("contentType",null,!0)),t.push(new vo("metadata","customMetadata",!0)),ZC=t,ZC}function DEe(t,e){function n(){const r=t.bucket,i=t.fullPath,s=new hc(r,i);return e._makeStorageReference(s)}Object.defineProperty(t,"ref",{get:n})}function BEe(t,e,n){const r={};r.type="file";const i=n.length;for(let s=0;s<i;s++){const o=n[s];r[o.local]=o.xform(r,e[o.server])}return DEe(r,t),r}function LJ(t,e,n){const r=NJ(e);return r===null?null:BEe(t,r,n)}function LEe(t,e,n,r){const i=NJ(e);if(i===null||!SI(i.downloadTokens))return null;const s=i.downloadTokens;if(s.length===0)return null;const o=encodeURIComponent;return s.split(",").map(l=>{const d=t.bucket,f=t.fullPath,p="/b/"+o(d)+"/o/"+o(f),g=aw(p,n,r),y=SJ({alt:"media",token:l});return g+y})[0]}function PJ(t,e){const n={},r=e.length;for(let i=0;i<r;i++){const s=e[i];s.writable&&(n[s.server]=t[s.local])}return JSON.stringify(n)}class o_{constructor(e,n,r,i){this.url=e,this.method=n,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function su(t){if(!t)throw ux()}function hx(t,e){function n(r,i){const s=LJ(t,i,e);return su(s!==null),s}return n}function PEe(t,e){function n(r,i){const s=LJ(t,i,e);return su(s!==null),LEe(s,i,t.host,t._protocol)}return n}function cw(t){function e(n,r){let i;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?i=Z_e():i=$_e():n.getStatus()===402?i=J_e(t.bucket):n.getStatus()===403?i=eEe(t.path):i=r,i.status=n.getStatus(),i.serverResponse=r.serverResponse,i}return e}function UJ(t){const e=cw(t);function n(r,i){let s=e(r,i);return r.getStatus()===404&&(s=X_e(t.path)),s.serverResponse=i.serverResponse,s}return n}function UEe(t,e,n){const r=e.fullServerUrl(),i=aw(r,t.host,t._protocol),s="GET",o=t.maxOperationRetryTime,a=new o_(i,s,hx(t,n),o);return a.errorHandler=UJ(e),a}function kEe(t,e,n){const r=e.fullServerUrl(),i=aw(r,t.host,t._protocol),s="GET",o=t.maxOperationRetryTime,a=new o_(i,s,PEe(t,n),o);return a.errorHandler=UJ(e),a}function xEe(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function kJ(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=xEe(null,e)),r}function MEe(t,e,n,r,i){const s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let B="";for(let U=0;U<2;U++)B=B+Math.random().toString().slice(2);return B}const A=a();o["Content-Type"]="multipart/related; boundary="+A;const l=kJ(e,r,i),d=PJ(l,n),f="--"+A+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+d+`\r
--`+A+`\r
Content-Type: `+l.contentType+`\r
\r
`,p=`\r
--`+A+"--",g=md.getBlob(f,r,p);if(g===null)throw CJ();const y={name:l.fullPath},E=aw(s,t.host,t._protocol),w="POST",b=t.maxUploadRetryTime,I=new o_(E,w,hx(t,n),b);return I.urlParams=y,I.headers=o,I.body=g.uploadData(),I.errorHandler=cw(e),I}class eb{constructor(e,n,r,i){this.current=e,this.total=n,this.finalized=!!r,this.metadata=i||null}}function fx(t,e){let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch{su(!1)}return su(!!n&&(e||["active"]).indexOf(n)!==-1),n}function FEe(t,e,n,r,i){const s=e.bucketOnlyServerUrl(),o=kJ(e,r,i),a={name:o.fullPath},A=aw(s,t.host,t._protocol),l="POST",d={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},f=PJ(o,n),p=t.maxUploadRetryTime;function g(E){fx(E);let w;try{w=E.getResponseHeader("X-Goog-Upload-URL")}catch{su(!1)}return su(SI(w)),w}const y=new o_(A,l,g,p);return y.urlParams=a,y.headers=d,y.body=f,y.errorHandler=cw(e),y}function VEe(t,e,n,r){const i={"X-Goog-Upload-Command":"query"};function s(l){const d=fx(l,["active","final"]);let f=null;try{f=l.getResponseHeader("X-Goog-Upload-Size-Received")}catch{su(!1)}f||su(!1);const p=Number(f);return su(!isNaN(p)),new eb(p,r.size(),d==="final")}const o="POST",a=t.maxUploadRetryTime,A=new o_(n,o,s,a);return A.headers=i,A.errorHandler=cw(e),A}const GH=256*1024;function QEe(t,e,n,r,i,s,o,a){const A=new eb(0,0);if(o?(A.current=o.current,A.total=o.total):(A.current=0,A.total=r.size()),r.size()!==A.total)throw rEe();const l=A.total-A.current;let d=l;i>0&&(d=Math.min(d,i));const f=A.current,p=f+d;let g="";d===0?g="finalize":l===d?g="upload, finalize":g="upload";const y={"X-Goog-Upload-Command":g,"X-Goog-Upload-Offset":`${A.current}`},E=r.slice(f,p);if(E===null)throw CJ();function w(U,H){const K=fx(U,["active","final"]),x=A.current+d,V=r.size();let M;return K==="final"?M=hx(e,s)(U,H):M=null,new eb(x,V,K==="final",M)}const b="POST",I=e.maxUploadRetryTime,B=new o_(n,b,w,I);return B.headers=y,B.body=E.uploadData(),B.progressCallback=a||null,B.errorHandler=cw(t),B}const Ho={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function $N(t){switch(t){case"running":case"pausing":case"canceling":return Ho.RUNNING;case"paused":return Ho.PAUSED;case"success":return Ho.SUCCESS;case"canceled":return Ho.CANCELED;case"error":return Ho.ERROR;default:return Ho.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HEe{constructor(e,n,r){if(uEe(e)||n!=null||r!=null)this.next=e,this.error=n??void 0,this.complete=r??void 0;else{const s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fp(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class jEe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Sf.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Sf.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Sf.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,i,s){if(this.sent_)throw TE("cannot .send() more than once");if(sl(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),s!==void 0)for(const o in s)s.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,s[o].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw TE("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw TE("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw TE("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw TE("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class KEe extends jEe{initXhr(){this.xhr_.responseType="text"}}function wm(){return new KEe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GEe{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(e,n,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=n,this._metadata=r,this._mappings=BJ(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(Kr.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const s=this.isExponentialBackoffExpired();if(bJ(i.status,[]))if(s)i=vJ();else{this.sleepTime=Math.max(this.sleepTime*2,Y_e),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(Kr.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return n=>this._updateProgress(e+n)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,r])=>{switch(this._state){case"running":e(n,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,n)=>{const r=FEe(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,wm,e,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((n,r)=>{const i=VEe(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(i,wm,n,r);this._request=s,s.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=GH*this._chunkMultiplier,n=new eb(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let o;try{o=QEe(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,n,this._makeProgressCallback())}catch(A){this._error=A,this._transition("error");return}const a=this._ref.storage._makeRequest(o,wm,i,s,!1);this._request=a,a.getPromise().then(A=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(A.current),A.finalized?(this._metadata=A.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){GH*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,n)=>{const r=UEe(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,wm,e,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,n)=>{const r=MEe(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,wm,e,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const n=this._transferred;this._transferred=e,this._transferred!==n&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const n=this._state==="paused";this._state=e,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=wJ(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=$N(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,n,r,i){const s=new HEe(n||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,n){return this._promise.then(e,n)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const n=this._observers.indexOf(e);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch($N(this._state)){case Ho.SUCCESS:Fp(this._resolve.bind(null,this.snapshot))();break;case Ho.CANCELED:case Ho.ERROR:const n=this._reject;Fp(n.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch($N(this._state)){case Ho.RUNNING:case Ho.PAUSED:e.next&&Fp(e.next.bind(e,this.snapshot))();break;case Ho.SUCCESS:e.complete&&Fp(e.complete.bind(e))();break;case Ho.CANCELED:case Ho.ERROR:e.error&&Fp(e.error.bind(e,this._error))();break;default:e.error&&Fp(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb{constructor(e,n){this._service=e,n instanceof hc?this._location=n:this._location=hc.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new tb(e,n)}get root(){const e=new hc(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return DJ(this._location.path)}get storage(){return this._service}get parent(){const e=REe(this._location.path);if(e===null)return null;const n=new hc(this._location.bucket,e);return new tb(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw oEe(e)}}function WEe(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new GEe(t,new md(e),n)}function zEe(t){t._throwIfRoot("getDownloadURL");const e=kEe(t.storage,t._location,BJ());return t.storage.makeRequestWithTokens(e,wm).then(n=>{if(n===null)throw iEe();return n})}function WH(t,e){const n=e==null?void 0:e[W_e];return n==null?null:hc.makeFromBucketSpec(n,t)}function qEe(t,e,n,r={}){t.host=`${e}:${n}`;const i=sl(e);i&&(zb(`https://${t.host}/b`),qb("Storage",!0)),t._isUsingEmulator=!0,t._protocol=i?"https":"http";const{mockUserToken:s}=r;s&&(t._overrideAuthToken=typeof s=="string"?s:FU(s,t.app.options.projectId))}class YEe{constructor(e,n,r,i,s,o=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._isUsingEmulator=o,this._bucket=null,this._host=yJ,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=z_e,this._maxUploadRetryTime=q_e,this._requests=new Set,i!=null?this._bucket=hc.makeFromBucketSpec(i,this._host):this._bucket=WH(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=hc.makeFromBucketSpec(this._url,e):this._bucket=WH(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){KH("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){KH("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(cc(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new tb(this,e)}_makeRequest(e,n,r,i,s=!0){if(this._deleted)return new aEe(TJ());{const o=_Ee(e,this._appId,r,i,n,this._firebaseVersion,s,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,i).getPromise()}}const zH="@firebase/storage",qH="0.13.13";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xJ="storage";function XEe(t,e,n){return t=ci(t),WEe(t,e,n)}function JEe(t){return t=ci(t),zEe(t)}function $Ee(t=zv(),e){t=ci(t);const r=yu(t,xJ).getImmediate({identifier:e}),i=MU("storage");return i&&ZEe(r,...i),r}function ZEe(t,e,n,r={}){qEe(t,e,n,r)}function eye(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new YEe(n,r,i,e,ah)}function tye(){_c(new Da(xJ,eye,"PUBLIC").setMultipleInstances(!0)),lo(zH,qH,""),lo(zH,qH,"esm2017")}tye();const nye={apiKey:"AIzaSyAhnSrmFmORLNNn0m5FRlnCVFsdz9e1Ye0",authDomain:"xraivision-2fc49.firebaseapp.com",databaseURL:"https://xraivision-2fc49-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"xraivision-2fc49",storageBucket:"xraivision-2fc49.firebasestorage.app",messagingSenderId:"469449360476",appId:"1:469449360476:web:ea9c235659619ea8941299",measurementId:"G-WGEKRGPYEC"},a_=P7(nye);Nle(a_);const Ul=Nde(a_),MJ=ppe(a_),tt=EJ(a_),rye=$Ee(a_);console.log("Firebase initialized:",a_);const px="/assets/xrai-CIw320yl.png",iye=({onSignIn:t})=>{const[e,n]=J.useState(""),[r,i]=J.useState(""),[s,o]=J.useState(""),[a,A]=J.useState(!1),l=zg(),d=()=>Date.now().toString()+Math.random().toString(36).substr(2,9),f=async p=>{p.preventDefault(),A(!0),o("");try{console.log("Attempting to sign in with license credentials...");const g=zY(MJ,"licenses"),y=eX(g,SL("licenseId","==",e),SL("password","==",r)),E=await nX(y);if(E.empty){o("Invalid License ID or Password"),A(!1);return}const b=E.docs[0].data(),I=Xe(tt,`active_sessions/${e}`),B=await Pi(I);if(B.exists()){const q=B.val(),Ue=Date.now(),fe=q.timestamp||0;if(Ue-fe<5*60*1e3){o("This license is already in use on another device. Please try again later or contact support."),A(!1);return}}const U={uid:e,companyName:b.companyName};console.log("License authenticated. Constructed user:",U);const H=d(),K={sessionId:H,timestamp:Date.now(),deviceInfo:navigator.userAgent,loginTime:new Date().toISOString()};await Zr(I,K),QH(I).remove();const V=Xe(tt,`active_users/${U.uid}`),M=await Pi(V),O=M.exists()?M.val():null,z=O?{...O,sessionId:H,lastActive:Date.now()}:{status:"available",incoming_calls:[],chats:[],sessionId:H,lastActive:Date.now()};console.log("Data being written to Realtime Database:",z),await Zr(V,z),QH(V).remove(),sessionStorage.setItem("currentSessionId",H),sessionStorage.setItem("currentLicenseId",e),t(U),l("/dashboard",{state:{userId:U.uid,companyName:U.companyName}})}catch(g){console.error("Error during sign-in with license:",g),o("An error occurred during sign-in."),A(!1)}};return qA.useEffect(()=>{const p=async()=>{const g=sessionStorage.getItem("currentSessionId"),y=sessionStorage.getItem("currentLicenseId");if(g&&y)try{const E=Xe(tt,`active_sessions/${y}`),w=Xe(tt,`active_users/${y}`);await Zr(E,null),await Zr(w,null)}catch(E){console.error("Error cleaning up session:",E)}};return window.addEventListener("beforeunload",p),()=>{window.removeEventListener("beforeunload",p)}},[]),D.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-900",children:D.jsxs("div",{className:"signin-card bg-blue-900 w-full sm:w-96 p-8 rounded-lg border-4 border-white shadow-xl",style:{boxShadow:"0 0 2px 1px rgba(255, 255, 255, 0.6)"},children:[D.jsx("div",{className:"signin-logo-container flex justify-center mb-6",children:D.jsx("div",{className:"signin-logo w-16 h-16 bg-gradient-to-r from-purple-500 to-blue-600 rounded-lg flex justify-center items-center mb-4",children:D.jsx("img",{src:px,alt:"XRAI Vision Logo",className:"w-12 h-12 object-contain"})})}),D.jsx("h2",{className:"text-2xl font-bold text-center text-white mb-4",children:"Provider Sign In"}),D.jsxs("form",{onSubmit:f,children:[D.jsxs("div",{className:"signin-input-group mb-4",children:[D.jsx("label",{htmlFor:"licenseId",className:"block text-sm font-semibold text-gray-300",children:"License ID"}),D.jsxs("div",{className:"signin-input-container relative",children:[D.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[D.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),D.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),D.jsx("input",{id:"licenseId",type:"text",placeholder:"Enter License ID",value:e,onChange:p=>n(p.target.value),className:"w-full pl-10 py-3 bg-gray-800 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),D.jsxs("div",{className:"signin-input-group mb-4",children:[D.jsx("label",{htmlFor:"licensePassword",className:"block text-sm font-semibold text-gray-300",children:"License Password"}),D.jsxs("div",{className:"signin-input-container relative",children:[D.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[D.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),D.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),D.jsx("input",{id:"licensePassword",type:"password",placeholder:"Enter License Password",value:r,onChange:p=>i(p.target.value),className:"w-full pl-10 py-3 bg-gray-800 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),s&&D.jsx("div",{className:"text-sm text-red-500 mb-4",children:s}),D.jsx("button",{type:"submit",className:`w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-md font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 ${a?"opacity-50 cursor-not-allowed":""}`,disabled:a,children:a?D.jsx("span",{className:"flex justify-center items-center space-x-2",children:D.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[D.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),D.jsx("path",{d:"M4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0",stroke:"currentColor",strokeWidth:"4",fill:"none"})]})}):"Sign In"})]}),D.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-500 mt-4",children:[D.jsx("a",{href:"#forgot-password",className:"hover:text-blue-500",children:"Forgot Password?"}),D.jsxs("div",{className:"flex items-center space-x-2",children:[D.jsx("span",{children:"Powered by"}),D.jsx("img",{src:"https://via.placeholder.com/60",alt:"Agili8",className:"w-12 h-12"})]})]})]})})},js=[];for(let t=0;t<256;++t)js.push((t+256).toString(16).slice(1));function sye(t,e=0){return(js[t[e+0]]+js[t[e+1]]+js[t[e+2]]+js[t[e+3]]+"-"+js[t[e+4]]+js[t[e+5]]+"-"+js[t[e+6]]+js[t[e+7]]+"-"+js[t[e+8]]+js[t[e+9]]+"-"+js[t[e+10]]+js[t[e+11]]+js[t[e+12]]+js[t[e+13]]+js[t[e+14]]+js[t[e+15]]).toLowerCase()}let ZN;const oye=new Uint8Array(16);function aye(){if(!ZN){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ZN=crypto.getRandomValues.bind(crypto)}return ZN(oye)}const cye=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),YH={randomUUID:cye};function Vp(t,e,n){var i;if(YH.randomUUID&&!t)return YH.randomUUID();t=t||{};const r=t.random??((i=t.rng)==null?void 0:i.call(t))??aye();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,sye(r)}const Aye=({message:t,onConfirm:e,onCancel:n})=>D.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:D.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg max-w-md",children:[D.jsx("h2",{className:"text-xl font-bold mb-4",children:"Confirm Action"}),D.jsx("p",{className:"mb-6",children:t}),D.jsxs("div",{className:"flex justify-center space-x-4",children:[D.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:e,children:"Confirm"}),D.jsx("button",{className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded",onClick:n,children:"Cancel"})]})]})}),lye=({caller:t,onAccept:e,onReject:n,onClose:r})=>{var i,s;return D.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:D.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[D.jsxs("div",{className:"caller-info text-center",children:[D.jsx("div",{className:"caller-avatar bg-blue-500 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-2",children:((i=t==null?void 0:t.name)==null?void 0:i.charAt(0))||((s=t==null?void 0:t.username)==null?void 0:s.charAt(0))}),D.jsx("h2",{className:"text-xl font-bold",children:(t==null?void 0:t.name)||(t==null?void 0:t.username)}),D.jsx("p",{children:"is calling you..."})]}),D.jsxs("div",{className:"flex justify-center space-x-4 mt-4",children:[D.jsx("button",{className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",onClick:e,children:"Accept"}),D.jsx("button",{className:"bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded",onClick:n,children:"Reject"})]}),D.jsx("button",{className:"absolute top-2 right-2 text-white",onClick:r,children:""})]})})},uye=({onClose:t})=>D.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:D.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[D.jsx("h2",{className:"text-xl font-bold mb-2",children:"Agili8 Support"}),D.jsxs("p",{children:["For support, please call ",D.jsx("a",{href:"tel:+611800841989",className:"text-blue-400",children:"+61 1800 841 989"})," or email ",D.jsx("a",{href:"mailto:help@agili8.com",className:"text-blue-400",children:"help@agili8.com"})]}),D.jsx("button",{onClick:t,className:"mt-4 p-2 bg-blue-500 text-white rounded",children:"Close"})]})}),dye=({user:t,fetchCalls:e,calls:n,loadingCalls:r,selectedCapture:i,setSelectedCapture:s,isLibraryOpen:o,setIsLibraryOpen:a,showCallHistory:A,setShowCallHistory:l,deleteCapture:d,downloadCapture:f,actionDialog:p,setActionDialog:g,clearCallHistory:y})=>{const E=()=>D.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mt-4",children:r?D.jsx("div",{className:"col-span-full flex justify-center py-8",children:D.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):n.length>0?n.filter(I=>I.captures&&Object.keys(I.captures).length>0).sort((I,B)=>new Date(B.createdAt)-new Date(I.createdAt)).map(I=>D.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 transition-all border border-gray-700",onClick:()=>{s({callId:I.id,captures:I.captures,title:I.title})},children:[D.jsx("h3",{className:"text-lg font-medium mb-2",children:I.title||"Untitled Call"}),D.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[D.jsx("span",{children:new Date(I.createdAt instanceof Date?I.createdAt:new Date(I.createdAt)).toLocaleDateString()}),D.jsxs("span",{className:"flex items-center",children:[D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),I.captures?Object.keys(I.captures).length:0," captures"]})]})]},I.id)):D.jsx("div",{className:"col-span-full text-center py-8 text-gray-400",children:"No captures available"})}),w=()=>D.jsx("div",{className:"grid grid-cols-1 gap-4 mt-4",children:r?D.jsx("div",{className:"flex justify-center py-8",children:D.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):n.length>0?n.sort((I,B)=>new Date(B.createdAt)-new Date(I.createdAt)).map(I=>{let B="Unknown";return I.users&&(Array.isArray(I.users)?B=I.users.join(", "):typeof I.users=="object"?B=Object.keys(I.users).join(", "):typeof I.users=="string"&&(B=I.users)),D.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[D.jsx("h3",{className:"text-lg font-medium mb-2",children:I.title||"Untitled Call"}),D.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-400",children:[D.jsxs("span",{className:"flex items-center",children:[D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),new Date(I.createdAt instanceof Date?I.createdAt:new Date(I.createdAt)).toLocaleDateString()]}),D.jsxs("span",{className:"flex items-center",children:[D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),new Date(I.createdAt instanceof Date?I.createdAt:new Date(I.createdAt)).toLocaleTimeString()]}),D.jsxs("span",{className:"flex items-center",children:[D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),B]}),D.jsxs("span",{className:"flex items-center",children:[D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),I.captures?Object.keys(I.captures).length:0," captures"]})]}),D.jsx("div",{className:"mt-3",children:D.jsxs("span",{className:"text-sm text-gray-400",children:["Duration: ",I.duration?`${Math.round(I.duration/60)} mins`:"N/A"]})})]},I.id)}):D.jsx("div",{className:"text-center py-8 text-gray-400",children:"No call history available"})}),b=()=>{if(!i||!i.captures)return null;const I=Object.entries(i.captures).map(([B,U])=>({captureId:B,...U}));return D.jsxs("div",{className:"mt-4",children:[D.jsxs("div",{className:"flex items-center mb-4",children:[D.jsx("button",{className:"mr-2 bg-gray-700 hover:bg-gray-600 p-1 rounded",onClick:()=>s(null),children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),D.jsx("h2",{className:"text-xl font-bold",children:i.title||"Call Captures"})]}),D.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:I.length>0?I.map((B,U)=>{const H=B.imageUrl?`capture_${U}.jpg`:B.videoUrl?`capture_${U}.mp4`:`capture_${U}`;return D.jsxs("div",{className:"bg-gray-800 p-2 rounded-lg border border-gray-700 flex flex-col",children:[D.jsx("div",{className:"relative flex-grow",children:B.imageUrl?D.jsx("img",{src:B.imageUrl,alt:`Capture ${U}`,className:"w-full h-48 object-cover rounded"}):B.videoUrl?D.jsxs("video",{controls:!0,className:"w-full h-48 object-cover rounded",children:[D.jsx("source",{src:B.videoUrl,type:"video/mp4"}),"Your browser does not support video playback."]}):D.jsx("div",{className:"w-full h-48 flex items-center justify-center bg-gray-700 rounded",children:D.jsx("span",{className:"text-gray-400",children:"No preview available"})})}),D.jsx("div",{className:"mt-2 text-sm text-gray-400",children:D.jsxs("p",{children:["Timestamp: ",new Date(B.timestamp).toLocaleString()]})}),D.jsxs("div",{className:"mt-2 flex space-x-2",children:[D.jsxs("button",{onClick:()=>g({message:"Are you sure you want to download this capture?",onConfirm:()=>f(B.imageUrl||B.videoUrl,H),onCancel:()=>g(null)}),className:"flex-1 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white py-1 px-2 rounded text-sm",children:[D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),D.jsx("button",{onClick:()=>g({message:"Are you sure you want to delete this capture? This action cannot be undone.",onConfirm:()=>d(i.callId,B.captureId),onCancel:()=>g(null)}),className:"flex items-center justify-center bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded text-sm",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},B.captureId)}):D.jsx("div",{className:"col-span-full text-center py-8 text-gray-400",children:"No captures available for this call"})})]})};return D.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[o&&!A&&D.jsxs("div",{children:[D.jsxs("div",{className:"flex justify-between items-center mb-4",children:[D.jsx("h2",{className:"text-xl font-bold",children:"Library"}),D.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded flex items-center gap-1 text-sm",onClick:e,children:[D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]}),i?b():E()]}),A&&!o&&D.jsxs("div",{children:[D.jsxs("div",{className:"flex justify-between items-center mb-4",children:[D.jsx("h2",{className:"text-xl font-bold",children:"Call History"}),D.jsxs("div",{className:"flex space-x-2",children:[D.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded flex items-center gap-1 text-sm",onClick:e,children:[D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]}),D.jsxs("button",{className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded flex items-center gap-1 text-sm",onClick:()=>g({message:"Are you sure you want to clear your entire call history? This action cannot be undone.",onConfirm:()=>y(t.uid),onCancel:()=>g(null)}),children:[D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Clear"]})]})]}),w()]})]})},hye=({user:t,onLogout:e})=>{var er;const[n,r]=J.useState([]),[i,s]=J.useState(!1),[o,a]=J.useState(!0),[A,l]=J.useState(null),[d,f]=J.useState(null),[p,g]=J.useState([]),[y,E]=J.useState(""),[w,b]=J.useState(!1),[I,B]=J.useState([]),[U,H]=J.useState(!1),[K,x]=J.useState([]),[V,M]=J.useState([]),[O,z]=J.useState(!1),[$,q]=J.useState(!1),[Ue,fe]=J.useState(!1),[re,Y]=J.useState(null),[Z,ae]=J.useState(null),[j,C]=J.useState(!1),L=zg(),k=()=>q(!$),ee=()=>q(!1),_e=()=>C(!j);J.useEffect(()=>{if(!(t!=null&&t.uid))return;const xe=async()=>{s(!0);try{const mn=zY(MJ,"companies"),Wn=eX(mn,SL("companyName","==",t.companyName)),Ji=await nX(Wn);if(Ji.empty)r([]);else{const zr=Ji.docs[0].data().licenses.map(Us=>Us.licenseId).filter(Us=>Us!==t.uid);r(zr)}}catch{}finally{s(!1)}},ze=async()=>{const mn=Xe(tt,`active_users/${t.uid}/favorites`);ya(mn,Wn=>{const Ji=Wn.val();M(Ji?Object.keys(Ji):[])})};xe(),ze();const ut=Xe(tt,`active_users/${t.uid}/incoming_calls`);let $e=!0,et=null;const on=ya(ut,mn=>{const Wn=mn.val();if($e){$e=!1;return}if(!Wn||Array.isArray(Wn)&&Wn.length===0||typeof Wn=="object"&&Object.keys(Wn).length===0){l(null);return}const Ji=Object.entries(Wn).map(([xr,Ps])=>({key:xr,...Ps})).filter(xr=>xr.status==="pending"&&xr.key!==et).sort((xr,Ps)=>Ps.timestamp-xr.timestamp)[0];Ji?(et=Ji.key,l({...Ji,name:Ji.userId||"Unknown"})):l(null)});return()=>on()},[t==null?void 0:t.uid]),J.useEffect(()=>{const xe=Xe(tt,"videoCalls");Pi(xe).then(ze=>{if(ze.exists()){const ut=ze.val(),$e=Object.entries(ut).flatMap(([et,on])=>Object.entries(on.captures||{}).map(([mn,Wn])=>({callId:et,captureId:mn,...Wn})));x($e)}})},[]);const ke=async xe=>{const ze=Xe(tt,`active_users/${t.uid}/favorites/${xe}`);try{V.includes(xe)?(await ld(ze),M(V.filter(ut=>ut!==xe))):(await Zr(ze,{addedAt:Date.now()}),M([...V,xe]))}catch{}},ft=async xe=>{const ze=Vp(),ut=Xe(tt,`videoCalls/${ze}`),$e=t==null?void 0:t.uid,et="Video Call";if(!$e||!xe)return;await Zr(ut,{title:et,createdAt:Date.now(),createdBy:$e,active:!0,users:[$e,xe],status:"pending"});const on=Xe(tt,`active_users/${xe}/incoming_calls/${ze}`);await Zr(on,{roomId:ze,userId:$e,status:"pending",timestamp:Date.now(),title:et,isNew:!0,type:"invitation"}),Rt({uid:$e,companyName:t.companyName},ze,et)},Rt=(xe,ze,ut)=>{L(`/video-call?callId=${ze}&uid=${xe.uid}&title=${encodeURIComponent(ut)}`)},Gr=async()=>{try{if(!A||!A.roomId){console.error("No valid incoming call to accept"),l(null);return}console.log(`Accepting call with roomId: ${A.roomId}`);const xe=Xe(tt,`videoCalls/${A.roomId}`),ze=await Pi(xe);if(!ze.exists()){console.error("Call room does not exist. The caller may have canceled the call.");const mn=Xe(tt,`active_users/${t.uid}/incoming_calls/${A.key}`);await ld(mn),alert("This call is no longer available. The caller may have ended the call."),l(null);return}const ut=ze.val();let $e;ut.users?Array.isArray(ut.users)?ut.users.includes(t.uid)?$e=ut.users:$e=[...ut.users,t.uid]:typeof ut.users=="object"&&($e={...ut.users,[t.uid]:{joinedAt:Date.now(),role:"participant"}}):$e=[t.uid],await Jr(xe,{users:$e,status:"accepted",timestamp:Date.now(),lastUpdated:Date.now()});const et=Xe(tt,`active_users/${t.uid}/incoming_calls/${A.key}`);await ld(et);const on=ut.title||"Video Call";Rt({uid:t.uid,companyName:t.companyName},A.roomId,on),l(null)}catch{}},Xi=async()=>{if(A){const xe=Xe(tt,`active_users/${t.uid}/incoming_calls/${A.key}`);await ld(xe),l(null)}},Ls=()=>l(null),Ur=async xe=>{if(xe){f(xe),H(!1),fe(!1);try{const ze=Xe(tt,`active_users/${t.uid}/chats/${xe}`);(await Pi(ze)).exists()||await Wr(t,xe),pt(t,xe)}catch{}}},Wr=async(xe,ze)=>{if(!xe||!ze)return;const ut=Vp(),$e=Xe(tt,`chatRooms/${ut}`);await Zr($e,{users:[xe.uid,ze],[`${xe.uid}_messages`]:{[Vp()]:{userId:xe.uid,content:"Start chat",timestamp:Date.now()}},[`${ze}_messages`]:{[Vp()]:{userId:ze,content:"Start chat",timestamp:Date.now()}}}).then(()=>kr(xe.uid,ze,ut)).catch(()=>{})},kr=async(xe,ze,ut)=>{if(!xe||!ze||!ut)return;const $e=Date.now();await Promise.all([Zr(Xe(tt,`active_users/${xe}/chats/${ze}`),{chatRoomId:ut,timestamp:$e}),Zr(Xe(tt,`active_users/${ze}/chats/${xe}`),{chatRoomId:ut,timestamp:$e})]).catch(()=>{})},qt=async()=>{if(!(!t||!d||!y.trim()))try{const xe=Vp(),ze=Xe(tt,`active_users/${t.uid}/chats/${d}/chatRoomId`);ya(ze,async ut=>{const $e=ut.val();if(!$e)return;const et=`chatRooms/${$e}/${t.uid}_messages`;await Jr(Xe(tt,et),{[xe]:{userId:t.uid,content:y,timestamp:Date.now()}}),E("")})}catch{}},$t=async xe=>{const ze=xe.target.files[0];if(ze)try{const ut=Xe(rye,`chat_files/${ze.name}`),$e=XEe(ut,ze);$e.on("state_changed",et=>console.log(`Upload is ${et.bytesTransferred/et.totalBytes*100}% done`),et=>console.error("Error uploading file:",et),async()=>{const et=await JEe($e.snapshot.ref),on=Vp(),mn=Xe(tt,`active_users/${t.uid}/chats/${d}/chatRoomId`);ya(mn,async Wn=>{const Ji=Wn.val();if(!Ji)return;const xr=`chatRooms/${Ji}/${t.uid}_messages`;await Jr(Xe(tt,xr),{[on]:{userId:t.uid,content:et,timestamp:Date.now(),type:"file",fileName:ze.name}})})})}catch{}},pt=(xe,ze)=>{if(!xe||!ze)return;const ut=Xe(tt,`active_users/${xe.uid}/chats/${ze}/chatRoomId`);ya(ut,$e=>{const et=$e.val();if(!et)return;const on=Xe(tt,`chatRooms/${et}`);ya(on,mn=>{const Wn=mn.val();if(!Wn)return;const xr=[...Object.values((Wn==null?void 0:Wn[`${xe.uid}_messages`])||{}),...Object.values((Wn==null?void 0:Wn[`${ze}_messages`])||{})].sort((Ps,na)=>Ps.timestamp-na.timestamp);g(xr)})})},Gn=async()=>{b(!0);try{const ze=(await Pi(Xe(tt,"videoCalls"))).val();if(ze){const ut=Object.keys(ze).map($e=>({id:$e,...ze[$e]}));B(ut)}else B([])}catch{}finally{b(!1)}},br=async(xe,ze)=>{try{const ut=Xe(tt,`videoCalls/${xe}/captures/${ze}`);await ld(ut),console.log("Capture deleted successfully"),x(K.filter($e=>$e.captureId!==ze)),B(I.map($e=>{if($e.id===xe){const et={...$e.captures};return delete et[ze],{...$e,captures:et}}return $e})),ae(null)}catch{}},Kt=(xe,ze)=>{const ut=document.createElement("a");ut.href=xe,ut.download=ze||"capture",document.body.appendChild(ut),ut.click(),document.body.removeChild(ut),ae(null)},at=async xe=>{try{if(!xe){console.error("User ID not available");return}const ze=await Pi(Xe(tt,"videoCalls"));if(!ze.exists()){console.log("No calls to clear"),ae(null);return}const ut=[],$e=ze.val();Object.entries($e).forEach(([et,on])=>{on.users&&(Array.isArray(on.users)&&on.users.includes(xe)||typeof on.users=="object"&&Object.keys(on.users).includes(xe)||on.createdBy===xe)&&ut.push(ld(Xe(tt,`videoCalls/${et}`)))}),await Promise.all(ut),B([]),console.log("Call history cleared successfully"),ae(null)}catch{}};return D.jsxs("div",{className:"flex flex-col h-screen bg-gray-900 text-white",children:[D.jsxs("header",{className:"py-2 px-4 flex justify-between items-center",style:{background:"linear-gradient(135deg, #404AD9 25%, #2C82FF 50%, #9B51EB 75%, #F74FFC 100%)",height:"80px",width:"100%"},children:[D.jsxs("div",{className:"flex items-center justify-start space-x-4",children:[D.jsx("div",{className:"h-16 w-16 sm:h-32 sm:w-32",children:D.jsx("img",{src:px,alt:"SurgeView Logo",className:"w-full h-full object-contain"})}),D.jsxs("div",{className:"flex items-center bg-blue-600/70 backdrop-blur-md px-3 py-1.5 rounded-full border border-blue-400/50 shadow-lg",children:[D.jsx("div",{className:"bg-blue-800 rounded-full p-1.5 flex items-center justify-center",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:D.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1zM12 7a5 5 0 1 0 5 5 5.006 5.006 0 0 0-5-5zm0 8a3 3 0 1 1-3-3 3.003 3.003 0 0 1 3 3z"})})}),D.jsx("span",{className:"ml-2 text-sm sm:text-base font-medium text-white",children:((er=t==null?void 0:t.uid)==null?void 0:er.substring(0,16))||"User"})]})]}),D.jsxs("div",{className:"hidden md:flex flex-wrap gap-1.5 sm:gap-2 mt-1 sm:mt-0",children:[D.jsxs("button",{onClick:()=>{H(!U),fe(!1),Y(null),f(null),U||Gn()},className:"bg-blue-600/80 hover:bg-blue-700 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2.5 sm:px-3 border-white/30 rounded-lg transition-colors flex items-center gap-1.5 border border-white shadow",children:[D.jsx("div",{className:"bg-blue-900  hover:bg-blue-700 rounded-full p-1 flex items-center justify-center",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),D.jsx("span",{children:"Library"})]}),D.jsxs("button",{className:"bg-blue-600/80 hover:bg-blue-700 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2.5 sm:px-3 border-white/30 rounded-lg transition-colors flex items-center gap-1.5 border border-white shadow",onClick:()=>{fe(!Ue),H(!1),Y(null),f(null),Ue||Gn()},children:[D.jsx("div",{className:"bg-blue-900  rounded-full p-1 flex items-center justify-center",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),D.jsx("span",{children:"Call History"})]}),D.jsxs("button",{className:"bg-blue-600/80  hover:bg-purple-700/80 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2.5 sm:px-3  border-white/30 rounded-lg transition-colors flex items-center gap-1.5 border border-white shadow",onClick:k,children:[D.jsx("div",{className:"bg-blue-900  rounded-full p-1 flex items-center justify-center",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),D.jsx("span",{children:"Help"})]}),D.jsxs("button",{className:"bg-red-600/70 hover:bg-red-700/80 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2.5 sm:px-3  border-white/30 rounded-lg transition-colors flex items-center gap-1.5 border border-white shadow",onClick:e,children:[D.jsx("div",{className:"bg-red-800 rounded-full p-1 flex items-center justify-center",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),D.jsx("span",{children:"Logout"})]})]}),D.jsx("div",{className:"md:hidden",children:D.jsx("button",{onClick:_e,className:"p-2 bg-gray-800 rounded-full",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]}),j&&D.jsx("div",{className:"fixed inset-0 bg-blue-600 bg-opacity-50 z-50 md:hidden",children:D.jsx("div",{className:"absolute top-0 right-0 mt-16 mr-4 bg-white rounded-lg shadow-lg p-4 w-64",children:D.jsxs("div",{className:"flex flex-col space-y-3",children:[D.jsxs("button",{onClick:()=>{H(!U),fe(!1),Y(null),f(null),U||Gn(),_e()},className:"flex items-center  bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-3 rounded-lg transition-colors",children:[D.jsx("div",{className:"bg-blue-950 rounded-full p-1 mr-2 flex items-center justify-center",children:D.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),D.jsx("span",{children:"Library"})]}),D.jsxs("button",{onClick:()=>{fe(!Ue),H(!1),Y(null),f(null),Ue||Gn(),_e()},className:"flex items-center  bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-3 rounded-lg transition-colors",children:[D.jsx("div",{className:"bg-blue-950 rounded-full p-1 mr-2 flex items-center justify-center",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),D.jsx("span",{children:"Call History"})]}),D.jsxs("button",{onClick:()=>{k(),_e()},className:"flex items-center bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-3 rounded-lg transition-colors",children:[D.jsx("div",{className:"bg-blue-950 rounded-full p-1 mr-2 flex items-center justify-center",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),D.jsx("span",{children:"Help"})]}),D.jsxs("button",{onClick:()=>{e(),_e()},className:"flex items-center bg-red-600/80 hover:bg-red-700 text-white text-sm font-medium py-2 px-3 rounded-lg transition-colors",children:[D.jsx("div",{className:"bg-blue-950 rounded-full p-1 mr-2 flex items-center justify-center",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),D.jsx("span",{children:"Logout"})]})]})})}),D.jsxs("div",{className:"flex flex-col sm:flex-row flex-1 overflow-hidden",children:[D.jsxs("aside",{className:"bg-gray-800 w-full sm:w-80 space-y-4 py-3 sm:py-7 px-2 overflow-y-auto",children:[D.jsxs("div",{className:"flex justify-between items-center px-2 sm:px-4",children:[D.jsx("h3",{className:"text-sm sm:text-base font-medium",children:"Contacts"}),D.jsx("button",{className:"text-yellow-400 text-xs sm:text-sm",onClick:()=>z(!O),children:O?"Show All":"Favourites"})]}),D.jsxs("div",{className:"space-y-2",children:[i&&D.jsx("div",{className:"text-center text-sm",children:"Loading..."}),o&&n.length>0?(O?V:n).map((xe,ze)=>D.jsxs("div",{className:`flex items-center p-2 bg-gray-700 rounded mx-1 sm:mx-2 ${V.includes(xe)?"border-l-4 border-yellow-400":""}`,children:[D.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-blue-500 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:xe.charAt(0)}),D.jsxs("div",{className:"flex-1 min-w-0",children:[D.jsx("div",{className:"font-bold text-sm sm:text-base truncate",children:xe}),D.jsx("div",{className:"text-xs sm:text-sm text-gray-400",children:"Online"})]}),D.jsxs("div",{className:"flex space-x-1 sm:space-x-2 ml-1",children:[D.jsx("button",{className:"text-white p-1",onClick:()=>ft(xe),children:D.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:[D.jsx("path",{d:"M23 7l-7 5 7 5V7z"}),D.jsx("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})]})}),D.jsx("button",{className:"text-white p-1",onClick:()=>Ur(xe),children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:D.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v8a2 2 0 0 1-1.998 2M14 2H4a1 1 0 0 0-1 1h9.002a2 2 0 0 1 2 2v7A1 1 0 0 0 15 11V3a1 1 0 0 0-1-1M2.002 4a1 1 0 0 0-1 1v8l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71a.5.5 0 0 1 .577-.094l1.777 1.947V5a1 1 0 0 0-1-1z"})})}),D.jsx("button",{className:"text-white p-1",onClick:()=>ke(xe),children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:V.includes(xe)?"yellow":"none",stroke:"currentColor",children:D.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 7.05 2.02 9.24l7.19 7.03L12 17.27z"})})})]})]},ze)):D.jsx("div",{className:"text-center text-sm",children:O?"No favorite contacts":"No contacts available"})]})]}),D.jsxs("main",{className:"flex-1 overflow-x-hidden overflow-y-auto p-2 sm:p-4",children:[d&&D.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:D.jsxs("div",{className:"bg-gray-800 p-3 sm:p-4 rounded-lg w-full max-w-md",children:[D.jsxs("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:[D.jsx("h2",{className:"text-lg sm:text-xl font-bold truncate",children:d}),D.jsx("button",{onClick:()=>f(null),className:"text-gray-400 hover:text-white","aria-label":"Close chat",children:D.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),D.jsx("div",{className:"space-y-2 mb-3 sm:mb-4 max-h-[50vh] overflow-y-auto p-1",children:p.length>0?p.map((xe,ze)=>D.jsxs("div",{className:`p-2 rounded max-w-[80%] ${xe.userId===t.uid?"bg-blue-500 ml-auto text-white":"bg-gray-700 mr-auto"}`,children:[D.jsx("p",{className:"text-sm break-words",children:xe.type==="file"?D.jsxs("a",{href:xe.content,target:"_blank",rel:"noopener noreferrer",className:"text-blue-300 hover:underline flex items-center",children:[D.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),xe.fileName||"File"]}):xe.content}),D.jsx("span",{className:"text-xs text-gray-400 block text-right mt-1",children:new Date(xe.timestamp).toLocaleString()})]},ze)):D.jsx("div",{className:"text-center text-sm text-gray-400 py-4",children:"No messages yet"})}),D.jsxs("div",{className:"flex",children:[D.jsx("label",{htmlFor:"file-input",className:"p-2 bg-gray-700 text-gray-300 hover:text-white rounded-l cursor-pointer",children:D.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),D.jsx("input",{id:"file-input",type:"file",className:"hidden",onChange:$t}),D.jsx("input",{type:"text",placeholder:"Type a message...",value:y,onChange:xe=>E(xe.target.value),onKeyDown:xe=>xe.key==="Enter"&&qt(),className:"flex-1 p-2 bg-gray-700 text-sm border-x-0 focus:outline-none focus:ring-1 focus:ring-blue-500"}),D.jsx("button",{onClick:qt,className:"p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-r transition-colors","aria-label":"Send message",children:D.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:D.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})]})}),(U||Ue)&&!d&&D.jsx(dye,{user:t,fetchCalls:Gn,calls:I,loadingCalls:w,selectedCapture:re,setSelectedCapture:Y,isLibraryOpen:U,setIsLibraryOpen:H,showCallHistory:Ue,setShowCallHistory:fe,deleteCapture:br,downloadCapture:Kt,actionDialog:Z,setActionDialog:ae,clearCallHistory:at}),!d&&!U&&!Ue&&D.jsx("div",{className:"text-center py-8",children:D.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg max-w-lg mx-auto",children:[D.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Welcome to Xrai Dashboard"}),D.jsx("p",{className:"mb-6",children:"Choose a contact from the sidebar to start a video call or chat, or click the buttons in the header to view your call history or library."}),D.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[D.jsxs("button",{className:"bg-blue-600/80 hover:bg-purple-700/80 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2 sm:px-3 border-white/30 rounded-lg transition-colors flex items-center justify-center gap-2 border border-white shadow w-full sm:w-auto",children:[D.jsx("div",{className:"bg-blue-900 hover:bg-blue-800 rounded-full p-2 flex items-center justify-center",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:D.jsx("path",{d:"M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"})})}),D.jsx("span",{children:"Start New Call"})]}),D.jsxs("button",{onClick:()=>{H(!0),Gn()},className:"bg-purple-600/80 hover:bg-blue-700/80 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2 sm:px-3 border-white/30 rounded-lg transition-colors flex items-center justify-center gap-2 border border-white shadow w-full sm:w-auto",children:[D.jsx("div",{className:"bg-blue-900/80 hover:bg-blue-800 rounded-full p-2 flex items-center justify-center",children:D.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:D.jsx("path",{d:"M4 0h5.293A1 1 0 0 1 10 .293L13.707 4a1 1 0 0 1 .293.707V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm5.5 1.5v2a1 1 0 0 0 1 1h2l-3-3zM2 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1H2zm9 0a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1zm-9 7a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1H2zm9 0a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1z"})})}),D.jsx("span",{children:"View Library"})]})]})]})})]})]}),A&&D.jsx(lye,{caller:A,onAccept:Gr,onReject:Xi,onClose:Ls}),$&&D.jsx(uye,{onClose:ee}),Z&&D.jsx(Aye,{message:Z.message,onConfirm:Z.onConfirm,onCancel:Z.onCancel})]})};function fye(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}var $m=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Zn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Sr=function(t){try{return!!t()}catch{return!0}},bI=!Sr(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),FJ=bI,VJ=Function.prototype,VL=VJ.call,pye=FJ&&VJ.bind.bind(VL,VL),mr=FJ?pye:function(t){return function(){return VL.apply(t,arguments)}},Bs=mr({}.isPrototypeOf),eT=function(t){return t&&t.Math==Math&&t},Ci=eT(typeof globalThis=="object"&&globalThis)||eT(typeof window=="object"&&window)||eT(typeof self=="object"&&self)||eT(typeof $m=="object"&&$m)||function(){return this}()||$m||Function("return this")(),mye=bI,QJ=Function.prototype,XH=QJ.apply,JH=QJ.call,mx=typeof Reflect=="object"&&Reflect.apply||(mye?JH.bind(XH):function(){return JH.apply(XH,arguments)}),HJ=mr,gye=HJ({}.toString),_ye=HJ("".slice),cl=function(t){return _ye(gye(t),8,-1)},Eye=cl,yye=mr,lv=function(t){if(Eye(t)==="Function")return yye(t)},eD=typeof document=="object"&&document.all,II={all:eD,IS_HTMLDDA:eD===void 0&&eD!==void 0},vye=II.all,Ti=II.IS_HTMLDDA?function(t){return typeof t=="function"||t===vye}:function(t){return typeof t=="function"},Aw={},Ba=!Sr(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),wye=bI,tT=Function.prototype.call,Si=wye?tT.bind(tT):function(){return tT.apply(tT,arguments)},RI={},jJ={}.propertyIsEnumerable,KJ=Object.getOwnPropertyDescriptor,Cye=KJ&&!jJ.call({1:2},1);RI.f=Cye?function(t){var e=KJ(this,t);return!!e&&e.enumerable}:jJ;var Ju,L0,ch=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Tye=Sr,Sye=cl,tD=Object,bye=mr("".split),OI=Tye(function(){return!tD("z").propertyIsEnumerable(0)})?function(t){return Sye(t)=="String"?bye(t,""):tD(t)}:tD,c_=function(t){return t==null},Iye=c_,Rye=TypeError,A_=function(t){if(Iye(t))throw Rye("Can't call method on "+t);return t},Oye=OI,Nye=A_,Ah=function(t){return Oye(Nye(t))},$H=Ti,Dye=II.all,ta=II.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:$H(t)||t===Dye}:function(t){return typeof t=="object"?t!==null:$H(t)},tA={},nD=tA,rD=Ci,Bye=Ti,ZH=function(t){return Bye(t)?t:void 0},Do=function(t,e){return arguments.length<2?ZH(nD[t])||ZH(rD[t]):nD[t]&&nD[t][e]||rD[t]&&rD[t][e]},Xf=typeof navigator<"u"&&String(navigator.userAgent)||"",GJ=Ci,iD=Xf,e3=GJ.process,t3=GJ.Deno,n3=e3&&e3.versions||t3&&t3.version,r3=n3&&n3.v8;r3&&(L0=(Ju=r3.split("."))[0]>0&&Ju[0]<4?1:+(Ju[0]+Ju[1])),!L0&&iD&&(!(Ju=iD.match(/Edge\/(\d+)/))||Ju[1]>=74)&&(Ju=iD.match(/Chrome\/(\d+)/))&&(L0=+Ju[1]);var Ff=L0,i3=Ff,Lye=Sr,Pye=Ci.String,l_=!!Object.getOwnPropertySymbols&&!Lye(function(){var t=Symbol();return!Pye(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&i3&&i3<41}),WJ=l_&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Uye=Do,kye=Ti,xye=Bs,Mye=Object,lw=WJ?function(t){return typeof t=="symbol"}:function(t){var e=Uye("Symbol");return kye(e)&&xye(e.prototype,Mye(t))},Fye=String,u_=function(t){try{return Fye(t)}catch{return"Object"}},Vye=Ti,Qye=u_,Hye=TypeError,vc=function(t){if(Vye(t))return t;throw Hye(Qye(t)+" is not a function")},jye=vc,Kye=c_,NI=function(t,e){var n=t[e];return Kye(n)?void 0:jye(n)},s3=Si,o3=Ti,a3=ta,Gye=TypeError,zJ={exports:{}},c3=Ci,Wye=Object.defineProperty,zye=function(t,e){try{Wye(c3,t,{value:e,configurable:!0,writable:!0})}catch{c3[t]=e}return e},A3="__core-js_shared__",gx=Ci[A3]||zye(A3,{}),l3=gx;(zJ.exports=function(t,e){return l3[t]||(l3[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var d_=zJ.exports,qye=A_,Yye=Object,Al=function(t){return Yye(qye(t))},Xye=Al,Jye=mr({}.hasOwnProperty),Mi=Object.hasOwn||function(t,e){return Jye(Xye(t),e)},$ye=mr,Zye=0,eve=Math.random(),tve=$ye(1 .toString),_x=function(t){return"Symbol("+(t===void 0?"":t)+")_"+tve(++Zye+eve,36)},nve=d_,u3=Mi,rve=_x,ive=l_,sve=WJ,Bm=Ci.Symbol,sD=nve("wks"),ove=sve?Bm.for||Bm:Bm&&Bm.withoutSetter||rve,cr=function(t){return u3(sD,t)||(sD[t]=ive&&u3(Bm,t)?Bm[t]:ove("Symbol."+t)),sD[t]},ave=Si,d3=ta,h3=lw,cve=NI,Ave=function(t,e){var n,r;if(o3(n=t.toString)&&!a3(r=s3(n,t))||o3(n=t.valueOf)&&!a3(r=s3(n,t)))return r;throw Gye("Can't convert object to primitive value")},lve=TypeError,uve=cr("toPrimitive"),dve=function(t,e){if(!d3(t)||h3(t))return t;var n,r=cve(t,uve);if(r){if(n=ave(r,t,e),!d3(n)||h3(n))return n;throw lve("Can't convert object to primitive value")}return Ave(t)},hve=lw,DI=function(t){var e=dve(t,"string");return hve(e)?e:e+""},f3=ta,QL=Ci.document,fve=f3(QL)&&f3(QL.createElement),Ex=function(t){return fve?QL.createElement(t):{}},pve=Ex,qJ=!Ba&&!Sr(function(){return Object.defineProperty(pve("div"),"a",{get:function(){return 7}}).a!=7}),mve=Ba,gve=Si,_ve=RI,Eve=ch,yve=Ah,vve=DI,wve=Mi,Cve=qJ,p3=Object.getOwnPropertyDescriptor;Aw.f=mve?p3:function(t,e){if(t=yve(t),e=vve(e),Cve)try{return p3(t,e)}catch{}if(wve(t,e))return Eve(!gve(_ve.f,t,e),t[e])};var Tve=Sr,Sve=Ti,bve=/#|\.prototype\./,uw=function(t,e){var n=Rve[Ive(t)];return n==Nve||n!=Ove&&(Sve(e)?Tve(e):!!e)},Ive=uw.normalize=function(t){return String(t).replace(bve,".").toLowerCase()},Rve=uw.data={},Ove=uw.NATIVE="N",Nve=uw.POLYFILL="P",YJ=uw,Dve=vc,Bve=bI,Lve=lv(lv.bind),lh=function(t,e){return Dve(t),e===void 0?t:Bve?Lve(t,e):function(){return t.apply(e,arguments)}},wc={},XJ=Ba&&Sr(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Pve=ta,Uve=String,kve=TypeError,ho=function(t){if(Pve(t))return t;throw kve(Uve(t)+" is not an object")},xve=Ba,Mve=qJ,Fve=XJ,nT=ho,m3=DI,Vve=TypeError,oD=Object.defineProperty,Qve=Object.getOwnPropertyDescriptor,aD="enumerable",cD="configurable",AD="writable";wc.f=xve?Fve?function(t,e,n){if(nT(t),e=m3(e),nT(n),typeof t=="function"&&e==="prototype"&&"value"in n&&AD in n&&!n[AD]){var r=Qve(t,e);r&&r[AD]&&(t[e]=n.value,n={configurable:cD in n?n[cD]:r[cD],enumerable:aD in n?n[aD]:r[aD],writable:!1})}return oD(t,e,n)}:oD:function(t,e,n){if(nT(t),e=m3(e),nT(n),Mve)try{return oD(t,e,n)}catch{}if("get"in n||"set"in n)throw Vve("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var Hve=wc,jve=ch,uh=Ba?function(t,e,n){return Hve.f(t,e,jve(1,n))}:function(t,e,n){return t[e]=n,t},rT=Ci,Kve=mx,Gve=lv,Wve=Ti,zve=Aw.f,qve=YJ,Qp=tA,Yve=lh,Hp=uh,g3=Mi,Xve=function(t){var e=function(n,r,i){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,i)}return Kve(t,this,arguments)};return e.prototype=t.prototype,e},sn=function(t,e){var n,r,i,s,o,a,A,l,d,f=t.target,p=t.global,g=t.stat,y=t.proto,E=p?rT:g?rT[f]:(rT[f]||{}).prototype,w=p?Qp:Qp[f]||Hp(Qp,f,{})[f],b=w.prototype;for(s in e)r=!(n=qve(p?s:f+(g?".":"#")+s,t.forced))&&E&&g3(E,s),a=w[s],r&&(A=t.dontCallGetSet?(d=zve(E,s))&&d.value:E[s]),o=r&&A?A:e[s],r&&typeof a==typeof o||(l=t.bind&&r?Yve(o,rT):t.wrap&&r?Xve(o):y&&Wve(o)?Gve(o):o,(t.sham||o&&o.sham||a&&a.sham)&&Hp(l,"sham",!0),Hp(w,s,l),y&&(g3(Qp,i=f+"Prototype")||Hp(Qp,i,{}),Hp(Qp[i],s,o),t.real&&b&&(n||!b[s])&&Hp(b,s,o)))},Jve=Math.ceil,$ve=Math.floor,Zve=Math.trunc||function(t){var e=+t;return(e>0?$ve:Jve)(e)},ewe=Zve,yx=function(t){var e=+t;return e!=e||e===0?0:ewe(e)},twe=yx,nwe=Math.max,rwe=Math.min,vx=function(t,e){var n=twe(t);return n<0?nwe(n+e,0):rwe(n,e)},iwe=yx,swe=Math.min,JJ=function(t){return t>0?swe(iwe(t),9007199254740991):0},owe=JJ,wu=function(t){return owe(t.length)},awe=Ah,cwe=vx,Awe=wu,_3=function(t){return function(e,n,r){var i,s=awe(e),o=Awe(s),a=cwe(r,o);if(t&&n!=n){for(;o>a;)if((i=s[a++])!=i)return!0}else for(;o>a;a++)if((t||a in s)&&s[a]===n)return t||a||0;return!t&&-1}},wx={includes:_3(!0),indexOf:_3(!1)},lwe=wx.includes;sn({target:"Array",proto:!0,forced:Sr(function(){return!Array(1).includes()})},{includes:function(t){return lwe(this,t,arguments.length>1?arguments[1]:void 0)}});var uwe=tA,Cc=function(t){return uwe[t+"Prototype"]},dwe=Cc("Array").includes,hwe=ta,fwe=cl,pwe=cr("match"),$J=function(t){var e;return hwe(t)&&((e=t[pwe])!==void 0?!!e:fwe(t)=="RegExp")},mwe=$J,gwe=TypeError,ZJ={};ZJ[cr("toStringTag")]="z";var Cx=String(ZJ)==="[object z]",_we=Cx,Ewe=Ti,P0=cl,ywe=cr("toStringTag"),vwe=Object,wwe=P0(function(){return arguments}())=="Arguments",ll=_we?P0:function(t){var e,n,r;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(i,s){try{return i[s]}catch{}}(e=vwe(t),ywe))=="string"?n:wwe?P0(e):(r=P0(e))=="Object"&&Ewe(e.callee)?"Arguments":r},Cwe=ll,Twe=String,La=function(t){if(Cwe(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return Twe(t)},Swe=cr("match"),bwe=sn,Iwe=function(t){if(mwe(t))throw gwe("The method doesn't accept regular expressions");return t},Rwe=A_,E3=La,Owe=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[Swe]=!1,"/./"[t](e)}catch{}}return!1},Nwe=mr("".indexOf);bwe({target:"String",proto:!0,forced:!Owe("includes")},{includes:function(t){return!!~Nwe(E3(Rwe(this)),E3(Iwe(t)),arguments.length>1?arguments[1]:void 0)}});var Dwe=Cc("String").includes,y3=Bs,Bwe=dwe,Lwe=Dwe,lD=Array.prototype,uD=String.prototype,Pwe=function(t){var e=t.includes;return t===lD||y3(lD,t)&&e===lD.includes?Bwe:typeof t=="string"||t===uD||y3(uD,t)&&e===uD.includes?Lwe:e},Se=Zn(Pwe),Uwe=vc,kwe=Al,xwe=OI,Mwe=wu,Fwe=TypeError,Vwe=function(t){return function(e,n,r,i){Uwe(n);var s=kwe(e),o=xwe(s),a=Mwe(s),A=t?a-1:0,l=t?-1:1;if(r<2)for(;;){if(A in o){i=o[A],A+=l;break}if(A+=l,t?A<0:a<=A)throw Fwe("Reduce of empty array with no initial value")}for(;t?A>=0:a>A;A+=l)A in o&&(i=n(i,o[A],A,s));return i}},Qwe={left:Vwe(!1)},Hwe=Sr,BI=function(t,e){var n=[][t];return!!n&&Hwe(function(){n.call(null,e||function(){return 1},1)})},dw=typeof process<"u"&&cl(process)=="process",jwe=Qwe.left;sn({target:"Array",proto:!0,forced:!dw&&Ff>79&&Ff<83||!BI("reduce")},{reduce:function(t){var e=arguments.length;return jwe(this,t,e,e>1?arguments[1]:void 0)}});var Kwe=Cc("Array").reduce,Gwe=Bs,Wwe=Kwe,dD=Array.prototype,zwe=function(t){var e=t.reduce;return t===dD||Gwe(dD,t)&&e===dD.reduce?Wwe:e},e$=zwe,Zc=Zn(e$);let t$=!0,n$=!0;function iT(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function Jf(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const A=l=>{const d=n(l);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,A),i.apply(this,[o,A])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const A=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,A])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function qwe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(t$=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Ywe(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(n$=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function r$(){if(typeof window=="object"){if(t$)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Tx(t,e){n$&&console.warn(t+" is deprecated, please use "+e+" instead.")}function v3(t){return Object.prototype.toString.call(t)==="[object Object]"}function i$(t){var e;return v3(t)?Zc(e=Object.keys(t)).call(e,function(n,r){const i=v3(t[r]),s=i?i$(t[r]):t[r],o=i&&!Object.keys(s).length;return s===void 0||o?n:Object.assign(n,{[r]:s})},{}):t}function HL(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?HL(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{HL(t,t.get(i),n)})}))}function w3(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&HL(t,a,i)})}),i}var Xwe=_x,C3=d_("keys"),LI=function(t){return C3[t]||(C3[t]=Xwe(t))},Jwe=!Sr(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),$we=Mi,Zwe=Ti,eCe=Al,tCe=Jwe,T3=LI("IE_PROTO"),jL=Object,nCe=jL.prototype,Sx=tCe?jL.getPrototypeOf:function(t){var e=eCe(t);if($we(e,T3))return e[T3];var n=e.constructor;return Zwe(n)&&e instanceof n?n.prototype:e instanceof jL?nCe:null},rCe=mr,iCe=vc,sCe=Ti,oCe=String,aCe=TypeError,cCe=function(t,e,n){try{return rCe(iCe(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},ACe=ho,lCe=function(t){if(typeof t=="object"||sCe(t))return t;throw aCe("Can't set "+oCe(t)+" as a prototype")},uCe=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=cCe(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(r,i){return ACe(r),lCe(i),e?t(r,i):r.__proto__=i,r}}():void 0),PI={},UI={},hD=Mi,dCe=Ah,hCe=wx.indexOf,fCe=UI,S3=mr([].push),s$=function(t,e){var n,r=dCe(t),i=0,s=[];for(n in r)!hD(fCe,n)&&hD(r,n)&&S3(s,n);for(;e.length>i;)hD(r,n=e[i++])&&(~hCe(s,n)||S3(s,n));return s},bx=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],pCe=s$,mCe=bx.concat("length","prototype");PI.f=Object.getOwnPropertyNames||function(t){return pCe(t,mCe)};var hw={};hw.f=Object.getOwnPropertySymbols;var gCe=Do,_Ce=PI,ECe=hw,yCe=ho,vCe=mr([].concat),wCe=gCe("Reflect","ownKeys")||function(t){var e=_Ce.f(yCe(t)),n=ECe.f;return n?vCe(e,n(t)):e},b3=Mi,CCe=wCe,TCe=Aw,SCe=wc,Ix={},bCe=s$,ICe=bx,kI=Object.keys||function(t){return bCe(t,ICe)},RCe=Ba,OCe=XJ,NCe=wc,DCe=ho,BCe=Ah,LCe=kI;Ix.f=RCe&&!OCe?Object.defineProperties:function(t,e){DCe(t);for(var n,r=BCe(e),i=LCe(e),s=i.length,o=0;s>o;)NCe.f(t,n=i[o++],r[n]);return t};var sT,o$=Do("document","documentElement"),PCe=ho,UCe=Ix,I3=bx,kCe=UI,xCe=o$,MCe=Ex,KL="prototype",GL="script",a$=LI("IE_PROTO"),fD=function(){},c$=function(t){return"<"+GL+">"+t+"</"+GL+">"},R3=function(t){t.write(c$("")),t.close();var e=t.parentWindow.Object;return t=null,e},U0=function(){try{sT=new ActiveXObject("htmlfile")}catch{}var t,e,n;U0=typeof document<"u"?document.domain&&sT?R3(sT):(e=MCe("iframe"),n="java"+GL+":",e.style.display="none",xCe.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(c$("document.F=Object")),t.close(),t.F):R3(sT);for(var r=I3.length;r--;)delete U0[KL][I3[r]];return U0()};kCe[a$]=!0;var fw=Object.create||function(t,e){var n;return t!==null?(fD[KL]=PCe(t),n=new fD,fD[KL]=null,n[a$]=t):n=U0(),e===void 0?n:UCe.f(n,e)},FCe=ta,VCe=uh,A$=Error,QCe=mr("".replace),HCe=String(A$("zxcasd").stack),l$=/\n\s*at [^:]*:[^\n]*/,jCe=l$.test(HCe),KCe=ch,GCe=!Sr(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",KCe(1,7)),t.stack!==7)}),WCe=uh,zCe=function(t,e){if(jCe&&typeof t=="string"&&!A$.prepareStackTrace)for(;e--;)t=QCe(t,l$,"");return t},qCe=GCe,O3=Error.captureStackTrace,$f={},YCe=$f,XCe=cr("iterator"),JCe=Array.prototype,u$=function(t){return t!==void 0&&(YCe.Array===t||JCe[XCe]===t)},$Ce=ll,N3=NI,ZCe=c_,eTe=$f,tTe=cr("iterator"),xI=function(t){if(!ZCe(t))return N3(t,tTe)||N3(t,"@@iterator")||eTe[$Ce(t)]},nTe=Si,rTe=vc,iTe=ho,sTe=u_,oTe=xI,aTe=TypeError,Rx=function(t,e){var n=arguments.length<2?oTe(t):e;if(rTe(n))return iTe(nTe(n,t));throw aTe(sTe(t)+" is not iterable")},cTe=Si,D3=ho,ATe=NI,d$=function(t,e,n){var r,i;D3(t);try{if(!(r=ATe(t,"return"))){if(e==="throw")throw n;return n}r=cTe(r,t)}catch(s){i=!0,r=s}if(e==="throw")throw n;if(i)throw r;return D3(r),n},lTe=lh,uTe=Si,dTe=ho,hTe=u_,fTe=u$,pTe=wu,B3=Bs,mTe=Rx,gTe=xI,L3=d$,_Te=TypeError,k0=function(t,e){this.stopped=t,this.result=e},P3=k0.prototype,pw=function(t,e,n){var r,i,s,o,a,A,l,d=n&&n.that,f=!(!n||!n.AS_ENTRIES),p=!(!n||!n.IS_RECORD),g=!(!n||!n.IS_ITERATOR),y=!(!n||!n.INTERRUPTED),E=lTe(e,d),w=function(I){return r&&L3(r,"normal",I),new k0(!0,I)},b=function(I){return f?(dTe(I),y?E(I[0],I[1],w):E(I[0],I[1])):y?E(I,w):E(I)};if(p)r=t.iterator;else if(g)r=t;else{if(!(i=gTe(t)))throw _Te(hTe(t)+" is not iterable");if(fTe(i)){for(s=0,o=pTe(t);o>s;s++)if((a=b(t[s]))&&B3(P3,a))return a;return new k0(!1)}r=mTe(t,i)}for(A=p?t.next:r.next;!(l=uTe(A,r)).done;){try{a=b(l.value)}catch(I){L3(r,"throw",I)}if(typeof a=="object"&&a&&B3(P3,a))return a}return new k0(!1)},ETe=La,yTe=sn,vTe=Bs,wTe=Sx,nb=uCe,CTe=function(t,e,n){for(var r=CCe(e),i=SCe.f,s=TCe.f,o=0;o<r.length;o++){var a=r[o];b3(t,a)||n&&b3(n,a)||i(t,a,s(e,a))}},h$=fw,pD=uh,mD=ch,TTe=function(t,e){FCe(e)&&"cause"in e&&VCe(t,"cause",e.cause)},STe=function(t,e,n,r){qCe&&(O3?O3(t,e):WCe(t,"stack",zCe(n,r)))},bTe=pw,ITe=function(t,e){return t===void 0?arguments.length<2?"":e:ETe(t)},RTe=cr("toStringTag"),rb=Error,OTe=[].push,Og=function(t,e){var n,r=vTe(gD,this);nb?n=nb(rb(),r?wTe(this):gD):(n=r?this:h$(gD),pD(n,RTe,"Error")),e!==void 0&&pD(n,"message",ITe(e)),STe(n,Og,n.stack,1),arguments.length>2&&TTe(n,arguments[2]);var i=[];return bTe(t,OTe,{that:i}),pD(n,"errors",i),n};nb?nb(Og,rb):CTe(Og,rb,{name:!0});var gD=Og.prototype=h$(rb.prototype,{constructor:mD(1,Og),message:mD(1,""),name:mD(1,"AggregateError")});yTe({global:!0},{AggregateError:Og});var ib,Oy,sb,NTe=Ti,U3=Ci.WeakMap,DTe=NTe(U3)&&/native code/.test(String(U3)),f$=Ci,BTe=ta,LTe=uh,_D=Mi,ED=gx,PTe=LI,UTe=UI,k3="Object already initialized",WL=f$.TypeError,kTe=f$.WeakMap;if(DTe||ED.state){var TA=ED.state||(ED.state=new kTe);TA.get=TA.get,TA.has=TA.has,TA.set=TA.set,ib=function(t,e){if(TA.has(t))throw WL(k3);return e.facade=t,TA.set(t,e),e},Oy=function(t){return TA.get(t)||{}},sb=function(t){return TA.has(t)}}else{var jp=PTe("state");UTe[jp]=!0,ib=function(t,e){if(_D(t,jp))throw WL(k3);return e.facade=t,LTe(t,jp,e),e},Oy=function(t){return _D(t,jp)?t[jp]:{}},sb=function(t){return _D(t,jp)}}var bf,x3,M3,Zf={set:ib,get:Oy,has:sb,enforce:function(t){return sb(t)?Oy(t):ib(t,{})},getterFor:function(t){return function(e){var n;if(!BTe(e)||(n=Oy(e)).type!==t)throw WL("Incompatible receiver, "+t+" required");return n}}},zL=Ba,xTe=Mi,p$=Function.prototype,MTe=zL&&Object.getOwnPropertyDescriptor,F3=xTe(p$,"name"),m$={PROPER:F3&&(function(){}).name==="something",CONFIGURABLE:F3&&(!zL||zL&&MTe(p$,"name").configurable)},FTe=uh,dh=function(t,e,n,r){return r&&r.enumerable?t[e]=n:FTe(t,e,n),t},VTe=Sr,QTe=Ti,HTe=ta,jTe=fw,V3=Sx,KTe=dh,qL=cr("iterator"),g$=!1;[].keys&&("next"in(M3=[].keys())?(x3=V3(V3(M3)))!==Object.prototype&&(bf=x3):g$=!0);var GTe=!HTe(bf)||VTe(function(){var t={};return bf[qL].call(t)!==t});QTe((bf=GTe?{}:jTe(bf))[qL])||KTe(bf,qL,function(){return this});var _$={IteratorPrototype:bf,BUGGY_SAFARI_ITERATORS:g$},WTe=ll,zTe=Cx?{}.toString:function(){return"[object "+WTe(this)+"]"},qTe=Cx,YTe=wc.f,XTe=uh,JTe=Mi,$Te=zTe,Q3=cr("toStringTag"),hh=function(t,e,n,r){if(t){var i=n?t:t.prototype;JTe(i,Q3)||YTe(i,Q3,{configurable:!0,value:e}),r&&!qTe&&XTe(i,"toString",$Te)}},ZTe=_$.IteratorPrototype,e0e=fw,t0e=ch,n0e=hh,r0e=$f,i0e=function(){return this},Ox=function(t,e,n,r){var i=e+" Iterator";return t.prototype=e0e(ZTe,{next:t0e(+!r,n)}),n0e(t,i,!1,!0),r0e[i]=i0e,t},s0e=sn,o0e=Si,a0e=m$,c0e=Ox,A0e=Sx,l0e=hh,H3=dh,j3=$f,u0e=_$,d0e=a0e.PROPER,oT=u0e.BUGGY_SAFARI_ITERATORS,yD=cr("iterator"),K3="keys",aT="values",G3="entries",h0e=function(){return this},E$=function(t,e,n,r,i,s,o){c0e(n,e,r);var a,A,l,d=function(b){if(b===i&&E)return E;if(!oT&&b in g)return g[b];switch(b){case K3:case aT:case G3:return function(){return new n(this,b)}}return function(){return new n(this)}},f=e+" Iterator",p=!1,g=t.prototype,y=g[yD]||g["@@iterator"]||i&&g[i],E=!oT&&y||d(i),w=e=="Array"&&g.entries||y;if(w&&(a=A0e(w.call(new t)))!==Object.prototype&&a.next&&(l0e(a,f,!0,!0),j3[f]=h0e),d0e&&i==aT&&y&&y.name!==aT&&(p=!0,E=function(){return o0e(y,this)}),i)if(A={values:d(aT),keys:s?E:d(K3),entries:d(G3)},o)for(l in A)(oT||p||!(l in g))&&H3(g,l,A[l]);else s0e({target:e,proto:!0,forced:oT||p},A);return o&&g[yD]!==E&&H3(g,yD,E,{}),j3[e]=E,A},Nx=function(t,e){return{value:t,done:e}},f0e=Ah,W3=$f,y$=Zf;wc.f;var p0e=E$,z3=Nx,v$="Array Iterator",m0e=y$.set,g0e=y$.getterFor(v$);p0e(Array,"Array",function(t,e){m0e(this,{type:v$,target:f0e(t),index:0,kind:e})},function(){var t=g0e(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,z3(void 0,!0)):z3(n=="keys"?r:n=="values"?e[r]:[r,e[r]],!1)},"values"),W3.Arguments=W3.Array;var _0e=wc,MI=function(t,e,n){return _0e.f(t,e,n)},E0e=Do,y0e=MI,v0e=Ba,q3=cr("species"),w0e=Bs,C0e=TypeError,Dx=function(t,e){if(w0e(e,t))return t;throw C0e("Incorrect invocation")},T0e=Ti,YL=gx,S0e=mr(Function.toString);T0e(YL.inspectSource)||(YL.inspectSource=function(t){return S0e(t)});var w$=YL.inspectSource,b0e=mr,I0e=Sr,C$=Ti,R0e=ll,O0e=w$,T$=function(){},N0e=[],S$=Do("Reflect","construct"),Bx=/^\s*(?:class|function)\b/,D0e=b0e(Bx.exec),B0e=!Bx.exec(T$),SE=function(t){if(!C$(t))return!1;try{return S$(T$,N0e,t),!0}catch{return!1}},b$=function(t){if(!C$(t))return!1;switch(R0e(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return B0e||!!D0e(Bx,O0e(t))}catch{return!0}};b$.sham=!0;var uv,Kp,Y3,vD,FI=!S$||I0e(function(){var t;return SE(SE.call)||!SE(Object)||!SE(function(){t=!0})||t})?b$:SE,L0e=FI,P0e=u_,U0e=TypeError,X3=ho,k0e=function(t){if(L0e(t))return t;throw U0e(P0e(t)+" is not a constructor")},x0e=c_,M0e=cr("species"),Lx=function(t,e){var n,r=X3(t).constructor;return r===void 0||x0e(n=X3(r)[M0e])?e:k0e(n)},Px=mr([].slice),F0e=TypeError,VI=function(t,e){if(t<e)throw F0e("Not enough arguments");return t},I$=/(?:ipad|iphone|ipod).*applewebkit/i.test(Xf),Ta=Ci,V0e=mx,Q0e=lh,J3=Ti,H0e=Mi,R$=Sr,$3=o$,j0e=Px,Z3=Ex,K0e=VI,G0e=I$,W0e=dw,XL=Ta.setImmediate,ej=Ta.clearImmediate,z0e=Ta.process,wD=Ta.Dispatch,q0e=Ta.Function,tj=Ta.MessageChannel,Y0e=Ta.String,CD=0,Ny={},nj="onreadystatechange";R$(function(){uv=Ta.location});var Ux=function(t){if(H0e(Ny,t)){var e=Ny[t];delete Ny[t],e()}},TD=function(t){return function(){Ux(t)}},rj=function(t){Ux(t.data)},ij=function(t){Ta.postMessage(Y0e(t),uv.protocol+"//"+uv.host)};XL&&ej||(XL=function(t){K0e(arguments.length,1);var e=J3(t)?t:q0e(t),n=j0e(arguments,1);return Ny[++CD]=function(){V0e(e,void 0,n)},Kp(CD),CD},ej=function(t){delete Ny[t]},W0e?Kp=function(t){z0e.nextTick(TD(t))}:wD&&wD.now?Kp=function(t){wD.now(TD(t))}:tj&&!G0e?(vD=(Y3=new tj).port2,Y3.port1.onmessage=rj,Kp=Q0e(vD.postMessage,vD)):Ta.addEventListener&&J3(Ta.postMessage)&&!Ta.importScripts&&uv&&uv.protocol!=="file:"&&!R$(ij)?(Kp=ij,Ta.addEventListener("message",rj,!1)):Kp=nj in Z3("script")?function(t){$3.appendChild(Z3("script"))[nj]=function(){$3.removeChild(this),Ux(t)}}:function(t){setTimeout(TD(t),0)});var O$={set:XL},N$=function(){this.head=null,this.tail=null};N$.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Gp,SD,bD,ID,sj,D$=N$,X0e=/ipad|iphone|ipod/i.test(Xf)&&typeof Pebble<"u",J0e=/web0s(?!.*chrome)/i.test(Xf),Vf=Ci,oj=lh,$0e=Aw.f,RD=O$.set,Z0e=D$,eSe=I$,tSe=X0e,nSe=J0e,OD=dw,aj=Vf.MutationObserver||Vf.WebKitMutationObserver,cj=Vf.document,Aj=Vf.process,cT=Vf.Promise,lj=$0e(Vf,"queueMicrotask"),JL=lj&&lj.value;if(!JL){var AT=new Z0e,lT=function(){var t,e;for(OD&&(t=Aj.domain)&&t.exit();e=AT.get();)try{e()}catch(n){throw AT.head&&Gp(),n}t&&t.enter()};eSe||OD||nSe||!aj||!cj?!tSe&&cT&&cT.resolve?((ID=cT.resolve(void 0)).constructor=cT,sj=oj(ID.then,ID),Gp=function(){sj(lT)}):OD?Gp=function(){Aj.nextTick(lT)}:(RD=oj(RD,Vf),Gp=function(){RD(lT)}):(SD=!0,bD=cj.createTextNode(""),new aj(lT).observe(bD,{characterData:!0}),Gp=function(){bD.data=SD=!SD}),JL=function(t){AT.head||Gp(),AT.add(t)}}var rSe=JL,h_=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},Qf=Ci.Promise,B$=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",iSe=!B$&&!dw&&typeof window=="object"&&typeof document=="object",sSe=Ci,Dy=Qf,oSe=Ti,aSe=YJ,cSe=w$,ASe=cr,lSe=iSe,uSe=B$,ND=Ff,uj=Dy&&Dy.prototype,dSe=ASe("species"),L$=oSe(sSe.PromiseRejectionEvent),hSe=aSe("Promise",function(){var t=cSe(Dy),e=t!==String(Dy);if(!e&&ND===66||!uj.catch||!uj.finally)return!0;if(!ND||ND<51||!/native code/.test(t)){var n=new Dy(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[dSe]=r,!(n.then(function(){})instanceof r))return!0}return!e&&(lSe||uSe)&&!L$}),mw={CONSTRUCTOR:hSe,REJECTION_EVENT:L$},ul={},dj=vc,fSe=TypeError,pSe=function(t){var e,n;this.promise=new t(function(r,i){if(e!==void 0||n!==void 0)throw fSe("Bad Promise constructor");e=r,n=i}),this.resolve=dj(e),this.reject=dj(n)};ul.f=function(t){return new pSe(t)};var DD,hj,mSe=sn,ob=dw,nh=Ci,gw=Si,gSe=dh,_Se=hh,ESe=function(t){var e=E0e(t);v0e&&e&&!e[q3]&&y0e(e,q3,{configurable:!0,get:function(){return this}})},ySe=vc,$L=Ti,vSe=ta,wSe=Dx,CSe=Lx,P$=O$.set,kx=rSe,TSe=function(t,e){try{arguments.length==1?console.error(t):console.error(t,e)}catch{}},SSe=h_,bSe=D$,U$=Zf,ZL=Qf,k$=mw,x$=ul,x0="Promise",fj=k$.CONSTRUCTOR,ISe=k$.REJECTION_EVENT,BD=U$.getterFor(x0),RSe=U$.set,OSe=ZL&&ZL.prototype,bE=ZL,LD=OSe,M$=nh.TypeError,eP=nh.document,xx=nh.process,tP=x$.f,NSe=tP,DSe=!!(eP&&eP.createEvent&&nh.dispatchEvent),F$="unhandledrejection",V$=function(t){var e;return!(!vSe(t)||!$L(e=t.then))&&e},Q$=function(t,e){var n,r,i,s=e.value,o=e.state==1,a=o?t.ok:t.fail,A=t.resolve,l=t.reject,d=t.domain;try{a?(o||(e.rejection===2&&LSe(e),e.rejection=1),a===!0?n=s:(d&&d.enter(),n=a(s),d&&(d.exit(),i=!0)),n===t.promise?l(M$("Promise-chain cycle")):(r=V$(n))?gw(r,n,A,l):A(n)):l(s)}catch(f){d&&!i&&d.exit(),l(f)}},H$=function(t,e){t.notified||(t.notified=!0,kx(function(){for(var n,r=t.reactions;n=r.get();)Q$(n,t);t.notified=!1,e&&!t.rejection&&BSe(t)}))},j$=function(t,e,n){var r,i;DSe?((r=eP.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),nh.dispatchEvent(r)):r={promise:e,reason:n},!ISe&&(i=nh["on"+t])?i(r):t===F$&&TSe("Unhandled promise rejection",n)},BSe=function(t){gw(P$,nh,function(){var e,n=t.facade,r=t.value;if(pj(t)&&(e=SSe(function(){ob?xx.emit("unhandledRejection",r,n):j$(F$,n,r)}),t.rejection=ob||pj(t)?2:1,e.error))throw e.value})},pj=function(t){return t.rejection!==1&&!t.parent},LSe=function(t){gw(P$,nh,function(){var e=t.facade;ob?xx.emit("rejectionHandled",e):j$("rejectionhandled",e,t.value)})},Lm=function(t,e,n){return function(r){t(e,r,n)}},Zm=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,H$(t,!0))},nP=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw M$("Promise can't be resolved itself");var r=V$(e);r?kx(function(){var i={done:!1};try{gw(r,e,Lm(nP,i,t),Lm(Zm,i,t))}catch(s){Zm(i,s,t)}}):(t.value=e,t.state=1,H$(t,!1))}catch(i){Zm({done:!1},i,t)}}};fj&&(LD=(bE=function(t){wSe(this,LD),ySe(t),gw(DD,this);var e=BD(this);try{t(Lm(nP,e),Lm(Zm,e))}catch(n){Zm(e,n)}}).prototype,(DD=function(t){RSe(this,{type:x0,done:!1,notified:!1,parent:!1,reactions:new bSe,rejection:!1,state:0,value:void 0})}).prototype=gSe(LD,"then",function(t,e){var n=BD(this),r=tP(CSe(this,bE));return n.parent=!0,r.ok=!$L(t)||t,r.fail=$L(e)&&e,r.domain=ob?xx.domain:void 0,n.state==0?n.reactions.add(r):kx(function(){Q$(r,n)}),r.promise}),hj=function(){var t=new DD,e=BD(t);this.promise=t,this.resolve=Lm(nP,e),this.reject=Lm(Zm,e)},x$.f=tP=function(t){return t===bE||t===void 0?new hj(t):NSe(t)}),mSe({global:!0,wrap:!0,forced:fj},{Promise:bE}),_Se(bE,x0,!1,!0),ESe(x0);var K$=cr("iterator"),G$=!1;try{var PSe=0,mj={next:function(){return{done:!!PSe++}},return:function(){G$=!0}};mj[K$]=function(){return this},Array.from(mj,function(){throw 2})}catch{}var USe=Qf,kSe=function(t,e){if(!G$)return!1;var n=!1;try{var r={};r[K$]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch{}return n},QI=mw.CONSTRUCTOR||!kSe(function(t){USe.all(t).then(void 0,function(){})}),xSe=Si,MSe=vc,FSe=ul,VSe=h_,QSe=pw;sn({target:"Promise",stat:!0,forced:QI},{all:function(t){var e=this,n=FSe.f(e),r=n.resolve,i=n.reject,s=VSe(function(){var o=MSe(e.resolve),a=[],A=0,l=1;QSe(t,function(d){var f=A++,p=!1;l++,xSe(o,e,d).then(function(g){p||(p=!0,a[f]=g,--l||r(a))},i)}),--l||r(a)});return s.error&&i(s.value),n.promise}});var HSe=sn,jSe=mw.CONSTRUCTOR;Qf&&Qf.prototype,HSe({target:"Promise",proto:!0,forced:jSe,real:!0},{catch:function(t){return this.then(void 0,t)}});var KSe=Si,GSe=vc,WSe=ul,zSe=h_,qSe=pw;sn({target:"Promise",stat:!0,forced:QI},{race:function(t){var e=this,n=WSe.f(e),r=n.reject,i=zSe(function(){var s=GSe(e.resolve);qSe(t,function(o){KSe(s,e,o).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var YSe=Si,XSe=ul;sn({target:"Promise",stat:!0,forced:mw.CONSTRUCTOR},{reject:function(t){var e=XSe.f(this);return YSe(e.reject,void 0,t),e.promise}});var JSe=ho,$Se=ta,ZSe=ul,W$=function(t,e){if(JSe(t),$Se(e)&&e.constructor===t)return e;var n=ZSe.f(t);return(0,n.resolve)(e),n.promise},ebe=sn,tbe=Qf,nbe=mw.CONSTRUCTOR,rbe=W$,ibe=Do("Promise"),sbe=!nbe;ebe({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return rbe(sbe&&this===ibe?tbe:this,t)}});var obe=Si,abe=vc,cbe=ul,Abe=h_,lbe=pw;sn({target:"Promise",stat:!0,forced:QI},{allSettled:function(t){var e=this,n=cbe.f(e),r=n.resolve,i=n.reject,s=Abe(function(){var o=abe(e.resolve),a=[],A=0,l=1;lbe(t,function(d){var f=A++,p=!1;l++,obe(o,e,d).then(function(g){p||(p=!0,a[f]={status:"fulfilled",value:g},--l||r(a))},function(g){p||(p=!0,a[f]={status:"rejected",reason:g},--l||r(a))})}),--l||r(a)});return s.error&&i(s.value),n.promise}});var ube=Si,dbe=vc,hbe=Do,fbe=ul,pbe=h_,mbe=pw,gj="No one promise resolved";sn({target:"Promise",stat:!0,forced:QI},{any:function(t){var e=this,n=hbe("AggregateError"),r=fbe.f(e),i=r.resolve,s=r.reject,o=pbe(function(){var a=dbe(e.resolve),A=[],l=0,d=1,f=!1;mbe(t,function(p){var g=l++,y=!1;d++,ube(a,e,p).then(function(E){y||f||(f=!0,i(E))},function(E){y||f||(y=!0,A[g]=E,--d||s(new n(A,gj)))})}),--d||s(new n(A,gj))});return o.error&&s(o.value),r.promise}});var gbe=sn,rP=Qf,_be=Sr,Ebe=Do,ybe=Ti,vbe=Lx,_j=W$,wbe=rP&&rP.prototype;gbe({target:"Promise",proto:!0,real:!0,forced:!!rP&&_be(function(){wbe.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=vbe(this,Ebe("Promise")),n=ybe(t);return this.then(n?function(r){return _j(e,t()).then(function(){return r})}:t,n?function(r){return _j(e,t()).then(function(){throw r})}:t)}});var Mx=mr,Cbe=yx,Tbe=La,Sbe=A_,bbe=Mx("".charAt),Ej=Mx("".charCodeAt),Ibe=Mx("".slice),yj=function(t){return function(e,n){var r,i,s=Tbe(Sbe(e)),o=Cbe(n),a=s.length;return o<0||o>=a?t?"":void 0:(r=Ej(s,o))<55296||r>56319||o+1===a||(i=Ej(s,o+1))<56320||i>57343?t?bbe(s,o):r:t?Ibe(s,o,o+2):i-56320+(r-55296<<10)+65536}},Fx={codeAt:yj(!1),charAt:yj(!0)},Rbe=Fx.charAt,Obe=La,z$=Zf,Nbe=E$,vj=Nx,q$="String Iterator",Dbe=z$.set,Bbe=z$.getterFor(q$);Nbe(String,"String",function(t){Dbe(this,{type:q$,string:Obe(t),index:0})},function(){var t,e=Bbe(this),n=e.string,r=e.index;return r>=n.length?vj(void 0,!0):(t=Rbe(n,r),e.index+=t.length,vj(t,!1))});var Lbe=tA.Promise,Pbe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ube=Ci,kbe=ll,xbe=uh,wj=$f,Cj=cr("toStringTag");for(var PD in Pbe){var Tj=Ube[PD],UD=Tj&&Tj.prototype;UD&&kbe(UD)!==Cj&&xbe(UD,Cj,PD),wj[PD]=wj.Array}var Y$=Lbe,we=Zn(Y$);const Sj=r$;function X$(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const a={};return Object.keys(o).forEach(A=>{if(A==="require"||A==="advanced"||A==="mediaSource")return;const l=typeof o[A]=="object"?o[A]:{ideal:o[A]};l.exact!==void 0&&typeof l.exact=="number"&&(l.min=l.max=l.exact);const d=function(f,p){return f?f+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(l.ideal!==void 0){a.optional=a.optional||[];let f={};typeof l.ideal=="number"?(f[d("min",A)]=l.ideal,a.optional.push(f),f={},f[d("max",A)]=l.ideal,a.optional.push(f)):(f[d("",A)]=l.ideal,a.optional.push(f))}l.exact!==void 0&&typeof l.exact!="number"?(a.mandatory=a.mandatory||{},a.mandatory[d("",A)]=l.exact):["min","max"].forEach(f=>{l[f]!==void 0&&(a.mandatory=a.mandatory||{},a.mandatory[d(f,A)]=l[f])})}),o.advanced&&(a.optional=(a.optional||[]).concat(o.advanced)),a},i=function(o,a){if(e.version>=61)return a(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){const A=function(l,d,f){d in l&&!(f in l)&&(l[f]=l[d],delete l[d])};A((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),A(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let A=o.video.facingMode;A=A&&(typeof A=="object"?A:{ideal:A});const l=e.version<66;if(A&&(A.exact==="user"||A.exact==="environment"||A.ideal==="user"||A.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||l)){let d;if(delete o.video.facingMode,A.exact==="environment"||A.ideal==="environment"?d=["back","rear"]:A.exact!=="user"&&A.ideal!=="user"||(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(f=>{let p=(f=f.filter(g=>g.kind==="videoinput")).find(g=>d.some(y=>{var E;return Se(E=g.label.toLowerCase()).call(E,y)}));return!p&&f.length&&Se(d).call(d,"back")&&(p=f[f.length-1]),p&&(o.video.deviceId=A.exact?{exact:p.deviceId}:{ideal:p.deviceId}),o.video=r(o.video),Sj("chrome: "+JSON.stringify(o)),a(o)})}o.video=r(o.video)}return Sj("chrome: "+JSON.stringify(o)),a(o)},s=function(o){return e.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(o,a,A){i(o,l=>{n.webkitGetUserMedia(l,a,d=>{A&&A(s(d))})})}).bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(a){return i(a,A=>o(A).then(l=>{if(A.audio&&!l.getAudioTracks().length||A.video&&!l.getVideoTracks().length)throw l.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return l},l=>we.reject(s(l))))}}}function J$(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function $$(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===r.track.id):{track:r.track};const s=new Event("track");s.track=r.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(r=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===r.id):{track:r};const s=new Event("track");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Jf(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function Z$(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){let A=i.apply(this,arguments);return A||(A=e(this,o),this._senders.push(A)),A};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const a=this._senders.indexOf(o);a!==-1&&this._senders.splice(a,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(s=>{const o=this._senders.find(a=>a.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function eZ(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const s=function(a){const A={};return a.result().forEach(l=>{const d={id:l.id,timestamp:l.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[l.type]||l.type};l.names().forEach(f=>{d[f]=l.stat(f)}),A[d.id]=d}),A},o=function(a){return new Map(Object.keys(a).map(A=>[A,a[A]]))};if(arguments.length>=2){const a=function(A){r(o(s(A)))};return e.apply(this,[a,n])}return new we((a,A)=>{e.apply(this,[function(l){a(o(s(l)))},A])}).then(r,i)}}function tZ(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>w3(s,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Jf(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>w3(i,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let r,i,s;return this.getSenders().forEach(o=>{o.track===n&&(r?s=!0:r=o)}),this.getReceivers().forEach(o=>(o.track===n&&(i?s=!0:i=o),o.track===n)),s||r&&i?we.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():we.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function nZ(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const a=e.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(a)===-1&&this._shimmedLocalStreams[o.id].push(a):this._shimmedLocalStreams[o.id]=[o,a],a};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(A=>{if(this.getSenders().find(d=>d.track===A))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const a=this.getSenders().filter(A=>o.indexOf(A)===-1);this._shimmedLocalStreams[s.id]=[s].concat(a)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const a=this._shimmedLocalStreams[o].indexOf(s);a!==-1&&this._shimmedLocalStreams[o].splice(a,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function rZ(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return nZ(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const A=n.apply(this);return this._reverseStreams=this._reverseStreams||{},A.map(l=>this._reverseStreams[l.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(A){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},A.getTracks().forEach(l=>{if(this.getSenders().find(f=>f.track===l))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[A.id]){const l=new t.MediaStream(A.getTracks());this._streams[A.id]=l,this._reverseStreams[l.id]=A,A=l}r.apply(this,[A])};const i=t.RTCPeerConnection.prototype.removeStream;function s(A,l){let d=l.sdp;return Object.keys(A._reverseStreams||[]).forEach(f=>{const p=A._reverseStreams[f],g=A._streams[p.id];d=d.replace(new RegExp(g.id,"g"),p.id)}),new RTCSessionDescription({type:l.type,sdp:d})}t.RTCPeerConnection.prototype.removeStream=function(A){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[A.id]||A]),delete this._reverseStreams[this._streams[A.id]?this._streams[A.id].id:A.id],delete this._streams[A.id]},t.RTCPeerConnection.prototype.addTrack=function(A,l){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(g=>g===A))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===A))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const p=this._streams[l.id];if(p)p.addTrack(A),we.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([A]);this._streams[l.id]=g,this._reverseStreams[g.id]=l,this.addStream(g)}return this.getSenders().find(g=>g.track===A)},["createOffer","createAnswer"].forEach(function(A){const l=t.RTCPeerConnection.prototype[A],d={[A](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?l.apply(this,[p=>{const g=s(this,p);f[0].apply(null,[g])},p=>{f[1]&&f[1].apply(null,p)},arguments[2]]):l.apply(this,arguments).then(p=>s(this,p))}};t.RTCPeerConnection.prototype[A]=d[A]});const o=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(A,l){let d=l.sdp;return Object.keys(A._reverseStreams||[]).forEach(f=>{const p=A._reverseStreams[f],g=A._streams[p.id];d=d.replace(new RegExp(p.id,"g"),g.id)}),new RTCSessionDescription({type:l.type,sdp:d})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const A=a.get.apply(this);return A.type===""?A:s(this,A)}}),t.RTCPeerConnection.prototype.removeTrack=function(A){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!A._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(A._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let l;this._streams=this._streams||{},Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(f=>A.track===f)&&(l=this._streams[d])}),l&&(l.getTracks().length===1?this.removeStream(this._reverseStreams[l.id]):l.removeTrack(A.track),this.dispatchEvent(new Event("negotiationneeded")))}}function iP(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function iZ(t,e){Jf(t,"negotiationneeded",n=>{const r=n.target;if(!(e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var bj=Object.freeze({__proto__:null,fixNegotiationNeeded:iZ,shimAddTrackRemoveTrack:rZ,shimAddTrackRemoveTrackWithNative:nZ,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(r=>{const i=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Z$,shimGetStats:eZ,shimGetUserMedia:X$,shimMediaStream:J$,shimOnTrack:$$,shimPeerConnection:iP,shimSenderReceiverGetStats:tZ});function sZ(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){Tx("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,a,A){a in o&&!(A in o)&&(o[A]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function oZ(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function sP(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,s,o]=arguments;return r.apply(this,[i||null]).then(a=>{if(e.version<53&&!s)try{a.forEach(A=>{A.type=n[A.type]||A.type})}catch(A){if(A.name!=="TypeError")throw A;a.forEach((l,d)=>{a.set(d,Object.assign({},l,{type:n[l.type]||l.type}))})}return a}).then(s,o)}}function aZ(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):we.resolve(new Map)}}function cZ(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Jf(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function AZ(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){Tx("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&Se(r=e.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function lZ(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function uZ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(r){const{sender:s}=i,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return i})}function dZ(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function hZ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?we.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function fZ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?we.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var Ij=Object.freeze({__proto__:null,shimAddTransceiver:uZ,shimCreateAnswer:fZ,shimCreateOffer:hZ,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,we.reject(r)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:dZ,shimGetUserMedia:sZ,shimOnTrack:oZ,shimPeerConnection:sP,shimRTCDataChannel:lZ,shimReceiverGetStats:cZ,shimRemoveStream:AZ,shimSenderGetStats:aZ});function pZ(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),Se(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>e.call(this,i,n)),n.getVideoTracks().forEach(i=>e.call(this,i,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i&&i.forEach(o=>{var a;this._localStreams?Se(a=this._localStreams).call(a,o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const r=e.getTracks();this.getSenders().forEach(i=>{Se(r).call(r,i.track)&&this.removeTrack(i)})})}}function mZ(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),Se(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,n.dispatchEvent(s)})}),e.apply(n,arguments)}}}function gZ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(A,l){const d=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[d]);return l?(f.then(A,l),we.resolve()):f},e.createAnswer=function(A,l){const d=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[d]);return l?(f.then(A,l),we.resolve()):f};let a=function(A,l,d){const f=i.apply(this,[A]);return d?(f.then(l,d),we.resolve()):f};e.setLocalDescription=a,a=function(A,l,d){const f=s.apply(this,[A]);return d?(f.then(l,d),we.resolve()):f},e.setRemoteDescription=a,a=function(A,l,d){const f=o.apply(this,[A]);return d?(f.then(l,d),we.resolve()):f},e.addIceCandidate=a}function _Z(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(EZ(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,r,i){e.mediaDevices.getUserMedia(n).then(r,i)}).bind(e))}function EZ(t){return t&&t.video!==void 0?Object.assign({},t,{video:i$(t.video)}):t}function yZ(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(Tx("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(n.iceServers[s])}n.iceServers=i}return new e(n,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function vZ(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function wZ(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function CZ(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var Rj=Object.freeze({__proto__:null,shimAudioContext:CZ,shimCallbacksAPI:gZ,shimConstraints:EZ,shimCreateOfferLegacy:wZ,shimGetUserMedia:_Z,shimLocalStreamsAPI:pZ,shimRTCIceServerUrls:yZ,shimRemoteStreamsAPI:mZ,shimTrackEventTransceiver:vZ}),TZ=`	
\v\f\r \u2028\u2029\uFEFF`,Mbe=A_,Fbe=La,oP=TZ,Oj=mr("".replace),Vbe=RegExp("^["+oP+"]+"),Qbe=RegExp("(^|[^"+oP+"])["+oP+"]+$"),Hbe=function(t){return function(e){var n=Fbe(Mbe(e));return 1&t&&(n=Oj(n,Vbe,"")),2&t&&(n=Oj(n,Qbe,"$1")),n}},jbe={trim:Hbe(3)},Kbe=m$.PROPER,Gbe=Sr,Nj=TZ,Wbe=jbe.trim;sn({target:"String",proto:!0,forced:function(t){return Gbe(function(){return!!Nj[t]()||""[t]()!==""||Kbe&&Nj[t].name!==t})}("trim")},{trim:function(){return Wbe(this)}});var zbe=Cc("String").trim,qbe=Bs,Ybe=zbe,kD=String.prototype,Xbe=function(t){var e=t.trim;return typeof t=="string"||t===kD||qbe(kD,t)&&e===kD.trim?Ybe:e},as=Zn(Xbe),SZ={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1])}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],s=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let o=3;o<i.length;o++){const a=i[o],A=e.matchPrefix(n,"a=rtpmap:"+a+" ")[0];if(A){const l=e.parseRtpMap(A),d=e.matchPrefix(n,"a=fmtp:"+a+" ");switch(l.parameters=d.length?e.parseFmtp(d[0]):{},l.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+a+" ").map(e.parseRtcpFb),r.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(l.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(o=>{r.headerExtensions.push(e.parseExtmap(o))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(o=>{s.forEach(a=>{o.rtcpFeedback.find(A=>A.type===a.type&&A.parameter===a.parameter)||o.rtcpFeedback.push(a)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(p=>e.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),A=a.length>0&&a[0].ssrc;let l;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(g=>parseInt(g,10)));d.length>0&&d[0].length>1&&d[0][0]===A&&(l=d[0][1]),i.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let g={ssrc:A,codecPayloadType:parseInt(p.parameters.apt,10)};A&&l&&(g.rtx={ssrc:l}),r.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:A,mechanism:o?"red+ulpfec":"red"},r.push(g))}}),r.length===0&&A&&r.push({ssrc:A});let f=e.matchPrefix(n,"b=");return f.length&&(f=f[0].indexOf("b=TIAS:")===0?parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?1e3*parseInt(f[0].substring(5),10)*.95-16e3:void 0,r.forEach(p=>{p.maxBitrate=f})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const A=a[0].substring(10).split(" ");return{port:parseInt(A[0],10),protocol:A[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return s=n||e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(SZ);var bZ=SZ.exports,eg=Zn(bZ),Jbe=fye({__proto__:null,default:eg},[bZ]);function M0(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new e(n),i=eg.parseCandidate(n.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,Jf(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function aP(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Jf(t,"icecandidate",e=>{if(e.candidate){const n=eg.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function F0(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const A=eg.splitSections(a.sdp);return A.shift(),A.some(l=>{const d=eg.parseMLine(l);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},r=function(a){const A=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(A===null||A.length<2)return-1;const l=parseInt(A[1],10);return l!=l?-1:l},i=function(a){let A=65536;return e.browser==="firefox"&&(A=e.version<57?a===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),A},s=function(a,A){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const d=eg.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?l=parseInt(d[0].substr(19),10):e.browser==="firefox"&&A!==-1&&(l=2147483637),l},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:a}=this.getConfiguration();a==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const a=r(arguments[0]),A=i(a),l=s(arguments[0],a);let d;d=A===0&&l===0?Number.POSITIVE_INFINITY:A===0||l===0?Math.max(A,l):Math.min(A,l);const f={};Object.defineProperty(f,"maxMessageSize",{get:()=>d}),this._sctp=f}return o.apply(this,arguments)}}function V0(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const o=arguments[0],a=o.length||o.size||o.byteLength;if(r.readyState==="open"&&i.sctp&&a>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Jf(t,"datachannel",r=>(e(r.channel,r.target),r))}function cP(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function AP(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(s=>as(s).call(s)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function Q0(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?we.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),we.resolve())})}function H0(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var $be=Object.freeze({__proto__:null,removeExtmapAllowMixed:AP,shimAddIceCandidateNullOrEmpty:Q0,shimConnectionState:cP,shimMaxMessageSize:F0,shimParameterlessSetLocalDescription:H0,shimRTCIceCandidate:M0,shimRTCIceCandidateRelayProtocol:aP,shimSendThrowTypeError:V0});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=r$,r=function(s){const o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;const{navigator:a}=s;if(a.mozGetUserMedia)o.browser="firefox",o.version=iT(a.userAgent,/Firefox\/(\d+)\./,1);else if(a.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=iT(a.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!a.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=iT(a.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o}(t),i={browserDetails:r,commonShim:$be,extractVersion:iT,disableLog:qwe,disableWarnings:Ywe,sdp:Jbe};switch(r.browser){case"chrome":if(!bj||!iP||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=bj,Q0(t,r),H0(t),X$(t,r),J$(t),iP(t,r),$$(t),rZ(t,r),Z$(t),eZ(t),tZ(t),iZ(t,r),M0(t),aP(t),cP(t),F0(t,r),V0(t),AP(t,r);break;case"firefox":if(!Ij||!sP||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=Ij,Q0(t,r),H0(t),sZ(t,r),sP(t,r),oZ(t),AZ(t),aZ(t),cZ(t),lZ(t),uZ(t),dZ(t),hZ(t),fZ(t),M0(t),cP(t),F0(t,r),V0(t);break;case"safari":if(!Rj||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=Rj,Q0(t,r),H0(t),yZ(t),wZ(t),gZ(t),pZ(t),mZ(t),vZ(t),_Z(t),CZ(t),M0(t),aP(t),F0(t,r),V0(t),AP(t,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Zbe=Cc("Array").keys,eIe=ll,tIe=Mi,nIe=Bs,rIe=Zbe,xD=Array.prototype,iIe={DOMTokenList:!0,NodeList:!0},sIe=function(t){var e=t.keys;return t===xD||nIe(xD,t)&&e===xD.keys||tIe(iIe,eIe(t))?rIe:e},Ko=Zn(sIe),Dj=u_,oIe=TypeError,aIe=DI,cIe=wc,AIe=ch,HI=function(t,e,n){var r=aIe(e);r in t?cIe.f(t,r,AIe(0,n)):t[r]=n},Bj=vx,lIe=wu,uIe=HI,dIe=Array,hIe=Math.max,Vx=function(t,e,n){for(var r=lIe(t),i=Bj(e,r),s=Bj(n===void 0?r:n,r),o=dIe(hIe(s-i,0)),a=0;i<s;i++,a++)uIe(o,a,t[i]);return o.length=a,o},Lj=Vx,fIe=Math.floor,lP=function(t,e){var n=t.length,r=fIe(n/2);return n<8?pIe(t,e):mIe(t,lP(Lj(t,0,r),e),lP(Lj(t,r),e),e)},pIe=function(t,e){for(var n,r,i=t.length,s=1;s<i;){for(r=s,n=t[s];r&&e(t[r-1],n)>0;)t[r]=t[--r];r!==s++&&(t[r]=n)}return t},mIe=function(t,e,n,r){for(var i=e.length,s=n.length,o=0,a=0;o<i||a<s;)t[o+a]=o<i&&a<s?r(e[o],n[a])<=0?e[o++]:n[a++]:o<i?e[o++]:n[a++];return t},IZ=lP,Pj=Xf.match(/firefox\/(\d+)/i),gIe=!!Pj&&+Pj[1],_Ie=/MSIE|Trident/.test(Xf),Uj=Xf.match(/AppleWebKit\/(\d+)\./),EIe=!!Uj&&+Uj[1],yIe=sn,RZ=mr,vIe=vc,wIe=Al,kj=wu,CIe=function(t,e){if(!delete t[e])throw oIe("Cannot delete property "+Dj(e)+" of "+Dj(t))},xj=La,Qx=Sr,TIe=IZ,SIe=BI,Mj=gIe,bIe=_Ie,Fj=Ff,Vj=EIe,Td=[],Qj=RZ(Td.sort),IIe=RZ(Td.push),RIe=Qx(function(){Td.sort(void 0)}),OIe=Qx(function(){Td.sort(null)}),NIe=SIe("sort"),Hj=!Qx(function(){if(Fj)return Fj<70;if(!(Mj&&Mj>3)){if(bIe)return!0;if(Vj)return Vj<603;var t,e,n,r,i="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Td.push({k:e+r,v:n})}for(Td.sort(function(s,o){return o.v-s.v}),r=0;r<Td.length;r++)e=Td[r].k.charAt(0),i.charAt(i.length-1)!==e&&(i+=e);return i!=="DGBEFHACIJK"}});yIe({target:"Array",proto:!0,forced:RIe||!OIe||!NIe||!Hj},{sort:function(t){t!==void 0&&vIe(t);var e=wIe(this);if(Hj)return t===void 0?Qj(e):Qj(e,t);var n,r,i=[],s=kj(e);for(r=0;r<s;r++)r in e&&IIe(i,e[r]);for(TIe(i,function(o){return function(a,A){return A===void 0?-1:a===void 0?1:o!==void 0?+o(a,A)||0:xj(a)>xj(A)?1:-1}}(t)),n=kj(i),r=0;r<n;)e[r]=i[r++];for(;r<s;)CIe(e,r++);return e}});var MD,FD,DIe=Cc("Array").sort,BIe=Bs,LIe=DIe,VD=Array.prototype,PIe=function(t){var e=t.sort;return t===VD||BIe(VD,t)&&e===VD.sort?LIe:e},_w=Zn(PIe),uP={exports:{}};MD=uP,FD=uP.exports,function(t,e){var n="function",r="undefined",i="object",s="string",o="major",a="model",A="name",l="type",d="vendor",f="version",p="architecture",g="console",y="mobile",E="tablet",w="smarttv",b="wearable",I="embedded",B="Amazon",U="Apple",H="ASUS",K="BlackBerry",x="Browser",V="Chrome",M="Firefox",O="Google",z="Huawei",$="LG",q="Microsoft",Ue="Motorola",fe="Opera",re="Samsung",Y="Sharp",Z="Sony",ae="Xiaomi",j="Zebra",C="Facebook",L="Chromium OS",k="Mac OS",ee=function(qt){for(var $t={},pt=0;pt<qt.length;pt++)$t[qt[pt].toUpperCase()]=qt[pt];return $t},_e=function(qt,$t){return typeof qt===s&&ke($t).indexOf(ke(qt))!==-1},ke=function(qt){return qt.toLowerCase()},ft=function(qt,$t){if(typeof qt===s)return qt=qt.replace(/^\s\s*/,""),typeof $t===r?qt:qt.substring(0,350)},Rt=function(qt,$t){for(var pt,Gn,br,Kt,at,er,xe=0;xe<$t.length&&!at;){var ze=$t[xe],ut=$t[xe+1];for(pt=Gn=0;pt<ze.length&&!at&&ze[pt];)if(at=ze[pt++].exec(qt))for(br=0;br<ut.length;br++)er=at[++Gn],typeof(Kt=ut[br])===i&&Kt.length>0?Kt.length===2?typeof Kt[1]==n?this[Kt[0]]=Kt[1].call(this,er):this[Kt[0]]=Kt[1]:Kt.length===3?typeof Kt[1]!==n||Kt[1].exec&&Kt[1].test?this[Kt[0]]=er?er.replace(Kt[1],Kt[2]):e:this[Kt[0]]=er?Kt[1].call(this,er,Kt[2]):e:Kt.length===4&&(this[Kt[0]]=er?Kt[3].call(this,er.replace(Kt[1],Kt[2])):e):this[Kt]=er||e;xe+=2}},Gr=function(qt,$t){for(var pt in $t)if(typeof $t[pt]===i&&$t[pt].length>0){for(var Gn=0;Gn<$t[pt].length;Gn++)if(_e($t[pt][Gn],qt))return pt==="?"?e:pt}else if(_e($t[pt],qt))return pt==="?"?e:pt;return qt},Xi={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ls={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[A,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[A,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[A,f],[/opios[\/ ]+([\w\.]+)/i],[f,[A,fe+" Mini"]],[/\bopr\/([\w\.]+)/i],[f,[A,fe]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[A,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[A,"UC"+x]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[f,[A,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[A,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[A,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[A,"IE"]],[/yabrowser\/([\w\.]+)/i],[f,[A,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[A,/(.+)/,"$1 Secure "+x],f],[/\bfocus\/([\w\.]+)/i],[f,[A,M+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[A,fe+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[A,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[A,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[A,fe+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[A,"MIUI "+x]],[/fxios\/([-\w\.]+)/i],[f,[A,M]],[/\bqihu|(qi?ho?o?|360)browser/i],[[A,"360 "+x]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[A,/(.+)/,"$1 "+x],f],[/(comodo_dragon)\/([\w\.]+)/i],[[A,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[A,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[A],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[A,C],f],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[A,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[A,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[A,V+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[A,V+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[A,"Android "+x]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[A,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[A,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,A],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[A,[f,Gr,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[A,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[A,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[A,M+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[A,f],[/(cobalt)\/([\w\.]+)/i],[A,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,ke]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,"",ke]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,ke]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a,[d,re],[l,E]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[a,[d,re],[l,y]],[/\((ip(?:hone|od)[\w ]*);/i],[a,[d,U],[l,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a,[d,U],[l,E]],[/(macintosh);/i],[a,[d,U]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a,[d,Y],[l,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a,[d,z],[l,E]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a,[d,z],[l,y]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[a,/_/g," "],[d,ae],[l,y]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a,/_/g," "],[d,ae],[l,E]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a,[d,"OPPO"],[l,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a,[d,"Vivo"],[l,y]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[a,[d,"Realme"],[l,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a,[d,Ue],[l,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a,[d,Ue],[l,E]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a,[d,$],[l,E]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a,[d,$],[l,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a,[d,"Lenovo"],[l,E]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a,/_/g," "],[d,"Nokia"],[l,y]],[/(pixel c)\b/i],[a,[d,O],[l,E]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a,[d,O],[l,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a,[d,Z],[l,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a,"Xperia Tablet"],[d,Z],[l,E]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a,[d,"OnePlus"],[l,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a,[d,B],[l,E]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a,/(.+)/g,"Fire Phone $1"],[d,B],[l,y]],[/(playbook);[-\w\),; ]+(rim)/i],[a,d,[l,E]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a,[d,K],[l,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a,[d,H],[l,E]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a,[d,H],[l,y]],[/(nexus 9)/i],[a,[d,"HTC"],[l,E]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[a,/_/g," "],[l,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a,[d,"Acer"],[l,E]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a,[d,"Meizu"],[l,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,a,[l,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,a,[l,E]],[/(surface duo)/i],[a,[d,q],[l,E]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a,[d,"Fairphone"],[l,y]],[/(u304aa)/i],[a,[d,"AT&T"],[l,y]],[/\bsie-(\w*)/i],[a,[d,"Siemens"],[l,y]],[/\b(rct\w+) b/i],[a,[d,"RCA"],[l,E]],[/\b(venue[\d ]{2,7}) b/i],[a,[d,"Dell"],[l,E]],[/\b(q(?:mv|ta)\w+) b/i],[a,[d,"Verizon"],[l,E]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a,[d,"Barnes & Noble"],[l,E]],[/\b(tm\d{3}\w+) b/i],[a,[d,"NuVision"],[l,E]],[/\b(k88) b/i],[a,[d,"ZTE"],[l,E]],[/\b(nx\d{3}j) b/i],[a,[d,"ZTE"],[l,y]],[/\b(gen\d{3}) b.+49h/i],[a,[d,"Swiss"],[l,y]],[/\b(zur\d{3}) b/i],[a,[d,"Swiss"],[l,E]],[/\b((zeki)?tb.*\b) b/i],[a,[d,"Zeki"],[l,E]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],a,[l,E]],[/\b(ns-?\w{0,9}) b/i],[a,[d,"Insignia"],[l,E]],[/\b((nxa|next)-?\w{0,9}) b/i],[a,[d,"NextBook"],[l,E]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],a,[l,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],a,[l,y]],[/\b(ph-1) /i],[a,[d,"Essential"],[l,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a,[d,"Envizen"],[l,E]],[/\b(trio[-\w\. ]+) b/i],[a,[d,"MachSpeed"],[l,E]],[/\btu_(1491) b/i],[a,[d,"Rotor"],[l,E]],[/(shield[\w ]+) b/i],[a,[d,"Nvidia"],[l,E]],[/(sprint) (\w+)/i],[d,a,[l,y]],[/(kin\.[onetw]{3})/i],[[a,/\./g," "],[d,q],[l,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a,[d,j],[l,E]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a,[d,j],[l,y]],[/smart-tv.+(samsung)/i],[d,[l,w]],[/hbbtv.+maple;(\d+)/i],[[a,/^/,"SmartTV"],[d,re],[l,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,$],[l,w]],[/(apple) ?tv/i],[d,[a,U+" TV"],[l,w]],[/crkey/i],[[a,V+"cast"],[d,O],[l,w]],[/droid.+aft(\w)( bui|\))/i],[a,[d,B],[l,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a,[d,Y],[l,w]],[/(bravia[\w ]+)( bui|\))/i],[a,[d,Z],[l,w]],[/(mitv-\w{5}) bui/i],[a,[d,ae],[l,w]],[/Hbbtv.*(technisat) (.*);/i],[d,a,[l,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[d,ft],[a,ft],[l,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,a,[l,g]],[/droid.+; (shield) bui/i],[a,[d,"Nvidia"],[l,g]],[/(playstation [345portablevi]+)/i],[a,[d,Z],[l,g]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a,[d,q],[l,g]],[/((pebble))app/i],[d,a,[l,b]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a,[d,U],[l,b]],[/droid.+; (glass) \d/i],[a,[d,O],[l,b]],[/droid.+; (wt63?0{2,3})\)/i],[a,[d,j],[l,b]],[/(quest( 2| pro)?)/i],[a,[d,C],[l,b]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[l,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[a,[l,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a,[l,E]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,E]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[l,y]],[/(android[-\w\. ]{0,9});.+buil/i],[a,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[A,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[A,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[A,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,A]],os:[[/microsoft (windows) (vista|xp)/i],[A,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[A,[f,Gr,Xi]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[A,"Windows"],[f,Gr,Xi]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[A,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[A,k],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,A],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[A,f],[/\(bb(10);/i],[f,[A,K]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[A,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[A,M+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[A,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[A,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[A,V+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[A,L],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[A,f],[/(sunos) ?([\w\.\d]*)/i],[[A,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[A,f]]},Ur=function(qt,$t){if(typeof qt===i&&($t=qt,qt=e),!(this instanceof Ur))return new Ur(qt,$t).getResult();var pt=typeof t!==r&&t.navigator?t.navigator:e,Gn=qt||(pt&&pt.userAgent?pt.userAgent:""),br=pt&&pt.userAgentData?pt.userAgentData:e,Kt=$t?function(at,er){var xe={};for(var ze in at)er[ze]&&er[ze].length%2==0?xe[ze]=er[ze].concat(at[ze]):xe[ze]=at[ze];return xe}(Ls,$t):Ls;return this.getBrowser=function(){var at={};return at[A]=e,at[f]=e,Rt.call(at,Gn,Kt.browser),at[o]=function(er){return typeof er===s?er.replace(/[^\d\.]/g,"").split(".")[0]:e}(at[f]),pt&&pt.brave&&typeof pt.brave.isBrave==n&&(at[A]="Brave"),at},this.getCPU=function(){var at={};return at[p]=e,Rt.call(at,Gn,Kt.cpu),at},this.getDevice=function(){var at={};return at[d]=e,at[a]=e,at[l]=e,Rt.call(at,Gn,Kt.device),!at[l]&&br&&br.mobile&&(at[l]=y),at[a]=="Macintosh"&&pt&&typeof pt.standalone!==r&&pt.maxTouchPoints&&pt.maxTouchPoints>2&&(at[a]="iPad",at[l]=E),at},this.getEngine=function(){var at={};return at[A]=e,at[f]=e,Rt.call(at,Gn,Kt.engine),at},this.getOS=function(){var at={};return at[A]=e,at[f]=e,Rt.call(at,Gn,Kt.os),!at[A]&&br&&br.platform!="Unknown"&&(at[A]=br.platform.replace(/chrome os/i,L).replace(/macos/i,k)),at},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Gn},this.setUA=function(at){return Gn=typeof at===s&&at.length>350?ft(at,350):at,this},this.setUA(Gn),this};Ur.VERSION="0.7.34",Ur.BROWSER=ee([A,f,o]),Ur.CPU=ee([p]),Ur.DEVICE=ee([a,d,l,g,y,w,E,b,I]),Ur.ENGINE=Ur.OS=ee([A,f]),MD.exports&&(FD=MD.exports=Ur),FD.UAParser=Ur;var Wr=typeof t!==r&&(t.jQuery||t.Zepto);if(Wr&&!Wr.ua){var kr=new Ur;Wr.ua=kr.getResult(),Wr.ua.get=function(){return kr.getUA()},Wr.ua.set=function(qt){kr.setUA(qt);var $t=kr.getResult();for(var pt in $t)Wr.ua[pt]=$t[pt]}}}(typeof window=="object"?window:$m);var UIe=Zn(uP.exports),kIe=ll,xIe=Mi,MIe=c_,FIe=$f,VIe=cr("iterator"),QIe=Object,HIe=function(t){if(MIe(t))return!1;var e=QIe(t);return e[VIe]!==void 0||"@@iterator"in e||xIe(FIe,kIe(e))},jIe=Zn(HIe),QD=Ci;sn({global:!0,forced:QD.globalThis!==QD},{globalThis:QD});var jj=Zn(Ci);function OZ(t,e){return function(){return t.apply(e,arguments)}}const{toString:KIe}=Object.prototype,{getPrototypeOf:Hx}=Object,ab=(HD=Object.create(null),t=>{const e=KIe.call(t);return HD[e]||(HD[e]=e.slice(8,-1).toLowerCase())});var HD;const dl=t=>(t=t.toLowerCase(),e=>ab(e)===t),jI=t=>e=>typeof e===t,{isArray:Cm}=Array,qE=jI("undefined"),Kj=dl("ArrayBuffer"),GIe=jI("string"),Wa=jI("function"),Gj=jI("number"),uT=t=>t!==null&&typeof t=="object",dT=t=>{if(ab(t)!=="object")return!1;const e=Hx(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||jIe(t))},WIe=dl("Date"),zIe=dl("File"),qIe=dl("Blob"),YIe=dl("FileList"),XIe=dl("URLSearchParams");function YE(t,e){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Cm(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const s=i?Object.getOwnPropertyNames(t):Object.keys(t),o=s.length;let a;for(n=0;n<o;n++)a=s[n],e.call(null,t[a],a,t)}}function Wj(t,e){e=e.toLowerCase();const n=Object.keys(t);let r,i=n.length;for(;i-- >0;)if(r=n[i],e===r.toLowerCase())return r;return null}const NZ=jj!==void 0?jj:typeof self<"u"?self:typeof window<"u"?window:global,zj=t=>!qE(t)&&t!==NZ,JIe=(jD=typeof Uint8Array<"u"&&Hx(Uint8Array),t=>jD&&t instanceof jD);var jD;const $Ie=dl("HTMLFormElement"),qj=(t=>{let{hasOwnProperty:e}=t;return(n,r)=>e.call(n,r)})(Object.prototype),ZIe=dl("RegExp"),Yj=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};YE(n,(i,s)=>{let o;(o=e(i,s,t))!==!1&&(r[s]=o||i)}),Object.defineProperties(t,r)},KD="abcdefghijklmnopqrstuvwxyz",Xj="0123456789",Jj={DIGIT:Xj,ALPHA:KD,ALPHA_DIGIT:KD+KD.toUpperCase()+Xj},eRe=dl("AsyncFunction");var Re={isArray:Cm,isArrayBuffer:Kj,isBuffer:function(t){return t!==null&&!qE(t)&&t.constructor!==null&&!qE(t.constructor)&&Wa(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Wa(t.append)&&((e=ab(t))==="formdata"||e==="object"&&Wa(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&Kj(t.buffer),e},isString:GIe,isNumber:Gj,isBoolean:t=>t===!0||t===!1,isObject:uT,isPlainObject:dT,isUndefined:qE,isDate:WIe,isFile:zIe,isBlob:qIe,isRegExp:ZIe,isFunction:Wa,isStream:t=>uT(t)&&Wa(t.pipe),isURLSearchParams:XIe,isTypedArray:JIe,isFileList:YIe,forEach:YE,merge:function t(){const{caseless:e}=zj(this)&&this||{},n={},r=(i,s)=>{const o=e&&Wj(n,s)||s;dT(n[o])&&dT(i)?n[o]=t(n[o],i):dT(i)?n[o]=t({},i):Cm(i)?n[o]=i.slice():n[o]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&YE(arguments[i],r);return n},extend:function(t,e,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return YE(e,(i,s)=>{n&&Wa(i)?t[s]=OZ(i,n):t[s]=i},{allOwnKeys:r}),t},trim:t=>as(t)?as(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,r)=>{let i,s,o;const a={};if(e=e||{},t==null)return e;do{for(i=Object.getOwnPropertyNames(t),s=i.length;s-- >0;)o=i[s],r&&!r(o,t,e)||a[o]||(e[o]=t[o],a[o]=!0);t=n!==!1&&Hx(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:ab,kindOfTest:dl,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},toArray:t=>{if(!t)return null;if(Cm(t))return t;let e=t.length;if(!Gj(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const i=r.value;e.call(t,i[0],i[1])}},matchAll:(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},isHTMLForm:$Ie,hasOwnProperty:qj,hasOwnProp:qj,reduceDescriptors:Yj,freezeMethods:t=>{Yj(t,(e,n)=>{if(Wa(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];Wa(r)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},r=i=>{i.forEach(s=>{n[s]=!0})};return Cm(t)?r(t):r(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(t,e)=>(t=+t,Number.isFinite(t)?t:e),findKey:Wj,global:NZ,isContextDefined:zj,ALPHABET:Jj,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Jj.ALPHA_DIGIT,n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n},isSpecCompliantForm:function(t){return!!(t&&Wa(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(r,i)=>{if(uT(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const s=Cm(r)?[]:{};return YE(r,(o,a)=>{const A=n(o,i+1);!qE(A)&&(s[a]=A)}),e[i]=void 0,s}}return r};return n(t,0)},isAsyncFn:eRe,isThenable:t=>t&&(uT(t)||Wa(t))&&Wa(t.then)&&Wa(t.catch)};function Rn(t,e,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}Re.inherits(Rn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Re.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const $j=Rn.prototype,Zj={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Zj[t]={value:t}}),Object.defineProperties(Rn,Zj),Object.defineProperty($j,"isAxiosError",{value:!0}),Rn.from=(t,e,n,r,i,s)=>{const o=Object.create($j);return Re.toFlatObject(t,o,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),Rn.call(o,t.message,e,n,r,i),o.cause=t,o.name=t.name,s&&Object.assign(o,s),o};function GD(t){return Re.isPlainObject(t)||Re.isArray(t)}function DZ(t){return Re.endsWith(t,"[]")?t.slice(0,-2):t}function e5(t,e,n){return t?t.concat(e).map(function(r,i){return r=DZ(r),!n&&i?"["+r+"]":r}).join(n?".":""):e}const tRe=Re.toFlatObject(Re,{},null,function(t){return/^is[A-Z]/.test(t)});function cb(t,e,n){if(!Re.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const r=(n=Re.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(p,g){return!Re.isUndefined(g[p])})).metaTokens,i=n.visitor||l,s=n.dots,o=n.indexes,a=(n.Blob||typeof Blob<"u"&&Blob)&&Re.isSpecCompliantForm(e);if(!Re.isFunction(i))throw new TypeError("visitor must be a function");function A(p){if(p===null)return"";if(Re.isDate(p))return p.toISOString();if(!a&&Re.isBlob(p))throw new Rn("Blob is not supported. Use a Buffer instead.");return Re.isArrayBuffer(p)||Re.isTypedArray(p)?a&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function l(p,g,y){let E=p;if(p&&!y&&typeof p=="object"){if(Re.endsWith(g,"{}"))g=r?g:g.slice(0,-2),p=JSON.stringify(p);else if(Re.isArray(p)&&function(w){return Re.isArray(w)&&!w.some(GD)}(p)||(Re.isFileList(p)||Re.endsWith(g,"[]"))&&(E=Re.toArray(p)))return g=DZ(g),E.forEach(function(w,b){!Re.isUndefined(w)&&w!==null&&e.append(o===!0?e5([g],b,s):o===null?g:g+"[]",A(w))}),!1}return!!GD(p)||(e.append(e5(y,g,s),A(p)),!1)}const d=[],f=Object.assign(tRe,{defaultVisitor:l,convertValue:A,isVisitable:GD});if(!Re.isObject(t))throw new TypeError("data must be an object");return function p(g,y){if(!Re.isUndefined(g)){if(d.indexOf(g)!==-1)throw Error("Circular reference detected in "+y.join("."));d.push(g),Re.forEach(g,function(E,w){(!(Re.isUndefined(E)||E===null)&&i.call(e,E,Re.isString(w)?as(w).call(w):w,y,f))===!0&&p(E,y?y.concat(w):[w])}),d.pop()}}(t),e}function t5(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function jx(t,e){this._pairs=[],t&&cb(t,this,e)}const n5=jx.prototype;function nRe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function BZ(t,e,n){if(!e)return t;const r=n&&n.encode||nRe,i=n&&n.serialize;let s;if(s=i?i(e,n):Re.isURLSearchParams(e)?e.toString():new jx(e,n).toString(r),s){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}n5.append=function(t,e){this._pairs.push([t,e])},n5.toString=function(t){const e=t?function(n){return t.call(this,n,t5)}:t5;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var r5=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Re.forEach(this.handlers,function(e){e!==null&&t(e)})}},LZ={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},PZ={exports:{}},rRe=sn,iRe=Ba,i5=wc.f;rRe({target:"Object",stat:!0,forced:Object.defineProperty!==i5,sham:!iRe},{defineProperty:i5});var UZ=tA.Object,sRe=PZ.exports=function(t,e,n){return UZ.defineProperty(t,e,n)};UZ.defineProperty.sham&&(sRe.sham=!0);var kZ=Zn(PZ.exports),oRe=cl,Ew=Array.isArray||function(t){return oRe(t)=="Array"},aRe=TypeError,s5=Ew,cRe=FI,ARe=ta,lRe=cr("species"),o5=Array,uRe=function(t){var e;return s5(t)&&(e=t.constructor,(cRe(e)&&(e===o5||s5(e.prototype))||ARe(e)&&(e=e[lRe])===null)&&(e=void 0)),e===void 0?o5:e},xZ=function(t,e){return new(uRe(t))(e===0?0:e)},dRe=Sr,hRe=Ff,fRe=cr("species"),MZ=function(t){return hRe>=51||!dRe(function(){var e=[];return(e.constructor={})[fRe]=function(){return{foo:1}},e[t](Boolean).foo!==1})},pRe=sn,mRe=Sr,gRe=Ew,_Re=ta,ERe=Al,yRe=wu,a5=function(t){if(t>9007199254740991)throw aRe("Maximum allowed index exceeded");return t},c5=HI,vRe=xZ,wRe=MZ,CRe=Ff,FZ=cr("isConcatSpreadable"),TRe=CRe>=51||!mRe(function(){var t=[];return t[FZ]=!1,t.concat()[0]!==t}),SRe=function(t){if(!_Re(t))return!1;var e=t[FZ];return e!==void 0?!!e:gRe(t)};pRe({target:"Array",proto:!0,forced:!TRe||!wRe("concat")},{concat:function(t){var e,n,r,i,s,o=ERe(this),a=vRe(o,0),A=0;for(e=-1,r=arguments.length;e<r;e++)if(SRe(s=e===-1?o:arguments[e]))for(i=yRe(s),a5(A+i),n=0;n<i;n++,A++)n in s&&c5(a,A,s[n]);else a5(A+1),c5(a,A++,s);return a.length=A,a}});var VZ={},bRe=cl,IRe=Ah,A5=PI.f,RRe=Vx,l5=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];VZ.f=function(t){return l5&&bRe(t)=="Window"?function(e){try{return A5(e)}catch{return RRe(l5)}}(t):A5(IRe(t))};var f_={},ORe=cr;f_.f=ORe;var u5=tA,NRe=Mi,DRe=f_,BRe=wc.f,gi=function(t){var e=u5.Symbol||(u5.Symbol={});NRe(e,t)||BRe(e,t,{value:DRe.f(t)})},LRe=Si,PRe=Do,URe=cr,kRe=dh,QZ=function(){var t=PRe("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,r=URe("toPrimitive");e&&!e[r]&&kRe(e,r,function(i){return LRe(n,this)},{})},xRe=lh,MRe=OI,FRe=Al,VRe=wu,QRe=xZ,d5=mr([].push),HRe=function(t){var e=t==1,n=t==2,r=t==3,i=t==4,s=t==6,o=t==7,a=t==5||s;return function(A,l,d,f){for(var p,g,y=FRe(A),E=MRe(y),w=xRe(l,d),b=VRe(E),I=0,B=f||QRe,U=e?B(A,b):n||o?B(A,0):void 0;b>I;I++)if((a||I in E)&&(g=w(p=E[I],I,y),t))if(e)U[I]=g;else if(g)switch(t){case 3:return!0;case 5:return p;case 6:return I;case 2:d5(U,p)}else switch(t){case 4:return!1;case 7:d5(U,p)}return s?-1:r||i?i:U}},HZ={forEach:HRe(0)},hT=sn,Kx=Ci,Gx=Si,jRe=mr,tg=Ba,Wp=l_,KRe=Sr,bs=Mi,GRe=Bs,dP=ho,KI=Ah,Wx=DI,WRe=La,hP=ch,dv=fw,jZ=kI,zRe=PI,KZ=VZ,qRe=hw,GZ=Aw,WZ=wc,YRe=Ix,zZ=RI,h5=dh,XRe=MI,zx=d_,qZ=UI,f5=_x,JRe=cr,$Re=f_,ZRe=gi,eOe=QZ,tOe=hh,YZ=Zf,GI=HZ.forEach,Wo=LI("hidden"),Ab="Symbol",hv="prototype",nOe=YZ.set,p5=YZ.getterFor(Ab),Yc=Object[hv],Pm=Kx.Symbol,j0=Pm&&Pm[hv],rOe=Kx.TypeError,WD=Kx.QObject,XZ=GZ.f,sf=WZ.f,JZ=KZ.f,iOe=zZ.f,$Z=jRe([].push),mu=zx("symbols"),yw=zx("op-symbols"),sOe=zx("wks"),zD=!WD||!WD[hv]||!WD[hv].findChild,fP=tg&&KRe(function(){return dv(sf({},"a",{get:function(){return sf(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var r=XZ(Yc,e);r&&delete Yc[e],sf(t,e,n),r&&t!==Yc&&sf(Yc,e,r)}:sf,qD=function(t,e){var n=mu[t]=dv(j0);return nOe(n,{type:Ab,tag:t,description:e}),tg||(n.description=e),n},lb=function(t,e,n){t===Yc&&lb(yw,e,n),dP(t);var r=Wx(e);return dP(n),bs(mu,r)?(n.enumerable?(bs(t,Wo)&&t[Wo][r]&&(t[Wo][r]=!1),n=dv(n,{enumerable:hP(0,!1)})):(bs(t,Wo)||sf(t,Wo,hP(1,{})),t[Wo][r]=!0),fP(t,r,n)):sf(t,r,n)},YD=function(t,e){dP(t);var n=KI(e),r=jZ(n).concat(eee(n));return GI(r,function(i){tg&&!Gx(ZZ,n,i)||lb(t,i,n[i])}),t},ZZ=function(t){var e=Wx(t),n=Gx(iOe,this,e);return!(this===Yc&&bs(mu,e)&&!bs(yw,e))&&(!(n||!bs(this,e)||!bs(mu,e)||bs(this,Wo)&&this[Wo][e])||n)},m5=function(t,e){var n=KI(t),r=Wx(e);if(n!==Yc||!bs(mu,r)||bs(yw,r)){var i=XZ(n,r);return!i||!bs(mu,r)||bs(n,Wo)&&n[Wo][r]||(i.enumerable=!0),i}},g5=function(t){var e=JZ(KI(t)),n=[];return GI(e,function(r){bs(mu,r)||bs(qZ,r)||$Z(n,r)}),n},eee=function(t){var e=t===Yc,n=JZ(e?yw:KI(t)),r=[];return GI(n,function(i){!bs(mu,i)||e&&!bs(Yc,i)||$Z(r,mu[i])}),r};Wp||(h5(j0=(Pm=function(){if(GRe(j0,this))throw rOe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?WRe(arguments[0]):void 0,e=f5(t),n=function(r){this===Yc&&Gx(n,yw,r),bs(this,Wo)&&bs(this[Wo],e)&&(this[Wo][e]=!1),fP(this,e,hP(1,r))};return tg&&zD&&fP(Yc,e,{configurable:!0,set:n}),qD(e,t)})[hv],"toString",function(){return p5(this).tag}),h5(Pm,"withoutSetter",function(t){return qD(f5(t),t)}),zZ.f=ZZ,WZ.f=lb,YRe.f=YD,GZ.f=m5,zRe.f=KZ.f=g5,qRe.f=eee,$Re.f=function(t){return qD(JRe(t),t)},tg&&XRe(j0,"description",{configurable:!0,get:function(){return p5(this).description}})),hT({global:!0,wrap:!0,forced:!Wp,sham:!Wp},{Symbol:Pm}),GI(jZ(sOe),function(t){ZRe(t)}),hT({target:Ab,stat:!0,forced:!Wp},{useSetter:function(){zD=!0},useSimple:function(){zD=!1}}),hT({target:"Object",stat:!0,forced:!Wp,sham:!tg},{create:function(t,e){return e===void 0?dv(t):YD(dv(t),e)},defineProperty:lb,defineProperties:YD,getOwnPropertyDescriptor:m5}),hT({target:"Object",stat:!0,forced:!Wp},{getOwnPropertyNames:g5}),eOe(),tOe(Pm,Ab),qZ[Wo]=!0;var tee=l_&&!!Symbol.for&&!!Symbol.keyFor,oOe=sn,aOe=Do,cOe=Mi,AOe=La,nee=d_,lOe=tee,XD=nee("string-to-symbol-registry"),uOe=nee("symbol-to-string-registry");oOe({target:"Symbol",stat:!0,forced:!lOe},{for:function(t){var e=AOe(t);if(cOe(XD,e))return XD[e];var n=aOe("Symbol")(e);return XD[e]=n,uOe[n]=e,n}});var dOe=sn,hOe=Mi,fOe=lw,pOe=u_,mOe=tee,_5=d_("symbol-to-string-registry");dOe({target:"Symbol",stat:!0,forced:!mOe},{keyFor:function(t){if(!fOe(t))throw TypeError(pOe(t)+" is not a symbol");if(hOe(_5,t))return _5[t]}});var E5=Ew,gOe=Ti,y5=cl,_Oe=La,v5=mr([].push),EOe=sn,ree=Do,iee=mx,yOe=Si,vw=mr,see=Sr,w5=Ti,C5=lw,oee=Px,vOe=function(t){if(gOe(t))return t;if(E5(t)){for(var e=t.length,n=[],r=0;r<e;r++){var i=t[r];typeof i=="string"?v5(n,i):typeof i!="number"&&y5(i)!="Number"&&y5(i)!="String"||v5(n,_Oe(i))}var s=n.length,o=!0;return function(a,A){if(o)return o=!1,A;if(E5(this))return A;for(var l=0;l<s;l++)if(n[l]===a)return A}}},wOe=l_,COe=String,Md=ree("JSON","stringify"),fT=vw(/./.exec),T5=vw("".charAt),TOe=vw("".charCodeAt),SOe=vw("".replace),bOe=vw(1 .toString),IOe=/[\uD800-\uDFFF]/g,S5=/^[\uD800-\uDBFF]$/,b5=/^[\uDC00-\uDFFF]$/,I5=!wOe||see(function(){var t=ree("Symbol")();return Md([t])!="[null]"||Md({a:t})!="{}"||Md(Object(t))!="{}"}),R5=see(function(){return Md("\uDF06\uD834")!=='"\\udf06\\ud834"'||Md("\uDEAD")!=='"\\udead"'}),ROe=function(t,e){var n=oee(arguments),r=vOe(e);if(w5(r)||t!==void 0&&!C5(t))return n[1]=function(i,s){if(w5(r)&&(s=yOe(r,this,COe(i),s)),!C5(s))return s},iee(Md,null,n)},OOe=function(t,e,n){var r=T5(n,e-1),i=T5(n,e+1);return fT(S5,t)&&!fT(b5,i)||fT(b5,t)&&!fT(S5,r)?"\\u"+bOe(TOe(t,0),16):t};Md&&EOe({target:"JSON",stat:!0,forced:I5||R5},{stringify:function(t,e,n){var r=oee(arguments),i=iee(I5?ROe:Md,null,r);return R5&&typeof i=="string"?SOe(i,IOe,OOe):i}});var O5=hw,NOe=Al;sn({target:"Object",stat:!0,forced:!l_||Sr(function(){O5.f(1)})},{getOwnPropertySymbols:function(t){var e=O5.f;return e?e(NOe(t)):[]}}),gi("asyncIterator"),gi("hasInstance"),gi("isConcatSpreadable"),gi("iterator"),gi("match"),gi("matchAll"),gi("replace"),gi("search"),gi("species"),gi("split");var DOe=QZ;gi("toPrimitive"),DOe();var BOe=Do,LOe=hh;gi("toStringTag"),LOe(BOe("Symbol"),"Symbol"),gi("unscopables"),hh(Ci.JSON,"JSON",!0);var POe=tA.Symbol,UOe=cr,kOe=wc.f,N5=UOe("metadata"),D5=Function.prototype;D5[N5]===void 0&&kOe(D5,N5,{value:null}),gi("dispose"),gi("metadata");var xOe=POe;gi("asyncDispose");var MOe=mr,qx=Do("Symbol"),FOe=qx.keyFor,VOe=MOe(qx.prototype.valueOf),aee=qx.isRegisteredSymbol||function(t){try{return FOe(VOe(t))!==void 0}catch{return!1}};sn({target:"Symbol",stat:!0},{isRegisteredSymbol:aee});for(var QOe=d_,B5=Do,HOe=mr,jOe=lw,KOe=cr,pT=B5("Symbol"),L5=pT.isWellKnownSymbol,cee=B5("Object","getOwnPropertyNames"),GOe=HOe(pT.prototype.valueOf),P5=QOe("wks"),JD=0,U5=cee(pT),WOe=U5.length;JD<WOe;JD++)try{var k5=U5[JD];jOe(pT[k5])&&KOe(k5)}catch{}var x5=function(t){if(L5&&L5(t))return!0;try{for(var e=GOe(t),n=0,r=cee(P5),i=r.length;n<i;n++)if(P5[r[n]]==e)return!0}catch{}return!1};sn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:x5}),gi("matcher"),gi("observable"),sn({target:"Symbol",stat:!0},{isRegistered:aee}),sn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:x5}),gi("metadataKey"),gi("patternMatch"),gi("replaceAll");var Um=Zn(xOe),Aee=Zn(f_.f("iterator"));function By(t){return By=typeof Um=="function"&&typeof Aee=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Um=="function"&&e.constructor===Um&&e!==Um.prototype?"symbol":typeof e},By(t)}var zOe=Zn(f_.f("toPrimitive"));function qOe(t){var e=function(n,r){if(By(n)!=="object"||n===null)return n;var i=n[zOe];if(i!==void 0){var s=i.call(n,r);if(By(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(t,"string");return By(e)==="symbol"?e:String(e)}function N(t,e,n){return(e=qOe(e))in t?kZ(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var YOe=Sr,XOe=cr("iterator"),Yx=!YOe(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return t.pathname="c%20d",e.forEach(function(i,s){e.delete("b"),r+=s+i}),n.delete("a",2),!t.toJSON||!n.has("a",1)||n.has("a",2)||!e.size&&!0||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[XOe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("http://x",void 0).host!=="x"}),JOe=dh,$D=sn,Ng=Ci,mT=Si,nl=mr,km=Ba,M5=Yx,F5=dh,$Oe=MI,ZOe=function(t,e,n){for(var r in e)n&&n.unsafe&&t[r]?t[r]=e[r]:JOe(t,r,e[r],n);return t},eNe=hh,tNe=Ox,Xx=Zf,lee=Dx,ZD=Ti,nNe=Mi,rNe=lh,iNe=ll,sNe=ho,uee=ta,To=La,oNe=fw,V5=ch,pP=Rx,aNe=xI,zp=VI,cNe=IZ,ANe=cr("iterator"),fv="URLSearchParams",dee=fv+"Iterator",hee=Xx.set,nc=Xx.getterFor(fv),lNe=Xx.getterFor(dee),uNe=Object.getOwnPropertyDescriptor,Jx=function(t){if(!km)return Ng[t];var e=uNe(Ng,t);return e&&e.value},Q5=Jx("fetch"),ub=Jx("Request"),Ly=Jx("Headers"),eB=ub&&ub.prototype,H5=Ly&&Ly.prototype,dNe=Ng.RegExp,hNe=Ng.TypeError,fee=Ng.decodeURIComponent,fNe=Ng.encodeURIComponent,pNe=nl("".charAt),j5=nl([].join),ff=nl([].push),mP=nl("".replace),mNe=nl([].shift),K5=nl([].splice),G5=nl("".split),gNe=nl("".slice),_Ne=/\+/g,W5=Array(4),ENe=function(t){return W5[t-1]||(W5[t-1]=dNe("((?:%[\\da-f]{2}){"+t+"})","gi"))},yNe=function(t){try{return fee(t)}catch{return t}},z5=function(t){var e=mP(t,_Ne," "),n=4;try{return fee(e)}catch{for(;n;)e=mP(e,ENe(n--),yNe);return e}},vNe=/[!'()~]|%20/g,wNe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},CNe=function(t){return wNe[t]},q5=function(t){return mP(fNe(t),vNe,CNe)},tB=tNe(function(t,e){hee(this,{type:dee,iterator:pP(nc(t).entries),kind:e})},"Iterator",function(){var t=lNe(this),e=t.kind,n=t.iterator.next(),r=n.value;return n.done||(n.value=e==="keys"?r.key:e==="values"?r.value:[r.key,r.value]),n},!0),pee=function(t){this.entries=[],this.url=null,t!==void 0&&(uee(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?pNe(t,0)==="?"?gNe(t,1):t:To(t)))};pee.prototype={type:fv,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,r,i,s,o,a,A=aNe(t);if(A)for(n=(e=pP(t,A)).next;!(r=mT(n,e)).done;){if(s=(i=pP(sNe(r.value))).next,(o=mT(s,i)).done||(a=mT(s,i)).done||!mT(s,i).done)throw hNe("Expected sequence with length 2");ff(this.entries,{key:To(o.value),value:To(a.value)})}else for(var l in t)nNe(t,l)&&ff(this.entries,{key:l,value:To(t[l])})},parseQuery:function(t){if(t)for(var e,n,r=G5(t,"&"),i=0;i<r.length;)(e=r[i++]).length&&(n=G5(e,"="),ff(this.entries,{key:z5(mNe(n)),value:z5(j5(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],r=0;r<e.length;)t=e[r++],ff(n,q5(t.key)+"="+q5(t.value));return j5(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var db=function(){lee(this,Tm);var t=hee(this,new pee(arguments.length>0?arguments[0]:void 0));km||(this.size=t.entries.length)},Tm=db.prototype;if(ZOe(Tm,{append:function(t,e){var n=nc(this);zp(arguments.length,2),ff(n.entries,{key:To(t),value:To(e)}),km||this.length++,n.updateURL()},delete:function(t){for(var e=nc(this),n=zp(arguments.length,1),r=e.entries,i=To(t),s=n<2?void 0:arguments[1],o=s===void 0?s:To(s),a=0;a<r.length;){var A=r[a];if(A.key!==i||o!==void 0&&A.value!==o)a++;else if(K5(r,a,1),o!==void 0)break}km||(this.size=r.length),e.updateURL()},get:function(t){var e=nc(this).entries;zp(arguments.length,1);for(var n=To(t),r=0;r<e.length;r++)if(e[r].key===n)return e[r].value;return null},getAll:function(t){var e=nc(this).entries;zp(arguments.length,1);for(var n=To(t),r=[],i=0;i<e.length;i++)e[i].key===n&&ff(r,e[i].value);return r},has:function(t){for(var e=nc(this).entries,n=zp(arguments.length,1),r=To(t),i=n<2?void 0:arguments[1],s=i===void 0?i:To(i),o=0;o<e.length;){var a=e[o++];if(a.key===r&&(s===void 0||a.value===s))return!0}return!1},set:function(t,e){var n=nc(this);zp(arguments.length,1);for(var r,i=n.entries,s=!1,o=To(t),a=To(e),A=0;A<i.length;A++)(r=i[A]).key===o&&(s?K5(i,A--,1):(s=!0,r.value=a));s||ff(i,{key:o,value:a}),km||(this.size=i.length),n.updateURL()},sort:function(){var t=nc(this);cNe(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=nc(this).entries,r=rNe(t,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((e=n[i++]).value,e.key,this)},keys:function(){return new tB(this,"keys")},values:function(){return new tB(this,"values")},entries:function(){return new tB(this,"entries")}},{enumerable:!0}),F5(Tm,ANe,Tm.entries,{}),F5(Tm,"toString",function(){return nc(this).serialize()},{enumerable:!0}),km&&$Oe(Tm,"size",{get:function(){return nc(this).entries.length},configurable:!0,enumerable:!0}),eNe(db,fv),$D({global:!0,forced:!M5},{URLSearchParams:db}),!M5&&ZD(Ly)){var TNe=nl(H5.has),SNe=nl(H5.set),Y5=function(t){if(uee(t)){var e,n=t.body;if(iNe(n)===fv)return e=t.headers?new Ly(t.headers):new Ly,TNe(e,"content-type")||SNe(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),oNe(t,{body:V5(0,To(n)),headers:V5(0,e)})}return t};if(ZD(Q5)&&$D({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return Q5(t,arguments.length>1?Y5(arguments[1]):{})}}),ZD(ub)){var nB=function(t){return lee(this,eB),new ub(t,arguments.length>1?Y5(arguments[1]):{})};eB.constructor=nB,nB.prototype=eB,$D({global:!0,dontCallGetSet:!0,forced:!0},{Request:nB})}}var bNe={URLSearchParams:db,getState:nc},X5=Zn(tA.URLSearchParams),INe={isBrowser:!0,classes:{URLSearchParams:X5!==void 0?X5:jx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const mee=typeof window<"u"&&typeof document<"u",RNe=(J5=typeof navigator<"u"&&navigator.product,mee&&["ReactNative","NativeScript","NS"].indexOf(J5)<0);var J5;const ONe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function $5(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Z5(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$5(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$5(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var GA=Z5(Z5({},Object.freeze({__proto__:null,hasBrowserEnv:mee,hasStandardBrowserEnv:RNe,hasStandardBrowserWebWorkerEnv:ONe})),INe),NNe=ho,DNe=Si,BNe=Mi,LNe=Bs,PNe=function(){var t=NNe(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},e6=RegExp.prototype,gee=function(t){var e=t.flags;return e!==void 0||"flags"in e6||BNe(t,"flags")||!LNe(e6,t)?e:DNe(PNe,t)},UNe=Fx.charAt,t6=Si,kNe=ho,xNe=Ti,MNe=cl,FNe=/./.exec,VNe=TypeError,QNe=sn,n6=Si,_ee=lv,HNe=Ox,gT=Nx,r6=A_,Eee=JJ,pv=La,jNe=ho,KNe=c_,GNe=cl,WNe=$J,yee=gee,zNe=NI,qNe=Sr,YNe=Lx,XNe=function(t,e,n){return e+(n?UNe(t,e).length:1)},JNe=function(t,e){var n=t.exec;if(xNe(n)){var r=t6(n,t,e);return r!==null&&kNe(r),r}if(MNe(t)==="RegExp")return t6(FNe,t,e);throw VNe("RegExp#exec called on incompatible receiver")},vee=Zf,$Ne=cr("matchAll"),wee="RegExp String",Cee=wee+" Iterator",ZNe=vee.set,eDe=vee.getterFor(Cee),tDe=TypeError,gP=_ee("".indexOf),hb=_ee("".matchAll),rB=!!hb&&!qNe(function(){hb("a",/./)}),nDe=HNe(function(t,e,n,r){ZNe(this,{type:Cee,regexp:t,string:e,global:n,unicode:r,done:!1})},wee,function(){var t=eDe(this);if(t.done)return gT(void 0,!0);var e=t.regexp,n=t.string,r=JNe(e,n);return r===null?(t.done=!0,gT(void 0,!0)):t.global?(pv(r[0])===""&&(e.lastIndex=XNe(n,Eee(e.lastIndex),t.unicode)),gT(r,!1)):(t.done=!0,gT(r,!1))}),i6=function(t){var e,n,r,i=jNe(this),s=pv(t),o=YNe(i,RegExp),a=pv(yee(i));return e=new o(o===RegExp?i.source:i,a),n=!!~gP(a,"g"),r=!!~gP(a,"u"),e.lastIndex=Eee(i.lastIndex),new nDe(e,s,n,r)};QNe({target:"String",proto:!0,forced:rB},{matchAll:function(t){var e,n,r,i,s=r6(this);if(KNe(t)){if(rB)return hb(s,t)}else{if(WNe(t)&&(e=pv(r6(yee(t))),!~gP(e,"g")))throw tDe("`.matchAll` does not allow non-global regexes");if(rB)return hb(s,t);if((r=zNe(t,$Ne))===void 0&&GNe(t)=="RegExp"&&(r=i6),r)return n6(r,t,s)}return n=pv(s),i=new RegExp(t,"g"),n6(i6,i,n)}});var rDe=Cc("String").matchAll,iDe=Bs,sDe=rDe,iB=String.prototype,oDe=function(t){var e=t.matchAll;return typeof t=="string"||t===iB||iDe(iB,t)&&e===iB.matchAll?sDe:e},aDe=Zn(oDe);function Tee(t){function e(n,r,i,s){let o=n[s++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),A=s>=n.length;return o=!o&&Re.isArray(i)?i.length:o,A?(Re.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!a):(i[o]&&Re.isObject(i[o])||(i[o]=[]),e(n,r,i[o],s)&&Re.isArray(i[o])&&(i[o]=function(l){const d={},f=Object.keys(l);let p;const g=f.length;let y;for(p=0;p<g;p++)y=f[p],d[y]=l[y];return d}(i[o])),!a)}if(Re.isFormData(t)&&Re.isFunction(t.entries)){const n={};return Re.forEachEntry(t,(r,i)=>{e(function(s){return aDe(Re).call(Re,/\w+|\[(\w*)]/g,s).map(o=>o[0]==="[]"?"":o[1]||o[0])}(r),i,n,0)}),n}return null}const $x={transitional:LZ,adapter:["xhr","http"],transformRequest:[function(t,e){const n=e.getContentType()||"",r=n.indexOf("application/json")>-1,i=Re.isObject(t);if(i&&Re.isHTMLForm(t)&&(t=new FormData(t)),Re.isFormData(t))return r?JSON.stringify(Tee(t)):t;if(Re.isArrayBuffer(t)||Re.isBuffer(t)||Re.isStream(t)||Re.isFile(t)||Re.isBlob(t))return t;if(Re.isArrayBufferView(t))return t.buffer;if(Re.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(o,a){return cb(o,new GA.classes.URLSearchParams,Object.assign({visitor:function(A,l,d,f){return GA.isNode&&Re.isBuffer(A)?(this.append(l,A.toString("base64")),!1):f.defaultVisitor.apply(this,arguments)}},a))}(t,this.formSerializer).toString();if((s=Re.isFileList(t))||n.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return cb(s?{"files[]":t}:t,o&&new o,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),function(o,a,A){if(Re.isString(o))try{return(a||JSON.parse)(o),as(Re).call(Re,o)}catch(l){if(l.name!=="SyntaxError")throw l}return(A||JSON.stringify)(o)}(t)):t}],transformResponse:[function(t){const e=this.transitional||$x.transitional,n=e&&e.forcedJSONParsing,r=this.responseType==="json";if(t&&Re.isString(t)&&(n&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(s){if(i)throw s.name==="SyntaxError"?Rn.from(s,Rn.ERR_BAD_RESPONSE,this,null,this.response):s}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:GA.classes.FormData,Blob:GA.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Re.forEach(["delete","get","head","post","put","patch"],t=>{$x.headers[t]={}});var Zx=$x;const cDe=Re.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),s6=Symbol("internals");function IE(t){var e;return t&&as(e=String(t)).call(e).toLowerCase()}function K0(t){return t===!1||t==null?t:Re.isArray(t)?t.map(K0):String(t)}function sB(t,e,n,r,i){return Re.isFunction(r)?r.call(this,e,n):(i&&(e=n),Re.isString(e)?Re.isString(r)?e.indexOf(r)!==-1:Re.isRegExp(r)?r.test(e):void 0:void 0)}class G0{constructor(e){e&&this.set(e)}set(e,n,r){const i=this;function s(A,l,d){const f=IE(l);if(!f)throw new Error("header name must be a non-empty string");const p=Re.findKey(i,f);(!p||i[p]===void 0||d===!0||d===void 0&&i[p]!==!1)&&(i[p||l]=K0(A))}const o=(A,l)=>Re.forEach(A,(d,f)=>s(d,f,l));var a;return Re.isPlainObject(e)||e instanceof this.constructor?o(e,n):Re.isString(e)&&(e=as(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(as(a=e).call(a))?o((A=>{const l={};let d,f,p;return A&&A.split(`
`).forEach(function(g){var y,E;p=g.indexOf(":"),d=as(y=g.substring(0,p)).call(y).toLowerCase(),f=as(E=g.substring(p+1)).call(E),!d||l[d]&&cDe[d]||(d==="set-cookie"?l[d]?l[d].push(f):l[d]=[f]:l[d]=l[d]?l[d]+", "+f:f)}),l})(e),n):e!=null&&s(n,e,r),this}get(e,n){if(e=IE(e)){const r=Re.findKey(this,e);if(r){const i=this[r];if(!n)return i;if(n===!0)return function(s){const o=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let A;for(;A=a.exec(s);)o[A[1]]=A[2];return o}(i);if(Re.isFunction(n))return n.call(this,i,r);if(Re.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=IE(e)){const r=Re.findKey(this,e);return!(!r||this[r]===void 0||n&&!sB(0,this[r],r,n))}return!1}delete(e,n){const r=this;let i=!1;function s(o){if(o=IE(o)){const a=Re.findKey(r,o);!a||n&&!sB(0,r[a],a,n)||(delete r[a],i=!0)}}return Re.isArray(e)?e.forEach(s):s(e),i}clear(e){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const s=n[r];e&&!sB(0,this[s],s,e,!0)||(delete this[s],i=!0)}return i}normalize(e){const n=this,r={};return Re.forEach(this,(i,s)=>{var o;const a=Re.findKey(r,s);if(a)return n[a]=K0(i),void delete n[s];const A=e?function(l){return as(l).call(l).toLowerCase().replace(/([a-z\d])(\w*)/g,(d,f,p)=>f.toUpperCase()+p)}(s):as(o=String(s)).call(o);A!==s&&delete n[s],n[A]=K0(i),r[A]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return Re.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=e&&Re.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,r]=e;return n+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i.forEach(o=>n.set(o)),n}static accessor(e){const n=(this[s6]=this[s6]={accessors:{}}).accessors,r=this.prototype;function i(s){const o=IE(s);n[o]||(function(a,A){const l=Re.toCamelCase(" "+A);["get","set","has"].forEach(d=>{Object.defineProperty(a,d+l,{value:function(f,p,g){return this[d].call(this,A,f,p,g)},configurable:!0})})}(r,s),n[o]=!0)}return Re.isArray(e)?e.forEach(i):i(e),this}}G0.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Re.reduceDescriptors(G0.prototype,(t,e)=>{let{value:n}=t,r=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(i){this[r]=i}}}),Re.freezeMethods(G0);var ou=G0;function oB(t,e){const n=this||Zx,r=e||n,i=ou.from(r.headers);let s=r.data;return Re.forEach(t,function(o){s=o.call(n,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function See(t){return!(!t||!t.__CANCEL__)}function ww(t,e,n){Rn.call(this,t??"canceled",Rn.ERR_CANCELED,e,n),this.name="CanceledError"}Re.inherits(ww,Rn,{__CANCEL__:!0});var ADe=GA.hasStandardBrowserEnv?{write(t,e,n,r,i,s){const o=[t+"="+encodeURIComponent(e)];Re.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Re.isString(r)&&o.push("path="+r),Re.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function bee(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,r){return r?n.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):n}(t,e):e}var lDe=GA.hasStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let n;function r(i){let s=i;return t&&(e.setAttribute("href",s),s=e.href),e.setAttribute("href",s),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return n=r(window.location.href),function(i){const s=Re.isString(i)?r(i):i;return s.protocol===n.protocol&&s.host===n.host}}():function(){return!0};function o6(t,e){let n=0;const r=function(i,s){i=i||10;const o=new Array(i),a=new Array(i);let A,l=0,d=0;return s=s!==void 0?s:1e3,function(f){const p=Date.now(),g=a[d];A||(A=p),o[l]=f,a[l]=p;let y=d,E=0;for(;y!==l;)E+=o[y++],y%=i;if(l=(l+1)%i,l===d&&(d=(d+1)%i),p-A<s)return;const w=g&&p-g;return w?Math.round(1e3*E/w):void 0}}(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-n,A=r(a);n=s;const l={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:A||void 0,estimated:A&&o&&s<=o?(o-s)/A:void 0,event:i};l[e?"download":"upload"]=!0,t(l)}}var uDe=typeof XMLHttpRequest<"u"&&function(t){return new we(function(e,n){let r=t.data;const i=ou.from(t.headers).normalize();let s,o,{responseType:a,withXSRFToken:A}=t;function l(){t.cancelToken&&t.cancelToken.unsubscribe(s),t.signal&&t.signal.removeEventListener("abort",s)}if(Re.isFormData(r)){if(GA.hasStandardBrowserEnv||GA.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if((o=i.getContentType())!==!1){const[y,...E]=o?o.split(";").map(w=>as(w).call(w)).filter(Boolean):[];i.setContentType([y||"multipart/form-data",...E].join("; "))}}let d=new XMLHttpRequest;if(t.auth){const y=t.auth.username||"",E=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";i.set("Authorization","Basic "+btoa(y+":"+E))}const f=bee(t.baseURL,t.url);function p(){if(!d)return;const y=ou.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders());(function(E,w,b){const I=b.config.validateStatus;b.status&&I&&!I(b.status)?w(new Rn("Request failed with status code "+b.status,[Rn.ERR_BAD_REQUEST,Rn.ERR_BAD_RESPONSE][Math.floor(b.status/100)-4],b.config,b.request,b)):E(b)})(function(E){e(E),l()},function(E){n(E),l()},{data:a&&a!=="text"&&a!=="json"?d.response:d.responseText,status:d.status,statusText:d.statusText,headers:y,config:t,request:d}),d=null}if(d.open(t.method.toUpperCase(),BZ(f,t.params,t.paramsSerializer),!0),d.timeout=t.timeout,"onloadend"in d?d.onloadend=p:d.onreadystatechange=function(){d&&d.readyState===4&&(d.status!==0||d.responseURL&&d.responseURL.indexOf("file:")===0)&&setTimeout(p)},d.onabort=function(){d&&(n(new Rn("Request aborted",Rn.ECONNABORTED,t,d)),d=null)},d.onerror=function(){n(new Rn("Network Error",Rn.ERR_NETWORK,t,d)),d=null},d.ontimeout=function(){let y=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const E=t.transitional||LZ;t.timeoutErrorMessage&&(y=t.timeoutErrorMessage),n(new Rn(y,E.clarifyTimeoutError?Rn.ETIMEDOUT:Rn.ECONNABORTED,t,d)),d=null},GA.hasStandardBrowserEnv&&(A&&Re.isFunction(A)&&(A=A(t)),A||A!==!1&&lDe(f))){const y=t.xsrfHeaderName&&t.xsrfCookieName&&ADe.read(t.xsrfCookieName);y&&i.set(t.xsrfHeaderName,y)}r===void 0&&i.setContentType(null),"setRequestHeader"in d&&Re.forEach(i.toJSON(),function(y,E){d.setRequestHeader(E,y)}),Re.isUndefined(t.withCredentials)||(d.withCredentials=!!t.withCredentials),a&&a!=="json"&&(d.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&d.addEventListener("progress",o6(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",o6(t.onUploadProgress)),(t.cancelToken||t.signal)&&(s=y=>{d&&(n(!y||y.type?new ww(null,t,d):y),d.abort(),d=null)},t.cancelToken&&t.cancelToken.subscribe(s),t.signal&&(t.signal.aborted?s():t.signal.addEventListener("abort",s)));const g=function(y){const E=/^([-+\w]{1,25})(:?\/\/|:)/.exec(y);return E&&E[1]||""}(f);g&&GA.protocols.indexOf(g)===-1?n(new Rn("Unsupported protocol "+g+":",Rn.ERR_BAD_REQUEST,t)):d.send(r||null)})};const _P={http:null,xhr:uDe};Re.forEach(_P,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const a6=t=>"- ".concat(t),dDe=t=>Re.isFunction(t)||t===null||t===!1;var Iee={getAdapter:t=>{t=Re.isArray(t)?t:[t];const{length:e}=t;let n,r;const i={};for(let s=0;s<e;s++){let o;if(n=t[s],r=n,!dDe(n)&&(r=_P[(o=String(n)).toLowerCase()],r===void 0))throw new Rn("Unknown adapter '".concat(o,"'"));if(r)break;i[o||"#"+s]=r}if(!r){const s=Object.entries(i).map(o=>{let[a,A]=o;return"adapter ".concat(a," ")+(A===!1?"is not supported by the environment":"is not available in the build")});throw new Rn("There is no suitable adapter to dispatch the request "+(e?s.length>1?`since :
`+s.map(a6).join(`
`):" "+a6(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:_P};function aB(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new ww(null,t)}function c6(t){return aB(t),t.headers=ou.from(t.headers),t.data=oB.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Iee.getAdapter(t.adapter||Zx.adapter)(t).then(function(e){return aB(t),e.data=oB.call(t,t.transformResponse,e),e.headers=ou.from(e.headers),e},function(e){return See(e)||(aB(t),e&&e.response&&(e.response.data=oB.call(t,t.transformResponse,e.response),e.response.headers=ou.from(e.response.headers))),we.reject(e)})}function A6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}const l6=t=>t instanceof ou?function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?A6(Object(r),!0).forEach(function(i){N(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A6(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}({},t):t;function Dg(t,e){e=e||{};const n={};function r(l,d,f){return Re.isPlainObject(l)&&Re.isPlainObject(d)?Re.merge.call({caseless:f},l,d):Re.isPlainObject(d)?Re.merge({},d):Re.isArray(d)?d.slice():d}function i(l,d,f){return Re.isUndefined(d)?Re.isUndefined(l)?void 0:r(void 0,l,f):r(l,d,f)}function s(l,d){if(!Re.isUndefined(d))return r(void 0,d)}function o(l,d){return Re.isUndefined(d)?Re.isUndefined(l)?void 0:r(void 0,l):r(void 0,d)}function a(l,d,f){return f in e?r(l,d):f in t?r(void 0,l):void 0}const A={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(l,d)=>i(l6(l),l6(d),!0)};return Re.forEach(Object.keys(Object.assign({},t,e)),function(l){const d=A[l]||i,f=d(t[l],e[l],l);Re.isUndefined(f)&&d!==a||(n[l]=f)}),n}const Ree="1.6.8",e2={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{e2[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const u6={};e2.transitional=function(t,e,n){function r(i,s){return"[Axios v"+Ree+"] Transitional option '"+i+"'"+s+(n?". "+n:"")}return(i,s,o)=>{if(t===!1)throw new Rn(r(s," has been removed"+(e?" in "+e:"")),Rn.ERR_DEPRECATED);return e&&!u6[s]&&(u6[s]=!0,console.warn(r(s," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(i,s,o)}};var EP={assertOptions:function(t,e,n){if(typeof t!="object")throw new Rn("options must be an object",Rn.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let i=r.length;for(;i-- >0;){const s=r[i],o=e[s];if(o){const a=t[s],A=a===void 0||o(a,s,t);if(A!==!0)throw new Rn("option "+s+" must be "+A,Rn.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Rn("Unknown option "+s,Rn.ERR_BAD_OPTION)}},validators:e2};const $u=EP.validators;let W0=class{constructor(t){this.defaults=t,this.interceptors={request:new r5,response:new r5}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=Dg(this.defaults,e);const{transitional:n,paramsSerializer:r,headers:i}=e;n!==void 0&&EP.assertOptions(n,{silentJSONParsing:$u.transitional($u.boolean),forcedJSONParsing:$u.transitional($u.boolean),clarifyTimeoutError:$u.transitional($u.boolean)},!1),r!=null&&(Re.isFunction(r)?e.paramsSerializer={serialize:r}:EP.assertOptions(r,{encode:$u.function,serialize:$u.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=i&&Re.merge(i.common,i[e.method]);i&&Re.forEach(["delete","get","head","post","put","patch","common"],g=>{delete i[g]}),e.headers=ou.concat(s,i);const o=[];let a=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(e)===!1||(a=a&&g.synchronous,o.unshift(g.fulfilled,g.rejected))});const A=[];let l;this.interceptors.response.forEach(function(g){A.push(g.fulfilled,g.rejected)});let d,f=0;if(!a){const g=[c6.bind(this),void 0];for(g.unshift.apply(g,o),g.push.apply(g,A),d=g.length,l=we.resolve(e);f<d;)l=l.then(g[f++],g[f++]);return l}d=o.length;let p=e;for(f=0;f<d;){const g=o[f++],y=o[f++];try{p=g(p)}catch(E){y.call(this,E);break}}try{l=c6.call(this,p)}catch(g){return we.reject(g)}for(f=0,d=A.length;f<d;)l=l.then(A[f++],A[f++]);return l}getUri(t){return BZ(bee((t=Dg(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};Re.forEach(["delete","get","head","options"],function(t){W0.prototype[t]=function(e,n){return this.request(Dg(n||{},{method:t,url:e,data:(n||{}).data}))}}),Re.forEach(["post","put","patch"],function(t){function e(n){return function(r,i,s){return this.request(Dg(s||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}W0.prototype[t]=e(),W0.prototype[t+"Form"]=e(!0)});var z0=W0;class t2{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new we(function(i){n=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new we(a=>{r.subscribe(a),s=a}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},e(function(i,s,o){r.reason||(r.reason=new ww(i,s,o),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}static source(){let e;return{token:new t2(function(n){e=n}),cancel:e}}}var hDe=t2;const yP={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(yP).forEach(t=>{let[e,n]=t;yP[n]=e});var fDe=yP;const Ki=function t(e){const n=new z0(e),r=OZ(z0.prototype.request,n);return Re.extend(r,z0.prototype,n,{allOwnKeys:!0}),Re.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return t(Dg(e,i))},r}(Zx);Ki.Axios=z0,Ki.CanceledError=ww,Ki.CancelToken=hDe,Ki.isCancel=See,Ki.VERSION=Ree,Ki.toFormData=cb,Ki.AxiosError=Rn,Ki.Cancel=Ki.CanceledError,Ki.all=function(t){return we.all(t)},Ki.spread=function(t){return function(e){return t.apply(null,e)}},Ki.isAxiosError=function(t){return Re.isObject(t)&&t.isAxiosError===!0},Ki.mergeConfig=Dg,Ki.AxiosHeaders=ou,Ki.formToJSON=t=>Tee(Re.isHTMLForm(t)?new FormData(t):t),Ki.getAdapter=Iee.getAdapter,Ki.HttpStatusCode=fDe,Ki.default=Ki;var Xs=Ki;const pDe=()=>{};function mv(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:pDe};return t.promise=new we((e,n)=>{t.resolve=r=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(r),t.value=r)},t.reject=r=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(r))}}),t}const _T=new Map,ET=new Map,SA=new Map;let Pr=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),xt=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const Oee=new UIe;let Kc=Oee.getResult(),cB=null;function Ct(t){if(!cB){Kc=Oee.getResult();const e=function(a){if(a.engine.name==="Blink"&&a.browser.name!=="WeChat")return xt.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return xt.CHROME;case"Safari":case"Mobile Safari":return xt.SAFARI;case"Edge":return xt.EDGE;case"Firefox":return xt.FIREFOX;case"QQ":case"QQBrowser":return xt.QQ;case"Opera":return xt.OPERA;case"WeChat":return xt.WECHAT;default:return a.browser.name||""}}(Kc),n=d6(Kc),r=function(a){return a.os.name==="Windows"?a.os.version?a.os.name+" "+a.os.version:a.os.name:a.os.name||""}(Kc),i=Kc.os.version,s=d6(Kc,!1),o=Kc.device.type;if(!(e&&n&&r&&i))return{name:e,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o};cB={name:e,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o}}return cB}function d6(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function WI(){return Ct().os}function h6(){const t=Ct();return"".concat(t.os," ").concat(t.osVersion)}function fb(){const t=Ct();return!!(Kc.engine.name==="WebKit"&&t.os===Pr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==xt.SAFARI||Is()&&t.name!==xt.SAFARI)}function Fd(){return Ct().name===xt.CHROME}function yi(){return Ct().name===xt.SAFARI}function Nee(){return Ct().name===xt.EDGE}function Fn(){return Ct().name===xt.FIREFOX}function Is(){return Ct().os===Pr.IOS}function vP(t){const e=Ct();return!(e.name!==xt.CHROME||!e.osVersion)&&Number(e.version)>=t}function Dee(t){const e=Ct();return!(e.name!==xt.CHROME||!e.osVersion)&&Number(e.version)<t}function f6(t){const e=Ct();return!(e.name!==xt.EDGE||!e.osVersion)&&Number(e.version)>=t}function Bee(t){const e=Ct();return!(e.name!==xt.SAFARI||!e.osVersion)&&Number(e.version)>=t}function Lee(t,e,n){const r=Ct();if(r.os!==Pr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return e&&Number(i[0])===t&&Number(i[1])<e||Number(i[0])<t}function Pee(t,e,n){const r=Ct();if(r.name!==xt.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?e&&Number(i[0])===t&&Number(i[1])<e||Number(i[0])<t:e?Number(i[0])===t&&Number(i[1])<=e||Number(i[0])<t:Number(i[0])<=t}function p6(t){const e=Ct();return!(e.name!==xt.OPERA||!e.osVersion)&&Number(e.version)>=t}function m6(){const t=Ct();if(t.os!==Pr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function Bg(){const t=Ct();if(t.os!==Pr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function wP(){const t=Ct();if(t.os!==Pr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function g6(){const t=Ct();if(t.os!==Pr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function gc(){return yi()&&navigator.maxTouchPoints>0}function Uee(){return Ct().name===xt.WECHAT}function kee(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function n2(){const t=WI();return function(){const{deviceType:e}=Ct();return e==="mobile"||e==="tablet"}()||t===Pr.ANDROID||t===Pr.IOS||t===Pr.HARMONY_OS}function rh(){const t=Ct();return t.name!==xt.EDGE&&t.name!==xt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function zI(){return WI()===Pr.ANDROID}function gv(){const t=Ct();return zI()&&(t.name===xt.CHROME||t.name===xt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function _n(t,e,n){return(e=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var A=a.call(s,"string");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Be(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?_6(Object(n),!0).forEach(function(r){_n(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_6(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let P=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),ie=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),_n(this,"code",void 0),_n(this,"message",void 0),_n(this,"data",void 0),_n(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Jl(t,e){if(typeof t!="boolean")throw new ie(P.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Or(t,e,n){if(!Se(n).call(n,t))throw new ie(P.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function zt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(t))throw new ie(P.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function AB(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new ie(P.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&zt(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&zt(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&zt(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&zt(t.ideal,"".concat(e,".ideal"),1,1/0)}else zt(t,e,1,1/0)}function ei(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new ie(P.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!xee(t,n,r,i))throw new ie(P.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function ql(t,e){if(!Array.isArray(t))throw new ie(P.INVALID_PARAMS,"".concat(e," should be an array"))}function Nn(t){return t==null}function xee(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!r||function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){const o=i.charCodeAt(s);if(o<0||o>255)return!1}return!0}(t))}var XE=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(XE||{}),CP=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(CP||{});const Mee=new class{constructor(){_n(this,"_clientSize",null),_n(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),_n(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),_n(this,"getStyle",t=>window.getComputedStyle(t,null)),_n(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const r=this.getStyle(t),{display:i,visibility:s,opacity:o,filter:a}=r;return(i==="none"||Se(e=["hidden","collapse"]).call(e,s)||Number(o)<.1)&&(n=!1),!!n&&(a&&a.split(" ").filter(A=>{var l;const d=A.split("(")[0];return Se(l=["brightness","blur","opacity"]).call(l,d)}).map(A=>{const[l,d]=A.split(/\(|\)/);return[l,Number(d.match(/^[0-9\.]+/))]}).forEach(A=>{const[l,d]=A;switch(l){case"brightness":(d<.1||d>3)&&(n=!1);break;case"blur":d>3&&(n=!1);break;case"opacity":d<.1&&(n=!1)}}),n)}),_n(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,r=!0;const i=o=>e(o);let s=t;for(;s&&r;)i(s)||(n=!1,r=!1),s=s.parentElement,s||(r=!1);return n}),_n(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),_n(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:r,right:i,top:s,bottom:o}=t.getBoundingClientRect(),a=this.getClientWidth(),A=this.getClientHeight();return{width:e,height:n,left:r,right:i,top:s,bottom:o,clientWidth:a,clientHeight:A,clientMin:Math.min(a,A)}}),_n(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),_n(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),_n(this,"checkCoverForAPoint",(t,e,n)=>{const r=this.elementFromPoint(t,e);return r!==null&&r!==n}),_n(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:r}=this._clientSize,i=t/6,s=e/6,o=[],a=10**6;for(let A=0;A<5;A++)for(let l=0;l<5;l++){const d=(n*a+(A===0?.1:A===4?(i*A*a-1e5)/a:i*A)*a)/a,f=(r*a+(l===0?.1:l===4?(s*l*a-1e5)/a:s*l)*a)/a;o.push({x:d,y:f})}return[...o]}),_n(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),_n(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),_n(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:r,clientHeight:i,clientWidth:s,clientMin:o}=this._clientSize;let a,A,l,d;if(t<0)a=0;else{if(!(t<s))return!1;a=t}if(e<0)return!1;if(A=e<s?e:s,n<0)l=0;else{if(!(n<i))return!1;l=n}if(r<0)return!1;d=r<i?r:i;const f=A-a,p=d-l;return this.checkSizeIsVisible(f,p,o)}),_n(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),_n(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(XE.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(XE.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(XE.SIZE)}}return this.returnHiddenResult(XE.STYLE)}return this.returnHiddenResult(CP.UNMOUNTED)}return this.returnHiddenResult(CP.INVALID_HTML_ELEMENT)}),_n(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function r2(t){return new TextEncoder().encode(t)}const E6=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},TP=async t=>function(e,n){let r="";return new Uint8Array(e).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",r2(t)),16);let Ln=class{constructor(){_n(this,"_events",{}),_n(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],r=this._indexOfListener(n,e);r!==-1&&n.splice(r,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(s=>s);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let s=0;s<e.length;s+=1){const o=e[s];o.once&&this.off(t,o.listener),o.listener.apply(this,r||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];[...this._events[t]||[]].forEach(i=>{i.once&&this.off(t,i.listener);try{i.listener.apply(this,n)}catch(s){console.error("safeEmit event:".concat(t," error ").concat(s==null?void 0:s.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},RE=null;function Fee(){if(RE)return RE;if(window.electron)return RE=window.electron;if(!window.require)return null;try{return RE=window.require("electron"),RE}catch{return null}}let Cr=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t}({}),xn=function(t){return t.TRACER="tracer",t}({});function y6(t){return zt(t.timeout,"config.timeout",0,1e5),zt(t.timeoutFactor,"config.timeoutFactor",0,100,!1),zt(t.maxRetryCount,"config.maxRetryConfig",0,1/0),zt(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let mDe=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Ft=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function qI(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function Vee(t){return ei(t.turnServerURL,"turnServerURL"),ei(t.username,"username"),ei(t.password,"password"),t.udpport&&zt(t.udpport,"udpport",1,99999,!0),t.forceturn&&Jl(t.forceturn,"forceturn"),t.security&&Jl(t.security,"security"),t.tcpport&&zt(t.tcpport,"tcpport",1,99999,!0),!0}function v6(t){return t.level!==void 0&&Or(t.level,"level",[1,2,3]),t.delay!==void 0&&zt(t.delay,"delay",0,3e3,!0),!0}let gt=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),_i=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t}({}),bo=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),xm=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function vi(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return t.getListeners(e).length===0?we.reject(new ie(P.UNEXPECTED_ERROR,"can not emit promise")):new we((s,o)=>{t.emit(e,...r,s,o)})}function Jt(t,e){if(t.getListeners(e).length===0)return we.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return vi(t,e,...r)}function Sa(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return _v(t,e,...r)}function _v(t,e){let n=null,r=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];if(t.emit(e,...s,a=>{n=a},a=>{r=a}),r!==null)throw r;if(n===null)throw new ie(P.UNEXPECTED_ERROR,"handler is not sync");return n}const or=new class extends Ln{set networkState(t){this.emit(xm.NETWORK_STATE_CHANGE,t,this._networkState),t===bo.ONLINE?this.emit(xm.ONLINE):t===bo.OFFLINE&&(this.onlineWaiter=new we(e=>{this.once(xm.ONLINE,()=>{this.onlineWaiter=void 0,e(bo.ONLINE)})}),this.emit(xm.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===bo.ONLINE}constructor(){super(),_n(this,"_moduleName","network-indicator"),_n(this,"_networkState",bo.ONLINE),_n(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=bo.ONLINE}),window.addEventListener("offline",()=>{this.networkState=bo.OFFLINE})}};function pb(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function Mm(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function YI(t){we!==void 0?we.resolve().then(t):setTimeout(t,0)}function ir(t){return JSON.parse(JSON.stringify(t))}function pf(t){try{return ir(t)}catch{return t}}const w6={};function ih(t,e){w6[e]||(w6[e]=!0,t())}function mf(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let r=0;r<e.length;r+=1)n[r]=e.charCodeAt(r);return n}function Vd(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function Qee(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const r=new Uint8Array(e);r.set(n),n=r}return n}function C6(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=Zc(e).call(e,(o,a)=>o+a.length,0),i=new Uint8Array(new ArrayBuffer(r));let s=0;return e.forEach(o=>{i.set(o,s),s+=o.length}),i}function WA(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function Hee(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?WA(n):n.size}),e+138}function gDe(t){const e=new ie(P.TIMEOUT,"timeout");return new we((n,r)=>{window.setTimeout(()=>r(e),t)})}function ai(t){return new we(e=>{window.setTimeout(e,t)})}function nn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+nn(t-n.length,"")}function Fm(){return nn(32,"").toUpperCase()}const XI=()=>{},T6=new class{constructor(){_n(this,"fnMap",new Map)}throttleByKey(t,e,n,r){for(var i=arguments.length,s=new Array(i>4?i-4:0),o=4;o<i;o++)s[o-4]=arguments[o];if(this.fnMap.has(e)){const a=this.fnMap.get(e);if(a.threshold!==n){a.fn(...a.args),clearTimeout(a.timer);const A=window.setTimeout(()=>{const l=this.fnMap.get(e);l&&l.fn(...l.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:A,args:s,skipFn:r})}else a.skipFn&&a.skipFn(...a.args),this.fnMap.set(e,Be(Be({},a),{},{fn:t,args:s,skipFn:r}))}else{const a=window.setTimeout(()=>{const A=this.fnMap.get(e);A&&A.fn(...A.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:a,args:s,skipFn:r})}}},S6=T6.throttleByKey.bind(T6);function b6(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function SP(t,e){if(!b6(t)||!b6(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let r=0;r<e.length;r++)n[r]=SP(t[r],e[r]);return n}{const n=Be({},t);for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)?n[r]=SP(t[r],e[r]):n[r]=e[r]);return n}}function I6(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let r=0;for(;t>0&&(n[r]=255&t,t>>=8,r++,r!==e););return n}function lB(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function jee(t){const e="0123456789abcdef";function n(B){let U,H="";for(U=0;U<=3;U++)H+=e.charAt(B>>8*U+4&15)+e.charAt(B>>8*U&15);return H}function r(B,U){const H=(65535&B)+(65535&U);return(B>>16)+(U>>16)+(H>>16)<<16|65535&H}function i(B,U,H,K,x,V){return r(function(M,O){return M<<O|M>>>32-O}(r(r(U,B),r(K,V)),x),H)}function s(B,U,H,K,x,V,M){return i(U&H|~U&K,B,U,x,V,M)}function o(B,U,H,K,x,V,M){return i(U&K|H&~K,B,U,x,V,M)}function a(B,U,H,K,x,V,M){return i(U^H^K,B,U,x,V,M)}function A(B,U,H,K,x,V,M){return i(H^(U|~K),B,U,x,V,M)}const l=function(B){let U;const H=1+(B.length+8>>6),K=new Array(16*H);for(U=0;U<16*H;U++)K[U]=0;for(U=0;U<B.length;U++)K[U>>2]|=B.charCodeAt(U)<<U%4*8;return K[U>>2]|=128<<U%4*8,K[16*H-2]=8*B.length,K}(t);let d,f,p,g,y,E=1732584193,w=-271733879,b=-1732584194,I=271733878;for(d=0;d<l.length;d+=16)f=E,p=w,g=b,y=I,E=s(E,w,b,I,l[d+0],7,-680876936),I=s(I,E,w,b,l[d+1],12,-389564586),b=s(b,I,E,w,l[d+2],17,606105819),w=s(w,b,I,E,l[d+3],22,-1044525330),E=s(E,w,b,I,l[d+4],7,-176418897),I=s(I,E,w,b,l[d+5],12,1200080426),b=s(b,I,E,w,l[d+6],17,-1473231341),w=s(w,b,I,E,l[d+7],22,-45705983),E=s(E,w,b,I,l[d+8],7,1770035416),I=s(I,E,w,b,l[d+9],12,-1958414417),b=s(b,I,E,w,l[d+10],17,-42063),w=s(w,b,I,E,l[d+11],22,-1990404162),E=s(E,w,b,I,l[d+12],7,1804603682),I=s(I,E,w,b,l[d+13],12,-40341101),b=s(b,I,E,w,l[d+14],17,-1502002290),w=s(w,b,I,E,l[d+15],22,1236535329),E=o(E,w,b,I,l[d+1],5,-165796510),I=o(I,E,w,b,l[d+6],9,-1069501632),b=o(b,I,E,w,l[d+11],14,643717713),w=o(w,b,I,E,l[d+0],20,-373897302),E=o(E,w,b,I,l[d+5],5,-701558691),I=o(I,E,w,b,l[d+10],9,38016083),b=o(b,I,E,w,l[d+15],14,-660478335),w=o(w,b,I,E,l[d+4],20,-405537848),E=o(E,w,b,I,l[d+9],5,568446438),I=o(I,E,w,b,l[d+14],9,-1019803690),b=o(b,I,E,w,l[d+3],14,-187363961),w=o(w,b,I,E,l[d+8],20,1163531501),E=o(E,w,b,I,l[d+13],5,-1444681467),I=o(I,E,w,b,l[d+2],9,-51403784),b=o(b,I,E,w,l[d+7],14,1735328473),w=o(w,b,I,E,l[d+12],20,-1926607734),E=a(E,w,b,I,l[d+5],4,-378558),I=a(I,E,w,b,l[d+8],11,-2022574463),b=a(b,I,E,w,l[d+11],16,1839030562),w=a(w,b,I,E,l[d+14],23,-35309556),E=a(E,w,b,I,l[d+1],4,-1530992060),I=a(I,E,w,b,l[d+4],11,1272893353),b=a(b,I,E,w,l[d+7],16,-155497632),w=a(w,b,I,E,l[d+10],23,-1094730640),E=a(E,w,b,I,l[d+13],4,681279174),I=a(I,E,w,b,l[d+0],11,-358537222),b=a(b,I,E,w,l[d+3],16,-722521979),w=a(w,b,I,E,l[d+6],23,76029189),E=a(E,w,b,I,l[d+9],4,-640364487),I=a(I,E,w,b,l[d+12],11,-421815835),b=a(b,I,E,w,l[d+15],16,530742520),w=a(w,b,I,E,l[d+2],23,-995338651),E=A(E,w,b,I,l[d+0],6,-198630844),I=A(I,E,w,b,l[d+7],10,1126891415),b=A(b,I,E,w,l[d+14],15,-1416354905),w=A(w,b,I,E,l[d+5],21,-57434055),E=A(E,w,b,I,l[d+12],6,1700485571),I=A(I,E,w,b,l[d+3],10,-1894986606),b=A(b,I,E,w,l[d+10],15,-1051523),w=A(w,b,I,E,l[d+1],21,-2054922799),E=A(E,w,b,I,l[d+8],6,1873313359),I=A(I,E,w,b,l[d+15],10,-30611744),b=A(b,I,E,w,l[d+6],15,-1560198380),w=A(w,b,I,E,l[d+13],21,1309151649),E=A(E,w,b,I,l[d+4],6,-145523070),I=A(I,E,w,b,l[d+11],10,-1120210379),b=A(b,I,E,w,l[d+2],15,718787259),w=A(w,b,I,E,l[d+9],21,-343485551),E=r(E,f),w=r(w,p),b=r(b,g),I=r(I,y);return n(E)+n(w)+n(b)+n(I)}let _De=1,yT=console,xi=class{static setLogger(t){yT=t}constructor(t){_n(this,"lockingPromise",we.resolve()),_n(this,"locks",0),_n(this,"name",""),_n(this,"lockId",void 0),this.lockId=_De++,t&&(this.name=t),yT.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,yT.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const n=new we(i=>{e=()=>{this.locks-=1,yT.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),i()}}),r=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function Lg(t,e){return function(n,r,i){const s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const o=this[e];if(!o)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const a=await o.lock("From ".concat(t,".").concat(r));try{for(var A=arguments.length,l=new Array(A),d=0;d<A;d++)l[d]=arguments[d];return await s.apply(this,l)}finally{a()}},i}}const fr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function i2(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function nA(t,e,n,r){const i=Object.assign({},fr,r);let s=i.timeout;const o=async()=>{await function(l){return new we(d=>{window.setTimeout(d,l)})}(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let a=!1;const A=new we(async(l,d)=>{e=e||(()=>!1),n=n||(()=>!0);for(let f=0;f<i.maxRetryCount;f+=1){if(a)return d(new ie(P.OPERATION_ABORTED));try{const p=await t();if(!e(p,f)||f+1===i.maxRetryCount)return l(p);await o()}catch(p){if(!n(p,f)||f+1===i.maxRetryCount)return d(p);await o()}}});return A.cancel=()=>a=!0,A}class Kee{constructor(e){_n(this,"input",[]),_n(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Zc(e=this.input).call(e,(n,r)=>n+r)/this.input.length}}let vT,wT=0,uB=0;function bP(t,e,n,r){return new we((i,s)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),wT+=WA(e.data)):n&&(e.data.size?wT+=e.data.size:e.data instanceof FormData?wT+=Hee(e.data):wT+=WA(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Xs.request(e).then(o=>{typeof o.data=="string"?uB+=WA(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?uB+=o.data.byteLength:uB+=WA(JSON.stringify(o.data)),i(o.data)}).catch(o=>{Xs.isCancel(o)?s(new ie(P.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new ie(P.NETWORK_TIMEOUT,o.message)):o.response?s(new ie(P.NETWORK_RESPONSE_ERROR,o.response.status)):s(new ie(P.NETWORK_ERROR,o.message))})})}async function EDe(t,e){const n=new Blob([e.data],{type:"buffer"});return await bP(t,Be(Be({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const R6=()=>window.isSecureContext!==void 0,ba=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(e&&e[1]&&e[2]){const r=e[1],i=e[2];return"".concat(r,".").concat(i)}const n=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const r=n[1],i=n[2];return"".concat(r,".").concat(100*(Number(i)+1))}return"4.0.0.999"}("4.22.0"),s2=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let ef=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const o2={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},a2="v4.22.0-0-g8569241d-dirty(8/15/2024, 7:04:06 PM)",Jn=Be(Be({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:o2,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1});function Wt(t,e,n){var r,i,s;Se(r=Object.keys(Jn)).call(r,t)&&(!n&&Se(i=Object.keys(Sd)).call(i,t)||(Jn[t]=e,t==="ENABLE_VIDEO_SEI"&&e===!0&&(Jn.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&e&&(s=!!e,Jn.USE_NEW_NETWORK_CONFIG=s,s&&(Jn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Jn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Jn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Jn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Jn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Jn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Jn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(Jn.ENABLE_INSTANT_VIDEO=!0,Jn.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(Jn.ENABLE_AUT_CC=!0)))}function G(t){return Jn[t]}const Sd={};var dt=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(dt||{});class yDe{constructor(e,n,r,i){_n(this,"state",void 0),this.state={codec:e,audioCodec:n,mode:r,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ef.Default}}dispatch(e){this.state=function(n,r){switch(r.type){case dt.SET_SESSION_ID:return Be(Be({},n),{},{sessionId:r.sessionId});case dt.SET_P2P_ID:return Be(Be({},n),{},{p2pId:r.p2pId});case dt.SET_UID:return Be(Be({},n),{},{uid:r.uid});case dt.SET_INT_UID:return Be(Be({},n),{},{intUid:r.intUid});case dt.SET_PUB_ID:return Be(Be({},n),{},{pubId:r.pubId});case dt.KEY_METRIC_CLIENT_CREATED:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{clientCreated:r.metric})});case dt.KEY_METRIC_JOIN_START:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{joinStart:r.metric})});case dt.AVOID_JOIN_START:return Be(Be({},n),{},{avoidJoinStart:r.avoidJoinStart});case dt.KEY_METRIC_JOIN_END:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{joinEnd:r.metric})});case dt.KEY_METRIC_REQUEST_AP_START:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{requestAPStart:r.metric})});case dt.KEY_METRIC_REQUEST_AP_END:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{requestAPEnd:r.metric})});case dt.KEY_METRIC_JOIN_GATEWAY_START:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{joinGatewayStart:r.metric})});case dt.KEY_METRIC_JOIN_GATEWAY_END:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{joinGatewayEnd:r.metric})});case dt.KEY_METRIC_PEER_CONNECTION_START:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{peerConnectionStart:r.metric})});case dt.KEY_METRIC_PEER_CONNECTION_END:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{peerConnectionEnd:r.metric})});case dt.KEY_METRIC_DESCRIPTION_START:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{descriptionStart:r.metric})});case dt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{signalChannelOpen:r.metric})});case dt.KEY_METRIC_ICE_CONNECTION_END:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{iceConnectionEnd:r.metric})});case dt.KEY_METRIC_PUBLISH:{const i=n.keyMetrics.publish,s=i.findIndex(o=>o.trackId===r.metric.trackId);return s!==-1?(i[s]=Be(Be({},i[s]),r.metric),Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{publish:[...i]})})):Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,r.metric]})})}case dt.KEY_METRIC_SUBSCRIBE:{const i=n.keyMetrics.subscribe,s=i.findIndex(o=>o.userId===r.metric.userId&&o.type===r.metric.type);return s!==-1?(i[s]=Be(Be({},i[s]),r.metric),Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{subscribe:[...i]})})):Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,r.metric]})})}case dt.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=r.mode,n;case dt.RECORD_JOIN_CHANNEL_SERVICE:return typeof r.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,r.record]:(n.joinChannelServiceRecords[r.index]=Be(Be({},n.joinChannelServiceRecords[r.index]),r.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case dt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case dt.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case dt.SET_USE_P2P:return Be(Be({},n),{},{useP2P:r.val});case dt.SET_TRANSPORT_TYPE:return Be(Be({},n),{},{p2pTransport:r.val});default:return n}}(this.state,e)}set sessionId(e){this.dispatch({type:dt.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:dt.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:dt.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:dt.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:dt.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:dt.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:dt.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:dt.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:dt.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:dt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:dt.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:dt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:dt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:dt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:dt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:dt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:dt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:dt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:dt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:dt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:dt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,n,r,i){this.dispatch({type:dt.KEY_METRIC_PUBLISH,metric:Be(Be({trackId:e,type:n},r&&{publishStart:r}),i&&{publishEnd:i})})}subscribe(e,n,r,i,s,o,a){this.dispatch({type:dt.KEY_METRIC_SUBSCRIBE,metric:Be(Be(Be(Be(Be({userId:e,type:n},r&&{subscribeStart:r}),i&&{subscribeEnd:i}),s&&{firstFrame:s}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(e,n,r,i){e.forEach(s=>{this.dispatch({type:dt.KEY_METRIC_SUBSCRIBE,metric:Be(Be(Be({userId:s.userId,type:s.type},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,n){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(r=>r.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:dt.RECORD_JOIN_CHANNEL_SERVICE,record:Be(Be({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:dt.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:dt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:dt.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:dt.AVOID_JOIN_START,avoidJoinStart:e})}}let JI=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const O6=128,vDe=96,N6=1e3,qp=10;let wDe=0;function Xn(t,e,n){return(e=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var A=a.call(s,"string");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function D6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function st(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?D6(Object(n),!0).forEach(function(r){Xn(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):D6(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Gee=new class extends Ln{constructor(){super(...arguments),Xn(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class CDe{constructor(e){Xn(this,"logger",void 0),Xn(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function dB(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function B6(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const _a={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},CT=Date.now(),OE=t=>{for(const e in _a)if(Object.prototype.hasOwnProperty.call(_a,e)&&_a[e]===t)return e;return"DEFAULT"},S=new class{constructor(){Xn(this,"proxyServerURL",void 0),Xn(this,"logLevel",_a.DEBUG),Xn(this,"uploadState","collecting"),Xn(this,"uploadLogWaitingList",[]),Xn(this,"uploadLogUploadingList",[]),Xn(this,"uploadErrorCount",0),Xn(this,"currentLogID",0),Xn(this,"url",void 0),Xn(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[_a.DEBUG].concat(e);this.log.apply(this,r)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[_a.INFO].concat(e);this.log.apply(this,r)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[_a.WARNING].concat(e);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[_a.ERROR].concat(e);this.log.apply(this,r)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[_a.DEBUG].concat(e);this.uploadLog.apply(this,r)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Wt("UPLOAD_LOG",!0)}disableLogUpload(){Wt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new CDe(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-CT<100)return void setTimeout(()=>{this.log(...e)},Date.now()-CT);const r=Math.max(0,Math.min(4,e[0]));if(e[0]=dB()+" Agora-SDK [".concat(OE(r),"]:"),this.appendLogToWaitingList(r,...e),r<this.logLevel)return;const i=dB()+" %cAgora-SDK [".concat(OE(r),"]:");let s=[];if(!G("USE_NEW_LOG"))switch(r){case _a.DEBUG:s=[i,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,s);break;case _a.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,s);break;case _a.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,s);break;case _a.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-CT<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-CT);const r=Math.max(0,Math.min(4,e[0]));e[0]=dB()+" Agora-SDK [".concat(OE(r),"]:"),this.appendLogToWaitingList(r,...e)}appendLogToWaitingList(t){if(!G("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=B6()+" Agora-SDK [".concat(OE(t),"]:"):n[0]=B6()+" Agora-SDK [".concat(OE(t),"]:");let i="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:ba,process_id:G("PROCESS_ID"),payload:JSON.stringify(t)};return nA(async()=>{const n=await Xs.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(G("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(G("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:t.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),Gee.reportLogUploadError(r),!0},{timeout:G("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:G("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,G("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),G("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var L6;function TDe(t){return ei(t.reportId,"params.reportId",0,100,!1),ei(t.category,"params.category",0,100,!1),ei(t.event,"params.event",0,100,!1),ei(t.label,"params.label",0,100,!1),zt(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(L6={}).FREE="free",L6.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const SDe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let $r=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t}({}),Dn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let bDe=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});class Cw{constructor(){Xn(this,"baseInfoMap",new Map),Xn(this,"proxyServer",void 0),Xn(this,"eventUploadTimer",void 0),Xn(this,"setSessionIdTimer",void 0),Xn(this,"url",void 0),Xn(this,"backupUrl",void 0),Xn(this,"_appId",void 0),Xn(this,"keyEventUploadPendingItems",[]),Xn(this,"normalEventUploadPendingItems",[]),Xn(this,"apiInvokeUploadPendingItems",[]),Xn(this,"apiInvokeCount",0),Xn(this,"ltsList",[]),Xn(this,"lastSendNormalEventTime",Date.now()),Xn(this,"customReportCounterTimer",void 0),Xn(this,"customReportCount",0),Xn(this,"extApiInvoke",async e=>{for(const n of e){const r=st(st({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:xn.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),G("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),G("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void S.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const n=this.baseInfoMap.get(e),r=Date.now(),i=n.startTime;n.startTime=r,S.debug("rewrite session ".concat(e," startTime: ").concat(r," , ").concat(r-i,"ms")),this.baseInfoMap.set(e,n)}setAppId(e){this._appId=e}reportApiInvoke(e,n,r){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const i=Date.now();this.apiInvokeCount+=1;const s=this.apiInvokeCount,o=()=>({tag:n.tag,invokeId:s,sid:e,name:n.name,apiInvokeTime:i,options:n.options,states:n.states||null}),a=!!G("SHOW_REPORT_INVOKER_LOG");a&&S.info("".concat(n.name," start"),n.options);let A=!1;ai(n.timeout).then(()=>{A||(this.sendApiInvoke(st(st({},o()),{},{error:P.API_INVOKE_TIMEOUT,success:!1})),S.debug("".concat(n.name," timeout")))});const l=new ie(P.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:d=>{const f=()=>{if(A)throw l;return A=!0,this.sendApiInvoke(st(st({},o()),{},{success:!0},n.reportResult&&{result:d})),a&&S.info("".concat(n.name," onSuccess")),d};return r?S6(f,n.name+"Success",r,()=>A=!0):f()},onError:d=>{const f=()=>{if(A)throw d;A=!0,this.sendApiInvoke(st(st({},o()),{},{success:!1,error:d})),a&&S.info("".concat(n.name," onFailure"),d.toString())};return r?S6(f,n.name+"Error",r,()=>A=!0):f()}}}sessionInit(e,n){if(this.baseInfoMap.has(e))return;const r=Date.now(),i=this.createBaseInfo(e,r);i.cname=n.cname;const s=Object.assign({},{willUploadConsoleLog:G("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:s2?"global":"oversea",areas:G("AREAS")&&G("AREAS").join(",")},n.extend),{stringUid:o,channelProfile:a,channelMode:A,isABTestSuccess:l,lsid:d,clientRole:f}=n,p=Date.now(),g=st(st({},i),{},{eventType:$r.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:a2,lts:p,elapse:p-r,extend:JSON.stringify(s),mode:n.mode,process:G("PROCESS_ID"),appType:G("APP_TYPE"),success:!0,version:ba,stringUid:o,channelProfile:a,channelMode:A,isABTestSuccess:l,lsid:d,clientType:Se(y=window.navigator.userAgent).call(y,"AgoraWebView")?42:20,clientRole:f,serviceId:G("PROCESS_ID"),extensionID:G("PLUGIN_INFO").join(",")||""});var y;this.send({type:Dn.SESSION,data:g},!0)}joinChooseServer(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st({},i),{},{eventType:$r.JOIN_CHOOSE_SERVER,lts:s,eventElapse:n.elapse||s-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:s-r.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3});this.send({type:Dn.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st({},i),{},{eventType:$r.REQ_USER_ACCOUNT,lts:s,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||s-r.startTime,eventElapse:s-n.lts,extend:JSON.stringify(n.extend)});this.send({type:Dn.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info;n.vid&&(i.vid=n.vid),i.uid=n.uid,i.cid=n.cid;const s=Date.now(),{firstSuccess:o,avoidJoinStartTime:a}=n,A=s-(o&&a?a:r.startTime),l=st(st({},i),{},{eventType:$r.JOIN_GATEWAY,lts:s,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,errorMsg:n.errorMsg||"",elapse:A,eventElapse:s-n.lts,firstSuccess:o,signalChannel:n.signalChannel,preload:n.preload?1:0});n.succ&&(r.lastJoinSuccessTime=s),this.send({type:Dn.JOIN_GATEWAY,data:l},!0)}joinChannelTimeout(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=Date.now(),s=st(st({},r.info),{},{lts:i,timeout:n,elapse:i-r.startTime});this.send({type:Dn.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st({},i),{},{eventType:$r.PUBLISH,lts:s,eventElapse:n.eventElapse,elapse:s-r.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:Dn.PUBLISH,data:o},!0)}subscribe(e,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),a=st(st({},s),{},{eventType:$r.SUBSCRIBE,lts:o,eventElapse:n.eventElapse,elapse:o-i.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid,preSsrc:n.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?a.peerSuid=n.peerid:a.peer=n.peerid,this.send({type:Dn.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var n;const r=[...Ko(n=this.baseInfoMap).call(n)],i=r.length?r[0]:"UnableToGetSid",s=this.baseInfoMap.get(i);if(!s)return;const o=s.info,a=Date.now(),A=st(st({},o),{},{eventType:$r.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-s.startTime,status:e.status?1:2});this.send({type:Dn.WS_COMPRESSOR_INIT,data:A},!0)}firstRemoteVideoDecode(e,n,r,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,a=Date.now(),A=st(st(st({},o),i),{},{elapse:a-s.startTime,eventType:n,lts:a,firstDecodeFrame:Math.max((i.firstFrame||a)-s.startTime,0),apEnd:Math.max(i.apEnd-s.startTime,0),apStart:Math.max(i.apStart-s.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-s.startTime,0),joinGwStart:Math.max(i.joinGwStart-s.startTime,0),pcEnd:Math.max(i.pcEnd-s.startTime,0),pcStart:Math.max(i.pcStart-s.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-s.startTime,0),subscriberStart:Math.max(i.subscriberStart-s.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-s.startTime,0)});this.send({type:r,data:A},!0)}firstRemoteFrame(e,n,r,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,a=Date.now(),A=st(st(st({},o),i),{},{elapse:a-s.startTime,eventType:n,lts:a});this.send({type:r,data:A},!0)}pcStats(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st(st({},i),n),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:s-r.startTime,eventType:$r.PC_STATS,lts:s,preallocation:n.preallocation?1:0});this.send({type:Dn.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,n){if(e){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st(st({},i),n),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:$r.UPDATE_REMOTE_RTPCAPABILITIES,lts:s});this.send({type:Dn.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,n,r,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,a=Date.now(),A=st(st(st({},o),i),{},{eventType:n,lts:a});this.send({type:r,data:A},!0)}streamSwitch(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st({},i),{},{eventType:$r.STREAM_SWITCH,lts:s,isDual:n.isdual,elapse:s-r.startTime,success:n.succ});this.send({type:Dn.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st({},i),{},{eventType:$r.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-n.lts,elapse:s-r.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Dn.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st({},i),{},{eventType:$r.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-n.lts,elapse:s-r.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Dn.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?S.debug("reportProxyServerurl: ".concat(e)):S.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st({},i),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:s,elapse:s-r.startTime,joinChannelSuccessElapse:s-(r.lastJoinSuccessTime||s),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:Dn.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now();(function(o,a,A){const l=o[a];if(!l||typeof l!="string")return[o];o[a]="";const d=WA(JSON.stringify(o));let f=0;const p=[];let g=0;for(let y=0;y<l.length;y++)g+=l.charCodeAt(y)<=127?1:3,g<=A-d||(p[p.length]=Be(Be({},o),{},{[a]:l.substring(f,y)}),f=y,g=l.charCodeAt(y)<=127?1:3);return f!==l.length-1&&(p[p.length]=Be(Be({},o),{},{[a]:l.substring(f)})),p})(st(st(st({},i),n),{},{elapse:s-r.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach(o=>this.send({type:Dn.WORKER_EVENT,data:o},!0))}apworkerEvent(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st(st({},i),n),{},{elapse:s-r.startTime,lts:s});this.send({type:Dn.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st(st({},i),n),{},{elapse:s-r.startTime,lts:s,extend:n.extend||void 0});this.send({type:Dn.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=st(st(st({},i),n),{},{elapse:s-r.startTime,lts:s});this.send({type:Dn.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,n){if(this.customReportCount+=n.length,this.customReportCount>G("CUSTOM_REPORT_LIMIT"))throw new ie(P.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r=Date.now(),i=n.map(s=>({type:Dn.USER_ANALYTICS,data:st(st({sid:e},s),{},{lts:r})}));try{G("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(s){throw S.error("send custom report message failed",s.toString()),new ie(P.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(e){const n=G("NOT_REPORT_EVENT");if(e.tag&&Se(n)&&Se(n).call(n,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:s,cid:o}=r.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ie){const{code:l,message:d}=e.error;a=l||d||e.error.toString()}else a=e.error.toString();const A={invokeId:e.invokeId,sid:e.sid,cname:i,cid:o,uid:s,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Dn.API_INVOKE,data:A},!1),!0}appendSessionId(){Cw.__CLIENT_LIST__.forEach(e=>{if(e._sessionId){const n=this.apiInvokeUploadPendingItems.length;for(let r=0;r<n;r++){const i=this.apiInvokeUploadPendingItems.shift();i&&(i.sid=e._sessionId,this.sendApiInvoke(Object.assign({},i)))}}})}send(e,n){if(n)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,n){const r=[],i=[];for(;e.length;){const o=e.shift();r.length<20?r.push(o):i.push(o)}e.push(...i);for(const o of[...r]){var s;this.ltsList.indexOf(o.data.lts)!==-1?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),_w(s=this.ltsList).call(s,(a,A)=>a-A))}return n||(this.lastSendNormalEventTime=Date.now()),G("ENABLE_EVENT_REPORT")&&r.length&&(G("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((o=>a=>{G("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o),this.normalEventUploadPendingItems.length>G("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-G("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){or.networkState===bo.OFFLINE&&await we.race([or.onlineWaiter,ai(2*fr.maxRetryTimeout)]);const n=s=>{let o=new Uint8Array;return s.forEach(a=>{const A=r2(JSON.stringify(a.data)),l=new ArrayBuffer(5),d=(p=>{let g=0;return Object.entries(Dn).forEach(y=>{let[E,w]=y;w===p.type&&(g=bDe[E])}),g})(a),f=new DataView(l);f.setUint16(0,A.byteLength,!0),f.setUint8(2,255&d),f.setUint8(3,d>>>8&255),f.setUint8(4,d>>>16&255),o=E6(o,new Uint8Array(l)),o=E6(o,A)}),o},r="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let s=0;s<2;s+=1){s===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(G("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await bP(i,{timeout:1e4,data:n(e),headers:st(st({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o){if(s===1)throw o;continue}return}}async postDataToStatsCollector(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(o=>JSON.stringify(o)),vid:(o=>{const a=o&&o.data.sid&&this.baseInfoMap.get(o.data.sid);return a&&a.info.vid&&+a.info.vid||0})(e[0])};or.networkState===bo.OFFLINE&&await we.race([or.onlineWaiter,ai(2*fr.maxRetryTimeout)]);const i=n?"/events/proto-raws":"/events/messages";let s=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(G("EVENT_REPORT_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(i));for(let o=0;o<2;o+=1){o===1&&(s=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(G("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(G("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(G("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(G("STATS_COLLECTOR_PORT")).concat(i)));try{n?await EDe(s,{timeout:1e4,data:r}):await bP(s,{timeout:1e4,data:r})}catch(a){if(o===1)throw a;continue}return}}createBaseInfo(e,n){const r=Object.assign({},SDe);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:n}),r}reportResourceTiming(e,n){const r=performance.getEntriesByName(e),i=r[r.length-1];i&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:i,tag:xn.TRACER}).onSuccess()}}function je(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,r){const i=r.value;if(typeof i=="function"){const s=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);r.value=function(){for(var o=arguments.length,a=new Array(o),A=0;A<o;A++)a[A]=arguments[A];let l=a;if(t.argsMap)try{l=t.argsMap(this,...a)}catch(f){S.warning(f),l=[]}try{JSON.stringify(l)}catch{S.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),l=[]}const d=(t.report||Le).reportApiInvoke(this._sessionId||null,{name:"".concat(s,".").concat(String(n)),options:l,tag:xn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const f=i.apply(this,a);return f instanceof we?f.then(p=>(d.onSuccess(t.reportResult&&p),p)).catch(p=>{throw d.onError(p),p}):(d.onSuccess(t.reportResult&&f),f)}catch(f){throw d.onError(f),f}}}return r}}Xn(Cw,"__CLIENT_LIST__",[]);const Le=new Cw;Gee.on("REPORT_LOG_UPLOAD",t=>{t.networkState=or.networkState,Le.reportApiInvoke(null,{name:"logUploadError",options:t,tag:xn.TRACER}).onSuccess("logUploadError")});const IDe=["CHINA","GLOBAL"],mi=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let a=0;a<6;a++)i.push("1");const s=i.join(""),o={};return o[t]=r,o[e]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=mi,s2||(Jn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Jn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Jn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Jn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Jn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Jn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Jn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Jn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Jn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Jn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Jn.AREAS=["NORTH_AMERICA","OVERSEA"]);const Wee=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],gd=[];function Gh(t,e){return!!e&&gd.some(n=>n.uid===t&&n.channelName===e)}Cw.__CLIENT_LIST__=gd;var RDe=HZ.forEach,P6=BI("forEach")?[].forEach:function(t){return RDe(this,t,arguments.length>1?arguments[1]:void 0)};sn({target:"Array",proto:!0,forced:[].forEach!=P6},{forEach:P6});var ODe=Cc("Array").forEach,NDe=ll,DDe=Mi,BDe=Bs,LDe=ODe,hB=Array.prototype,PDe={DOMTokenList:!0,NodeList:!0},UDe=function(t){var e=t.forEach;return t===hB||BDe(hB,t)&&e===hB.forEach||DDe(PDe,NDe(t))?LDe:e},kDe=Zn(UDe),xDe=Al,U6=kI;sn({target:"Object",stat:!0,forced:Sr(function(){U6(1)})},{keys:function(t){return U6(xDe(t))}});var zee=Zn(tA.Object.keys),MDe=Zn(e$),FDe=sn,VDe=Ew,QDe=mr([].reverse),k6=[1,2];FDe({target:"Array",proto:!0,forced:String(k6)===String(k6.reverse())},{reverse:function(){return VDe(this)&&(this.length=this.length),QDe(this)}});var HDe=Cc("Array").reverse,jDe=Bs,KDe=HDe,fB=Array.prototype,GDe=function(t){var e=t.reverse;return t===fB||jDe(fB,t)&&e===fB.reverse?KDe:e},qee=GDe,WDe=Zn(qee),zDe=sn,x6=Ew,qDe=FI,YDe=ta,M6=vx,XDe=wu,JDe=Ah,$De=HI,ZDe=cr,eBe=Px,tBe=MZ("slice"),nBe=ZDe("species"),pB=Array,rBe=Math.max;zDe({target:"Array",proto:!0,forced:!tBe},{slice:function(t,e){var n,r,i,s=JDe(this),o=XDe(s),a=M6(t,o),A=M6(e===void 0?o:e,o);if(x6(s)&&(n=s.constructor,(qDe(n)&&(n===pB||x6(n.prototype))||YDe(n)&&(n=n[nBe])===null)&&(n=void 0),n===pB||n===void 0))return eBe(s,a,A);for(r=new(n===void 0?pB:n)(rBe(A-a,0)),i=0;a<A;a++,i++)a in s&&$De(r,i,s[a]);return r.length=i,r}});var iBe=Cc("Array").slice,sBe=Bs,oBe=iBe,mB=Array.prototype,aBe=function(t){var e=t.slice;return t===mB||sBe(mB,t)&&e===mB.slice?oBe:e},cBe=Zn(aBe);function Oe(t,e,n,r,i){var s,o,a,A={};return kDe(s=zee(r)).call(s,function(l){A[l]=r[l]}),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=MDe(o=WDe(a=cBe(n).call(n)).call(a)).call(o,function(l,d){return d(t,e,l)||l},A),i&&A.initializer!==void 0&&(A.value=A.initializer?A.initializer.call(i):void 0,A.initializer=void 0),A.initializer===void 0&&(kZ(t,e,A),A=null),A}let IP=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),Mo=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({}),q0=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),gB=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),za=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),gs=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),Ve=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),tn=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),qe=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t}({}),We=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),Ev=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),ht=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Ts=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Ye=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});class te extends ie{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),N(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,S)}throw(){super.throw(S)}}function $I(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw S.error("Invalid Channel Name ".concat(t)),new te(P.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function ZI(t){if(!function(e){return typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295}(t)&&!xee(t,1,255))throw new te(P.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof t=="string"&&S.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let nu=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const ABe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},_B={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function EB(t,e){ei(t.url,"".concat(e,".url"),1,1e3,!1),Nn(t.x)||zt(t.x,"".concat(e,".x"),0,1e4),Nn(t.y)||zt(t.y,"".concat(e,".y"),0,1e4),Nn(t.width)||zt(t.width,"".concat(e,".width"),0,1e4),Nn(t.height)||zt(t.height,"".concat(e,".height"),0,1e4),Nn(t.zOrder)||zt(t.zOrder,"".concat(e,".zOrder"),0,255),Nn(t.alpha)||zt(t.alpha,"".concat(e,".alpha"),0,1,!1)}const lBe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let _d=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),RP=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),vr=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function F6(t){if(!t.channelName)throw new te(P.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new te(P.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&ei(t.token,"info.token",1,2047),ZI(t.uid),$I(t.channelName),!0}let _s=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),Kl=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),ro=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Sm=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),kt=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),pi=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t}({}),Y0=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),Lr=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Lt=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const V6=[Lt.AFRICA,Lt.ASIA,Lt.CHINA,Lt.EUROPE,Lt.GLOBAL,Lt.INDIA,Lt.JAPAN,Lt.NORTH_AMERICA,Lt.OCEANIA,Lt.OVERSEA,Lt.SOUTH_AMERICA];let Bi=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const eR={CHINA:{},ASIA:{CODE:Bi.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Bi.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Bi.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Bi.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Bi.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Bi.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Bi.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Bi.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Bi.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Bi.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Bi.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Bi.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Bi.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};s2&&(eR.CHINA={CODE:Bi.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let OP=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t}({});class Yee extends Ln{constructor(e,n){super(),N(this,"onICEConnectionStateChange",void 0),N(this,"onConnectionStateChange",void 0),N(this,"onDTLSTransportStateChange",void 0),N(this,"onDTLSTransportError",void 0),N(this,"onICETransportStateChange",void 0),N(this,"onFirstAudioReceived",void 0),N(this,"onFirstVideoReceived",void 0),N(this,"onFirstAudioDecoded",void 0),N(this,"onFirstVideoDecoded",void 0),N(this,"onFirstVideoDecodedTimeout",void 0),N(this,"onSelectedLocalCandidateChanged",void 0),N(this,"onSelectedRemoteCandidateChanged",void 0),N(this,"getLocalVideoStats",void 0)}}class Xee extends Yee{constructor(e,n){super(e,n),N(this,"establishPromise",void 0)}}let Pe=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),Io=function(t){return t[t.UDP=0]="UDP",t[t.TCP=1]="TCP",t[t.RELAY=2]="RELAY",t}({}),kl=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.TCP_RESTART=1]="TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({}),le=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Ut=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Ke=function(t){return t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),ec=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),qa=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Hr=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Jee=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),QA=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),ma=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Qc=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Yp=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Yn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Xp=function(t){return t.ABORT="abort",t}({}),bd=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),uBe=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const dBe={[q0.ACCESS_POINT]:{[gs.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[gs.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[gs.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[gs.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[gs.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[gs.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[gs.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[q0.UNILBS]:{[za.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[za.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[za.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[za.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[za.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[za.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[za.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[za.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[za.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[za.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[za.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[za.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[q0.STRING_UID_ALLOCATOR]:{[gB.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[gB.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[gB.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Pg(t){const e=dBe[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===q0.ACCESS_POINT){const r=t%1e4;if(r.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const hBe={[Ve.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ve.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ve.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ve.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ve.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ve.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ve.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ve.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ve.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ve.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ve.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ve.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ve.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ve.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ve.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ve.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ve.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ve.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ve.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ve.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ve.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ve.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ve.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ve.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ve.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ve.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ve.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ve.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ve.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ve.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ve.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ve.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ve.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ve.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ve.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ve.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ve.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ve.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ve.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ve.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ve.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ve.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ve.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ve.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ve.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ve.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ve.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ve.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ve.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ve.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ve.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ve.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ve.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ve.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ve.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ve.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ve.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ve.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ve.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ve.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ve.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ve.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ve.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function yv(t){return hBe[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function Q6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function yB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Q6(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q6(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function H6(t){return t.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)}function j6(t,e){if(typeof t=="string")return t;const{proxy:n,host:r,port:i}=t;if(e){const s=G("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const fBe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,pBe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,mBe=/wss:\/\/(.+):([0-9]+)\/?/,gBe=/wss:\/\/(.[^\/]+)\/?/;let _Be=0;class EBe{constructor(e,n){N(this,"id",0),N(this,"store",void 0),N(this,"recordIndex",void 0),N(this,"websockets",[]),N(this,"try443PortDuration",2e3),N(this,"forceCloseWSDuration",5e3),N(this,"try443PortTimeout",null),N(this,"forceCloseTimeout",null),N(this,"isTry443PortFailed",!1),N(this,"isNormalPortFailed",!1),N(this,"useDoubleDomain",!1),N(this,"useProxy",!1),N(this,"startTime",Date.now()),this.id=++_Be,this.try443PortDuration=G("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];S.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(e,n,r){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:r});const i=G("GATEWAY_DOMAINS"),s=Date.now(),o=[],a=i.find(d=>{var f;return Se(f=e.host).call(f,d)});a||(this.useDoubleDomain=!1);const A=[];if(this.useDoubleDomain)i.forEach(d=>{A.push(j6(yB(yB({},e),{},{host:e.host.replace(a,d)}),n))});else{const d=yB({},e);if(n&&a){const f=i.find(p=>p!==a);f&&(d.host=d.host.replace(a,f))}A.push(j6(d,n))}try{A.forEach(d=>{const f=new WebSocket(d);f.binaryType="arraybuffer",o.push(f),this.logger("ws is connecting:",f.url)})}catch(d){if(this.logger("ws create failed"),o.forEach(f=>f.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,r);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,r);throw new te(P.WS_ERR,"init websocket failed! Error: ".concat(d.toString()))}const l=mv();return this.store&&this.store.recordJoinChannelService({urls:o.map(d=>d.url),service:"gateway"},this.recordIndex),o.forEach(d=>{d.onopen=()=>{this.logger("onopen: ws ".concat(d.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(f=>{f!==d&&(f.onopen=null,f.onclose=null,f.onmessage=null,f.close(),this.logger("close backup websocket: ".concat(f.url)))}),this.websockets.length=0,l.resolve(d)},d.onclose=f=>{this.logger("onclose: ws ".concat(d.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(d.readyState)),n?this.isTry443PortFailed=H6(o):this.isNormalPortFailed=H6(o),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(n&&this.isTry443PortFailed||!n&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(f.reason)),l.reject({code:f.code,reason:Y0.A_ROUND_WS_FAILED}))},d.onmessage=f=>this.logger("".concat(d.url," onmessage: ").concat(f.data))}),this.websockets.push(...o),r||(()=>{const d=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",l.isResolved),this.websockets.forEach(f=>f.readyState!==WebSocket.OPEN&&f.close())};if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(d,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",l.isResolved),l.isResolved)return d();Ct().os===Pr.MAC_OS&&Fn()&&d(),this.createWebSocket(e,!0,!0).then(f=>l.resolve(f)).catch(f=>{this.isNormalPortFailed&&l.reject(f),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(d,this.forceCloseWSDuration)},this.try443PortDuration)})(),l.promise}chooseBestWebsocket(e,n,r,i){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(s){let o,a,A;return[,o,a,A]=s.match(fBe)||[],o||([,a,A]=s.match(pBe)||[]),a&&A||([,a,A]=s.match(mBe)||[]),a&&A||([,a]=s.match(gBe)||[]),a||S.warning("un-destructible url: ",s),{proxy:o,host:a,port:A||"443"}}(e)),this.recordIndex=i,this.useProxy=!!e.proxy,r&&this.useProxy&&(S.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(e,!!r,!1).finally(()=>this.clearTimeout())}}function K6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}class $ee extends Ln{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;Se(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(Ye.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ye.CONNECTED):this._state==="closed"?this.emit(Ye.CLOSED):this._state==="failed"&&this.emit(Ye.FAILED))}resetReconnectCount(e){S.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),N(this,"connectionID",0),N(this,"currentURLIndex",0),N(this,"urls",[]),N(this,"_reconnectMode","tryNext"),N(this,"reconnectReason",void 0),N(this,"_initMutex",new xi("websocket")),N(this,"name",void 0),N(this,"_state","closed"),N(this,"reconnectInterrupter",void 0),N(this,"websocket",void 0),N(this,"retryConfig",void 0),N(this,"reconnectCount",0),N(this,"forceCloseTimeout",5e3),N(this,"onlineReconnectListener",void 0),N(this,"useCompress",void 0),N(this,"tryDoubleDomain",!1),N(this,"use443PortOnly",!1),N(this,"wsInflateLength",0),N(this,"wsDeflateLength",0),N(this,"closeEstablishingWs",()=>{}),N(this,"store",void 0),N(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(f){for(var p=1;p<arguments.length;p++){var g=arguments[p]!=null?arguments[p]:{};p%2?K6(Object(g),!0).forEach(function(y){N(f,y,g[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(g)):K6(Object(g)).forEach(function(y){Object.defineProperty(f,y,Object.getOwnPropertyDescriptor(g,y))})}return f}({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=s;const{timeout:a,timeoutFactor:A}=n,l=Math.max(300,Math.floor(3*a/5)),d=Math.max(1.2,Math.floor(8*A)/10);bo.ONLINE&&(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d),or.on(xm.NETWORK_STATE_CHANGE,(f,p)=>{f!==p&&(this.resetReconnectCount("network state change: ".concat(p," -> ").concat(f)),f===bo.ONLINE?(this.retryConfig.timeout=l,this.retryConfig.timeoutFactor=d):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=A))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const i=mv(),s=this.urls[this.currentURLIndex];G("ENABLE_PREALLOC_PC")&&this.emit(Jee.PRE_CONNECT_PC),this.createWebSocketConnection(s).then(i.resolve).catch(i.reject),this.once(Ye.CLOSED,()=>{i.reject(new ie(P.WS_DISCONNECT))}),this.once(Ye.CONNECTED,i.resolve),await i.promise}catch{}finally{r()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void S.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),S.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ie(P.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(r){throw new ie(P.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const r=mv();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=d=>{var f;(f=this.store)===null||f===void 0||f.signalChannelOpen(),S.debug("[".concat(this.name,"] websocket opened:"),d),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async d=>{var f;if(S.debug("[".concat(this.name,"] websocket close ").concat((f=this.websocket)===null||f===void 0?void 0:f.url,", code: ").concat(d.code,", reason: ").concat(d.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new ie(P.WS_DISCONNECT,"websocket close: ".concat(d.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=d.reason,this.state="reconnecting");const p=Sa(this,Ye.WILL_RECONNECT,this.reconnectMode,d.reason)||this.reconnectMode,g=await this.reconnectWithAction(p);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!g)return r.reject(new ie(P.WS_DISCONNECT,"websocket reconnect failed: ".concat(d.code))),this.close(!0);r.resolve()}},o=d=>{this.emit(Ye.ON_MESSAGE,d)},a=d=>{S.warn("[".concat(this.connectionID,"] ws open error ").concat(d))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),G("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=G("GATEWAY_WSS_ADDRESS")),S.debug("[".concat(this.name,"] start connect, url:"),e);const A=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var l;const d=await this.chooseBestWebsocketConnection(e);this.websocket=d,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=a,(l=this.store)===null||l===void 0||l.recordJoinChannelService({endTs:Date.now(),status:"success"},A),this.joinGatewayRecordIndex=A}catch(d){const f=this.state==="closed",p=d instanceof ie,g=p&&d.code===P.WS_ABORT,y=p&&d.code===P.WS_ERR,E=p?d.message:d&&(d.reason||d.toString());S.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(E)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:g?"aborted":"error",errors:[d]},A),f||y?(r.reject(f?new ie(P.WS_DISCONNECT,"websocket is closed: ".concat(E)):new ie(P.WS_ERR,"init websocket failed: ".concat(E))),y&&S.error("[".concat(this.name,"] init websocket failed: ").concat(E))):s&&s(d)}return r.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;S.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||or.isOnline||!or.onlineWaiter||(this.onlineReconnectListener=or.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const o=i2(this.reconnectCount,this.retryConfig);S.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(e)),await we.race([ai(o),this.onlineReconnectListener||new we(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(o,a)=>{this.emit(Ye.RECONNECT_CREATE_CONNECTION,a),await this.createWebSocketConnection(o)};try{if(e==="retry")this.emit(Ye.RECONNECT_WAITTING_FINISH,e),await i(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);S.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Ye.RECONNECT_WAITTING_FINISH,e),await i(this.urls[this.currentURLIndex],e)}else e==="recover"&&(S.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Ye.RECONNECT_WAITTING_FINISH,e),this.urls=await vi(this,Ye.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],e))}catch(o){var s;S.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));const a=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(a)&&Se(a).call(a,"dynamic key expired")?(this.emit(Ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class c2 extends $ee{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const r=mv(),i=function(o,a){return new EBe(o,a)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new ie(P.WS_ABORT,"choose best websocket aborted"))};const s=G("GATEWAY_DOMAINS");return S.debug("[choose-best-ws] currentDomain: ",e,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class vv extends $ee{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new we((r,i)=>{let s=!1;const o=[];this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),o.forEach(y=>{y.onclose=null,y.onopen=null,y.onmessage=null,y.close()}),i(new ie(P.WS_ABORT,"choose best websocket aborted"))};const a=G("GATEWAY_DOMAINS");let A;const l=e.indexOf("?h="),d=a.find(y=>l!==-1?Se(e).call(e,y,l):Se(e).call(e,y));S.debug("[choose-best-ws] currentDomain: ",d,", domains: ",a);let f=!this.tryDoubleDomain||!d;if(!f&&d){var p;const y=Date.now();try{a.forEach(E=>{const w=l===-1?e.replace(d,E):e.substr(0,l)+e.substr(l).replace(d,E),b=new WebSocket(w);b.binaryType="arraybuffer",o.push(b),S.debug("[choose-best-ws] ws is connecting:",b.url)})}catch{for(S.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(w=>w.close());o.length;)o.pop();f=!0}(p=this.store)===null||p===void 0||p.recordJoinChannelService({urls:o.map(E=>E.url),service:"gateway"},n),o.forEach(E=>{E.onopen=()=>{if(s)return;const w=Date.now()-y;S.debug("[choose-best-ws] ws open cost ".concat(w,"ms")),o.filter(b=>b!==E).forEach(b=>{S.debug("[choose-best-ws]close backup websocket: ".concat(b.url)),b.close()}),s=!0,r(E)},E.onclose=w=>{A=w,!s&&(o.find(b=>!(b.readyState===WebSocket.CLOSED||b.readyState===WebSocket.CLOSING))||(S.debug("[choose-best-ws] all websocket is closed"),s=!0,i(A)))},E.onmessage=w=>{S.debug("[choose-best-ws]".concat(E.url," onmessage: ").concat(w.data))}}),ai(this.forceCloseTimeout).then(()=>{o.forEach(E=>{E.readyState!==WebSocket.OPEN&&E.close()})})}if(f){var g;let y;S.debug("[choose-best-ws] use single url: ",e),(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:[e],service:"gateway"},n);try{y=new WebSocket(e),o.push(y),y.binaryType="arraybuffer"}catch(E){const w=new ie(P.WS_ERR,"init websocket failed! Error: ".concat(E.toString()));return S.error("[".concat(this.name,"]").concat(w)),void i(w)}y.onopen=()=>{r(y)},y.onclose=E=>{i(E)},y.onmessage=E=>{S.debug("[choose-best-ws]".concat(y.url," onmessage: ").concat(E.data))},ai(this.forceCloseTimeout).then(()=>{y&&y.readyState!==WebSocket.OPEN&&y.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class yBe extends Ln{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===tn.CONNECTED?this.emit(qe.WS_CONNECTED):e===tn.RECONNECTING?this.emit(qe.WS_RECONNECTING,this._websocketReconnectReason):e===tn.CLOSED&&this.emit(qe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",tn.CLOSED),N(this,"reconnectToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new Kee(5)),N(this,"pingpongTimer",void 0),N(this,"wsInflateDataTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(qe.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===ht.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===ht.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Ft.UID_BANNED);break;case 15:this.close(Ft.IP_BANNED);break;case 16:this.close(Ft.CHANNEL_BANNED)}if(i._type===ht.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Ve.ERR_LICENSE_MISSING:this.close(Ft.LICENSE_MISSING);break;case Ve.ERR_LICENSE_EXPIRED:this.close(Ft.LICENSE_EXPIRED);break;case Ve.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ft.LICENSE_MINUTES_EXCEEDED);break;case Ve.ERR_LICENSE_PERIOD_INVALID:this.close(Ft.LICENSE_PERIOD_INVALID);break;case Ve.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ft.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ve.ERR_LICENSE_ILLEGAL:this.close(Ft.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new c2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===tn.CONNECTED&&this.reconnect("retry",_i.OFFLINE)})}async request(e,n,r,i){const s=nn(6,""),o={_id:s,_type:e,_message:n},a=this.websocket.connectionID,A=()=>new we((y,E)=>{if(this.connectionState===tn.CONNECTED)return y();const w=()=>{this.off(qe.WS_CLOSED,b),y()},b=()=>{this.off(qe.WS_CONNECTED,w),E(new te(P.WS_ABORT))};this.once(qe.WS_CONNECTED,w),this.once(qe.WS_CLOSED,b),e!==We.PUBLISH&&e!==We.PUBLISH_DATASTREAM&&e!==We.SUBSCRIBE&&e!==We.SUBSCRIBE_DATASTREAM&&e!==We.UNSUBSCRIBE&&e!==We.UNSUBSCRIBE_DATASTREAM&&e!==We.UNPUBLISH&&e!==We.UNPUBLISH_DATASTREAM&&e!==We.CONTROL&&e!==We.RESTART_ICE||this.once(qe.DISCONNECT_P2P,()=>{E(new te(P.DISCONNECT_P2P))}),e!==We.PUBLISH&&e!==We.RESTART_ICE||this.once(qe.ABORT_P2P_EXECUTION,()=>{E(new te(P.DISCONNECT_P2P))})});if(this.connectionState!==tn.CONNECTING&&this.connectionState!==tn.RECONNECTING||e===We.JOIN||e===We.REJOIN||await A(),this.websocket.sendMessage(o,!0),i)return;const l=new we((y,E)=>{let w=!1;const b=(B,U)=>{w=!0,y({isSuccess:B==="success",message:U||{}}),this.off(qe.WS_CLOSED,I),this.off(qe.WS_RECONNECTING,I),this.emit(qe.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),b);const I=()=>{E(new te(P.WS_ABORT,"type: ".concat(e))),this.off(qe.WS_CLOSED,I),this.off(qe.WS_RECONNECTING,I),this.off("res-@".concat(s),b)};this.once(qe.WS_CLOSED,I),this.once(qe.WS_RECONNECTING,I),ai(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||w||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(qe.REQUEST_TIMEOUT,e,n))})});let d=null;try{d=await l}catch(y){if(this.connectionState===tn.CLOSED||e===We.LEAVE)throw new te(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?y.throw():e===We.JOIN||e===We.REJOIN?null:(await A(),await this.request(e,n))}if(d.isSuccess)return d.message;const f=Number(d.message.error_code||d.message.code),p=yv(f),g=new te(P.UNEXPECTED_RESPONSE,"".concat(p.desc,": ").concat(d.message.error_str),{code:f,data:d.message,desc:p.desc});return p.action==="success"?d.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(f,", message: ").concat(p.desc,", action: ").concat(p.action)),f===Ve.ERR_TOO_MANY_BROADCASTERS?((e===We.JOIN||e===We.REJOIN)&&(this.initError=g,this.close()),g.throw()):p.action==="failed"?g.throw():p.action==="quit"?(this.initError=g,this.close(),g.throw()):(f===Ve.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=d.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",_i.MULTI_IP)):this.reconnect(p.action,_i.SERVER_ERROR),e===We.JOIN||e===We.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new we(r=>{const i=s=>{(!n||n(s))&&(this.off(e,i),r(s))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Ev.WRTC_STATS,n)}upload(e,n){const r={_type:e,_message:n};try{this.websocket.sendMessage(r)}catch{const s=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==tn.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const r={_type:e,_message:n};this.websocket.sendMessage(r)}init(e,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new we((r,i)=>{this.once(qe.WS_CONNECTED,()=>r(this.joinResponse)),this.once(qe.WS_CLOSED,()=>i(this.initError||new te(P.WS_ABORT))),this.connectionState=tn.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Ft.LEAVE,this.connectionState=tn.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(qe.ABORT_P2P_EXECUTION);const e=await vi(this,qe.REQUEST_JOIN_INFO),n=await this.request(We.JOIN,e);if(!n)return this.emit(qe.REPORT_JOIN_GATEWAY,Y0.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(qe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=tn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new te(P.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=_v(this,qe.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(We.REJOIN,e);return!!n&&(this.connectionState=tn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(ht.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(ht.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(ht.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(ht.MUTE_AUDIO,{uid:r.uid}):this.emit(ht.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(ht.MUTE_VIDEO,{uid:r.uid}):this.emit(ht.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(ht.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(ht.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(ht.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(ht.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(ht.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){S.debug("[".concat(this.clientId,"] receive notification: "),e);const n=yv(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ft.UID_BANNED),void this.close()):void this.reconnect(n.action,_i.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=G("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(S.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_i.TIMEOUT):this.request(We.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(We.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(Ev.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Ye.RECONNECT_WAITTING_FINISH,e=>{this.emit(qe.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(Ye.RECONNECT_CREATE_CONNECTION,e=>{this.emit(qe.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Ye.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ye.CLOSED,()=>{this.connectionState=tn.CLOSED}),this.websocket.on(Ye.FAILED,()=>{this._disconnectedReason=Ft.NETWORK_ERROR,this.connectionState=tn.CLOSED}),this.websocket.on(Ye.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===tn.CONNECTED?this.connectionState=tn.RECONNECTING:this.connectionState=tn.CONNECTING}),this.websocket.on(Ye.WILL_RECONNECT,(e,n,r)=>{const i=_v(this,qe.IS_P2P_DISCONNECTED),s=i||e!=="retry";i&&e==="retry"&&(S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=Y0.P2P_DISCONNECTED),s&&(S.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(qe.REPORT_JOIN_GATEWAY,n||Y0.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(qe.DISCONNECT_P2P)),r(e)}),this.websocket.on(Ye.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",_i.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(qe.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof te){if(e.code===P.UNEXPECTED_RESPONSE&&e.data.code===Ve.ERR_NO_AUTHORIZED)return this.initError=new te(P.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",_i.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_i.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Ye.REQUEST_NEW_URLS,(e,n)=>{vi(this,qe.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(Ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ht.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(Jee.PRE_CONNECT_PC,()=>{this.emit(qe.PRE_CONNECT_PC)})}}let sr=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function G6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function TT(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?G6(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):G6(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Vm(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(G("TURN_DOMAIN")):(S.info("Unidentified as ip: ".concat(t,", use as host")),t)}function A2(t,e){t.addresses||(t.addresses=[]);const n=function(a,A){if(G("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a.map(f=>{let{ip:p,port:g}=f;return{address:"".concat(p,":").concat(g)}});const l=G("GATEWAY_DOMAINS");let d=l[1]&&Se(A).call(A,l[1])?1:0;return a.map(f=>{let{domain_prefix:p,port:g,ip:y}=f;if(p)return{address:"".concat(p,".").concat(l[d++%l.length],":").concat(g)};const E=/^[\.\:\d]+$/.test(y),w=E?"".concat(y.replace(/[^\d]/g,"-"),".").concat(l[d++%l.length],":").concat(g):"".concat(y,":").concat(g);return E||S.info("Unidentified as ip: ".concat(y,", use as host")),{ip:y,port:g,address:w}})}(t.addresses,e),r=Array.isArray(t.detail)&&t.detail[18];if(r&&typeof r=="string"){const a=r.split(";");for(let A=0;A<a.length;A++){var i;const l=as(i=a[A]).call(i);n[A]&&l&&(n[A].ip6=l)}}const s=t.detail&&t.detail.candidate;let o;if(s){const[a,A]=s.split(":");a&&A&&(o={port:Number(A),ip:a,address:"".concat(a,":").concat(A)})}return{gatewayAddrs:n,apGatewayAddress:o,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function Oo(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function W6(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(Oo(e.width),"x").concat(Oo(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function z6(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function wv(t,e){let n,r,i;switch(e){case sr.CHOOSE_SERVER:r=4096,i="choose server";break;case sr.CLOUD_PROXY:r=1048576,i="proxy";break;case sr.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case sr.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new te(P.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(s=>{s.buffer&&s.buffer.flag===r&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(o=>TT(TT({},o),{},{ticket:s.buffer.cert})),server_ts:t.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:TT(TT({},s.buffer.detail),t.detail),flag:s.buffer.flag,opid:t.opid,cert:s.buffer.cert})}),!n)throw new te(P.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function Zee(t,e){return await we.all(t.addresses.map(async n=>({address:Vm(n.ip),tcpport:n.port,udpport:n.port,username:e&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():mi.username,password:e&&G("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await TP(e.toString()):mi.password})))}function NP(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),r=e.videoHeight||n.height,i=e.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(Oo(t.height),Oo(t.width)),1):(S.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Id(t){let{candidateType:e,relayProtocol:n,type:r,address:i,port:s,protocol:o}=t;return r==="local-candidate"?{candidateType:e,relayProtocol:n,protocol:o}:{candidateType:e,relayProtocol:n,address:i,port:s,protocol:o}}var Ya,vBe=Zn(qee),wBe=Cc("Array").values,CBe=ll,TBe=Mi,SBe=Bs,bBe=wBe,vB=Array.prototype,IBe={DOMTokenList:!0,NodeList:!0},RBe=function(t){var e=t.values;return t===vB||SBe(vB,t)&&e===vB.values||TBe(IBe,CBe(t))?bBe:e},au=Zn(RBe),q6=Ba,OBe=mr,NBe=Si,DBe=Sr,wB=kI,BBe=hw,LBe=RI,PBe=Al,UBe=OI,Jp=Object.assign,Y6=Object.defineProperty,kBe=OBe([].concat),xBe=!Jp||DBe(function(){if(q6&&Jp({b:1},Jp(Y6({},"a",{enumerable:!0,get:function(){Y6(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(i){e[i]=i}),Jp({},t)[n]!=7||wB(Jp({},e)).join("")!=r})?function(t,e){for(var n=PBe(t),r=arguments.length,i=1,s=BBe.f,o=LBe.f;r>i;)for(var a,A=UBe(arguments[i++]),l=s?kBe(wB(A),s(A)):wB(A),d=l.length,f=0;d>f;)a=l[f++],q6&&!NBe(o,A,a)||(n[a]=A[a]);return n}:Jp,MBe=ho,FBe=d$,VBe=lh,QBe=Si,HBe=Al,jBe=function(t,e,n,r){try{return r?e(MBe(n)[0],n[1]):e(n)}catch(i){FBe(t,"throw",i)}},KBe=u$,GBe=FI,WBe=wu,X6=HI,zBe=Rx,qBe=xI,J6=Array,ep=mr,CB=2147483647,YBe=/[^\0-\u007E]/,ete=/[.\u3002\uFF0E\uFF61]/g,$6="Overflow: input needs wider integers to process",Z6=RangeError,XBe=ep(ete.exec),Qm=Math.floor,TB=String.fromCharCode,eK=ep("".charCodeAt),tte=ep([].join),od=ep([].push),JBe=ep("".replace),$Be=ep("".split),ZBe=ep("".toLowerCase),tK=function(t){return t+22+75*(t<26)},e1e=function(t,e,n){var r=0;for(t=n?Qm(t/700):t>>1,t+=Qm(t/e);t>455;)t=Qm(t/35),r+=36;return Qm(r+36*t/(t+38))},t1e=function(t){var e=[];t=function(b){for(var I=[],B=0,U=b.length;B<U;){var H=eK(b,B++);if(H>=55296&&H<=56319&&B<U){var K=eK(b,B++);(64512&K)==56320?od(I,((1023&H)<<10)+(1023&K)+65536):(od(I,H),B--)}else od(I,H)}return I}(t);var n,r,i=t.length,s=128,o=0,a=72;for(n=0;n<t.length;n++)(r=t[n])<128&&od(e,TB(r));var A=e.length,l=A;for(A&&od(e,"-");l<i;){var d=CB;for(n=0;n<t.length;n++)(r=t[n])>=s&&r<d&&(d=r);var f=l+1;if(d-s>Qm((CB-o)/f))throw Z6($6);for(o+=(d-s)*f,s=d,n=0;n<t.length;n++){if((r=t[n])<s&&++o>CB)throw Z6($6);if(r==s){for(var p=o,g=36;;){var y=g<=a?1:g>=a+26?26:g-a;if(p<y)break;var E=p-y,w=36-y;od(e,TB(tK(y+E%w))),p=Qm(E/w),g+=36}od(e,TB(tK(p))),a=e1e(o,f,l==A),o=0,l++}}o++,s++}return tte(e,"")},n1e=sn,l2=Ba,r1e=Yx,u2=Ci,nK=lh,Tc=mr,ST=dh,Xa=MI,i1e=Dx,DP=Mi,d2=xBe,$p=function(t){var e=HBe(t),n=GBe(this),r=arguments.length,i=r>1?arguments[1]:void 0,s=i!==void 0;s&&(i=VBe(i,r>2?arguments[2]:void 0));var o,a,A,l,d,f,p=qBe(e),g=0;if(!p||this===J6&&KBe(p))for(o=WBe(e),a=n?new this(o):J6(o);o>g;g++)f=s?i(e[g],g):e[g],X6(a,g,f);else for(d=(l=zBe(e,p)).next,a=n?new this:[];!(A=QBe(d,l)).done;g++)f=s?jBe(l,i,[A.value,g],!0):A.value,X6(a,g,f);return a.length=g,a},Uc=Vx,s1e=Fx.codeAt,o1e=function(t){var e,n,r=[],i=$Be(JBe(ZBe(t),ete,"."),".");for(e=0;e<i.length;e++)n=i[e],od(r,XBe(YBe,n)?"xn--"+t1e(n):n);return tte(r,".")},Gl=La,a1e=hh,c1e=VI,nte=bNe,rte=Zf,A1e=rte.set,mb=rte.getterFor("URL"),l1e=nte.URLSearchParams,u1e=nte.getState,NE=u2.URL,BP=u2.TypeError,bT=u2.parseInt,d1e=Math.floor,rK=Math.pow,ic=Tc("".charAt),Fc=Tc(/./.exec),JE=Tc([].join),h1e=Tc(1 .toString),f1e=Tc([].pop),Zp=Tc([].push),SB=Tc("".replace),p1e=Tc([].shift),m1e=Tc("".split),$E=Tc("".slice),X0=Tc("".toLowerCase),g1e=Tc([].unshift),bB="Invalid scheme",Wh="Invalid host",iK="Invalid port",ite=/[a-z]/i,_1e=/[\d+-.a-z]/i,IB=/\d/,E1e=/^0x/i,y1e=/^[0-7]+$/,v1e=/^\d+$/,sK=/^[\da-f]+$/i,w1e=/[\0\t\n\r #%/:<>?@[\\\]^|]/,C1e=/[\0\t\n\r #/:<>?@[\\\]^|]/,T1e=/^[\u0000-\u0020]+/,S1e=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,b1e=/[\t\n\r]/g,DE=function(t){var e,n,r,i;if(typeof t=="number"){for(e=[],n=0;n<4;n++)g1e(e,t%256),t=d1e(t/256);return JE(e,".")}if(typeof t=="object"){for(e="",r=function(s){for(var o=null,a=1,A=null,l=0,d=0;d<8;d++)s[d]!==0?(l>a&&(o=A,a=l),A=null,l=0):(A===null&&(A=d),++l);return l>a&&(o=A,a=l),o}(t),n=0;n<8;n++)i&&t[n]===0||(i&&(i=!1),r===n?(e+=n?":":"::",i=!0):(e+=h1e(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},J0={},ste=d2({},J0,{" ":1,'"':1,"<":1,">":1,"`":1}),ote=d2({},ste,{"#":1,"?":1,"{":1,"}":1}),RB=d2({},ote,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Zu=function(t,e){var n=s1e(t,0);return n>32&&n<127&&!DP(e,t)?t:encodeURIComponent(t)},IT={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ZE=function(t,e){var n;return t.length==2&&Fc(ite,ic(t,0))&&((n=ic(t,1))==":"||!e&&n=="|")},oK=function(t){var e;return t.length>1&&ZE($E(t,0,2))&&(t.length==2||(e=ic(t,2))==="/"||e==="\\"||e==="?"||e==="#")},I1e=function(t){return t==="."||X0(t)==="%2e"},OB={},aK={},NB={},cK={},AK={},DB={},lK={},uK={},RT={},OT={},BB={},LB={},PB={},UB={},dK={},kB={},em={},bA={},hK={},zh={},xl={},h2=function(t,e,n){var r,i,s,o=Gl(t);if(e){if(i=this.parse(o))throw BP(i);this.searchParams=null}else{if(n!==void 0&&(r=new h2(n,!0)),i=this.parse(o,null,r))throw BP(i);(s=u1e(new l1e)).bindURL(this),this.searchParams=s}};h2.prototype={type:"URL",parse:function(t,e,n){var r,i,s,o,a,A=this,l=e||OB,d=0,f="",p=!1,g=!1,y=!1;for(t=Gl(t),e||(A.scheme="",A.username="",A.password="",A.host=null,A.port=null,A.path=[],A.query=null,A.fragment=null,A.cannotBeABaseURL=!1,t=SB(t,T1e,""),t=SB(t,S1e,"$1")),t=SB(t,b1e,""),r=$p(t);d<=r.length;){switch(i=r[d],l){case OB:if(!i||!Fc(ite,i)){if(e)return bB;l=NB;continue}f+=X0(i),l=aK;break;case aK:if(i&&(Fc(_1e,i)||i=="+"||i=="-"||i=="."))f+=X0(i);else{if(i!=":"){if(e)return bB;f="",l=NB,d=0;continue}if(e&&(A.isSpecial()!=DP(IT,f)||f=="file"&&(A.includesCredentials()||A.port!==null)||A.scheme=="file"&&!A.host))return;if(A.scheme=f,e)return void(A.isSpecial()&&IT[A.scheme]==A.port&&(A.port=null));f="",A.scheme=="file"?l=UB:A.isSpecial()&&n&&n.scheme==A.scheme?l=cK:A.isSpecial()?l=uK:r[d+1]=="/"?(l=AK,d++):(A.cannotBeABaseURL=!0,Zp(A.path,""),l=hK)}break;case NB:if(!n||n.cannotBeABaseURL&&i!="#")return bB;if(n.cannotBeABaseURL&&i=="#"){A.scheme=n.scheme,A.path=Uc(n.path),A.query=n.query,A.fragment="",A.cannotBeABaseURL=!0,l=xl;break}l=n.scheme=="file"?UB:DB;continue;case cK:if(i!="/"||r[d+1]!="/"){l=DB;continue}l=RT,d++;break;case AK:if(i=="/"){l=OT;break}l=bA;continue;case DB:if(A.scheme=n.scheme,i==Ya)A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=Uc(n.path),A.query=n.query;else if(i=="/"||i=="\\"&&A.isSpecial())l=lK;else if(i=="?")A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=Uc(n.path),A.query="",l=zh;else{if(i!="#"){A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=Uc(n.path),A.path.length--,l=bA;continue}A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=Uc(n.path),A.query=n.query,A.fragment="",l=xl}break;case lK:if(!A.isSpecial()||i!="/"&&i!="\\"){if(i!="/"){A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,l=bA;continue}l=OT}else l=RT;break;case uK:if(l=RT,i!="/"||ic(f,d+1)!="/")continue;d++;break;case RT:if(i!="/"&&i!="\\"){l=OT;continue}break;case OT:if(i=="@"){p&&(f="%40"+f),p=!0,s=$p(f);for(var E=0;E<s.length;E++){var w=s[E];if(w!=":"||y){var b=Zu(w,RB);y?A.password+=b:A.username+=b}else y=!0}f=""}else if(i==Ya||i=="/"||i=="?"||i=="#"||i=="\\"&&A.isSpecial()){if(p&&f=="")return"Invalid authority";d-=$p(f).length+1,f="",l=BB}else f+=i;break;case BB:case LB:if(e&&A.scheme=="file"){l=kB;continue}if(i!=":"||g){if(i==Ya||i=="/"||i=="?"||i=="#"||i=="\\"&&A.isSpecial()){if(A.isSpecial()&&f=="")return Wh;if(e&&f==""&&(A.includesCredentials()||A.port!==null))return;if(o=A.parseHost(f))return o;if(f="",l=em,e)return;continue}i=="["?g=!0:i=="]"&&(g=!1),f+=i}else{if(f=="")return Wh;if(o=A.parseHost(f))return o;if(f="",l=PB,e==LB)return}break;case PB:if(!Fc(IB,i)){if(i==Ya||i=="/"||i=="?"||i=="#"||i=="\\"&&A.isSpecial()||e){if(f!=""){var I=bT(f,10);if(I>65535)return iK;A.port=A.isSpecial()&&I===IT[A.scheme]?null:I,f=""}if(e)return;l=em;continue}return iK}f+=i;break;case UB:if(A.scheme="file",i=="/"||i=="\\")l=dK;else{if(!n||n.scheme!="file"){l=bA;continue}if(i==Ya)A.host=n.host,A.path=Uc(n.path),A.query=n.query;else if(i=="?")A.host=n.host,A.path=Uc(n.path),A.query="",l=zh;else{if(i!="#"){oK(JE(Uc(r,d),""))||(A.host=n.host,A.path=Uc(n.path),A.shortenPath()),l=bA;continue}A.host=n.host,A.path=Uc(n.path),A.query=n.query,A.fragment="",l=xl}}break;case dK:if(i=="/"||i=="\\"){l=kB;break}n&&n.scheme=="file"&&!oK(JE(Uc(r,d),""))&&(ZE(n.path[0],!0)?Zp(A.path,n.path[0]):A.host=n.host),l=bA;continue;case kB:if(i==Ya||i=="/"||i=="\\"||i=="?"||i=="#"){if(!e&&ZE(f))l=bA;else if(f==""){if(A.host="",e)return;l=em}else{if(o=A.parseHost(f))return o;if(A.host=="localhost"&&(A.host=""),e)return;f="",l=em}continue}f+=i;break;case em:if(A.isSpecial()){if(l=bA,i!="/"&&i!="\\")continue}else if(e||i!="?")if(e||i!="#"){if(i!=Ya&&(l=bA,i!="/"))continue}else A.fragment="",l=xl;else A.query="",l=zh;break;case bA:if(i==Ya||i=="/"||i=="\\"&&A.isSpecial()||!e&&(i=="?"||i=="#")){if((a=X0(a=f))===".."||a==="%2e."||a===".%2e"||a==="%2e%2e"?(A.shortenPath(),i=="/"||i=="\\"&&A.isSpecial()||Zp(A.path,"")):I1e(f)?i=="/"||i=="\\"&&A.isSpecial()||Zp(A.path,""):(A.scheme=="file"&&!A.path.length&&ZE(f)&&(A.host&&(A.host=""),f=ic(f,0)+":"),Zp(A.path,f)),f="",A.scheme=="file"&&(i==Ya||i=="?"||i=="#"))for(;A.path.length>1&&A.path[0]==="";)p1e(A.path);i=="?"?(A.query="",l=zh):i=="#"&&(A.fragment="",l=xl)}else f+=Zu(i,ote);break;case hK:i=="?"?(A.query="",l=zh):i=="#"?(A.fragment="",l=xl):i!=Ya&&(A.path[0]+=Zu(i,J0));break;case zh:e||i!="#"?i!=Ya&&(i=="'"&&A.isSpecial()?A.query+="%27":A.query+=i=="#"?"%23":Zu(i,J0)):(A.fragment="",l=xl);break;case xl:i!=Ya&&(A.fragment+=Zu(i,ste))}d++}},parseHost:function(t){var e,n,r;if(ic(t,0)=="["){if(ic(t,t.length-1)!="]"||(e=function(i){var s,o,a,A,l,d,f,p=[0,0,0,0,0,0,0,0],g=0,y=null,E=0,w=function(){return ic(i,E)};if(w()==":"){if(ic(i,1)!=":")return;E+=2,y=++g}for(;w();){if(g==8)return;if(w()!=":"){for(s=o=0;o<4&&Fc(sK,w());)s=16*s+bT(w(),16),E++,o++;if(w()=="."){if(o==0||(E-=o,g>6))return;for(a=0;w();){if(A=null,a>0){if(!(w()=="."&&a<4))return;E++}if(!Fc(IB,w()))return;for(;Fc(IB,w());){if(l=bT(w(),10),A===null)A=l;else{if(A==0)return;A=10*A+l}if(A>255)return;E++}p[g]=256*p[g]+A,++a!=2&&a!=4||g++}if(a!=4)return;break}if(w()==":"){if(E++,!w())return}else if(w())return;p[g++]=s}else{if(y!==null)return;E++,y=++g}}if(y!==null)for(d=g-y,g=7;g!=0&&d>0;)f=p[g],p[g--]=p[y+d-1],p[y+--d]=f;else if(g!=8)return;return p}($E(t,1,-1)),!e))return Wh;this.host=e}else if(this.isSpecial()){if(t=o1e(t),Fc(w1e,t)||(e=function(i){var s,o,a,A,l,d,f,p=m1e(i,".");if(p.length&&p[p.length-1]==""&&p.length--,(s=p.length)>4)return i;for(o=[],a=0;a<s;a++){if((A=p[a])=="")return i;if(l=10,A.length>1&&ic(A,0)=="0"&&(l=Fc(E1e,A)?16:8,A=$E(A,l==8?1:2)),A==="")d=0;else{if(!Fc(l==10?v1e:l==8?y1e:sK,A))return i;d=bT(A,l)}Zp(o,d)}for(a=0;a<s;a++)if(d=o[a],a==s-1){if(d>=rK(256,5-s))return null}else if(d>255)return null;for(f=f1e(o),a=0;a<o.length;a++)f+=o[a]*rK(256,3-a);return f}(t),e===null))return Wh;this.host=e}else{if(Fc(C1e,t))return Wh;for(e="",n=$p(t),r=0;r<n.length;r++)e+=Zu(n[r],J0);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return DP(IT,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme=="file"&&e==1&&ZE(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,r=t.password,i=t.host,s=t.port,o=t.path,a=t.query,A=t.fragment,l=e+":";return i!==null?(l+="//",t.includesCredentials()&&(l+=n+(r?":"+r:"")+"@"),l+=DE(i),s!==null&&(l+=":"+s)):e=="file"&&(l+="//"),l+=t.cannotBeABaseURL?o[0]:o.length?"/"+JE(o,"/"):"",a!==null&&(l+="?"+a),A!==null&&(l+="#"+A),l},setHref:function(t){var e=this.parse(t);if(e)throw BP(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t=="blob")try{return new Ug(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+DE(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Gl(t)+":",OB)},getUsername:function(){return this.username},setUsername:function(t){var e=$p(Gl(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=Zu(e[n],RB)}},getPassword:function(){return this.password},setPassword:function(t){var e=$p(Gl(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=Zu(e[n],RB)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?DE(t):DE(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,BB)},getHostname:function(){var t=this.host;return t===null?"":DE(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,LB)},getPort:function(){var t=this.port;return t===null?"":Gl(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Gl(t))==""?this.port=null:this.parse(t,PB))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+JE(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,em))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Gl(t))==""?this.query=null:(ic(t,0)=="?"&&(t=$E(t,1)),this.query="",this.parse(t,zh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Gl(t))!=""?(ic(t,0)=="#"&&(t=$E(t,1)),this.fragment="",this.parse(t,xl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ug=function(t){var e=i1e(this,wo),n=c1e(arguments.length,1)>1?arguments[1]:void 0,r=A1e(e,new h2(t,!1,n));l2||(e.href=r.serialize(),e.origin=r.getOrigin(),e.protocol=r.getProtocol(),e.username=r.getUsername(),e.password=r.getPassword(),e.host=r.getHost(),e.hostname=r.getHostname(),e.port=r.getPort(),e.pathname=r.getPathname(),e.search=r.getSearch(),e.searchParams=r.getSearchParams(),e.hash=r.getHash())},wo=Ug.prototype,Ja=function(t,e){return{get:function(){return mb(this)[t]()},set:e&&function(n){return mb(this)[e](n)},configurable:!0,enumerable:!0}};if(l2&&(Xa(wo,"href",Ja("serialize","setHref")),Xa(wo,"origin",Ja("getOrigin")),Xa(wo,"protocol",Ja("getProtocol","setProtocol")),Xa(wo,"username",Ja("getUsername","setUsername")),Xa(wo,"password",Ja("getPassword","setPassword")),Xa(wo,"host",Ja("getHost","setHost")),Xa(wo,"hostname",Ja("getHostname","setHostname")),Xa(wo,"port",Ja("getPort","setPort")),Xa(wo,"pathname",Ja("getPathname","setPathname")),Xa(wo,"search",Ja("getSearch","setSearch")),Xa(wo,"searchParams",Ja("getSearchParams")),Xa(wo,"hash",Ja("getHash","setHash"))),ST(wo,"toJSON",function(){return mb(this).serialize()},{enumerable:!0}),ST(wo,"toString",function(){return mb(this).serialize()},{enumerable:!0}),NE){var fK=NE.createObjectURL,pK=NE.revokeObjectURL;fK&&ST(Ug,"createObjectURL",nK(fK,NE)),pK&&ST(Ug,"revokeObjectURL",nK(pK,NE))}a1e(Ug,"URL"),n1e({global:!0,forced:!r1e,sham:!l2},{URL:Ug});var R1e=sn,O1e=Sr,N1e=VI,mK=La,D1e=Yx,gK=Do("URL");R1e({target:"URL",stat:!0,forced:!(D1e&&O1e(function(){gK.canParse()}))},{canParse:function(t){var e=N1e(arguments.length,1),n=mK(t),r=e<2||arguments[1]===void 0?void 0:mK(arguments[1]);try{return!!new gK(n,r)}catch{return!1}}});var _K=Zn(tA.URL);const Xr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function bt(){return Xr}function ate(){return"setSinkId"in HTMLAudioElement.prototype&&(!G("RESTRICTION_SET_PLAYBACK_DEVICE")||(Fd()||Nee())&&!n2())}function EK(){return!Xr.supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&rh()}let ni=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function tm(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function yt(t,e,n,r,i){return{width:t,height:e,frameRate:n,bitrateMin:r,bitrateMax:i}}function $a(t,e,n,r,i){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:r,bitrateMax:i}}function xB(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const B1e={"90p":yt(160,90),"90p_1":yt(160,90),"120p":yt(160,120,15,30,65),"120p_1":yt(160,120,15,30,65),"120p_3":yt(120,120,15,30,50),"120p_4":yt(212,120),"180p":yt(320,180,15,30,140),"180p_1":yt(320,180,15,30,140),"180p_3":yt(180,180,15,30,100),"180p_4":yt(240,180,15,30,120),"240p":yt(320,240,15,40,200),"240p_1":yt(320,240,15,40,200),"240p_3":yt(240,240,15,40,140),"240p_4":yt(424,240,15,40,220),"360p":yt(640,360,15,80,400),"360p_1":yt(640,360,15,80,400),"360p_3":yt(360,360,15,80,260),"360p_4":yt(640,360,30,80,600),"360p_6":yt(360,360,30,80,400),"360p_7":yt(480,360,15,80,320),"360p_8":yt(480,360,30,80,490),"360p_9":yt(640,360,15,80,800),"360p_10":yt(640,360,24,80,800),"360p_11":yt(640,360,24,80,1e3),"480p":yt(640,480,15,100,500),"480p_1":yt(640,480,15,100,500),"480p_2":yt(640,480,30,100,1e3),"480p_3":yt(480,480,15,100,400),"480p_4":yt(640,480,30,100,750),"480p_6":yt(480,480,30,100,600),"480p_8":yt(848,480,15,100,610),"480p_9":yt(848,480,30,100,930),"480p_10":yt(640,480,10,100,400),"720p":yt(1280,720,15,120,1130),"720p_auto":yt(1280,720,30,900,3e3),"720p_1":yt(1280,720,15,120,1130),"720p_2":yt(1280,720,30,120,2e3),"720p_3":yt(1280,720,30,120,1710),"720p_5":yt(960,720,15,120,910),"720p_6":yt(960,720,30,120,1380),"1080p":yt(1920,1080,15,120,2080),"1080p_1":yt(1920,1080,15,120,2080),"1080p_2":yt(1920,1080,30,120,3e3),"1080p_3":yt(1920,1080,30,120,3150),"1080p_5":yt(1920,1080,60,120,4780),"1440p":yt(2560,1440,30,120,4850),"1440p_1":yt(2560,1440,30,120,4850),"1440p_2":yt(2560,1440,60,120,7350),"4k":yt(3840,2160,30,120,8910),"4k_1":yt(3840,2160,30,120,8910),"4k_3":yt(3840,2160,60,120,13500)},L1e={"480p":$a(640,480,5),"480p_1":$a(640,480,5),"480p_2":$a(640,480,30),"480p_3":$a(640,480,15),"720p":$a(1280,720,5),"720p_auto":yt(1280,720,30,900,3e3),"720p_1":$a(1280,720,5),"720p_2":$a(1280,720,30),"720p_3":$a(1280,720,15),"1080p":$a(1920,1080,5),"1080p_1":$a(1920,1080,5),"1080p_2":$a(1920,1080,30),"1080p_3":$a(1920,1080,15)},P1e={"1SL1TL":xB(1,1),"3SL3TL":xB(3,3),"2SL3TL":xB(2,3)};function zA(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},B1e[t]):t}function MB(t){return typeof t=="string"?Object.assign({},L1e[t]):t}function NT(t){return typeof t=="string"?Object.assign({},P1e[t]):t}const U1e={speech_low_quality:tm(16e3,!1),speech_standard:tm(32e3,!1,18),music_standard:tm(48e3,!1),standard_stereo:tm(48e3,!0,56),high_quality:tm(48e3,!1,128),high_quality_stereo:tm(48e3,!0,192)};function gb(t){return typeof t=="string"?Object.assign({},U1e[t]):t}const bm=[];function yK(t){return Or(t,"mediaSource",["screen","window","application"]),!0}let be=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),En=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t}({}),kg=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),k1e=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),x1e=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t}({}),If=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),p_=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),ng=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),m_=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),Yo=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const LP={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},PP={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},cte={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},M1e={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Ate={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Rs=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Zo=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),BE=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),gf=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),os=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),IA=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const FB={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let $0=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function vt(t,e,n,r,i){var s,o,a={};return Object.keys(r).forEach(function(A){a[A]=r[A]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=Zc(s=vBe(o=n.slice()).call(o)).call(s,function(A,l){return l(t,e,A)||A},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(t,e,a),a=null),a}function se(t,e,n){return(e=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var A=a.call(s,"string");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function vK(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function wn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?vK(Object(n),!0).forEach(function(r){se(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vK(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class lte extends Ln{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(If.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),se(this,"trackMediaType",void 0),se(this,"_ID",void 0),se(this,"_rtpTransceiver",void 0),se(this,"_lowRtpTransceiver",void 0),se(this,"_hints",[]),se(this,"_isClosed",!1),se(this,"_originMediaStreamTrack",void 0),se(this,"mediaStreamTrack",void 0),se(this,"_external",{}),this._ID=n||nn(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(r){Se(bm).call(bm,r)||bm.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||ih(()=>{var n;Le.reportApiInvoke(null,{name:Cr.GET_MEDIA_STREAM_TRACK,options:[],tag:xn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===kg.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=bm.indexOf(e);n!==-1&&bm.splice(n,1)}(this),this.emit(p_.CLOSED),this.removeAllListeners(If.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===kg.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(If.TRANSCEIVER_UPDATED,e,n)}}class Hm extends lte{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),se(this,"_enabled",!0),se(this,"_muted",!1),se(this,"_isExternalTrack",!1),se(this,"_isClosed",!1),se(this,"_enabledMutex",void 0),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new xi("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(be.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,be.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(p_.TRACK_ENDED)}stateCheck(e,n){if(S.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),Jl(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new ie(P.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",S);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new ie(P.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",S)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():we.resolve([])}}const wK=window.AudioContext||window.webkitAudioContext;let Vo=null;const jt=new class extends Ln{constructor(){super(...arguments),se(this,"prevState",void 0),se(this,"curState",void 0),se(this,"currentTime",void 0),se(this,"currentTimeStuckAt",void 0),se(this,"interruptDetectorTrack",void 0),se(this,"onLocalAudioTrackMute",()=>{S.info("ios15-interruption-start"),this.emit(ni.IOS_15_16_INTERRUPTION_START)}),se(this,"onLocalAudioTrackUnmute",async()=>{S.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?S.info("ios15-interruption-end-canceled"):(Vo&&await Vo.suspend(),this.emit(ni.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){S.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){S.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function g_(){if(!Vo){if(function(){if(!wK)return void S.error("your browser is not support web audio");S.info("create audio context");const t=wn({},G("WEBAUDIO_INIT_OPTIONS"));S.debug("audio context init option:",JSON.stringify(t)),Vo=new wK(t),jt.curState=Vo.state,Vo.onstatechange=()=>{jt.prevState=jt.curState,jt.curState=Vo?Vo.state:void 0;const{prevState:e,curState:n}=jt,r=n==="running",i=n==="interrupted",s=e==="running",o=e==="suspended",a=e==="interrupted",A=Ct().osVersion;(Is()||gc())&&s&&i&&(S.info("ios".concat(A,"-interruption-start")),jt.emit(ni.IOS_INTERRUPTION_START)),(Is()||gc())&&(o||a)&&r&&(S.info("ios".concat(A,"-interruption-end")),jt.emit(ni.IOS_INTERRUPTION_END)),e!==n&&jt.emit(ni.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=Vo)===null||e===void 0?void 0:e.currentTime;jt.currentTime!==n?(jt.currentTimeStuckAt&&(S.debug("AudioContext current time resume at ".concat(n)),jt.currentTimeStuckAt=void 0),jt.currentTime=n):(n!==jt.currentTimeStuckAt&&(Le.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:xn.TRACER}).onSuccess(),S.warning("AudioContext current time stuck at ".concat(n))),jt.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,s=!1,o=!1;function a(E){e.state==="running"?A(!1):Is()||gc()?e.state==="suspended"&&(A(!0),E&&e.resume().then(l,l)):e.state!=="closed"&&(A(!0),E&&e.resume().then(l,l))}function A(E){if(i!==E){i=E;for(let w=0,b=n;w<b.length;w+=1){const I=b[w];E?window.addEventListener(I,d,{capture:!0,passive:!0}):window.removeEventListener(I,d,{capture:!0,passive:!0})}}}function l(){a(!1)}function d(){a(!0)}function f(E){if(!o)if(r.paused)if(E){let w;p(!1),o=!0;try{w=r.play(),w?w.then(g,g):(r.addEventListener("playing",g),r.addEventListener("abort",g),r.addEventListener("error",g))}catch{g()}}else p(!0);else p(!1)}function p(E){if(s!==E){s=E;for(let w=0,b=n;w<b.length;w++){const I=b[w];E?window.addEventListener(I,y,{capture:!0,passive:!0}):window.removeEventListener(I,y,{capture:!0,passive:!0})}}}function g(){r.removeEventListener("playing",g),r.removeEventListener("abort",g),r.removeEventListener("error",g),o=!1,f(!1)}function y(){f(!0)}if(Is()){const E=e.createMediaStreamDestination(),w=document.createElement("div");w.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=w.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=E.stream,f(!0)}jt.on(ni.STATE_CHANGE,function(){a(!0)}),a(!1)}(Vo)}(),!Vo)throw new ie(P.NOT_SUPPORTED,"can not create audio context");return Vo}return Vo}function tf(t){if(function(){if(VB!==null)return VB;const r=g_(),i=r.createBufferSource(),s=r.createGain(),o=r.createGain();i.connect(s),i.connect(o),i.disconnect(s);let a=!1;try{i.disconnect(s)}catch{a=!0}return i.disconnect(),VB=a,a}())return;const e=t.connect,n=t.disconnect;t.connect=(r,i,s)=>{var o;return t._inputNodes||(t._inputNodes=[]),Se(o=t._inputNodes).call(o,r)||(r instanceof AudioNode?(t._inputNodes.push(r),e.call(t,r,i,s)):e.call(t,r,i)),t},t.disconnect=(r,i,s)=>{n.call(t),r?pb(t._inputNodes,r):t._inputNodes=[];for(const o of t._inputNodes)e.call(t,o)}}let VB=null;function f2(t,e){let n=!1;const r=1/e;if(G("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{n?window.clearInterval(i):t(performance.now()/1e3)},1e3*r)}else{const i=g_();let s=i.createGain();s.gain.value=0,s.connect(i.destination);const o=()=>{if(n)return void(s=null);const a=i.createOscillator();a.onended=o,a.connect(s),a.start(0),a.stop(i.currentTime+r),t(i.currentTime)};o()}return()=>{n=!0}}class ute{constructor(){se(this,"context",void 0),se(this,"analyserNode",void 0),se(this,"sourceNode",void 0),this.context=g_(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Is()||gc()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<e.length;++i)e[i]=r[i]/128-1}const n=Zc(e).call(e,(r,i)=>r+i*i,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{S.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class dte extends Ln{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),se(this,"outputNode",void 0),se(this,"outputTrack",void 0),se(this,"isPlayed",!1),se(this,"sourceNode",void 0),se(this,"context",void 0),se(this,"audioBufferNode",void 0),se(this,"destNode",void 0),se(this,"audioOutputLevel",0),se(this,"volumeLevelAnalyser",void 0),se(this,"_processedNode",void 0),se(this,"playNode",void 0),se(this,"isDestroyed",!1),se(this,"onNoAudioInput",void 0),se(this,"isNoAudioInput",!1),se(this,"_noAudioInputCount",0),this.context=g_(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),tf(this.outputNode),this.volumeLevelAnalyser=new ute}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(Yo.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const s=r.outputBuffer.getChannelData(i);for(let o=0;o<s.length;o+=1)s[o]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!bt().webAudioMediaStreamDest)throw new ie(P.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&YI(()=>{jt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Is()||gc()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await ai(200),await this.checkHasAudioInput(e?e+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class hte extends dte{get isFreeze(){return!1}constructor(e,n,r){var i;if(super(),se(this,"sourceNode",void 0),se(this,"track",void 0),se(this,"clonedTrack",void 0),se(this,"audioElement",void 0),se(this,"isCurrentTrackCloned",!1),se(this,"isRemoteTrack",!1),se(this,"originVolumeLevelAnalyser",void 0),se(this,"rebuildWebAudio",async()=>{if(S.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void S.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>S.info("resume success")),S.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const a=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?a.stop():this.isCurrentTrackCloned=!0;const A=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(A),tf(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const l=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(l,this.context.currentTime),tf(this.outputNode),this.emit(Yo.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=A,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new ie(P.UNEXPECTED_ERROR);this.track=e;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),tf(this.sourceNode),r){const a=r.clone();a.enabled=!0,this.clonedTrack=a,S.debug("create an unmuted track ".concat(a.id," from the original track ").concat(r.id," to get the volume"));const A=this.context.createMediaStreamSource(new MediaStream([a]));tf(A),this.originVolumeLevelAnalyser=new ute,this.originVolumeLevelAnalyser.updateSource(A)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const o=Ct();n&&o.os===Pr.IOS&&Number((i=o.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(jt.on(ni.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(a=>{a||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),tf(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Yo.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),jt.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),S.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));tf(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function fte(t,e,n){const r=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:r(e.height,1080),maxWidth:r(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(i.video.mandatory.maxFrameRate=e.frameRate.max,i.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(i.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function F1e(t,e){const n=await pte(t.mediaSource),{sourceId:r,audio:i}=await function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new we((a,A)=>{const l=document.createElement("div");l.innerText="share screen",l.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const d=document.createElement("div");d.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const f=document.createElement("div");f.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",f.setAttribute("style","height: 12%;");const p=document.createElement("div");p.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const g=document.createElement("div");g.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const y=document.createElement("button");y.innerHTML="cancel",y.setAttribute("style","width: 85px;"),y.onclick=()=>{document.body.removeChild(b);const I=new Error("NotAllowedError");I.name="NotAllowedError",A(I)};let E=o;const w=document.createElement("div");if(o){const I=document.createElement("input");I.setAttribute("type","checkbox");const B=document.createElement("span");I.setAttribute("style","margin-right: 6px;"),B.innerText="Share audio",I.checked=E,I.onchange=()=>{E=I.checked},w.appendChild(I),w.appendChild(B)}g.appendChild(w),g.appendChild(y),d.appendChild(f),d.appendChild(p),d.appendChild(g);const b=document.createElement("div");b.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),b.appendChild(l),b.appendChild(d),document.body.appendChild(b),s.map(I=>{if(I.id){const B=document.createElement("div");B.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let U=I.thumbnail;try{const{width:H}=U.getSize();H>1920&&(U=U.resize({width:1920}))}catch(H){throw H&&H.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),H}B.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+U.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+I.name.replace(/[\u00A0-\u9999<>\&]/g,function(H){return"&#"+H.charCodeAt(0)+";"})+"</span>",B.onclick=()=>{document.body.removeChild(b),a({sourceId:I.id,audio:E})},p.appendChild(B)}})})}(n,e);return await fte(r,t,i)}async function pte(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=Fee();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new ie(P.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{r=null}r&&r.then||(r=new we((s,o)=>{n.desktopCapturer.getSources({types:e},(a,A)=>{a?o(a):s(A)})}));try{return await r}catch(s){throw new ie(P.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const UP=new xi("safari");let mte=!1,gte=!1;async function zo(t,e){let n=0,r=null;for(;n<2;)try{r=await V1e(t,e,n>0);break}catch(i){if(i instanceof ie)throw S.error("[".concat(e,"] ").concat(i.toString())),i;const s=Z0(i.name||i.code||i,i.message);if(s.code===P.MEDIA_OPTION_INVALID){S.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await ai(500);continue}throw S.error("[".concat(e,"] ").concat(s.toString())),s}if(!r)throw new ie(P.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function V1e(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ie(P.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const r=bt(),i=new MediaStream;if(t.audioSource&&i.addTrack(t.audioSource),t.videoSource&&i.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return S.debug("Using Video Source/ Audio Source"),i;if(t.screen)if(Fee())t.screen.sourceId?nm(i,await fte(t.screen.sourceId,t.screen,t.screenAudio)):nm(i,await F1e(t.screen,t.screenAudio));else if(Fd()&&t.screen.extensionId&&t.screen.mandatory){if(!r.getStreamFromExtension)throw new ie(P.NOT_SUPPORTED,"This browser does not support screen sharing");S.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const p=await(o=t.screen.extensionId,a=e,new we((g,y)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},E=>{if(!E||!E.streamId)return S.error("[".concat(a,"] No response from Chrome Plugin. Plugin not installed properly"),E),void y(new ie(P.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));g(E.streamId)})}catch(E){S.error("[".concat(a,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),E.toString()),y(new ie(P.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=p,nm(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(r.getDisplayMedia){var s;t.screen.mediaSource&&yK(t.screen.mediaSource);const p={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(s=t.screen.displaySurface)!==null&&s!==void 0?s:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:g,surfaceSwitching:y,systemAudio:E}=t.screen,w={selfBrowserSurface:g,surfaceSwitching:y,systemAudio:E};!g&&delete w.selfBrowserSurface,!y&&delete w.surfaceSwitching,!E&&delete w.systemAudio,S.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:p,audio:!!t.screenAudio,controls:w})),nm(i,await navigator.mediaDevices.getDisplayMedia(wn({video:p,audio:!!t.screenAudio},w)))}else{if(!Fn())throw S.error("[".concat(e,"] This browser does not support screenSharing")),new ie(P.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&yK(t.screen.mediaSource);const p={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};S.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(p))),nm(i,await navigator.mediaDevices.getUserMedia(p))}}var o,a;if(!t.video&&!t.audio)return i;let A={video:t.video,audio:t.audio},l=G("MEDIA_DEVICE_CONSTRAINTS");if(l)try{typeof l=="string"&&(l=JSON.parse(l)),A=SP(A,l)}catch{}S.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(A)),Ct();let d,f=null;(yi()||Is()||fb())&&(f=await UP.lock());try{d=await navigator.mediaDevices.getUserMedia(A)}catch(p){throw f&&f(),p}return A.audio&&(mte=!0),A.video&&(gte=!0),nm(i,d),f&&f(),i}function Z0(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ie(P.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new ie(P.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new ie(P.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new ie(P.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ie(P.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new ie(P.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return S.error("getUserMedia unexpected error",t),new ie(P.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function nm(t,e){const n=t.getVideoTracks()[0],r=t.getAudioTracks()[0],i=e.getVideoTracks()[0],s=e.getAudioTracks()[0];s&&(r&&t.removeTrack(r),t.addTrack(s)),i&&(n&&t.removeTrack(n),t.addTrack(i))}const Jo=new class extends Ln{get state(){return this._state}set state(t){t!==this._state&&(this.emit(gf.STATE_CHANGE,t),this._state=t)}constructor(){super(),se(this,"_state",BE.IDLE),se(this,"isAccessMicrophonePermission",!1),se(this,"isAccessCameraPermission",!1),se(this,"lastAccessMicrophonePermission",!1),se(this,"lastAccessCameraPermission",!1),se(this,"checkdeviceMatched",!1),se(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(G("ENUMERATE_DEVICES_INTERVAL")||(zI()||WI()===Pr.HARMONY_OS)&&rh())&&this.updateDevicesInfo()},G("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>S.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ie(P.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&t,o=!this.isAccessCameraPermission&&e;i.audio&&(s=!1),i.video&&(o=!1);let a=null,A=null,l=null;if(!n&&(s||o)){if(UP.isLocked&&(S.debug("[device manager] wait GUM lock"),(await UP.lock())(),S.debug("[device manager] GUM unlock")),mte&&(s=!1,this.isAccessMicrophonePermission=!0),gte&&(o=!1,this.isAccessCameraPermission=!0),S.debug("[device manager] check media device permissions",t,e,s,o),s&&o){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(d){const f=Z0(d.name||d.code||d,d.message);if(f.code===P.PERMISSION_DENIED)throw f;S.warning("getUserMedia failed in getDevices",f)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{a=await navigator.mediaDevices.getUserMedia({audio:t})}catch(d){const f=Z0(d.name||d.code||d,d.message);if(f.code===P.PERMISSION_DENIED)throw f;S.warning("getUserMedia failed in getDevices",f)}this.isAccessMicrophonePermission=!0}else if(o){try{A=await navigator.mediaDevices.getUserMedia({video:e})}catch(d){const f=Z0(d.name||d.code||d,d.message);if(f.code===P.PERMISSION_DENIED)throw f;S.warning("getUserMedia failed in getDevices",f)}this.isAccessCameraPermission=!0}S.debug("[device manager] mic permission",t,"cam permission",e)}try{const d=await navigator.mediaDevices.enumerateDevices();return a&&a.getTracks().forEach(f=>f.stop()),A&&A.getTracks().forEach(f=>f.stop()),l&&l.getTracks().forEach(f=>f.stop()),a=null,A=null,l=null,d}catch(d){return a&&a.getTracks().forEach(f=>f.stop()),A&&A.getTracks().forEach(f=>f.stop()),l&&l.getTracks().forEach(f=>f.stop()),a=null,A=null,l=null,new ie(P.ENUMERATE_DEVICES_FAILED,d.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new ie(P.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=BE.INITING;try{await this.updateDevicesInfo(),this.state=BE.INITEND}catch(t){throw S.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=BE.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ie(P.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=t.find(o=>o.kind==="audioinput"&&o.deviceId==="default"),s=t.find(o=>o.kind==="audiooutput"&&o.deviceId==="default");i&&s?s.groupId===i.groupId?S.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):S.warning("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):S.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(i=>{if(!i.deviceId)return;const s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const o={initAt:e,updateAt:e,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),o),n.push(o)}s&&(s.updateAt=e)}),this.deviceInfoMap.forEach((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==e&&(i.state="INACTIVE",n.push(i))}),this.state!==BE.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(gf.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(gf.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(gf.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(i=>i.kind==="audioinput"),n=t.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of e)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let QB=!1;const jo=new class extends Ln{constructor(){super(...arguments),se(this,"onAutoplayFailed",void 0),se(this,"onAudioAutoplayFailed",void 0)}};function _te(){if(Ct(),!QB){const t=e=>{e.preventDefault(),QB=!1,gv()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};QB=!0,gv()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),S.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),jo.onAutoplayFailed?jo.onAutoplayFailed():jo.onAudioAutoplayFailed?S.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):S.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),jo.emit("autoplay-failed")}}function Ete(t,e,n,r){if(!t)return;const i=Le.getBaseInfoBySessionId(t);if(!i)return;const s=i.info,o=Date.now(),a=wn(wn({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-i.startTime,cbRegistered:jo.onAutoplayFailed||jo.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:r,extend:void 0});Le.send({type:Dn.AUTOPLAY_FAILED,data:a},!0)}const Q1e=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ws=new class{constructor(){se(this,"onAutoplayFailed",void 0),se(this,"elementMap",new Map),se(this,"elementStateMap",new Map),se(this,"elementsNeedToResume",[]),se(this,"sinkIdMap",new Map),se(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,r]=e;const i=this.elementStateMap.get(n),s=r.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(S.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(t)),o==="live"){if(t)return r.pause(),void r.play();if(jt.curState==="running")return Bg()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}})}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(S.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),jt.on(ni.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),jt.on(ni.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),jt.on(ni.STATE_CHANGE,()=>{Is()&&jt.prevState==="suspended"&&jt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(r){throw new ie(P.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(t,e,n,r){if(this.elementMap.has(e))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,i),this.elementMap.set(e,i),this.elementStateMap.set(e,os.INIT),this.setVolume(e,n);const s=this.sinkIdMap.get(e);if(s)try{i.setSinkId(s).catch(a=>{S.warning("[".concat(e,"] set sink id failed"),a.toString())})}catch(a){S.warning("[".concat(e,"] set sink id failed"),a.toString())}const o=i.play();o&&o.then&&o.catch(a=>{r&&Ete(r,"audio",a.message,e),S.warning("audio element play warning",a.toString()),this.elementMap.has(e)&&a.name==="NotAllowedError"&&(S.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),YI(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),_te()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){Q1e.forEach(n=>{e.addEventListener(n,r=>{const i=this.elementStateMap.get(t),s=r.type==="pause"?"paused":r.type;if(S.debug("[".concat(t,"] audio-element-status change ").concat(i," => ").concat(s)),r.type==="error"){const o=e==null?void 0:e.error;o&&S.error("[".concat(t,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(t,s)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{S.debug("Auto resume audio element success")}).catch(n=>{S.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new we(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{gv()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function $n(){return function(t,e,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new ie(P.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",S);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];const a=r.apply(this,s);return a instanceof we?new we((A,l)=>{a.then(A).catch(l)}):a}),n}}class yte extends Ln{constructor(e){super(),se(this,"name","VideoProcessorDestination"),se(this,"ID","0"),se(this,"_source",void 0),se(this,"videoContext",void 0),se(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ie(P.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ie(P.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Rs.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Rs.ON_TRACK,void 0)}}class vte extends Ln{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"usageRegistry",[]),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await vi(this,Zo.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var r;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Jt(this,Zo.REQUEST_UPDATE_CONSTRAINTS,Array.from(au(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return S.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Jt(this,Zo.REQUEST_UPDATE_CONSTRAINTS,Array.from(au(n=this.constraintsMap).call(n)))}registerStats(e,n,r){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:r})}unregisterStats(e,n){const r=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();e.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){S.error(new ie(P.UNEXPECTED_ERROR,o.message))}return e}registerUsage(e,n){this.usageRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof we&&(r=await r),e.push(wn(wn({},r),{},{direction:this.direction}))}catch(r){S.error("gather extension usage error",r)}return e}getDirection(){return this.direction}}class wte extends Ln{constructor(e){super(),se(this,"name","AudioProcessorDestination"),se(this,"ID","0"),se(this,"inputTrack",void 0),se(this,"inputNode",void 0),se(this,"audioProcessorContext",void 0),se(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ie(P.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ie(P.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Rs.ON_TRACK,void 0),this.emit(Rs.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Rs.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Rs.ON_NODE,this.inputNode))}}class Cte extends Ln{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,r){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"audioContext",void 0),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"usageRegistry",[]),se(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=r}async getConstraints(){return vi(this,Zo.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var r;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Jt(this,Zo.REQUEST_UPDATE_CONSTRAINTS,Array.from(au(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Jt(this,Zo.REQUEST_UPDATE_CONSTRAINTS,Array.from(au(n=this.constraintsMap).call(n)))}registerStats(e,n,r){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:r})}unregisterStats(e,n){const r=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();e.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){S.error(new ie(P.UNEXPECTED_ERROR,o.message))}return e}registerUsage(e,n){this.usageRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof we&&(r=await r),e.push(wn(wn({},r),{},{direction:this.direction}))}catch(r){S.error("gather extension usage error",r)}return e}getDirection(){return this.direction}}class kP extends Ln{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),se(this,"context",void 0),se(this,"processSourceNode",void 0),se(this,"outputTrack",void 0),se(this,"processedNode",void 0),se(this,"clonedTrack",void 0),se(this,"outputNode",void 0),this.outputNode=new H1e}setVolume(){}createOutputTrack(){throw new ie(P.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class H1e{disconnect(){}connect(){}}function Tte(t){return new we((e,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=Is()?"canplay":"playing";i.addEventListener(s,()=>{const o=i.videoWidth,a=i.videoHeight;!o&&Fn()||(r=!0,i.srcObject=null,i.remove(),e([o,a]))}),i.srcObject=new MediaStream([t]),i.play().catch(XI),setTimeout(()=>{r||(i.srcObject=null,i.remove(),e([i.videoWidth,i.videoHeight]))},4e3)})}function _b(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=zA(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!kee()&&n.frameRate&&(e.frameRate=n.frameRate),Nee()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),Fn()&&(e.frameRate={ideal:30,max:30}),e}function CK(t){const e={};if(kee()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,Fd()&&t.ANS&&(e.googHighpassFilter=t.ANS))),t.encoderConfig){const n=gb(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),zI()&&(e.sampleRate=void 0),e}const j1e=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:r,height:i}=t.getMediaStreamTrackSettings();let{frameRate:s=n,width:o=r,height:a=i}=e;if(!s||!o||!a)return;o=lB(o),a=lB(a),s=lB(s);const{max:A,min:l}=function(g,y,E){const w=200*Math.pow(E/15,.6)*Math.pow(g*y/640/360,.75);return{min:Math.floor(w),max:Math.floor(4*w)}}(o,a,s),{bitrateMax:d,bitrateMin:f}=e||{};d||S.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(a,", fps: ").concat(s,"] => [brMax: ").concat(d,", brMin: ").concat(f,"]"));const{maxFramerate:p}=G("ENCODER_CONFIG_LIMIT");return p&&typeof p=="number"&&(s=Math.min(s,p)),{frameRate:s,bitrateMax:d||A,bitrateMin:f||l,scaleResolutionDownBy:1,scale:0}},Ste=async(t,e,n)=>await(async(r,i,s)=>{const o=function(l){const d=[];for(let f=0;f<l.length;f+=2)d.push(parseInt(l.slice(f,f+2),16));return Uint8Array.from(d)}(jee(""+i+s)).slice(0,16),a=o.slice(0,12),A=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},A,r))})(t.buffer,e,n),p2=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new we((n,r)=>{e.toBlob(async i=>{if(e.remove(),i){const s=await bte(i);n({buffer:s,width:e.width,height:e.height})}else r(new ie(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},bte=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var TK,SK,bK,IK,RK,OK,NK,DK,BK,LK,PK,UK,kK,xK,MK,FK,VK,QK,In,HK,jK,KK,GK,WK,zK,RA,qK,YK,XK,JK,$K,ZK,eG,tG,nG,rG,iG,sG,oG,di;let kn=(TK=je({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),SK=je({argsMap:(t,e)=>[t.getTrackId(),e]}),bK=$n(),IK=Lg("LocalAudioTrack","_enabledMutex"),RK=je({argsMap:(t,e)=>[t.getTrackId(),e]}),OK=$n(),NK=Lg("LocalAudioTrack","_enabledMutex"),DK=je({argsMap:(t,e)=>[t.getTrackId(),e]}),BK=$n(),LK=$n(),PK=$n(),UK=je({argsMap:t=>[t.getTrackId()]}),kK=$n(),xK=je({argsMap:t=>[t.getTrackId()]}),MK=$n(),FK=je({argsMap:t=>[t.getTrackId()]}),VK=je({argsMap:(t,e)=>[t.getTrackId(),e.name]}),QK=je({argsMap:t=>[t.getTrackId()]}),vt((In=class extends Hm{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ws.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,r){super(t,n),se(this,"trackMediaType",m_.AUDIO),se(this,"_encoderConfig",void 0),se(this,"_trackSource",void 0),se(this,"_enabled",!0),se(this,"_volume",100),se(this,"_useAudioElement",!0),se(this,"_bypassWebAudio",!1),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_processorDestination",void 0),se(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!r,this._trackSource=new kP,G("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),G("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),yi()&&!Vo?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){zt(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Ws.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Jt(this,be.NEED_REPLACE_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!ate())throw new ie(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ws.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Jt(this,be.NEED_ENABLE_TRACK,this),S.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(r){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Jt(this,be.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Jt(this,be.NEED_MUTE_TRACK,this):await Jt(this,be.NEED_UNMUTE_TRACK,this))}getStats(){return ih(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Sa(this,be.GET_STATS)||wn({},LP)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Yo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Yo.ON_AUDIO_BUFFER),this._source.on(Yo.ON_AUDIO_BUFFER,n=>t(n))}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ws.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ws.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ws.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,be.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return we.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new ie(P.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new ie(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(Rs.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Jt(this,be.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,be.NEED_REPLACE_TRACK,this))}),t.on(Rs.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Rs.ON_TRACK),t.removeAllListeners(Rs.ON_NODE)}bindProcessorContextEvents(t){t.on(Zo.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Zo.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof kP&&(this._trackSource=new hte(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new Cte(this._source.context,this.getTrackId(),"local"),e=new wte(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(Yo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ws.stop(this.getTrackId()),this._source.play()),Jt(this,be.NEED_REPLACE_MIXING_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[TK],Object.getOwnPropertyDescriptor(In.prototype,"setVolume"),In.prototype),vt(In.prototype,"setPlaybackDevice",[SK,bK],Object.getOwnPropertyDescriptor(In.prototype,"setPlaybackDevice"),In.prototype),vt(In.prototype,"setEnabled",[IK,RK,OK],Object.getOwnPropertyDescriptor(In.prototype,"setEnabled"),In.prototype),vt(In.prototype,"setMuted",[NK,DK,BK],Object.getOwnPropertyDescriptor(In.prototype,"setMuted"),In.prototype),vt(In.prototype,"getStats",[LK],Object.getOwnPropertyDescriptor(In.prototype,"getStats"),In.prototype),vt(In.prototype,"setAudioFrameCallback",[PK],Object.getOwnPropertyDescriptor(In.prototype,"setAudioFrameCallback"),In.prototype),vt(In.prototype,"play",[UK,kK],Object.getOwnPropertyDescriptor(In.prototype,"play"),In.prototype),vt(In.prototype,"stop",[xK,MK],Object.getOwnPropertyDescriptor(In.prototype,"stop"),In.prototype),vt(In.prototype,"close",[FK],Object.getOwnPropertyDescriptor(In.prototype,"close"),In.prototype),vt(In.prototype,"pipe",[VK],Object.getOwnPropertyDescriptor(In.prototype,"pipe"),In.prototype),vt(In.prototype,"unpipe",[QK],Object.getOwnPropertyDescriptor(In.prototype,"unpipe"),In.prototype),In),Eb=(HK=je({argsMap:(t,e)=>[t.getTrackId(),e]}),jK=$n(),KK=Lg("MicrophoneAudioTrack","_enabledMutex"),GK=je({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),WK=$n(),zK=je({argsMap:t=>[t.getTrackId()]}),vt((RA=class extends kn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,r){super(t,e.encoderConfig?gb(e.encoderConfig):{},r,G("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),se(this,"_config",void 0),se(this,"_deviceName","default"),se(this,"_constraints",void 0),se(this,"_originalConstraints",void 0),se(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(Bg()||wP())&&jt.bindInterruptDetectorTrack(this)}async setDevice(t){if(S.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await Jo.getDeviceById(t),n={};n.audio=wn({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let r=null;try{r=await zo(n,this.getTrackId())}catch(i){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await zo({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await Jo.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}S.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return S.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),G("AUTO_RESET_AUDIO_ROUTE")&&(Is()||gc())){const o=navigator.audioSession;o&&(t||(o.type="playback"),o.type="auto")}if(!t){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await Jt(this,be.NEED_DISABLE_TRACK,this)}catch(o){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}const i=wn({},this._constraints),s=Jo.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{n||(this._enabled=!0);const o=await zo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await Jt(this,be.NEED_ENABLE_TRACK,this)}catch(o){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}S.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Bg()||wP())&&jt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Is()||gc())&&this._enabled&&!this._isClosed&&jt.duringInterruption){const t=async()=>{jt.off(ni.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};jt.on(ni.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(p_.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=Jo.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const r=await zo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Zo.REQUEST_UPDATE_CONSTRAINTS,async(e,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Zo.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[HK,jK],Object.getOwnPropertyDescriptor(RA.prototype,"setDevice"),RA.prototype),vt(RA.prototype,"setEnabled",[KK,GK,WK],Object.getOwnPropertyDescriptor(RA.prototype,"setEnabled"),RA.prototype),vt(RA.prototype,"close",[zK],Object.getOwnPropertyDescriptor(RA.prototype,"close"),RA.prototype),RA),K1e=(qK=je({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),YK=$n(),XK=je({argsMap:t=>[t.getTrackId()]}),JK=$n(),$K=je({argsMap:t=>[t.getTrackId()]}),ZK=$n(),eG=je({argsMap:t=>[t.getTrackId()]}),tG=$n(),nG=je({argsMap:t=>[t.getTrackId()]}),rG=$n(),iG=je({argsMap:t=>[t.getTrackId()]}),sG=je({argsMap:t=>[t.getTrackId()]}),oG=$n(),vt((di=class extends kn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,r){super(e.createOutputTrack(),n,r),se(this,"source",void 0),se(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(Yo.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(p_.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){zt(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[qK,YK],Object.getOwnPropertyDescriptor(di.prototype,"startProcessAudioBuffer"),di.prototype),vt(di.prototype,"pauseProcessAudioBuffer",[XK,JK],Object.getOwnPropertyDescriptor(di.prototype,"pauseProcessAudioBuffer"),di.prototype),vt(di.prototype,"seekAudioBuffer",[$K,ZK],Object.getOwnPropertyDescriptor(di.prototype,"seekAudioBuffer"),di.prototype),vt(di.prototype,"resumeProcessAudioBuffer",[eG,tG],Object.getOwnPropertyDescriptor(di.prototype,"resumeProcessAudioBuffer"),di.prototype),vt(di.prototype,"stopProcessAudioBuffer",[nG,rG],Object.getOwnPropertyDescriptor(di.prototype,"stopProcessAudioBuffer"),di.prototype),vt(di.prototype,"close",[iG],Object.getOwnPropertyDescriptor(di.prototype,"close"),di.prototype),vt(di.prototype,"setAudioBufferPlaybackSpeed",[sG,oG],Object.getOwnPropertyDescriptor(di.prototype,"setAudioBufferPlaybackSpeed"),di.prototype),di);class wr extends kn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=g_().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,nn(8,"track-mix-")),se(this,"trackList",void 0),se(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(S.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):S.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){S.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}pb(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof wr?n.emit(If.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class G1e extends dte{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(Yo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),se(this,"audioBuffer",void 0),se(this,"sourceNode",void 0),se(this,"startPlayTime",0),se(this,"startPlayOffset",0),se(this,"pausePlayTime",0),se(this,"options",void 0),se(this,"currentLoopCount",0),se(this,"currentPlaybackSpeed",100),se(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):S.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const aG=new Map;class m2{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(S.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){se(this,"trackId",void 0),se(this,"config",void 0),se(this,"onFirstVideoFrameDecoded",void 0),se(this,"onVideoStateChanged",void 0),se(this,"freezeTimeCounterList",[]),se(this,"renderFreezeAccTime",0),se(this,"isKeepLastFrame",!1),se(this,"timeUpdatedCount",0),se(this,"freezeTime",0),se(this,"playbackTime",0),se(this,"lastTimeUpdatedTime",0),se(this,"autoplayFailed",!1),se(this,"videoTrack",void 0),se(this,"videoElement",void 0),se(this,"cacheVideoElement",void 0),se(this,"renderStats",void 0),se(this,"_videoState",IA.VideoStateStopped),se(this,"videoElementCheckInterval",void 0),se(this,"videoElementFreezeTimeout",void 0),se(this,"_videoElementStatus",os.NONE),se(this,"isGettingVideoDimensions",!1),se(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return S.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),se(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&jt.curState==="running"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(h6())),g6()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),se(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=os.PLAYING;break;case"loadeddata":if(this.videoState=IA.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=os.CANPLAY;break;case"stalled":this.videoElementStatus=os.STALLED;break;case"suspend":this.videoElementStatus=os.SUSPEND;break;case"pause":this.videoElementStatus=os.PAUSED,Is()||gc()||yi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=os.WAITING;break;case"abort":this.videoElementStatus=os.ABORT;break;case"ended":this.videoElementStatus=os.ENDED;break;case"emptied":this.videoElementStatus=os.EMPTIED;break;case"error":{const r=this.videoElement.error;r?(this.videoElementStatus=os.ERROR,S.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")"))):S.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Wl.lastVisibleTime<Wl.lastHiddenTime||s<Wl.lastHiddenTime||s<Wl.lastVisibleTime)return;for(i>G("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(h6())),g6()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),jt.on(ni.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),jt.on(ni.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(i=>{e&&Ete(e,"video",i.message,this.trackId),i.name==="NotAllowedError"?(S.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):S.warning("[".concat(this.trackId,"] play warning: "),i)});const r=Ct();if((r.name==="Safari"&&Number(r.version)===15||Bg())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return S.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height);return e.remove(),r}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new we((s,o)=>{r.toBlob(async a=>{if(r.remove(),a){const A=await bte(a);s({buffer:A,width:r.width,height:r.height})}else o(new ie(P.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await p2(e)}destroy(){this.renderStats=void 0,jt.off(ni.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),jt.off(ni.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=IA.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=os.INIT,!this.videoElementCheckInterval&&(cG.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)||(this.videoElementStatus=os.DESTROYED)},1e3),G("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let s;const o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(a,G("VIDEO_FREEZE_DURATION")))},a=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===IA.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=IA.VideoStateFrozen:document.addEventListener("visibilitychange",o))},A=(l,d)=>{if(this.videoElementStatus===os.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=d.mediaTime):this.renderStats={lastTs:d.mediaTime,curTs:d.mediaTime,lastRenderNum:0,renderNum:0},s){const g=d.presentationTime-s.presentationTime;this.videoState===IA.VideoStateStarting&&(this.videoState=IA.VideoStateDecoding),this.videoState===IA.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(a,G("VIDEO_FREEZE_DURATION"))),g<G("VIDEO_FREEZE_DURATION")&&this.videoState===IA.VideoStateFrozen&&(this.videoState=IA.VideoStateDecoding),g>G("VIDEO_FREEZE_DURATION")&&Wl.lastVisibleTime>=Wl.lastHiddenTime&&s.timestamp>Wl.lastVisibleTime&&s.timestamp>Wl.lastHiddenTime&&(this.renderFreezeAccTime+=g)}s=wn(wn({},d),{},{timestamp:l})}var f,p;G("ENABLE_VIDEO_FRAME_CALLBACK")&&((f=(p=this.videoElement).requestVideoFrameCallback)===null||f===void 0||f.call(p,A))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,A)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),zI()&&!G("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=Ct();r.name==="Safari"&&Number(r.version)===15||Bg()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Fn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Fn()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(s=>{S.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){cG.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=os.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{S.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{S.error(r)}),this.autoplayFailed=!1,gv()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};gv()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),_te()}}const cG=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class Ite extends m2{constructor(e){super(e),se(this,"container",void 0),se(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,r):await p2(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",G("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var AG,lG,uG,dG,hG,fG,pG,mG,gG,_G,EG,yG,vG,wG,CG,TG,SG,bG,IG,RG,OG,NG,DG,BG,_t,LG,PG,UG,kG,xG,MG,FG,VG,Fo;let pn=(AG=je({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),lG=$n(),uG=je({argsMap:t=>[t.getTrackId()]}),dG=Lg("LocalVideoTrack","_enabledMutex"),hG=je({argsMap:(t,e)=>[t.getTrackId(),e]}),fG=$n(),pG=Lg("LocalVideoTrack","_enabledMutex"),mG=je({argsMap:(t,e)=>[t.getTrackId(),e]}),gG=$n(),_G=je({argsMap:(t,e)=>[t.getTrackId(),e]}),EG=$n(),yG=$n(),vG=je({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),wG=$n(),CG=$n(),TG=$n(),SG=$n(),bG=$n(),IG=$n(),RG=$n(),OG=je({argsMap:(t,e)=>[t.getTrackId(),e.name]}),NG=je({argsMap:t=>[t.getTrackId()]}),DG=je({argsMap:t=>[t.getTrackId()]}),BG=je({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),_t=class Rte extends Hm{get videoHeight(){if(yi()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(yi()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==os.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,r,i,s,o){if(super(e,s),se(this,"trackMediaType",m_.VIDEO),se(this,"_player",void 0),se(this,"isUseScaleResolutionDownBy",!1),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"_encoderConfig",void 0),se(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),se(this,"_optimizationMode",void 0),se(this,"_videoHeight",void 0),se(this,"_videoWidth",void 0),se(this,"_forceBitrateLimit",void 0),se(this,"_enabled",!0),se(this,"_processorDestination",void 0),se(this,"_processorContext",void 0),yi()){const{width:a,height:A}=e.getSettings();this._videoWidth=a,this._videoHeight=A}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=r,this._optimizationMode=i,this._hints=o||[],this._hints.indexOf(En.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(a,A,l){const d=Ct();return!(d.name!==a||!d.osVersion)&&Number(d.version)===A}(xt.CHROME,115)&&WI().indexOf("Windows")!==-1){const a=function(A,l){if("VideoFrame"in window&&"TransformStream"in window&&bt().supportWebRTCInsertableStream){const d=new MediaStreamTrackProcessor(A),f=new MediaStreamTrackGenerator({kind:"video"});let p,g,y=Date.now();const E=()=>{w&&(clearInterval(w),w=void 0),p&&(p.close(),p=void 0),A.stop(),g=void 0,f.removeEventListener("ended",E)};let w=window.setInterval(()=>{if(g&&p&&Date.now()-y>1e3)try{f.readyState==="live"?g.enqueue(p.clone()):E()}catch{E()}},1e3);const b=new TransformStream({transform:(I,B)=>{f.readyState==="live"?(g=B,y=Date.now(),p===void 0?(p=I,B.enqueue(I.clone())):(B.enqueue(p),p=I)):I.close()}});return f.addEventListener("ended",E),d.readable.pipeThrough(b).pipeTo(f.writable),f}}(e);a&&(S.info("local screen video track begin to inject frame"),this._mediaStreamTrack=a)}n&&this._hints.indexOf(En.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new vte(this.getTrackId(),"local"),this._processorDestination=new yte(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const i=document.getElementById(e);i?e=i:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=wn(wn(wn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new m2(r):this._player=new Ite(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(p_.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Jt(this,be.NEED_DISABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Jt(this,be.NEED_ENABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Jt(this,be.NEED_MUTE_TRACK,this):await Jt(this,be.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new ie(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=zA(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const r=_b({encoderConfig:e});(yi()||Is()||gc())&&(r.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const s=new ie(P.UNEXPECTED_ERROR,i.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=e,this._hints.indexOf(En.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Jt(this,be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(S)}}getStats(){return ih(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Sa(this,be.GET_STATS)||wn({},PP)}async setBeautyEffect(e){S.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await p2(e)}async setBitrateLimit(e){if(S.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await Jt(this,be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void S.error(P.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await Jt(this,be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return S.error(P.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,S.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){Tte(this._originMediaStreamTrack).then(e=>{let[n,r]=e;this._videoHeight=r,this._videoWidth=n}).catch(XI)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new ie(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");S.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=zA(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(En.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Jt(this,be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!e||!n||!r)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){const{max:o,min:a}=function(A,l,d,f,p){const g=G("BITRATE_ADAPTER_TYPE");if(g==="DEFAULT_BITRATE")return{min:f,max:p};if(p===void 0){var y;const w=Math.floor(200*Math.pow(d/15,.6)*Math.pow(A*l/640/360,.75));p=g==="STANDARD_BITRATE"?4*w:2*w,f=(y=f)!==null&&y!==void 0?y:w}else{var E;f=(E=f)!==null&&E!==void 0?E:Math.floor(p/10)}return{min:f,max:p}}(e,n,r,s,i);this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,S.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const a=Mee.checkOneElementVisible(s),A=Object.assign({},a);if(A.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=A.visible;const l=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});A.visible?l.onSuccess("Video is visible"):l.onSuccess("Invisible because of ".concat(A.reason))}return A}return}catch(r){throw new ie(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new ie(P.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;e&&(r=wn(wn({},r),zA(e))),r=pf(r);const i=nn(8,"track-video-cloned-"),s=new Rte(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,pf(this._scalabilityMode),this._optimizationMode,i,pf(this._hints));return e&&r&&s.setEncoderConfiguration(r),S.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new ie(P.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new ie(P.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(ih(()=>{Le.reportApiInvoke(null,{name:Cr.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:xn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!G("ENABLE_VIDEO_SEI")||!G("ENABLE_ENCODED_TRANSFORM"))return void S.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new ie(P.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void S.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"?this.safeEmit("sei-to-send",e):S.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(Rs.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Jt(this,be.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Jt(this,be.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Rs.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Zo.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Zo.REQUEST_CONSTRAINTS)}},vt(_t.prototype,"play",[AG,lG],Object.getOwnPropertyDescriptor(_t.prototype,"play"),_t.prototype),vt(_t.prototype,"stop",[uG],Object.getOwnPropertyDescriptor(_t.prototype,"stop"),_t.prototype),vt(_t.prototype,"setEnabled",[dG,hG,fG],Object.getOwnPropertyDescriptor(_t.prototype,"setEnabled"),_t.prototype),vt(_t.prototype,"setMuted",[pG,mG,gG],Object.getOwnPropertyDescriptor(_t.prototype,"setMuted"),_t.prototype),vt(_t.prototype,"setEncoderConfiguration",[_G,EG],Object.getOwnPropertyDescriptor(_t.prototype,"setEncoderConfiguration"),_t.prototype),vt(_t.prototype,"getStats",[yG],Object.getOwnPropertyDescriptor(_t.prototype,"getStats"),_t.prototype),vt(_t.prototype,"setBeautyEffect",[vG,wG],Object.getOwnPropertyDescriptor(_t.prototype,"setBeautyEffect"),_t.prototype),vt(_t.prototype,"getCurrentFrameData",[CG],Object.getOwnPropertyDescriptor(_t.prototype,"getCurrentFrameData"),_t.prototype),vt(_t.prototype,"getCurrentFrameImage",[TG],Object.getOwnPropertyDescriptor(_t.prototype,"getCurrentFrameImage"),_t.prototype),vt(_t.prototype,"setBitrateLimit",[SG],Object.getOwnPropertyDescriptor(_t.prototype,"setBitrateLimit"),_t.prototype),vt(_t.prototype,"setOptimizationMode",[bG],Object.getOwnPropertyDescriptor(_t.prototype,"setOptimizationMode"),_t.prototype),vt(_t.prototype,"setScalabiltyMode",[IG],Object.getOwnPropertyDescriptor(_t.prototype,"setScalabiltyMode"),_t.prototype),vt(_t.prototype,"updateMediaStreamTrackResolution",[RG],Object.getOwnPropertyDescriptor(_t.prototype,"updateMediaStreamTrackResolution"),_t.prototype),vt(_t.prototype,"pipe",[OG],Object.getOwnPropertyDescriptor(_t.prototype,"pipe"),_t.prototype),vt(_t.prototype,"unpipe",[NG],Object.getOwnPropertyDescriptor(_t.prototype,"unpipe"),_t.prototype),vt(_t.prototype,"close",[DG],Object.getOwnPropertyDescriptor(_t.prototype,"close"),_t.prototype),vt(_t.prototype,"replaceTrack",[BG],Object.getOwnPropertyDescriptor(_t.prototype,"replaceTrack"),_t.prototype),_t),xP=(LG=je({argsMap:(t,e)=>[t.getTrackId(),e]}),PG=$n(),UG=Lg("CameraVideoTrack","_enabledMutex"),kG=je({argsMap:(t,e)=>[t.getTrackId(),e]}),xG=$n(),MG=je({argsMap:(t,e)=>[t.getTrackId(),e]}),FG=$n(),VG=je({argsMap:t=>[t.getTrackId()]}),Fo=class Ote extends pn{get __className__(){return"CameraVideoTrack"}constructor(e,n,r,i,s,o){super(e,zA(n.encoderConfig),i,s,o),se(this,"_config",void 0),se(this,"_originalConstraints",void 0),se(this,"_constraints",void 0),se(this,"_enabled",!0),se(this,"_deviceName","default"),se(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Bg()||wP())&&!function(){const a=Ct();if(a.os!==Pr.IOS||!a.osVersion)return!1;const A=a.osVersion.split(".");return Number(A[0])===15&&Number(A[1])>=2}()&&Uee()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=e.label,this._encoderConfig=zA(this._config.encoderConfig),jt.on(ni.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),jt.on(ni.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(S.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await Jo.getDeviceById(e),r={};r.video=wn({},this._constraints),r.video.deviceId={exact:e},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await zo(r,this.getTrackId())}catch(s){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await zo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Jo.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}S.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){S.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:wn(wn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await zo(n,this.getTrackId())}catch(i){throw S.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await zo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=wn({},n.video),S.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await zo({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await Jt(this,be.NEED_ENABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Jt(this,be.NEED_DISABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new ie(P.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=zA(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const r=ir(this._config);r.encoderConfig=e;const i=_b(r);(yi()||Is()||gc())&&(i.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const o=new ie(P.UNEXPECTED_ERROR,s.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,this._hints.indexOf(En.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Jt(this,be.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(S)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Is()||gc())&&this._enabled&&!this._isClosed&&jt.duringInterruption){const e=async()=>{jt.off(ni.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};jt.on(ni.IOS_INTERRUPTION_END,e)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(p_.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,r=Jo.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await zo({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),jt.off(ni.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),jt.off(ni.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;e&&(r=wn(wn({},r),zA(e))),r=pf(r);const i=nn(8,"track-cam-cloned-"),s=new Ote(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,pf(wn(wn({},this._config),{},{encoderConfig:r})),pf(this._constraints),pf(this._scalabilityMode),this._optimizationMode,i);return e&&r&&s.setEncoderConfiguration(r),S.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(Zo.REQUEST_UPDATE_CONSTRAINTS,async(e,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}),this.processorContext.on(Zo.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},vt(Fo.prototype,"setDevice",[LG,PG],Object.getOwnPropertyDescriptor(Fo.prototype,"setDevice"),Fo.prototype),vt(Fo.prototype,"setEnabled",[UG,kG,xG],Object.getOwnPropertyDescriptor(Fo.prototype,"setEnabled"),Fo.prototype),vt(Fo.prototype,"setEncoderConfiguration",[MG,FG],Object.getOwnPropertyDescriptor(Fo.prototype,"setEncoderConfiguration"),Fo.prototype),vt(Fo.prototype,"close",[VG],Object.getOwnPropertyDescriptor(Fo.prototype,"close"),Fo.prototype),Fo);function HB(t,e,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=wn(wn({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?S.debug("[".concat(t,"] set content hint to"),n.optimizationMode):S.debug("[".concat(t,"] set content hint failed")))):S.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var QG,HG,jG,KG,fa,GG,WG,zG,qG,YG,XG,rs;class Nte extends lte{getUserId(){return this._userId}constructor(e,n,r,i){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(nn(5,""))),se(this,"_userId",void 0),se(this,"_uintId",void 0),se(this,"_isDestroyed",!1),se(this,"store",void 0),se(this,"processor",void 0),se(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let rg=(QG=je({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),HG=je({argsMap:t=>[t.getTrackId()]}),jG=je({argsMap:(t,e)=>[t.getTrackId(),e.name]}),KG=je({argsMap:t=>[t.getTrackId()]}),vt((fa=class extends Nte{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==os.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,r){super(t,e,n,r),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"trackMediaType",m_.VIDEO),se(this,"_videoWidth",void 0),se(this,"_videoHeight",void 0),se(this,"_player",void 0),se(this,"processorDestination",void 0),se(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new vte(this.getTrackId(),"remote"),this.processorDestination=new yte(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return ih(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Sa(this,be.GET_STATS)||wn({},Ate)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const r=document.getElementById(t);r?t=r:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=wn(wn({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new m2(n):this._player=new Ite(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ng.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r=>{this.safeEmit(ng.VIDEO_STATE_CHANGED,r)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(ng.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},G("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Tte(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(XI)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),r={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const o=Mee.checkOneElementVisible(i),a=Object.assign({},o);if(a.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=a.visible;const A=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});a.visible?A.onSuccess("Video is visible"):A.onSuccess("Invisible because of ".concat(a.reason))}return a}return}catch(n){throw new ie(P.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new ie(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Rs.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Rs.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(If.SEI_RECEIVED,t)}}).prototype,"play",[QG],Object.getOwnPropertyDescriptor(fa.prototype,"play"),fa.prototype),vt(fa.prototype,"stop",[HG],Object.getOwnPropertyDescriptor(fa.prototype,"stop"),fa.prototype),vt(fa.prototype,"pipe",[jG],Object.getOwnPropertyDescriptor(fa.prototype,"pipe"),fa.prototype),vt(fa.prototype,"unpipe",[KG],Object.getOwnPropertyDescriptor(fa.prototype,"unpipe"),fa.prototype),fa),ig=(GG=je({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),WG=je({argsMap:(t,e)=>[t.getTrackId(),e]}),zG=je({argsMap:t=>[t.getTrackId()]}),qG=je({argsMap:t=>[t.getTrackId()]}),YG=je({argsMap:(t,e)=>[t.getTrackId(),e.name]}),XG=je({argsMap:t=>[t.getTrackId()]}),vt((rs=class extends Nte{get isPlaying(){return this._useAudioElement?Ws.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,r){super(t,e,n,r),se(this,"trackMediaType",m_.AUDIO),se(this,"_source",void 0),se(this,"_useAudioElement",!0),se(this,"_volume",100),se(this,"processorContext",void 0),se(this,"processorDestination",void 0),se(this,"_played",!1),se(this,"_bypassWebAudio",!1),G("DISABLE_WEBAUDIO")?(this._source=new kP,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new hte(t,!0),G("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Yo.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ng.FIRST_FRAME_DECODED)}),this.processorContext=new Cte(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new wte(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Yo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(Yo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(Yo.ON_AUDIO_BUFFER),this._source.on(Yo.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?Ws.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!ate())throw new ie(P.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ws.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return ih(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Sa(this,be.GET_STATS)||wn({},cte)}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ws.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ws.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ws.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new ie(P.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new ie(P.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new ie(P.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Rs.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Rs.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Rs.ON_TRACK),this.processorDestination.removeAllListeners(Rs.ON_NODE)}}).prototype,"setVolume",[GG],Object.getOwnPropertyDescriptor(rs.prototype,"setVolume"),rs.prototype),vt(rs.prototype,"setPlaybackDevice",[WG],Object.getOwnPropertyDescriptor(rs.prototype,"setPlaybackDevice"),rs.prototype),vt(rs.prototype,"play",[zG],Object.getOwnPropertyDescriptor(rs.prototype,"play"),rs.prototype),vt(rs.prototype,"stop",[qG],Object.getOwnPropertyDescriptor(rs.prototype,"stop"),rs.prototype),vt(rs.prototype,"pipe",[YG],Object.getOwnPropertyDescriptor(rs.prototype,"pipe"),rs.prototype),vt(rs.prototype,"unpipe",[XG],Object.getOwnPropertyDescriptor(rs.prototype,"unpipe"),rs.prototype),rs);const Wl=new class extends Ln{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),se(this,"_lastHiddenTime",0),se(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),S.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Dte extends Ln{constructor(e,n){super(),se(this,"trackMediaType",m_.DATA),se(this,"_version",1),se(this,"_type",3),se(this,"_config",void 0),se(this,"_originDataChannel",void 0),se(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),se(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),se(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return G("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new we((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const r=setTimeout(()=>{var i;n(new ie(P.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new ie(P.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new ie(P.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[$0.OPEN,$0.CLOSE,$0.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),e.addEventListener(n,r)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;e.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class W1e extends Dte{constructor(e){super(e),se(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(G("SHOW_DATASTREAM2_LOG")&&S.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit($0.MESSAGE,s)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class z1e extends Dte{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function eS(){const t=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>_K.revokeObjectURL(t),0),new Worker(_K.createObjectURL(t))}const DT=new Map,BT=new Map;function q1e(t,e,n){let r=new Uint8Array(t,e,n),i=[],s=0;for(;i.length<n;)s+3<n&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(i.push(r[s],r[s+1],r[s+3]),s+=4):(i.push(r[s]),s++);return new Uint8Array(i)}const LT=new Map;async function Y1e(t,e){if(!bt().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(LT.has(t)||!t.track)return;const n={track:t.track};if(Fd()){if(!t.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let i=null;try{i=t.createEncodedStreams()}catch(a){return void S.error("create video-encoded-streams error",a&&a.message)}let s=[];e.on("sei-to-send",a=>{s.push(a)});const o=new TransformStream({transform(a,A){n.controller||(n.controller=A),t.track&&t.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",r),n.track=t.track,n.track.addEventListener("ended",r));const l=s.shift();l&&(a.data=function(d,f){const p=function(I){const B=I.length;let U=[],H=0;for(;H<B;)H+2<B&&I[H]===0&&I[H+1]===0&&(I[H+2]===0||I[H+2]===1||I[H+2]===2||I[H+2]===3)?(U.push(I[H],I[H+1],3,I[H+2]),H+=3):(U.push(I[H]),H++);return new Uint8Array(U)}(f),g=p.length,y=Math.floor(g/255),E=g%255,w=new Uint8Array(6+y+1+g+d.byteLength);w[0]=0,w[1]=0,w[2]=0,w[3]=1,w[4]=6,w[5]=101;let b=0;for(;b<y;)w[6+b]=255,b++;return w[6+b]=E,b++,w.set(p,6+b),w.set(new Uint8Array(d),6+b+g),w.buffer}(a.data,l)),A.enqueue(a)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(!yi())return;{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const i=eS(),s=new MessageChannel;await new we(a=>i.onmessage=A=>{A.data==="registered"&&a(void 0)});const o=new RTCRtpScriptTransform(i,{name:"tx",port:s.port2},[s.port2]);t.transform=o,await new we(a=>i.onmessage=A=>{A.data==="started"&&a(void 0)}),e.on("sei-to-send",a=>{s.port1.postMessage({sei:a})}),s.port1.onmessage=a=>{var A;a.data.transformed&&t.track&&((A=t.track)===null||A===void 0?void 0:A.id)!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",r),n.track=t.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",r)}const i=LT.get(t);if(i){LT.delete(t);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(a){S.warning(a&&a.message)}}}LT.set(t,n),t.track.addEventListener("ended",r)}const LE=new Map;(function(){const t=Ct();Xr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Xr.getStreamFromExtension=t.name===xt.CHROME&&Number(t.version)>34,Xr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),Xr.supportMinBitrate=t.name===xt.CHROME||t.name===xt.EDGE,Xr.supportSetRtpSenderParameters=function(){const e=Ct();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!rh()||!(!yi()&&!fb())||e.name===xt.FIREFOX&&Number(e.version)>=64)}(),t.name===xt.SAFARI&&(Number(t.version)>=14?Xr.supportDualStream=!0:Xr.supportDualStream=!1),Xr.webAudioMediaStreamDest=function(){const e=Ct();return!(e.name===xt.SAFARI&&Number(e.version)<12)}(),Xr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Xr.supportWebGL=typeof WebGLRenderingContext<"u",Xr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,rh()||(Xr.webAudioWithAEC=!0),Xr.supportShareAudio=function(){const e=Ct();return(e.os===Pr.WIN_10||e.os===Pr.WIN_81||e.os===Pr.WIN_7||e.os===Pr.LINUX||e.os===Pr.MAC_OS||e.os===Pr.CHROMIUM_OS)&&e.name===xt.CHROME&&Number(e.version)>=74}(),Xr.supportDataChannel=!!(vP(76)||function(e){const n=Ct();return!(n.name!==xt.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||Bee(14)),Xr.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!Fn()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Xr.supportWebRTCEncodedTransform=function(){const e=Ct();return e.name==="Chrome"&&Number(e.version)>=86||e.name==="Safari"&&Number(e.version)>=15}(),Xr.supportWebRTCInsertableStream=function(){const e=Ct();return(e.name===xt.CHROME||e.name===xt.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Xr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Xr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,YI(()=>{Xr.supportDualStreamEncoding=function(){const e=Ct();return!!G("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&G("CHROME_DUAL_STREAM_USE_ENCODING"))}(),S.info("browser compatibility",JSON.stringify(Xr),JSON.stringify(t))})})();class Hf extends Ln{constructor(e,n){super(),N(this,"signal",void 0),N(this,"token",void 0),N(this,"tokenTimeout",void 0),N(this,"tokenInterval",void 0),N(this,"_sequence",0),N(this,"userMap",new Map),N(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const r=()=>{this.signal.connectionState===tn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*G("P2P_TOKEN_INTERVAL"))};r()}async send(e,n,r,i,s){var o,a,A;if(this.userMap.size===0)return;const l=Array.from(au(o=this.userMap).call(o))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=(a=i)!==null&&a!==void 0?a:nn(6,""),s=(A=s)!==null&&A!==void 0?A:this._sequence++;const d={_id:i,_type:e,_seq:s,_message:n,token:"".concat(this.token,"_").concat(l)};G("SHOW_P2P_LOG")&&S.debug("send message",d,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(d)).forEach(p=>{this.signal.request(We.DATA_STREAM,{payload:Vd(this.encoder.encode(p))})});const f=new we((p,g)=>{const y=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),E),this.off("res-@".concat(i),b),this.off(Xp.ABORT,w),S.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(i)),this.userMap.size===0?g(new ie(P.INVALID_REMOTE_USER)):g(new ie(P.TIMEOUT))},G("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),E=()=>{y&&window.clearTimeout(y),this.off(Xp.ABORT,w),r&&p()},w=()=>{y&&window.clearTimeout(y),this.off("res-@".concat(i,"_ack"),E),this.off("res-@".concat(i),b),g(new ie(P.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(i)))};this.once(Xp.ABORT,w),this.once("res-@".concat(i,"_ack"),E);const b=(B,U)=>{I=!0,y&&window.clearTimeout(y),this.off("res-@".concat(i,"_ack"),E),this.off(Xp.ABORT,w),B==="success"?p(U):g(new ie(P.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(i)))};let I=!1;r||(this.once("res-@".concat(i),b),ai(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{I||S.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(i,", ").concat(d))}))});try{return await f}catch(p){if(p.code===P.TIMEOUT)return await this.send(e,n,r,i,s);throw p}}onMessage(e){var n;const{_uid:r}=e;let i,s=this.userMap.get(r);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==Yn.CHECK)return;const{token:l}=e;i=new Map,s={uid:r,isStart:!0,token:l,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(ht.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in e&&"total"in e){var o;const{id:l,total:d}=e,f=(o=i.get(l))!==null&&o!==void 0?o:[];if(f.push(e),i.has(l)||i.set(l,f),f.length!==d)return;{const p=_w(f).call(f,(g,y)=>g.index-y.index).map(g=>g.payload).join("");i.delete(l),(e=JSON.parse(p))._uid=r}}const{_type:a,token:A}=e;if(Se(n=[Yn.ACK,Yn.CHECK]).call(n,a))return a===Yn.CHECK&&this.handleCheckToken(s,A),void this.receiveMessage(e);A==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(e):S.debug('Receive unexpected message", '.concat(A,", cur_token: ").concat(s.token,"_").concat(this.token),e)}check(){const e={_id:nn(6,""),token:this.token,_type:Yn.CHECK};G("SHOW_P2P_LOG")&&S.debug("send message",e),this.signal.request(We.DATA_STREAM,{payload:Vd(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:Yn.ACK,token:this.token};G("SHOW_P2P_LOG")&&S.debug("send message",n),this.signal.request(We.DATA_STREAM,{payload:Vd(this.encoder.encode(JSON.stringify(n)))})}response(e,n,r){this.send(Yn.RESPONSE,JSON.stringify({success:!r,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(l=>{const{receivedMessagesMap:d,nextExpectedSequenceNumber:f}=l;for(;d.has(f);){const p=d.get(f);d.delete(f),this.receiveMessage(p),l.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:r,_seq:i}=e,s=this.userMap.get(r),{receivedMessagesMap:o,isStart:a,nextExpectedSequenceNumber:A}=s;if(i<A)return this.ack(e._id),void S.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(e._message));o.set(i,e),a&&i===A&&(this.receiveMessage(e),o.delete(A),s.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:r,_message:i,_uid:s}=e;if(G("SHOW_P2P_LOG")&&S.debug("receive message",e),n){let o;switch(e._type!==Yn.ACK&&(i&&(o=JSON.parse(i)),this.ack(e._id)),e._type){case Yn.CANDIDATE:case Yn.CONTROL:this.signal.emit(r,o,s);break;case Yn.PUBLISH:case Yn.UNPUBLISH:case Yn.RESTART_ICE:case Yn.CALL:o.uid=s,vi(this.signal,r,o).then(a=>{this.response(e._id,a)}).catch(()=>{this.response(e._id,void 0,!0)});break;case Yn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Yn.RESPONSE:{const{success:a,message:A}=o;this.emit("res-@".concat(n),a?"success":"failed",A);break}}}}splitMessage(e){if(e.length<Hf.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:r}=JSON.parse(e),i=nn(6,"");let s=0,o=800;const a=Math.ceil(e.length/o);for(;e.length>0;){s++;const A={id:i,index:s,total:a,payload:e.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(A).length>Hf.MAX_MESSAGE_SIZE?o-=50:(n.push(A),e=e.slice(o))}return n.map(A=>JSON.stringify(A))}handleCheckToken(e,n){return e.token!==n?(S.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{S.debug("token timeout, ".concat(n)),this.reset(e.uid)},G("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await vi(this.signal,Yn.CALL,void 0),n=await this.send(Yn.CALL,e);this.signal.emit(qe.P2P_CONNECTION,n,!0)}async reset(e,n){const r=this.userMap.get(e);r&&(this.emit(Xp.ABORT),this.signal.emit(ht.ON_USER_OFFLINE,{uid:r.uid,reason:uBe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(S.debug("change local token from ".concat(n," to ").concat(n)),this.token=nn(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Xp.ABORT)}}N(Hf,"MAX_SIZE",1),N(Hf,"MAX_MESSAGE_SIZE",1024);class JG extends Ln{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===tn.CONNECTED?this.emit(qe.WS_CONNECTED):e===tn.RECONNECTING?this.emit(qe.WS_RECONNECTING,this._websocketReconnectReason):e===tn.CLOSED&&this.emit(qe.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",tn.CLOSED),N(this,"reconnectToken",void 0),N(this,"p2pToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new Kee(5)),N(this,"pingpongTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"_external_signal",void 0),N(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(qe.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case ht.ON_DATA_STREAM:return void this.handleDataStream(i._message);case ht.MUTE_AUDIO:case ht.MUTE_VIDEO:case ht.ON_P2P_LOST:case ht.ON_USER_ONLINE:return;case ht.ON_USER_OFFLINE:const{uid:s}=i._message;return S.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===ht.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===ht.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Ft.UID_BANNED);break;case 15:this.close(Ft.IP_BANNED);break;case 16:this.close(Ft.CHANNEL_BANNED)}if(i._type===ht.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Ve.ERR_LICENSE_MISSING:this.close(Ft.LICENSE_MISSING);break;case Ve.ERR_LICENSE_EXPIRED:this.close(Ft.LICENSE_EXPIRED);break;case Ve.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ft.LICENSE_MINUTES_EXCEEDED);break;case Ve.ERR_LICENSE_PERIOD_INVALID:this.close(Ft.LICENSE_PERIOD_INVALID);break;case Ve.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ft.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ve.ERR_LICENSE_ILLEGAL:this.close(Ft.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new c2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,G("JOIN_GATEWAY_USE_DUAL_DOMAIN"),G("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===tn.CONNECTED&&this.reconnect("retry",_i.OFFLINE)}),this.p2pToken=nn(6,""),this._external_signal=new Hf(this,this.p2pToken)}async request(e,n,r,i){const s=nn(6,""),o={_id:s,_type:e,_message:n},a=this.websocket.connectionID,A=()=>new we((y,E)=>{if(this.connectionState===tn.CONNECTED)return y();const w=()=>{this.off(qe.WS_CLOSED,b),y()},b=()=>{this.off(qe.WS_CONNECTED,w),E(new ie(P.WS_ABORT))};this.once(qe.WS_CONNECTED,w),this.once(qe.WS_CLOSED,b)});if(this.connectionState!==tn.CONNECTING&&this.connectionState!==tn.RECONNECTING||e===We.JOIN||e===We.REJOIN||await A(),this.websocket.sendMessage(o,!0),i)return;const l=new we((y,E)=>{let w=!1;const b=(B,U)=>{w=!0,y({isSuccess:B==="success",message:U||{}}),this.off(qe.WS_CLOSED,I),this.off(qe.WS_RECONNECTING,I),this.emit(qe.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),b);const I=()=>{E(new ie(P.WS_ABORT,"type: ".concat(e))),this.off(qe.WS_CLOSED,I),this.off(qe.WS_RECONNECTING,I),this.off("res-@".concat(s),b)};this.once(qe.WS_CLOSED,I),this.once(qe.WS_RECONNECTING,I),ai(G("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||w||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(qe.REQUEST_TIMEOUT,e,n))})});let d=null;try{d=await l}catch(y){if(this.connectionState===tn.CLOSED||e===We.LEAVE)throw new ie(P.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?y.throw():e===We.JOIN||e===We.REJOIN?null:(await A(),await this.request(e,n))}if(d.isSuccess)return d.message;const f=Number(d.message.error_code||d.message.code),p=yv(f),g=new ie(P.UNEXPECTED_RESPONSE,"".concat(p.desc,": ").concat(d.message.error_str),{code:f,data:d.message,desc:p.desc});return p.action==="success"?d.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(f,", message: ").concat(p.desc,", action: ").concat(p.action)),f===Ve.ERR_TOO_MANY_BROADCASTERS?((e===We.JOIN||e===We.REJOIN)&&(this.initError=g,this.close()),g.throw()):p.action==="failed"?g.throw():p.action==="quit"?(this.initError=g,this.close(),g.throw()):(f===Ve.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=d.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",_i.MULTI_IP)):this.reconnect(p.action,_i.SERVER_ERROR),e===We.JOIN||e===We.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new we(r=>{const i=s=>{(!n||n(s))&&(this.off(e,i),r(s))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Ev.WRTC_STATS,n)}upload(e,n){const r={_type:e,_message:n};try{this.websocket.sendMessage(r)}catch{const s=G("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==tn.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},G("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const r={_type:e,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(e,n,r){return await this._external_signal.send(e,n,r)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new we((n,r)=>{this.once(qe.WS_CONNECTED,()=>n(this.joinResponse)),this.once(qe.WS_CLOSED,()=>r(this.initError||new ie(P.WS_ABORT))),this.connectionState=tn.CONNECTING,this.websocket.init(e).catch(r)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Ft.LEAVE,this.connectionState=tn.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=nn(6,""),this._external_signal.clear(),this._external_signal=new Hf(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(qe.ABORT_P2P_EXECUTION);const e=await vi(this,qe.REQUEST_JOIN_INFO),n=await this.request(We.JOIN,e);if(!n)return this.emit(qe.REPORT_JOIN_GATEWAY,P.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(qe.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=tn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const r=mf(e.payload),i=new TextDecoder().decode(r),s=JSON.parse(i);"total"in s&&"id"in s||Se(n=Object.values(Yn)).call(n,s._type)?(s._uid=e.uid,this._external_signal.onMessage(s)):this.emit(ht.ON_DATA_STREAM,e)}catch{this.emit(ht.ON_DATA_STREAM,e)}}handleNotification(e){S.debug("[".concat(this.clientId,"] receive notification: "),e);const n=yv(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ft.UID_BANNED),void this.close()):void this.reconnect(n.action,_i.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=G("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(S.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>G("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_i.TIMEOUT):this.request(We.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),G("REPORT_STATS")&&this.send(We.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(Ye.RECONNECT_WAITTING_FINISH,e=>{this.emit(qe.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(Ye.RECONNECT_CREATE_CONNECTION,e=>{this.emit(qe.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Ye.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ye.CLOSED,()=>{this.connectionState=tn.CLOSED}),this.websocket.on(Ye.FAILED,()=>{this._disconnectedReason=Ft.NETWORK_ERROR,this.connectionState=tn.CLOSED}),this.websocket.on(Ye.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===tn.CONNECTED?this.connectionState=tn.RECONNECTING:this.connectionState=tn.CONNECTING}),this.websocket.on(Ye.WILL_RECONNECT,(e,n,r)=>{e!=="retry"?(S.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):S.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(e)}),this.websocket.on(Ye.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(qe.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof ie&&e.code===P.UNEXPECTED_RESPONSE&&e.data.code===Ve.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",_i.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_i.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Ye.REQUEST_NEW_URLS,(e,n)=>{vi(this,qe.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(Ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ht.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var Bte={exports:{}};Bte.exports=(()=>{var t={8:(r,i,s)=>{s.r(i),s.d(i,{Parser:()=>M,Printer:()=>Ue,parse:()=>Z,print:()=>ae});const o=`
`,a="".concat("\r").concat(o),A=" ";let l;function d(j){return j>="0"&&j<="9"}function f(j){return j>="!"&&j<="~"}function p(j){return f(j)||j>=""&&j<=""}function g(j){return j==="!"||j>="#"&&j<="'"||j>="*"&&j<="+"||j>="-"&&j<="."||j>="0"&&j<="9"||j>="A"&&j<="Z"||j>="^"&&j<="~"}function y(j){return j>="1"&&j<="9"}function E(j){return j>="A"&&j<="Z"||j>="a"&&j<="z"}function w(j){return j==="d"||j==="h"||j==="m"||j==="s"}function b(j){return j>""&&j<"	"||j>"\v"&&j<"\f"||j>""&&j<""}function I(j){return E(j)||d(j)||j==="+"||j==="/"}function B(j){return d(j)||E(j)||j==="+"||j==="/"||j==="-"||j==="_"}function U(j){return E(j)||d(j)||j==="+"||j==="/"}function H(j,C){var L=Object.keys(j);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(j);C&&(k=k.filter(function(ee){return Object.getOwnPropertyDescriptor(j,ee).enumerable})),L.push.apply(L,k)}return L}function K(j){for(var C=1;C<arguments.length;C++){var L=arguments[C]!=null?arguments[C]:{};C%2?H(Object(L),!0).forEach(function(k){x(j,k,L[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(j,Object.getOwnPropertyDescriptors(L)):H(Object(L)).forEach(function(k){Object.defineProperty(j,k,Object.getOwnPropertyDescriptor(L,k))})}return j}function x(j,C,L){return C in j?Object.defineProperty(j,C,{value:L,enumerable:!0,configurable:!0,writable:!0}):j[C]=L,j}(function(j){j.VERSION="v",j.ORIGIN="o",j.SESSION_NAME="s",j.INFORMATION="i",j.URI="u",j.EMAIL="e",j.PHONE="p",j.CONNECTION="c",j.BANDWIDTH="b",j.TIME="t",j.REPEAT="r",j.ZONE_ADJUSTMENTS="z",j.KEY="k",j.ATTRIBUTE="a",j.MEDIA="m"})(l||(l={}));class V{consumeText(C,L){let k=L;for(;k<C.length;){const ee=C[k];if(ee==="\0"||ee==="\r"||ee===o)break;k+=1}if(k-L==0)throw new Error("Invalid text, at ".concat(C));return k}consumeUnicastAddress(C,L,k){return this.consumeTill(C,L,A)}consumeOneOrMore(C,L,k){let ee=L;for(;k(C[ee]);)ee++;if(ee-L==0)throw new Error("Invalid rule at ".concat(L,"."));return ee}consumeSpace(C,L){if(C[L]===A)return L+1;throw new Error("Invalid space at ".concat(L,"."))}consumeIP4Address(C,L){let k=L;for(let ee=0;ee<4;ee++)if(k=this.consumeDecimalUChar(C,k),ee!==3){if(C[k]!==".")throw new Error("Invalid IP4 address.");k++}return k}consumeDecimalUChar(C,L){let k=L;for(let _e=0;_e<3&&d(C[k]);_e++,k++);if(k-L==0)throw new Error("Invalid decimal uchar.");const ee=parseInt(C.slice(L,k));if(ee>=0&&ee<=255)return k;throw new Error("Invalid decimal uchar")}consumeIP6Address(C,L){let k=this.consumeHexpart(C,L);return C[k]===":"&&(k+=1,k=this.consumeIP4Address(C,k)),k}consumeHexpart(C,L){let k=L;if(C[k]===":"&&C[k+1]===":"){k+=2;try{k=this.consumeHexseq(C,k)}catch{}return k}if(k=this.consumeHexseq(C,k),C[k]===":"&&C[k+1]===":"){k+=2;try{k=this.consumeHexseq(C,k)}catch{}return k}return k}consumeHexseq(C,L){let k=L;for(;k=this.consumeHex4(C,k),C[k]===":"&&C[k+1]!==":";)k+=1;return k}consumeHex4(C,L){let k=0;for(;k<4;k++)if(!((ee=C[L+k])>="0"&&ee<="9"||ee>="a"&&ee<="f"||ee>="A"&&ee<="F")){if(k===0)throw new Error("Invalid hex 4");break}var ee;return L+k}consumeFQDN(C,L){let k=L;for(;d(C[k])||E(C[k])||C[k]==="-"||C[k]===".";)k+=1;if(k-L<4)throw new Error("Invalid FQDN");return k}consumeExtnAddr(C,L){return this.consumeOneOrMore(C,L,p)}consumeMulticastAddress(C,L,k){switch(k){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(C,L);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(C,L);default:try{return this.consumeFQDN(C,L)}catch{return this.consumeExtnAddr(C,L)}}}consumeIP6MulticastAddress(C,L){const k=this.consumeHexpart(C,L);return C[k]==="/"?this.consumeInteger(C,k+1):k}consumeIP4MulticastAddress(C,L){let k=L+3;const ee=C.slice(L,k),_e=parseInt(ee);if(_e<224||_e>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ke=0;ke<3;ke++){if(C[k]!==".")throw new Error("Invalid IP4 multicast address.");k+=1,k=this.consumeDecimalUChar(C,k)}return C[k]==="/"&&(k+=1),k=this.consumeTTL(C,k),C[k]==="/"&&(k=this.consumeInteger(C,k)),k}consumeInteger(C,L){if(!y(C[L]))throw new Error("Invalid integer.");for(L+=1;d(C[L]);)L+=1;return L}consumeTTL(C,L){if(C[L]==="0")return L+1;if(!y(C[L]))throw new Error("Invalid TTL.");L+=1;for(let k=0;k<2&&d(C[L]);k++)L+=1;return L}consumeToken(C,L){return this.consumeOneOrMore(C,L,g)}consumeTime(C,L){let k=L;if(C[k]==="0")return k+1;for(y(C[k])&&(k+=1);d(C[k]);)k++;if(k-L<10)throw new Error("Invalid time");return k}consumeAddress(C,L){return this.consumeTill(C,L,A)}consumeTypedTime(C,L){let k=L;return k=this.consumeOneOrMore(C,k,d),w(C[k])?k+1:k}consumeRepeatInterval(C,L){if(!y(C[L]))throw new Error("Invalid repeat interval");for(L+=1;d(C[L]);)L+=1;return w(C[L])&&(L+=1),L}consumePort(C,L){return this.consumeOneOrMore(C,L,d)}consume(C,L,k){for(let ee=0;ee<k.length;ee++){if(L+ee>=C.length)throw new Error("consume exceeding value length");if(C[L+ee]!==k[ee])throw new Error("consume ".concat(k," failed at ").concat(ee))}return L+k.length}consumeTill(C,L,k){let ee=L;for(;ee<C.length&&(typeof k!="string"||C[ee]!==k)&&(typeof k!="function"||!k(C[ee]));)ee++;return ee}}class M extends V{constructor(){super(),x(this,"records",[]),x(this,"currentLine",0)}parse(C){const L=this.probeEOL(C);this.records=C.split(L).filter($t=>!!as($t).call($t)).map(this.parseLine),this.currentLine=0;const k=this.parseVersion(),ee=this.parseOrigin(),_e=this.parseSessionName(),ke=this.parseInformation(),ft=this.parseUri(),Rt=this.parseEmail(),Gr=this.parsePhone(),Xi=this.parseConnection(),Ls=this.parseBandWidth(),Ur=this.parseTimeFields(),Wr=this.parseKey(),kr=this.parseSessionAttribute(),qt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:k,origin:ee,sessionName:_e,information:ke,uri:ft,emails:Rt,phones:Gr,connection:Xi,bandwidths:Ls,timeFields:Ur,key:Wr,attributes:kr,mediaDescriptions:qt}}getCurrentRecord(){const C=this.records[this.currentLine];if(!C)throw new Error("Record doesn't exit.");return C}probeEOL(C){for(let L=0;L<C.length;L++)if(C[L]===o)return C[L-1]==="\r"?a:o;throw new Error("Invalid newline character.")}parseLine(C,L){if(C.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const k=C[0];if(C[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:k,value:C.slice(2),line:L,cur:0}}parseSessionAttribute(){const C=new z;for(;this.currentLine<this.records.length;){const L=this.getCurrentRecord();if(L.type!==l.ATTRIBUTE)break;const k={attField:this.extractOneOrMore(L,ee=>g(ee)&&ee!==":"),_cur:0};L.value[L.cur]===":"&&(L.cur+=1,k.attValue=this.extractOneOrMore(L,b)),C.parse(k),this.currentLine++}return C.digest()}parseMediaAttributes(C){const L=new $(C);for(;this.currentLine<this.records.length;){const k=this.getCurrentRecord();if(k.type!==l.ATTRIBUTE)break;const ee={attField:this.extractOneOrMore(k,_e=>g(_e)&&_e!==":"),_cur:0};k.value[k.cur]===":"&&(k.cur+=1,ee.attValue=this.extractOneOrMore(k,b)),L.parse(ee),this.currentLine++}return L.digest()}parseKey(){const C=this.getCurrentRecord();if(C.type===l.KEY){if(C.value==="prompt"||C.value==="clear:"||C.value==="base64:"||C.value==="uri:")return C.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const C=this.getCurrentRecord();if(C.type===l.ZONE_ADJUSTMENTS){const L=[];for(;;)try{const k=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);let ee=!1;C.value[C.cur]==="-"&&(ee=!0,C.cur+=1);const _e=this.extract(C,this.consumeTypedTime);L.push({time:k,typedTime:_e,back:ee})}catch{break}if(L.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,L}return[]}parseRepeat(){const C=[];for(;;){const L=this.getCurrentRecord();if(L.type!==l.REPEAT)break;{const k=this.extract(L,this.consumeRepeatInterval),ee=this.parseTypedTime(L);C.push({repeatInterval:k,typedTimes:ee}),this.currentLine++}}return C}parseTypedTime(C){const L=[];for(;;)try{this.consumeSpaceForRecord(C),L.push(this.extract(C,this.consumeTypedTime))}catch{break}if(L.length===0)throw new Error("Invalid typed time.");return L}parseTime(){const C=this.getCurrentRecord(),L=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);const k=this.extract(C,this.consumeTime);return this.currentLine++,{startTime:L,stopTime:k}}parseBandWidth(){const C=[];for(;this.currentLine<this.records.length;){const L=this.getCurrentRecord();if(L.type!==l.BANDWIDTH)break;{const k=this.extractOneOrMore(L,g);if(L.value[L.cur]!==":")throw new Error("Invalid bandwidth field.");L.cur++;const ee=this.extractOneOrMore(L,d);C.push({bwtype:k,bandwidth:ee}),this.currentLine++}}return C}parseVersion(){const C=this.getCurrentRecord();if(C.type!==l.VERSION)throw new Error("first sdp record must be version");const L=C.value.slice(0,this.consumeOneOrMore(C.value,0,d));if(L.length!==C.value.length)throw new Error('invalid proto version, "v='.concat(C.value,'"'));return this.currentLine++,L}parseOrigin(){const C=this.getCurrentRecord();if(C.type!==l.ORIGIN)throw new Error("second line of sdp must be origin");const L=this.extractOneOrMore(C,p);this.consumeSpaceForRecord(C);const k=this.extractOneOrMore(C,d);this.consumeSpaceForRecord(C);const ee=this.extractOneOrMore(C,d);this.consumeSpaceForRecord(C);const _e=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const ke=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const ft=this.extract(C,this.consumeUnicastAddress);return this.currentLine++,{username:L,sessId:k,sessVersion:ee,nettype:_e,addrtype:ke,unicastAddress:ft}}parseSessionName(){const C=this.getCurrentRecord();if(C.type===l.SESSION_NAME){const L=this.extract(C,this.consumeText);return this.currentLine++,L}}parseInformation(){const C=this.getCurrentRecord();if(C.type!==l.INFORMATION)return;const L=this.extract(C,this.consumeText);return this.currentLine++,L}parseUri(){const C=this.getCurrentRecord();if(C.type===l.URI)return this.currentLine++,C.value}parseEmail(){const C=[];for(;;){const L=this.getCurrentRecord();if(L.type!==l.EMAIL)break;C.push(L.value),this.currentLine++}return C}parsePhone(){const C=[];for(;;){const L=this.getCurrentRecord();if(L.type!==l.PHONE)break;C.push(L.value),this.currentLine++}return C}parseConnection(){const C=this.getCurrentRecord();if(C.type===l.CONNECTION){const L=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const k=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const ee=this.extract(C,this.consumeAddress);return this.currentLine++,{nettype:L,addrtype:k,address:ee}}}parseMedia(){const C=this.getCurrentRecord(),L=this.extract(C,this.consumeToken);this.consumeSpaceForRecord(C);let k=this.extract(C,this.consumePort);C.value[C.cur]==="/"&&(C.cur+=1,k+=this.extract(C,this.consumeInteger)),this.consumeSpaceForRecord(C);const ee=[];for(ee.push(this.extract(C,this.consumeToken));C.value[C.cur]==="/";)C.cur+=1,ee.push(this.extract(C,this.consumeToken));if(ee.length===0)throw new Error("Invalid proto");const _e=this.parseFmt(C);return this.currentLine++,{mediaType:L,port:k,protos:ee,fmts:_e}}parseTimeFields(){const C=[];for(;this.getCurrentRecord().type===l.TIME;){const L=this.parseTime(),k=this.parseRepeat(),ee=this.parseZone();C.push({time:L,repeats:k,zones:ee})}return C}parseMediaDescription(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===l.MEDIA;){const L=this.parseMedia(),k=this.parseInformation(),ee=this.parseConnections(),_e=this.parseBandWidth(),ke=this.parseKey(),ft=this.parseMediaAttributes(L);C.push({media:L,information:k,connections:ee,bandwidths:_e,key:ke,attributes:ft})}return C}parseConnections(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===l.CONNECTION;)C.push(this.parseConnection());return C}parseFmt(C){const L=[];for(;;)try{this.consumeSpaceForRecord(C),L.push(this.extract(C,this.consumeToken))}catch{break}if(L.length===0)throw new Error("Invalid fmts");return L}extract(C,L){for(var k=arguments.length,ee=new Array(k>2?k-2:0),_e=2;_e<k;_e++)ee[_e-2]=arguments[_e];const ke=L.call(this,C.value,C.cur,...ee),ft=C.value.slice(C.cur,ke);return C.cur=ke,ft}extractOneOrMore(C,L){const k=this.consumeOneOrMore(C.value,C.cur,L),ee=C.value.slice(C.cur,k);return C.cur=k,ee}consumeSpaceForRecord(C){if(C.value[C.cur]!==A)throw new Error("Invalid space at ".concat(C.cur,"."));C.cur+=1}}class O extends V{constructor(){super(...arguments),x(this,"attributes",void 0),x(this,"digested",!1)}extractOneOrMore(C,L,k){const ee=this.consumeOneOrMore(C.attValue,C._cur,L),_e=C.attValue.slice(C._cur,ee),[ke,ft]=k||[];if(typeof ke=="number"&&_e.length<ke)throw new Error("error in length, should be more or equal than ".concat(ke," characters."));if(typeof ft=="number"&&_e.length>ft)throw new Error("error in length, should be less or equal than ".concat(ft," characters."));return C._cur=ee,_e}consumeAttributeSpace(C){if(C.attValue[C._cur]!==A)throw new Error("Invalid space at ".concat(C._cur,"."));C._cur+=1}extract(C,L){if(!C.attValue)throw new Error("Nothing to extract from attValue.");for(var k=arguments.length,ee=new Array(k>2?k-2:0),_e=2;_e<k;_e++)ee[_e-2]=arguments[_e];const ke=L.call(this,C.attValue,C._cur,...ee),ft=C.attValue.slice(C._cur,ke);return C._cur=ke,ft}atEnd(C){if(!C.attValue)throw new Error;return C._cur>=C.attValue.length}peekChar(C){if(!C.attValue)throw new Error;return C.attValue[C._cur]}peek(C,L){if(!C.attValue)throw new Error;for(let k=0;k<L.length;k++)if(L[k]!==C.attValue[C._cur+k])return!1;return!0}parseIceUfrag(C){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(C,I,[4,256])}parseIcePwd(C){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(C,I,[22,256])}parseIceOptions(C){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const L=[];for(;!this.atEnd(C);){L.push(this.extractOneOrMore(C,I));try{this.consumeAttributeSpace(C)}catch(k){if(this.atEnd(C))break;throw k}}this.attributes.iceOptions=L}parseFingerprint(C){const L=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const k=this.extract(C,this.consumeTill);this.attributes.fingerprints.push({hashFunction:L,fingerprint:k})}parseExtmap(C){const L=this.extractOneOrMore(C,d);let k;this.peekChar(C)==="/"&&(this.extract(C,this.consume,"/"),k=this.extract(C,this.consumeToken)),this.consumeAttributeSpace(C);const ee=this.extract(C,this.consumeTill,A),_e=K(K({entry:parseInt(L,10)},k&&{direction:k}),{},{extensionName:ee});this.peekChar(C)===A&&(this.consumeAttributeSpace(C),_e.extensionAttributes=this.extract(C,this.consumeTill)),this.attributes.extmaps.push(_e)}parseSetup(C){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const L=this.extract(C,this.consumeTill);if(L!=="active"&&L!=="passive"&&L!=="actpass"&&L!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=L}}class z extends O{constructor(){super(...arguments),x(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"group":this.parseGroup(C);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"fingerprint":this.parseFingerprint(C);break;case"setup":this.parseSetup(C);break;case"tls-id":this.parseTlsId(C);break;case"identity":this.parseIdentity(C);break;case"extmap":this.parseExtmap(C);break;case"msid-semantic":this.parseMsidSemantic(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(L){throw console.error("parsing session attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),L}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(C){const L=this.extract(C,this.consumeToken),k=[];for(;!this.atEnd(C)&&this.peekChar(C)===A;)this.consumeAttributeSpace(C),k.push(this.extract(C,this.consumeToken));this.attributes.groups.push({semantic:L,identificationTag:k})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(C){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(C,B)}parseIdentity(C){const L=this.extractOneOrMore(C,U),k=[];for(;!this.atEnd(C)&&this.peekChar(C)===A;){this.consumeAttributeSpace(C);const ee=this.extract(C,this.consumeToken);this.extract(C,this.consume,"=");const _e=this.extractOneOrMore(C,ke=>ke!==A&&b(ke));k.push({name:ee,value:_e})}this.attributes.identities.push({assertionValue:L,extensions:k})}parseMsidSemantic(C){this.peekChar(C)===A&&this.consumeAttributeSpace(C);const L={semantic:this.extract(C,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(C)}catch{break}if(this.peekChar(C)==="*"){this.extract(C,this.consume,"*"),L.applyForAll=!0;break}{const k=this.extract(C,this.consumeTill,A);L.identifierList.push(k)}}this.attributes.msidSemantic=L}}class $ extends O{constructor(C){super(),x(this,"attributes",void 0),C.protos.indexOf("RTP")!==-1||C.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"extmap":this.parseExtmap(C);break;case"setup":this.parseSetup(C);break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"candidate":this.parseCandidate(C);break;case"remote-candidate":this.parseRemoteCandidate(C);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(C);break;case"rtpmap":this.parseRtpmap(C);break;case"ptime":this.parsePtime(C);break;case"maxptime":this.parseMaxPtime(C);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(C);break;case"ssrc":this.parseSSRC(C);break;case"fmtp":this.parseFmtp(C);break;case"rtcp-fb":this.parseRtcpFb(C);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(C);break;case"mid":this.parseMid(C);break;case"msid":this.parseMsid(C);break;case"imageattr":this.parseImageAttr(C);break;case"rid":this.parseRid(C);break;case"simulcast":this.parseSimulcast(C);break;case"sctp-port":this.parseSctpPort(C);break;case"max-message-size":this.parseMaxMessageSize(C);break;case"ssrc-group":this.parseSSRCGroup(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(L){throw console.error("parsing media attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),L}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}parseCandidate(C){const L=this.extractOneOrMore(C,I,[1,32]);this.consumeAttributeSpace(C);const k=this.extractOneOrMore(C,d,[1,5]);this.consumeAttributeSpace(C);const ee=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const _e=this.extractOneOrMore(C,d,[1,10]);this.consumeAttributeSpace(C);const ke=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const ft=this.extract(C,this.consumePort);this.consumeAttributeSpace(C),this.extract(C,this.consume,"typ"),this.consumeAttributeSpace(C);const Rt={foundation:L,componentId:k,transport:ee,priority:_e,connectionAddress:ke,port:ft,type:this.extract(C,this.consumeToken),extension:{}};for(this.peek(C," raddr")&&(this.extract(C,this.consume," raddr"),this.consumeAttributeSpace(C),Rt.relAddr=this.extract(C,this.consumeAddress)),this.peek(C," rport")&&(this.extract(C,this.consume," rport"),this.consumeAttributeSpace(C),Rt.relPort=this.extract(C,this.consumePort));this.peekChar(C)===A;){this.consumeAttributeSpace(C);const Gr=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C),Rt.extension[Gr]=this.extractOneOrMore(C,f)}this.attributes.candidates.push(Rt)}parseRemoteCandidate(C){const L=[];for(;;){const k=this.extractOneOrMore(C,d,[1,5]);this.consumeAttributeSpace(C);const ee=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const _e=this.extract(C,this.consumePort);L.push({componentId:k,connectionAddress:ee,port:_e});try{this.consumeAttributeSpace(C)}catch{break}}this.attributes.remoteCandidatesList.push(L)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(C){const L=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const k=this.extract(C,this.consumeTill,"/");this.extract(C,this.consume,"/");const ee={encodingName:k,clockRate:this.extractOneOrMore(C,d)};this.atEnd(C)||this.peekChar(C)!=="/"||(this.extract(C,this.consume,"/"),ee.encodingParameters=parseInt(this.extract(C,this.consumeTill),10));const _e=this.attributes.payloads.find(ke=>ke.payloadType===parseInt(L,10));_e?_e.rtpMap=ee:this.attributes.payloads.push({payloadType:parseInt(L,10),rtpMap:ee,rtcpFeedbacks:[]})}parsePtime(C){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(C,this.consumeTill)}parseMaxPtime(C){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(C,this.consumeTill)}parseDirection(C){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=C.attField}parseSSRC(C){const L=this.extractOneOrMore(C,d);this.consumeAttributeSpace(C);const k=this.extract(C,this.consumeTill,":");let ee;this.peekChar(C)===":"&&(this.extract(C,this.consume,":"),ee=this.extract(C,this.consumeTill));const _e=this.attributes.ssrcs.find(ke=>ke.ssrcId===parseInt(L,10));_e?_e.attributes[k]=ee:this.attributes.ssrcs.push({ssrcId:parseInt(L,10),attributes:{[k]:ee}})}parseFmtp(C){const L=this.extract(C,this.consumeTill,A);this.consumeAttributeSpace(C);const k=this.extract(C,this.consumeTill),ee={};k.split(";").forEach(ke=>{let[ft,Rt]=ke.split("=");ft=as(ft).call(ft);const Gr=typeof Rt=="string"?as(Rt).call(Rt):null;typeof ft=="string"&&ft.length>0&&(ee[ft]=Gr)});const _e=this.attributes.payloads.find(ke=>ke.payloadType===parseInt(L,10));_e?_e.fmtp={parameters:ee}:this.attributes.payloads.push({payloadType:parseInt(L,10),rtcpFeedbacks:[],fmtp:{parameters:ee}})}parseFmtParameters(C){const L={},k=this.extract(C,this.consumeTill,"=");C._cur++;const ee=this.extract(C,this.consumeTill,";");for(L[k]=ee;C.attValue[C._cur]===";";){const _e=this.extract(C,this.consumeTill,"=");C._cur++;const ke=this.extract(C,this.consumeTill,";");L[_e]=ke}return L}parseRtcpFb(C){let L="";L=this.peekChar(C)==="*"?this.extract(C,this.consume,"*"):this.extract(C,this.consumeTill,A),this.consumeAttributeSpace(C);const k=this.extract(C,this.consumeTill,A);let ee;if(k==="trr-int")ee={type:k,interval:this.extract(C,this.consumeTill)};else{const _e={type:k};this.peekChar(C)===A&&(this.consumeAttributeSpace(C),_e.parameter=this.extract(C,this.consumeToken),this.peekChar(C)===A&&(_e.additional=this.extract(C,this.consumeTill))),ee=_e}if(L==="*")this.attributes.rtcpFeedbackWildcards.push(ee);else{const _e=this.attributes.payloads.find(ke=>ke.payloadType===parseInt(L,10));_e?_e.rtcpFeedbacks.push(ee):this.attributes.payloads.push({payloadType:parseInt(L,10),rtcpFeedbacks:[ee]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(C){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const L={port:this.extract(C,this.consumePort)};this.peekChar(C)===A&&(this.consumeAttributeSpace(C),L.netType=this.extractOneOrMore(C,g),this.consumeAttributeSpace(C),L.addressType=this.extractOneOrMore(C,g),this.consumeAttributeSpace(C),L.address=this.extract(C,this.consumeAddress)),this.attributes.rtcp=L}parseMsid(C){const L={id:this.extractOneOrMore(C,g,[1,64])};this.peekChar(C)===A&&(this.consumeAttributeSpace(C),L.appdata=this.extractOneOrMore(C,g,[1,64])),this.attributes.msids.push(L)}parseImageAttr(C){this.attributes.imageattr.push(C.attValue)}parseRid(C){const L=this.extractOneOrMore(C,ee=>E(ee)||d(ee)||ee==="_"||ee==="-");this.consumeAttributeSpace(C);const k={id:L,direction:this.extract(C,this.consumeToken),params:[]};if(this.peekChar(C)===A){if(this.consumeAttributeSpace(C),this.peek(C,"pt=")){this.extract(C,this.consume,"pt=");const ee=[];for(;;){const _e=this.extract(C,this.consumeToken);ee.push(_e);try{this.extract(C,this.consume,",")}catch{break}}k.payloads=ee,this.peekChar(C)===A&&this.extract(C,this.consume,A)}for(;;){const ee=this.extract(C,this.consumeToken);switch(ee){case"depend":{const _e={type:ee,rids:this.extract(C,this.consume,"=").split(",")};k.params.push(_e);break}default:{const _e={type:ee};this.peekChar(C)==="="&&(this.extract(C,this.consume,"="),_e.val=this.extract(C,this.consumeTill,";")),k.params.push(_e)}}try{this.extract(C,this.consume,";")}catch{break}}}this.attributes.rids.push(k)}parseSimulcast(C){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=C.attValue,this.extract(C,this.consumeTill)}parseSctpPort(C){this.attributes.sctpPort=this.extractOneOrMore(C,d,[1,5])}parseMaxMessageSize(C){this.attributes.maxMessageSize=this.extractOneOrMore(C,d,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(C){this.attributes.mid=this.extract(C,this.consumeToken)}parseSSRCGroup(C){const L=this.extract(C,this.consumeToken),k=[];for(;;)try{this.consumeAttributeSpace(C);const ee=this.extract(C,this.consumeInteger);k.push(parseInt(ee,10))}catch{break}this.attributes.ssrcGroups.push({semantic:L,ssrcIds:k})}}function q(j,C,L){return C in j?Object.defineProperty(j,C,{value:L,enumerable:!0,configurable:!0,writable:!0}):j[C]=L,j}class Ue{constructor(){q(this,"eol",a)}print(C,L){let k="";return L&&(this.eol=L),k+=this.printVersion(C.version),k+=this.printOrigin(C.origin),k+=this.printSessionName(C.sessionName),k+=this.printInformation(C.information),k+=this.printUri(C.uri),k+=this.printEmail(C.emails),k+=this.printPhone(C.phones),k+=this.printConnection(C.connection),k+=this.printBandwidth(C.bandwidths),k+=this.printTimeFields(C.timeFields),k+=this.printKey(C.key),k+=this.printSessionAttributes(C.attributes),k+=this.printMediaDescription(C.mediaDescriptions),k}printVersion(C){return"v=".concat(C).concat(this.eol)}printOrigin(C){return"o=".concat(C.username," ").concat(C.sessId," ").concat(C.sessVersion," ").concat(C.nettype," ").concat(C.addrtype," ").concat(C.unicastAddress).concat(this.eol)}printSessionName(C){return C?"s=".concat(C).concat(this.eol):""}printInformation(C){return C?"i=".concat(C).concat(this.eol):""}printUri(C){return C?"u=".concat(C).concat(this.eol):""}printEmail(C){let L="";for(const k of C)L+="e=".concat(k).concat(this.eol);return L}printPhone(C){let L="";for(const k of C)L+="e=".concat(k).concat(this.eol);return L}printConnection(C){return C?"c=".concat(C.nettype," ").concat(C.addrtype," ").concat(C.address).concat(this.eol):""}printBandwidth(C){let L="";for(const k of C)L+="b=".concat(k.bwtype,":").concat(k.bandwidth).concat(this.eol);return L}printTimeFields(C){let L="";for(const k of C){L+="t=".concat(k.time.startTime," ").concat(k.time.startTime).concat(this.eol);for(const ee of k.repeats)L+="r=".concat(ee.repeatInterval," ").concat(ee.typedTimes.join(" ")).concat(this.eol);k.zoneAdjustments&&(L+="z=",L+="z=".concat(k.zoneAdjustments.map(ee=>"".concat(ee.time," ").concat(ee.back?"-":""," ").concat(ee.typedTime)).join(" ")).concat(this.eol),L+=this.eol)}return L}printKey(C){return C?"k=".concat(C).concat(this.eol):""}printAttributes(C){let L="";for(const k of C)L+="a=".concat(k.attField).concat(k.attValue?":".concat(k.attValue):"").concat(this.eol);return L}printMediaDescription(C){let L="";for(const k of C)L+=this.printMedia(k.media),L+=this.printInformation(k.information),L+=this.printConnections(k.connections),L+=this.printBandwidth(k.bandwidths),L+=this.printKey(k.key),L+=this.printMediaAttributes(k);return L}printConnections(C){let L="";for(const k of C)L+=this.printConnection(k);return L}printMedia(C){return"m=".concat(C.mediaType," ").concat(C.port," ").concat(C.protos.join("/")," ").concat(C.fmts.join(" ")).concat(this.eol)}printSessionAttributes(C){return new re(this.eol).print(C)}printMediaAttributes(C){return new Y(this.eol).print(C)}}class fe{constructor(C){q(this,"eol",void 0),this.eol=C}printIceUfrag(C){return C===void 0?"":"a=ice-ufrag:".concat(C).concat(this.eol)}printIcePwd(C){return C===void 0?"":"a=ice-pwd:".concat(C).concat(this.eol)}printIceOptions(C){return C===void 0?"":"a=ice-options:".concat(C.join(A)).concat(this.eol)}printFingerprints(C){return C.length>0?C.map(L=>"a=fingerprint:".concat(L.hashFunction).concat(A).concat(L.fingerprint)).join(this.eol)+this.eol:""}printExtmap(C){return C.map(L=>"a=extmap:".concat(L.entry).concat(L.direction?"/".concat(L.direction):"").concat(A).concat(L.extensionName).concat(L.extensionAttributes?"".concat(A).concat(L.extensionAttributes):"").concat(this.eol)).join("")}printSetup(C){return C===void 0?"":"a=setup:".concat(C).concat(this.eol)}printUnrecognized(C){return C.map(L=>"a=".concat(L.attField).concat(L.attValue?":".concat(L.attValue):"").concat(this.eol)).join("")}}class re extends fe{print(C){let L="";return L+=this.printGroups(C.groups),L+=this.printMsidSemantic(C.msidSemantic),L+=this.printIceLite(C.iceLite),L+=this.printIceUfrag(C.iceUfrag),L+=this.printIcePwd(C.icePwd),L+=this.printIceOptions(C.iceOptions),L+=this.printFingerprints(C.fingerprints),L+=this.printSetup(C.setup),L+=this.printTlsId(C.tlsId),L+=this.printIdentity(C.identities),L+=this.printExtmap(C.extmaps),L+=this.printUnrecognized(C.unrecognized),L}printGroups(C){let L="";return C.length>0&&(L+=C.map(k=>"a=group:".concat(k.semantic).concat(k.identificationTag.map(ee=>"".concat(A).concat(ee)).join("")).concat(this.eol)).join("")),L}printIceLite(C){return C===void 0?"":"a=ice-lite"+this.eol}printTlsId(C){return C?"a=tls-id:".concat(C).concat(this.eol):""}printIdentity(C){return C.length===0?"":C.map(L=>"a=identity:".concat(L.assertionValue).concat(L.extensions.map(k=>"".concat(A).concat(k.name).concat(k.value?"=".concat(k.value):"")))).join(this.eol)+this.eol}printMsidSemantic(C){if(!C)return"";let L="a=msid-semantic:".concat(C.semantic);return C.applyForAll?L+="".concat(A,"*"):C.identifierList.length>0&&(L+=C.identifierList.map(k=>"".concat(A).concat(k))),L+this.eol}}class Y extends fe{print(C){const L=C.attributes;let k="";return k+=this.printRTCP(L.rtcp),k+=this.printIceUfrag(L.iceUfrag),k+=this.printIcePwd(L.icePwd),k+=this.printIceOptions(L.iceOptions),k+=this.printCandidates(L.candidates),k+=this.printRemoteCandidatesList(L.remoteCandidatesList),k+=this.printEndOfCandidates(L.endOfCandidates),k+=this.printFingerprints(L.fingerprints),k+=this.printSetup(L.setup),k+=this.printMid(L.mid),k+=this.printExtmap(L.extmaps),k+=this.printRTPRelated(L),k+=this.printPtime(L.ptime),k+=this.printMaxPtime(L.maxPtime),k+=this.printDirection(L.direction),k+=this.printSSRCGroups(L.ssrcGroups),k+=this.printSSRC(L.ssrcs),k+=this.printRTCPMux(L.rtcpMux),k+=this.printRTCPMuxOnly(L.rtcpMuxOnly),k+=this.printRTCPRsize(L.rtcpRsize),k+=this.printMSId(L.msids),k+=this.printImageattr(L.imageattr),k+=this.printRid(L.rids),k+=this.printSimulcast(L.simulcast),k+=this.printSCTPPort(L.sctpPort),k+=this.printMaxMessageSize(L.maxMessageSize),k+=this.printUnrecognized(L.unrecognized),k}printCandidates(C){return C.map(L=>"a=candidate:".concat(L.foundation).concat(A).concat(L.componentId).concat(A).concat(L.transport).concat(A).concat(L.priority).concat(A).concat(L.connectionAddress).concat(A).concat(L.port).concat(A,"typ").concat(A).concat(L.type).concat(L.relAddr?"".concat(A,"raddr").concat(A).concat(L.relAddr):"").concat(L.relPort?"".concat(A,"rport").concat(A).concat(L.relPort):"").concat(Object.keys(L.extension).map(k=>"".concat(A).concat(k).concat(A).concat(L.extension[k])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(C){return C.map(L=>"a=remote-candidates:".concat(L.join(A)).concat(this.eol)).join("")}printEndOfCandidates(C){return C===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(C){if(!C.payloads)return"";const L=C.payloads;let k="";k+=C.rtcpFeedbackWildcards.map(ee=>this.printRTCPFeedback("*",ee)).join("");for(const ee of L)k+=this.printRtpMap(ee.payloadType,ee.rtpMap),k+=this.printFmtp(ee.payloadType,ee.fmtp),k+=ee.rtcpFeedbacks.map(_e=>this.printRTCPFeedback(ee.payloadType,_e)).join("");return k}printFmtp(C,L){if(!L)return"";const k=Object.keys(L.parameters);return k.length===1&&L.parameters[k[0]]===null?"a=fmtp:".concat(C).concat(A).concat(k[0]).concat(this.eol):"a=fmtp:".concat(C).concat(A).concat(Object.keys(L.parameters).map(ee=>"".concat(ee,"=").concat(L.parameters[ee])).join(";")).concat(this.eol)}printRtpMap(C,L){return L?"a=rtpmap:".concat(C).concat(A).concat(L.encodingName,"/").concat(L.clockRate).concat(L.encodingParameters?"/".concat(L.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(C,L){let k="a=rtcp-fb:".concat(C).concat(A),ee=L;return ee.type==="trr-int"?k+="ttr-int".concat(A).concat(ee.interval):(k+="".concat(ee.type),ee.parameter&&(k+="".concat(A).concat(ee.parameter),ee.additional&&(k+="".concat(A).concat(ee.additional)))),k+this.eol}printPtime(C){return C===void 0?"":"a=ptime:".concat(C).concat(this.eol)}printMaxPtime(C){return C===void 0?"":"a=maxptime:".concat(C).concat(this.eol)}printDirection(C){return C===void 0?"":"a=".concat(C).concat(this.eol)}printSSRC(C){return C.map(L=>Object.keys(L.attributes).map(k=>"a=ssrc:".concat(L.ssrcId.toString(10)).concat(A).concat(k).concat(L.attributes[k]?":".concat(L.attributes[k]):"").concat(this.eol)).join("")).join("")}printRTCPMux(C){return C===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(C){return C===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(C){return C===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(C){if(C===void 0)return"";let L="a=rtcp:".concat(C.port);return C.netType&&(L+="".concat(A).concat(C.netType)),C.addressType&&(L+="".concat(A).concat(C.addressType)),C.address&&(L+="".concat(A).concat(C.address)),L+this.eol}printMSId(C){return C.map(L=>"a=msid:".concat(L.id).concat(L.appdata?"".concat(A).concat(L.appdata):"").concat(this.eol)).join("")}printImageattr(C){return C.map(L=>"a=imageattr:".concat(L).concat(this.eol)).join("")}printRid(C){return C.map(L=>{let k="a=rid:".concat(L.id).concat(A).concat(L.direction);return L.payloads&&(k+="".concat(A,"pt=").concat(L.payloads.join(","))),L.params.length>0&&(k+="".concat(A).concat(L.params.map(ee=>ee.type==="depend"?"depend=".concat(ee.rids.join(",")):"".concat(ee.type,"=").concat(ee.val)).join(";"))),k+this.eol}).join("")}printSimulcast(C){return C===void 0?"":"a=simulcast:".concat(C).concat(this.eol)}printSCTPPort(C){return C===void 0?"":"a=sctp-port:".concat(C).concat(this.eol)}printMaxMessageSize(C){return C===void 0?"":"a=max-message-size:".concat(C).concat(this.eol)}printMid(C){return C===void 0?"":"a=mid:".concat(C).concat(this.eol)}printSSRCGroups(C){return C.map(L=>"a=ssrc-group:".concat(L.semantic).concat(L.ssrcIds.map(k=>"".concat(A).concat(k.toString(10))).join("")).concat(this.eol)).join("")}}function Z(j){return new M().parse(j)}function ae(j,C){return new Ue().print(j,C)}}},e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var s in i)n.o(i,s)&&!n.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:i[s]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();var ri=Bte.exports;function MP(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:G("SVC_MODE");if(G("ENABLE_SVC"))return function(e){return e in IP}(t)?t:IP.L1T3}function $G(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ZG(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$G(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$G(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Cv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:a,filterVideoCodec:A}=e,{useXR:l}=n;let d=[],f=[],p=[],g=[],y=!1,E=!1;if(ri.parse(t).mediaDescriptions.forEach(b=>{r&&r!==b.attributes.direction||(b.media.mediaType!=="video"||y||(f=b.attributes.payloads,g=b.attributes.extmaps,y=!0),b.media.mediaType!=="audio"||E||(d=b.attributes.payloads,p=b.attributes.extmaps,E=!0))}),!g||f.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!p||d.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(f.forEach(b=>{var I;(I=b.rtpMap)!==null&&I!==void 0&&I.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),l&&b.rtcpFeedbacks.push({type:"rrtr"})}),d.forEach(b=>{var I;(I=b.rtpMap)!==null&&I!==void 0&&I.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),l&&b.rtcpFeedbacks.push({type:"rrtr"})}),i&&(d=d.filter(b=>{var I;return((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())!=="rtx"}),f=f.filter(b=>{var I;return((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())!=="rtx"})),s&&(f=f.filter(b=>{var I;return!/(red)|(ulpfec)|(flexfec)/i.test(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName)||"")})),o&&(d=d.filter(b=>{var I;return!/(red)|(ulpfec)|(flexfec)/i.test(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName)||"")})),a&&(a==null?void 0:a.length)>0&&(d=d.filter(b=>{var I;return Se(a).call(a,((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())||"")})),A&&(A==null?void 0:A.length)>0){const b=f.filter(I=>{var B;return Se(A).call(A,((B=I.rtpMap)===null||B===void 0?void 0:B.encodingName.toLowerCase())||"")});f=b.concat(i?[]:E2(b,f))}const w=G("UNSUPPORTED_VIDEO_CODEC");return w&&w.length>0&&(f=f.filter(b=>!(b.rtpMap&&Se(w).call(w,b.rtpMap.encodingName.toLowerCase())))),{audioCodecs:d,videoCodecs:f,audioExtensions:p,videoExtensions:g}}function Rd(t){const e=ri.parse(t);let n,r;for(const i of e.mediaDescriptions){if(!n){const s=i.attributes.iceUfrag,o=i.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:o}}if(!r){const s=i.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&e.attributes.fingerprints.length>0&&(r={fingerprints:e.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function Lte(t,e){const n=[],r=t.attributes.ssrcGroups.filter(o=>o.semantic==="FID"),i=t.attributes.ssrcGroups.find(o=>o.semantic==="SIM"),s=t.attributes.ssrcs;if(i)i.ssrcIds.forEach(o=>{var a;const A=(a=r.find(l=>l.ssrcIds[0]===o))===null||a===void 0?void 0:a.ssrcIds[1];n.push({ssrcId:o,rtx:e?A:void 0})});else if(r.length>0){const o=r[0].ssrcIds[0],a=r[0].ssrcIds[1];n.push({ssrcId:o,rtx:e?a:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function e8(t,e,n){const{cname:r}=t;let i;e?i=Pte(e):(i=t.iceParameters.candidates.map(d=>({foundation:d.foundation,componentId:"1",transport:d.protocol,priority:d.priority.toString(),connectionAddress:d.ip,port:d.port.toString(),type:d.type,extension:{}})),S.debug("Using candidates from gateway."));const s={fingerprints:t.dtlsParameters.fingerprints.map(d=>({hashFunction:d.algorithm,fingerprint:d.fingerprint}))},o={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let a;switch(t.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}const A=vb(t.rtpCapabilities),l=[];return Array.isArray(n)&&n.length>0&&n.forEach(d=>{l.push({kind:Pe.VIDEO,ssrcId:d.v,rtx:d.v_rtx,mslabel:"".concat(d.v,"_").concat(d.a)},{kind:Pe.AUDIO,ssrcId:d.a,mslabel:"".concat(d.v,"_").concat(d.a)})}),{dtlsParameters:s,iceParameters:o,candidates:i,rtpCapabilities:A,setup:a,cname:r,preSSRCs:l}}function Pte(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],S.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),S.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function of(t,e,n){const r=[],i=[];return t.forEach(s=>{let{ssrcId:o,rtx:a}=s;const A=nn(8,"track-"),l={ssrcId:o,attributes:ZG({label:A,mslabel:n=n||nn(10,""),msid:"".concat(n," ").concat(A)},e&&{cname:e})};if(r.push(l),a!==void 0){const d={ssrcId:a,attributes:ZG({label:A,mslabel:n,msid:"".concat(n," ").concat(A)},e&&{cname:e})};r.push(d),i.push({semantic:"FID",ssrcIds:[o,a]})}}),t.length>1&&i.push({semantic:"SIM",ssrcIds:t.map(s=>{let{ssrcId:o}=s;return o})}),{ssrcs:r,ssrcGroups:i}}function xg(t,e){e instanceof kn&&t.attributes.payloads.forEach(n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=e._encoderConfig;s&&i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!Fn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function g2(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function _2(t,e){var n;if(!(e instanceof pn&&e._encoderConfig&&e._hints.indexOf(En.SCREEN_TRACK)===-1))return;const r=e._encoderConfig;bt().supportMinBitrate&&r.bitrateMin&&t.attributes.payloads.forEach(i=>{var s,o;Se(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),bt().supportMinBitrate&&!Se(n=e._hints).call(n,En.LOW_STREAM)&&r.bitrateMax&&t.attributes.payloads.forEach(i=>{var s,o;Se(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(G("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function Ute(t){if(t.media.mediaType!=="video")return;const e=Ct();if(e.name!==xt.SAFARI&&e.os!==Pr.IOS)return;const n=t.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function yb(t,e,n){if(!e)return;let r,i;if(t.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),e.twcc===!0){const s=r.find(o=>o.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s&&(t.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||t.attributes.extmaps.push({entry:s.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(a,A){return A.filter(l=>!!a.find(d=>d.payloadType===l.payloadType&&!!d.rtcpFeedbacks.find(f=>f.type==="transport-cc")))}(i,t.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(A=>A.type==="transport-cc")||a.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(e.twcc===!1){const s=t.attributes.extmaps.findIndex(o=>o.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(o=>{const a=o.rtcpFeedbacks.findIndex(A=>A.type==="transport-cc");a!==-1&&o.rtcpFeedbacks.splice(a,1)})}if(e.remb===!0){const s=r.find(o=>o.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");s&&(t.attributes.extmaps.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||t.attributes.extmaps.push({entry:s.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(a,A){return A.filter(l=>!!a.find(d=>d.payloadType===l.payloadType&&!!d.rtcpFeedbacks.find(f=>f.type==="goog-remb")))}(i,t.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(A=>A.type==="goog-remb")||a.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(e.remb===!1){const s=t.attributes.extmaps.findIndex(o=>o.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(o=>{const a=o.rtcpFeedbacks.findIndex(A=>A.type==="goog-remb");a!==-1&&o.rtcpFeedbacks.splice(a,1)})}}function kte(t,e,n){if(Fn()||t.media.mediaType!=="video"||!(e instanceof pn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!G("SIMULCAST")||n==="vp9"&&G("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,i=t.attributes.ssrcs[0],s=t.attributes.ssrcGroups.find(a=>a.semantic==="FID"&&a.ssrcIds[0]===i.ssrcId),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let a=1;a<r;a++)t.attributes.ssrcs.push({ssrcId:i.ssrcId+a,attributes:ir(i.attributes)}),o.ssrcIds.push(i.ssrcId+a),s&&(t.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+a,attributes:ir(i.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+a,s.ssrcIds[1]+a]}));t.attributes.ssrcGroups.unshift(o)}async function xte(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:s,sendrecv:o}=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=arguments.length>2?arguments[2]:void 0;const d=Cv(l,a,A,"sendonly"),f=Cv(l,a,A,"recvonly"),p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(fc(d,f,"videoExtensions",p,g,y),fc(d,f,"videoCodecs",p,g,y),fc(d,f,"audioExtensions",p,g,y),fc(d,f,"audioCodecs",p,g,y),G("RAISE_H264_BASELINE_PRIORITY")){const E=y.videoCodecs.findIndex(w=>{var b,I;return((b=w.rtpMap)===null||b===void 0?void 0:b.encodingName.toLocaleLowerCase())==="h264"&&((I=w.fmtp)===null||I===void 0?void 0:I.parameters["profile-level-id"])==="42001f"});if(E!==-1){const w=y.videoCodecs.findIndex(b=>{var I;return((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"});if(w<E){S.debug("raising H264 baseline profile priority");const b=y.videoCodecs[E];y.videoCodecs.splice(E,1),y.videoCodecs.splice(w,0,b)}w!==-1&&(g.videoCodecs=g.videoCodecs.filter(b=>{var I,B;return!(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"&&((B=b.fmtp)===null||B===void 0?void 0:B.parameters["profile-level-id"])!=="42001f")})),w!==-1&&G("FILTER_SEND_H264_BASELINE")&&(p.videoCodecs=p.videoCodecs.filter(b=>{var I,B;return!(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"&&((B=b.fmtp)===null||B===void 0?void 0:B.parameters["profile-level-id"])!=="42001f")}))}}return{send:p,recv:g,sendrecv:y}}(t,e,r);try{n.close()}catch{}return{send:i,recv:s,sendrecv:o}}function t8(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=Cv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(fc(t,e,"videoExtensions",n,r,i),fc(t,e,"videoCodecs",n,r,i),fc(t,e,"audioExtensions",n,r,i),fc(t,e,"audioCodecs",n,r,i),G("RAISE_H264_BASELINE_PRIORITY")){const s=i.videoCodecs.findIndex(o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const o=i.videoCodecs.findIndex(a=>a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(o<s){S.debug("raising H264 baseline profile priority");const a=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(o,0,a)}o!==-1&&(r.videoCodecs=r.videoCodecs.filter(a=>!(a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a.fmtp&&a.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function fc(t,e,n,r,i,s){if(n==="videoExtensions"||n==="audioExtensions"){const o=[];return t[n].forEach(a=>{e[n].some((A,l)=>{if(a.entry===A.entry&&a.extensionName===A.extensionName)return o.push(l),!0})?s[n].push(a):r[n].push(a)}),void e[n].forEach((a,A)=>{o.indexOf(A)===-1&&i[n].push(a)})}if(n==="videoCodecs"||n==="audioCodecs"){const o=[];return t[n].forEach(a=>{e[n].some((A,l)=>{if(a.payloadType===A.payloadType&&JSON.stringify(a)===JSON.stringify(A))return o.push(l),!0})?s[n].push(a):r[n].push(a)}),void e[n].forEach((a,A)=>{o.indexOf(A)===-1&&i[n].push(a)})}}function vb(t){const{send:e,recv:n,sendrecv:r}=t;if(!r){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let i,s;return e?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...e.audioCodecs,...r.audioCodecs],i.videoCodecs=[...e.videoCodecs,...r.videoCodecs],i.audioExtensions=[...e.audioExtensions,...r.audioExtensions],i.videoExtensions=[...e.videoExtensions,...r.videoExtensions]):i=r,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...r.audioCodecs],s.videoCodecs=[...n.videoCodecs,...r.videoCodecs],s.audioExtensions=[...n.audioExtensions,...r.audioExtensions],s.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):s=r,{send:i,recv:s}}function Mg(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function Py(t,e,n,r){let i=[];if(t===Pe.VIDEO){if(G("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=e.videoCodecs.filter(s=>{var o;return Se(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===G("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let s=[];const o=[],a=[],A=[];if(n.videoCodecs.forEach(l=>{const d=l.rtpMap&&l.rtpMap.encodingName.toLowerCase()||"";Se(d).call(d,r)?s.push(l):Se(d).call(d,"vp9")?o.push(l):Se(d).call(d,"vp8")?a.push(l):Se(d).call(d,"h264")&&A.push(l)}),s.length===0){let l="";o.length!==0?(s=o,l="vp9"):a.length!==0?(s=a,l="vp8"):A.length!==0&&(s=A,l="h264"),S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(l))}s.length!==0&&(i=e.videoCodecs.filter(l=>s.some(d=>d.payloadType===l.payloadType)))}if(i.length===0&&(S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),i=e.videoCodecs),G("USE_PUB_RTX")||G("USE_SUB_RTX")){const s=E2(i,e.videoCodecs);i=[...i,...s]}}else i=e.audioCodecs.filter(s=>{var o;return Se(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,r)}),i.length===0&&(S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=e.audioCodecs.filter(s=>{var o;return Se(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,"opus")}));return i}function E2(t,e){const n=t.map(r=>r.payloadType.toString());return e.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&Se(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}async function PT(t,e,n){const r=e.toString(),i=Fte(r,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:r});const s=await t.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=Mte(o,n||{}),i==null||i(o||""),await t.setLocalDescription({type:"answer",sdp:o})}function Mte(t,e,n){const r=ri.parse(t),{useXR:i}=e;return r.mediaDescriptions.forEach(s=>{var o;s.attributes.mid&&(Array.isArray(n)&&!Se(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&Mg(s),i&&Se(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach(a=>{a.rtcpFeedbacks.findIndex(A=>A.type==="rrtr")===-1&&a.rtcpFeedbacks.push({type:"rrtr"})})))}),ri.print(r)}function Fte(t,e,n,r){if(G("SDP_LOGGING"))return S.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(r,`
`),t),e==="offer"?i=>{Fte(i,"answer",n==="local"?"remote":"local",r)}:void 0}function OA(t,e){return typeof G(t)===e?G(t):void 0}function n8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ed(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?n8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):n8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const jB=new Map;class X1e extends Ln{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(pi.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(pi.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){S.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){super(),N(this,"store",void 0),N(this,"joinInfo",void 0),N(this,"key",void 0),N(this,"ntpOffset",0),N(this,"signal",void 0),N(this,"role",void 0),N(this,"inChannelInfo",{joinAt:null,duration:0}),N(this,"spec",void 0),N(this,"_state","DISCONNECTED"),N(this,"_statsCollector",void 0),N(this,"_disconnectedReason",void 0),N(this,"isSignalRecover",!1),N(this,"hasChangeBGPAddress",!1),N(this,"trafficStatsInterval",void 0),N(this,"networkQualityInterval",void 0),N(this,"_joinGatewayStartTime",0),N(this,"_signalTimeout",!1),N(this,"_clientRoleOptions",void 0),N(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?new JG(ed(ed({},n),{},{retryConfig:n.websocketRetryConfig}),e):new yBe(ed(ed({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,r){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=jB.get(e.cname);if(s||(s=new Map,jB.set(e.cname,s)),this._isProactiveJoin=!0,s.has(e.uid)){const l=new te(P.UID_CONFLICT);throw Le.joinGateway(e.sid,{lts:i,succ:!1,ec:l.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,l}s.set(e.uid,!0),this.joinInfo=e,this.key=n;let o=0;this.joinGatewayStartTime=i;const a=e.proxyServer;try{S.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const l=e.gatewayAddrs.map(d=>{let{address:f}=d;const[p,g]=f.split(":"),y={host:p,port:g};return e.proxyServer&&(y.proxy=e.proxyServer),y});o=(await this.signal.init(l,r)).uid,S.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(l){var A;throw S.error("[".concat(this.store.clientId,"] User join failed"),l.toString()),Le.joinGateway(e.sid,{lts:i,succ:!1,ec:((A=l.data)===null||A===void 0?void 0:A.desc)||l.code,errorMsg:l.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,s.delete(e.uid),this.signal.close(),l}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),S.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(l=>{S.warning("[".concat(this.store.clientId,"] get traffic stats error"),l.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(pi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(pi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(pi.NETWORK_QUALITY,{uplinkNetworkQuality:z6(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:z6(this._statsCollector.trafficStats.B_dnq)}):this.emit(pi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ft.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==tn.CONNECTED||await function(r,i){return i===1/0?r:we.race([r,gDe(i)])}(this.signal.request(We.LEAVE,void 0,!0),3e3)}catch(r){S.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==Ft.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:G("PUB_EXTEND"),twcc:!!G("PUBLISH_TWCC"),rtx:!!G("USE_PUB_RTX")};try{return(await this.signal.request(We.PUBLISH,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===Ve.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw s}}async publishDataChannel(e,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(We.PUBLISH_DATASTREAM,s,!0)}catch(o){if(r&&o.data&&o.data.code===Ve.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw o}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(We.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(r){S.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await we.all(e.map(n=>this.signal.request(We.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){S.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX")||void 0,extend:G("SUB_EXTEND"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(We.PRE_SUBSCRIBE,i,!0)}catch(s){if(r&&s.data&&s.data.code===Ve.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(e,n,!1);throw s}}async subscribe(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!G("SUBSCRIBE_TWCC"),rtx:!!G("USE_SUB_RTX"),extend:G("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return(await this.signal.request(We.SUBSCRIBE,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===Ve.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw s}}async subscribeDataChannel(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(We.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(r&&s.data&&s.data.code===Ve.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw s}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!G("USE_SUB_RTX"),twcc:!!G("SUBSCRIBE_TWCC"),svc:Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0};try{return await this.signal.request(We.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===Ve.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw i}}async setVideoProfile(e){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,s=r.width,o=r.height,a=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(a=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(a=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,i||(a=!1)),a?{stream_type:0,width:s,height:o,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(e);if(n)return this.signal.request(We.SET_VIDEO_PROFILE,n);S.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(We.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(r){S.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await we.all(e.map(r=>this.signal.request(We.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){S.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(e){try{await this.signal.request(We.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){S.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=e;return{gatewayEstablishParams:await this.signal.request(We.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(We.GATEWAY_INFO)}async renewToken(e){await this.signal.request(We.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=e);let r,i=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request(We.SET_CLIENT_ROLE,{role:e,level:i,delay:r,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(We.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(We.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(We.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(We.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(We.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,r){if(this.signal instanceof JG)return this.signal.sendExtensionMessage(e,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ed({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(We.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=jB.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:mi.username,password:mi.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(ed(ed({},mi),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(We.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&YI(()=>{this.emit(pi.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new te(P.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let r=G("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);const i=!(Fn()||Dee(87)||EK())&&typeof G("ENABLE_PRE_SUB")=="boolean"&&G("ENABLE_PRE_SUB"),s=!EK()&&OA("ENABLE_PREALLOC_PC","boolean"),o=ed({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ba,browser:navigator.userAgent,process_id:G("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:G("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:{enablePublishedUserList:G("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:G("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof G("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?G("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof G("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?G("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof G("ENABLE_USER_LICENSE_CHECK")=="boolean"?G("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:G("USE_PUB_RTX")===!0||G("USE_SUB_RTX")===!0||void 0,disableFEC:G("DISABLE_FEC"),enableNTPReport:!!G("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!G("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!G("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:OA("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!G("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!G("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:OA("USE_XR","boolean"),enableLossbasedBwe:OA("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!G("ENABLE_AUT_CC")||void 0,enableCCFallback:OA("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:s,preSubNum:i?OA("PRE_SUB_NUM","number"):void 0,enablePubTWCC:OA("PUBLISH_TWCC","boolean"),enableSubTWCC:OA("SUBSCRIBE_TWCC","boolean"),enablePubRTX:OA("USE_PUB_RTX","boolean"),enableSubRTX:OA("USE_SUB_RTX","boolean"),enableSubSVC:G("ENABLE_SVC")?G("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(G("SVC"))&&G("SVC").length!==0?G("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,G("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new te(P.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(qe.WS_RECONNECT_WAITTING_FINISH,e=>{var n;Se(n=["tryNext","recover"]).call(n,e)&&this.joinInfo&&Le.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(qe.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(qe.WS_RECONNECTING,e=>{this.joinInfo&&Le.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||_i.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Le.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(qe.WS_CLOSED,e=>{let n;switch(e){case Ft.LEAVE:n=_i.LEAVE;break;case Ft.UID_BANNED:case Ft.IP_BANNED:case Ft.CHANNEL_BANNED:case Ft.SERVER_ERROR:n=_i.SERVER_ERROR;break;case Ft.FALLBACK:n=_i.FALLBACK;break;case Ft.LICENSE_MISSING:case Ft.LICENSE_EXPIRED:case Ft.LICENSE_MINUTES_EXCEEDED:case Ft.LICENSE_PERIOD_INVALID:case Ft.LICENSE_MULTIPLE_SDK_SERVICE:case Ft.LICENSE_ILLEGAL:case Ft.TOKEN_EXPIRE:n=e;break;default:n=_i.NETWORK_ERROR}S.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+_i.NETWORK_ERROR)),this.joinInfo&&Le.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Ft.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==Ft.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(qe.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(S.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Le.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void S.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Wt("EVENT_REPORT_DOMAIN",e[1]),Wt("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Wt("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(ht.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(qe.REQUEST_RECOVER,(e,n,r)=>{if(!this.joinInfo)return r(new te(P.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,vi(this,pi.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(qe.REQUEST_JOIN_INFO,async e=>{var n;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}=await vi(this,pi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});e(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:s,version:"2"}}))}),this.signal.on(qe.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(qe.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let r,i="";var s;e instanceof te?(r=((s=e.data)===null||s===void 0?void 0:s.desc)||e.code,i=e.message):r=e,Le.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(qe.IS_P2P_DISCONNECTED,e=>{e(_v(this,pi.IS_P2P_DISCONNECTED))}),this.signal.on(qe.DISCONNECT_P2P,()=>{this.emit(pi.DISCONNECT_P2P)}),this.signal.on(qe.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(qe.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(qe.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(pi.JOIN_RESPONSE,e,n)}),this.signal.on(qe.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=G("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const r=Pte(e);this.emit(pi.PRE_CONNECT_PC,{candidates:r,fingerprint:n})}}})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(We.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(We.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw S.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(We.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(We.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw S.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(e){const n={users:e.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(We.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(e,n){const r={action:e.find(i=>i.stream_type===kt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(We.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(e,n){const r={action:e.find(i=>i.stream_type===kt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(We.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(e,n){const r={action:e===Pe.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(We.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(e,n){const r={action:e===Pe.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(We.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(We.RESTART_ICE,n,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,_i.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!G("GATEWAY_WSS_ADDRESS"))return G("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(S.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(We.SET_PARAMETER,{enablePublishAudioFilter:e})}}let UT=0,KB=0;function rA(t,e,n,r){return new we((i,s)=>{e.timeout=e.timeout||G("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),UT+=WA(e.data)):n&&(e.data.size?UT+=e.data.size:e.data instanceof FormData?UT+=Hee(e.data):UT+=WA(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Xs.request(e).then(o=>{typeof o.data=="string"?KB+=WA(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?KB+=o.data.byteLength:KB+=WA(JSON.stringify(o.data)),r&&i({data:o.data,headers:o.headers}),i(o.data)}).catch(o=>{Xs.isCancel(o)?s(new te(P.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new te(P.NETWORK_TIMEOUT,o.message)):o.response?s(new te(P.NETWORK_RESPONSE_ERROR,o.response.status)):s(new te(P.NETWORK_ERROR,o.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(Y){var Z=0;return function(){return Z<Y.length?{done:!1,value:Y[Z++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Y,Z,ae){return Y==Array.prototype||Y==Object.prototype||(Y[Z]=ae.value),Y},r,i=function(Y){Y=[typeof globalThis=="object"&&globalThis,Y,typeof window=="object"&&window,typeof self=="object"&&self,typeof $m=="object"&&$m];for(var Z=0;Z<Y.length;++Z){var ae=Y[Z];if(ae&&ae.Math==Math)return ae}throw Error("Cannot find global object")}(this);function s(Y,Z){if(Z)e:{var ae=i;Y=Y.split(".");for(var j=0;j<Y.length-1;j++){var C=Y[j];if(!(C in ae))break e;ae=ae[C]}(Z=Z(j=ae[Y=Y[Y.length-1]]))!=j&&Z!=null&&n(ae,Y,{configurable:!0,writable:!0,value:Z})}}function o(Y){return(Y={next:Y})[Symbol.iterator]=function(){return this},Y}function a(Y){var Z=typeof Symbol<"u"&&Symbol.iterator&&Y[Symbol.iterator];return Z?Z.call(Y):{next:e(Y)}}if(s("Symbol",function(Y){function Z(C,L){this.A=C,n(this,"description",{configurable:!0,writable:!0,value:L})}if(Y)return Y;Z.prototype.toString=function(){return this.A};var ae="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",j=0;return function C(L){if(this instanceof C)throw new TypeError("Symbol is not a constructor");return new Z(ae+(L||"")+"_"+j++,L)}}),s("Symbol.iterator",function(Y){if(Y)return Y;Y=Symbol("Symbol.iterator");for(var Z="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ae=0;ae<Z.length;ae++){var j=i[Z[ae]];typeof j=="function"&&typeof j.prototype[Y]!="function"&&n(j.prototype,Y,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return Y}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var A;e:{var l={};try{l.__proto__={a:!0},A=l.a;break e}catch{}A=!1}r=A?function(Y,Z){if(Y.__proto__=Z,Y.__proto__!==Z)throw new TypeError(Y+" is not extensible");return Y}:null}var d=r;function f(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function p(Y){if(Y.m)throw new TypeError("Generator is already running");Y.m=!0}function g(Y,Z){return Y.h=3,{value:Z}}function y(Y){this.g=new f,this.G=Y}function E(Y,Z,ae,j){try{var C=Z.call(Y.g.j,ae);if(!(C instanceof Object))throw new TypeError("Iterator result "+C+" is not an object");if(!C.done)return Y.g.m=!1,C;var L=C.value}catch(k){return Y.g.j=null,Y.g.s(k),w(Y)}return Y.g.j=null,j.call(Y.g,L),w(Y)}function w(Y){for(;Y.g.h;)try{var Z=Y.G(Y.g);if(Z)return Y.g.m=!1,{value:Z.value,done:!1}}catch(ae){Y.g.v=void 0,Y.g.s(ae)}if(Y.g.m=!1,Y.g.l){if(Z=Y.g.l,Y.g.l=null,Z.F)throw Z.D;return{value:Z.return,done:!0}}return{value:void 0,done:!0}}function b(Y){this.next=function(Z){return Y.o(Z)},this.throw=function(Z){return Y.s(Z)},this.return=function(Z){return function(ae,j){p(ae.g);var C=ae.g.j;return C?E(ae,"return"in C?C.return:function(L){return{value:L,done:!0}},j,ae.g.return):(ae.g.return(j),w(ae))}(Y,Z)},this[Symbol.iterator]=function(){return this}}function I(Y,Z){return Z=new b(new y(Z)),d&&Y.prototype&&d(Z,Y.prototype),Z}if(f.prototype.o=function(Y){this.v=Y},f.prototype.s=function(Y){this.l={D:Y,F:!0},this.h=this.C||this.u},f.prototype.return=function(Y){this.l={return:Y},this.h=this.u},y.prototype.o=function(Y){return p(this.g),this.g.j?E(this,this.g.j.next,Y,this.g.o):(this.g.o(Y),w(this))},y.prototype.s=function(Y){return p(this.g),this.g.j?E(this,this.g.j.throw,Y,this.g.o):(this.g.s(Y),w(this))},s("Array.prototype.entries",function(Y){return Y||function(){return function(Z,ae){Z instanceof String&&(Z+="");var j=0,C=!1,L={next:function(){if(!C&&j<Z.length){var k=j++;return{value:ae(k,Z[k]),done:!1}}return C=!0,{done:!0,value:void 0}}};return L[Symbol.iterator]=function(){return L},L}(this,function(Z,ae){return[Z,ae]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var B=function(Y,Z){for(var ae=0;ae<Y.length;ae++)Z(Y[ae])},U=function(Y){return Y.replace(/\r?\n|\r/g,`\r
`)},H=function(Y,Z,ae){return Z instanceof Blob?(ae=ae!==void 0?ae+"":typeof Z.name=="string"?Z.name:"blob",Z.name===ae&&Object.prototype.toString.call(Z)!=="[object Blob]"||(Z=new File([Z],ae)),[String(Y),Z]):[String(Y),String(Z)]},K=function(Y,Z){if(Y.length<Z)throw new TypeError(Z+" argument required, but only "+Y.length+" present.")},x=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,V=x.FormData,M=x.XMLHttpRequest&&x.XMLHttpRequest.prototype.send,O=x.Request&&x.fetch,z=x.navigator&&x.navigator.sendBeacon,$=x.Element&&x.Element.prototype,q=x.Symbol&&Symbol.toStringTag;q&&(Blob.prototype[q]||(Blob.prototype[q]="Blob"),"File"in x&&!File.prototype[q]&&(File.prototype[q]="File"));try{new File([],"")}catch{x.File=function(Z,ae,j){return Z=new Blob(Z,j||{}),Object.defineProperties(Z,{name:{value:ae},lastModified:{value:+(j&&j.lastModified!==void 0?new Date(j.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),q&&Object.defineProperty(Z,q,{value:"File"}),Z}}var Ue=function(Y){return Y.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},fe=function(Y){this.i=[];var Z=this;Y&&B(Y.elements,function(ae){if(ae.name&&!ae.disabled&&ae.type!=="submit"&&ae.type!=="button"&&!ae.matches("form fieldset[disabled] *"))if(ae.type==="file"){var j=ae.files&&ae.files.length?ae.files:[new File([],"",{type:"application/octet-stream"})];B(j,function(C){Z.append(ae.name,C)})}else ae.type==="select-multiple"||ae.type==="select-one"?B(ae.options,function(C){!C.disabled&&C.selected&&Z.append(ae.name,C.value)}):ae.type==="checkbox"||ae.type==="radio"?ae.checked&&Z.append(ae.name,ae.value):(j=ae.type==="textarea"?U(ae.value):ae.value,Z.append(ae.name,j))})};if((t=fe.prototype).append=function(Y,Z,ae){K(arguments,2),this.i.push(H(Y,Z,ae))},t.delete=function(Y){K(arguments,1);var Z=[];Y=String(Y),B(this.i,function(ae){ae[0]!==Y&&Z.push(ae)}),this.i=Z},t.entries=function Y(){var Z,ae=this;return I(Y,function(j){if(j.h==1&&(Z=0),j.h!=3)return Z<ae.i.length?j=g(j,ae.i[Z]):(j.h=0,j=void 0),j;Z++,j.h=2})},t.forEach=function(Y,Z){K(arguments,1);for(var ae=a(this),j=ae.next();!j.done;j=ae.next()){var C=a(j.value);j=C.next().value,C=C.next().value,Y.call(Z,C,j,this)}},t.get=function(Y){K(arguments,1);var Z=this.i;Y=String(Y);for(var ae=0;ae<Z.length;ae++)if(Z[ae][0]===Y)return Z[ae][1];return null},t.getAll=function(Y){K(arguments,1);var Z=[];return Y=String(Y),B(this.i,function(ae){ae[0]===Y&&Z.push(ae[1])}),Z},t.has=function(Y){K(arguments,1),Y=String(Y);for(var Z=0;Z<this.i.length;Z++)if(this.i[Z][0]===Y)return!0;return!1},t.keys=function Y(){var Z,ae,j,C,L=this;return I(Y,function(k){if(k.h==1&&(Z=a(L),ae=Z.next()),k.h!=3)return ae.done?void(k.h=0):(j=ae.value,C=a(j),g(k,C.next().value));ae=Z.next(),k.h=2})},t.set=function(Y,Z,ae){K(arguments,2),Y=String(Y);var j=[],C=H(Y,Z,ae),L=!0;B(this.i,function(k){k[0]===Y?L&&(L=!j.push(C)):j.push(k)}),L&&j.push(C),this.i=j},t.values=function Y(){var Z,ae,j,C,L=this;return I(Y,function(k){if(k.h==1&&(Z=a(L),ae=Z.next()),k.h!=3)return ae.done?void(k.h=0):(j=ae.value,(C=a(j)).next(),g(k,C.next().value));ae=Z.next(),k.h=2})},fe.prototype._asNative=function(){for(var Y=new V,Z=a(this),ae=Z.next();!ae.done;ae=Z.next()){var j=a(ae.value);ae=j.next().value,j=j.next().value,Y.append(ae,j)}return Y},fe.prototype._blob=function(){var Y="----formdata-polyfill-"+Math.random(),Z=[],ae="--"+Y+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(j,C){return typeof j=="string"?Z.push(ae+Ue(U(C))+`"\r
\r
`+U(j)+`\r
`):Z.push(ae+Ue(U(C))+'"; filename="'+Ue(j.name)+`"\r
Content-Type: `+(j.type||"application/octet-stream")+`\r
\r
`,j,`\r
`)}),Z.push("--"+Y+"--"),new Blob(Z,{type:"multipart/form-data; boundary="+Y})},fe.prototype[Symbol.iterator]=function(){return this.entries()},fe.prototype.toString=function(){return"[object FormData]"},$&&!$.matches&&($.matches=$.matchesSelector||$.mozMatchesSelector||$.msMatchesSelector||$.oMatchesSelector||$.webkitMatchesSelector||function(Y){for(var Z=(Y=(this.document||this.ownerDocument).querySelectorAll(Y)).length;0<=--Z&&Y.item(Z)!==this;);return-1<Z}),q&&(fe.prototype[q]="FormData"),M){var re=x.XMLHttpRequest.prototype.setRequestHeader;x.XMLHttpRequest.prototype.setRequestHeader=function(Y,Z){re.call(this,Y,Z),Y.toLowerCase()==="content-type"&&(this.B=!0)},x.XMLHttpRequest.prototype.send=function(Y){Y instanceof fe?(Y=Y._blob(),this.B||this.setRequestHeader("Content-Type",Y.type),M.call(this,Y)):M.call(this,Y)}}O&&(x.fetch=function(Y,Z){return Z&&Z.body&&Z.body instanceof fe&&(Z.body=Z.body._blob()),O.call(this,Y,Z)}),z&&(x.navigator.sendBeacon=function(Y,Z){return Z instanceof fe&&(Z=Z._asNative()),z.call(this,Y,Z)}),x.FormData=fe}})();const Tv=()=>{const t=G("AREAS");return t.length===0&&t.push(Lt.GLOBAL),Zc(t).call(t,(e,n,r)=>{const i=Vte(n);return i?r===0?i:"".concat(e,",").concat(i):e},"")},Vte=t=>t===Lt.OVERSEA?"".concat(Bi.ASIA,",").concat(Bi.EUROPE,",").concat(Bi.AFRICA,",").concat(Bi.NORTH_AMERICA,",").concat(Bi.SOUTH_AMERICA,",").concat(Bi.OCEANIA):Bi[t],J1e=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const r=eR[n],i=Object.keys(r);i&&i.map(s=>{s!=="CODE"&&(e[s]=e[s].concat(r[s]))})}),e},tS={GLOBAL:{ASIA:[Lt.CHINA,Lt.JAPAN,Lt.INDIA,Lt.KOREA,Lt.HKMC],EUROPE:[],NORTH_AMERICA:[Lt.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},kT=Object.keys(tS[Lt.GLOBAL]),GB=[Lt.CHINA,Lt.NORTH_AMERICA,Lt.EUROPE,Lt.ASIA,Lt.JAPAN,Lt.INDIA,Lt.OCEANIA,Lt.SOUTH_AMERICA,Lt.AFRICA,Lt.KOREA,Lt.HKMC,Lt.US],$1e=function(t,e){let n=[];if(Se(t).call(t,Lt.GLOBAL)){const s=[Lt.GLOBAL,Lt.OVERSEA],o=Object.keys(eR);if(e===Lt.GLOBAL)throw new te(P.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Lt.CHINA)n=[Lt.OVERSEA];else if(i=e,Se(kT).call(kT,i)){const a=(r=e,tS[Lt.GLOBAL][r]||[]),A=[...s,e,...a];n=o.filter(l=>!Se(A).call(A,l))}else if(function(a){let A=!1;return kT.forEach(l=>{var d;Se(d=tS[Lt.GLOBAL][l]).call(d,a)&&(A=!0)}),A}(e)){const a=function(l){let d;return kT.forEach(f=>{var p;Se(p=tS[Lt.GLOBAL][f]).call(p,l)&&(d=f)}),d}(e),A=[...s,a,e];n=o.filter(l=>!Se(A).call(A,l))}else n=t;n=function(a){const A=[];return GB.forEach(l=>{Se(a).call(a,l)&&A.push(l)}),A.concat(a.filter(l=>!Se(GB).call(GB,l)))}(n)}else n=t;var r,i;return n};function r8(t){var e,n;if(!t&&Se(e=G("AREAS")).call(e,Lt.EXTENSIONS))return S.debug("update area from ap : reset"),void y2(IDe,!0);if(!Se(n=G("AREAS")).call(n,Lt.GLOBAL)||!t)return;let r=eR.EXTENSIONS;r&&(r={CODE:Vte(Lt.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},S.debug("update area from ap success: ".concat(t,",config is "),r),Wt("AREAS",[Lt.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?Wt(i,r[i][0]):Wt(i,r[i])}))}function y2(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Le.reportApiInvoke(null,{name:Cr.SET_AREA,options:t,tag:xn.TRACER});try{let r=[];if(typeof t=="string"&&(r=[t]),Array.isArray(t)&&(t.forEach(s=>{if(!Se(V6).call(V6,s))throw new te(P.INVALID_PARAMS,"invalid area code")}),r=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:s,excludedArea:o}=t;if(!s)throw new te(P.INVALID_PARAMS,"area code is needed");let a=s;typeof s=="string"&&(a=[s]),r=o?$1e(a,o):a}if(!e){if(Sd.AREAS){const s=new te(P.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void S.warning("setArea is prohibited because of config-distribute")}if(Se(r).call(r,Lt.GLOBAL)&&G("AREAS")===Lt.EXTENSIONS){const s=new te(P.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void S.warning("setArea is prohibited because of ap extensions")}}Wt("AREAS",r,e);const i=J1e(r);Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Wt(s,i[s][0]):Wt(s,i[s])}),S.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function i8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function FP(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?i8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let WB=1;function Z1e(t,e,n,r,i){WB+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:WB,requestId:WB,version:ba,cname:n.cname},o={service_name:e,json_body:JSON.stringify(s)};let a,A,l=t[0];return nA(async()=>{a=Date.now();const d=await rA(l,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(A=Date.now()-a,d.code!==0){const g=new te(P.UNEXPECTED_RESPONSE,"live streaming ap error, code"+d.code,{retry:!0,responseTime:A});throw S.error(g.toString()),g}const f=JSON.parse(d.json_body);if(f.code!==200){const g=new te(P.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(f.code,", reason: ").concat(f.reason),{code:f.code,responseTime:A});throw S.error(g.toString()),g}if(!f.servers||f.servers.length===0){const g=new te(P.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:f.code,responseTime:A});throw S.error(g.toString()),g}const p=function(g,y){return{addressList:g.servers.map(E=>"wss://".concat(E.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(E.wss,"?serviceName=").concat(encodeURIComponent(y))),workerToken:g.workerToken,vid:g.vid}}(f,e);return G("LIVE_STREAMING_ADDRESS")&&(p.addressList=G("LIVE_STREAMING_ADDRESS")instanceof Array?G("LIVE_STREAMING_ADDRESS"):[G("LIVE_STREAMING_ADDRESS")]),FP(FP({},p),{},{responseTime:A})},(d,f)=>(Le.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(d.addressList),firstSuccess:f===0,responseTime:A,serverIp:t[f%t.length]}),!1),(d,f)=>(Le.apworkerEvent(n.sid,{success:!1,sc:d.data&&d.data.code||200,serviceName:e,responseTime:A,serverIp:t[f%t.length]}),!!(d.code!==P.OPERATION_ABORTED&&d.code!==P.UNEXPECTED_RESPONSE||d.data&&d.data.retry)&&(l=t[(f+1)%t.length],!0)),i)}let zB=1;function s8(t,e,n,r){let{url:i,areaCode:s}=t;const{clientId:o,sid:a}=e,A=Date.now();let l;const[d,f]=w2(e,s,[sr.CHOOSE_SERVER]);let p=or.networkState;return nA(async()=>{p&&or.networkState===bo.OFFLINE&&or.onlineWaiter&&await we.race([or.onlineWaiter,ai(r&&r.maxRetryTimeout||fr.maxRetryTimeout)]),p=or.networkState;const{data:g,headers:y}=await rA(i,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);l=y.http3==="1"?1:-1,Le.reportResourceTiming(i,a),Qte(g,i,e,A,[sr.CHOOSE_SERVER],l);const E=wv(g,sr.CHOOSE_SERVER);return v2(E),A2(E,i)},g=>(g&&Le.joinChooseServer(a,{lts:A,succ:!0,csAddr:i,opid:f,serverList:g.gatewayAddrs.map(y=>y.address),ec:null,cid:g.cid.toString(),uid:g.uid.toString(),csIp:g.csIp,unilbsServerIds:[sr.CHOOSE_SERVER].toString(),isHttp3:l}),!1),g=>g.code!==P.OPERATION_ABORTED&&(g.code===P.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(Le.joinChooseServer(a,{lts:A,succ:!1,csAddr:i,serverList:null,opid:f,ec:g.code,csIp:g.data&&g.data.csIp,unilbsServerIds:[sr.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:p}),isHttp3:l}),S.warning("[".concat(o||"sid-".concat(a.slice(0,6)),"] Choose server network error, retry"),g),!0)),r)}function o8(t,e,n,r){let i,{url:s,areaCode:o,serviceIds:a}=t;const A=Date.now(),[l,d]=w2(e,o,a);let f;return nA(async()=>{f&&or.networkState===bo.OFFLINE&&or.onlineWaiter&&await we.race([or.onlineWaiter,ai(r&&r.maxRetryTimeout||fr.maxRetryTimeout)]),f=or.networkState;const{data:p,headers:g}=await rA(s,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=g.http3==="1"?1:-1,Le.reportResourceTiming(s,e.sid),Qte(p,s,e,A,a,i);const y=wv(p,sr.CHOOSE_SERVER),E=wv(p,e.cloudProxyServer==="proxy5"?sr.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?sr.CLOUD_PROXY:sr.CLOUD_PROXY_FALLBACK);return v2(y),{gatewayInfo:A2(y,s),proxyInfo:E,url:s}},p=>(p.gatewayInfo&&Le.joinChooseServer(e.sid,{lts:A,succ:!0,csAddr:s,serverList:p.gatewayInfo.gatewayAddrs.map(g=>g.address),ec:null,opid:d,cid:p.gatewayInfo.cid.toString(),uid:p.gatewayInfo.uid.toString(),csIp:p.gatewayInfo.csIp,unilbsServerIds:a.toString(),isHttp3:i}),p.proxyInfo&&Le.joinWebProxyAP(e.sid,{lts:A,sucess:1,apServerAddr:s,turnServerAddrList:p.proxyInfo.addresses.map(g=>g.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:a.toString()}),!1),p=>p.code!==P.OPERATION_ABORTED&&(p.code===P.CAN_NOT_GET_GATEWAY_SERVER?p.data.retry:(Le.joinWebProxyAP(e.sid,{lts:A,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:p.code,eventType:e.cloudProxyServer,unilbsServerIds:a.toString(),extend:JSON.stringify({networkState:f})}),S.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),p),!0)),r)}const Qte=(t,e,n,r,i,s)=>{const{sid:o,clientId:a,cloudProxyServer:A}=n,l=[],d=f=>{f.flag===4096?Le.joinChooseServer(o,{lts:r,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:f.error.message,csIp:f.error.data&&f.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s}):f.flag!==1048576&&f.flag!==4194304&&f.flag!==4194310||Le.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:f.error.code,eventType:A,unilbsServerIds:i.toString()})};if(t.response_body.forEach(f=>{const p=f.buffer.code;if(f.uri===23&&p===0&&!f.buffer.edges_services)if(f.buffer.flag===4194310)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),f.buffer.edges_services=[];else{const g={error:new te(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:f.buffer.flag};l.push(g),d(g)}if(p!==0){const g=Pg(p),y={error:new te(P.CAN_NOT_GET_GATEWAY_SERVER,g.desc,{desc:g.desc,retry:g.retry,csIp:t.detail[502]}),flag:f.buffer.flag};f.buffer.flag===4194310?S.warning(y.error.toString()):l.push(y),d(y)}}),l.length)throw S.warning("[".concat(a||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(l.map(f=>"flag: ".concat(f.flag,", message: ").concat(f.error.message,", retry: ").concat(f.error.data.retry)).join(" | "))),new te(P.CAN_NOT_GET_GATEWAY_SERVER,l.map(f=>"flag: ".concat(f.flag,", message: ").concat(f.error.message)).join(" | "),{retry:!!l.find(f=>f.error.data.retry),csIp:t.detail[502],desc:[...new Set(l.map(f=>{var p;return f==null||(p=f.error)===null||p===void 0||(p=p.data)===null||p===void 0?void 0:p.desc}).filter(f=>!!f))]})},v2=t=>{var e,n,r,i;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new te(P.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(G("AP_AREA")&&((r=t.detail)!==null&&r!==void 0&&r[23]&&typeof((i=t.detail)===null||i===void 0?void 0:i[23])=="string"?r8(t.detail[23].toLowerCase()):r8()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const o=t.detail[19],a=o==null?void 0:o.split(";");for(let A=0;A<a.length;A++){var s;const l=as(s=a[A]).call(s);t.addresses[A]&&a&&(t.addresses[A].fingerprint=l)}}if(G("GATEWAY_ADDRESS")&&G("GATEWAY_ADDRESS").length>0){S.debug("assign gateway address to",G("GATEWAY_ADDRESS"));const o=G("GATEWAY_ADDRESS").map(a=>{var A,l;const d=(A=(l=t.addresses.find(f=>f.ip===a.ip&&f.port===a.port))===null||l===void 0?void 0:l.fingerprint)!==null&&A!==void 0?A:"";return{ip:a.ip,port:a.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:d}});t.addresses=o}},eLe=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const r=Pg(n.buffer.code);throw new te(P.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw S.debug("update ticket request received ap response without response body:",e),new te(P.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},w2=(t,e,n)=>{const r=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:r,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:FP({6:t.stringUid,11:e,12:G("USE_NEW_TOKEN")?"1":void 0,22:e},t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};i.request_bodies.forEach(o=>{t.multiIP&&t.multiIP.gateway_ip&&(o.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const s=new FormData;return s.append("request",JSON.stringify(i)),[s,r]},tLe=(t,e)=>{const n=Math.floor(Math.random()*1e12),r={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let sg=0;function __(t){return we.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const Sv=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:s}=t,o=0;const a=e;let A,l=0;const d=async()=>{const f=(()=>{const p=o*a,g=p+a;return n.slice(p,g).map(r)})();s&&s.push(...f);try{A=await __(f)}catch(p){if(l+=a,o++,!(l>=n.length))return void await d();i(p)}f.forEach(p=>p.cancel())};return await d(),A},Hte=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:r}=t;const i=e.length;let s=0;const o=async()=>{const a=n(e.shift());try{return await a}catch(A){if(s++,s>=i||r!=null&&r(A))throw A;return o()}};return o()};async function VP(t,e,n,r){return{gatewayInfo:await async function(s,o,a,A){let l=null;const d=[],f=async()=>{const g=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(w=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Tv()})),y=A.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(w=>w.url)}),E=await Sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:w=>(S.debug("[".concat(s.clientId,"] Connect to choose_server:"),w.url),s8(w,s,o,a)),allFailedhandler:w=>{throw A.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},y),w[0]},promisesCollector:d});return A.recordJoinChannelService({endTs:Date.now(),status:"success"},y),E},p=async()=>{if(await ai(1e3),l!==null)return l;const g=G("WEBCS_DOMAIN_BACKUP_LIST").map(w=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Tv()})),y=A.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(w=>w.url)}),E=await Sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:w=>(S.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),w.url),s8(w,s,o,a)),allFailedhandler:w=>{throw A.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},y),w[0]},promisesCollector:d});return A.recordJoinChannelService({endTs:Date.now(),status:"success"},y),E};try{return l=await __([f(),p()]),d.length&&d.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),l}catch(g){throw g[0]}}(t,e,n,r)}}async function a8(t,e,n,r,i){const s=t.cloudProxyServer;if(s==="disabled"){if(t.useLocalAccessPoint)return await VP(t,e,n,i);if(G("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:p,proxyInfo:g}=await A8(t,e,n,i);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:p};const y=g.map(E=>({turnServerURL:E.address,tcpport:E.tcpport||mi.tcpport,udpport:E.udpport||mi.udpport,username:E.username||mi.username,password:E.password||mi.password,forceturn:!1,security:!0}));if(i.useP2P){var o;const E=(o=t.uid)!==null&&o!==void 0?o:p.uid,w="glb:".concat(E.toString()),b=await TP(w),I=g.map(B=>({turnServerURL:B.address,tcpport:B.tcpport||mi.tcpport,udpport:B.udpport||mi.udpport,username:w,password:b,forceturn:!1,security:!0}));y.push(...I)}return t.turnServer={mode:"manual",servers:y},{gatewayInfo:p}}return await VP(t,e,n,i)}const{proxyInfo:a,gatewayInfo:A}=await A8(t,e,n,i),l={gatewayInfo:A},d=a.map(p=>({turnServerURL:p.address,tcpport:s==="proxy3"?void 0:p.tcpport?p.tcpport:mi.tcpport,udpport:s==="proxy4"?void 0:p.udpport?p.udpport:mi.udpport,username:p.username||mi.username,password:p.password||mi.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(i.useP2P){var f;const p=(f=t.uid)!==null&&f!==void 0?f:A.uid,g="glb:".concat(p.toString()),y=await TP(g),E=a.map(w=>({turnServerURL:w.address,tcpport:s==="proxy3"?void 0:w.tcpport||mi.tcpport,udpport:s==="proxy4"?void 0:w.udpport||mi.udpport,username:g,password:y,forceturn:s!=="proxy4",security:s==="proxy5"}));d.push(...E)}return t.turnServer={mode:"manual",servers:d},S.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(s)),l}async function jte(t,e,n,r,i){const s=G("ACCOUNT_REGISTER").slice(0,G("AJAX_REQUEST_CONCURRENT"));let o=[];o=e.proxyServer?s.map(A=>"https://".concat(e.proxyServer,"/ap/?url=").concat(A+"/api/v1")):s.map(A=>"https://".concat(A,"/api/v1"));const a=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const A=await async function(l,d,f,p,g){const y=Date.now(),E={sid:f.sid,opid:10,appid:f.appId,string_uid:d};let w=l[0];const b=await nA(()=>rA(w+"".concat(w.indexOf("?")===-1?"?":"&","action=stringuid"),{data:E,cancelToken:p,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(I,B)=>{if(I.code===0){if(I.uid<=0||I.uid>=Math.pow(2,32))throw S.error("Invalid Uint Uid ".concat(d," => ").concat(I.uid),I),Le.reqUserAccount(E.sid,{lts:y,success:!1,serverAddr:w,stringUid:E.string_uid,uid:I.uid,errorCode:P.INVALID_UINT_UID_FROM_STRING_UID,extend:E}),new te(P.INVALID_UINT_UID_FROM_STRING_UID);return Le.reqUserAccount(E.sid,{lts:y,success:!0,serverAddr:w,stringUid:E.string_uid,uid:I.uid,errorCode:null,extend:E}),!1}const U=Pg(I.code);return U.retry&&(w=l[(B+1)%l.length]),Le.reqUserAccount(E.sid,{lts:y,success:!1,serverAddr:w,stringUid:E.string_uid,uid:I.uid,errorCode:U.desc,extend:E}),U.retry},(I,B)=>I.code!==P.OPERATION_ABORTED&&(Le.reqUserAccount(E.sid,{lts:y,success:!1,serverAddr:w,stringUid:E.string_uid,uid:null,errorCode:I.code,extend:E}),w=l[(B+1)%l.length],!0),g);if(b.code!==0){const I=Pg(b.code);throw new te(P.UNEXPECTED_RESPONSE,I.desc)}return b}(o,t,e,n,r);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},a),A.uid}catch(A){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[A]},a),A}}async function nLe(t,e,n){const r=G("ACCOUNT_REGISTER");let i=[];i=e.proxyServer?r.map(s=>"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1")):r.map(s=>"https://".concat(s,"/api/v1"));try{return await Hte({referenceList:i,asyncMapHandler:o=>async function(a,A,l,d){const f=Date.now(),p={sid:l.sid,opid:10,appid:l.appId,string_uid:A};try{const g=await rA(a+"".concat(a.indexOf("?")===-1?"?":"&","action=stringuid"),{data:p,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(g.code!==0){const y=Pg(g.code);throw new te(P.UNEXPECTED_RESPONSE,"preload sua error:".concat(y.desc),y)}if(g.uid<=0||g.uid>=Math.pow(2,32))throw new te(P.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:f,url:a,req:p,uid:g.uid,elapse:Date.now()-f}}catch(g){throw g}}(o,t,e,n),closeFn:o=>o.code===P.OPERATION_ABORTED||o.code===P.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(s){throw s}}async function rLe(t,e,n){const r=G("CDS_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(A=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(A+"/api/v1"):"https://".concat(A,"/api/v1?action=config")),i=r.map(A=>function(l,d,f,p){const g=Ct(),y={flag:64,cipher_method:0,features:{device:g.name,system:g.os,system_general:navigator.userAgent,vendor:d.appId,version:ba,cname:d.cname,sid:d.sid,session_id:d.sid,detail:"",proxyServer:d.proxyServer}};return nA(()=>rA(l,{data:y,timeout:1e3,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,E=>E.code!==P.OPERATION_ABORTED,p)}(A,t,e,n));let s=null,o=null,a={};try{s=await __(i)}catch(A){if(A.code===P.OPERATION_ABORTED)throw A;o=A}if(i.forEach(A=>A.cancel()),Le.reportApiInvoke(t.sid,{name:Cr.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{a=function(A){if(!A.test_tags)return{};const l=A.test_tags,d=Object.keys(l),f={};return d.forEach(p=>{var g;const y=as(g=p.slice(4)).call(g),E=JSON.parse(l[p])[1];f[y]=E}),f}(s)}catch{}return a}async function c8(t,e){const n=G("WEBCS_DOMAIN").concat(G("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Tv(),serviceIds:[sr.CHOOSE_SERVER,sr.CLOUD_PROXY_FALLBACK]}));try{return await Hte({referenceList:n,asyncMapHandler:i=>async function(s,o,a){let A,{url:l,areaCode:d,serviceIds:f}=s;const p=Date.now(),[g,y]=w2(o,d,f);let E=or.networkState;try{E&&or.networkState===bo.OFFLINE&&or.onlineWaiter&&await we.race([or.onlineWaiter,ai(fr.maxRetryTimeout)]),E=or.networkState;const{data:w,headers:b}=await rA(l,{data:g,cancelToken:a,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);A=b.http3==="1"?1:-1,(H=>{const K=[];if(H.response_body.forEach(x=>{const V=x.buffer.code;if(x.uri===23&&V===0&&!x.buffer.edges_services)if(x.buffer.flag===4194310)x.buffer.edges_services=[];else{const M={error:new te(P.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:H.detail[502]}),flag:x.buffer.flag};K.push(M)}if(V!==0){const M=Pg(V),O={error:new te(P.CAN_NOT_GET_GATEWAY_SERVER,M.desc,{desc:M.desc,retry:M.retry,csIp:H.detail[502]}),flag:x.buffer.flag};x.buffer.flag===4194310?S.warning(O.error.toString()):K.push(O)}}),K.length)throw new te(P.CAN_NOT_GET_GATEWAY_SERVER,K.map(x=>"flag: ".concat(x.flag,", message: ").concat(x.error.message)).join(" | "),{retry:!!K.find(x=>x.error.data.retry),csIp:H.detail[502],desc:[...new Set(K.map(x=>{var V;return x==null||(V=x.error)===null||V===void 0||(V=V.data)===null||V===void 0?void 0:V.desc}).filter(x=>!!x))]})})(w);const B=wv(w,sr.CHOOSE_SERVER),U=wv(w,sr.CLOUD_PROXY_FALLBACK);return v2(B),{gatewayInfo:A2(B,l),proxyInfo:U,opid:y,requestTime:p,url:l,isHttp3:A,elapse:Date.now()-p}}catch(w){throw w}}(i,t,e),closeFn:i=>i.code===P.OPERATION_ABORTED||i.code===P.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function A8(t,e,n,r){const i=G("PROXY_SERVER_TYPE3"),s=(g,y,E)=>{let w=E||i;return Array.isArray(w)&&(w=y%2==0?i[1]:i[0]),"https://".concat(w,"/ap/?url=").concat(g)};let o=null;const a=[],A=async()=>{const g=G("WEBCS_DOMAIN").slice(0,G("AJAX_REQUEST_CONCURRENT")).map((w,b)=>{let I;return I=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(w,"/api/v2/transpond/webrtc?v=2"),b,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):s("".concat(w,"/api/v2/transpond/webrtc?v=2"),b),{url:I,areaCode:Tv(),serviceIds:[sr.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?sr.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?sr.CLOUD_PROXY:sr.CLOUD_PROXY_FALLBACK]}}),y=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(w=>w.url)}),E=await Sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:w=>(S.debug("[".concat(t.clientId,"] Connect to choose_server:"),w.url),o8(w,t,e,n)),allFailedhandler:w=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},y),w[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},y),E},l=async()=>{if(await ai(1e3),o!==null)return o;const g=G("WEBCS_DOMAIN_BACKUP_LIST").map((w,b)=>{let I;return I=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(w,"/api/v2/transpond/webrtc?v=2"),b,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):s("".concat(w,"/api/v2/transpond/webrtc?v=2"),b),{url:I,areaCode:Tv(),serviceIds:[sr.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?sr.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?sr.CLOUD_PROXY:sr.CLOUD_PROXY_FALLBACK]}}),y=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(w=>w.url)}),E=await Sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:w=>(S.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),w.url),o8(w,t,e,n)),allFailedhandler:w=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},y),w[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},y),E};let d,f,p;try{({gatewayInfo:d,proxyInfo:f,url:p}=await __([A(),l()]))}catch(g){throw g[0]}if(a.length&&a.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),!d||!f)throw new te(P.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=p,t.cloudProxyServer!=="disabled"&&Array.isArray(i)&&p){const g=/^https?:\/\/(.+?)(\/.*)?$/.exec(p)[1];Se(i).call(i,g)&&(t.proxyServer=g,S.setProxyServer(g),Le.setProxyServer(g))}return o={gatewayInfo:d,proxyInfo:await Zee(f,d.uid)},o}async function iLe(t,e,n){const r=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(s=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),i=r.map(s=>function(o,a,A,l){const d={command:"convergeAllocateEdge",sid:a.sid,appId:a.appId,token:a.token,ts:Date.now(),version:ba,cname:a.cname,uid:a.uid.toString(),requestId:zB,seq:zB};zB+=1;const f={service_name:"tele_channel",json_body:JSON.stringify(d)};return nA(async()=>{const p=await rA(o,{data:f,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(p.code!==0){const y=new te(P.UNEXPECTED_RESPONSE,"cross channel ap error, code"+p.code,{retry:!0});throw S.error(y.toString()),y}const g=JSON.parse(p.json_body);if(g.code!==200){const y=new te(P.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(g.code,", reason: ").concat(g.reason));throw S.error(y.toString()),y}if(!g.servers||g.servers.length===0){const y=new te(P.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw S.error(y.toString()),y}return{vid:g.vid,workerToken:g.workerToken,addressList:(G("CHANNEL_MEDIA_RELAY_SERVERS")||g.servers).map(y=>"wss://".concat(y.address.replace(/\./g,"-"),".").concat(G("WORKER_DOMAIN"),":").concat(y.wss))}},void 0,p=>!!(p.code!==P.OPERATION_ABORTED&&p.code!==P.UNEXPECTED_RESPONSE||p.data&&p.data.retry),l)}(s,t,e,n));try{const s=await __(i);return i.forEach(o=>o.cancel()),s}catch(s){throw s[0]}}async function sLe(t,e,n){let r=null;const i=[],s=async o=>{const a=G(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(A=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(A+"/api/v2/transpond/webrtc?v=2"):"https://".concat(A,"/api/v2/transpond/webrtc?v=2"));return o&&(await ai(1e3),r!==null)?r:await Sv({fragementLength:G("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:A=>(S.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),A),function(l,d,f,p){const[g]=tLe(d,[sr.CHOOSE_SERVER]);let y=or.networkState;return nA(async()=>{y&&or.networkState===bo.OFFLINE&&or.onlineWaiter&&await we.race([or.onlineWaiter,ai(p&&p.maxRetryTimeout||fr.maxRetryTimeout)]),y=or.networkState;const E=await rA(l,{data:g,cancelToken:f,headers:{"Content-Type":"multipart/form-data;"}},!0);return eLe(E,l)},()=>!1,E=>E.code!==P.OPERATION_ABORTED&&(E.code===P.UPDATE_TICKET_FAILED?E.data.retry:(S.warning("[".concat(d.clientId,"] update ticket network error, retry"),E),!0)),p)}(A,t,e,n)),allFailedhandler:A=>{throw A[0]},promisesCollector:i})};try{return r=await __([s(!1),s(!0)]),i.length&&i.forEach(o=>o.cancel&&typeof o.cancel=="function"&&o.cancel()),r}catch(o){throw o[0]}}function l8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function u8(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?l8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class oLe extends Ln{get isSuccess(){return!!this.configs}constructor(){super(),N(this,"configs",void 0),N(this,"joinInfo",void 0),N(this,"cancelToken",void 0),N(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),N(this,"interval",void 0),N(this,"mutex",new xi("config-distribute")),N(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),G("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},G("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Le.reportApiInvoke(null,{options:void 0,name:Cr.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:xn.TRACER}).onSuccess(JSON.stringify(Sd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void S.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await rLe(this.joinInfo,this.cancelToken,this.retryConfig),S.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(r){const i=new te(P.NETWORK_RESPONSE_ERROR,r);S.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var n;(n=e)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(OP.UPDATE_BITRATE_LIMIT,e):this.emit(OP.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&u8({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var n;const r=_w(n=Object.keys(e).filter(s=>/^webrtc_ng_global_parameter/.test(s))).call(n);for(let s=0;s<r.length;s++)for(let o=r.length-1;o>s;o--){const a=r[o];if(typeof e[a].__priority=="number"){const A=e[a].__priority,l=r[o-1];if(typeof e[l].__priority=="number"){if(!(A>e[l].__priority))continue;{const d=a;r[o]=r[o-1],r[o-1]=d}}else{const d=a;r[o]=r[o-1],r[o-1]=d}}}const i={};r.forEach(s=>{const o=e[s],a=o.__expires;Object.keys(o).forEach(A=>{A==="__priority"||A==="__expires"||Object.prototype.hasOwnProperty.call(i,A)||(i[A]=u8({value:o[A]},a&&{expires:a}))})});try{(function(a){try{const A=Date.now();Object.keys(a).forEach(l=>{switch(l){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(Jn,l)){const{value:d,expires:f}=a[l];if(f&&f<=A)return;Sd[l]=d,Jn[l]=d,S.debug("Update global parameters from config distribute",l,d)}}})}catch(A){S.error("Error update config immediately: ".concat(a),A.message)}})(i);const s=JSON.stringify(i),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),S.debug("Caching global parameters ".concat(s))}catch(s){S.error("Error caching global parameters:",s.message)}}}class aLe extends Ln{constructor(){super(...arguments),N(this,"resultStorage",new Map)}setLocalAudioStats(e,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(e,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(r))}setRemoteAudioStats(e,n){const r=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const r=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(e,n,r){if(G("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(e);if(i&&(i.result.push(r),i.result.length>=5)){var s;const o=Se(s=i.result).call(s,!0);i.isPrevNormal&&!o&&this.emit("exception",d8[e],e,n),!i.isPrevNormal&&o&&this.emit("exception",d8[e]+2e3,e+"_RECOVER",n),i.isPrevNormal=o,i.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof wr&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=Oo(n._encoderConfig.frameRate));const i=e.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof wr&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const d8={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},ki=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function C2(t,e){this.v=t,this.k=e}function Bt(t){return new C2(t,0)}var cLe=Y$,ALe=ul;sn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=ALe.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var lLe=ul,uLe=h_;sn({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=lLe.f(this),n=uLe(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var QP=Zn(cLe),Kte=f_.f("asyncIterator"),dLe=Zn(Kte);function ey(t){var e,n;function r(s,o){try{var a=t[s](o),A=a.value,l=A instanceof C2;QP.resolve(l?A.v:A).then(function(d){if(l){var f=s==="return"?"return":"next";if(!A.k||d.done)return r(f,d);d=t[f](d).value}i(a.done?"return":"normal",d)},function(d){r("throw",d)})}catch(d){i("throw",d)}}function i(s,o){switch(s){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):n=null}this._invoke=function(s,o){return new QP(function(a,A){var l={key:s,arg:o,resolve:a,reject:A,next:null};n?n=n.next=l:(e=n=l,r(s,o))})},typeof t.return!="function"&&(this.return=void 0)}function Xc(t){return function(){return new ey(t.apply(this,arguments))}}ey.prototype[typeof Um=="function"&&dLe||"@@asyncIterator"]=function(){return this},ey.prototype.next=function(t){return this._invoke("next",t)},ey.prototype.throw=function(t){return this._invoke("throw",t)},ey.prototype.return=function(t){return this._invoke("return",t)};var h8=Zn(tA.Object.getOwnPropertySymbols),hLe=sn,fLe=wx.indexOf,pLe=BI,HP=lv([].indexOf),f8=!!HP&&1/HP([1],1,-0)<0;hLe({target:"Array",proto:!0,forced:f8||!pLe("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return f8?HP(this,t,e)||0:fLe(this,t,e)}});var mLe=Cc("Array").indexOf,gLe=Bs,_Le=mLe,qB=Array.prototype,ELe=function(t){var e=t.indexOf;return t===qB||gLe(qB,t)&&e===qB.indexOf?_Le:e},p8=Zn(ELe);function yLe(t,e){if(t==null)return{};var n,r,i=function(o,a){if(o==null)return{};var A,l,d={},f=zee(o);for(l=0;l<f.length;l++)A=f[l],p8(a).call(a,A)>=0||(d[A]=o[A]);return d}(t,e);if(h8){var s=h8(t);for(r=0;r<s.length;r++)n=s[r],p8(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function Ac(t){if(Array.isArray(t))return t.map(n=>n);if(!m8(t))return t;const e={};for(const n in t){const r=t[n];m8(r)||Array.isArray(r)?e[n]=Ac(r):e[n]=r}return e}function m8(t){return!(typeof t!="object"||Array.isArray(t)||!t)}class YB{constructor(e){N(this,"input",[]),N(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const rl={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},bv={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:rl,remoteCandidate:rl}},Gte={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},Wte={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},zte={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},qte={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function g8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function _8(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?g8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):g8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class T2{constructor(e,n){N(this,"onFirstVideoReceived",void 0),N(this,"onFirstVideoDecoded",void 0),N(this,"onFirstAudioReceived",void 0),N(this,"onFirstVideoDecodedTimeout",void 0),N(this,"onFirstAudioDecoded",void 0),N(this,"onSelectedLocalCandidateChanged",void 0),N(this,"onSelectedRemoteCandidateChanged",void 0),N(this,"videoIsReady",!1),N(this,"videoIsReady2",{}),N(this,"pc",void 0),N(this,"options",void 0),N(this,"intervalTimer",void 0),N(this,"stats",Ac(bv)),N(this,"isFirstVideoReceived",{}),N(this,"isFirstVideoDecoded",{}),N(this,"isFirstAudioReceived",{}),N(this,"isFirstAudioDecoded",{}),N(this,"isFirstVideoDecodedTimeout",{}),N(this,"lossRateWindowStats",[]),this.pc=e,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new we(e=>{e({local:_8({},rl),remote:_8({},rl)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,n){this.videoIsReady2[e]=n}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,s=0,o=0,a=0;for(const A of r)e[A].forEach((l,d)=>{if(!this.lossRateWindowStats[n-1][A][d]||!this.lossRateWindowStats[0][A][d])return;const f=this.lossRateWindowStats[n-1][A][d].packets-this.lossRateWindowStats[0][A][d].packets,p=this.lossRateWindowStats[n-1][A][d].packetsLost-this.lossRateWindowStats[0][A][d].packetsLost;A==="videoSend"||A==="audioSend"?(i+=f,o+=p):(s+=f,a+=p),Number.isNaN(f)||Number.isNaN(f)?l.packetLostRate=0:l.packetLostRate=f<=0||p<=0?0:p/(f+p)});e.sendPacketLossRate=i<=0||o<=0?0:o/(i+o),e.recvPacketLossRate=s<=0||a<=0?0:a/(s+a)}}function E8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function vLe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?E8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):E8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class wLe extends T2{constructor(){super(...arguments),N(this,"_stats",bv),N(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),n=this.statsResponsesToObjects(e);this._stats=Ac(bv);const r=n.filter(s=>s.type==="ssrc");this.processSSRCStats(r);const i=n.find(s=>s.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(n=>{var r;const i=Se(r=n.id).call(r,"send");switch("".concat(n.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const s=Ac(Wte);s.codec=n.googCodecName,s.adaptionChangeReason="none",n.googCpuLimitedResolution&&(s.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(s.adaptionChangeReason="bandwidth"),s.avgEncodeMs=Number(n.googAvgEncodeMs),s.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},s.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},s.firsCount=Number(n.googFirReceived),s.nacksCount=Number(n.googNacksReceived),s.plisCount=Number(n.googPlisReceived),s.frameCount=Number(n.framesEncoded),s.bytes=Number(n.bytesSent),s.packets=Number(n.packetsSent),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(s),this._stats.rtt=s.rttMs;break}case"video_recv":{const s=Ac(Gte),o=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(s.codec=n.googCodecName,s.targetDelayMs=Number(n.googTargetDelayMs),s.renderDelayMs=Number(n.googRenderDelayMs),s.currentDelayMs=Number(n.googCurrentDelayMs),s.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),s.decodeMs=Number(n.googDecodeMs),s.maxDecodeMs=Number(n.googMaxDecodeMs),s.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},s.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},s.decodeFrameRate=Number(n.googFrameRateDecoded),s.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},s.jitterBufferMs=Number(n.googJitterBufferMs),s.firsCount=Number(n.googFirsSent),s.nacksCount=Number(n.googNacksSent),s.plisCount=Number(n.googPlisSent),s.framesDecodeCount=Number(n.framesDecoded),s.bytes=Number(n.bytesReceived),s.packets=Number(n.packetsReceived),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,s.decodedFrame.width,s.decodedFrame.height),this.isFirstVideoDecoded[s.ssrc]=!0),o){const a=o.stats,A=Date.now()-o.lts;s.framesDecodeFreezeTime=a.framesDecodeFreezeTime,s.framesDecodeInterval=a.framesDecodeInterval,s.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(o.lts=Date.now(),s.framesDecodeInterval=A,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):s.framesDecodeCount<o.stats.framesDecodeCount&&(s.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:vLe({},s),lts:Date.now()}),this._stats.videoRecv.push(s);break}case"audio_recv":{const s=Ac(qte);s.codec=n.googCodecName,s.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,s.decodingCNG=Number(n.googDecodingCNG),s.decodingCTN=Number(n.googDecodingCTN),s.decodingCTSG=Number(n.googDecodingCTSG),s.decodingNormal=Number(n.googDecodingNormal),s.decodingPLC=Number(n.googDecodingPLC),s.decodingPLCCNG=Number(n.googDecodingPLCCNG),s.expandRate=Number(n.googExpandRate),s.accelerateRate=Number(n.googAccelerateRate),s.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),s.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),s.speechExpandRate=Number(n.googSpeechExpandRate),s.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),s.jitterBufferMs=Number(n.googJitterBufferMs),s.jitterMs=Number(n.googJitterReceived),s.bytes=Number(n.bytesReceived),s.packets=Number(n.packetsReceived),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),s.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.decodingNormal>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),this._stats.audioRecv.push(s);break}case"audio_send":{const s=Ac(zte);s.codec=n.googCodecName,s.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,s.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),s.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),s.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),s.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),s.bytes=Number(n.bytesSent),s.packets=Number(n.packetsSent),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.rttMs=Number(n.googRtt||0),this._stats.rtt=s.rttMs,this._stats.audioSend.push(s);break}}})}_getStats(){return new we((e,n)=>{this.pc.getStats(e,n)})}statsResponsesToObjects(e){const n=[];return e.result().forEach(r=>{const i={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(s=>{i[s]=r.stat(s)}),n.push(i)}),n}}function y8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function qh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?y8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class v8 extends T2{constructor(){super(...arguments),N(this,"_stats",bv),N(this,"report",void 0),N(this,"lastDecodeVideoReceiverStats",new Map),N(this,"lastVideoFramesRecv",new Map),N(this,"lastVideoFramesSent",new Map),N(this,"lastVideoFramesDecode",new Map),N(this,"lastVideoFramesOutput",new Map),N(this,"lastVideoJBDelay",new Map),N(this,"lastAudioJBDelay",new Map),N(this,"mediaBytesSent",new Map),N(this,"mediaBytesRetransmit",new Map),N(this,"mediaBytesTargetEncode",new Map),N(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ac(bv),this.report.forEach(e=>{switch(e.type){case Mo.OUTBOUND:case Mo.INBOUND:{const n=e.mediaType||e.kind,r=!n&&"frameWidth"in e,i=!n&&!("frameWidth"in e);e.type===Mo.OUTBOUND?n==="audio"||i?this.processAudioOutboundStats(e):(n==="video"||r)&&this.processVideoOutboundStats(e):e.type===Mo.INBOUND&&(n==="audio"||i?this.processAudioInboundStats(e):(n==="video"||r)&&this.processVideoInboundStats(e));break}case Mo.TRANSPORT:{const n=this.report.get(e.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case Mo.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),n={local:qh({},rl),remote:qh({},rl)};return e.forEach(r=>{let i;if(r.type===Mo.TRANSPORT&&(i=e.get(r.selectedCandidatePairId)),r.type===Mo.CANDIDATE_PAIR&&r.selected&&(i=r),i){const s=(o,a)=>{o.type=a.type,o.id=a.id,a.address&&(o.address=a.address),a.candidateType&&(o.candidateType=a.candidateType),a.port&&(o.port=a.port),a.priority&&(o.priority=a.priority),a.protocol&&(o.protocol=a.protocol),a.relayProtocol&&(o.relayProtocol=a.relayProtocol)};if(i.localCandidateId){const o=e.get(i.localCandidateId);o&&s(n.local,o)}if(i.remoteCandidateId){const o=e.get(i.remoteCandidateId);o&&s(n.remote,o)}}}),n}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const n=this.report.get(e.localCandidateId);n&&this.processCandidateStats(n)}if(e.remoteCandidateId){const n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(e){let n;e.type===Mo.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),e.type===Mo.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=e.type,n.id=e.id,e.address&&(n.address=e.address),e.candidateType&&(n.candidateType=e.candidateType),e.port&&(n.port=e.port),e.priority&&(n.priority=e.priority),e.protocol&&(n.protocol=e.protocol),e.relayProtocol&&(n.relayProtocol=e.relayProtocol),e.type===Mo.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(qh({},n),qh({},this.stats.selectedCandidatePair.localCandidate)),e.type===Mo.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(qh({},n),qh({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let n=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);n||(n=Ac(qte),this._stats.audioRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.packetsDiscarded=e.packetsDiscarded,n.bytes=e.bytesReceived,n.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),n.receivedFrames||(n.receivedFrames=e.packetsReceived),n.droppedFrames||(n.droppedFrames=e.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof e.concealedSamples=="number"&&(n.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let n=this._stats.videoRecv.find(a=>a.ssrc===e.ssrc);n||(n=Ac(Gte),this._stats.videoRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.framesDecodeCount=e.framesDecoded,n.framesDroppedCount=e.framesDropped,n.totalInterFrameDelay=e.totalInterFrameDelay,n.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,n.totalFreezesDuration=e.totalFreezesDuration;const r=this.lastDecodeVideoReceiverStats.get(n.ssrc),i=this.lastVideoFramesDecode.get(n.ssrc),s=this.lastVideoFramesOutput.get(n.ssrc),o=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const a=n.decodedFrame?n.decodedFrame.width:0,A=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,a,A),this.isFirstVideoDecoded[n.ssrc]=!0}if(r){const a=r.stats,A=o-r.lts;n.framesDecodeFreezeTime=a.framesDecodeFreezeTime,n.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&A>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(r.lts=Date.now(),n.framesDecodeInterval=A,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):n.framesDecodeCount<a.framesDecodeCount&&(n.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?n.qpSumPerFrame=e.qpSum/e.framesDecoded:n.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}i&&o-i.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:o,rate:n.decodeFrameRate})):i?n.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:o,rate:0}),n.framesDroppedCount&&e.framesReceived&&(s&&o-s.lts>=800?(n.outputFrameRate=Math.round((e.framesReceived-n.framesDroppedCount-s.count)/((o-s.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:o,rate:Math.max(n.outputFrameRate,0)})):s?n.outputFrameRate=s.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:o,rate:0})),e.totalDecodeTime&&(n.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(n.framesRateFirefox=e.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:qh({},n),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let n=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);n||(n=Ac(Wte),this._stats.videoSend.push(n));const r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{const i=new YB(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const s=new YB(10);s.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,s)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const s=new YB(10);s.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,s)}}if(n.ssrc=e.ssrc,n.bytes=e.bytesSent,n.packets=e.packetsSent,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.frameCount=e.framesEncoded,n.adaptionChangeReason=e.qualityLimitationReason,n.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)n.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const s=e.framesEncoded-i.lastFrameCount,o=e.totalEncodeTime-i.lastEncoderTime;n.avgEncodeMs=1e3*o/s}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?n.qpSumPerFrame=e.qpSum/e.framesEncoded:n.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,n),this.processVideoTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const i=this.findRemoteStatsId(e.ssrc,Mo.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}processAudioOutboundStats(e){let n=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(n||(n=Ac(zte),this._stats.audioSend.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsSent,n.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const r=this.findRemoteStatsId(e.ssrc,Mo.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,n)}}findRemoteStatsId(e,n){var r;const i=Array.from(au(r=this.report).call(r)).find(s=>s.type===n&&s.ssrc===e);return i?i.id:null}processVideoMediaSource(e,n){const r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(n.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,n){const r=this.report.get(e);r&&(n.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,n,r){var i,s,o,a;const A=n?this.report.get(n):void 0,l=(i=A==null?void 0:A.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof l!="number")return;let d=(s=A==null?void 0:A.frameWidth)!==null&&s!==void 0?s:e.frameWidth,f=(o=A==null?void 0:A.frameHeight)!==null&&o!==void 0?o:e.frameHeight,p=(a=A==null?void 0:A.framesPerSecond)!==null&&a!==void 0?a:e.framesPerSecond;if(typeof d=="number"&&typeof f=="number"||(d=0,f=0),p==null){const g=Date.now(),y=this.lastVideoFramesSent.get(r.ssrc);y&&g-y.lts>=800?(p=Math.round((l-y.count)/((g-y.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:l,lts:g,rate:p})):y?p=y.rate:this.lastVideoFramesSent.set(r.ssrc,{count:l,lts:g,rate:0})}r.sentFrame={width:d,height:f,frameRate:Math.max(0,p)}}processVideoTrackReceiverStats(e,n,r){var i,s,o,a,A;const l=n?this.report.get(n):void 0,d=(i=l==null?void 0:l.framesReceived)!==null&&i!==void 0?i:e.framesReceived,f=(s=l==null?void 0:l.frameWidth)!==null&&s!==void 0?s:e.frameWidth,p=(o=l==null?void 0:l.frameHeight)!==null&&o!==void 0?o:e.frameHeight,g=(a=l==null?void 0:l.jitterBufferDelay)!==null&&a!==void 0?a:e.jitterBufferDelay,y=(A=l==null?void 0:l.jitterBufferEmittedCount)!==null&&A!==void 0?A:e.jitterBufferEmittedCount;if(typeof d=="number"){const E=this.lastVideoFramesRecv.get(r.ssrc),w=Date.now();r.framesReceivedCount=d;let b=0;E&&w-E.lts>=800?(b=Math.round((d-E.count)/((w-E.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:d,lts:w,rate:b})):E?b=E.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:d,lts:w,rate:0}),r.receivedFrame={width:f||0,height:p||0,frameRate:b||0},r.decodedFrame={width:f||0,height:p||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:f||0,height:p||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(g&&y){const E=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let w=E.jitterBufferMs;const b=y-E.jitterBufferEmittedCount;b>0&&(w=1e3*(g-E.jitterBufferDelay)/b),r.jitterBufferMs=w,r.currentDelayMs=Math.round(w),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:g,jitterBufferEmittedCount:y,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,n,r){var i,s,o,a;const A=n?this.report.get(n):void 0,l=(i=(s=A==null?void 0:A.echoReturnLoss)!==null&&s!==void 0?s:e.echoReturnLoss)!==null&&i!==void 0?i:0,d=(o=(a=A==null?void 0:A.echoReturnLossEnhancement)!==null&&a!==void 0?a:e.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;r.aecReturnLoss=l,r.aecReturnLossEnhancement=d}processAudioTrackReceiverStats(e,n,r){var i,s,o,a,A,l,d;const f=n?this.report.get(n):void 0,p=(i=f==null?void 0:f.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,g=(s=f==null?void 0:f.totalSamplesReceived)!==null&&s!==void 0?s:e.totalSamplesReceived,y=(o=f==null?void 0:f.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,E=(a=f==null?void 0:f.jitterBufferEmittedCount)!==null&&a!==void 0?a:e.jitterBufferEmittedCount,w=(A=f==null?void 0:f.audioLevel)!==null&&A!==void 0?A:e==null?void 0:e.audioLevel,b=(l=f==null?void 0:f.totalSamplesDuration)!==null&&l!==void 0?l:e==null?void 0:e.totalSamplesDuration,I=(d=f==null?void 0:f.concealedSamples)!==null&&d!==void 0?d:e.concealedSamples;if(p&&g&&(r.accelerateRate=p/g),y&&E){const U=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let H=U.jitterBufferMs;const K=E-U.jitterBufferEmittedCount;K>0&&(H=1e3*(y-U.jitterBufferDelay)/K),r.jitterBufferMs=Math.round(H),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:y,jitterBufferEmittedCount:E,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=w;let B=1920;b&&g&&(B=g/b/50,r.receivedFrames=Math.round(g/B)),I&&(r.droppedFrames=Math.round(I/B))}processRemoteInboundStats(e,n){const r=this.report.get(e);r&&(n.packetsLost=r.packetsLost,r.roundTripTime&&(n.rttMs=1e3*r.roundTripTime),r.jitter&&(n.jitterMs=1e3*r.jitter),r.timestamp&&(n.timestamp=r.timestamp))}getCodecFromCodecStats(e){const n=this.report.get(e);if(!n)return"";const r=n.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,n=null,r=null;this.mediaBytesSent.forEach(s=>{e+=s.diffMean()}),this.mediaBytesRetransmit.forEach(s=>{n=n===null?s.diffMean():n+s.diffMean()}),this.mediaBytesTargetEncode.forEach(s=>{r=r===null?s.diffMean():r+s.diffMean()});const i=n!==null?e-n:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}}class CLe extends T2{updateStats(){return we.resolve()}}function S2(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null}();return s?s<76?new wLe(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new v8(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(o){if(!window.RTCStatsReport)return!1;const a=o.getStats();return!!(a instanceof we||function(A){return!!A&&(typeof A=="object"||typeof A=="function")&&typeof A.then=="function"}(a))}(t)?new v8(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new CLe(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}let w8=class{get localCapabilities(){return ir(this._localCapabilities)}get rtpCapabilities(){return ir(this._rtpCapabilities)}get candidates(){return ir(this._candidates)}get iceParameters(){return ir(this._iceParameters)}get dtlsParameters(){return ir(this._dtlsParameters)}constructor(t){N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_iceParameters",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname","o/i14u9pJrxRKAsu"),N(this,"firefoxSsrcMidMap",new Map),t=ir(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:s,direction:o,setup:a,videoCodec:A,audioCodec:l}=t;let d;this.setup=a,d=o===Ts.RECEIVE_ONLY?ri.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ri.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=s;const f=o===Ts.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,p=o===Ts.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,g=o===Ts.RECEIVE_ONLY?i.send.videoCodecs:Py(Pe.VIDEO,f,p,A),y=o===Ts.RECEIVE_ONLY?i.send.audioCodecs:Py(Pe.AUDIO,f,p,l);for(const E of d.mediaDescriptions)E.attributes.iceUfrag=e.iceUfrag,E.attributes.icePwd=e.icePwd,E.attributes.fingerprints=n.fingerprints,E.attributes.candidates=r,E.attributes.setup=this.setup,E.media.mediaType==="application"&&(E.attributes.sctpPort="5000"),E.media.mediaType==="video"&&(E.media.fmts=g.map(w=>w.payloadType.toString(10)),E.attributes.payloads=g,E.attributes.extmaps=f.videoExtensions),E.media.mediaType==="audio"&&(E.media.fmts=y.map(w=>w.payloadType.toString(10)),E.attributes.payloads=y,E.attributes.extmaps=f.audioExtensions,Mg(E));this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}toString(){return ri.print(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:o}=of(e,this.cname,G("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(s);if(a){if(Fn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const A=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const A=this.findAvailableMediaIndex(t,s,r);let l;return A===-1?(l=this.createOrRecycleSendMedia(t,s,o,"sendonly",r,i),this.updateBundleMids()):(l=ir(this.sessionDesc.mediaDescriptions[A]),l.attributes.direction="sendonly",l.attributes.ssrcs=s,l.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(l,i)),Fn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),{needExchangeSDP:!0,mid:l.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const r=[];return t.forEach(i=>{const s=i._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s);let a,A=!1;o===-1?(A=!0,a=this.createOrRecycleRecvMedia(i,[],"recvonly",e,n),this.updateBundleMids()):(a=ir(this.sessionDesc.mediaDescriptions[o]),a.attributes.direction="recvonly"),r.push({mid:a.attributes.mid,needCreateTransceiver:A})}),r}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:r,port:i,type:s,relatedAddress:o,relatedPort:a,priority:A}=new RTCIceCandidate(t),l={foundation:e??"",componentId:"1",transport:n??"",priority:A?A+"":"",connectionAddress:r??"",port:i?i+"":"",type:s?s+"":"",relAddr:o??"",relPort:a?a+"":"",extension:{}};this.candidates.some(d=>d.priority===l.priority&&d.connectionAddress===l.connectionAddress&&d.port===l.port)||(this._candidates.push(l),this.sessionDesc.mediaDescriptions.forEach(d=>{d.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,r,i){const s=t._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,a=Py(s,o,this.localCapabilities.send,s===Pe.AUDIO?i:r),A=s===Pe.VIDEO?o.videoExtensions:o.audioExtensions,l="".concat(++this.currentMidIndex);let d={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(p=>p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungRecvMediaDsec(d,t);const f=this.findFirstClosedMedia(s);if(f){const p=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[p]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Se(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Se(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Fn()){if(i){const s=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=ir(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,r,i,s){const o=this.rtpCapabilities.send,a=t===Pe.VIDEO?o.videoCodecs:o.audioCodecs,A=t===Pe.VIDEO?o.videoExtensions:o.audioExtensions;Fn()&&(i="".concat(++this.currentMidIndex));let l={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(f=>f.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};l=this.mungSendMediaDesc(l,s);const d=this.findFirstClosedMedia(t);if(d){const f=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[f]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}mungRecvMediaDsec(t,e,n){const r=ir(t);return g2(r),xg(r,e),_2(r,e),Ute(r),yb(r,n,this.localCapabilities.send),r}mungSendMediaDesc(t,e){const n=ir(t);return yb(n,e,this.localCapabilities.recv),Mg(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===t);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>Fn()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const TLe=["sdp"];var cn;function C8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function td(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?C8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):C8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let T8=(cn=class Im extends Yee{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,r){super(e,n),N(this,"direction",void 0),N(this,"name",void 0),N(this,"store",void 0),N(this,"spec",void 0),N(this,"peerConnection",void 0),N(this,"initialOffer",void 0),N(this,"transport",void 0),N(this,"statsFilter",void 0),N(this,"localCandidateCount",0),N(this,"_isInRestartIce",!1),N(this,"mutex",new xi("P2PConnection-mutex")),N(this,"onLocalCandidate",void 0),N(this,"remoteSDP",void 0),N(this,"pendingCandidates",[]),N(this,"localCapabilities",void 0),N(this,"isReady",!1),N(this,"restartCnt",0),N(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.peerConnection=new RTCPeerConnection(Im.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??Ts.SEND_ONLY,this.name=this.direction===Ts.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=S2(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,Fn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await xte();if(this.localCapabilities=vb(n),e){const{sdp:r}=e,i=yLe(e,TLe),s=function(){const d={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},f=Cv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},y={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(fc(f,d,"videoExtensions",p,g,y),fc(f,d,"videoCodecs",p,g,y),fc(f,d,"audioExtensions",p,g,y),fc(f,d,"audioCodecs",p,g,y),G("RAISE_H264_BASELINE_PRIORITY")){const E=y.videoCodecs.findIndex(w=>w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&w.fmtp&&w.fmtp.parameters["profile-level-id"]==="42001f");if(E!==-1){const w=y.videoCodecs.findIndex(b=>b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(w<E){S.debug("raising H264 baseline profile priority");const b=y.videoCodecs[E];y.videoCodecs.splice(E,1),y.videoCodecs.splice(w,0,b)}w!==-1&&G("FILTER_SEND_H264_BASELINE")&&(p.videoCodecs=p.videoCodecs.filter(b=>!(b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&b.fmtp&&b.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:p,recv:g,sendrecv:y}}({},{},r);this.remoteSDP=new w8({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const a=Rd(o.sdp);await this.peerConnection.setLocalDescription(o);const A=await t8({},{},o.sdp);this.localCapabilities=vb(A);const l=this.peerConnection.getTransceivers()[0];return l!=null&&l.receiver&&l.receiver.transport&&this.tryBindTransportEvents(l.receiver.transport),td(td({},a),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Rd(r.sdp);return this.initialOffer=r,td(td({},i),{},{sdp:r.sdp})}}catch(n){throw new ie(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=e,s=await t8({},{},n);this.remoteSDP=new w8({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new ie(P.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,r){var i=this;return Xc(function*(){const s=yield Bt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],a=i.remoteSDP.receive(e,n,r);e.forEach((w,b)=>{if(a[b].needCreateTransceiver){const I=i.peerConnection.addTransceiver(w._mediaStreamTrack,{direction:"sendonly"});o.push(I),w._updateRtpTransceiver(I)}else{const I=i.peerConnection.getTransceivers().find(B=>B.mid===a[b].mid);if(!I)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a[b].mid));o.push(I),w._updateRtpTransceiver(I)}}),Fn()&&G("SIMULCAST")===!0&&(yield Bt(i.applySimulcastForFirefox(o,e)));const A=a.map(w=>w.mid),l=yield Bt(i.peerConnection.createOffer()),d=i.mungSendOfferSDP(l.sdp,e,A),f=ri.parse(d),p=A.map(w=>{const b=f.mediaDescriptions.find(I=>I.attributes.mid===w);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return Lte(b,G("USE_PUB_RTX"))}),g=o.map((w,b)=>{const I=A[b];return{localSSRC:p[b],id:I}});yield Bt(i.peerConnection.setLocalDescription({type:"offer",sdp:d}));try{yield g}catch(w){const b=i.remoteSDP.toString();throw yield Bt(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield Bt(i.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield Bt(i.stopSending(A,!0)),w}yield Bt(i.applySimulcastEncodings(o,e)),yield Bt(i.applySendEncodings(o,e));const y=i.remoteSDP.toString(),E=i.logSDPExchange(d,"offer","local","send");return E==null||E(y),yield Bt(i.setRemoteDescription({type:"answer",sdp:y})),o.map((w,b)=>{const I=A[b];return{localSSRC:p[b],id:I}})}catch(o){throw o instanceof ie?o:new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async stopSending(e,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(A=>e.indexOf(A.mid)!==-1);if(i.length!==e.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));i.map(A=>{var l;A.direction="inactive",(l=A.stop)===null||l===void 0||l.call(A)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const a=this.remoteSDP.toString();o==null||o(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(e,n,r,i);if(o){const A=this.remoteSDP.toString(),l=this.logSDPExchange(A,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:A});const d=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(d.sdp,s,e);l==null||l(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find(A=>A.mid===s);if(!a||a.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(s){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(e,n,r,i);if(o){const a=this.remoteSDP.toString(),A=this.logSDPExchange(a,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:a});const l=await this.peerConnection.createAnswer(),d=this.mungReceiveAnswerSDP(l.sdp,s,e);A==null||A(d||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:d}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(s){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===ef.Auto&&(this.store.p2pTransport=ef.SdRtn,bt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Im.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,bt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Im.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=Rd(n.sdp);return this.store.descriptionStart(),this.direction===Ts.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===Ts.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=Rd(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o==null||o(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ie(P.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(e,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===e);r.length===1&&(this.isVP8Simulcast(n)?Fn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:td(td({},rl),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:td(td({},rl),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;Se(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var s;return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(qI(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&i.iceServers.push(...Im.turnServerConfigToIceServers(e.turnServer.servers,n,r)),G("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&i.iceServers.push(...Im.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,r)),Se(s=[ef.Relay,ef.SdRtn]).call(s,n)&&(i.iceTransportPolicy="relay"),G("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&bt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),S.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],s=e.filter(a=>a.tcpport);S.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));const o=s.length>r?s[r]:s[0];switch(n){case ef.SdRtn:const a=e.filter(l=>{var d;return Se(d=l.username).call(d,"glb:")&&l.turnServerURL==l.turnServerURL}),A=a.length>r?a[r]:a[0];A&&(i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turn:".concat(Vm(A.turnServerURL),":").concat(A.tcpport,"?transport=udp")}),i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turns:".concat(Vm(A.turnServerURL),":").concat(A.tcpport,"?transport=tcp")}));break;case ef.Relay:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Vm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return i}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var r;e!=null&&e.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,e.state))},e.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const r=e==null?void 0:e.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair();S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var r;if(n||(n=this.peerConnection.getSenders().find(d=>d.track===e._mediaStreamTrack)),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!bt().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(e._encoderConfig){var o;const{bitrateMax:d,frameRate:f,scaleResolutionDownBy:p}=e._encoderConfig;d&&(s.maxBitrate=1e3*d),Se(o=e._hints).call(o,En.LOW_STREAM)&&(f&&(s.maxFramerate=Oo(f)),p&&p>=1&&(s.scaleResolutionDownBy=p))}if(G("DSCP_TYPE")&&rh()){var a;const d=G("DSCP_TYPE");Se(a=["very-low","low","medium","high"]).call(a,d)&&(s.networkPriority=d)}const A=n.getParameters(),l=(r=A.encodings)===null||r===void 0?void 0:r[0];Fn()&&!l&&(i.encodings=[s]),l&&Object.assign(l,s),Object.assign(A,i),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(A.encodings))),await n.setParameters(A)}async applySendEncodings(e,n){try{if(!bt().supportSetRtpSenderParameters||e.length!==n.length)return;for(let r=0;r<e.length;r++){const i=e[r],s=n[r];s instanceof pn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,r){const i=ri.parse(e);return n.forEach((s,o)=>{const a=r[o],A=i.mediaDescriptions.find(l=>l.attributes.mid===a);A&&(xg(A,s),kte(A,s,this.store.codec))}),ri.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let A=0;A<e.length;A++){var r,i,s,o,a;const l=e[A],d=n[A];if(d instanceof pn&&!Se(r=d._hints).call(r,En.LOW_STREAM)&&(i=d._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=d._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=d._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=d._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},p={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:p.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:p.high}];const g=l.sender.getParameters();await l.sender.setParameters(Object.assign(g,f))}}}async applySimulcastEncodings(e,n){if(!Fn()&&e.length===n.length)for(let r=0;r<e.length;r++){const i=n[r];if(i instanceof pn&&this.isVP8Simulcast(i)){const s=e[r],o={},a={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];const A=s.sender.getParameters();await s.sender.setParameters(Object.assign(A,o))}}}isVP8Simulcast(e){var n,r,i,s,o;return!!(e instanceof pn&&G("SIMULCAST")&&this.store.codec==="vp8"&&!Se(n=e._hints).call(n,En.LOW_STREAM)&&(r=e._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=e._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=e._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,n,r,i){if(G("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();i==null||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async o=>{o.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(e);const s=this.remoteSDP.toString();i==null||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var r,i;if(n=(r=n)!==null&&r!==void 0?r:(i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp){var s;const o=(s=ri.parse(n).mediaDescriptions.find(a=>a.attributes.mid===e))===null||s===void 0?void 0:s.attributes.ssrcs;return o==null?void 0:o[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),Se(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,r){const i=ri.parse(e),s=i.mediaDescriptions.find(o=>o.attributes.mid===n);return s&&r===Pe.AUDIO&&s.media.mediaType==="audio"&&Mg(s),ri.print(i)}},Oe(cn.prototype,"establish",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"establish"),cn.prototype),Oe(cn.prototype,"connect",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"connect"),cn.prototype),Oe(cn.prototype,"receive",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"receive"),cn.prototype),Oe(cn.prototype,"mockReceive",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"mockReceive"),cn.prototype),Oe(cn.prototype,"stopReceiving",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"stopReceiving"),cn.prototype),Oe(cn.prototype,"restartICE",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"restartICE"),cn.prototype),Oe(cn.prototype,"close",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"close"),cn.prototype),Oe(cn.prototype,"updateEncoderConfig",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"updateEncoderConfig"),cn.prototype),Oe(cn.prototype,"updateSendParameters",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"updateSendParameters"),cn.prototype),Oe(cn.prototype,"replaceTrack",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"replaceTrack"),cn.prototype),Oe(cn.prototype,"muteLocal",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"muteLocal"),cn.prototype),Oe(cn.prototype,"unmuteLocal",[Za],Object.getOwnPropertyDescriptor(cn.prototype,"unmuteLocal"),cn.prototype),cn);function Za(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(e));try{for(var o=arguments.length,a=new Array(o),A=0;A<o;A++)a[A]=arguments[A];return await r.apply(this,a)}finally{s()}},n}function jP(t,e){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=Oo(e.width),r.height=Oo(e.height);const i=Oo(e.framerate||15);document.body.append(n),document.body.append(r);let s=t._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const o=r.getContext("2d");if(!o)throw new te(P.UNEXPECTED_ERROR,"can not get canvas context");const a=bt(),A=r.captureStream(a.supportRequestFrame?0:i).getVideoTracks()[0];A.canvas||(A.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const d=n.videoWidth,f=n.videoHeight/d,p=r.width*f;Math.abs(p-r.height)>=2&&(S.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(p)),r.height=p)}o.drawImage(n,0,0,r.width,r.height),A.requestFrame&&A.requestFrame(),s!==t._mediaStreamTrack&&(s=t._mediaStreamTrack,n.srcObject=new MediaStream([s]))},r.stopCapture=f2(()=>r.startCapture&&r.startCapture(),i);const l=A.stop;return A.stop=()=>{l.call(A),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),S.debug("clean low stream renderer")},A}var nS=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(nS||{}),Br=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t}(Br||{}),nf=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(nf||{}),Gi=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t}(Gi||{}),rf=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(rf||{}),Yte=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(Yte||{}),ad=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t}(ad||{}),tc=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t}(tc||{}),Xte=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(Xte||{}),va=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t}(va||{});const Ml=1e3,Yh=3;function ot(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function S8(t){const e={[va.CONN_TYPE]:0,[va.RTT]:t.rtt};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[va.CONN_TYPE]=1),n==="tcp"&&(e[va.CONN_TYPE]=3),n==="tls"&&(e[va.CONN_TYPE]=4);break}case"srflx":e[va.CONN_TYPE]=2}return e}function b8(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class Jte extends Ln{constructor(e){super(),N(this,"store",void 0),N(this,"uploadWRTCStatsTimer",void 0),N(this,"uploadOutboundDenoiserStatsTimer",void 0),N(this,"uploadExtStatsTimer",void 0),N(this,"uploadExtUsageStatsTimer",void 0),N(this,"uploadInboundExtStatsTimer",void 0),N(this,"requestStats",void 0),N(this,"requestTransportStats",void 0),N(this,"requestLocalMedia",void 0),N(this,"requestRemoteMedia",void 0),N(this,"requestAllTracks",void 0),N(this,"requestVideoIsReady",void 0),N(this,"requestUploadStats",void 0),N(this,"requestUpload",void 0),N(this,"uploadOutboundStarted",!1),N(this,"uploadInboundStarted",!1),N(this,"uploadTransportStarted",!1),N(this,"uploadExtensionUsageStarted",!1),N(this,"lastRecvStats",void 0),N(this,"lastSendStats",void 0),N(this,"lastFullRecvStats",void 0),N(this,"lastFullSendStats",void 0),N(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let n,r;if(this.uploadTransportStarted&&(n=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!n&&this.uploadOutboundStarted&&(n=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),n||r){const i={};if(this.uploadTransportStarted&&n){const s=this.getTransportStats(n,r,e);s&&(i.misc=[s])}if(this.uploadOutboundStarted&&n){const s=this.getOutboundStats(n,e?this.lastSendStats:this.lastFullSendStats,e);s&&(i.outbound=[s])}if(this.uploadInboundStarted&&r){const s=this.getInboundStats(r,e?this.lastRecvStats:this.lastFullRecvStats,e);s&&(i.inbound=s)}this.requestUploadStats(i)}this.lastRecvStats=r,this.lastSendStats=n,e||(this.lastFullRecvStats=r,this.lastFullSendStats=n)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==Yh),++e===Yh+1&&(e=1)},Ml)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,r){if(!this.requestStats)return;if(r)return e.rtt==null?void 0:{addition:{[va.RTT]:e.rtt,[va.CONN_TYPE]:void 0}};const i=S8(e);if(this.store.useP2P){if(n){const s=S8(n);i[va.CONN_TYPE]+=s[va.CONN_TYPE]<<3}i[va.CONN_TYPE]+=110}else i[va.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(e,n,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i=this.requestLocalMedia();if(!i||i.length===0)return;let s,o,a;return i.forEach(A=>{let[l,{track:d,ssrcs:f}]=A;switch(l){case le.LocalVideoLowTrack:case le.LocalVideoTrack:if(l===le.LocalVideoTrack){const p=function(E,w,b,I,B){const U=w.videoSend.find(O=>O.ssrc===E);if(!U)return;const H={},{sentFrame:K,inputFrame:x}=U;if(x&&K){const O=x.frameRate,z=K.frameRate;H[Br.FREEZE]=function($,q){let Ue=!0;return Ue=!($<=5)&&($<=10?q<3:$<=20?q<4:q<5),Ue}(O,z)?1:0}if(ot(H,Br.QP_SUM,U.qpSumPerFrame),B)return H;switch(K&&(ot(H,Br.HEIGHT,K.height),ot(H,Br.WIDTH,K.width),ot(H,Br.FRAME_RATE,K.frameRate)),H[Br.DISABLED]=I._originMediaStreamTrack&&!I._originMediaStreamTrack.enabled||I._mediaStreamTrack&&!I._mediaStreamTrack.enabled?1:0,U.adaptionChangeReason){case"none":H[Br.ADAPTATION]=0;break;case"cpu":H[Br.ADAPTATION]=1;break;case"bandwidth":H[Br.ADAPTATION]=2;break;case"other":H[Br.ADAPTATION]=3}let V=0;U.adaptionChangeReason&&(V+=b8(U.adaptionChangeReason)),w.qualityLimitationReason&&(V+=b8(w.qualityLimitationReason)<<3),H[Br.ADAPTATION]=V,H[Br.PLAYER_STATUS]=FB[I._player?I._player.videoElementStatus:"uninit"],ot(H,Br.NACKS,U.nacksCount),ot(H,Br.PLIS,U.plisCount),ot(H,Br.FIRS,U.firsCount),ot(H,Br.AVG_ENCODE,U.avgEncodeMs);const M=b&&b.videoSend.find(O=>O.ssrc===E);if(M){let O=B?Ml:Ml*Yh;M.timestamp&&U.timestamp&&(O=U.timestamp-M.timestamp),M.packets!=null&&U.packets!=null&&ot(H,Br.PACKAGE_RATE,1e3*(U.packets-M.packets)/O),U.packetsLost!=null&&M.packetsLost!=null&&ot(H,Br.PACKAGE_LOST,U.packetsLost-M.packetsLost),M.bytes!=null&&U.bytes!=null&&ot(H,Br.BITRATE,8*(U.bytes-M.bytes)/O)}return H}(f[0].ssrcId,e,n,d,r),g=r?null:function(E,w,b){const I=w.videoSend.find(V=>V.ssrc===E);if(!I)return null;const B={},U=I.inputFrame,H=U&&U.height||b&&b.videoHeight||0,K=U&&U.width||b&&b.videoWidth||0,x=U&&U.frameRate||0;return ot(B,nS.HEIGHT,H),ot(B,nS.WIDTH,K),ot(B,nS.FRAME_RATE,x),B}(f[0].ssrcId,e,d),y=r?null:function(E){const w={};return ot(w,Br.RETRANSMIT,E.bitrate.retransmit),ot(w,Br.TARGET_ENCODED,E.bitrate.targetEncoded),ot(w,Br.ACTUAL_ENCODED,E.bitrate.actualEncoded),ot(w,Br.TRANSMIT,E.bitrate.transmit),ot(w,Br.BANDWIDTH,E.sendBandwidth),w}(e);o=Object.assign({},p,g,y)}else a=r?void 0:function(p,g,y){const E=g.videoSend.find(I=>I.ssrc===p);if(!E)return;const w={},b=E.sentFrame;if(b&&(ot(w,nf.HEIGHT,b.height),ot(w,nf.WIDTH,b.width),ot(w,nf.FRAME_RATE,b.frameRate)),y){const I=y.videoSend.find(B=>B.ssrc===p);if(I){let B=Ml*Yh;I.timestamp&&E.timestamp&&(B=E.timestamp-I.timestamp),I.packets!=null&&E.packets!=null&&ot(w,nf.PACKAGE_RATE,1e3*(E.packets-I.packets)/B),E.packetsLost!=null&&I.packetsLost!=null&&ot(w,nf.PACKAGE_LOST,E.packetsLost-I.packetsLost),I.bytes!=null&&E.bytes!=null&&ot(w,nf.BITRATE,8*(E.bytes-I.bytes)/B)}}return w}(f[0].ssrcId,e,n);break;case le.LocalAudioTrack:s=r?void 0:function(p,g,y,E){const w=g.audioSend.find(H=>H.ssrc===p);if(!w)return;const b={};b[ad.DISABLED]=E._originMediaStreamTrack&&!E._originMediaStreamTrack.enabled||E._mediaStreamTrack&&!E._mediaStreamTrack.enabled?1:0;const I=100*E._source.getAccurateVolumeLevel(),B=w.inputLevel;if(B!=null){const H=Math.ceil(50*Math.log10(100*B+1));ot(b,ad.LEVEL,H)}ot(b,Yte.PCM_LEVEL,I),ot(b,ad.AEC_RETURN_LOSS,w.aecReturnLoss),ot(b,ad.AEC_RETURN_LOSS_ENH,w.aecReturnLossEnhancement),b[ad.FREEZE]=0;const U=y&&y.audioSend.find(H=>H.ssrc===p);if(U){let H=Ml*Yh;U.timestamp&&w.timestamp&&(H=w.timestamp-U.timestamp),U.bytes!=null&&w.bytes!=null&&ot(b,ad.BITRATE,8*(w.bytes-U.bytes)/H),U.packets!=null&&w.packets!=null&&ot(b,ad.PACKAGE_RATE,1e3*(w.packets-U.packets)/H)}return b}(f[0].ssrcId,e,n,d)}}),{high:o,low:a,audio:s}}getInboundStats(e,n,r){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],s=[];return i.forEach(o=>{let[a,A]=o;const l={peer:a.uid};if(A.has(Pe.VIDEO)&&a.videoTrack){const d=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,f=a.videoTrack?function(p,g,y,E,w,b,I){var B;const U=g.videoRecv.find(z=>z.ssrc===p);if(!U)return;const H={},{receivedFrame:K,outputFrame:x,decodeFrameRate:V}=U,M=y&&y.videoRecv.find(z=>z.ssrc===p);if(H[Gi.FREEZE]=w&&Iv.isRemoteVideoFreeze(E,U,M)?1:0,ot(H,rf.FRAME_RATE_DECODE,V),ot(H,Gi.QP_SUM,U.qpSumPerFrame),U.framesRateFirefox&&ot(H,Gi.FRAME_RATE,U.framesRateFirefox),K&&ot(H,Gi.FRAME_RATE,K.frameRate),M){const z=g.timestamp-y.timestamp||(I?Ml:Yh*Ml);U.packetsLost!=null&&M.packetsLost!=null&&ot(H,Gi.PACKAGE_LOST,U.packetsLost-M.packetsLost),M.bytes!=null&&U.bytes!=null&&ot(H,Gi.BITRATE,8*(U.bytes-M.bytes)/z),M.packets!=null&&U.packets!=null&&ot(H,Gi.PACKAGE_RATE,1e3*(U.packets-M.packets)/z)}if(I)return H;K?(ot(H,Gi.HEIGHT,K.height),ot(H,Gi.WIDTH,K.width)):E&&(ot(H,Gi.HEIGHT,E._videoHeight||0),ot(H,Gi.WIDTH,E._videoWidth||0)),x&&ot(H,rf.FRAME_RATE_OUTPUT,x.frameRate);const O=(B=E._player)===null||B===void 0?void 0:B.rendFrameRate.toFixed(0);if(O&&ot(H,rf.FRAME_RATE_RENDER,+O),ot(H,Gi.JITTER_BUFFER,U.jitterBufferMs),ot(H,Gi.CURRENT_DELAY,U.currentDelayMs),ot(H,Gi.FIRS,U.firsCount),ot(H,Gi.NACKS,U.nacksCount),ot(H,Gi.PLIS,U.plisCount),E){H[Gi.DISABLED]=E._originMediaStreamTrack.enabled&&E._mediaStreamTrack.enabled?0:1;const z=E._player;if(z){const{freezeTimeCounterList:$,renderFreezeAccTime:q,videoElementStatus:Ue}=z;if($&&$.length>0&&ot(H,rf.FREEZE_TIME,$.splice(0,1)[0]),b&&Wl.visibility==="visible"&&Ue===os.PLAYING&&bt().supportRequestVideoFrameCallback){const fe=Math.min(6e3,q);z.renderFreezeAccTime=Math.max(0,q-fe),ot(H,rf.FREEZE_TIME_RENDER,fe)}if(typeof U.totalFreezesDuration=="number"){const fe=M&&M.totalFreezesDuration?U.totalFreezesDuration-M.totalFreezesDuration:U.totalFreezesDuration;ot(H,rf.FREEZE_DURATION,1e3*fe)}}}if(H[Gi.PLAYER_STATUS]=FB[E._player?E._player.videoElementStatus:"uninit"],M&&U.totalInterFrameDelay!==void 0&&U.totalSquaredInterFrameDelay!==void 0&&M.totalInterFrameDelay!==void 0&&M.totalSquaredInterFrameDelay!==void 0){const z=U.totalInterFrameDelay-M.totalInterFrameDelay,$=U.totalSquaredInterFrameDelay-M.totalSquaredInterFrameDelay,q=U.framesDecodeCount-M.framesDecodeCount,Ue=z/q*1e3,fe=Math.round(1e3*Math.sqrt(($-Math.pow(z,2)/q)/q));!isNaN(fe)&&Ue+fe>Math.max(3*Ue,Ue+150)&&(H[Gi.I_FRAME_DELAY]=fe)}return H}(a._videoSSRC,e,n,a.videoTrack,d===!0,this.needUploadRenderFreezeTime,r):void 0;f&&(l.video=f)}if(A.has(Pe.AUDIO)&&a.audioTrack){const d=a.audioTrack?function(f,p,g,y,E){const w=p.audioRecv.find(M=>M.ssrc===f);if(!w)return;const b={},I=g&&g.audioRecv.find(M=>M.ssrc===f),{receivedFrames:B,droppedFrames:U}=w;var H,K;if(ot(b,tc.JITTER,w.jitterMs),B!=null&&U!=null&&(b[tc.FREEZE]=(K=U,(H=B)===0||100*K/H>20?1:0)),I){const M=p.timestamp-g.timestamp||(E?Ml:Ml*Yh);w.packets!=null&&I.packets!=null&&ot(b,tc.PACKAGE_RATE,1e3*(w.packets-I.packets)/M),I.bytes!=null&&w.bytes!=null&&ot(b,tc.BITRATE,8*(w.bytes-I.bytes)/M),w.packetsLost!=null&&I.packetsLost!=null&&ot(b,tc.PACKAGE_LOST,w.packetsLost-I.packetsLost)}if(E)return b;const x=100*y._source.getAccurateVolumeLevel(),V=w.outputLevel;if(V!=null){const M=Math.ceil(50*Math.log10(100*V+1));ot(b,Xte.LEVEL,M)}if(ot(b,tc.PCM_LEVEL,x),y&&(b[tc.DISABLED]=y._originMediaStreamTrack.enabled&&y._mediaStreamTrack.enabled?0:1),ot(b,tc.JITTER_BUFFER,w.jitterBufferMs),ot(b,tc.CURRENT_DELAY,w.jitterBufferMs),b[tc.PLAYER_STATUS]=FB[Ws.getPlayerState(y.getTrackId())],I){const M=w.concealedSamples-I.concealedSamples;M>0&&ot(b,tc.CONCEALED_SAMPLES,M)}return b}(a._audioSSRC,e,n,a.audioTrack,r):void 0;d&&(l.audio=d)}(l.video||l.audio)&&s.push(l)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,s}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof Eb);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(Ev.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,r]=e;r.has(Pe.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(Pe.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const l of s)!l.muted&&l.enabled&&(i=i.concat(await l.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[l,d]of o)d.has(Pe.VIDEO)&&l.videoTrack&&(i=i.concat(await l.videoTrack.getProcessorUsage())),d.has(Pe.AUDIO)&&l.audioTrack&&(i=i.concat(await l.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(l,d){const f={};for(const{id:E,value:w,level:b,direction:I}of l){var p;const B=(p=d.get(E))!==null&&p!==void 0?p:0,U=w===2?B+G("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:B;var g,y;d.set(E,U),f[E]?(w===2&&(f[E].value=w),b>f[E].level&&(f[E].level=b),I==="remote"&&(f[E].remoteUidCount+=1),f[E].totalTs=(g=d.get(E))!==null&&g!==void 0?g:0):f[E]={value:w,level:b,remoteUidCount:I==="local"?0:1,totalTs:(y=d.get(E))!==null&&y!==void 0?y:0}}return Object.keys(f).map(E=>{const{level:w,value:b,totalTs:I}=f[E];return{id:E,level:w,value:b,totalTs:I}})}(i,e);const a=Date.now(),A=a>n?a:n+1;this.requestUpload&&this.requestUpload(Ev.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:A})},G("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class Ed{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){N(this,"uid",void 0),N(this,"_uintid",void 0),N(this,"_trust_in_room_",!0),N(this,"_trust_audio_enabled_state_",!0),N(this,"_trust_video_enabled_state_",!0),N(this,"_trust_audio_mute_state_",!0),N(this,"_trust_video_mute_state_",!0),N(this,"_audio_muted_",!1),N(this,"_video_muted_",!1),N(this,"_audio_enabled_",!0),N(this,"_video_enabled_",!0),N(this,"_audio_added_",!1),N(this,"_video_added_",!1),N(this,"_is_pre_created",!1),N(this,"_video_pre_subscribed",!1),N(this,"_audio_pre_subscribed",!1),N(this,"_trust_video_stream_added_state_",!0),N(this,"_trust_audio_stream_added_state_",!0),N(this,"_audioTrack",void 0),N(this,"_videoTrack",void 0),N(this,"_dataChannels",[]),N(this,"_audioSSRC",void 0),N(this,"_videoSSRC",void 0),N(this,"_audioOrtc",void 0),N(this,"_videoOrtc",void 0),N(this,"_cname",void 0),N(this,"_rtxSsrcId",void 0),N(this,"_videoMid",void 0),N(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}let Hc=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});function SLe(t,e){var n;let r;switch(e){case le.LocalAudioTrack:r=kt.Audio;break;case le.LocalVideoTrack:r=Se(n=t._hints).call(n,En.SCREEN_TRACK)?kt.Screen:kt.High;break;case le.LocalVideoLowTrack:r=kt.Low}return r}function KP(t){const e=bt();if(t.some(n=>n._bypassWebAudio))throw new ie(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new ie(P.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function XB(t,e){KP(t);const n=new wr;return t.forEach(r=>n.addAudioTrack(r)),n}var I8,R8,O8,N8,D8,B8,L8,P8,U8,k8,x8,vn;function M8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function xT(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?M8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):M8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let Co=(I8=kc(Hc.SEND_ONLY),R8=kc(Hc.SEND_ONLY),O8=kc(),N8=kc(Hc.RECEIVE_ONLY),D8=kc(Hc.RECEIVE_ONLY),B8=kc(Hc.RECEIVE_ONLY),L8=kc(Hc.RECEIVE_ONLY),P8=kc(Hc.RECEIVE_ONLY),U8=kc(Hc.RECEIVE_ONLY),k8=kc(),x8=kc(Hc.RECEIVE_ONLY),vn=class extends Ln{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Ke.StateChange,e,this._state)}constructor(t,e){super(),N(this,"isPlanB",!1),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"sendConnection",void 0),N(this,"recvConnection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"statsCollector",void 0),N(this,"dtlsFailedCount",0),N(this,"sendMutex",new xi("P2PChannel2-send-mutex")),N(this,"recvMutex",new xi("P2PChannel2-recv-mutex")),N(this,"_state",Ut.Disconnected),N(this,"_restartStates",["disconnected","failed"]),N(this,"reconnectInterval",void 0),N(this,"uploadUnplinkStarted",!1),N(this,"uploadDownlinkStarted",!1),N(this,"uplinkStateUploadInterval",void 0),N(this,"downlinkStatsUploadInterval",void 0),N(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Ut.Connected)return void i(new ie(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const A=this.filterTobeMutedTracks(n);if(A.length===0)return void r();const l=A.find(g=>g[0]==="videoLowTrack");l&&l[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(A.map(g=>{let[,{id:y}]=g;return y}));let d=!1;var o,a;n.trackMediaType==="video"?d=!((o=this.localTrackMap.get(le.LocalAudioTrack))===null||o===void 0||!o.track._muted):d=((a=this.localTrackMap.get(le.LocalVideoTrack))===null||a===void 0?void 0:a.id)===void 0;const f=this.createMuteMessage(A);await Jt(this,Ke.RequestMuteLocal,f);const p=n.trackMediaType==="video"?bd.MUTE_LOCAL_VIDEO:bd.MUTE_LOCAL_AUDIO;await Jt(this,Ke.RequestP2PMuteLocal,{action:p,message:f,isMuteAll:d}),r()}catch(A){i(A)}finally{s()}}),N(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Ut.Connected)return void i(new ie(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();await this.sendConnection.unmuteLocal(o.map(l=>{let[,{id:d}]=l;return d}));const a=this.createUnmuteMessage(o),A=n.trackMediaType==="video"?bd.UNMUTE_LOCAL_VIDEO:bd.UNMUTE_LOCAL_AUDIO;await Jt(this,Ke.RequestP2PMuteLocal,{action:A,message:a}),r()}catch(o){i(o)}finally{s()}}),N(this,"handleUpdateVideoEncoder",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const o=this.localTrackMap.get(le.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==Ut.Connected)return void r();const{id:a,track:A}=o;a&&(await this.sendConnection.updateSendParameters(a,A),await this.sendConnection.updateEncoderConfig(a,A),this.emit(Ke.UpdateVideoEncoder,A)),r()}catch(o){i(o)}finally{s()}}),N(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(le.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==Ut.Connected)return void r();const{id:a,track:A}=o;a&&await this.sendConnection.updateSendParameters(a,A),r()}catch(o){i(o)}finally{s()}}),N(this,"handleReplaceTrack",async(n,r,i,s)=>{let o;S.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var a;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:f}]=d;return n===f});if(!this.sendConnection||!l||l[1].id===void 0||this.state!==Ut.Connected)return void r();if(await((a=this.sendConnection)===null||a===void 0?void 0:a.replaceTrack(n,l[1].id)),l[0]===le.LocalVideoTrack&&bt().supportDualStreamEncoding){const d=this.localTrackMap.get(le.LocalVideoLowTrack);if(d){const f=n._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=f,d.track._originMediaStreamTrack=f,await new we((p,g)=>{this.handleReplaceTrack(d.track,p,g,!0)})}}r()}catch(l){i(l)}finally{var A;(A=o)===null||A===void 0||A()}}),N(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),N(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new Jte(t),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},G("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new ie(P.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new ie(P.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new T8(t,this.store,Ts.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(e);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=Ut.New,this.sendConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new T8(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new ie(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ut.Connected}async addRemoteCandidate(t,e){if(e===Ts.RECEIVE_ONLY){if(!this.sendConnection)throw new ie(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new ie(P.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var r=this;return Xc(function*(){const i=yield Bt(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==Ut.Connected){r.throwIfTrackTypeNotMatch(t);const l=t.filter(d=>r.pendingLocalTracks.indexOf(d)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(l))}r.store.pubId=r.store.pubId+1,ki.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(t,e,n);if(s.length===0)return void(yield Bt(r.tryToUnmuteAudio(t)));s.forEach(l=>{let{track:d,type:f}=l;const p=Date.now();r.store.publish(d.getTrackId(),f===le.LocalAudioTrack?"audio":"video",p)}),r.bindLocalTrackEvents(s);const o=yield Bt(r.sendConnection.send(s.map(l=>{let{track:d}=l;return d}),r.store.codec,r.store.audioCodec)),a=(yield Bt(o.next())).value,A=r.createGatewayPublishMessage(s,a);try{yield A}catch(l){throw o.throw(l),(l==null?void 0:l.code)===P.WS_ABORT&&s.forEach(d=>{let{track:f}=d;r.pendingLocalTracks.indexOf(f)===-1&&r.pendingLocalTracks.push(f)}),r.unbindLocalTrackEvents(s),l}yield Bt(o.next()),s.forEach(l=>{let{type:d}=l;r.statsCollector.addLocalStats(d)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,a),s.forEach(l=>{let{track:d,type:f}=l;const p=Date.now();r.store.publish(d.getTrackId(),f===le.LocalAudioTrack?"audio":"video",void 0,p)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Ut.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!Se(t).call(t,i)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[s,{track:o}]=i;return{type:s,track:o}})),e.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Ut.Connected)return n&&n[1].track.close(),r;t.forEach(i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:s,ssrcs:o}]=r;const a={stream_type:SLe(s,i),ssrcs:o};s._muted||!s._enabled?e.push(a):n.push(a)}),e.length>0&&e.forEach(r=>{Jt(this,Ke.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{Jt(this,Ke.RequestUnmuteLocal,[r])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Xc(function*(){throw new ie(P.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await vi(this,Ke.RequestRePublish,this.pendingLocalTracks),this.emit(Ke.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ie(P.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,r){var i;if(!this.recvConnection)throw new ie(P.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(t))!==null&&i!==void 0&&i.has(e))return;const{track:s,mid:o,transceiver:a}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),r);e===Pe.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new ig(s,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),a&&t._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new rg(s,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),a&&t._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(t,t._videoTrack));const A=this.remoteUserMap.get(t);A?A.set(e,o):this.remoteUserMap.set(t,new Map([[e,o]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const l=this.pendingRemoteTracks.findIndex(d=>{let{user:f,kind:p}=d;return f.uid===t.uid&&e===p});l!==-1&&(this.pendingRemoteTracks.splice(l,1),this.emit(Ke.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,r){if(!this.recvConnection)throw new ie(P.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),r)}async unsubscribe(t,e,n){const r=this.pendingRemoteTracks.filter(s=>{let{user:o,kind:a}=s;return e!==void 0?o.uid===t.uid&&e===a:o.uid===t.uid});if(r.forEach(s=>{const o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)}),this.recvConnection||n||r.forEach(s=>{let{kind:o}=s;var a;if(o===Pe.AUDIO)(a=t._audioTrack)===null||a===void 0||a._destroy(),t._audioTrack=void 0;else if(o===Pe.VIDEO){var A;(A=t._videoTrack)===null||A===void 0||A._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(t,e);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(s=>{let[,{id:o}]=s;return o})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(s=>{let[o,{kind:a}]=s;var A,l;if(a===Pe.VIDEO&&o._videoSSRC&&((A=this.recvConnection)===null||A===void 0||A.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),a===Pe.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),n||((l=o._videoTrack)===null||l===void 0||l._destroy(),o._videoTrack=void 0);else if(a===Pe.AUDIO){var d;this.unbindRemoteTrackEvents(o._audioTrack),!n&&((d=o._audioTrack)===null||d===void 0||d._destroy(),o._audioTrack=void 0)}}),i.forEach(s=>{let[,{kind:o}]=s;Jt(this,Ke.RequestP2PMuteRemote,o)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[Pe.VIDEO,Pe.AUDIO].forEach(r=>{n.has(r)?Jt(this,Ke.RequestP2PUnmuteRemote,r):Jt(this,Ke.RequestP2PMuteRemote,r)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new ie(P.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new ie(P.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new ie(P.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new ie(P.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const r=e===Pe.VIDEO?t._videoSSRC:t._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof wr){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==le.LocalAudioTrack}).filter(r=>{let[i]=r;return!(t&&i===le.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(t&&r===le.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(t,e,n,r,i){if(t){const o=this.localTrackMap.get(le.LocalAudioTrack),a=r?this.localTrackMap.get(le.LocalVideoLowTrack):this.localTrackMap.get(le.LocalVideoTrack);Le.publish(this.store.sessionId,{eventElapse:ki.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:o==null?void 0:o.track.getTrackLabel(),videoName:a==null?void 0:a.track.getTrackLabel(),screenshare:(a==null?void 0:a.track._hints.indexOf(En.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find(A=>A instanceof kn),a=r?(s=this.localTrackMap.get(le.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(A=>A instanceof pn);Le.publish(this.store.sessionId,{eventElapse:ki.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:o==null?void 0:o.getTrackLabel(),videoName:a==null?void 0:a.getTrackLabel(),screenshare:(a==null?void 0:a._hints.indexOf(En.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(t,e,n,r){const i=r===Pe.VIDEO?n._videoSSRC:n._audioSSRC;i&&Le.subscribe(this.store.sessionId,{succ:t,ec:e,video:r===Pe.VIDEO,audio:r===Pe.AUDIO,peerid:n.uid,subscribeRequestid:r===Pe.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:ki.measureFromSubscribeStart(this.store.clientId,i)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new xi("P2PChannel2-send-mutex"),this.sendMutex=new xi("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(le.LocalAudioTrack);if((t==null?void 0:t.track)instanceof wr){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Ut.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(le.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(le.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof pn||e&&e.track instanceof kn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(Ko(e=this.remoteUserMap).call(e)).find(r=>r.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(le.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=_w(t).call(t,(n,r)=>n.level-r.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Ut.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:r}]=t;switch(n){case le.LocalVideoTrack:Se(e=r._hints).call(e,En.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case le.LocalAudioTrack:r instanceof wr?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case le.LocalVideoLowTrack:}}),this.emit(Ke.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Ko(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(e,r)}),this.emit(Ke.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((t instanceof Ed?t.uid:t)===r.uid&&e===i)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,r;if(t===Ts.SEND_ONLY){if(!this.sendConnection)throw new ie(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new ie(P.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(e){const i=await r.restartICE(e);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const s=await vi(this,Ke.RequestP2PRestartICE,{direction:Ts.RECEIVE_ONLY,iceParameter:i});await r.restartICE(s),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(le.LocalVideoTrack),n=this.localTrackMap.get(le.LocalAudioTrack),r=t.videoSend.find(g=>{var y;return g.ssrc===(e==null||(y=e.ssrcs)===null||y===void 0?void 0:y[0].ssrcId)}),i=t.audioSend.find(g=>{var y;return g.ssrc===(n==null||(y=n.ssrcs)===null||y===void 0?void 0:y[0].ssrcId)});if(!r||!i)return 1;const s=Sa(this,Ke.NeedSignalRTT),o=r?r.rttMs:void 0,a=i?i.rttMs:void 0,A=o&&a?(o+a)/2:o||a,l=(A&&s?(A+s)/2:A||s)||0,d=100*t.sendPacketLossRate*.7/50+.3*l/1500,f=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,p=e==null?void 0:e.track;if(p&&p._encoderConfig&&p._hints.indexOf(En.SCREEN_TRACK)===-1){const g=p._encoderConfig.bitrateMax,y=t.bitrate.actualEncoded;if(g&&y){const E=(1e3*g-y)/(1e3*g);return Wee[E<.15?0:E<.3?1:E<.45?2:E<.6?3:4][f]}}return f}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=t.audioRecv.find(y=>y.ssrc===i),a=t.videoRecv.find(y=>y.ssrc===s);if(!o&&!a)return void(e+=1);const A=Sa(this,Ke.NeedSignalRTT),l=t.rtt,d=(l&&A?(l+A)/2:l||A)||0,f=o?o.jitterMs:void 0,p=t.recvPacketLossRate;let g=.7*p*100/50+.3*d/1500;f&&(g=.6*p*100/50+.2*d/1500+.2*f/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new we((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const r=[],i=bt(),s=this.getAllTracks();t=Mm(t=t.filter(A=>s.indexOf(A)===-1));let o=!1,a=!1;for(const A of t){if(A instanceof pn&&(this.localTrackMap.has(le.LocalVideoTrack)||o?new ie(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:A,type:le.LocalVideoTrack}),o=!0),e)){const l=this.getLowVideoTrack(A,n);r.push({track:l,type:le.LocalVideoLowTrack})}if(A instanceof kn){const l=this.localTrackMap.get(le.LocalAudioTrack);if(l){if(!(l.track instanceof wr))throw new ie(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(A._bypassWebAudio)throw new ie(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l.track.addAudioTrack(A),this.bindLocalAudioTrackEvents(A,!0)}else if(a){const d=r.find(f=>{let{type:p}=f;return p===le.LocalAudioTrack});if(!(d.track instanceof wr))throw new ie(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(A._bypassWebAudio)throw new ie(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");d.track.addAudioTrack(A)}else{if(!i.webAudioMediaStreamDest||A instanceof wr||A._bypassWebAudio)r.push({track:A,type:le.LocalAudioTrack});else{const d=new wr;d.addAudioTrack(A),r.push({track:d,type:le.LocalAudioTrack})}a=!0}}}return r}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Mm(t=t.filter(r=>n.indexOf(r)!==-1));for(const r of t){if(r instanceof kn){const i=this.localTrackMap.get(le.LocalAudioTrack);if(!i)continue;i.track instanceof wr?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(e.push([le.LocalAudioTrack,i]),i.track.close())):e.push([le.LocalAudioTrack,i])}if(r instanceof pn){const i=this.localTrackMap.get(le.LocalVideoTrack);if(!i)continue;e.push([le.LocalVideoTrack,i]);const s=this.localTrackMap.get(le.LocalVideoLowTrack);s&&e.push([le.LocalVideoLowTrack,s])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:r}=e;switch(r){case le.LocalVideoTrack:n.addListener(be.GET_STATS,this.handleGetLocalVideoStats),n.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof wr?t.trackList.forEach(n=>{n.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(be.GET_STATS,this.handleGetLocalAudioStats),n.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(be.GET_STATS,this.handleGetLocalAudioStats),t.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(be.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:r}]=e;return{track:r,type:n}})),t.forEach(e=>{let{track:n,type:r}=e;switch(r){case le.LocalVideoTrack:n.off(be.GET_STATS,this.handleGetLocalVideoStats),n.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof wr?t.trackList.forEach(e=>{e.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(be.GET_STATS,this.handleGetLocalAudioStats),e.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(be.GET_STATS,this.handleGetLocalAudioStats),t.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof rg&&e.addListener(be.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof ig&&e.addListener(be.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(be.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(Pe.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(Pe.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,r)=>{var i;let s,{track:o,type:a}=n;switch(a){case le.LocalAudioTrack:s=kt.Audio;break;case le.LocalVideoTrack:s=Se(i=o._hints).call(i,En.SCREEN_TRACK)?kt.Screen:kt.High;break;case le.LocalVideoLowTrack:s=kt.Low}return{kind:a===le.LocalAudioTrack?Pe.AUDIO:Pe.VIDEO,stream_type:s,mid:e[r].id,ssrcs:e[r].localSSRC,isMuted:o.muted||!o.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case le.LocalVideoTrack:r=Se(n=s._hints).call(n,En.SCREEN_TRACK)?kt.Screen:kt.High;break;case le.LocalAudioTrack:r=kt.Audio;break;case le.LocalVideoLowTrack:r=kt.Low}return{stream_type:r,ssrcs:o,mid:a}})}assignLocalTracks(t,e){t.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:e[r].id,ssrcs:e[r].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(Ke.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),Se(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await ai(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Le.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:xn.TRACER}).onSuccess(),this.emit(Ke.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const r=Array.from(Ko(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(ng.FIRST_FRAME_DECODED),Le.firstRemoteFrame(this.store.sessionId,$r.FIRST_AUDIO_DECODE,Dn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:ki.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const r=Array.from(Ko(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===e);r&&Le.firstRemoteFrame(this.store.sessionId,$r.FIRST_AUDIO_RECEIVED,Dn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:ki.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,r)=>{this.reportVideoFirstFrameDecoded(e,n,r)},t.onFirstVideoReceived=e=>{var n;const r=Array.from(Ko(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===e);r&&Le.firstRemoteFrame(this.store.sessionId,$r.FIRST_VIDEO_RECEIVED,Dn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:ki.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const r=e.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Ke.ConnectionTypeChange,r),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Id(n))," -> ").concat(JSON.stringify(Id(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Id(n))," -> ").concat(JSON.stringify(Id(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(Ke.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===Ts.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,S.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===Ts.SEND_ONLY?this.restartICE(t):vi(this,Ke.RequestP2PRestartICE,{direction:Ts.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(le.LocalAudioTrack);if(t instanceof kn&&(n==null?void 0:n.track)instanceof wr)return n.track.isActive||e.push([le.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return t===s});if(r&&(e.push(r),r[0]===le.LocalVideoTrack)){const i=this.localTrackMap.get(le.LocalVideoLowTrack);i&&e.push([le.LocalVideoLowTrack,i])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(le.LocalAudioTrack);if(t instanceof kn&&(n==null?void 0:n.track)instanceof wr)return n.track.isActive&&e.push([le.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return t===s});if(r)if(r[0]===le.LocalVideoTrack){e.push(r);const i=this.localTrackMap.get(le.LocalVideoLowTrack);i&&e.push([le.LocalVideoLowTrack,i])}else e.push(r);return e}createMuteMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case le.LocalAudioTrack:r=kt.Audio;break;case le.LocalVideoTrack:r=Se(n=s._hints).call(n,En.SCREEN_TRACK)?kt.Screen:kt.High;break;case le.LocalVideoLowTrack:r=kt.Low}return{stream_type:r,ssrcs:o,mid:a}})}createUnmuteMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case le.LocalAudioTrack:r=kt.Audio;break;case le.LocalVideoTrack:r=Se(n=s._hints).call(n,En.SCREEN_TRACK)?kt.Screen:kt.High;break;case le.LocalVideoLowTrack:r=kt.Low}return{stream_type:r,ssrcs:o,mid:a}})}filterTobeUnSubscribedTracks(t,e){const n=[],r=this.remoteUserMap.get(t);if(!r)return n;if(e){const i=r.get(e);if(!i)return n;n.push([t,{kind:e,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,o]=i;n.push([t,{kind:s,id:o}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case Pe.VIDEO:return void(r._videoSSRC&&e.push({stream_type:Pe.VIDEO,ssrcId:r._videoSSRC}));case Pe.AUDIO:return void(r._audioSSRC&&e.push({stream_type:Pe.AUDIO,ssrcId:r._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:r}]=e;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(le.LocalVideoTrack),n=this.localTrackMap.get(le.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof kn){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await Jt(this,Ke.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Ke.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Ke.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ai(i2(this.dtlsFailedCount,fr)),this.emit(Ke.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(le.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof pn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof pn).length>1)throw new ie(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof kn).length>1&&(t.some(e=>e instanceof kn&&e._bypassWebAudio)||!bt().webAudioMediaStreamDest))throw new ie(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof pn&&this.pendingLocalTracks.some(n=>n instanceof pn))throw new ie(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof kn&&this.pendingLocalTracks.some(n=>n instanceof kn)&&(!bt().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof kn&&n._bypassWebAudio)))throw new ie(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding,r=xT(xT({},{width:160,height:120,framerate:15,bitrate:50}),e);let i;i=n?t._mediaStreamTrack.clone():jP(t,r);const s=nn(8,"track-low-"),o=new pn(i,xT(xT({},n&&{scaleResolutionDownBy:NP(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(If.TRANSCEIVER_UPDATED,a=>{t._updateRtpTransceiver(a,kg.LOW_STREAM)}),o._hints.push(En.LOW_STREAM),t.addListener(be.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,r){var i;const s=Array.from(Ko(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===t);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,a=o.subscribe.find(A=>A.userId===s.uid&&A.type==="video");Le.firstRemoteVideoDecode(this.store.sessionId,$r.FIRST_VIDEO_DECODE,Dn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:ki.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(a==null?void 0:a.subscribeEnd)||0,subscriberStart:(a==null?void 0:a.subscribeStart)||0,videoAddNotify:(a==null?void 0:a.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(t);if(!r)return!1;const i=r.get(e);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new ie(P.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new ie(P.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new ie(P.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new ie(P.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new ie(P.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new ie(P.NOT_SUPPORTED)}async preConnect(t){throw new ie(P.NOT_SUPPORTED)}getEstablishParams(){throw new ie(P.NOT_SUPPORTED)}async reSubscribe(t){throw new ie(P.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new ie(P.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===le.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,kg.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Oe(vn.prototype,"p2pConnect",[I8],Object.getOwnPropertyDescriptor(vn.prototype,"p2pConnect"),vn.prototype),Oe(vn.prototype,"unpublish",[R8],Object.getOwnPropertyDescriptor(vn.prototype,"unpublish"),vn.prototype),Oe(vn.prototype,"unpublishLowStream",[O8],Object.getOwnPropertyDescriptor(vn.prototype,"unpublishLowStream"),vn.prototype),Oe(vn.prototype,"subscribe",[N8],Object.getOwnPropertyDescriptor(vn.prototype,"subscribe"),vn.prototype),Oe(vn.prototype,"mockSubscribe",[D8],Object.getOwnPropertyDescriptor(vn.prototype,"mockSubscribe"),vn.prototype),Oe(vn.prototype,"unsubscribe",[B8],Object.getOwnPropertyDescriptor(vn.prototype,"unsubscribe"),vn.prototype),Oe(vn.prototype,"muteRemote",[L8],Object.getOwnPropertyDescriptor(vn.prototype,"muteRemote"),vn.prototype),Oe(vn.prototype,"unmuteRemote",[P8],Object.getOwnPropertyDescriptor(vn.prototype,"unmuteRemote"),vn.prototype),Oe(vn.prototype,"hasRemoteMediaWithLock",[U8],Object.getOwnPropertyDescriptor(vn.prototype,"hasRemoteMediaWithLock"),vn.prototype),Oe(vn.prototype,"disconnectForReconnect",[k8],Object.getOwnPropertyDescriptor(vn.prototype,"disconnectForReconnect"),vn.prototype),Oe(vn.prototype,"remoteMediaSsrcChanged",[x8],Object.getOwnPropertyDescriptor(vn.prototype,"remoteMediaSsrcChanged"),vn.prototype),vn);function kc(t){return function(e,n,r){const i=e[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];switch(t){case Hc.SEND_ONLY:{const A=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{A()}}case Hc.RECEIVE_ONLY:{const A=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{A()}}default:{const A=await this.sendMutex.lock("From P2PChannel2.".concat(n)),l=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{A(),l()}}}},r}}function F8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Xh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?F8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):F8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class Iv{constructor(e){N(this,"store",void 0),N(this,"onStatsException",void 0),N(this,"onUploadPublishDuration",void 0),N(this,"onStatsChanged",void 0),N(this,"localStats",new Map),N(this,"remoteStats",new Map),N(this,"updateStatsInterval",void 0),N(this,"trafficStats",void 0),N(this,"trafficStatsPeerList",[]),N(this,"uplinkStats",void 0),N(this,"exceptionMonitor",void 0),N(this,"p2pChannel",void 0),N(this,"scalabilityMode",IP.L1T1),N(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new aLe,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(le.LocalAudioTrack)||Xh({},LP)}getLocalVideoTrackStats(){return this.localStats.get(le.LocalVideoTrack)||Xh({},PP)}getRemoteAudioTrackStats(e){const n=(s,o)=>{if(!this.trafficStats)return o;const a=this.trafficStats.peer_delay.find(A=>A.peer_uid===s);return a&&(o.publishDuration=a.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},r={};if(e){var i;const s=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.audioStats;s&&(r[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{audioStats:a}]=s;a&&(r[o]=n(o,a))});return r}getRemoteNetworkQualityStats(e){const n={};if(e){var r;const i=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.networkStats;i&&(n[e]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{networkStats:o}]=i;o&&(n[s]=o)});return n}getRemoteVideoTrackStats(e){const n=(s,o)=>{if(!this.trafficStats)return o;const a=this.trafficStats.peer_delay.find(A=>A.peer_uid===s);return a&&(o.publishDuration=a.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},r={};if(e){var i;const s=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.videoStats;s&&(r[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{videoStats:a}]=s;a&&(r[o]=n(o,a))});return r}getRTCStats(){let e=0,n=0,r=0,i=0;const s=this.localStats.get(le.LocalAudioTrack);s&&(e+=s.sendBytes,n+=s.sendBitrate);const o=this.localStats.get(le.LocalVideoTrack);o&&(e+=o.sendBytes,n+=o.sendBitrate);const a=this.localStats.get(le.LocalVideoLowTrack);a&&(e+=a.sendBytes,n+=a.sendBitrate),this.remoteStats.forEach(l=>{let{audioStats:d,videoStats:f}=l;d&&(r+=d.receiveBytes,i+=d.receiveBitrate),f&&(r+=f.receiveBytes,i+=f.receiveBitrate)});let A=1;return this.trafficStats&&(A+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:A,SendBitrate:n,SendBytes:e,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),s=i!=null&&i.videoSSRC?ki.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,o=i!=null&&i.audioSSRC?ki.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&S.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,r){if(!e)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case le.LocalVideoTrack:case le.LocalVideoLowTrack:{const o=i,a=Xh({},PP),A=e.getStats(),l=e.getLocalMedia(r);if(A){const d=A.videoSend.find(f=>f.ssrc===(l==null?void 0:l.ssrcs[0].ssrcId));if(d){const f=e.getLocalVideoSize(),p=e.getEncoderConfig(le.LocalVideoTrack);d.codec!=="H264"&&d.codec!=="H265"&&d.codec!=="VP8"&&d.codec!=="VP9"&&d.codec!=="AV1X"&&d.codec!=="AV1"||(a.codecType=d.codec),a.sendBytes=d.bytes,a.sendBitrate=o?8*Math.max(0,a.sendBytes-o.sendBytes):0,d.inputFrame?(a.captureFrameRate=d.inputFrame.frameRate,a.captureResolutionHeight=d.inputFrame.height,a.captureResolutionWidth=d.inputFrame.width):f&&(a.captureResolutionWidth=f.width,a.captureResolutionHeight=f.height),d.sentFrame?(a.sendFrameRate=d.sentFrame.frameRate,a.sendResolutionHeight=d.sentFrame.height,a.sendResolutionWidth=d.sentFrame.width):f&&(a.sendResolutionWidth=f.width,a.sendResolutionHeight=f.height),d.avgEncodeMs&&(a.encodeDelay=d.avgEncodeMs),p&&p.bitrateMax&&(a.targetSendBitrate=1e3*p.bitrateMax),a.sendPackets=d.packets,a.sendPacketsLost=d.packetsLost,a.sendJitterMs=d.jitterMs,a.sendRttMs=d.rttMs,a.totalDuration=o?o.totalDuration+1:1,a.totalFreezeTime=o?o.totalFreezeTime:0,this.isLocalVideoFreeze(d)&&(a.totalFreezeTime+=1),d.scalabilityMode&&this.scalabilityMode!==d.scalabilityMode&&(S.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(d.scalabilityMode)),this.scalabilityMode=d.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(r,a),((o==null?void 0:o.sendResolutionWidth)!==a.sendResolutionWidth||(o==null?void 0:o.sendResolutionHeight)!==a.sendResolutionHeight)&&((s=this.onStatsChanged)===null||s===void 0||s.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&l&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,l.track,a);break}case le.LocalAudioTrack:{const o=i,a=Xh({},LP),A=e.getStats(),l=e.getLocalMedia(r);if(A){const d=A.audioSend.find(f=>f.ssrc===(l==null?void 0:l.ssrcs[0].ssrcId));if(d){if(d.codec!=="opus"&&d.codec!=="aac"&&d.codec!=="PCMU"&&d.codec!=="PCMA"&&d.codec!=="G722"||(a.codecType=d.codec),d.inputLevel)a.sendVolumeLevel=Math.round(32767*d.inputLevel);else{const f=e.getLocalAudioVolume();f&&(a.sendVolumeLevel=Math.round(32767*f))}a.sendBytes=d.bytes,a.sendPackets=d.packets,a.sendPacketsLost=d.packetsLost,a.sendJitterMs=d.jitterMs,a.sendRttMs=d.rttMs,a.sendBitrate=o?8*Math.max(0,a.sendBytes-o.sendBytes):0}}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(le.LocalAudioTrack,a),a&&l&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,l.track,a);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[s,{videoStats:o,audioStats:a,videoPcStats:A}]=n;const l=a,d=o,f=A,p=Xh({},cte),g=Xh({},Ate),y=Xh({},M1e),{audioTrack:E,videoTrack:w,audioSSRC:b,videoSSRC:I}=e.getRemoteMedia(s);let B;B=e instanceof Co?e.getStats(!0):e.getStats();const U=(r=B)===null||r===void 0?void 0:r.audioRecv.find(x=>x.ssrc===b),H=(i=B)===null||i===void 0?void 0:i.videoRecv.find(x=>x.ssrc===I),K=this.trafficStats&&this.trafficStats.peer_delay.find(x=>x.peer_uid===s);if(U&&(U.codec!=="opus"&&U.codec!=="aac"&&U.codec!=="PCMU"&&U.codec!=="PCMA"&&U.codec!=="G722"||(p.codecType=U.codec),U.outputLevel?p.receiveLevel=Math.round(32767*U.outputLevel):E&&(p.receiveLevel=Math.round(32767*E.getVolumeLevel())),p.receiveBytes=U.bytes,p.receivePackets=U.packets,p.receivePacketsLost=U.packetsLost,p.receivePacketsDiscarded=U.packetsDiscarded,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.receiveBitrate=l?8*Math.max(0,p.receiveBytes-l.receiveBytes):0,p.totalDuration=l?l.totalDuration+1:1,p.totalFreezeTime=l?l.totalFreezeTime:0,p.freezeRate=p.totalFreezeTime/p.totalDuration,p.receiveDelay=U.jitterBufferMs,p.totalDuration>10&&Iv.isRemoteAudioFreeze(E)&&(p.totalFreezeTime+=1)),H){H.codec!=="H264"&&H.codec!=="H265"&&H.codec!=="VP8"&&H.codec!=="VP9"&&H.codec!=="AV1X"&&H.codec!=="AV1"||(g.codecType=H.codec),g.receiveBytes=H.bytes,g.receiveBitrate=d?8*Math.max(0,g.receiveBytes-d.receiveBytes):0,g.decodeFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,g.renderFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,H.outputFrame&&(g.renderFrameRate=H.outputFrame.frameRate),H.receivedFrame?(g.receiveFrameRate=H.receivedFrame.frameRate,g.receiveResolutionHeight=H.receivedFrame.height,g.receiveResolutionWidth=H.receivedFrame.width):w&&(g.receiveResolutionHeight=w._videoHeight||0,g.receiveResolutionWidth=w._videoWidth||0),H.framesRateFirefox!==void 0&&(g.receiveFrameRate=Math.round(H.framesRateFirefox)),g.receivePackets=H.packets,g.receivePacketsLost=H.packetsLost,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost),g.totalDuration=d?d.totalDuration+1:1,g.totalFreezeTime=d?d.totalFreezeTime:0,g.receiveDelay=H.jitterBufferMs||0;const x=!!I&&e.getRemoteVideoIsReady(I);w&&x&&Iv.isRemoteVideoFreeze(w,H,f)&&(g.totalFreezeTime+=1),g.freezeRate=g.totalFreezeTime/g.totalDuration}K&&(p.end2EndDelay=K.B_ad,g.end2EndDelay=K.B_vd,p.transportDelay=K.B_ed,g.transportDelay=K.B_ed,p.currentPacketLossRate=K.B_ealr4/100,g.currentPacketLossRate=K.B_evlr4/100,y.uplinkNetworkQuality=K.B_punq?K.B_punq:0,y.downlinkNetworkQuality=K.B_pdnq?K.B_pdnq:0),this.remoteStats.set(s,{audioStats:p,videoStats:g,videoPcStats:H,networkStats:y}),E&&this.exceptionMonitor.setRemoteAudioStats(E,p),w&&this.exceptionMonitor.setRemoteVideoStats(w,g)})}}class $te{constructor(){N(this,"destChannelMediaInfos",new Map),N(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){F6(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){F6(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){$I(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function V8(t){if(!(t instanceof $te))return new te(P.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new te(P.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new te(P.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function Q8(t){var e={},n=!1;function r(i,s){return n=!0,{done:!1,value:new C2(s=new QP(function(o){o(t[i](s))}),1)}}return e[Um!==void 0&&Aee||"@@iterator"]=function(){return this},e.next=function(i){return n?(n=!1,i):r("next",i)},typeof t.throw=="function"&&(e.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof t.return=="function"&&(e.return=function(i){return n?(n=!1,i):r("return",i)}),e}var bLe=Zn(Kte);function H8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function j8(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?H8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):H8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Xt;function K8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function MT(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?K8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):K8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let PE=(Xt=class ty extends Xee{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return Se(n=Object.keys(JI)).call(n,e)}))]}constructor(e,n){super(e,n),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"statsFilter",void 0),N(this,"useRTX",!1),N(this,"localCapabilities",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"establishPromise",void 0),N(this,"mutex",new xi("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(ty.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=S2(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,Fn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Rd(e.sdp),r=Cv(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=e,MT(MT({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:e.sdp})}catch(e){throw new ie(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(r){N(this,"sessionDesc",void 0),N(this,"localCapabilities",void 0),N(this,"rtpCapabilities",void 0),N(this,"candidates",void 0),N(this,"iceParameters",void 0),N(this,"dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),r=ir(r);const{iceParameters:i,dtlsParameters:s,candidates:o,rtpCapabilities:a,setup:A,localCapabilities:l,sdkCodec:d,cname:f}=r,p=ri.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=o,this.iceParameters=i,this.dtlsParameters=s,this.setup=A,this.localCapabilities=l,this.cname=f;for(let g=0;g<p.mediaDescriptions.length;g++){const y=p.mediaDescriptions[g];if(y.attributes.iceUfrag=i.iceUfrag,y.attributes.icePwd=i.icePwd,y.attributes.fingerprints=s.fingerprints,y.attributes.candidates=o,y.attributes.setup=A,y.media.mediaType==="video"){y.media.fmts=a.videoCodecs.map(w=>w.payloadType.toString(10));let E=a.videoCodecs.filter(w=>{var b,I;return(b=w.rtpMap)===null||b===void 0?void 0:Se(I=b.encodingName.toLowerCase()).call(I,d)});E.length===0&&(E=a.videoCodecs),y.attributes.payloads=E,y.attributes.extmaps=a.videoExtensions}y.media.mediaType==="audio"&&(y.media.fmts=a.audioCodecs.map(E=>E.payloadType.toString(10)),y.attributes.payloads=a.audioCodecs,y.attributes.extmaps=a.audioExtensions),p.mediaDescriptions[g]=this.mungMediaDesc(y)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return ri.print(this.sessionDesc)}send(r,i,s){const{ssrcs:o,ssrcGroups:a}=of(i,this.cname),A=this.sessionDesc.mediaDescriptions.find(f=>r===Pe.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),l=o[0].attributes.label,d=o[0].attributes.mslabel;return A.attributes.ssrcs=A.attributes.ssrcs.concat(o),A.attributes.ssrcGroups=A.attributes.ssrcGroups.concat(a),{id:l,mslabel:d}}batchSend(r){return r.map(i=>{let{kind:s,ssrcMsg:o}=i;return this.send(s,o,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const s=[],o=[],a=[];i.attributes.ssrcs.forEach(A=>{Se(r).call(r,A.attributes.label||"")?a.push(A):s.push(A)}),i.attributes.ssrcGroups.forEach(A=>{var l;Se(l=a.map(d=>d.ssrcId)).call(l,A.ssrcIds[0])||o.push(A)}),i.attributes.ssrcs=s,i.attributes.ssrcGroups=o})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,s){r.forEach((o,a)=>{const A=o._mediaStreamTrack,l=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===A.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[l],o);this.sessionDesc.mediaDescriptions[l]=d})}stopReceiving(r){}updateCandidates(r){r===Io.TCP?this.candidates.forEach(i=>{this.candidates.findIndex(s=>s.transport==="tcp"&&s.connectionAddress===i.connectionAddress&&s.port===i.port)===-1&&this.candidates.push(j8(j8({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this.candidates=this.candidates.filter(i=>i.transport!=="tcp");for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(r){r=ir(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let s=0;s<r;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}mungRecvMediaDsec(r,i){const s=ir(r);return xg(s,i),_2(s,i),s}updateRecvMedia(r,i){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===r);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=o}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,s){const o=this.sessionDesc.mediaDescriptions.find(A=>r===Pe.VIDEO?A.attributes.mid==="video":A.attributes.mid==="audio");if(o){const A=o.attributes.ssrcs.find(l=>l.attributes.label===i);var a;A&&(A.attributes.label=s,(a=A.attributes.msid)===null||a===void 0||a.replace(i,s))}}mungMediaDesc(r){const i=ir(r);return g2(i),function(s){const o=s.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(o),1),s.attributes.payloads.forEach(a=>{const A=a.rtcpFeedbacks.findIndex(l=>l.type==="transport-cc");A!==-1&&a.rtcpFeedbacks.splice(A,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const s of i.attributes.ssrcs)if(s.attributes.label===r)return[s]}}(MT(MT({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new ie(P.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var r=this;return Xc(function*(){const i=yield Bt(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=e.map(p=>r.peerConnection.addTrack(p._mediaStreamTrack)),o=yield Bt(r.peerConnection.createOffer()),a=ri.parse(o.sdp),A=e.map(p=>{const g=p._mediaStreamTrack,y=a.mediaDescriptions.find(E=>E.attributes.mid===g.kind);if(!y)throw new Error("Cannot extract ssrc from mediaDescription.");return function(E,w,b){const I=E.attributes.ssrcs.filter(U=>U.attributes.label===w),B=E.attributes.ssrcGroups;if(I.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(B&&I.length>1){const U=B.find(H=>H.ssrcIds.indexOf(I[0].ssrcId)!==-1);return U?[{ssrcId:U.ssrcIds[0],rtx:b?U.ssrcIds[1]:void 0}]:[{ssrcId:I[0].ssrcId}]}return[{ssrcId:I[0].ssrcId}]}(y,g.id,r.useRTX)});let l;try{l=yield A}catch(p){throw s.forEach(g=>{yi()&&g.replaceTrack(null),r.peerConnection.removeTrack(g)}),p}const d=r.mungSendOfferSDP(o.sdp,e);r.remoteSDP.receive(e,n,l);const f=r.remoteSDP.toString();return yield Bt(r.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield Bt(r.applySendEncodings(s,e)),yield Bt(r.peerConnection.setRemoteDescription({type:"answer",sdp:f})),e.map((p,g)=>{const y=p._mediaStreamTrack.id;return{localSSRC:A[g],id:y}})}catch(s){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var o;return e.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{yi()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:s,mslabel:o}=this.remoteSDP.send(e,n,i),a=new we((d,f)=>{const p=setTimeout(()=>{f(new Error("Cannot receive track, id: ".concat(s)))},1e4),g=y=>{const E=Ct();if((E.name==="Safari"&&Number(E.version)===11||Is())&&y.track.id!==s&&y.streams[0].id===o){var w;const b=y.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(e,s,y.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(p),void d(b)}if(y.track.id===s)return this.peerConnection.removeEventListener("track",g),clearTimeout(p),void d(y.track)};this.peerConnection.addEventListener("track",g)}),A=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:A});const l=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(l),{track:await a,id:s}}catch(s){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var i;return e.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(yi()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(s=>s.active=!1),r.setParameters(i)}})}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var o;return e.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(yi()&&s.track)s.track.enabled=!0;else{const o=s.getParameters();o.encodings.forEach(a=>a.active=!0),await s.setParameters(o)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Xc(function*(){const r=yield Bt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(bt().supportPCSetConfiguration){const A=n.peerConnection.getConfiguration(),l=e===Io.RELAY?"relay":"all";A.iceTransportPolicy!==l&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(l,"]")),A.iceTransportPolicy=l,n.peerConnection.setConfiguration(A))}else if(e===Io.RELAY)return;e!==Io.RELAY&&n.remoteSDP.updateCandidates(e);const i=yield Bt(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=Rd(i.sdp),{remoteIceParameters:o}=yield s.iceParameters;n.remoteSDP.restartICE(o);const a=n.remoteSDP.toString();yield Bt(n.peerConnection.setLocalDescription(i)),yield Bt(n.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(i){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ie(P.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(e,n){const r=this.peerConnection.getSenders().filter(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===e});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const r=this.peerConnection.getSenders().find(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===n});r&&await r.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new ie(P.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new ie(P.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(qI(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...ty.turnServerConfigToIceServers(e.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...ty.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var r;if(n||(n=this.peerConnection.getSenders().find(l=>{var d;return((d=l.track)===null||d===void 0?void 0:d.id)===e._mediaStreamTrack.id})),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!bt().supportSetRtpSenderParameters)return S.warn("Browser not support set rtp-sender parameters");const i={},s={};if(e instanceof pn)switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(G("DSCP_TYPE")&&rh()){var o;const l=G("DSCP_TYPE");Se(o=["very-low","low","medium","high"]).call(o,l)&&(s.networkPriority=l)}const a=n.getParameters(),A=(r=a.encodings)===null||r===void 0?void 0:r[0];A&&Object.assign(A,s),Object.assign(a,i),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await n.setParameters(a)}async applySendEncodings(e,n){try{if(!bt().supportSetRtpSenderParameters||e.length!==n.length)return;for(let r=0;r<e.length;r++){const i=e[r],s=n[r];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const r=ri.parse(e);return n.forEach((i,s)=>{const o=i._mediaStreamTrack,a=r.mediaDescriptions.find(A=>A.attributes.mid===o.kind);a&&xg(a,i)}),ri.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((s,o)=>{let{id:a,mslabel:A}=s;const{kind:l}=e[o];return new we((d,f)=>{const p=setTimeout(()=>{f(new Error("Cannot receive track, id: ".concat(a)))},1e4),g=y=>{const E=Ct();if(E.name==="Safari"&&Number(E.version)===11&&y.track.id!==a&&y.streams[0].id===A){var w;const b=y.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(l,a,y.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(p),void d({track:b,id:a})}if(y.track.id===a)return this.peerConnection.removeEventListener("track",g),clearTimeout(p),void d({track:y.track,id:a})};this.peerConnection.addEventListener("track",g)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await we.all(n)}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(bt().supportPCSetConfiguration){const n=ty.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Oe(Xt.prototype,"connect",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"connect"),Xt.prototype),Oe(Xt.prototype,"stopSending",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"stopSending"),Xt.prototype),Oe(Xt.prototype,"receive",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"receive"),Xt.prototype),Oe(Xt.prototype,"stopReceiving",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"stopReceiving"),Xt.prototype),Oe(Xt.prototype,"muteRemote",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"muteRemote"),Xt.prototype),Oe(Xt.prototype,"unmuteRemote",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"unmuteRemote"),Xt.prototype),Oe(Xt.prototype,"muteLocal",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"muteLocal"),Xt.prototype),Oe(Xt.prototype,"unmuteLocal",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"unmuteLocal"),Xt.prototype),Oe(Xt.prototype,"close",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"close"),Xt.prototype),Oe(Xt.prototype,"updateEncoderConfig",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"updateEncoderConfig"),Xt.prototype),Oe(Xt.prototype,"updateSendParameters",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"updateSendParameters"),Xt.prototype),Oe(Xt.prototype,"replaceTrack",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"replaceTrack"),Xt.prototype),Oe(Xt.prototype,"getRemoteSSRC",[pa],Object.getOwnPropertyDescriptor(Xt.prototype,"getRemoteSSRC"),Xt.prototype),Xt);function pa(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(e));try{for(var o=arguments.length,a=new Array(o),A=0;A<o;A++)a[A]=arguments[A];return await r.apply(this,a)}finally{s()}},n}function G8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function nd(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?G8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):G8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const UE="9",W8=4e4;class ILe{get localCapabilities(){return ir(this._localCapabilities)}get rtpCapabilities(){return ir(this._rtpCapabilities)}get candidates(){return ir(this._candidates)}get iceParameters(){return ir(this._iceParameters)}get dtlsParameters(){return ir(this._dtlsParameters)}constructor(e){N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_iceParameters",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),N(this,"firefoxSsrcMidMap",new Map),e=ir(e);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:s,setup:o,localCapabilities:a,cname:A}=e;this._rtpCapabilities=s,this._candidates=i,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=a,this.setup=o,this.cname=A,this.sessionDesc=this.updateRemoteRTPCapabilities(s),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){const n=this.candidates,r=this.dtlsParameters,i=this.iceParameters,s=this.rtpCapabilities.send;let o=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<e;a++){const A=2*a+2e4,l=2*a+W8,{ssrcs:d,ssrcGroups:f}=of([{ssrcId:A}],this.cname),{ssrcs:p,ssrcGroups:g}=of([{ssrcId:l,rtx:G("USE_SUB_RTX")?l+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:UE,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.videoCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:n,extmaps:s.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:g,rtcpFeedbackWildcards:[],payloads:s.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:UE,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.audioCodecs.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:n,extmaps:s.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:s.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return ri.print(this.sessionDesc)}send(e,n,r,i){const{ssrcs:s,ssrcGroups:o}=of(n,this.cname,G("SYNC_GROUP")?r:void 0),a=this.findPreloadMediaDesc(s);if(a){if(Fn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const A=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const A=this.findAvailableMediaIndex(e,s);let l;return A===-1||A===1&&(yi()||function(){const d=Ct();return!(d.name!==xt.CHROME||!d.osVersion)&&Number(d.version)<=90}())||A===0&&G("USE_SUB_RTX")||m6()?(l=this.createOrRecycleSendMedia(e,s,o,"sendonly",i),this.updateBundleMids()):(l=ir(this.sessionDesc.mediaDescriptions[A]),l.attributes.direction="sendonly",l.attributes.ssrcs=s,l.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(l,i)),Fn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,l.attributes.mid),{mid:l.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:n}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:n}}batchSend(e){const n=e.map(s=>{let{kind:o,ssrcMsg:a,mslabel:A}=s;return this.send(o,a,A)}),r=[];let i=!1;return n.forEach(s=>{let{mid:o,needExchangeSDP:a}=s;a&&(i=!0),r.push(o)}),{mids:r,needExchangeSDP:i}}stopSending(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(r=>{r.attributes.mid==="0"||Fn()||m6()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(e){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>Se(e).call(e,r.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>Se(e).call(e,r.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="recvonly"})}receive(e,n,r,i){e.forEach((s,o)=>{this.createOrRecycleRecvMedia(s,[],"recvonly",n,r,i[o])}),this.updateBundleMids()}stopReceiving(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const n=this.sessionDesc||ri.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=e;const r=this.rtpCapabilities.send,i=this.localCapabilities.send;for(const s of n.mediaDescriptions){if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,s.media.mediaType==="application"&&(s.attributes.sctpPort="5000"),s.media.mediaType==="video"){if(r.videoCodecs.length===0){const o=i.videoCodecs.filter(a=>{var A,l;return(A=a.rtpMap)===null||A===void 0?void 0:Se(l=A.encodingName.toLowerCase()).call(l,"vp8")})||[i.videoCodecs[0]];s.media.fmts=o.map(a=>a.payloadType.toString(10)),s.attributes.payloads=o,s.attributes.extmaps=[]}else if(s.media.fmts=r.videoCodecs.map(o=>o.payloadType.toString(10)),s.attributes.payloads=r.videoCodecs,s.attributes.extmaps=r.videoExtensions,G("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:o,ssrcGroups:a}=of([{ssrcId:W8,rtx:G("USE_SUB_RTX")?40001:void 0}],this.cname);s.attributes.ssrcs=o,s.attributes.ssrcGroups=a}}if(s.media.mediaType==="audio"){if(r.audioCodecs.length===0){const o=i.audioCodecs.filter(a=>{var A,l;return(A=a.rtpMap)===null||A===void 0?void 0:Se(l=A.encodingName.toLowerCase()).call(l,"opus")})||[i.audioCodecs[0]];s.media.fmts=o.map(a=>a.payloadType.toString(10)),s.attributes.payloads=o,s.attributes.extmaps=[]}else if(s.media.fmts=r.audioCodecs.map(o=>o.payloadType.toString(10)),s.attributes.payloads=r.audioCodecs,s.attributes.extmaps=r.audioExtensions,Mg(s),G("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:o,ssrcGroups:a}=of([{ssrcId:2e4}],this.cname);s.attributes.ssrcs=o,s.attributes.ssrcGroups=a}}}return this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){const n=this._candidates.filter(r=>r.transport==="udp");if(e===Io.TCP){if(n.length===0)return;if(G("TCP_CANDIDATE_ONLY")){const r=this._candidates.filter(i=>i.transport==="tcp");n.forEach(i=>{r.findIndex(s=>s.connectionAddress===i.connectionAddress)===-1&&r.push(nd(nd({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),this._candidates=r}else{const r=[];n.forEach(i=>{r.push(nd(nd({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),this._candidates=[...n,...r]}}else if(e===Io.RELAY){if(n.length!==0)return;{const r=this._candidates.filter(i=>i.transport==="tcp");r.forEach(i=>{n.push(nd(nd({},i),{},{foundation:"udpcandidate",priority:Number(i.priority)+1+"",transport:"udp",port:Number(i.port)-90+""}))}),this._candidates=[...n,...r]}}else n.length===0?(this._candidates.filter(r=>r.transport==="tcp").forEach(r=>{n.push(nd(nd({},r),{},{foundation:"udpcandidate",priority:Number(r.priority)+1+"",transport:"udp",port:Number(r.port)-90+""}))}),this._candidates=n):this._candidates=this._candidates.filter(r=>r.transport!=="tcp");for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(e){e=ir(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let r=0;r<e;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}findAvailableMediaIndex(e,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Fn()){if(i){const s=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const r of this.sessionDesc.mediaDescriptions)if(r.media.mediaType==="application")return{mediaDesc:r,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),n={media:{mediaType:"application",port:UE,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(n),{mediaDesc:n,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,n,r,i,s,o){const a=e._mediaStreamTrack.kind,A=this.rtpCapabilities.recv,l=Py(a,A,this.localCapabilities.send,a===Pe.VIDEO?i:s),d=a===Pe.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let p={media:{mediaType:a,port:UE,protos:["UDP","TLS","RTP","SAVPF"],fmts:l.map(y=>y.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:l,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};p=this.mungRecvMediaDsec(p,e,o);const g=this.findFirstClosedMedia(a);if(g){const y=this.sessionDesc.mediaDescriptions.indexOf(g);this.sessionDesc.mediaDescriptions[y]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}updateRemoteCodec(e,n,r){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(p=>p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"").filter(p=>{var g;return Se(g=Object.keys(JI)).call(g,p)}))],s=new Set(n);if(i.every(p=>s.has(p)))return S.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(n)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter(p=>n.some(g=>{var y;return Se(y=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"").call(y,g)}));if(o.length===0)return S.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(n)),!1;const a=[...new Set(o.map(p=>p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||""))];let A;if(S.debug("updateRemoteCodec, from ".concat(i," to ").concat(a)),e.length===0)A=this.sessionDesc.mediaDescriptions.filter(p=>p.media.mediaType==="video"&&p.attributes.direction==="recvonly");else if(A=this.sessionDesc.mediaDescriptions.filter(p=>p.attributes.mid&&Se(e).call(e,p.attributes.mid)&&p.attributes.direction==="recvonly"),A.length!==e.length)return S.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(n)),!1;if(G("USE_PUB_RTX")||G("USE_SUB_RTX")){const p=E2(o,this.rtpCapabilities.recv.videoCodecs);o.push(...p)}this._rtpCapabilities.recv.videoCodecs=o;const l=this.localCapabilities.send,d=this.rtpCapabilities.recv,f=Py(Pe.VIDEO,d,l,r);return A.forEach(p=>{const g=f.map(y=>y.payloadType.toString(10));S.debug("updateRemoteCodec mid: ".concat(p.attributes.mid,", from ").concat(p.attributes.payloads," to ").concat(f)),p.attributes.payloads=f,p.media.fmts=g}),!0}createOrRecycleSendMedia(e,n,r,i,s){const o=this.rtpCapabilities.send,a=e===Pe.VIDEO?o.videoCodecs:o.audioCodecs,A=e===Pe.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const l="".concat(this.currentMidIndex);let d={media:{mediaType:e,port:UE,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(p=>p.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(l)}};d=this.mungSendMediaDesc(d,s);const f=this.findFirstClosedMedia(e);if(f){const p=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[p]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,n,r){const i=ir(e);return g2(i),xg(i,n),_2(i,n),Ute(i),yb(i,r,this.localCapabilities.send),i}mungSendMediaDesc(e,n){const r=ir(e);return yb(r,n,this.localCapabilities.recv),Mg(r),r}updateRecvMedia(e,n){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(n=>Fn()?n.media.port==="0"&&n.media.mediaType===e:n.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(n=>{var r;return((r=n.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}getSSRC(e){var n;return(n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e))===null||n===void 0?void 0:n.attributes.ssrcs}}function z8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function zl(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?z8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):z8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let Uy=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({});var og=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(og||{});const wb=new Map;function q8(t,e,n,r){let{scale:i}=t;if(i===0&&r===og.UP||i>=e.length-1&&r===og.DOWN)return t;let s=zl(zl({},t),{},{scale:r===og.DOWN?++i:--i});switch(n){case"maintain-framerate":s=zl(zl({},s),e[i].motion);break;case"maintain-resolution":s=zl(zl({},s),e[i].detail);break;case"balanced":s=zl(zl({},s),e[i].balanced)}return s}function Zte(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:ene(e)};wb.set(t,n)}else wb.delete(t)}function ene(t){const e=zl({},t),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:s}=e,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:a,MAX_SCALE:A,BITRATE_MIN_THRESHOLD:l,BITRATE_MAX_THRESHOLD:d,BWE_SCALE_UP_THRESHOLD:f,BWE_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_UP_THRESHOLD:y,BALANCE_BITRATE_FACTOR:E,BALANCE_FRAMERATE_FACTOR:w,BALANCE_RESOLUTION_FACTOR:b,MOTION_RESOLUTION_FACTOR:I,MOTION_BITRATE_FACTOR:B,DETAIL_FRAMERATE_FACTOR:U,DETAIL_BITRATE_FACTOR:H}=o2,K=Math.min(e.frameRate,a),x=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(p,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(g,1)*K),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s}}];for(let V=1;V<=A;V++){const M={bwe_up:Math.round(Math.pow(f,V)*n),bwe_down:Math.round(Math.pow(p,V+1)*n),fps_up:Math.round(Math.pow(y,V)*K),fps_down:Math.round(Math.pow(g,V+1)*K)},O={scaleResolutionDownBy:i/Math.pow(b,V),frameRate:Math.max(Math.round(Math.pow(w,V)*r),o),bitrateMax:Math.max(Math.round(Math.pow(E,V)*n),d),bitrateMin:Math.max(Math.round(Math.pow(E,V)*s),l)},z={scaleResolutionDownBy:i/Math.pow(I,V),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(B,V)*n),d),bitrateMin:Math.max(Math.round(Math.pow(B,V)*s),l)},$={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(U,V)*r),o),bitrateMax:Math.max(Math.round(Math.pow(H,V)*n),d),bitrateMin:Math.max(Math.round(Math.pow(H,V)*s),l)};x.push({scale:V,threshold:M,balanced:O,motion:z,detail:$})}return x}function RLe(t,e,n,r,i,s){const o=wb.get(t)||{overUse:0,underUse:0,adaptationList:ene(i)},{adaptationList:a}=o;wb.set(t,o);const{OVERUSE_TIMES_THRESHOLD:A,UNDERUSE_TIMES_THRESHOLD:l}=o2,{scale:d}=r;let f,p;return typeof e=="number"&&e>0&&function(g,y,E,w){if(y>=E.length)return!1;let{threshold:{fps_down:b}}=E[y];return G("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(b=E[0].threshold.fps_down),g<b}(e,d,a,s)&&(o.overUse++,p=Uy.CPU,o.overUse>A)||typeof n=="number"&&n>0&&function(g,y,E){if(y>=E.length)return!1;const{threshold:{bwe_down:w}}=E[y];return g<w}(n,d,a)&&(o.overUse++,p=Uy.BANDWIDTH,o.overUse>A)?(o.overUse=0,o.underUse=0,f=q8(r,a,s,og.DOWN),[f,p]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(g,y,E,w){if(y===0)return;let{threshold:{fps_up:b}}=E[y];return G("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(b=E[1].threshold.fps_up),g>b}(e,d,a,s)&&function(g,y,E){if(y===0)return;const{threshold:{bwe_up:w}}=E[y];return g>w}(n,d,a)&&(o.underUse++,o.underUse>l&&(o.overUse=0,o.underUse=0,f=q8(r,a,s,og.UP),f.scale===0&&(p=Uy.NONE))),[f,p])}function Y8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function JB(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Y8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Y8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function OLe(t){var e;return!!G("ENABLE_AG_ADAPTATION")&&!!(t instanceof xP||Se(e=t._hints).call(e,En.CUSTOM_TRACK))&&(!!G("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const r=Ct();if(r.os!==Pr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])>=n}(14)&&Lee(17,4)||Bee(14)&&Pee(17,4,!0)))}const Cb=new Map;function FT(t,e){const n=Cb.get(t);if(n){const{timer:r}=n;window.clearTimeout(r),Cb.delete(t)}e.qualityLimitationReason=Uy.NONE,Zte(t)}var Et;function X8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function NA(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?X8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let xc=(Et=class ny extends Xee{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return Se(n=Object.keys(JI)).call(n,e)}))]}constructor(e,n){super(e,n),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"id",nn(5,"connection-")),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"transportEventReceiver",void 0),N(this,"statsFilter",void 0),N(this,"extension",{useXR:G("USE_XR")}),N(this,"localCapabilities",void 0),N(this,"remoteCodecs",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"isPreallocation",!1),N(this,"preSSRCMap",new Map),N(this,"dataStreamChannelMap",new Map),N(this,"establishPromise",void 0),N(this,"recoveredDataChannelIds",[]),N(this,"currentDataChannelId",1),N(this,"mutex",new xi("P2PConnection-mutex")),N(this,"qualityLimitationReason",Uy.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(ny.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=S2(this.peerConnection,G("STATS_UPDATE_INTERVAL"),void 0,Fn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);if(r)return{transceiver:r,track:r.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void S.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else S.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Rd(e.sdp),r=await xte({filterRTX:!G("USE_PUB_RTX")&&!G("USE_SUB_RTX"),filterVideoFec:G("FILTER_VIDEO_FEC"),filterAudioFec:G("FILTER_AUDIO_FEC"),filterVideoCodec:G("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=vb(r),this.initialOffer=e,NA(NA({},n),{},{rtpCapabilities:r,offerSDP:e.sdp})}catch(e){throw new ie(P.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new ILe(NA(NA({},e),{},{localCapabilities:this.localCapabilities})),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),r=Mte(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i==null||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const s=this.peerConnection.getTransceivers()[0];if(s!=null&&s.receiver&&this.tryBindTransportEvents(s.receiver),G("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(G("PRELOAD_MEDIA_COUNT"));const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A)}const{preSSRCs:o}=e;if(Array.isArray(o)&&o.length>0){const{mids:a}=this.remoteSDP.batchSend(o.map(A=>({kind:A.kind,ssrcMsg:[{ssrcId:A.ssrcId,rtx:A.rtx}],mslabel:A.mslabel})));a.forEach((A,l)=>{this.preSSRCMap.set(o[l].ssrcId,A)}),await PT(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:r}=e;if(Array.isArray(r)&&r.length>0){const{mids:i}=this.remoteSDP.batchSend(r.map(s=>Object.assign({},{kind:s.kind,ssrcMsg:[{ssrcId:s.ssrcId,rtx:s.rtx}],mslabel:s.mslabel})));i.forEach((s,o)=>{this.preSSRCMap.set(r[o].ssrcId,s)})}await PT(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,r){var i=this;return Xc(function*(){const s=yield Bt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[];e.forEach(E=>{const w=i.peerConnection.addTransceiver(E._mediaStreamTrack,{direction:"sendonly"});o.push(w),E._updateRtpTransceiver(w)}),Fn()&&G("SIMULCAST")===!0&&(yield Bt(i.applySimulcastForFirefox(o,e)));const a=yield Bt(i.peerConnection.createOffer()),A=i.remoteSDP.predictReceivingMids(e.length),l=i.mungSendOfferSDP(a.sdp,e,A),d=ri.parse(l),f=A.map(E=>{const w=d.mediaDescriptions.find(b=>b.attributes.mid===E);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return Lte(w,G("USE_PUB_RTX"))});let p;try{p=yield f}catch(E){p=[],i.remoteSDP.receive(e,n,r,p);const w=i.remoteSDP.toString();throw yield Bt(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Bt(i.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield Bt(i.stopSending(A,!0)),E}i.remoteSDP.receive(e,n,r,p);const g=i.remoteSDP.toString(),y=i.logSDPExchange(l,"offer","local","send");return yield Bt(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Bt(i.applySimulcastEncodings(o,e)),yield Bt(i.applySendEncodings(o,e)),y==null||y(g),yield Bt(i.peerConnection.setRemoteDescription({type:"answer",sdp:g})),o.map((E,w)=>{const b=A[w];return{localSSRC:f[w],id:b,transceiver:E}})}catch(o){throw o instanceof ie?o:new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(e);if(r&&r.readyState==="open")S.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:G("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,r)}n.forEach(s=>{s._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),S.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else S.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof ie?r:new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof ie?n:new ie(P.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(A=>e.indexOf(A.mid)!==-1);if(i.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(A=>{var l;FT(this.id+A.mid,this),A.direction="inactive",(l=A.stop)===null||l===void 0||l.call(A)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(e,n,r,i);o&&(await PT(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const a=this.peerConnection.getTransceivers().find(A=>A.mid===s);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:s,transceiver:a}}catch(s){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(e);return r&&(await PT(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(i=>{const s=this.peerConnection.getTransceivers().find(o=>o.mid===i);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}})}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(s=>{Array.from(this.preSSRCMap.entries()).some(o=>{let[a,A]=o;if(A===s)return this.preSSRCMap.delete(a),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(o,a)=>{o.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(e);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie(P.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Xc(function*(){const r=yield Bt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(bt().supportPCSetConfiguration){const l=n.peerConnection.getConfiguration(),d=e===Io.RELAY?"relay":"all";l.iceTransportPolicy!==d&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(l.iceTransportPolicy,"] to [").concat(d,"]")),l.iceTransportPolicy=d,n.peerConnection.setConfiguration(l))}else if(e===Io.RELAY)return;n.remoteSDP.updateCandidates(e);const i=yield Bt(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=Rd(i.sdp),{remoteIceParameters:o}=yield s.iceParameters;n.remoteSDP.restartICE(o);const a=n.remoteSDP.toString(),A=n.logSDPExchange(i.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Bt(n.peerConnection.setLocalDescription(i)),A==null||A(a),yield Bt(n.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(i){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{FT(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return NA(NA({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o==null||o(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ie(P.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(e,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===e);r.length===1&&(this.isVP8Simulcast(n)?Fn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:NA(NA({},rl),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:NA(NA({},rl),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},G("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(qI(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...ny.turnServerConfigToIceServers(e.turnServer.servers)),G("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...ny.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),G("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),G("ENABLE_ENCODED_TRANSFORM")&&bt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Vm(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!G("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n==null?void 0:n.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:s}=r.getSelectedCandidatePair();S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(w=>w.track===e._mediaStreamTrack)),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!bt().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const a=function(E,w){return E.getTransceivers().find(b=>b.sender.track===w||b.receiver.track===w)}(this.peerConnection,e._mediaStreamTrack),A=j1e(e);if(OLe(e)&&a&&n&&A&&this.getLocalVideoStats&&Se(r=["vp8","vp9"]).call(r,this.store.codec)){var l;const E=s.degradationPreference||(Se(l=e._hints).call(l,En.CUSTOM_TRACK)?G("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(w,b,I,B,U,H){if(FT(w,I),U(b),B!=="balanced"&&B!=="maintain-framerate"&&B!=="maintain-resolution")return;let K=-1;Zte(w,b);const x=window.setInterval(()=>{const M=Cb.get(w);if(!G("ENABLE_AG_ADAPTATION")||!M)return FT(w,I),void U(b);const O=H();if(O.sendPackets>0&&O.OutgoingAvailableBandwidth>0){if(K===-1)return void(K=Date.now());if(Date.now()-K<1e3)return;const z=O.sendFrameRate,$=O.OutgoingAvailableBandwidth,[q,Ue]=RLe(w,z,$,M.adaptationConfig,b,B);Ue&&(I.qualityLimitationReason=Ue),q&&M.adaptationConfig.scale!==q.scale&&(S.debug("[".concat(w,"] applyAdaptation: ").concat(I.qualityLimitationReason,`
           sendFps `).concat(z,", bwe ").concat($,", switch from ").concat(M.adaptationConfig.scale," to ").concat(q.scale," ")),M.adaptationConfig=JB(JB({},M.adaptationConfig),q),U(q))}},G("CHECK_LOCAL_STATS_INTERVAL")),V=JB({},b);Cb.set(w,{timer:x,adaptationConfig:V,originConfig:b,adaptationFunc:U}),S.debug("[".concat(w,"] start adaptation, originConfig: ").concat(JSON.stringify(b),", degradationPreference: ").concat(B))})(this.id+a.mid,A,this,E,w=>{n&&this.updateAdaptation(n,w)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var d;const{bitrateMax:E,frameRate:w,scaleResolutionDownBy:b}=e._encoderConfig;E&&(o.maxBitrate=1e3*E),(Se(d=e._hints).call(d,En.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(w&&(o.maxFramerate=Oo(w)),b&&b>=1&&(o.scaleResolutionDownBy=b))}const{maxFramerate:f}=G("ENCODER_CONFIG_LIMIT");if(f&&typeof f=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,f):f),G("DSCP_TYPE")&&rh()){var p;const E=G("DSCP_TYPE");Se(p=["very-low","low","medium","high"]).call(p,E)&&(o.networkPriority=E)}const g=n.getParameters(),y=(i=g.encodings)===null||i===void 0?void 0:i[0];Fn()&&!y&&(s.encodings=[o]),y&&Object.assign(y,o),Object.assign(g,s),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await n.setParameters(g),await async function(E,w,b){try{var I;if(!bt().supportSetRtpSenderParameters||!function(x){return x==="vp9"}(E)||!G("ENABLE_SVC"))return;const B={},U={},H=w.getParameters(),K=(I=H.encodings)===null||I===void 0?void 0:I[0];U.scalabilityMode=MP(b),K&&Object.assign(K,U),Object.assign(H,B),await w.setParameters(H),S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(H.encodings)))}catch(B){S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",B)}}(this.store.codec,n,G("SVC_MODE"))}async updateAdaptation(e,n){var r,i;if(!e)return S.debug("[updateAdaptation] no rtpSender found");if(!bt().supportSetRtpSenderParameters)return S.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:o,frameRate:a,scaleResolutionDownBy:A}=n;o&&(s.maxBitrate=1e3*o),a&&(s.maxFramerate=Oo(a)),A&&A>=1&&Se(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=A);const l=e.getParameters(),d=(i=l.encodings)===null||i===void 0?void 0:i[0];d&&Object.assign(d,s),Object.assign(l,{});try{await e.setParameters(l),S.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(l.encodings)))}catch(f){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?S.debug("[updateAdaptation] peerConnection not connected}"):S.debug("[updateAdaptation] updateRtpSenderEncodings failed",f):S.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!bt().supportSetRtpSenderParameters||e.length!==n.length)return;for(let r=0;r<e.length;r++){const i=e[r],s=n[r];s instanceof pn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,r){const i=ri.parse(e);return n.forEach((s,o)=>{const a=r[o],A=i.mediaDescriptions.find(l=>l.attributes.mid===a);A&&(xg(A,s),kte(A,s,this.store.codec))}),ri.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let A=0;A<e.length;A++){var r,i,s,o,a;const l=e[A],d=n[A];if(d instanceof pn&&!Se(r=d._hints).call(r,En.LOW_STREAM)&&(i=d._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=d._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=d._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=d._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},p={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:p.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:p.high}];const g=l.sender.getParameters();await l.sender.setParameters(Object.assign(g,f))}}}async applySimulcastEncodings(e,n){if(!Fn()&&e.length===n.length)for(let r=0;r<e.length;r++){const i=n[r];if(i instanceof pn&&this.isVP8Simulcast(i)){const s=e[r],o={},a={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];const A=s.sender.getParameters();await s.sender.setParameters(Object.assign(A,o))}}}isVP8Simulcast(e){var n,r,i,s,o;return!!(e instanceof pn&&G("SIMULCAST")&&this.store.codec==="vp8"&&!Se(n=e._hints).call(n,En.LOW_STREAM)&&(r=e._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=e._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=e._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,n,r,i){if(G("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(bt().supportPCSetConfiguration){const n=ny.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Oe(Et.prototype,"updateRemoteRTPCapabilities",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"updateRemoteRTPCapabilities"),Et.prototype),Oe(Et.prototype,"connect",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"connect"),Et.prototype),Oe(Et.prototype,"updateRemoteConnect",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"updateRemoteConnect"),Et.prototype),Oe(Et.prototype,"createDataChannels",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"createDataChannels"),Et.prototype),Oe(Et.prototype,"receive",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"receive"),Et.prototype),Oe(Et.prototype,"batchReceive",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"batchReceive"),Et.prototype),Oe(Et.prototype,"stopReceiving",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"stopReceiving"),Et.prototype),Oe(Et.prototype,"muteRemote",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"muteRemote"),Et.prototype),Oe(Et.prototype,"unmuteRemote",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"unmuteRemote"),Et.prototype),Oe(Et.prototype,"muteLocal",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"muteLocal"),Et.prototype),Oe(Et.prototype,"unmuteLocal",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"unmuteLocal"),Et.prototype),Oe(Et.prototype,"close",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"close"),Et.prototype),Oe(Et.prototype,"updateEncoderConfig",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"updateEncoderConfig"),Et.prototype),Oe(Et.prototype,"updateSendParameters",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"updateSendParameters"),Et.prototype),Oe(Et.prototype,"replaceTrack",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"replaceTrack"),Et.prototype),Oe(Et.prototype,"updateAdaptation",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"updateAdaptation"),Et.prototype),Oe(Et.prototype,"getRemoteSSRC",[Hs],Object.getOwnPropertyDescriptor(Et.prototype,"getRemoteSSRC"),Et.prototype),Et);function Hs(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(e));try{for(var o=arguments.length,a=new Array(o),A=0;A<o;A++)a[A]=arguments[A];return await r.apply(this,a)}finally{s()}},n}var At;function J8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function DA(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?J8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function $8(t){var e,n,r,i=2;for(typeof Symbol<"u"&&(n=bLe,r=Symbol.iterator);i--;){if(n&&(e=t[n])!=null)return e.call(t);if(r&&(e=t[r])!=null)return new rS(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function rS(t){function e(n){if(Object(n)!==n)return we.reject(new TypeError(n+" is not an object."));var r=n.done;return we.resolve(n.value).then(function(i){return{value:i,done:r}})}return rS=function(n){this.s=n,this.n=n.next},rS.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?we.resolve({value:n,done:!0}):e(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?we.reject(n):e(r.apply(this.s,arguments))}},new rS(t)}let VT=(At=class extends Ln{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Ke.StateChange,e,this._state)}constructor(t,e){super(),N(this,"isPlanB",void 0),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"connection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"remoteDataChannelMap",new Map),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"pendingLocalDataChannels",[]),N(this,"pendingRemoteDataChannels",[]),N(this,"statsCollector",void 0),N(this,"shouldForwardP2PCreation",void 0),N(this,"iceFailedCount",0),N(this,"dtlsFailedCount",0),N(this,"mutex",new xi("P2PChannel-mutex")),N(this,"_state",Ut.Disconnected),N(this,"_pcStatsUploadType",G("NEW_ICE_RESTART")?kl.FIRST_CONNECTION:kl.OLD_FIRST_CONNECTION),N(this,"_isInRestartIce",!1),N(this,"_isStartRestartIce",!1),N(this,"_restartStates",["disconnected","failed"]),N(this,"_restartTimer",void 0),N(this,"_isFirstConnected",!0),N(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Ut.Connected)return void i(new ie(P.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const o=this.filterTobeMutedTracks(n);if(o.length===0)return void r();const a=o.find(l=>l[0]==="videoLowTrack");a&&a[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(o.map(l=>{let[,{id:d}]=l;return d}));const A=this.createMuteMessage(o);await Jt(this,Ke.RequestMuteLocal,A),r()}catch(o){i(o)}finally{s()}}),N(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Ut.Connected)return void i(new ie(P.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();const a=o.find(l=>l[0]==="videoLowTrack");if(a){const l=a[1];if(l.track._originMediaStreamTrack.stop(),!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding){const d=n._mediaStreamTrack.clone();l.track._mediaStreamTrack=d,l.track._originMediaStreamTrack=d}else{const d=jP(n,_v(this,Ke.RequestLowStreamParameter));l.track._mediaStreamTrack=d,l.track._originMediaStreamTrack=d}await new we((d,f)=>{this.handleReplaceTrack(l.track,d,f,!0)})}await this.connection.unmuteLocal(o.map(l=>{let[,{id:d}]=l;return d}));const A=this.createUnmuteMessage(o);await Jt(this,Ke.RequestUnmuteLocal,A),r()}catch(o){i(o)}finally{s()}}),N(this,"handleUpdateVideoEncoder",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const o=this.localTrackMap.get(le.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==Ut.Connected)return void r();const{id:a,track:A}=o;await this.connection.updateSendParameters(a,A),await this.connection.updateEncoderConfig(a,A),this.emit(Ke.UpdateVideoEncoder,A),r()}catch(o){i(o)}finally{s()}}),N(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(le.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==Ut.Connected)return void r();const{id:a,track:A}=o;await this.connection.updateSendParameters(a,A),r()}catch(o){i(o)}finally{s()}}),N(this,"handleReplaceMixingTrack",async(n,r,i,s)=>{if(!this.connection||this.state!==Ut.Connected)return void r();const o=XB([n]);let a;S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(a=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,o),r()}catch(l){i(l)}finally{var A;(A=a)===null||A===void 0||A()}}),N(this,"handleReplaceTrack",async(n,r,i,s)=>{let o;S.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var a;const l=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:f}]=d;return n===f});if(!this.connection||!l||this.state!==Ut.Connected)return void r();if(await((a=this.connection)===null||a===void 0?void 0:a.replaceTrack(n,l[1].id)),this.isPlanB){const d=l[1];d.id=n._mediaStreamTrack.id,this.localTrackMap.set(l[0],d)}if(l[0]===le.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding){const d=this.localTrackMap.get(le.LocalVideoLowTrack);if(d){const f=n._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=f,d.track._originMediaStreamTrack=f,await new we((p,g)=>{this.handleReplaceTrack(d.track,p,g,!0)})}}r()}catch(l){i(l)}finally{var A;(A=o)===null||A===void 0||A()}}),N(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),N(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),N(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new Jte(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!bt().supportUnifiedPlan||G("CHROME_FORCE_PLAN_B")&&rh(),this.shouldForwardP2PCreation=G("FORWARD_P2P_CREATION")&&bt().supportPCSetConfiguration&&n2(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new PE({},this.store):new xc({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=Ut.New;const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new PE(t,this.store):new xc(t,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new ie(P.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=G("NEW_ICE_RESTART")?kl.FIRST_CONNECTION:kl.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new ie(P.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");G("ENABLE_PREALLOC_PC")&&this.state===Ut.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Ut.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(i=>{var s;let[o]=i;return Se(s=[le.LocalVideoLowTrack,le.LocalVideoTrack]).call(s,o)}),n=e.map(i=>{let[,{id:s}]=i;return s}),r=e.map(i=>{let[s]=i;return s});if(this.connection instanceof xc){if(Le.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!Se(t).call(t,this.store.codec)){const i=["vp9","vp8","h264"].find(s=>Se(t).call(t,s));i&&(this.store.codec=i,S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof xc&&this.connection.peerConnectionState!=="closed"&&Se(t=[Ut.New,Ut.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Ut.Connected){if(this.state===Ut.Disconnected)throw new ie(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var r;Se(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var r=this;return Xc(function*(){const i=yield Bt(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==Ut.Connected){if(r.state===Ut.Disconnected)throw new ie(P.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(t);const o=t.filter(a=>r.pendingLocalTracks.indexOf(a)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(o))}r.store.pubId=r.store.pubId+1,ki.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(t,e,n);if(s.length===0)return void(yield Bt(r.tryToUnmuteAudio(t)));yield*Q8($8(r.doPublish(r.connection,s)))}finally{i()}})()}doPublish(t,e){var n=this;return Xc(function*(){e.forEach(f=>{let{track:p,type:g}=f;const y=Date.now();n.store.publish(p.getTrackId(),g===le.LocalAudioTrack?"audio":"video",y)}),n.bindLocalTrackEvents(e);const r=e.map(f=>{let{track:p}=f;return p}),i=yield Bt(t.send(e.map(f=>{let{track:p}=f;return p}),n.store.codec,n.store.audioCodec)),s=(yield Bt(i.next())).value,o=n.createGatewayPublishMessage(e,s);let a;try{a=yield o}catch(f){throw i.throw(f),(f==null?void 0:f.code)===P.WS_ABORT&&e.forEach(p=>{let{track:g}=p;n.pendingLocalTracks.indexOf(g)===-1&&n.pendingLocalTracks.push(g)}),n.unbindLocalTrackEvents(e),f}const A=n.mapPubResToRemoteConfig(o,a),l=(yield Bt(i.next(A))).value,d=G("ENABLE_VIDEO_SEI");r.forEach(async f=>{const p=f.getRTCRtpTransceiver();p&&d&&(f.trackMediaType===Pe.VIDEO?await Y1e(p.sender,f):f.trackMediaType===Pe.AUDIO&&await async function(g){if(!bt().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(DT.has(g)||!g.track)return;const y={track:g.track};if(Fd()){if(!g.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let w=null;try{w=g.createEncodedStreams()}catch(I){return void S.error("create audio-encoded-streams error",I&&I.message)}const b=new TransformStream({transform(I,B){y.controller||(y.controller=B),g.track&&g.track.id!==y.track.id&&(S.debug("audio track changed: ".concat(y.track.id," => ").concat(g.track.id)),y.track.removeEventListener("ended",E),y.track=g.track,y.track.addEventListener("ended",E)),B.enqueue(I)}});w.readable.pipeThrough(b).pipeTo(w.writable)}else if(yi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const w=eS(),b=new MessageChannel;await new we(B=>w.onmessage=U=>{U.data==="registered"&&B(void 0)});const I=new RTCRtpScriptTransform(w,{name:"tx",port:b.port2},[b.port2]);g.transform=I,await new we(B=>w.onmessage=U=>{U.data==="started"&&B(void 0)}),b.port1.onmessage=B=>{var U;B.data.transformed&&g.track&&((U=g.track)===null||U===void 0?void 0:U.id)!==y.track.id&&(S.debug("audio track changed: ".concat(y.track.id," => ").concat(g.track.id)),y.track.removeEventListener("ended",E),y.track=g.track,y.track.addEventListener("ended",E))},y.worker=w}function E(){if(g.track){if(this.id!==g.track.id)return;g.track.removeEventListener("ended",E)}const w=DT.get(g);if(w){DT.delete(g);try{var b,I;(b=w.controller)===null||b===void 0||b.terminate(),(I=w.worker)===null||I===void 0||I.terminate()}catch(B){S.warning(B&&B.message)}}}DT.set(g,y),g.track.addEventListener("ended",E)}(p.sender))}),e.forEach(f=>{let{type:p}=f;n.statsCollector.addLocalStats(p)}),n.assignLocalTracks(e,l),n.statsUploader.startUploadOutboundStats(),e.forEach(f=>{let{track:p,type:g}=f;const y=Date.now();n.store.publish(p.getTrackId(),g===le.LocalAudioTrack?"audio":"video",void 0,y)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n)return;if(!(n.track instanceof pn))return S.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof xc||this.connection instanceof PE))return S.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:r}=n,i=function(s,o){const a={};return s.height&&s.width&&(a.scaleResolutionDownBy=NP(s,o)),a.maxFramerate=s.framerate?Oo(s.framerate):void 0,a.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,a}(t,r);if(r._encoderConfig||(r._encoderConfig={}),e!==le.LocalVideoLowTrack||!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return S.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(o,a){const A=o.canvas;a.width&&(A.width=Oo(a.width)),a.height&&(A.height=Oo(a.height)),a.framerate&&(A.stopCapture&&A.stopCapture(),A.stopCapture=f2(()=>{!A.startCapture&&A.stopCapture&&A.stopCapture(),A.startCapture&&A.startCapture()},Oo(a.framerate)))})(s,t)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),S.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(t){var e=this;return Xc(function*(){if(!e.connection||e.state!==Ut.Connected)return;const n=yield Bt(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=e.localTrackMap.get(le.LocalVideoTrack);if(!i)throw new ie(P.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(le.LocalVideoLowTrack))throw new ie(P.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:e.getLowVideoTrack(i.track,t),type:le.LocalVideoLowTrack}];if(yield*Q8($8(e.doPublish(e.connection,s))),i.track.muted||!i.track.enabled){var r;const o=(r=e.localTrackMap.get(le.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;o!==void 0&&(yield Bt(e.connection.muteLocal([o])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await vi(this,Ke.RequestRePublish,this.pendingLocalTracks),this.emit(Ke.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(S.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await vi(this,Ke.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:r}=this.pendingRemoteTracks[e];(r!==Pe.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==Pe.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await vi(this,Ke.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===Pe.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(Ke.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Ut.Connected)return void t.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Ut.Connected)return void t.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Ut.Connected)return;const t=this.localTrackMap.get(le.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[le.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[i,{track:s}]=r;return{type:i,track:s}})),e.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Ut.Connected)throw new ie(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(t))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(t)?(i=this.remoteDataChannelMap.get(t))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(t,new Map([[r.id,r]]));const s=this.pendingRemoteDataChannels.findIndex(o=>{let{user:a,id:A}=o;return a.uid===t.uid&&A===r.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(r=>r.id)}async subscribe(t,e,n,r,i){var s;if(!this.connection||this.state!==Ut.Connected)throw new ie(P.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(t))!==null&&s!==void 0&&s.has(e))return;let o,a,A;const l=this.connection.getPreMedia(n);if(l)S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),A=l.transceiver,o=l.track,a=l.id;else if(i){const p=i.find(y=>{let{stream_type:E}=y;return E===e});if(!p)throw new ie(P.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const g=await this.connection.receive(e,p.ssrcs,String(t._uintid),p.attributes);this.connection instanceof xc&&(A=g.transceiver),o=g.track,a=g.id}else{const p=await this.connection.receive(e,[{ssrcId:n,rtx:r}],String(t._uintid),void 0);this.connection instanceof xc&&(A=p.transceiver),o=p.track,a=p.id}e===Pe.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(o):(t._audioTrack=new ig(o,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),A&&t._audioTrack._updateRtpTransceiver(A),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(o):(t._videoTrack=new rg(o,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),A&&t._videoTrack._updateRtpTransceiver(A),this.bindRemoteTrackEvents(t,t._videoTrack)),G("ENABLE_VIDEO_SEI")&&A&&(e==Pe.VIDEO?await async function(p){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!bt().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(!p.track)return;if(LE.has(p)){const w=LE.get(p);return void(w&&(w.onSei=g.onSei))}const y={track:p.track,onSei:g.onSei};if(Fd()){if(!p.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let w=null;try{w=p.createEncodedStreams()}catch(I){return void S.error("create video-encoded-streams error",I&&I.message)}const b=new TransformStream({transform(I,B){y.controller||(y.controller=B),p.track&&p.track.id!==y.track.id&&(S.debug("video track changed: ".concat(y.track.id," => ").concat(p.track.id)),y.track.removeEventListener("ended",E),y.track=p.track,y.track.addEventListener("ended",E));const U=function(H){const K=new DataView(H.data);let x=0;for(;x+4<H.data.byteLength;){if(K.getUint8(x+0)===0&&K.getUint8(x+1)===0&&K.getUint8(x+2)===0&&K.getUint8(x+3)===1&&K.getUint8(x+4)===6){let V=x+6,M=0,O=0;for(;(O=K.getUint8(V++))===255;)M+=255;M+=O;const z=q1e(H.data,V,M);return new Uint8Array(z)}x++}return null}(I);U&&y.onSei&&y.onSei(U),B.enqueue(I)}});w.readable.pipeThrough(b).pipeTo(w.writable)}else if(yi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const w=eS(),b=new MessageChannel;await new we(B=>w.onmessage=U=>{U.data==="registered"&&B(void 0)});const I=new RTCRtpScriptTransform(w,{name:"rx",port:b.port2},[b.port2]);p.transform=I,await new we(B=>w.onmessage=U=>{U.data==="started"&&B(void 0)}),b.port1.onmessage=B=>{var U;B.data.transformed&&p.track&&((U=p.track)===null||U===void 0?void 0:U.id)!==y.track.id?(S.debug("video track changed: ".concat(y.track.id," => ").concat(p.track.id)),y.track.removeEventListener("ended",E),y.track=p.track,y.track.addEventListener("ended",E)):B.data.sei&&y.onSei&&y.onSei(B.data.sei)},y.worker=w}function E(){if(p.track){if(this.id!==p.track.id)return;p.track.removeEventListener("ended",E)}(function(w){const b=LE.get(w);if(b){LE.delete(w);try{var I,B;(I=b.controller)===null||I===void 0||I.terminate(),(B=b.worker)===null||B===void 0||B.terminate()}catch(U){S.warning(U&&U.message)}}})(p)}LE.set(p,y),p.track.addEventListener("ended",E)}(A.receiver,{onSei:p=>{var g;(g=t._videoTrack)===null||g===void 0||g._onSei(p)}}):e==Pe.AUDIO&&await async function(p){if(!bt().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(BT.has(p))return;const g={track:p.track};if(Fd()){if(!p.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let E=null;try{E=p.createEncodedStreams()}catch(b){return void S.error("create audio-encoded-streams error",b&&b.message)}const w=new TransformStream({transform(b,I){g.controller||(g.controller=I),p.track&&p.track.id!==g.track.id&&(S.debug("audio track changed: ".concat(g.track.id," => ").concat(p.track.id)),g.track.removeEventListener("ended",y),g.track=p.track,g.track.addEventListener("ended",y)),I.enqueue(b)}});E.readable.pipeThrough(w).pipeTo(E.writable)}else if(yi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const E=eS(),w=new MessageChannel;await new we(I=>E.onmessage=B=>{B.data==="registered"&&I(void 0)});const b=new RTCRtpScriptTransform(E,{name:"rx",port:w.port2},[w.port2]);p.transform=b,await new we(I=>E.onmessage=B=>{B.data==="started"&&I(void 0)}),w.port1.onmessage=I=>{var B;I.data.transformed&&p.track&&((B=p.track)===null||B===void 0?void 0:B.id)!==g.track.id&&(S.debug("audio track changed: ".concat(g.track.id," => ").concat(p.track.id)),g.track.removeEventListener("ended",y),g.track=p.track,g.track.addEventListener("ended",y))},g.worker=E}function y(){p.track.removeEventListener("ended",y),function(E){const w=BT.get(E);if(w){BT.delete(E);try{var b,I;(b=w.controller)===null||b===void 0||b.terminate(),(I=w.worker)===null||I===void 0||I.terminate()}catch(B){S.warning(B&&B.message)}}}(p)}BT.set(p,g),p.track.addEventListener("ended",y)}(A.receiver));const d=this.remoteUserMap.get(t);d?d.set(e,a):this.remoteUserMap.set(t,new Map([[e,a]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const f=this.pendingRemoteTracks.findIndex(p=>{let{user:g,kind:y}=p;return g.uid===t.uid&&e===y});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Ke.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Ut.Connected)throw new ie(P.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(i=>{var s;let{user:o,mediaType:a}=i;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(a))});const e=[],n=new Map;t.forEach(i=>{if(!this.connection)return;const s=this.connection.getPreMedia(i.ssrcId);s?n.set(i.ssrcId,s):e.push(i)});const r=await this.connection.batchReceive(e.map(i=>{let{user:s,mediaType:o,ssrcId:a,rtxSsrcId:A}=i;return{kind:o,ssrcMsg:[{ssrcId:a,rtx:A}],mslabel:String(s._uintid)}}));e.forEach((i,s)=>{n.set(i.ssrcId,r[s])}),t.forEach(i=>{let{user:s,mediaType:o,ssrcId:a}=i;const A=n.get(a);if(!A)return void S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(o,", ").concat(a));const{track:l,id:d,transceiver:f}=A;o===Pe.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(l):(s._audioTrack=new ig(l,s.uid,s._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),f&&s._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(l):(s._videoTrack=new rg(l,s.uid,s._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),f&&s._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(s,s._videoTrack));const p=this.remoteUserMap.get(s);p?p.set(o,d):this.remoteUserMap.set(s,new Map([[o,d]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const g=this.pendingRemoteTracks.findIndex(y=>{let{user:E,kind:w}=y;return E.uid===s.uid&&o===w});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(Ke.MediaReconnectEnd,s.uid))})}async unsubscribe(t,e,n){const r=this.pendingRemoteTracks.filter(o=>{let{user:a,kind:A}=o;return e!==void 0?a.uid===t.uid&&e===A:a.uid===t.uid});if(r.forEach(o=>{const a=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(a,1)}),this.connection&&this.state===Ut.Connected||n||r.forEach(o=>{let{kind:a}=o;var A;if(a===Pe.AUDIO)(A=t._audioTrack)===null||A===void 0||A._destroy(),t._audioTrack=void 0;else if(a===Pe.VIDEO){var l;(l=t._videoTrack)===null||l===void 0||l._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Ut.Connected)return;const i=this.filterTobeUnSubscribedTracks(t,e);if(i.length===0)return;await this.connection.stopReceiving(i.map(o=>{let[,{id:a}]=o;return a}));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(o=>{let[a,{kind:A}]=o;var l,d;if(A===Pe.VIDEO&&a._videoSSRC&&((l=this.connection)===null||l===void 0||l.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),A===Pe.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),n||((d=a._videoTrack)===null||d===void 0||d._destroy(),a._videoTrack=void 0);else if(A===Pe.AUDIO){var f;this.unbindRemoteTrackEvents(a._audioTrack),!n&&((f=a._audioTrack)===null||f===void 0||f._destroy(),a._audioTrack=void 0)}}),s}async unsubscribeDataChannel(t,e){if(e.forEach(i=>{const s=this.pendingRemoteDataChannels.findIndex(o=>o.id===i.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(t);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(i=>i.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:i,mediaType:s}of t){const o=this.pendingRemoteTracks.filter(a=>{let{user:A,kind:l}=a;return s!==void 0?A.uid===i.uid&&s===l:A.uid===i.uid});o.forEach(a=>{const A=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(A,1)}),e=e.concat(o)}if(!this.connection||this.state!==Ut.Connected)return void e.forEach(i=>{let{user:s,kind:o}=i;var a;if(o===Pe.AUDIO)(a=s._audioTrack)===null||a===void 0||a._destroy(),s._audioTrack=void 0;else if(o===Pe.VIDEO){var A;(A=s._videoTrack)===null||A===void 0||A._destroy(),s._videoTrack=void 0}});const n=Zc(t).call(t,(i,s)=>{let{user:o,mediaType:a}=s;const A=this.filterTobeUnSubscribedTracks(o,a);return i.concat(A)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(i=>{let[,{id:s}]=i;return s}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[s,{kind:o}]=i;var a,A;if(o===Pe.VIDEO&&s._videoSSRC&&((a=this.connection)===null||a===void 0||a.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===Pe.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(A=s._videoTrack)===null||A===void 0||A._destroy(),s._videoTrack=void 0;else if(o===Pe.AUDIO){var l;this.unbindRemoteTrackEvents(s._audioTrack),(l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0}}),r}isPreSubScribe(t){return!this.connection||this.state!==Ut.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const r=e===Pe.VIDEO?t._videoSSRC:t._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(le.LocalAudioTrack);if((e==null?void 0:e.track)instanceof wr){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==le.LocalAudioTrack}).filter(r=>{let[i]=r;return!(t&&i===le.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(t&&r===le.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,r,i){if(t){const o=this.localTrackMap.get(le.LocalAudioTrack),a=r?this.localTrackMap.get(le.LocalVideoLowTrack):this.localTrackMap.get(le.LocalVideoTrack);Le.publish(this.store.sessionId,{eventElapse:ki.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:o==null?void 0:o.track.getTrackLabel(),videoName:a==null?void 0:a.track.getTrackLabel(),screenshare:(a==null?void 0:a.track._hints.indexOf(En.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find(A=>A instanceof kn),a=r?(s=this.localTrackMap.get(le.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(A=>A instanceof pn);Le.publish(this.store.sessionId,{eventElapse:ki.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:o==null?void 0:o.getTrackLabel(),videoName:a==null?void 0:a.getTrackLabel(),screenshare:(a==null?void 0:a._hints.indexOf(En.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(t,e,n,r){const i=r===Pe.VIDEO?n._videoSSRC:n._audioSSRC;i&&Le.subscribe(this.store.sessionId,{succ:t,ec:e,video:r===Pe.VIDEO,audio:r===Pe.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:ki.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new xi("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new PE({},this.store):new xc({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(le.LocalAudioTrack);if((t==null?void 0:t.track)instanceof wr){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Ut.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(le.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(le.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof pn||e&&e.track instanceof kn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(Ko(e=this.remoteUserMap).call(e)).find(r=>r.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(le.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=_w(t).call(t,(n,r)=>n.level-r.level),t}async disconnectForReconnect(){this.connection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Ut.Reconnecting,G("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new PE({},this.store):new xc({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:r}]=t;switch(n){case le.LocalVideoTrack:Se(e=r._hints).call(e,En.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case le.LocalAudioTrack:r instanceof wr?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case le.LocalVideoLowTrack:}}),this.emit(Ke.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Ko(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(e,r)}),this.emit(Ke.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Ko(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(e,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((t instanceof Ed?t.uid:t)===r.uid&&i===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((t instanceof Ed?t.uid:t)===r.uid&&e===i)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return Xc(function*(){if(!e.connection||e.state!==Ut.Connected)return;const n=yield Bt(e.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield Bt(e.connection.restartICE(t));const s=yield Bt(r.next());if(s.done)return;const o=s.value,a=yield o;switch(e.reportPCDisconnectedOrFailed(t),t){case Io.TCP:e._pcStatsUploadType=kl.TCP_RESTART;break;case Io.RELAY:e._pcStatsUploadType=kl.RELAY_RESTART;break;default:e._pcStatsUploadType=kl.OLD_RESTART}e._isInRestartIce=!0,r.next(a)}catch(s){var i;(i=r)===null||i===void 0||i.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(le.LocalVideoTrack),n=this.localTrackMap.get(le.LocalAudioTrack),r=t.videoSend.find(g=>g.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),i=t.audioSend.find(g=>g.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!i)return 1;const s=Sa(this,Ke.NeedSignalRTT),o=r?r.rttMs:void 0,a=i?i.rttMs:void 0,A=o&&a?(o+a)/2:o||a,l=(A&&s?(A+s)/2:A||s)||0,d=100*t.sendPacketLossRate*.7/50+.3*l/1500,f=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,p=e==null?void 0:e.track;if(p&&p._encoderConfig&&p._hints.indexOf(En.SCREEN_TRACK)===-1){const g=p._encoderConfig.bitrateMax,y=t.bitrate.actualEncoded;if(g&&y){const E=(1e3*g-y)/(1e3*g);return Wee[E<.15?0:E<.3?1:E<.45?2:E<.6?3:4][f]}}return f}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=t.audioRecv.find(y=>y.ssrc===i),a=t.videoRecv.find(y=>y.ssrc===s);if(!o&&!a)return void(e+=1);const A=Sa(this,Ke.NeedSignalRTT),l=t.rtt,d=(l&&A?(l+A)/2:l||A)||0,f=o?o.jitterMs:void 0,p=t.recvPacketLossRate;let g=.7*p*100/50+.3*d/1500;f&&(g=.6*p*100/50+.2*d/1500+.2*f/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new we((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(S.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==Ut.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return t===o});if(!r)return;const i=r[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:i}]),this.bindLocalTrackEvents([{track:e,type:i}]),r[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,r[1].id)),this.isPlanB){const s=r[1];s.id=e._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===le.LocalVideoTrack&&!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding){const s=this.localTrackMap.get(le.LocalVideoLowTrack);if(s){const o=t._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new we((a,A)=>{this.handleReplaceTrack(s.track,a,A,!0)})}}}filterTobePublishedTracks(t,e,n){const r=[],i=this.getAllTracks();t=Mm(t=t.filter(A=>i.indexOf(A)===-1));let s,o=!1;const a=this.localTrackMap.get(le.LocalAudioTrack);for(const A of t){if(A instanceof pn&&(this.localTrackMap.has(le.LocalVideoTrack)||o?new ie(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:A,type:le.LocalVideoTrack}),o=!0),e)){const l=this.getLowVideoTrack(A,n);r.push({track:l,type:le.LocalVideoLowTrack})}if(A instanceof kn)if(a){const l=a.track;if(l instanceof wr)KP([A]),l.addAudioTrack(A),this.bindLocalAudioTrackEvents(A,!0);else{const d=XB([l,A]);S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),this.replaceTrack(l,d)}}else s instanceof wr?(KP([A]),s.addAudioTrack(A)):s||!A._useAudioElement&&bt().webAudioMediaStreamDest&&!A._bypassWebAudio?s=XB(s?[A,s]:[A]):s=A}return s&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:le.LocalAudioTrack})),r}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Mm(t=t.filter(r=>n.indexOf(r)!==-1));for(const r of t){if(r instanceof kn){const i=this.localTrackMap.get(le.LocalAudioTrack);if(!i)continue;i.track instanceof wr?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(e.push([le.LocalAudioTrack,i]),i.track.close())):e.push([le.LocalAudioTrack,i])}if(r instanceof pn){const i=this.localTrackMap.get(le.LocalVideoTrack);if(!i)continue;e.push([le.LocalVideoTrack,i]);const s=this.localTrackMap.get(le.LocalVideoLowTrack);s&&e.push([le.LocalVideoLowTrack,s])}}return e}filterTobePublishedDataChannels(t){return t=(t=Mm(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Mm(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:r}=e;switch(r){case le.LocalVideoTrack:n.addListener(be.GET_STATS,this.handleGetLocalVideoStats),n.addListener(be.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case le.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof wr?t.trackList.forEach(n=>{n.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(be.GET_STATS,this.handleGetLocalAudioStats),n.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(be.GET_STATS,this.handleGetLocalAudioStats),t.addListener(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(be.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:r}]=e;return{track:r,type:n}})),t.forEach(e=>{let{track:n,type:r}=e;switch(r){case le.LocalVideoTrack:n.off(be.GET_STATS,this.handleGetLocalVideoStats),n.off(be.GET_RTC_STATS,this.handleGetRTCStats),n.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(be.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(be.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case le.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case le.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof wr?t.trackList.forEach(e=>{e.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(be.GET_STATS,this.handleGetLocalAudioStats),e.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(be.GET_STATS,this.handleGetLocalAudioStats),t.off(be.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(be.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(be.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(be.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(be.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(be.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof rg&&e.addListener(be.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof ig&&e.addListener(be.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(be.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(Pe.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(Pe.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,r)=>{var i;let s,o,{track:a,type:A}=n;switch(A){case le.LocalAudioTrack:s=kt.Audio,o={dtx:a instanceof Eb&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case le.LocalVideoTrack:s=Se(i=a._hints).call(i,En.SCREEN_TRACK)?kt.Screen:kt.High,o=DA(DA({},W6(a)),{},{codec:this.store.codec,svc_mode:MP()});break;case le.LocalVideoLowTrack:s=kt.Low,o=DA(DA({},W6(a)),{},{codec:this.store.codec,svc_mode:MP()})}return{stream_type:s,attributes:o,ssrcs:e[r]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case le.LocalVideoTrack:r=Se(n=s._hints).call(n,En.SCREEN_TRACK)?kt.Screen:kt.High;break;case le.LocalAudioTrack:r=kt.Audio;break;case le.LocalVideoLowTrack:r=kt.Low}return{stream_type:r,ssrcs:o,mid:a}})}assignLocalTracks(t,e){t.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:e[r].id,ssrcs:e[r].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(Ke.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),G("NEW_ICE_RESTART")){var n;if(Se(n=this._restartStates).call(n,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=o=>{(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")&&(S.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(o)),Sa(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ke.RequestRestartICE,o))},i=()=>{t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="checking"&&t.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),S.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},s=G("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(G("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&bt().supportPCSetConfiguration)r(Io.RELAY),this._restartTimer=window.setTimeout(i,s);else if(Fn())r(Io.UDP),this._restartTimer=window.setTimeout(i,4e3);else{if(r(Io.TCP),bt().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{r(Io.RELAY),this._restartTimer=window.setTimeout(i,s)},s));this._restartTimer=window.setTimeout(i,s)}},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&G("ICE_RESTART")&&Sa(this,Ke.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ke.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Ke.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Le.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:xn.TRACER}).onSuccess(),this.emit(Ke.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const r=Array.from(Ko(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(ng.FIRST_FRAME_DECODED),Le.firstRemoteFrame(this.store.sessionId,$r.FIRST_AUDIO_DECODE,Dn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:ki.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const r=Array.from(Ko(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===e);r&&Le.firstRemoteFrame(this.store.sessionId,$r.FIRST_AUDIO_RECEIVED,Dn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:ki.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,r)=>{this.reportVideoFirstFrameDecoded(e,n,r)},t.onFirstVideoReceived=e=>{var n;const r=Array.from(Ko(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===e);r&&Le.firstRemoteFrame(this.store.sessionId,$r.FIRST_VIDEO_RECEIVED,Dn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:ki.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const r=e.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Ke.ConnectionTypeChange,r),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Id(n))," -> ").concat(JSON.stringify(Id(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Id(n))," -> ").concat(JSON.stringify(Id(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return DA(DA({},e),n)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(le.LocalAudioTrack);if(t instanceof kn&&(n==null?void 0:n.track)instanceof wr)return n.track.isActive||e.push([le.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return t===s});if(r&&(e.push(r),r[0]===le.LocalVideoTrack)){const i=this.localTrackMap.get(le.LocalVideoLowTrack);i&&e.push([le.LocalVideoLowTrack,i])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(le.LocalAudioTrack);if(t instanceof kn&&(n==null?void 0:n.track)instanceof wr)return n.track.isActive&&e.push([le.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return t===s});if(r)if(r[0]===le.LocalVideoTrack){e.push(r);const i=this.localTrackMap.get(le.LocalVideoLowTrack);i&&e.push([le.LocalVideoLowTrack,i])}else e.push(r);return e}createMuteMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case le.LocalAudioTrack:r=kt.Audio;break;case le.LocalVideoTrack:r=Se(n=s._hints).call(n,En.SCREEN_TRACK)?kt.Screen:kt.High;break;case le.LocalVideoLowTrack:r=kt.Low}return{stream_type:r,ssrcs:o,mid:a}})}createUnmuteMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case le.LocalAudioTrack:r=kt.Audio;break;case le.LocalVideoTrack:r=Se(n=s._hints).call(n,En.SCREEN_TRACK)?kt.Screen:kt.High;break;case le.LocalVideoLowTrack:r=kt.Low}return{stream_type:r,ssrcs:o,mid:a}})}filterTobeUnSubscribedTracks(t,e){const n=[],r=this.remoteUserMap.get(t);if(!r)return n;if(e){const i=r.get(e);if(!i)return n;n.push([t,{kind:e,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,o]=i;n.push([t,{kind:s,id:o}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(t))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case Pe.VIDEO:return void(r._videoSSRC&&e.push({stream_type:Pe.VIDEO,ssrcId:r._videoSSRC}));case Pe.AUDIO:return void(r._audioSSRC&&e.push({stream_type:Pe.AUDIO,ssrcId:r._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[r,{kind:i}]=n;if(e.has(r)){let s=e.get(r);i===Pe.VIDEO?s|=Lr.Video:s|=Lr.Audio,e.set(r,s)}else i===Pe.VIDEO?e.set(r,Lr.Video):e.set(r,Lr.Audio)}),{users:Array.from(e.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:r}]=e;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(le.LocalVideoTrack),n=this.localTrackMap.get(le.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e){return t.map((n,r)=>{var i;let{stream_type:s}=n;return(i=e.find(o=>{let{stream_type:a}=o;return s===a}))===null||i===void 0?void 0:i.attributes})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof kn){var e;const r=this.filterTobeUnmutedTracks(t[n]);if(r.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(r.map(s=>{let[,{id:o}]=s;return o})));const i=this.createUnmuteMessage(r);return void await Jt(this,Ke.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Ke.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Ke.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ai(i2(this.dtlsFailedCount,fr)),this.emit(Ke.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await vi(this,Ke.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(Ke.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(le.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof pn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof pn).length>1)throw new ie(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof kn).length>1&&(t.some(e=>e instanceof kn&&e._bypassWebAudio)||!bt().webAudioMediaStreamDest))throw new ie(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof pn&&this.pendingLocalTracks.some(n=>n instanceof pn))throw new ie(P.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof kn&&this.pendingLocalTracks.some(n=>n instanceof kn)&&(!bt().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof kn&&n._bypassWebAudio)))throw new ie(P.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!G("DISABLE_DUAL_STREAM_USE_ENCODING")&&bt().supportDualStreamEncoding,r=DA(DA({},{width:160,height:120,framerate:15,bitrate:50}),e);let i;i=n?t._mediaStreamTrack.clone():jP(t,r);const s=nn(8,"track-low-"),o=new pn(i,DA(DA({},n&&{scaleResolutionDownBy:NP(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(If.TRANSCEIVER_UPDATED,a=>{t._updateRtpTransceiver(a,kg.LOW_STREAM)}),o._hints.push(En.LOW_STREAM),t.on("sei-to-send",a=>{o.emit("sei-to-send",a)}),t.addListener(be.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof xc){var i,s,o,a;const A=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:d,peerConnectionState:f}=this.connection,{local:p,remote:g}=await this.connection.getSelectedCandidatePair();Le.pcStats(this.store.sessionId,{startTime:A,eventElapse:t-A||0,iceconnectionsate:l,dtlsstate:d,connectionstate:f,intSucc:e?1:2,error:r,selectedLocalCandidateProtocol:(i=p==null?void 0:p.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=p.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(p.address,":").concat(p.port),selectedRemoteCandidateProtocol:(o=g.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(a=g.candidateType)!==null&&a!==void 0?a:"",selectedRemoteCandidateAddress:"".concat(g.address,":").concat(g.port),restartCnt:n,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(t,e,n,r){var i;const s=Array.from(Ko(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===t);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,a=o.subscribe.find(A=>A.userId===s.uid&&A.type==="video");Le.firstRemoteVideoDecode(this.store.sessionId,$r.FIRST_VIDEO_DECODE,Dn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:ki.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(a==null?void 0:a.subscribeEnd)||0,subscriberStart:(a==null?void 0:a.subscribeStart)||0,videoAddNotify:(a==null?void 0:a.streamAdded)||0,state:r?1:0,firstFrame:(a==null?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(t);if(!r)return!1;const i=r.get(e);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===le.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,kg.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(t){this.connection&&this.connection instanceof xc&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===kl.TCP_RESTART&&t===Io.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,kl.DISCONNECTED_OR_FAILED)))}},Oe(At.prototype,"startP2PConnection",[is],Object.getOwnPropertyDescriptor(At.prototype,"startP2PConnection"),At.prototype),Oe(At.prototype,"connect",[is],Object.getOwnPropertyDescriptor(At.prototype,"connect"),At.prototype),Oe(At.prototype,"updateRemoteRTPCapabilities",[is],Object.getOwnPropertyDescriptor(At.prototype,"updateRemoteRTPCapabilities"),At.prototype),Oe(At.prototype,"publishDataChannel",[is],Object.getOwnPropertyDescriptor(At.prototype,"publishDataChannel"),At.prototype),Oe(At.prototype,"unpublish",[is],Object.getOwnPropertyDescriptor(At.prototype,"unpublish"),At.prototype),Oe(At.prototype,"unpublishDataChannel",[is],Object.getOwnPropertyDescriptor(At.prototype,"unpublishDataChannel"),At.prototype),Oe(At.prototype,"unpublishLowStream",[is],Object.getOwnPropertyDescriptor(At.prototype,"unpublishLowStream"),At.prototype),Oe(At.prototype,"subscribeDataChannel",[is],Object.getOwnPropertyDescriptor(At.prototype,"subscribeDataChannel"),At.prototype),Oe(At.prototype,"subscribe",[is],Object.getOwnPropertyDescriptor(At.prototype,"subscribe"),At.prototype),Oe(At.prototype,"massSubscribe",[is],Object.getOwnPropertyDescriptor(At.prototype,"massSubscribe"),At.prototype),Oe(At.prototype,"unsubscribe",[is],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribe"),At.prototype),Oe(At.prototype,"unsubscribeDataChannel",[is],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribeDataChannel"),At.prototype),Oe(At.prototype,"massUnsubscribe",[is],Object.getOwnPropertyDescriptor(At.prototype,"massUnsubscribe"),At.prototype),Oe(At.prototype,"muteRemote",[is],Object.getOwnPropertyDescriptor(At.prototype,"muteRemote"),At.prototype),Oe(At.prototype,"unmuteRemote",[is],Object.getOwnPropertyDescriptor(At.prototype,"unmuteRemote"),At.prototype),Oe(At.prototype,"hasRemoteMediaWithLock",[is],Object.getOwnPropertyDescriptor(At.prototype,"hasRemoteMediaWithLock"),At.prototype),Oe(At.prototype,"disconnectForReconnect",[is],Object.getOwnPropertyDescriptor(At.prototype,"disconnectForReconnect"),At.prototype),Oe(At.prototype,"updateBitrateLimit",[is],Object.getOwnPropertyDescriptor(At.prototype,"updateBitrateLimit"),At.prototype),Oe(At.prototype,"remoteMediaSsrcChanged",[is],Object.getOwnPropertyDescriptor(At.prototype,"remoteMediaSsrcChanged"),At.prototype),At);function is(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PChannel.".concat(e));try{for(var o=arguments.length,a=new Array(o),A=0;A<o;A++)a[A]=arguments[A];return await r.apply(this,a)}finally{s()}},n}const tne={};function kE(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&S.debug("install service ".concat(t.name)),tne[t.name]=t}function ry(t){const e=tne[t];if(!e)throw new ie(P.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function Z8(t,e){return ry("DataStream").create(t,e)}function e9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function t9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?e9(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const NLe=Date.now(),DLe=20,GP=new Map,iS=new Map;async function nne(t){const e=GP.get(t),n=Array.isArray(e)&&e[e.length-1],r=iS.get(t);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const s=n.sendTs-r.firstSendTs,o=s-(Date.now()-r.firstRecvTs);o>0&&(r.firstRecvTs=Date.now()-s);let a=n.mediaDelay+o;a<=0?(e.pop(),rne(n.context,i),a=0):a=Math.min(a,DLe),setTimeout(()=>e.length&&nne(t),a)}function rne(t,e){t.safeEmit(gt.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function BLe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return rne(n,{uid:t.uid,payload:t.payload});const r="".concat(n.id,"-").concat(t.uid),i=GP.get(r)||[],s=i.findIndex(l=>t.sendTs>=l.sendTs),o=t9(t9({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});s===-1?i.push(o):i.splice(s,0,o),GP.set(r,i);let a=!1;var A;iS.has(r)?a=!((A=iS.get(r))===null||A===void 0||!A.isSyncing):iS.set(r,{isSyncing:a,firstRecvTs:0,firstSendTs:0}),a||nne(r)}const LLe=Ct().name;function n9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function r9(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?n9(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):n9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const ag="websdk_ng_cache_parameter",PLe=G("MAX_PRELOAD_ASYNC_LENGTH"),ULe=1e4,af=new Map,cf=[];let $B=null,ZB=0,e1=0;const QT=new Map,kLe=function(t,e){const n=[];let r=0;const i=async()=>{const s=n.shift();s&&await s(),n.length>0&&r<e?i():r--};return async function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return new we(async(A,l)=>{n.push(async()=>{try{const d=await t(...o);A(d)}catch(d){l(d)}}),r<e&&(r++,i())})}}(ine,PLe),t1=Xs.CancelToken.source();async function ine(t,e,n,r,i,s){try{if(!G("ENABLE_PRELOAD"))return;if(!bt().supportWebCrypto)return void ih(()=>{S.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new ie(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ei(n,"token",1,2047),ei(t,"appid",1,2047),$I(e),r&&ZI(r);const o=Fm();S.debug("preload channel ".concat(e,", uid is ").concat(r));const a={appId:t,cname:e,token:n||t,uid:typeof r!="string"?r:null,sid:o,proxyServer:i};let A,l;typeof r=="string"?(a.stringUid=r,[l,A]=await we.all([nLe(r,{sid:o,appId:t},t1.token),c8(r9(r9({},a),{},{token:n||t,uid:0}),t1.token)]),a.uid=l.uid,A.gatewayInfo.uid=a.uid,A.gatewayInfo.res.uid=a.uid):(s&&(a.stringUid=s),A=await c8(a,t1.token));const d={sid:o,appId:t,cname:e,token:n||t,uid:a.stringUid||r,intUid:a.uid||A.gatewayInfo.uid,stringUid:a.stringUid,ts:Date.now(),sua:l,ap:A};await async function(f){let p;try{f.uid&&sne({appId:f.appId,cname:f.cname,token:f.token,uid:f.uid,stringUid:f.stringUid});const g=cne(f),y=await async function(w,b){try{const I=await window.crypto.subtle.importKey("raw",Qee(b),"AES-GCM",!1,["encrypt"]),B=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},I,mf(window.btoa(JSON.stringify(w))));return Vd(new Uint8Array(B))}catch{return}}(f,f.token||f.appId);if(!y)return;p=ane(ag);const E=p?JSON.parse(p):[];E.push({[g]:y}),E.length>G("AP_CACHE_NUM")&&E.shift(),Tb(ag,JSON.stringify(E))}catch(g){S.warn("Error caching server parameters:",g.message),Tb(ag,"")}}(d),ZB++}catch(o){throw e1++,function(a){$B||($B=window.setTimeout(()=>{let l="";QT.forEach((d,f)=>{l+="".concat(f,": ").concat(d," ;")}),Le.reportApiInvoke(null,{name:Cr.PRELOAD,options:{success:ZB,failed:e1,err:l}}).onError(a),ZB=0,e1=0,QT.clear(),$B=null},ULe));const A=QT.get(a.code)||0;QT.set(a.code,A+1)}(o),o}}async function i9(t){try{const e=sne(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(r,i){try{const s=await window.crypto.subtle.importKey("raw",Qee(i),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,mf(r));return JSON.parse(window.atob(Vd(new Uint8Array(o))))}catch{return}}(e,t.token||t.appId);if(!n||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<G("AP_CACHE_LIFETIME"))return n}catch(e){S.warn("Error get preloadInfo",e.message)}}function sne(t){let e;try{if(e=ane(ag),!e)return;const n=JSON.parse(e),r=cne(t),i=function(o,a){for(let A=o.length-1;A>=0;A--)if(a(o[A]))return A;return-1}(n,o=>r in o);if(i===-1)return;const s=n.splice(i,1)[0];return Tb(ag,JSON.stringify(n)),s[r]}catch(n){S.warn("Error delete preload info: ".concat(e),n.message),Tb(ag,"")}}function b2(t){if(t){let e=af.get(t);e&&(window.clearTimeout(e),e=null,af.delete(t)),Se(cf).call(cf,t)||t.cloudProxyServer!=="disabled"||cf.push(t)}if(af.size<G("AP_CACHE_NUM")&&cf.length>0){const e=cf.shift();af.set(e,window.setTimeout(async()=>{const{appId:n,cname:r,token:i,stringUid:s,uid:o,proxyServer:a}=e;try{await kLe(n,r,i,o,a,s),af.has(e)&&b2(e)}catch(A){S.warn("update preload failed",A.message),one(e)}},G("AP_UPDATE_INTERVAL")))}}function one(t){const e=cf.indexOf(t);e!==-1&&cf.splice(e,1);let n=af.get(t);n&&(window.clearTimeout(n),n=null,af.delete(t),b2())}function s9(t,e){const n=t.sua,r=t.ap;e&&n&&Le.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),Le.reportResourceTiming(t.ap.url,t.sid),Le.joinWebProxyAP(t.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[sr.CHOOSE_SERVER,sr.CLOUD_PROXY_FALLBACK].toString()}),Le.joinChooseServer(t.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[sr.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function ane(t){return window.atob(window.localStorage.getItem(t)||"")}function Tb(t,e){window.localStorage.setItem(t,window.btoa(e))}function cne(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),jee(e)}function xLe(t){let e=function(){const n=VLe.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let i=n.appId;i!==void 0&&(rr(r,10),rd(r,i));let s=n.cid;s!==void 0&&(rr(r,16),rr(r,s));let o=n.cname;o!==void 0&&(rr(r,26),rd(r,o));let a=n.deviceId;a!==void 0&&(rr(r,34),rd(r,a));let A=n.elapse;A!==void 0&&(rr(r,40),id(r,A));let l=n.fileSize;l!==void 0&&(rr(r,48),id(r,rm(l)));let d=n.height;d!==void 0&&(rr(r,56),id(r,rm(d)));let f=n.jpg;f!==void 0&&(rr(r,66),rr(r,f.length),o9(r,f));let p=n.networkType;p!==void 0&&(rr(r,72),id(r,rm(p)));let g=n.osType;g!==void 0&&(rr(r,80),id(r,rm(g)));let y=n.requestId;y!==void 0&&(rr(r,90),rd(r,y));let E=n.sdkVersion;E!==void 0&&(rr(r,98),rd(r,E));let w=n.sequence;w!==void 0&&(rr(r,104),id(r,rm(w)));let b=n.sid;b!==void 0&&(rr(r,114),rd(r,b));let I=n.timestamp;I!==void 0&&(rr(r,120),id(r,I));let B=n.uid;B!==void 0&&(rr(r,128),rr(r,B));let U=n.vid;U!==void 0&&(rr(r,136),rr(r,U));let H=n.width;H!==void 0&&(rr(r,144),id(r,rm(H)));let K=n.service;K!==void 0&&(rr(r,152),rr(r,K));let x=n.callbackData;x!==void 0&&(rr(r,162),rr(r,x.length),o9(r,x));let V=n.ticket;V!==void 0&&(rr(r,170),rd(r,V));let M=n.vendorConfigs;M!==void 0&&(rr(r,178),rd(r,M))}(t,e),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(e)}function MLe(t){return function(n){let r={};e:for(;!QLe(n);){let i=iy(n);switch(i>>>3){case 0:break e;case 1:r.code=iy(n);break;case 2:r.msg=a9(n,iy(n));break;case 3:r.requestId=a9(n,iy(n));break;case 4:r.timestamp=HLe(n,!1);break;default:FLe(n,7&i)}}return r}({bytes:e=t,offset:0,limit:e.length});var e}function FLe(t,e){switch(e){case 0:for(;128&rc(t););break;case 2:n1(t,iy(t));break;case 5:n1(t,4);break;case 1:n1(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function rm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let VLe=[];function n1(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function QLe(t){return t.offset>=t.limit}function tR(t,e){let n=t.bytes,r=t.offset,i=t.limit,s=r+e;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),t.bytes=o}return t.offset=s,s>i&&(t.limit=s),r}function Ane(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function o9(t,e){let n=tR(t,e.length);t.bytes.set(e,n)}function a9(t,e){let n=Ane(t,e),r=String.fromCharCode,i=t.bytes,s="",o="";for(let a=0;a<e;a++){let A,l,d,f,p=i[a+n];(128&p)==0?o+=r(p):(224&p)==192?a+1>=e?o+=s:(A=i[a+n+1],(192&A)!=128?o+=s:(f=(31&p)<<6|63&A,f<128?o+=s:(o+=r(f),a++))):(240&p)==224?a+2>=e?o+=s:(A=i[a+n+1],l=i[a+n+2],(49344&(A|l<<8))!=32896?o+=s:(f=(15&p)<<12|(63&A)<<6|63&l,f<2048||f>=55296&&f<=57343?o+=s:(o+=r(f),a+=2))):(248&p)==240?a+3>=e?o+=s:(A=i[a+n+1],l=i[a+n+2],d=i[a+n+3],(12632256&(A|l<<8|d<<16))!=8421504?o+=s:(f=(7&p)<<18|(63&A)<<12|(63&l)<<6|63&d,f<65536||f>1114111?o+=s:(f-=65536,o+=r(55296+(f>>10),56320+(1023&f)),a+=3))):o+=s}return o}function rd(t,e){let n=e.length,r=0;for(let o=0;o<n;o++){let a=e.charCodeAt(o);a>=55296&&a<=56319&&o+1<n&&(a=(a<<10)+e.charCodeAt(++o)-56613888),r+=a<128?1:a<2048?2:a<65536?3:4}rr(t,r);let i=tR(t,r),s=t.bytes;for(let o=0;o<n;o++){let a=e.charCodeAt(o);a>=55296&&a<=56319&&o+1<n&&(a=(a<<10)+e.charCodeAt(++o)-56613888),a<128?s[i++]=a:(a<2048?s[i++]=a>>6&31|192:(a<65536?s[i++]=a>>12&15|224:(s[i++]=a>>18&7|240,s[i++]=a>>12&63|128),s[i++]=a>>6&63|128),s[i++]=63&a|128)}}function rc(t){return t.bytes[Ane(t,1)]}function c9(t,e){let n=tR(t,1);t.bytes[n]=e}function iy(t){let e,n=0,r=0;do e=rc(t),n<32&&(r|=(127&e)<<n),n+=7;while(128&e);return r}function rr(t,e){for(e>>>=0;e>=128;)c9(t,127&e|128),e>>>=7;c9(t,e)}function HLe(t,e){let n,r=0,i=0,s=0;return n=rc(t),r=127&n,128&n&&(n=rc(t),r|=(127&n)<<7,128&n&&(n=rc(t),r|=(127&n)<<14,128&n&&(n=rc(t),r|=(127&n)<<21,128&n&&(n=rc(t),i=127&n,128&n&&(n=rc(t),i|=(127&n)<<7,128&n&&(n=rc(t),i|=(127&n)<<14,128&n&&(n=rc(t),i|=(127&n)<<21,128&n&&(n=rc(t),s=127&n,128&n&&(n=rc(t),s|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|s<<24,unsigned:e}}function id(t,e){let n=e.low>>>0,r=(e.low>>>28|e.high<<4)>>>0,i=e.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=tR(t,s),a=t.bytes;switch(s){case 10:a[o+9]=i>>>7&1;case 9:a[o+8]=s!==9?128|i:127&i;case 8:a[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:a[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:a[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:a[o+4]=s!==5?128|r:127&r;case 4:a[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:a[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:a[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:a[o]=s!==1?128|n:127&n}}const A9={},l9={},Sb=4294967296,jLe=Sb*Sb,KLe=jLe/2;lne(0,!0);const u9=lne(0),GLe=Rv(0,-2147483648,!1),WLe=Rv(-1,2147483647,!1);function lne(t,e){let n,r,i;return e?(i=0<=(t>>>=0)&&t<256)&&(r=l9[t],r)?r:(n=Rv(t,0,!0),i&&(l9[t]=n),n):(i=-128<=(t|=0)&&t<128)&&(r=A9[t],r)?r:(n=Rv(t,t<0?-1:0,!1),i&&(A9[t]=n),n)}function Rv(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function zLe(t,e){if(isNaN(t))return u9;{if(t<=-9223372036854776e3)return GLe;if(t+1>=KLe)return WLe}return t<0?u9:Rv(t%Sb|0,t/Sb|0,e)}function d9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}class I2 extends Ln{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Qc.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),N(this,"name","AgoraRTCImageModeration"),N(this,"_connectionState",ma.CONNECTING),N(this,"_sequence",0),N(this,"_moderationStartTime",void 0),N(this,"_workerConnection",void 0),N(this,"_workerMessageLengthLimit",void 0),N(this,"_qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",Xs.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"_moderationInterval",void 0),N(this,"_moderationTimer",null),N(this,"_moderationMode",1),N(this,"_quality",1),N(this,"_qualityTimer",null),N(this,"_ticket",void 0),N(this,"_moderationIntervalMinimum",void 0),N(this,"_uploadFailedNum",0),N(this,"_uploadNum",0),N(this,"_uploadTimer",null),N(this,"_extraInfo",void 0),N(this,"_vendor",""),N(this,"_encoder",new TextEncoder),N(this,"_moderationId",void 0),N(this,"inspectImage",()=>{if(this.connectionState!==ma.CONNECTED)throw new te(P.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ma.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=nn(5,"image-moderation-"),this._workerMessageLengthLimit=G("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=G("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=G("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new vv("worker-"+this._moderationId,fr),this.on(Qc.STATE_CHANGE,(r,i)=>{S.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Yp[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(Qc.STATE_CHANGE,Yp.CONNECT_AP),this._connectInfo=e;const r=this._cancelTokenSource.token;return this._retryConfig=n,new we((i,s)=>{this.on(Qc.CONNECTION_STATE_CHANGE,(o,a)=>{o===ma.CONNECTED&&i()}),this.requestAP(e,r,n).then(o=>{this.connectWorker(o)}).catch(o=>{s(o)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),S.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===ma.CONNECTED&&this.inspectImage()}async requestAP(e,n,r){const i=G("WEBCS_DOMAIN").map(A=>"https://".concat(A,"/api/v1")),s=await function(A,l,d,f){let{appId:p,areaCode:g,cname:y,sid:E,token:w,uid:b}=l;sg++;const I="moderation_plugin",B={service_name:I,json_body:JSON.stringify({appId:p,areaCode:g,cname:y,command:"allocateEdge",requestId:sg,seq:sg,sid:E,appToken:w,ts:Date.now(),uid:b+""})};let U,H,K=A[0];return nA(async()=>{U=Date.now();const x=await rA(K,{data:B,cancelToken:d,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(H=Date.now()-U,x.code!==0){const O=new te(P.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+x.code,{retry:!0,responseTime:H});throw S.error(O.toString()),O}const V=JSON.parse(x.json_body);if(V.code!==200){const O=new te(P.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(V.code,", reason: ").concat(V.reason),{code:V.code,responseTime:H});throw S.error(O.toString()),O}if(!V.servers||!Array.isArray(V.servers)||V.servers.length===0){const O=new te(P.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:V.code,responseTime:H});throw S.error(O.toString()),O}if(!V.servers.some(O=>!!O.wss)){const O=new te(P.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:V.code,responseTime:H});throw S.error(O.toString()),O}const M=G("IMAGE_MODERATION_WORKER_HOST");return{addressList:V.servers.map(O=>{let{address:z,wss:$}=O;if(z&&$)return"wss://".concat(z.replace(/\./g,"-"),".").concat(M,":").concat($,"/moderation")}).filter(O=>!!O),workerToken:V.workerToken,vid:V.vid,ticket:V.appTicket,responseTime:H}},(x,V)=>(Le.apworkerEvent(E,{success:!0,sc:200,serviceName:I,responseDetail:JSON.stringify(x.addressList),firstSuccess:V===0,responseTime:H,serverIp:A[V%A.length]}),!1),(x,V)=>(Le.apworkerEvent(E,{success:!1,sc:x.data&&x.data.code||200,serviceName:I,responseTime:H,serverIp:A[V%A.length]}),!!(x.code!==P.OPERATION_ABORTED&&x.code!==P.UNEXPECTED_RESPONSE||x.data&&x.data.retry)&&(K=A[(V+1)%A.length],!0)),f)}(i,e,n,r);this.emit(Qc.STATE_CHANGE,Yp.AP_CONNECTED);const{addressList:o,ticket:a}=s;return this._ticket=a,o}async connectWorker(e){this.emit(Qc.STATE_CHANGE,Yp.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Ye.CONNECTED,async()=>{this.emit(Qc.STATE_CHANGE,Yp.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ma.CONNECTED}),this._workerConnection.on(Ye.CLOSED,()=>{this.connectionState=ma.CLOSED}),this._workerConnection.on(Ye.FAILED,()=>{this.connectionState=ma.CLOSED}),this._workerConnection.on(Ye.RECONNECTING,()=>{this.connectionState=this.connectionState===ma.CONNECTED?ma.RECONNECTING:ma.CONNECTING}),this._workerConnection.on(Ye.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=MLe(new Uint8Array(e.data));G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,S.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Le.reportApiInvoke(this._connectInfo.sid||null,{name:Cr.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:xn.TRACER}).onError(new te(P.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},G("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else S.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ye.WILL_RECONNECT,(e,n,r)=>{e==="recover"&&r(e),r("tryNext")}),this._workerConnection.on(Ye.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=Sa(this,Qc.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(e,n);this._workerConnection.sendMessage(r,!0,!0)}else G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:r,cname:i,cid:s,vid:o,sid:a,uid:A}=n;const l=Date.now(),d=await e.getCurrentFrameImage("image/jpeg",this.quality),f=await Ste(d,r,i),p=this._sequence+"-"+s+"-"+A+"-"+l+"-"+nn(12,""),g={appId:r,cid:s,cname:i,deviceId:"",elapse:I2.intToLong(Number(l-this._moderationStartTime)),fileSize:d.buffer.byteLength,height:d.height,width:d.width,jpg:f,networkType:6,osType:7,requestId:p,sdkVersion:"4.22.0",sequence:this._sequence,sid:a,timestamp:zLe(l),uid:A,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete g.callbackData;const y=xLe(g);if(y.byteLength<this._workerMessageLengthLimit){if(G("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const E=function(w){for(var b=1;b<arguments.length;b++){var I=arguments[b]!=null?arguments[b]:{};b%2?d9(Object(I),!0).forEach(function(B){N(w,B,I[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(I)):d9(Object(I)).forEach(function(B){Object.defineProperty(w,B,Object.getOwnPropertyDescriptor(I,B))})}return w}({},g);delete E.jpg,S.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(E))}return y}{const E=this.quality*this._qualityRatio;return this.quality=E,await this.generateRequestData(e,{appId:r,cname:i,cid:s,vid:o,sid:a,uid:A})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Xs.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ma.CLOSED,this.emit(Qc.STATE_CHANGE,Yp.CLOSED)}}function une(t){if(zt(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new te(P.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new te(P.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const qLe={name:"ImageModeration",create:function(t){let{config:e}=t;return une(e),new I2(e)}};var h9,f9,p9,m9,g9,_9,E9,y9,v9,w9,C9,T9,S9,b9,I9,R9,O9,N9,D9,B9,L9,P9,U9,k9,x9,M9,F9,V9,Q9,H9,j9,K9,G9,W9,z9,q9,Y9,X9,J9,$9,Te;function Z9(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function jc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Z9(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Z9(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}xi.setLogger(S);let YLe=(h9=je(),f9=je({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof Hm))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),p9=je({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==m_.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),m9=je({argsMap:(t,e,n,r)=>[typeof e=="object"?e.uid:e,n,r]}),g9=je({argsMap:(t,e,n)=>[e,n]}),_9=je({argsMap:(t,e)=>e.map(n=>{let{user:r,mediaType:i}=n;return[r==null?void 0:r.uid,i]})}),E9=je({argsMap:(t,e,n,r)=>[typeof e=="object"?e.uid:e,n,r]}),y9=je({argsMap:(t,e)=>e.map(n=>{let{user:r,mediaType:i}=n;return{uid:r==null?void 0:r.uid,mediaType:i}})}),v9=je(),w9=je(),C9=je(),T9=je(),S9=je(),b9=je(),I9=je(),R9=je(),O9=je(),N9=je(),D9=je(),B9=je(),L9=je(),P9=je(),U9=je({argsMap:(t,e)=>[e]}),k9=je(),x9=je(),M9=je(),F9=je(),V9=je(),Q9=je(),H9=je(),j9=je(),K9=je({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),G9=je(),W9=je(),z9=je(),q9=je(),Y9=je(),X9=je(),J9=je({reportResult:!0}),$9=je(),Te=class extends Ln{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t){let e;if(super(),N(this,"store",void 0),N(this,"_uid",void 0),N(this,"_channelName",void 0),N(this,"_uintUid",void 0),N(this,"_users",[]),N(this,"_config",void 0),N(this,"_clientId",void 0),N(this,"_appId",void 0),N(this,"_sessionId",null),N(this,"_key",void 0),N(this,"_rtmConfig",{}),N(this,"_joinInfo",void 0),N(this,"_gateway",void 0),N(this,"_statsCollector",void 0),N(this,"_configDistribute",void 0),N(this,"_leaveMutex",new xi("client-leave")),N(this,"_publishMutex",new xi("client-publish")),N(this,"_renewTokenMutex",new xi("client-renewtoken")),N(this,"_subscribeMutex",new xi("client-subscribe")),N(this,"_encryptionMode","none"),N(this,"_encryptionSecret",null),N(this,"_encryptionSalt",null),N(this,"_encryptDataStream",!1),N(this,"_encryptDataStreamKey",null),N(this,"_encryptDataStreamIv",null),N(this,"_proxyServer",void 0),N(this,"_turnServer",{servers:[],mode:"auto"}),N(this,"_cloudProxyServerMode","disabled"),N(this,"_isDualStreamEnabled",!1),N(this,"_defaultStreamFallbackType",void 0),N(this,"_lowStreamParameter",void 0),N(this,"_streamFallbackTypeCacheMap",new Map),N(this,"_remoteStreamTypeCacheMap",new Map),N(this,"_axiosCancelSource",Xs.CancelToken.source()),N(this,"_audioVolumeIndicationInterval",void 0),N(this,"_networkQualityInterval",void 0),N(this,"_userOfflineTimeout",void 0),N(this,"_streamRemovedTimeout",void 0),N(this,"_liveTranscodeStreamingClient",void 0),N(this,"_liveRawStreamingClient",void 0),N(this,"_channelMediaRelayClient",void 0),N(this,"_networkQualitySensitivity","normal"),N(this,"_p2pChannel",void 0),N(this,"_useLocalAccessPoint",!1),N(this,"_setLocalAPVersion",void 0),N(this,"_joinAndNotLeaveYet",!1),N(this,"_numberOfJoinCount",0),N(this,"_remoteDefaultVideoStreamType",void 0),N(this,"_inspect",void 0),N(this,"_moderation",void 0),N(this,"_license",void 0),N(this,"_pendingPublishedUsers",[]),N(this,"ntpAlignErrorCount",0),N(this,"remoteInboundOffset",0),N(this,"_handleLocalTrackEnable",(n,r,i)=>{this.publish(n,!1).then(r).catch(i)}),N(this,"_handleLocalTrackDisable",(n,r,i)=>{this.unpublish(n).then(r).catch(i)}),N(this,"_handleUserOnline",n=>{if(G("BLOCK_LOCAL_CLIENT")&&Gh(n.uid,this.channelName))return void S.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const r=this._users.find(i=>i.uid===n.uid);if(r)r._trust_in_room_=!0,r._is_pre_created&&(r._is_pre_created=!1,this.safeEmit(gt.USER_JOINED,r));else{const i=new Ed(n.uid,n.uint_id||n.uid);this._users.push(i),S.debug("[".concat(this._clientId,"] user online"),n.uid),this.safeEmit(gt.USER_JOINED,i)}}),N(this,"_handleUserOffline",n=>{if(G("BLOCK_LOCAL_CLIENT")&&Gh(n.uid,this.channelName))return;const r=this._users.find(i=>i.uid===n.uid);r&&(this._handleRemoveStream(n),this._handleRemoveDataChannels(n),r._audio_pre_subscribed||r._video_pre_subscribed?r._is_pre_created=!0:pb(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),S.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.safeEmit(gt.USER_LEAVED,r,n.reason))}),N(this,"_handleAddAudioOrVideoStream",(n,r,i,s,o,a,A)=>{if(G("BLOCK_LOCAL_CLIENT")&&Gh(r,this.channelName))return;const l=this._users.find(f=>f.uid===r);if(!l)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(l.uid,n,void 0,void 0,void 0,Date.now());const d=n==="audio"?l.hasAudio:l.hasVideo;l._uintid||(l._uintid=o||r),n==="audio"?l._trust_audio_stream_added_state_=!0:l._trust_video_stream_added_state_=!0,n==="audio"?(l._audio_added_=!0,i!==void 0&&(l._audioSSRC=i),s!==void 0&&(l._cname=s),a&&(l._audioOrtc=a)):(l._video_added_=!0,i!==void 0&&(l._videoSSRC=i),s!==void 0&&(l._cname=s),A!==void 0&&(l._rtxSsrcId=A),a&&(l._videoOrtc=a)),(n==="audio"?l.hasAudio:l.hasVideo)&&!d&&(S.info("[".concat(this._clientId,"] remote user ").concat(l.uid," published ").concat(n)),this.safeEmit(gt.USER_PUBLISHED,l,n)),n==="video"?Le.onGatewayStream(this._sessionId,$r.ON_ADD_VIDEO_STREAM,Dn.ON_ADD_VIDEO_STREAM,{peer:o||r,ssrc:l._videoSSRC}):Le.onGatewayStream(this._sessionId,$r.ON_ADD_AUDIO_STREAM,Dn.ON_ADD_AUDIO_STREAM,{peer:o||r,ssrc:l._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(l,n,i).then(f=>{if(f&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(l.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof VT))return this._p2pChannel.unsubscribe(l,n,!0).then(()=>this._subscribe(l,n,!0).catch(p=>{S.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(l,n)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(l.uid," after reconnect.")),this._subscribe(l,n,!0).catch(f=>{S.error("[".concat(this._clientId,"] resubscribe error"),f.toString())}))}),N(this,"_handleRemoveStream",n=>{if(G("BLOCK_LOCAL_CLIENT")&&Gh(n.uid,this.channelName))return;const r=this._users.find(s=>s.uid===n.uid);if(!r)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let i=()=>{};r.hasAudio&&r.hasVideo?i=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(gt.USER_UNPUBLISHED,r,"audio"),S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(gt.USER_UNPUBLISHED,r,"video")}:r.hasVideo?i=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(gt.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(i=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(gt.USER_UNPUBLISHED,r,"audio")}),r._video_pre_subscribed||r._audio_pre_subscribed||(r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel instanceof VT&&this._p2pChannel.unsubscribe(r).then(s=>{if(s)return this._gateway.unsubscribe(s,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0),Le.onGatewayStream(this._sessionId,$r.ON_REMOVE_STREAM,Dn.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),i()}),N(this,"_handleSetStreamLocalEnable",(n,r,i)=>{if(G("BLOCK_LOCAL_CLIENT")&&Gh(r,this.channelName))return;const s=this._users.find(A=>A.uid===r);if(!s)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(i?"enabled":"disabled"," with uid ").concat(r));const o=n==="audio"?s.hasAudio:s.hasVideo;if(n==="audio"){s._trust_audio_enabled_state_=!0;const A=s._audio_enabled_;if(s._audio_enabled_=i,s._audio_enabled_===A)return;{const l=s._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(l)),this.safeEmit(gt.USER_INFO_UPDATED,r,l)}}else{s._trust_video_enabled_state_=!0;const A=s._video_enabled_;if(s._video_enabled_=i,s._video_enabled_===A)return;{const l=s._video_enabled_?"enable-local-video":"disable-local-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(l)),this.safeEmit(gt.USER_INFO_UPDATED,r,l)}}const a=n==="audio"?s.hasAudio:s.hasVideo;return o!==a?!o&&a?(S.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(n)),void this.safeEmit(gt.USER_PUBLISHED,s,n)):(n==="video"&&s._videoTrack&&s._videoTrack._destroy(),n==="audio"&&s._audioTrack,this._p2pChannel.muteRemote(s,n),S.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(n)),void this.safeEmit(gt.USER_UNPUBLISHED,s,n)):void 0}),N(this,"_handleMuteStream",(n,r,i)=>{if(G("BLOCK_LOCAL_CLIENT")&&Gh(n,this.channelName))return;S.debug("[".concat(this._clientId,"] receive mute message"),n,r,i);const s=this._users.find(A=>A.uid===n);if(!s)return void S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const o=r==="audio"?s.hasAudio:s.hasVideo;if(r==="audio"){s._trust_audio_mute_state_=!0;const A=s._audio_muted_;if(s._audio_muted_=i,s._audio_muted_===A)return;{const l=s._audio_muted_?"mute-audio":"unmute-audio";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(l)),this.safeEmit(gt.USER_INFO_UPDATED,n,l)}}else{s._trust_video_mute_state_=!0;const A=s._video_muted_;if(s._video_muted_=i,s._video_muted_===A)return;{const l=s._video_muted_?"mute-video":"unmute-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(l)),this.safeEmit(gt.USER_INFO_UPDATED,n,l)}}const a=r==="audio"?s.hasAudio:s.hasVideo;if(o!==a){if(!o&&a)return(r==="audio"?s._audioSSRC:s._videoSSRC)?(S.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(r)),void this.safeEmit(gt.USER_PUBLISHED,s,r)):void S.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));r==="video"&&s._videoTrack&&!s._video_pre_subscribed&&s._videoTrack._destroy(),r==="audio"&&s._audioTrack,this._p2pChannel.muteRemote(s,r),S.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(r)),this.safeEmit(gt.USER_UNPUBLISHED,s,r)}}),N(this,"_handleP2PLost",async n=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():S.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),N(this,"_handleTokenWillExpire",()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(gt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),N(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),N(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(gt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(gt.NETWORK_QUALITY,n)}),N(this,"_handleP2PAddAudioOrVideoStream",(n,r,i,s)=>{const o=this._users.find(A=>A.uid===r);if(!o)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(o.uid,n,void 0,void 0,void 0,Date.now());const a=n==="audio"?o.hasAudio:o.hasVideo;n==="audio"?o._trust_audio_stream_added_state_=!0:o._trust_video_stream_added_state_=!0,n==="audio"?(o._audio_added_=!0,i!==void 0&&(o._audioSSRC=i),s!==void 0&&(o._audioMid=s)):(o._video_added_=!0,i!==void 0&&(o._videoSSRC=i),s!==void 0&&(o._videoMid=s)),(n==="audio"?o.hasAudio:o.hasVideo)&&!a&&(S.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published ").concat(n)),this.safeEmit(gt.USER_PUBLISHED,o,n)),this._p2pChannel.hasPendingRemoteMedia(o,n)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(o.uid," after reconnect.")),this._subscribe(o,n,!0).catch(A=>{S.error("[".concat(this._clientId,"] resubscribe error"),A.toString())}))}),this._config=t,this._clientId=nn(5,"client-"),this.store=new yDe(t.codec,t.audioCodec,t.mode,this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),S.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ba," build: ").concat(a2,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{v6(t.clientRoleOptions),e=Object.assign({},t.clientRoleOptions)}catch(n){S.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new Iv(this.store),this._statsCollector.onStatsException=(n,r,i)=>{S.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(r,", uid: ").concat(i)),this.safeEmit(gt.EXCEPTION,{code:n,msg:r,uid:i})},this._statsCollector.onUploadPublishDuration=(n,r,i,s)=>{const o=this._users.find(a=>a.uid===n);o&&Le.peerPublishStatus(this._sessionId,{subscribeElapse:s,audioPublishDuration:r,videoPublishDuration:i,peer:o._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new X1e(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||fr,httpRetryConfig:t.httpRetryConfig||fr,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:e}),this._configDistribute=new oLe,this.store.useP2P?(this._p2pChannel=new Co(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new VT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,r,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Wt("JOIN_GATEWAY_USE_443PORT_ONLY",s),Wt("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const a=this._gateway.signal.websocket;return a instanceof c2&&(a.use443PortOnly=s,a.tryDoubleDomain=o),async function(A,l,d){_T.get(A)||_T.set(A,[]),ET.get(A)||ET.set(A,l),SA.get(A)||SA.set(A,0);const f=_T.get(A),p=ET.get(A);if(!f||!p)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(SA.get(A)===p){const b=mv();f.push(b),await b.promise}SA.set(A,SA.get(A)+1);for(var g=arguments.length,y=new Array(g>3?g-3:0),E=3;E<g;E++)y[E-3]=arguments[E];const w=await d(...y);return SA.set(A,SA.get(A)-1),SA.get(A)===p-1&&f.length>0&&(f[0].resolve(),f.shift()),SA.get(A)===0&&(_T.set(A,[]),ET.set(A,0),SA.set(A,0)),w}("client.join",G("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,r,i)}async join(t,e,n,r,i){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const o=(vT||vT||(vT=(window.location.protocol.split(":")[0]||"").toUpperCase(),vT))==="HTTPS",a=R6()?window.isSecureContext:"Browser Not Support";(!R6()&&!o||!window.isSecureContext)&&S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),S.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Le.setAppId(t);try{if(!n&&n!==null)throw new te(P.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ei(n,"token",1,2047),ei(t,"appid",1,2047),$I(e),r&&ZI(r),i&&ei(i,"optionalInfo",1,2047)}catch(E){throw Le.reportApiInvoke(Fm(),{name:Cr.JOIN,options:[t,e,n,r],states:{isHttps:o,isSecureContext:a},tag:xn.TRACER}).onError(E),E}if(this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const E=new te(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Le.reportApiInvoke(Fm(),{name:Cr.JOIN,options:[t,e,n,r],states:{isHttps:o,isSecureContext:a},tag:xn.TRACER}).onError(E),E}this._gateway.state="CONNECTING";const A=await i9({appId:t,cname:e,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new te(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const l=(A==null?void 0:A.sid)||Fm();S.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(s)),this._sessionId||(this._sessionId=l,this.store.sessionId=this._sessionId);const d=Le.reportApiInvoke(l,{name:Cr.JOIN,options:[t,e,n,r],states:{isHttps:o,isSecureContext:a},tag:xn.TRACER}),f=jc(jc({},this._rtmConfig),{},{clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!A},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(f.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(f.stringUid=r,this._uintUid?(f.uid=this._uintUid,this._uintUid=void 0):f.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(f.aesmode=this._encryptionMode,f.aespassword=await(async E=>{const w=function(U){const H=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),K=new Uint8Array(new ArrayBuffer(H.length));for(let x=0;x<H.length;x+=1)K[x]=H.charCodeAt(x);return K}(),b=await window.crypto.subtle.importKey("spki",w,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),I=r2(E),B=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},b,I);return function(U){let H="";for(let K=0;K<U.length;K+=1)H+=String.fromCharCode(U[K]);return window.btoa(H)}(new Uint8Array(B))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new te(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(f.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const E=new TextEncoder,w=G("USE_PURE_ENCRYPTION_MASTER_KEY")?E.encode(f.appId+this._encryptionSecret+this._encryptionSecret):E.encode(f.appId+f.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(b,I,B){const U=await window.crypto.subtle.importKey("raw",I,"PBKDF2",!1,["deriveBits","deriveKey"]),H=b==="aes-128-gcm2"?128:256,K=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:N6,hash:"SHA-256",salt:B},U,H+vDe);return new Uint8Array(K).subarray(H/8)}(this._encryptionMode,w,mf(this._encryptionSalt)),this._encryptDataStreamKey=await async function(b,I,B){const U=await window.crypto.subtle.importKey("raw",I,"PBKDF2",!1,["deriveBits","deriveKey"]),H=b==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:N6,hash:"SHA-256",salt:B},U,{name:"AES-GCM",length:H},!0,["encrypt","decrypt"])}(this._encryptionMode,w,mf(this._encryptionSalt))}else a?S.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):S.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,S.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:f.stringUid});const p=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&p===this._sessionId&&Le.joinChannelTimeout(this._sessionId,5)},5e3);try{var g;let E;const w=f.cloudProxyServer;if(Se(g=["proxy3","proxy4","proxy5"]).call(g,w)){const H=G("PROXY_SERVER_TYPE3");Array.isArray(H)?f.proxyServer=H[0]:f.proxyServer=H}if(Le.setProxyServer(f.proxyServer),S.setProxyServer(f.proxyServer),this.store.requestAPStart(),A){if(S.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(f.stringUid?", ".concat(f.stringUid," => ").concat(A.intUid):""," ")),f.stringUid&&!f.uid&&(f.uid=A.intUid),E={gatewayInfo:A.ap.gatewayInfo},G("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&f.turnServer.mode==="auto")if(A.ap.proxyInfo.addresses.length===0)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const H=(await Zee(A.ap.proxyInfo,A.ap.gatewayInfo.uid)).map(K=>({turnServerURL:K.address,tcpport:K.tcpport||mi.tcpport,udpport:K.udpport||mi.udpport,username:K.username||mi.username,password:K.password||mi.password,forceturn:!1,security:!0}));f.turnServer={mode:"manual",servers:H}}s9(A,f.stringUid)}else{if(f.stringUid&&!f.uid){let H;[H,E]=await we.all([jte(f.stringUid,f,this._axiosCancelSource.token,this._config.httpRetryConfig||fr,this.store),a8(f,this._axiosCancelSource.token,this._config.httpRetryConfig||fr,!0,this.store)]),S.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(f.stringUid," => ").concat(H)),f.uid=H,E.gatewayInfo.uid=H,E.gatewayInfo.res.uid=H}else E=await a8(f,this._axiosCancelSource.token,this._config.httpRetryConfig||fr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new te(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(f,this._axiosCancelSource.token),this._configDistribute.on(OP.UPDATE_BITRATE_LIMIT,H=>{this._p2pChannel.updateBitrateLimit(H)})},0),this._key=n||t;const b=E.gatewayInfo,I=f.uid?f.uid:b.uid;this._joinInfo=jc(jc({},f),{},{cid:b.cid,uid:I,vid:b.vid,apResponse:b.res,apGatewayAddress:b.apGatewayAddress,uni_lbs_ip:b.uni_lbs_ip,gatewayAddrs:b.gatewayAddrs}),this.store.intUid=I;const B=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new te(P.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));d.onSuccess(B),this._appId=t,this._channelName=f.cname,this._uid=B,this.store.uid=B,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(yi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const U=f.stringUid?"string uid: ".concat(f.stringUid,",uid: ").concat(f.uid):"uid: ".concat(this._uid);return S.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(U)),setTimeout(()=>{S.startUpload()},5e3),this.store.joinEnd(),y=this,Se(gd).call(gd,y)||gd.push(y),this._cloudProxyServerMode==="disabled"&&bt().supportWebCrypto&&G("ENABLE_PRELOAD")&&b2(this._joinInfo),B}catch(E){const w=Array.isArray(E)?E[0]:E;throw w&&w.code===P.OPERATION_ABORTED?S.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),w):S.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),w),w.code!==P.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),d.onError(w),w}var y}_joinGateway(){if(!this._joinInfo||!this._key)throw new te(P.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!G("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){S.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(yi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=gd.indexOf(e);n!==-1&&gd.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED"),S.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Hm))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new te(P.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new te(P.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof Hm))throw new te(P.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&e)throw new te(P.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}S.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(i=>{const s=this._configDistribute.getBitrateLimit();i instanceof pn&&s&&i.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),S.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw S.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(t){zt(t.id,"id",0,65535,!0),Jl(t.ordered,"ordered"),ei(t.metadata,"metadata",0,512),S.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===t.id)!==-1)throw new te(P.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new te(P.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new te(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(i){return Z8(i,!1)}(t),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new te(P.CREATE_DATACHANNEL_ERROR);try{await we.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await n._waitTillOpen()}catch(i){if(i.code!==P.DISCONNECT_P2P)throw i}}return S.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw S.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new te(P.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof Hm))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);S.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof Co){const r=await this._p2pChannel.unpublish(e);r&&await this._gateway.sendExtensionMessage(Yn.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(e);r&&await this._gateway.unpublish(r,this._uid),S.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw S.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),S.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),S.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(r=>"".concat(r.id))))}catch(n){throw S.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof Ed)){const r=this.remoteUsers.find(i=>i.uid===t);if(!r)throw new te(P.INVALID_REMOTE_USER,"user is not in the channel");t=r}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(Or(e,"mediaType",["audio","video"]),this._p2pChannel instanceof Co)throw new te(P.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new te(P.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===Pe.AUDIO,r=e===Pe.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:o,rtxSsrcId:a,cname:A,uint_id:l}=await this._gateway.presubscribe(t,e,!0);if(s==null)throw new te(P.UNEXPECTED_RESPONSE,"no ssrc id");let d=this._users.find(p=>p.uid===t);d||(d=new Ed(t,l||t),d._is_pre_created=!0,this._users.push(d)),A&&(d._cname=A),d._uintid||(d._uintid=l||t),n&&(d._audioSSRC=s,d._audio_pre_subscribed=!0,o&&(d._audioOrtc=o)),r&&(d._videoSSRC=s,d._video_pre_subscribed=!0,o&&(d._videoOrtc=o),a!=null&&(d._rtxSsrcId=a)),S.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(d,e,s,a,o);const f=n?d._audioTrack:d._videoTrack;if(!f)throw new te(P.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(d._trust_audio_stream_added_state_=!0,d._audio_added_=!0),r&&(d._trust_video_stream_added_state_=!0,d._video_added_=!0),f}catch(s){throw S.error("[".concat(this._clientId,"] presub user ").concat(t," error"),s),s}finally{i()}}async _subscribeDataChannel(t,e){var n;if(zt(e,"channelId",0,65535,!0),!this._joinInfo)throw new te(P.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===t))throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new te(P.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new te(P.INVALID_REMOTE_USER,"user is not published");const i=(n=t._dataChannels)===null||n===void 0?void 0:n.find(a=>a.id===e);if(!i)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new te(P.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const a=await this._p2pChannel.subscribeDataChannel(t,[i]);if(a&&Se(a).call(a,i.id))try{var o;if(typeof i._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new te(P.CREATE_DATACHANNEL_ERROR);const A={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(o=i.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(t.uid,A,!0),await i._waitTillOpen()}catch(A){if((A==null?void 0:A.code)!==P.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[i]),A;await this._p2pChannel.unsubscribeDataChannel(t,[i]),this._p2pChannel.setPendingRemoteDataChannel(t,i.id)}return S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(t,e,n){if(Or(e,"mediaType",["audio","video"]),!this._joinInfo)throw new te(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===t)){const s=new te(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),s}if(!t.hasAudio&&!t.hasVideo){const s=new te(P.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),s}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const s=new te(P.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),s}const i=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const o=e==="audio"?t._audioSSRC:t._videoSSRC,a=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this._p2pChannel instanceof Co&&await this._p2pChannel.subscribe(t,e,o,a)}catch(o){throw o}S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(o=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});const s=e==="audio"?t._audioTrack:t._videoTrack;if(!s)throw new te(P.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),s),s}finally{i()}}async _subscribe(t,e,n){if(this._p2pChannel instanceof Co)return this._p2pSubscribe(t,e);if(Or(e,"mediaType",["audio","video"]),!this._joinInfo)throw new te(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===t)){const l=new te(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),l}if(!t.hasAudio&&!t.hasVideo){const l=new te(P.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),l}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const l=new te(P.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),l}let i=e==="audio"?t._audioSSRC:t._videoSSRC,s=e==="audio"?t._audioOrtc:t._videoOrtc,o=e==="video"?t._rtxSsrcId:void 0,a={stream_type:e==="audio"?Pe.AUDIO:Pe.VIDEO,ssrcId:i};const A=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const d=e==="audio"?t._audioSSRC:t._videoSSRC;d!==void 0&&d!==i&&(i=d,s=e==="audio"?t._audioOrtc:t._videoOrtc,o=e==="video"?t._rtxSsrcId:void 0,a={stream_type:e==="audio"?Pe.AUDIO:Pe.VIDEO,ssrcId:i}),ki.markSubscribeStart(this.store.clientId,i),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,i,o,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(t.uid,a,!0)}catch(f){if((f==null?void 0:f.code)!==P.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),f;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(d){throw this._p2pChannel.reportSubscribeEvent(!1,d==null?void 0:d.code,t,e),d}S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(d=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});const l=e==="audio"?t._audioTrack:t._videoTrack;if(!l)throw new te(P.UNEXPECTED_ERROR,"can not find remote track in user object");return l}catch(l){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),l),l}finally{A()}}async massSubscribe(t){if(ql(t,"subscribeList"),!this._joinInfo)throw new te(P.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,r=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(a=>{let{user:A,mediaType:l}=a;return"user: ".concat(A==null?void 0:A.uid,", mediaType: ").concat(l)}).join("; ")));const i=(t=[...t]).map(a=>{let{user:A,mediaType:l}=a;return{user:A,mediaType:l}}),s=await this._p2pChannel.globalLock();try{var o;for(let A=t.length-1;A>=0;A--){const l=t[A],{user:d,mediaType:f}=l;if(Or(f,"mediaType",["audio","video"]),!d){const E=new te(P.INVALID_PARAMS,"user property does not exist in subscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),E}if(!this._users.find(E=>E===d)){const E=new te(P.INVALID_REMOTE_USER,"user is not in the channel");S.error("[".concat(this._clientId,"] can not massSubscribe ").concat(d.uid,", this user is not in the channel")),i[A].error=E,t.splice(A,1);continue}if(f==="audio"&&(!d.hasAudio||d._audioSSRC===void 0)||f==="video"&&(!d.hasVideo||d._videoSSRC===void 0)){const E=new te(P.REMOTE_USER_IS_NOT_PUBLISHED);S.error("[".concat(this._clientId,"] can not subscribe ").concat(d.uid," with mediaType ").concat(f,", remote user is not published")),i[A].error=E,t.splice(A,1);continue}const g=Lr.Video|Lr.LwoVideo,y=n.get(d);if(y){if(f==="video"?y&g:y&Lr.Audio){t.splice(A,1),S.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(d.uid,", mediaType:").concat(f," twice"));continue}n.set(d,y|(f==="video"?g:Lr.Audio))}else n.set(d,f==="video"?g:Lr.Audio)}for(let A=t.length-1;A>=0;A--){const l=t[A],{user:d,mediaType:f}=l,p=Lr.Video|Lr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(d,f)){await this._p2pChannel.unmuteRemoteNoLock(d,f);const g=n.get(d);n.set(d,f==="video"?g^p:g^Lr.Audio),t.splice(A,1)}}this.store.massSubscribe(t.map(A=>({userId:A.user.uid,type:A.mediaType})),e);let a=Zc(o=Array.from(n.entries())).call(o,(A,l)=>{let[d,f]=l;if(f===0)return A;const p={stream_id:d.uid,stream_type:f};return f&Lr.Audio&&(p.audio_ssrc=d._audioSSRC),f&Lr.Video&&(p.video_ssrc=d._videoSSRC),A.push(p),A},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(l=>{let{user:d,mediaType:f}=l;return{user:d,mediaType:f,ssrcId:f===Pe.VIDEO?d._videoSSRC:d._audioSSRC,rtxSsrcId:f===Pe.VIDEO?d._rtxSsrcId:void 0}}));const A=new Map;if(a=a.filter(l=>l.video_ssrc&&!this._p2pChannel.isPreSubScribe(l.video_ssrc)||l.audio_ssrc&&!this._p2pChannel.isPreSubScribe(l.audio_ssrc)||!l.video_ssrc&&!l.audio_ssrc),a.length>0){const l=await this._gateway.subscribeAll(a,!0);((l==null?void 0:l.users)||[]).forEach(d=>{let{stream_id:f,video_error_code:p,audio_error_code:g,error_code:y}=d;(p||g||y)&&A.set(f,{video_error_code:p,audio_error_code:g,error_code:y})})}if(Array.from(A.entries()).length>0){const l=[];Array.from(A.entries()).forEach(d=>{let[f,p]=d;const g=this.remoteUsers.find(y=>y.uid===f);if(g){let y;p.error_code||p.video_error_code&&p.audio_error_code?y=void 0:p.video_error_code?y=Pe.VIDEO:p.audio_error_code&&(y=Pe.AUDIO),l.push({user:g,mediaType:y})}}),l.length>0&&await this._p2pChannel.massUnsubscribeNoLock(l)}for(const l of i){const d=A.get(l.user.uid);if(d){const f=d.error_code||l.mediaType==="audio"&&d.audio_error_code||l.mediaType==="video"&&d.video_error_code;if(f){const p=yv(f);S.error("user:".concat(l.user.uid," mediaType:").concat(l.mediaType," has massSubscribe error ").concat(p.desc)),l.error=new te(P.SUBSCRIBE_FAILED,"code ".concat(f,": ").concat(p.desc))}}l.error||(l.mediaType==="video"?l.track=l.user.videoTrack:l.track=l.user.audioTrack)}return this.store.massSubscribe(i.filter(l=>!l.error).map(l=>({userId:l.user.uid,type:l.mediaType})),void 0,Date.now()),i.forEach(l=>{var d;Le.subscribe(this.store.sessionId,{succ:!!l.error,ec:((d=l.error)===null||d===void 0?void 0:d.code)||null,video:l.mediaType===Pe.VIDEO,audio:l.mediaType===Pe.AUDIO,peerid:l.user.uid,subscribeRequestid:l.mediaType===Pe.VIDEO?l.user._videoSSRC:l.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(l.user._videoSSRC)},!0)}),S.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(l=>{let{user:d,mediaType:f}=l;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(f)}).join("; "))),i}catch(A){throw await this._p2pChannel.massUnsubscribeNoLock(t),A}}finally{s(),r()}}async unsubscribe(t,e,n){if(!(t instanceof Ed)){const s=this.remoteUsers.find(o=>o.uid===t);if(!s)throw new te(P.INVALID_REMOTE_USER,"user is not in the channel");t=s}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&Or(e,"mediaType",["audio","video"]),!this._joinInfo)throw new te(P.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new te(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof Co)await this._p2pChannel.unsubscribe(t,e);else{const s=await this._p2pChannel.unsubscribe(t,e);s&&await this._gateway.unsubscribe(s,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&pb(this._users,t),S.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(s){if(s.code===P.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(t,e){if(e&&zt(e,"id",0,65535,!0),!this._joinInfo)throw new te(P.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===t)){const i=new te(P.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),i}let r;if(typeof e=="number"){const i=t._dataChannels.find(s=>s.id===e);i&&(r=[i])}else r=t._dataChannels;if(r===void 0){const i=new te(P.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),i}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(t,r);i&&await this._gateway.unsubscribeDataChannel(i,t.uid),S.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===P.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),i.toString()),i}}async massUnsubscribe(t){if(ql(t,"unsubscribeList"),!this._joinInfo)throw new te(P.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");S.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(i,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:r,mediaType:i}=t[n];if(!r){const a=new te(P.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),a}if(Or(i,"mediaType",["video","audio",void 0]),!this._users.find(a=>a===r)){S.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),t.splice(n,1);continue}const o=Lr.Video|Lr.LwoVideo;if(e.has(r)){const a=e.get(r);let A;switch(i){case"video":A=a&o;break;case"audio":A=a&Lr.Audio;break;default:A=a&(Lr.Audio|o)}if(A){S.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),t.splice(n,1);continue}i?i==="audio"?e.set(r,a|Lr.Audio):i==="video"&&e.set(r,a|o):e.set(r,a|Lr.Audio|o)}else i?i==="audio"?e.set(r,Lr.Audio):i==="video"&&e.set(r,o):e.set(r,Lr.Audio|o)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),S.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(r=>{let{user:i,mediaType:s}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===P.DISCONNECT_P2P)return void S.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw S.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new ie(P.INVALID_PARAMS);Nn(n.width)||AB(n.width,"streamParameter.width"),Nn(n.height)||AB(n.height,"streamParameter.height"),Nn(n.framerate)||AB(n.framerate,"streamParameter.framerate"),Nn(n.bitrate)||zt(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,le.LocalVideoLowTrack)}async enableDualStream(){if(!bt().supportDualStream)throw Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new te(P.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new te(P.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new te(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(le.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(n){Or(n,"role",["audience","host"])}(t),e&&v6(e),this.mode==="rtc"||this.mode==="p2p")throw S.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new te(P.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new te(P.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new te(P.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(t,e),this._config.role=t,S.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(ei(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new te(P.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new te(P.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Le.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer),S.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new te(P.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new te(P.INVALID_OPERATION,"You have already set the proxy")}if(qI(t))return this._turnServer={servers:t,mode:"original-manual"},void S.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>Vee(n)),this._turnServer={servers:t,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new te(P.INVALID_OPERATION,"you should set license before join channel");if(ei(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new te(P.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,S.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new te(P.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new te(P.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new te(P.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new te(P.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new te(P.INVALID_OPERATION,"Stop proxy server after leave channel");Le.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new te(P.INVALID_PARAMS,"accessPoints is required.");ql(t.accessPoints.serverList,"accessPoints.serverList"),ei(t.accessPoints.domain,"accessPoints.domain");const e=(p,g)=>{zt(p,g,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new te(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");G("CLOSE_AFB_FOR_LOCAL_AP")&&(Wt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Wt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=t.accessPoints.domain,s=t.accessPoints.serverList.map(p=>r.test(p)?"".concat(p.replace(/\./g,"-"),".").concat(i):p),o=s.map(p=>"".concat(p,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Wt("WEBCS_DOMAIN",o),Wt("WEBCS_DOMAIN_BACKUP_LIST",o),Wt("GATEWAY_DOMAINS",[i]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(ql(t.report.hostname,"report.hostname"),Wt("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Wt("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Wt("EVENT_REPORT_DOMAIN",s[0]),Wt("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let a=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),a=t.report.port),Wt("STATS_COLLECTOR_PORT",a),t.report?Wt("ENABLE_EVENT_REPORT",!0):Wt("ENABLE_EVENT_REPORT",!1);let A="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(ql(t.log.hostname,"log.hostname"),A=t.log.hostname[0]):A=s[0];let l=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),l=t.log.port),Wt("LOG_UPLOAD_SERVER","".concat(A,":").concat(l));let d=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(ql(t.cds.hostname,"cds.hostname"),d=t.cds.hostname):d=s;let f=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),f=t.cds.port),Wt("CDS_AP",d.map(p=>"".concat(p,":").concat(f))),t.cds?Wt("ENABLE_CONFIG_DISTRIBUTE",!0):Wt("ENABLE_CONFIG_DISTRIBUTE",!1),S.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(ql(t,"serverList"),ei(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new te(P.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(e):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Wt("WEBCS_DOMAIN",t),Wt("WEBCS_DOMAIN_BACKUP_LIST",t),Wt("GATEWAY_DOMAINS",[e]),Wt("EVENT_REPORT_DOMAIN",t[0]),Wt("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Wt("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),S.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Or(t,"streamType",[0,1]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw S.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else S.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Or(e,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(r=>r.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw S.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Or(e,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw S.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,r){(function(s){Or(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),ei(e,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Se(i).call(i,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new te(P.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new te(P.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Jl(r,"encryptDataStream"),!Se(i).call(i,t))throw new te(P.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=Vd(n))}async renewToken(t){if(ei(t,"token",1,2047),!this._key||!this._joinInfo)throw new te(P.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(G("USE_NEW_TOKEN")){S.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await sLe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||fr);S.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:r})}else S.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});S.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=e,this._joinInfo.token=e,S.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?S.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(gt.VOLUME_INDICATOR,t)},G("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new te(P.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new te(P.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new te(P.LIVE_STREAMING_TASK_CONFLICT);const n=e?nu.TRANSCODE:nu.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(nu.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new te(P.INVALID_PARAMS,"can not find live streaming url to stop");await we.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){V8(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){V8(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new te(P.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const i=new TextEncoder;t.payload=i.encode(t.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Se(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(r=!0,t.payload=await async function(i,s,o){var a;const A=Zc(a=Array.from(o)).call(a,(E,w)=>E+w,0),l={serverTs:0,seq:wDe++,length:o.length,checkSum:A},d=new Uint8Array(I6(A,2)),f=new ArrayBuffer(qp),p=new DataView(f);p.setUint32(0,l.serverTs),p.setUint16(4,l.seq),p.setUint16(6,l.length),p.setUint16(8,l.checkSum);const g=16-o.length%16;o=C6(o,new Uint8Array(g));const y=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:O6,additionalData:d},s,o);return C6(new Uint8Array(f),new Uint8Array(y))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new te(P.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(We.DATA_STREAM,{payload:Vd(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-NLe},!n)}sendMetadata(t){if(!this._joinInfo)throw new te(P.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new te(P.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(We.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Vd(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(TDe),!this._joinInfo)throw new te(P.INVALID_OPERATION,"can not send custom report, not joined");await Le.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Or(e.spatialLayer,"spatialLayer",[0,1,2,3]),Or(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(Jl(e,"apRTM"),zt(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,S.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(S.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Xs.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&one(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new xi("client-publish"),this._subscribeMutex=new xi("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const r=t||Fm();t?S.debug("[".concat(this._clientId,"] new Session ").concat(r)):S.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=t?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r;const s={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};Le.sessionInit(this._sessionId,jc({cname:e.channel,appid:e.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new te(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&G("FORCE_TURN")&&!G("TURN_ENABLE_TCP")&&!G("TURN_ENABLE_UDP"))throw new te(P.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");S.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof Co){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Yn.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var e;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==P.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((e=i)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of t)i instanceof pn&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===P.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new te(P.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(P.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));S.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var e;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==P.DISCONNECT_P2P)throw n.throw(s),s}n.next(((e=i)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===P.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new te(P.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ry("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,s)=>{Le.reportApiInvoke(this._sessionId,{name:Cr.ON_LIVE_STREAM_ERROR,options:[i,s],tag:xn.TRACER}).onSuccess(),this.safeEmit(gt.LIVE_STREAMING_ERROR,i,s)},n.onLiveStreamWarning=(i,s)=>{Le.reportApiInvoke(this._sessionId,{name:Cr.ON_LIVE_STREAM_WARNING,options:[i,s],tag:xn.TRACER}).onSuccess(),this.safeEmit(gt.LIVE_STREAMING_WARNING,i,s)},n.on(RP.REQUEST_WORKER_MANAGER_LIST,(i,s,o)=>{if(!this._joinInfo)return o(new te(P.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(a,A,l,d){const f=G("UAP_AP").slice(0,G("AJAX_REQUEST_CONCURRENT")).map(p=>A.proxyServer?"https://".concat(A.proxyServer,"/ap/?url=").concat(p+"/api/v1?action=uap"):"https://".concat(p,"/api/v1?action=uap"));return await Z1e(f,a,A,l,d)})(i,this._joinInfo,this._axiosCancelSource.token,fr).then(s).catch(o)}),n};return t===nu.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new te(P.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},ry("ChannelMediaRelay").create(t));r.on("state",i=>{i===ro.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(gt.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(gt.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,s)=>{var o;i==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:r}=t,i=[];if(e){const s=[];this._users.forEach(o=>{o._dataChannels.forEach(a=>{n.every(A=>A.uid!==o._uintid||A.stream_id!==a.id)&&s.push({uid:o._uintid,stream_id:a.id,ordered:a.ordered,max_retrans_times:a.maxRetransmits,metadata:a.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:o,stream_id:a,ordered:A,max_retrans_times:l,metadata:d}=s,f=this._users.find(p=>p._uintid===o);if(!f)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(S.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),Se(i).call(i,f)||i.push(f),f._uintid||(f._uintid=o),f._dataChannels.findIndex(p=>p.id===s.stream_id)===-1){const p={id:a,ordered:!!A,maxRetransmits:l,metadata:d},g=function(y){return Z8(y,!0)}(p);f._dataChannels.push(g),S.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published datachannel")),e||this.safeEmit(gt.USER_PUBLISHED,f,"datachannel",p)}this._p2pChannel.hasPendingRemoteDataChannel(f,s.stream_id)&&(S.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(f.uid," after reconnect.")),this._subscribeDataChannel(f,s.stream_id).catch(p=>{S.error("[".concat(this._clientId,"] resubscribe datachannel error"),p.toString())}))}),e&&(this.safeEmit(gt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(s=>{const{uid:o,stream_id:a}=s,A=this._users.find(d=>d._uintid===o);if(!A)return void S.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const l=A._dataChannels.find(d=>d.id===s.stream_id);l&&(S.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(A,[l]).then(d=>{if(A._dataChannels=A._dataChannels.filter(f=>f!==l),d)return this._gateway.unsubscribeDataChannel(d,A.uid)}),S.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(l.id)),this.safeEmit(gt.USER_UNPUBLISHED,A,"datachannel",l._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){S.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(r=>{this.safeEmit(gt.USER_UNPUBLISHED,e,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,e.uid)}),n()}}else S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(pi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(pi.CONNECTION_STATE_CHANGE,(t,e,n)=>{var r;if(n===Ft.FALLBACK)return;const i=()=>{this.safeEmit(gt.CONNECTION_STATE_CHANGE,t,e,n)};if(Le.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Cr.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:xn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),S.info("[".concat(this._clientId,"] connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void i();if(t==="RECONNECTING")this._users.forEach(o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((o,a)=>{this._gateway.setStreamFallbackOption(a,o).catch(A=>{S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),A)})}),this._remoteStreamTypeCacheMap.forEach((o,a)=>{this._gateway.setRemoteVideoStreamType(a,o).catch(A=>{S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),A)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{S.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(o=>{S.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(o=>!o._trust_in_room_).forEach(o=>{S.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(o=>{o._trust_audio_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Pe.AUDIO,!1)),o._trust_video_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Pe.VIDEO,!1)),o._trust_audio_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(S.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))}))},1e3))}i()}),this._gateway.on(pi.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new te(P.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await i9(jc(jc({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,s9(r),this._joinInfo.preload=!0):(n=await VP(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||fr,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:o}=s;const[a,A]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:a,port:A}):i.push({host:a,port:A})}),t(i)}catch(n){e(n)}}),this._gateway.on(pi.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(gt.NETWORK_QUALITY,t)}),this._gateway.on(pi.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(gt.STREAM_TYPE_CHANGED,t,e),Le.reportApiInvoke(this._sessionId,{name:Cr.STREAM_TYPE_CHANGE,options:[t,e],tag:xn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(pi.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(pi.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let r=await this._p2pChannel.getEstablishParams();G("ENABLE_PREALLOC_PC")&&r||(r=await this._p2pChannel.startP2PConnection(t)),e(r)}catch(r){n(r)}}),this._gateway.on(pi.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;const n=e8(t.ortc,e,t.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(n)}),this._gateway.on(pi.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var r;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:i,cid:s}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(i),icePwd:"".concat(s,"_").concat(i)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=G("FINGERPRINT"))!==null&&r!==void 0?r:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(ht.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ht.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ht.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(ht.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(ht.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(ht.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ht.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ht.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ht.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Pe.AUDIO,!0)),this._gateway.signal.on(ht.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Pe.AUDIO,!1)),this._gateway.signal.on(ht.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Pe.VIDEO,!0)),this._gateway.signal.on(ht.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Pe.VIDEO,!1)),this._gateway.signal.on(ht.RECEIVE_METADATA,t=>{const e=mf(t.metadata);this.safeEmit(gt.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(ht.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=mf(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Se(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<qp)throw new te(P.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(qp));n=await async function(s,o,a){const A=a.subarray(0,qp),l=A.slice(8,qp),d=(l[0]<<8)+l[1],f=(A[6]<<8)+A[7],p=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:O6,additionalData:new Uint8Array(I6(d,2))},o,a.subarray(qp));return new Uint8Array(p).subarray(0,f)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(t.ordered||t.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(a=>a.uid===t.uid),o=i==null?void 0:i.audioRecv.find(a=>a.ssrc===(s==null?void 0:s._audioSSRC));r=o==null?void 0:o.jitterBufferMs}r==null&&(r=0),BLe(jc(jc({},t),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ht.ON_CRYPT_ERROR,()=>{ih(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(gt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ht.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ht.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ft.TOKEN_EXPIRE),this.safeEmit(gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ht.ON_STREAM_FALLBACK_UPDATE,t=>{S.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(gt.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ht.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),S.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(ht.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(ht.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(qe.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case We.PUBLISH:{if(!e)return;const i=e.ortc;if(i){var n,r;const s=i.some(A=>{let{stream_type:l}=A;return l===kt.Audio}),o=i.some(A=>{let{stream_type:l}=A;return l!==kt.Audio}),a=i.some(A=>{let{stream_type:l}=A;return l===kt.Screen||l===kt.ScreenLow});e.state==="offer"&&Le.publish(this._joinInfo.sid,{eventElapse:ki.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:P.TIMEOUT,audio:s,video:o,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:s?(n=i.find(A=>{let{stream_type:l}=A;return l===kt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:o?(r=i.find(A=>{let{stream_type:l}=A;return l!==kt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case We.SUBSCRIBE:e&&Le.subscribe(this._joinInfo.sid,{succ:!1,ec:P.TIMEOUT,audio:e.stream_type===Pe.AUDIO,video:e.stream_type===Pe.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:ki.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(ht.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(ht.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;G("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(r=>!Gh(r.string_id||r.stream_id,this.channelName)));const e=[],n=[];for(const r of t.users){let i=this._users.find(d=>d._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Ed(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.getListeners(gt.PUBLISHED_USER_LIST).length===0&&(S.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(gt.USER_JOINED,i)));const s=Lr.Audio&r.stream_type,o=(Lr.Video|Lr.LwoVideo)&r.stream_type,a=(65280&r.stream_type)!=0,A=s&&i.hasAudio,l=o&&i.hasVideo;o&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),s&&!A&&this.getListeners(gt.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(gt.USER_PUBLISHED,i,"audio")),o&&!l&&this.getListeners(gt.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(gt.USER_PUBLISHED,i,"video")),(s&&!A||o&&!l||a)&&e.push(i),o&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(S.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{S.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(gt.PUBLISHED_USER_LIST).length>0?G("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(S.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(r=>r.uid).join(", "))),this.safeEmit(gt.PUBLISHED_USER_LIST,e)):S.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(ht.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof VT&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var r;return Se(r=Object.keys(JI)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(ht.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Yn.PUBLISH,(t,e,n)=>{const{uid:r}=t;t.forEach(i=>{const{kind:s,ssrcs:o,mid:a,isMuted:A}=i;this._handleP2PAddAudioOrVideoStream(s,r,o[0].ssrcId,a);const l=this._users.find(d=>d.uid===r);return l&&this._p2pChannel instanceof Co?this._p2pChannel.mockSubscribe(l,s,o[0].ssrcId,a).then(()=>{e()}).catch(n):e(),this._handleMuteStream(r,s,!!A)})}),this._gateway.signal.on(Yn.CALL,async(t,e,n)=>{if(this._p2pChannel instanceof Co)try{var r;e(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},t))}catch(i){n(i)}}),this._gateway.signal.on(qe.P2P_CONNECTION,async t=>{this._p2pChannel instanceof Co&&await this._p2pChannel.p2pConnect(t)}),this._gateway.signal.on(Yn.UNPUBLISH,async(t,e,n)=>{if(this._p2pChannel instanceof Co){const{unpubMsg:r,uid:i}=t,s=this._users.find(o=>o.uid===i);if(!s)return S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void e();try{r.forEach(async o=>{let{stream_type:a}=o;const A=a===kt.Audio?Pe.AUDIO:Pe.VIDEO;await this._p2pChannel.unsubscribe(s,A),this._handleMuteStream(i,A,!0)}),e()}catch(o){n(o)}}}),this._gateway.signal.on(Yn.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case bd.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,Pe.VIDEO,!0);break;case bd.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,Pe.AUDIO,!0);break;case bd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,Pe.VIDEO,!1);break;case bd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,Pe.AUDIO,!1)}}),this._gateway.signal.on(Yn.RESTART_ICE,async(t,e,n)=>{if(this._p2pChannel instanceof Co)try{const{direction:r,iceParameter:i}=t;r!==Ts.SEND_ONLY||i?e(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),e())}catch(r){n(r)}}),this._gateway.signal.on(Yn.CANDIDATE,t=>{if(this._p2pChannel instanceof Co){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(Ke.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:r}=t;e(await this._gateway.sendExtensionMessage(Yn.RESTART_ICE,t,r===Ts.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(Ke.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Yn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Ke.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(Yn.CONTROL,t,!0),e()}catch(r){n(r)}}),this._p2pChannel.on(Ke.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===P.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(Ke.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===P.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(Ke.StateChange,(t,e)=>{e===Ut.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ke.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===P.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(Ke.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===P.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(Ke.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(Ke.RequestRePublishDataChannel,(t,e,n)=>{we.all(t.map(async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==P.DISCONNECT_P2P)throw s}})).then(e).catch(n)}),this._p2pChannel.on(Ke.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:r,kind:i}of t)i===Pe.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");e()}catch(r){n(r)}}),this._p2pChannel.on(Ke.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(Ke.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Ke.MediaReconnectStart,t=>{this.safeEmit(gt.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Ke.MediaReconnectEnd,t=>{this.safeEmit(gt.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Ke.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ke.RequestRestartICE,async t=>{if(this._p2pChannel instanceof Co)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(o){return void e.throw(o)}const{iceParameters:s}=function(o){const a=o.iceParameters;return{iceParameters:{iceUfrag:a.iceUfrag,icePwd:a.icePwd}}}(i);await e.next({remoteIceParameters:s})}),this._p2pChannel.on(Ke.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ke.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:r}),o=e8(i,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ke.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(Ke.P2PLost,()=>{this.safeEmit(gt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ke.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Ke.ConnectionTypeChange,t=>{this.safeEmit(gt.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Ke.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ke.QueryClientConnectionState,t=>{t(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new te(P.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new te(P.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},ry("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:s,token:o,uid:a,cid:A,vid:l}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:s,token:o,uid:a,cid:A,vid:l?Number(l):0},fr)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(Hr.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(gt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===ec.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(gt.CONTENT_INSPECT_ERROR,new te(P.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Hr.INSPECT_RESULT,(e,n)=>{var r;if((n==null?void 0:n.code)===P.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return S.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(gt.CONTENT_INSPECT_RESULT,e,n)}),t.on(Hr.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new te(P.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Jl(t,"enabled"),t){if(!e)throw new te(P.INVALID_PARAMS,"config is required");if(une(e),!this._joinInfo)throw new te(P.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const r=(n={config:e},ry("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:s,sid:o,token:a,uid:A,cid:l,vid:d}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:s,sid:o,token:a,uid:A,cid:l,vid:d?Number(d):0},fr)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new te(P.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(t){t.on(Qc.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(gt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===ma.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new te(P.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Qc.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){Or(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new te(P.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,S.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return S.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Jl(t,"enabled"),Wt("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Oe(Te.prototype,"leave",[h9],Object.getOwnPropertyDescriptor(Te.prototype,"leave"),Te.prototype),Oe(Te.prototype,"publish",[f9],Object.getOwnPropertyDescriptor(Te.prototype,"publish"),Te.prototype),Oe(Te.prototype,"unpublish",[p9],Object.getOwnPropertyDescriptor(Te.prototype,"unpublish"),Te.prototype),Oe(Te.prototype,"subscribe",[m9],Object.getOwnPropertyDescriptor(Te.prototype,"subscribe"),Te.prototype),Oe(Te.prototype,"presubscribe",[g9],Object.getOwnPropertyDescriptor(Te.prototype,"presubscribe"),Te.prototype),Oe(Te.prototype,"massSubscribe",[_9],Object.getOwnPropertyDescriptor(Te.prototype,"massSubscribe"),Te.prototype),Oe(Te.prototype,"unsubscribe",[E9],Object.getOwnPropertyDescriptor(Te.prototype,"unsubscribe"),Te.prototype),Oe(Te.prototype,"massUnsubscribe",[y9],Object.getOwnPropertyDescriptor(Te.prototype,"massUnsubscribe"),Te.prototype),Oe(Te.prototype,"setLowStreamParameter",[v9],Object.getOwnPropertyDescriptor(Te.prototype,"setLowStreamParameter"),Te.prototype),Oe(Te.prototype,"enableDualStream",[w9],Object.getOwnPropertyDescriptor(Te.prototype,"enableDualStream"),Te.prototype),Oe(Te.prototype,"disableDualStream",[C9],Object.getOwnPropertyDescriptor(Te.prototype,"disableDualStream"),Te.prototype),Oe(Te.prototype,"setClientRole",[T9],Object.getOwnPropertyDescriptor(Te.prototype,"setClientRole"),Te.prototype),Oe(Te.prototype,"setProxyServer",[S9],Object.getOwnPropertyDescriptor(Te.prototype,"setProxyServer"),Te.prototype),Oe(Te.prototype,"setTurnServer",[b9],Object.getOwnPropertyDescriptor(Te.prototype,"setTurnServer"),Te.prototype),Oe(Te.prototype,"setLicense",[I9],Object.getOwnPropertyDescriptor(Te.prototype,"setLicense"),Te.prototype),Oe(Te.prototype,"startProxyServer",[R9],Object.getOwnPropertyDescriptor(Te.prototype,"startProxyServer"),Te.prototype),Oe(Te.prototype,"stopProxyServer",[O9],Object.getOwnPropertyDescriptor(Te.prototype,"stopProxyServer"),Te.prototype),Oe(Te.prototype,"setLocalAccessPointsV2",[N9],Object.getOwnPropertyDescriptor(Te.prototype,"setLocalAccessPointsV2"),Te.prototype),Oe(Te.prototype,"setLocalAccessPoints",[D9],Object.getOwnPropertyDescriptor(Te.prototype,"setLocalAccessPoints"),Te.prototype),Oe(Te.prototype,"setRemoteDefaultVideoStreamType",[B9],Object.getOwnPropertyDescriptor(Te.prototype,"setRemoteDefaultVideoStreamType"),Te.prototype),Oe(Te.prototype,"setRemoteVideoStreamType",[L9],Object.getOwnPropertyDescriptor(Te.prototype,"setRemoteVideoStreamType"),Te.prototype),Oe(Te.prototype,"setStreamFallbackOption",[P9],Object.getOwnPropertyDescriptor(Te.prototype,"setStreamFallbackOption"),Te.prototype),Oe(Te.prototype,"setEncryptionConfig",[U9],Object.getOwnPropertyDescriptor(Te.prototype,"setEncryptionConfig"),Te.prototype),Oe(Te.prototype,"renewToken",[k9],Object.getOwnPropertyDescriptor(Te.prototype,"renewToken"),Te.prototype),Oe(Te.prototype,"enableAudioVolumeIndicator",[x9],Object.getOwnPropertyDescriptor(Te.prototype,"enableAudioVolumeIndicator"),Te.prototype),Oe(Te.prototype,"startLiveStreaming",[M9],Object.getOwnPropertyDescriptor(Te.prototype,"startLiveStreaming"),Te.prototype),Oe(Te.prototype,"setLiveTranscoding",[F9],Object.getOwnPropertyDescriptor(Te.prototype,"setLiveTranscoding"),Te.prototype),Oe(Te.prototype,"stopLiveStreaming",[V9],Object.getOwnPropertyDescriptor(Te.prototype,"stopLiveStreaming"),Te.prototype),Oe(Te.prototype,"startChannelMediaRelay",[Q9],Object.getOwnPropertyDescriptor(Te.prototype,"startChannelMediaRelay"),Te.prototype),Oe(Te.prototype,"updateChannelMediaRelay",[H9],Object.getOwnPropertyDescriptor(Te.prototype,"updateChannelMediaRelay"),Te.prototype),Oe(Te.prototype,"stopChannelMediaRelay",[j9],Object.getOwnPropertyDescriptor(Te.prototype,"stopChannelMediaRelay"),Te.prototype),Oe(Te.prototype,"sendCustomReportMessage",[K9],Object.getOwnPropertyDescriptor(Te.prototype,"sendCustomReportMessage"),Te.prototype),Oe(Te.prototype,"pickSVCLayer",[G9],Object.getOwnPropertyDescriptor(Te.prototype,"pickSVCLayer"),Te.prototype),Oe(Te.prototype,"setRTMConfig",[W9],Object.getOwnPropertyDescriptor(Te.prototype,"setRTMConfig"),Te.prototype),Oe(Te.prototype,"enableContentInspect",[z9],Object.getOwnPropertyDescriptor(Te.prototype,"enableContentInspect"),Te.prototype),Oe(Te.prototype,"disableContentInspect",[q9],Object.getOwnPropertyDescriptor(Te.prototype,"disableContentInspect"),Te.prototype),Oe(Te.prototype,"setImageModeration",[Y9],Object.getOwnPropertyDescriptor(Te.prototype,"setImageModeration"),Te.prototype),Oe(Te.prototype,"setP2PTransport",[X9],Object.getOwnPropertyDescriptor(Te.prototype,"setP2PTransport"),Te.prototype),Oe(Te.prototype,"getJoinChannelServiceRecords",[J9],Object.getOwnPropertyDescriptor(Te.prototype,"getJoinChannelServiceRecords"),Te.prototype),Oe(Te.prototype,"setPublishAudioFilterEnabled",[$9],Object.getOwnPropertyDescriptor(Te.prototype,"setPublishAudioFilterEnabled"),Te.prototype),Te);class Ov{constructor(e,n){N(this,"id",0),N(this,"element",void 0),N(this,"peerPair",void 0),N(this,"context",void 0),N(this,"audioPlayerElement",void 0),N(this,"audioTrack",void 0),Ov.count+=1,this.id=Ov.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(r,i)=>{const s=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new we(o=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&o(r.localDescription)}})},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await e(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await e(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new te(P.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(i){throw new te(P.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new te(P.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){S.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var eW,HT;N(Ov,"count",0);const XLe=window.AudioContext||window.webkitAudioContext,JLe=new(eW=je({report:Le}),Oe((HT=class{constructor(){N(this,"units",[]),N(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return S.debug("the system does not need to process local aec"),-1;this.context||(this.context=new XLe);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new Ov(t,this.context),this.units.push(e)),e.startEchoCancellation(),S.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Ct().name!==xt.SAFARI}}).prototype,"processExternalMediaAEC",[eW],Object.getOwnPropertyDescriptor(HT.prototype,"processExternalMediaAEC"),HT.prototype),HT);function tW(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function nW(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?tW(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tW(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const r1=window||document;function dne(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!r1)return;const n=Kn._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const r=i=>{if(!(i&&i.blockedURI&&(Kn.onSecurityPolicyViolation||Kn.getListeners(QA.SECURITY_POLICY_VIOLATION).length>0)))return;const s=i.blockedURI;G("CSP_DETECTED_HOSTNAME_LIST").some(o=>Se(s).call(s,o))&&(Kn.onSecurityPolicyViolation&&typeof Kn.onSecurityPolicyViolation=="function"&&Kn.onSecurityPolicyViolation(i),Kn.getListeners(QA.SECURITY_POLICY_VIOLATION).length>0&&Kn.safeEmit(QA.SECURITY_POLICY_VIOLATION,i))};n&&r1.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||Kn.getListeners(QA.SECURITY_POLICY_VIOLATION).length>0)&&r1.addEventListener("securitypolicyviolation",r),Kn._cspEventHandlerPointer=r}var $Le=Bs,ZLe=gee,rW=RegExp.prototype,ePe=function(t){return t===rW||$Le(rW,t)?ZLe(t):t.flags},ss=Zn(ePe);function E_(t){let e=t.length;for(;--e>=0;)t[e]=0}const R2=256,hne=286,ky=30,xy=15,WP=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),sS=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),tPe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),iW=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yl=new Array(576);E_(Yl);const My=new Array(60);E_(My);const Nv=new Array(512);E_(Nv);const Dv=new Array(256);E_(Dv);const O2=new Array(29);E_(O2);const bb=new Array(ky);function i1(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let sW,oW,aW;function s1(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}E_(bb);const fne=t=>t<256?Nv[t]:Nv[256+(t>>>7)],Bv=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},qo=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,Bv(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},HA=(t,e,n)=>{qo(t,n[2*e],n[2*e+1])},pne=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},mne=(t,e,n)=>{const r=new Array(16);let i,s,o=0;for(i=1;i<=xy;i++)o=o+n[i-1]<<1,r[i]=o;for(s=0;s<=e;s++){let a=t[2*s+1];a!==0&&(t[2*s]=pne(r[a]++,a))}},gne=t=>{let e;for(e=0;e<hne;e++)t.dyn_ltree[2*e]=0;for(e=0;e<ky;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},_ne=t=>{t.bi_valid>8?Bv(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},cW=(t,e,n,r)=>{const i=2*e,s=2*n;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},o1=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&cW(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!cW(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},AW=(t,e,n)=>{let r,i,s,o,a=0;if(t.sym_next!==0)do r=255&t.pending_buf[t.sym_buf+a++],r+=(255&t.pending_buf[t.sym_buf+a++])<<8,i=t.pending_buf[t.sym_buf+a++],r===0?HA(t,i,e):(s=Dv[i],HA(t,s+R2+1,e),o=WP[s],o!==0&&(i-=O2[s],qo(t,i,o)),r--,s=fne(r),HA(t,s,n),o=sS[s],o!==0&&(r-=bb[s],qo(t,r,o)));while(a<t.sym_next);HA(t,256,e)},a1=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,A,l=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<s;o++)n[2*o]!==0?(t.heap[++t.heap_len]=l=o,t.depth[o]=0):n[2*o+1]=0;for(;t.heap_len<2;)A=t.heap[++t.heap_len]=l<2?++l:0,n[2*A]=1,t.depth[A]=0,t.opt_len--,i&&(t.static_len-=r[2*A+1]);for(e.max_code=l,o=t.heap_len>>1;o>=1;o--)o1(t,n,o);A=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],o1(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[2*A]=n[2*o]+n[2*a],t.depth[A]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[2*o+1]=n[2*a+1]=A,t.heap[1]=A++,o1(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((d,f)=>{const p=f.dyn_tree,g=f.max_code,y=f.stat_desc.static_tree,E=f.stat_desc.has_stree,w=f.stat_desc.extra_bits,b=f.stat_desc.extra_base,I=f.stat_desc.max_length;let B,U,H,K,x,V,M=0;for(K=0;K<=xy;K++)d.bl_count[K]=0;for(p[2*d.heap[d.heap_max]+1]=0,B=d.heap_max+1;B<573;B++)U=d.heap[B],K=p[2*p[2*U+1]+1]+1,K>I&&(K=I,M++),p[2*U+1]=K,U>g||(d.bl_count[K]++,x=0,U>=b&&(x=w[U-b]),V=p[2*U],d.opt_len+=V*(K+x),E&&(d.static_len+=V*(y[2*U+1]+x)));if(M!==0){do{for(K=I-1;d.bl_count[K]===0;)K--;d.bl_count[K]--,d.bl_count[K+1]+=2,d.bl_count[I]--,M-=2}while(M>0);for(K=I;K!==0;K--)for(U=d.bl_count[K];U!==0;)H=d.heap[--B],H>g||(p[2*H+1]!==K&&(d.opt_len+=(K-p[2*H+1])*p[2*H],p[2*H+1]=K),U--)}})(t,e),mne(n,l,t.bl_count)},lW=(t,e,n)=>{let r,i,s=-1,o=e[1],a=0,A=7,l=4;for(o===0&&(A=138,l=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=e[2*(r+1)+1],++a<A&&i===o||(a<l?t.bl_tree[2*i]+=a:i!==0?(i!==s&&t.bl_tree[2*i]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,s=i,o===0?(A=138,l=3):i===o?(A=6,l=3):(A=7,l=4))},uW=(t,e,n)=>{let r,i,s=-1,o=e[1],a=0,A=7,l=4;for(o===0&&(A=138,l=3),r=0;r<=n;r++)if(i=o,o=e[2*(r+1)+1],!(++a<A&&i===o)){if(a<l)do HA(t,i,t.bl_tree);while(--a!=0);else i!==0?(i!==s&&(HA(t,i,t.bl_tree),a--),HA(t,16,t.bl_tree),qo(t,a-3,2)):a<=10?(HA(t,17,t.bl_tree),qo(t,a-3,3)):(HA(t,18,t.bl_tree),qo(t,a-11,7));a=0,s=i,o===0?(A=138,l=3):i===o?(A=6,l=3):(A=7,l=4)}};let dW=!1;const Ene=(t,e,n,r)=>{qo(t,0+(r?1:0),3),_ne(t),Bv(t,n),Bv(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var nPe=t=>{dW||((()=>{let e,n,r,i,s;const o=new Array(16);for(r=0,i=0;i<28;i++)for(O2[i]=r,e=0;e<1<<WP[i];e++)Dv[r++]=i;for(Dv[r-1]=i,s=0,i=0;i<16;i++)for(bb[i]=s,e=0;e<1<<sS[i];e++)Nv[s++]=i;for(s>>=7;i<ky;i++)for(bb[i]=s<<7,e=0;e<1<<sS[i]-7;e++)Nv[256+s++]=i;for(n=0;n<=xy;n++)o[n]=0;for(e=0;e<=143;)Yl[2*e+1]=8,e++,o[8]++;for(;e<=255;)Yl[2*e+1]=9,e++,o[9]++;for(;e<=279;)Yl[2*e+1]=7,e++,o[7]++;for(;e<=287;)Yl[2*e+1]=8,e++,o[8]++;for(mne(Yl,287,o),e=0;e<ky;e++)My[2*e+1]=5,My[2*e]=pne(e,5);sW=new i1(Yl,WP,257,hne,xy),oW=new i1(My,sS,0,ky,xy),aW=new i1(new Array(0),tPe,0,19,7)})(),dW=!0),t.l_desc=new s1(t.dyn_ltree,sW),t.d_desc=new s1(t.dyn_dtree,oW),t.bl_desc=new s1(t.bl_tree,aW),t.bi_buf=0,t.bi_valid=0,gne(t)},rPe=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(a=>{let A,l=4093624447;for(A=0;A<=31;A++,l>>>=1)if(1&l&&a.dyn_ltree[2*A]!==0)return 0;if(a.dyn_ltree[18]!==0||a.dyn_ltree[20]!==0||a.dyn_ltree[26]!==0)return 1;for(A=32;A<R2;A++)if(a.dyn_ltree[2*A]!==0)return 1;return 0})(t)),a1(t,t.l_desc),a1(t,t.d_desc),o=(a=>{let A;for(lW(a,a.dyn_ltree,a.l_desc.max_code),lW(a,a.dyn_dtree,a.d_desc.max_code),a1(a,a.bl_desc),A=18;A>=3&&a.bl_tree[2*iW[A]+1]===0;A--);return a.opt_len+=3*(A+1)+5+5+4,A})(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?Ene(t,e,n,r):t.strategy===4||s===i?(qo(t,2+(r?1:0),3),AW(t,Yl,My)):(qo(t,4+(r?1:0),3),((a,A,l,d)=>{let f;for(qo(a,A-257,5),qo(a,l-1,5),qo(a,d-4,4),f=0;f<d;f++)qo(a,a.bl_tree[2*iW[f]+1],3);uW(a,a.dyn_ltree,A-1),uW(a,a.dyn_dtree,l-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),AW(t,t.dyn_ltree,t.dyn_dtree)),gne(t),r&&_ne(t)},iPe=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(Dv[n]+R2+1)]++,t.dyn_dtree[2*fne(e)]++),t.sym_next===t.sym_end),sPe=t=>{qo(t,2,3),HA(t,256,Yl),(e=>{e.bi_valid===16?(Bv(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},oPe={_tr_init:nPe,_tr_stored_block:Ene,_tr_flush_block:rPe,_tr_tally:iPe,_tr_align:sPe},Lv=(t,e,n,r)=>{let i=65535&t|0,s=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const aPe=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var vs=(t,e,n,r)=>{const i=aPe,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[255&(t^e[o])];return-1^t},jf={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},nR={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:cPe,_tr_stored_block:zP,_tr_flush_block:APe,_tr_tally:Qd,_tr_align:lPe}=oPe,{Z_NO_FLUSH:Hd,Z_PARTIAL_FLUSH:uPe,Z_FULL_FLUSH:dPe,Z_FINISH:lc,Z_BLOCK:hW,Z_OK:Ks,Z_STREAM_END:fW,Z_STREAM_ERROR:$A,Z_DATA_ERROR:hPe,Z_BUF_ERROR:c1,Z_DEFAULT_COMPRESSION:fPe,Z_FILTERED:pPe,Z_HUFFMAN_ONLY:jT,Z_RLE:mPe,Z_FIXED:gPe,Z_DEFAULT_STRATEGY:_Pe,Z_UNKNOWN:EPe,Z_DEFLATED:rR}=nR,qP=286,yPe=30,vPe=19,wPe=2*qP+1,CPe=15,_f=258,ZA=262,Fg=42,Ef=113,sy=666,yf=(t,e)=>(t.msg=jf[e],e),pW=t=>2*t-(t>4?9:0),yd=t=>{let e=t.length;for(;--e>=0;)t[e]=0},TPe=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let jd=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const Ea=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},wa=(t,e)=>{APe(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Ea(t.strm)},Qn=(t,e)=>{t.pending_buf[t.pending++]=e},xE=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},YP=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=Lv(t.adler,e,i,n):t.state.wrap===2&&(t.adler=vs(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},yne=(t,e)=>{let n,r,i=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match;const A=t.strstart>t.w_size-ZA?t.strstart-(t.w_size-ZA):0,l=t.window,d=t.w_mask,f=t.prev,p=t.strstart+_f;let g=l[s+o-1],y=l[s+o];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do if(n=e,l[n+o]===y&&l[n+o-1]===g&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do;while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<p);if(r=_f-(p-s),s=p-_f,r>o){if(t.match_start=e,o=r,r>=a)break;g=l[s+o-1],y=l[s+o]}}while((e=f[e&d])>A&&--i!=0);return o<=t.lookahead?o:t.lookahead},Vg=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-ZA)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),TPe(t),r+=e),t.strm.avail_in===0)break;if(n=YP(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=jd(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=jd(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<ZA&&t.strm.avail_in!==0)},vne=(t,e)=>{let n,r,i,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o=0,a=t.strm.avail_in;do{if(n=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i||(i=t.strm.avail_out-i,r=t.strstart-t.block_start,n>r+t.strm.avail_in&&(n=r+t.strm.avail_in),n>i&&(n=i),n<s&&(n===0&&e!==lc||e===Hd||n!==r+t.strm.avail_in)))break;o=e===lc&&n===r+t.strm.avail_in?1:0,zP(t,0,0,o),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,Ea(t.strm),r&&(r>n&&(r=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+r),t.strm.next_out),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r,t.block_start+=r,n-=r),n&&(YP(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?4:e!==Hd&&e!==lc&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(YP(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,s=i>t.w_size?t.w_size:i,r=t.strstart-t.block_start,(r>=s||(r||e===lc)&&e!==Hd&&t.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,o=e===lc&&t.strm.avail_in===0&&n===r?1:0,zP(t,t.block_start,n,o),t.block_start+=n,Ea(t.strm)),o?3:1)},A1=(t,e)=>{let n,r;for(;;){if(t.lookahead<ZA){if(Vg(t),t.lookahead<ZA&&e===Hd)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=jd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-ZA&&(t.match_length=yne(t,n)),t.match_length>=3)if(r=Qd(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=jd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=jd(t,t.ins_h,t.window[t.strstart+1]);else r=Qd(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(wa(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===lc?(wa(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(wa(t,!1),t.strm.avail_out===0)?1:2},im=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<ZA){if(Vg(t),t.lookahead<ZA&&e===Hd)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=jd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-ZA&&(t.match_length=yne(t,n),t.match_length<=5&&(t.strategy===pPe||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,r=Qd(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=jd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(wa(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(r=Qd(t,0,t.window[t.strstart-1]),r&&wa(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Qd(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===lc?(wa(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(wa(t,!1),t.strm.avail_out===0)?1:2};function BA(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const oy=[new BA(0,0,0,0,vne),new BA(4,4,8,4,A1),new BA(4,5,16,8,A1),new BA(4,6,32,32,A1),new BA(4,4,16,16,im),new BA(8,16,32,32,im),new BA(8,16,128,128,im),new BA(8,32,128,256,im),new BA(32,128,258,1024,im),new BA(32,258,258,4096,im)];function SPe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=rR,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*wPe),this.dyn_dtree=new Uint16Array(2*(2*yPe+1)),this.bl_tree=new Uint16Array(2*(2*vPe+1)),yd(this.dyn_ltree),yd(this.dyn_dtree),yd(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(CPe+1),this.heap=new Uint16Array(2*qP+1),yd(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*qP+1),yd(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Pv=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Fg&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Ef&&e.status!==sy?1:0},wne=t=>{if(Pv(t))return yf(t,$A);t.total_in=t.total_out=0,t.data_type=EPe;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?Fg:Ef,t.adler=e.wrap===2?0:1,e.last_flush=-2,cPe(e),Ks},Cne=t=>{const e=wne(t);return e===Ks&&(n=>{n.window_size=2*n.w_size,yd(n.head),n.max_lazy_match=oy[n.level].max_lazy,n.good_match=oy[n.level].good_length,n.nice_match=oy[n.level].nice_length,n.max_chain_length=oy[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},mW=(t,e,n,r,i,s)=>{if(!t)return $A;let o=1;if(e===fPe&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==rR||r<8||r>15||e<0||e>9||s<0||s>gPe||r===8&&o!==1)return yf(t,$A);r===8&&(r=9);const a=new SPe;return t.state=a,a.strm=t,a.status=Fg,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=s,a.method=n,Cne(t)};var bPe=(t,e)=>{if(Pv(t)||e>hW||e<0)return t?yf(t,$A):$A;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===sy&&e!==lc)return yf(t,t.avail_out===0?c1:$A);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(Ea(t),t.avail_out===0)return n.last_flush=-1,Ks}else if(t.avail_in===0&&pW(e)<=pW(r)&&e!==lc)return yf(t,c1);if(n.status===sy&&t.avail_in!==0)return yf(t,c1);if(n.status===Fg&&n.wrap===0&&(n.status=Ef),n.status===Fg){let i=rR+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=jT||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=s<<6,n.strstart!==0&&(i|=32),i+=31-i%31,xE(n,i),n.strstart!==0&&(xE(n,t.adler>>>16),xE(n,65535&t.adler)),t.adler=1,n.status=Ef,Ea(t),n.pending!==0)return n.last_flush=-1,Ks}if(n.status===57){if(t.adler=0,Qn(n,31),Qn(n,139),Qn(n,8),n.gzhead)Qn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Qn(n,255&n.gzhead.time),Qn(n,n.gzhead.time>>8&255),Qn(n,n.gzhead.time>>16&255),Qn(n,n.gzhead.time>>24&255),Qn(n,n.level===9?2:n.strategy>=jT||n.level<2?4:0),Qn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Qn(n,255&n.gzhead.extra.length),Qn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=vs(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Qn(n,0),Qn(n,0),Qn(n,0),Qn(n,0),Qn(n,0),Qn(n,n.level===9?2:n.strategy>=jT||n.level<2?4:0),Qn(n,3),n.status=Ef,Ea(t),n.pending!==0)return n.last_flush=-1,Ks}if(n.status===69){if(n.gzhead.extra){let i=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=vs(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,Ea(t),n.pending!==0)return n.last_flush=-1,Ks;i=0,s-=a}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(t.adler=vs(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=vs(t.adler,n.pending_buf,n.pending-s,s)),Ea(t),n.pending!==0)return n.last_flush=-1,Ks;s=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Qn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=vs(t.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=vs(t.adler,n.pending_buf,n.pending-s,s)),Ea(t),n.pending!==0)return n.last_flush=-1,Ks;s=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Qn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=vs(t.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Ea(t),n.pending!==0))return n.last_flush=-1,Ks;Qn(n,255&t.adler),Qn(n,t.adler>>8&255),t.adler=0}if(n.status=Ef,Ea(t),n.pending!==0)return n.last_flush=-1,Ks}if(t.avail_in!==0||n.lookahead!==0||e!==Hd&&n.status!==sy){let i=n.level===0?vne(n,e):n.strategy===jT?((s,o)=>{let a;for(;;){if(s.lookahead===0&&(Vg(s),s.lookahead===0)){if(o===Hd)return 1;break}if(s.match_length=0,a=Qd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,a&&(wa(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===lc?(wa(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(wa(s,!1),s.strm.avail_out===0)?1:2})(n,e):n.strategy===mPe?((s,o)=>{let a,A,l,d;const f=s.window;for(;;){if(s.lookahead<=_f){if(Vg(s),s.lookahead<=_f&&o===Hd)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(l=s.strstart-1,A=f[l],A===f[++l]&&A===f[++l]&&A===f[++l])){d=s.strstart+_f;do;while(A===f[++l]&&A===f[++l]&&A===f[++l]&&A===f[++l]&&A===f[++l]&&A===f[++l]&&A===f[++l]&&A===f[++l]&&l<d);s.match_length=_f-(d-l),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(a=Qd(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(a=Qd(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),a&&(wa(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===lc?(wa(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(wa(s,!1),s.strm.avail_out===0)?1:2})(n,e):oy[n.level].func(n,e);if(i!==3&&i!==4||(n.status=sy),i===1||i===3)return t.avail_out===0&&(n.last_flush=-1),Ks;if(i===2&&(e===uPe?lPe(n):e!==hW&&(zP(n,0,0,!1),e===dPe&&(yd(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Ea(t),t.avail_out===0))return n.last_flush=-1,Ks}return e!==lc?Ks:n.wrap<=0?fW:(n.wrap===2?(Qn(n,255&t.adler),Qn(n,t.adler>>8&255),Qn(n,t.adler>>16&255),Qn(n,t.adler>>24&255),Qn(n,255&t.total_in),Qn(n,t.total_in>>8&255),Qn(n,t.total_in>>16&255),Qn(n,t.total_in>>24&255)):(xE(n,t.adler>>>16),xE(n,65535&t.adler)),Ea(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Ks:fW)},IPe=(t,e)=>{let n=e.length;if(Pv(t))return $A;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==Fg||r.lookahead)return $A;if(i===1&&(t.adler=Lv(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(yd(r.head),r.strstart=0,r.block_start=0,r.insert=0);let A=new Uint8Array(r.w_size);A.set(e.subarray(n-r.w_size,n),0),e=A,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,Vg(r);r.lookahead>=3;){let A=r.strstart,l=r.lookahead-2;do r.ins_h=jd(r,r.ins_h,r.window[A+3-1]),r.prev[A&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=A,A++;while(--l);r.strstart=A,r.lookahead=2,Vg(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,Ks},Fy={deflateInit:(t,e)=>mW(t,e,rR,15,8,_Pe),deflateInit2:mW,deflateReset:Cne,deflateResetKeep:wne,deflateSetHeader:(t,e)=>Pv(t)||t.state.wrap!==2?$A:(t.state.gzhead=e,Ks),deflate:bPe,deflateEnd:t=>{if(Pv(t))return $A;const e=t.state.status;return t.state=null,e===Ef?yf(t,hPe):Ks},deflateSetDictionary:IPe,deflateInfo:"pako deflate (from Nodeca project)"};const RPe=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var iR={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)RPe(n,r)&&(t[r]=n[r])}}return t},flattenChunks:t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];n.set(o,i),i+=o.length}return n}};let Tne=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Tne=!1}const Uv=new Uint8Array(256);for(let t=0;t<256;t++)Uv[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Uv[254]=Uv[254]=1;var kv={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=t.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=t.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=Uv[o];if(a>4)s[i++]=65533,r+=a-1;else{for(o&=a===2?31:a===3?15:7;a>1&&r<n;)o=o<<6|63&t[r++],a--;a>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,a)=>{if(a<65534&&o.subarray&&Tne)return String.fromCharCode.apply(null,o.length===a?o:o.subarray(0,a));let A="";for(let l=0;l<a;l++)A+=String.fromCharCode(o[l]);return A})(s,i)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+Uv[t[n]]>e?n:e}},Sne=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const bne=Object.prototype.toString,{Z_NO_FLUSH:OPe,Z_SYNC_FLUSH:NPe,Z_FULL_FLUSH:DPe,Z_FINISH:BPe,Z_OK:Ib,Z_STREAM_END:LPe,Z_DEFAULT_COMPRESSION:PPe,Z_DEFAULT_STRATEGY:UPe,Z_DEFLATED:kPe}=nR;function oS(t){this.options=iR.assign({level:PPe,method:kPe,chunkSize:16384,windowBits:15,memLevel:8,strategy:UPe},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sne,this.strm.avail_out=0;let n=Fy.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Ib)throw new Error(jf[n]);if(e.header&&Fy.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(r=typeof e.dictionary=="string"?kv.string2buf(e.dictionary):bne.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=Fy.deflateSetDictionary(this.strm,r),n!==Ib)throw new Error(jf[n]);this._dict_set=!0}}function xPe(t,e){const n=new oS(e);if(n.push(t,!0),n.err)throw n.msg||jf[n.err];return n.result}oS.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=e===~~e?e:e===!0?BPe:OPe,typeof t=="string"?n.input=kv.string2buf(t):bne.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===NPe||s===DPe)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=Fy.deflate(n,s),i===LPe)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=Fy.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Ib;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},oS.prototype.onData=function(t){this.chunks.push(t)},oS.prototype.onEnd=function(t){t===Ib&&(this.result=iR.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var MPe={deflate:xPe};const KT=16209;var FPe=function(t,e){let n,r,i,s,o,a,A,l,d,f,p,g,y,E,w,b,I,B,U,H,K,x,V,M;const O=t.state;n=t.next_in,V=t.input,r=n+(t.avail_in-5),i=t.next_out,M=t.output,s=i-(e-t.avail_out),o=i+(t.avail_out-257),a=O.dmax,A=O.wsize,l=O.whave,d=O.wnext,f=O.window,p=O.hold,g=O.bits,y=O.lencode,E=O.distcode,w=(1<<O.lenbits)-1,b=(1<<O.distbits)-1;e:do{g<15&&(p+=V[n++]<<g,g+=8,p+=V[n++]<<g,g+=8),I=y[p&w];t:for(;;){if(B=I>>>24,p>>>=B,g-=B,B=I>>>16&255,B===0)M[i++]=65535&I;else{if(!(16&B)){if((64&B)==0){I=y[(65535&I)+(p&(1<<B)-1)];continue t}if(32&B){O.mode=16191;break e}t.msg="invalid literal/length code",O.mode=KT;break e}U=65535&I,B&=15,B&&(g<B&&(p+=V[n++]<<g,g+=8),U+=p&(1<<B)-1,p>>>=B,g-=B),g<15&&(p+=V[n++]<<g,g+=8,p+=V[n++]<<g,g+=8),I=E[p&b];n:for(;;){if(B=I>>>24,p>>>=B,g-=B,B=I>>>16&255,!(16&B)){if((64&B)==0){I=E[(65535&I)+(p&(1<<B)-1)];continue n}t.msg="invalid distance code",O.mode=KT;break e}if(H=65535&I,B&=15,g<B&&(p+=V[n++]<<g,g+=8,g<B&&(p+=V[n++]<<g,g+=8)),H+=p&(1<<B)-1,H>a){t.msg="invalid distance too far back",O.mode=KT;break e}if(p>>>=B,g-=B,B=i-s,H>B){if(B=H-B,B>l&&O.sane){t.msg="invalid distance too far back",O.mode=KT;break e}if(K=0,x=f,d===0){if(K+=A-B,B<U){U-=B;do M[i++]=f[K++];while(--B);K=i-H,x=M}}else if(d<B){if(K+=A+d-B,B-=d,B<U){U-=B;do M[i++]=f[K++];while(--B);if(K=0,d<U){B=d,U-=B;do M[i++]=f[K++];while(--B);K=i-H,x=M}}}else if(K+=d-B,B<U){U-=B;do M[i++]=f[K++];while(--B);K=i-H,x=M}for(;U>2;)M[i++]=x[K++],M[i++]=x[K++],M[i++]=x[K++],U-=3;U&&(M[i++]=x[K++],U>1&&(M[i++]=x[K++]))}else{K=i-H;do M[i++]=M[K++],M[i++]=M[K++],M[i++]=M[K++],U-=3;while(U>2);U&&(M[i++]=M[K++],U>1&&(M[i++]=M[K++]))}break}}break}}while(n<r&&i<o);U=g>>3,n-=U,g-=U<<3,p&=(1<<g)-1,t.next_in=n,t.next_out=i,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=i<o?o-i+257:257-(i-o),O.hold=p,O.bits=g};const GT=15,VPe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),QPe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),HPe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),jPe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Vy=(t,e,n,r,i,s,o,a)=>{const A=a.bits;let l,d,f,p,g,y,E=0,w=0,b=0,I=0,B=0,U=0,H=0,K=0,x=0,V=0,M=null;const O=new Uint16Array(16),z=new Uint16Array(16);let $,q,Ue,fe=null;for(E=0;E<=GT;E++)O[E]=0;for(w=0;w<r;w++)O[e[n+w]]++;for(B=A,I=GT;I>=1&&O[I]===0;I--);if(B>I&&(B=I),I===0)return i[s++]=20971520,i[s++]=20971520,a.bits=1,0;for(b=1;b<I&&O[b]===0;b++);for(B<b&&(B=b),K=1,E=1;E<=GT;E++)if(K<<=1,K-=O[E],K<0)return-1;if(K>0&&(t===0||I!==1))return-1;for(z[1]=0,E=1;E<GT;E++)z[E+1]=z[E]+O[E];for(w=0;w<r;w++)e[n+w]!==0&&(o[z[e[n+w]]++]=w);if(t===0?(M=fe=o,y=20):t===1?(M=VPe,fe=QPe,y=257):(M=HPe,fe=jPe,y=0),V=0,w=0,E=b,g=s,U=B,H=0,f=-1,x=1<<B,p=x-1,t===1&&x>852||t===2&&x>592)return 1;for(;;){$=E-H,o[w]+1<y?(q=0,Ue=o[w]):o[w]>=y?(q=fe[o[w]-y],Ue=M[o[w]-y]):(q=96,Ue=0),l=1<<E-H,d=1<<U,b=d;do d-=l,i[g+(V>>H)+d]=$<<24|q<<16|Ue|0;while(d!==0);for(l=1<<E-1;V&l;)l>>=1;if(l!==0?(V&=l-1,V+=l):V=0,w++,--O[E]==0){if(E===I)break;E=e[n+o[w]]}if(E>B&&(V&p)!==f){for(H===0&&(H=B),g+=b,U=E-H,K=1<<U;U+H<I&&(K-=O[U+H],!(K<=0));)U++,K<<=1;if(x+=1<<U,t===1&&x>852||t===2&&x>592)return 1;f=V&p,i[f]=B<<24|U<<16|g-s|0}}return V!==0&&(i[g+V]=E-H<<24|64<<16|0),a.bits=B,0};const{Z_FINISH:gW,Z_BLOCK:KPe,Z_TREES:WT,Z_OK:Rf,Z_STREAM_END:GPe,Z_NEED_DICT:WPe,Z_STREAM_ERROR:uc,Z_DATA_ERROR:Ine,Z_MEM_ERROR:Rne,Z_BUF_ERROR:zPe,Z_DEFLATED:_W}=nR,sR=16180,Rb=16190,Fl=16191,l1=16192,u1=16194,zT=16199,qT=16200,d1=16206,Fr=16209,EW=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function qPe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Of=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<sR||e.mode>16211?1:0},One=t=>{if(Of(t))return uc;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=sR,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Rf},Nne=t=>{if(Of(t))return uc;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,One(t)},Dne=(t,e)=>{let n;if(Of(t))return uc;const r=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?uc:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Nne(t))},yW=(t,e)=>{if(!t)return uc;const n=new qPe;t.state=n,n.strm=t,n.window=null,n.mode=sR;const r=Dne(t,e);return r!==Rf&&(t.state=null),r};let h1,f1,vW=!0;const YPe=t=>{if(vW){h1=new Int32Array(512),f1=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Vy(1,t.lens,0,288,h1,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Vy(2,t.lens,0,32,f1,0,t.work,{bits:5}),vW=!1}t.lencode=h1,t.lenbits=9,t.distcode=f1,t.distbits=5},Bne=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var XPe=(t,e)=>{let n,r,i,s,o,a,A,l,d,f,p,g,y,E,w,b,I,B,U,H,K,x,V=0;const M=new Uint8Array(4);let O,z;const $=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Of(t)||!t.output||!t.input&&t.avail_in!==0)return uc;n=t.state,n.mode===Fl&&(n.mode=l1),o=t.next_out,i=t.output,A=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,d=n.bits,f=a,p=A,x=Rf;e:for(;;)switch(n.mode){case sR:if(n.wrap===0){n.mode=l1;break}for(;d<16;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}if(2&n.wrap&&l===35615){n.wbits===0&&(n.wbits=15),n.check=0,M[0]=255&l,M[1]=l>>>8&255,n.check=vs(n.check,M,2,0),l=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=Fr;break}if((15&l)!==_W){t.msg="unknown compression method",n.mode=Fr;break}if(l>>>=4,d-=4,K=8+(15&l),n.wbits===0&&(n.wbits=K),K>15||K>n.wbits){t.msg="invalid window size",n.mode=Fr;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&l?16189:Fl,l=0,d=0;break;case 16181:for(;d<16;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}if(n.flags=l,(255&ss(n))!==_W){t.msg="unknown compression method",n.mode=Fr;break}if(57344&ss(n)){t.msg="unknown header flags set",n.mode=Fr;break}n.head&&(n.head.text=l>>8&1),512&ss(n)&&4&n.wrap&&(M[0]=255&l,M[1]=l>>>8&255,n.check=vs(n.check,M,2,0)),l=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}n.head&&(n.head.time=l),512&ss(n)&&4&n.wrap&&(M[0]=255&l,M[1]=l>>>8&255,M[2]=l>>>16&255,M[3]=l>>>24&255,n.check=vs(n.check,M,4,0)),l=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&ss(n)&&4&n.wrap&&(M[0]=255&l,M[1]=l>>>8&255,n.check=vs(n.check,M,2,0)),l=0,d=0,n.mode=16184;case 16184:if(1024&ss(n)){for(;d<16;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}n.length=l,n.head&&(n.head.extra_len=l),512&ss(n)&&4&n.wrap&&(M[0]=255&l,M[1]=l>>>8&255,n.check=vs(n.check,M,2,0)),l=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&ss(n)&&(g=n.length,g>a&&(g=a),g&&(n.head&&(K=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+g),K)),512&ss(n)&&4&n.wrap&&(n.check=vs(n.check,r,g,s)),a-=g,s+=g,n.length-=g),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&ss(n)){if(a===0)break e;g=0;do K=r[s+g++],n.head&&K&&n.length<65536&&(n.head.name+=String.fromCharCode(K));while(K&&g<a);if(512&ss(n)&&4&n.wrap&&(n.check=vs(n.check,r,g,s)),a-=g,s+=g,K)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&ss(n)){if(a===0)break e;g=0;do K=r[s+g++],n.head&&K&&n.length<65536&&(n.head.comment+=String.fromCharCode(K));while(K&&g<a);if(512&ss(n)&&4&n.wrap&&(n.check=vs(n.check,r,g,s)),a-=g,s+=g,K)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&ss(n)){for(;d<16;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}if(4&n.wrap&&l!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Fr;break}l=0,d=0}n.head&&(n.head.hcrc=ss(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Fl;break;case 16189:for(;d<32;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}t.adler=n.check=EW(l),l=0,d=0,n.mode=Rb;case Rb:if(n.havedict===0)return t.next_out=o,t.avail_out=A,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=d,WPe;t.adler=n.check=1,n.mode=Fl;case Fl:if(e===KPe||e===WT)break e;case l1:if(n.last){l>>>=7&d,d-=7&d,n.mode=d1;break}for(;d<3;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}switch(n.last=1&l,l>>>=1,d-=1,3&l){case 0:n.mode=16193;break;case 1:if(YPe(n),n.mode=zT,e===WT){l>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=Fr}l>>>=2,d-=2;break;case 16193:for(l>>>=7&d,d-=7&d;d<32;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}if((65535&l)!=(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Fr;break}if(n.length=65535&l,l=0,d=0,n.mode=u1,e===WT)break e;case u1:n.mode=16195;case 16195:if(g=n.length,g){if(g>a&&(g=a),g>A&&(g=A),g===0)break e;i.set(r.subarray(s,s+g),o),a-=g,s+=g,A-=g,o+=g,n.length-=g;break}n.mode=Fl;break;case 16196:for(;d<14;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}if(n.nlen=257+(31&l),l>>>=5,d-=5,n.ndist=1+(31&l),l>>>=5,d-=5,n.ncode=4+(15&l),l>>>=4,d-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Fr;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}n.lens[$[n.have++]]=7&l,l>>>=3,d-=3}for(;n.have<19;)n.lens[$[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,O={bits:n.lenbits},x=Vy(0,n.lens,0,19,n.lencode,0,n.work,O),n.lenbits=O.bits,x){t.msg="invalid code lengths set",n.mode=Fr;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;V=n.lencode[l&(1<<n.lenbits)-1],w=V>>>24,b=V>>>16&255,I=65535&V,!(w<=d);){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}if(I<16)l>>>=w,d-=w,n.lens[n.have++]=I;else{if(I===16){for(z=w+2;d<z;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}if(l>>>=w,d-=w,n.have===0){t.msg="invalid bit length repeat",n.mode=Fr;break}K=n.lens[n.have-1],g=3+(3&l),l>>>=2,d-=2}else if(I===17){for(z=w+3;d<z;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}l>>>=w,d-=w,K=0,g=3+(7&l),l>>>=3,d-=3}else{for(z=w+7;d<z;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}l>>>=w,d-=w,K=0,g=11+(127&l),l>>>=7,d-=7}if(n.have+g>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Fr;break}for(;g--;)n.lens[n.have++]=K}}if(n.mode===Fr)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=Fr;break}if(n.lenbits=9,O={bits:n.lenbits},x=Vy(1,n.lens,0,n.nlen,n.lencode,0,n.work,O),n.lenbits=O.bits,x){t.msg="invalid literal/lengths set",n.mode=Fr;break}if(n.distbits=6,n.distcode=n.distdyn,O={bits:n.distbits},x=Vy(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,O),n.distbits=O.bits,x){t.msg="invalid distances set",n.mode=Fr;break}if(n.mode=zT,e===WT)break e;case zT:n.mode=qT;case qT:if(a>=6&&A>=258){t.next_out=o,t.avail_out=A,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=d,FPe(t,p),o=t.next_out,i=t.output,A=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,d=n.bits,n.mode===Fl&&(n.back=-1);break}for(n.back=0;V=n.lencode[l&(1<<n.lenbits)-1],w=V>>>24,b=V>>>16&255,I=65535&V,!(w<=d);){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}if(b&&(240&b)==0){for(B=w,U=b,H=I;V=n.lencode[H+((l&(1<<B+U)-1)>>B)],w=V>>>24,b=V>>>16&255,I=65535&V,!(B+w<=d);){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}l>>>=B,d-=B,n.back+=B}if(l>>>=w,d-=w,n.back+=w,n.length=I,b===0){n.mode=16205;break}if(32&b){n.back=-1,n.mode=Fl;break}if(64&b){t.msg="invalid literal/length code",n.mode=Fr;break}n.extra=15&b,n.mode=16201;case 16201:if(n.extra){for(z=n.extra;d<z;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;V=n.distcode[l&(1<<n.distbits)-1],w=V>>>24,b=V>>>16&255,I=65535&V,!(w<=d);){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}if((240&b)==0){for(B=w,U=b,H=I;V=n.distcode[H+((l&(1<<B+U)-1)>>B)],w=V>>>24,b=V>>>16&255,I=65535&V,!(B+w<=d);){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}l>>>=B,d-=B,n.back+=B}if(l>>>=w,d-=w,n.back+=w,64&b){t.msg="invalid distance code",n.mode=Fr;break}n.offset=I,n.extra=15&b,n.mode=16203;case 16203:if(n.extra){for(z=n.extra;d<z;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Fr;break}n.mode=16204;case 16204:if(A===0)break e;if(g=p-A,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Fr;break}g>n.wnext?(g-=n.wnext,y=n.wsize-g):y=n.wnext-g,g>n.length&&(g=n.length),E=n.window}else E=i,y=o-n.offset,g=n.length;g>A&&(g=A),A-=g,n.length-=g;do i[o++]=E[y++];while(--g);n.length===0&&(n.mode=qT);break;case 16205:if(A===0)break e;i[o++]=n.length,A--,n.mode=qT;break;case d1:if(n.wrap){for(;d<32;){if(a===0)break e;a--,l|=r[s++]<<d,d+=8}if(p-=A,t.total_out+=p,n.total+=p,4&n.wrap&&p&&(t.adler=n.check=ss(n)?vs(n.check,i,p,o-p):Lv(n.check,i,p,o-p)),p=A,4&n.wrap&&(ss(n)?l:EW(l))!==n.check){t.msg="incorrect data check",n.mode=Fr;break}l=0,d=0}n.mode=16207;case 16207:if(n.wrap&&ss(n)){for(;d<32;){if(a===0)break e;a--,l+=r[s++]<<d,d+=8}if(4&n.wrap&&l!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Fr;break}l=0,d=0}n.mode=16208;case 16208:x=GPe;break e;case Fr:x=Ine;break e;case 16210:return Rne;default:return uc}return t.next_out=o,t.avail_out=A,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=d,(n.wsize||p!==t.avail_out&&n.mode<Fr&&(n.mode<d1||e!==gW))&&Bne(t,t.output,t.next_out,p-t.avail_out),f-=t.avail_in,p-=t.avail_out,t.total_in+=f,t.total_out+=p,n.total+=p,4&n.wrap&&p&&(t.adler=n.check=ss(n)?vs(n.check,i,p,t.next_out-p):Lv(n.check,i,p,t.next_out-p)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Fl?128:0)+(n.mode===zT||n.mode===u1?256:0),(f===0&&p===0||e===gW)&&x===Rf&&(x=zPe),x},Xl={inflateReset:Nne,inflateReset2:Dne,inflateResetKeep:One,inflateInit:t=>yW(t,15),inflateInit2:yW,inflate:XPe,inflateEnd:t=>{if(Of(t))return uc;let e=t.state;return e.window&&(e.window=null),t.state=null,Rf},inflateGetHeader:(t,e)=>{if(Of(t))return uc;const n=t.state;return(2&n.wrap)==0?uc:(n.head=e,e.done=!1,Rf)},inflateSetDictionary:(t,e)=>{const n=e.length;let r,i,s;return Of(t)?uc:(r=t.state,r.wrap!==0&&r.mode!==Rb?uc:r.mode===Rb&&(i=1,i=Lv(i,e,n,0),i!==r.check)?Ine:(s=Bne(t,e,n,n),s?(r.mode=16210,Rne):(r.havedict=1,Rf)))},inflateInfo:"pako inflate (from Nodeca project)"},JPe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Lne=Object.prototype.toString,{Z_NO_FLUSH:$Pe,Z_FINISH:ZPe,Z_OK:Qy,Z_STREAM_END:p1,Z_NEED_DICT:m1,Z_STREAM_ERROR:eUe,Z_DATA_ERROR:wW,Z_MEM_ERROR:tUe}=nR;function aS(t){this.options=iR.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Sne,this.strm.avail_out=0;let n=Xl.inflateInit2(this.strm,e.windowBits);if(n!==Qy)throw new Error(jf[n]);if(this.header=new JPe,Xl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=kv.string2buf(e.dictionary):Lne.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Xl.inflateSetDictionary(this.strm,e.dictionary),n!==Qy)))throw new Error(jf[n])}function nUe(t,e){const n=new aS(e);if(n.push(t),n.err)throw n.msg||jf[n.err];return n.result}aS.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=e===~~e?e:e===!0?ZPe:$Pe,Lne.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=Xl.inflate(n,o),s===m1&&i&&(s=Xl.inflateSetDictionary(n,i),s===Qy?s=Xl.inflate(n,o):s===wW&&(s=m1));n.avail_in>0&&s===p1&&n.state.wrap>0&&t[n.next_in]!==0;)Xl.inflateReset(n),s=Xl.inflate(n,o);switch(s){case eUe:case wW:case m1:case tUe:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||s===p1))if(this.options.to==="string"){let A=kv.utf8border(n.output,n.next_out),l=n.next_out-A,d=kv.buf2string(n.output,A);n.next_out=l,n.avail_out=r-l,l&&n.output.set(n.output.subarray(A,A+l),0),this.onData(d)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==Qy||a!==0){if(s===p1)return s=Xl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},aS.prototype.onData=function(t){this.chunks.push(t)},aS.prototype.onEnd=function(t){t===Qy&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=iR.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var rUe={inflate:nUe};const{deflate:iUe}=MPe,{inflate:sUe}=rUe;var oUe=iUe,aUe=sUe,Pne=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(Pne||{});class cUe{constructor(){N(this,"_sequence",0),N(this,"_startTime",Date.now()),N(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const a=new Uint8Array(4);a.set([1,0,0,0]);const A={id:0,length:4,data:a.buffer},l={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[A]};n.commonPacketHeader.extension=1,n.extension=l,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;G("SHOW_DATASTREAM2_LOG")&&S.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),s=new DataView(r);let o=0;if(s.setUint16(o,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),o+=2,s.setUint32(o,n.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,n.commonStreamHeader,!0),o+=2,n.extension){const a=this.serializeExtension(n.extension);i.set(new Uint8Array(a),o),o+=a.byteLength}if(i.set(new Uint8Array(n.payload),o),o+=n.payload.byteLength,o!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let r=0;const i=n.getUint16(r,!0);r+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let o,a;if(r+=4,G("SHOW_DATASTREAM2_LOG")&&S.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(r,!0),r+=2,s.extension){a=this.deserializeExtension(e.slice(r)),r+=2+a.length,o=e.slice(r);let A=!1;if(a.datas.length>0){const l=a.datas.find(d=>d.id===0);l&&(A=(1&new DataView(l.data).getUint32(0,!0))==1)}o=A?this.decompress(o):o}else o=e.slice(8);return o}serializeExtension(e){const{profile:n,length:r,datas:i}=e,s=new ArrayBuffer(r+2),o=new Uint8Array(s),a=new DataView(s);let A=0;if(a.setUint8(A++,n),a.setUint8(A++,r),i.forEach(l=>{n?(a.setUint8(A++,l.id),a.setUint8(A++,l.length),o.set(new Uint8Array(l.data),A),A+=l.data.byteLength):(a.setUint8(A++,l.id|l.length<<4),o.set(new Uint8Array(l.data),A),A+=l.data.byteLength)}),A!==r+2)throw Error("serialize extension error, is ".concat(A,"!==").concat(r+2));return s}deserializeExtension(e){const n=new DataView(e);let r=0;const i=n.getUint8(r);r++;const s=n.getUint8(r);r++;const o=i===Pne.TWO_BYTE,a=[],A=new DataView(e,2);let l=0;for(;l<s;){let d=0,f=0,p=new ArrayBuffer(0);o?(d=A.getUint8(l),l++,f=A.getUint8(l),l++):(d=15&A.getUint8(l),f=A.getUint8(l)>>4,l++),f>0&&(p=A.buffer.slice(l+2,l+2+f),l+=p.byteLength),a.push({id:d,length:f,data:p})}if(l!==s)throw Error("parse error");return{profile:i,length:s,datas:a}}decompress(e){return aUe(new Uint8Array(e))}compress(e){return oUe(new Uint8Array(e))}}const AUe={name:"DataStream",create:(t,e)=>{const n=e?new W1e(t):new z1e(t);return n.useDataStream(new cUe),n}};class lUe extends Ln{constructor(e,n,r){super(),N(this,"ws",void 0),N(this,"requestId",1),N(this,"heartBeatTimer",void 0),N(this,"joinInfo",void 0),N(this,"clientId",void 0),N(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),N(this,"onClose",i=>{this.emit("close"),this.dispose()}),N(this,"onMessage",i=>{const s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=e,this.clientId=n,this.ws=new vv("cross-channel-".concat(this.clientId),r),this.ws.on(Ye.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ye.CONNECTED,this.onOpen),this.ws.on(Ye.ON_MESSAGE,this.onMessage),this.ws.on(Ye.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new we((n,r)=>{const i=window.setTimeout(()=>{r(new te(P.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,s=>{window.clearTimeout(i),s.state&&s.state!==0?r(new te(P.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new te(P.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new te(P.WS_DISCONNECT);const n=()=>new we((o,a)=>{this.ws.once(Ye.CLOSED,()=>a(new te(P.WS_ABORT))),this.ws.once(Ye.CONNECTED,o)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(e),i=new we((o,a)=>{const A=()=>{a(new te(P.WS_ABORT))};this.ws.once(Ye.RECONNECTING,A),this.ws.once(Ye.CLOSED,A),this.once("req_".concat(r),o),ai(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Ye.RECONNECTING,A),this.ws.off(Ye.CLOSED,A),a(new te(P.TIMEOUT,"cross channel ws request timeout"))})}),s=await i;if(!s||s.code!==200)throw new te(P.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(e){this.ws.removeAllListeners(Ye.REQUEST_NEW_URLS),this.ws.on(Ye.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class uUe extends Ln{set state(e){e!==this._state&&(e!==ro.RELAY_STATE_FAILURE&&(this.errorCode=Sm.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,r,i,s){super(),N(this,"joinInfo",void 0),N(this,"sid",void 0),N(this,"clientId",void 0),N(this,"cancelToken",Xs.CancelToken.source()),N(this,"workerToken",void 0),N(this,"requestId",0),N(this,"signal",void 0),N(this,"prevChannelMediaConfig",void 0),N(this,"httpRetryConfig",void 0),N(this,"_resolution",void 0),N(this,"_state",ro.RELAY_STATE_IDLE),N(this,"errorCode",Sm.RELAY_OK),N(this,"onStatus",o=>{S.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",Kl.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",Kl.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Sm.SRC_TOKEN_EXPIRED,this.state=ro.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Sm.DEST_TOKEN_EXPIRED,this.state=ro.RELAY_STATE_FAILURE))}),N(this,"onReconnect",async()=>{S.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Kl.NETWORK_DISCONNECTED),this.state=ro.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o=>{this.state!==ro.RELAY_STATE_IDLE&&(S.error("auto restart channel media relay failed",o.toString()),this.errorCode=Sm.SERVER_CONNECTION_LOST,this.state=ro.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=Fm(),this.signal=new lUe(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(e){if(this.state!==ro.RELAY_STATE_IDLE)throw new te(P.INVALID_OPERATION);this.state=ro.RELAY_STATE_CONNECTING,await this.connect(),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new te(P.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new te(P.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new te(P.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==ro.RELAY_STATE_RUNNING)throw new te(P.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==ro.RELAY_STATE_RUNNING)throw new te(P.INVALID_OPERATION);const n=this.genMessage(_s.SetVideoProfile);await this.signal.request(n),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),S.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ro.RELAY_STATE_IDLE,this.dispose()}dispose(){S.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Xs.CancelToken.source(),this.state=ro.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await iLe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Kl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(_s.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(_s.SetSdkProfile,e);await this.signal.request(r),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(_s.SetSourceChannel,e);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Kl.PACKET_JOINED_SRC_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(_s.SetSourceUserId,e);await this.signal.request(s),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(_s.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Kl.PACKET_JOINED_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage(_s.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",Kl.PACKET_SENT_TO_DEST_CHANNEL),this.state=ro.RELAY_STATE_RUNNING,S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(_s.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",Kl.PACKET_UPDATE_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(_s.StopPacketTransfer);await this.signal.request(e),S.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const r=[],i=[],s=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ba,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.22.0"&&(o.sdkVersion="0.0.1");let a=null,A=null;switch(e){case _s.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case _s.SetSourceChannel:if(A=n&&n.getSrcChannelMediaInfo(),!A)throw new te(P.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:A.channelName,token:A.token||this.joinInfo.appId},o;case _s.SetSourceUserId:if(A=n&&n.getSrcChannelMediaInfo(),!A)throw new te(P.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:A.uid+""},o;case _s.SetDestChannel:if(a=n&&n.getDestChannelMediaInfo(),!a)throw new te(P.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(l=>{r.push(l.channelName),i.push(l.uid+""),s.push(l.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:s},o;case _s.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case _s.Reconnect:return o.clientRequest={command:"Reconnect"},o;case _s.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case _s.UpdateDestChannel:if(a=n&&n.getDestChannelMediaInfo(),!a)throw new te(P.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(l=>{r.push(l.channelName),i.push(l.uid+""),s.push(l.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:s},o;case _s.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const dUe={name:"ChannelMediaRelay",create:function(t){return new uUe(t.joinInfo,t.clientId,t.websocketRetryConfig||fr,t.httpRetryConfig||fr,t.resolution)}};function CW(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ME(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?CW(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):CW(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class hUe extends Ln{constructor(e,n,r,i){super(),N(this,"spec",void 0),N(this,"token",void 0),N(this,"websocket",void 0),N(this,"pingpongTimer",void 0),N(this,"reconnectMode","retry"),N(this,"serviceMode",void 0),N(this,"reqId",0),N(this,"commandReqId",0),N(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),N(this,"handleWebSocketMessage",s=>{if(!s.data)return;const o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(Le.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===nu.TRANSCODE?1:2}),this.emit(_d.PUBLISH_STREAM_STATUS,o))}),this.spec=n,this.token=e,this.serviceMode=i,this.websocket=new vv("live-streaming",r),this.websocket.on(Ye.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ye.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ye.REQUEST_NEW_URLS,(s,o)=>{vi(this,_d.REQUEST_NEW_ADDRESS).then(s).catch(o)}),this.websocket.on(Ye.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,r,i){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new te(P.UNEXPECTED_ERROR);const a=ME({command:e,sdkVersion:ba==="4.22.0"?"0.0.1":ba,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new te(P.WS_DISCONNECT);const A=()=>new we((p,g)=>{this.websocket.once(Ye.CLOSED,()=>g(new te(P.WS_ABORT))),this.websocket.once(Ye.CONNECTED,p)});this.websocket.state!=="connected"&&await A(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const l=new we((p,g)=>{const y=()=>{g(new te(P.WS_ABORT))};this.websocket.once(Ye.RECONNECTING,y),this.websocket.once(Ye.CLOSED,y),this.once("@".concat(o,"-").concat(this.spec.sid),E=>{p(E)})});i&&Le.workerEvent(this.spec.sid,ME(ME({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const d=Date.now();this.websocket.sendMessage(a);let f=null;try{f=await l}catch(p){if(this.websocket.state==="closed")throw p;return await A(),await this.request(e,n,r)}return i&&Le.workerEvent(this.spec.sid,ME(ME({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(f.serverResponse),serverCode:f.code,success:f.code===200,responseTime:Date.now()-d})),f.code!==200&&this.handleResponseError(f),f}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=ba==="4.22.0"?"0.0.1":ba;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case vr.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void S.warning("live stream response already exists stream");case vr.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case vr.LIVE_STREAM_RESPONSE_BAD_STREAM:case vr.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new te(P.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case vr.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new te(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case vr.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new te(P.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case vr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new te(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(_d.WARNING,n,e.serverResponse.url)}case vr.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new te(P.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(_d.WARNING,n,e.serverResponse.url)}case vr.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new te(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case vr.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new te(P.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case vr.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new te(P.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(_d.WARNING,n,e.serverResponse.url)}case vr.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new te(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case vr.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new te(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case vr.LIVE_STREAM_RESPONSE_WORKER_LOST:case vr.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new te(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case vr.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new te(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new te(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case vr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new te(P.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(XI)},6e3)}}function TW(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function to(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?TW(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TW(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class fUe extends Ln{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:fr,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:fr;super(),N(this,"onLiveStreamWarning",void 0),N(this,"onLiveStreamError",void 0),N(this,"spec",void 0),N(this,"retryTimeout",1e4),N(this,"connection",void 0),N(this,"httpRetryConfig",void 0),N(this,"wsRetryConfig",void 0),N(this,"streamingTasks",new Map),N(this,"isStartingStreamingTask",!1),N(this,"taskMutex",new xi("live-streaming")),N(this,"cancelToken",Xs.CancelToken.source()),N(this,"transcodingConfig",void 0),N(this,"uapResponse",void 0),N(this,"lastTaskId",1),N(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=to(to({},lBe),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(S.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(o=>to(to(to({},ABe),o),{},{zOrder:o.zOrder?o.zOrder+1:1}))),function(o){Nn(o.width)||zt(o.width,"config.width",0,1e4),Nn(o.height)||zt(o.height,"config.height",0,1e4),Nn(o.videoBitrate)||zt(o.videoBitrate,"config.videoBitrate",1,1e6),Nn(o.videoFrameRate)||zt(o.videoFrameRate,"config.videoFrameRate"),Nn(o.lowLatency)||Jl(o.lowLatency,"config.lowLatency"),Nn(o.audioSampleRate)||Or(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Nn(o.audioBitrate)||zt(o.audioBitrate,"config.audioBitrate",1,128),Nn(o.audioChannels)||Or(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),Nn(o.videoGop)||zt(o.videoGop,"config.videoGop"),Nn(o.videoCodecProfile)||Or(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Nn(o.userCount)||zt(o.userCount,"config.userCount",0,17),Nn(o.backgroundColor)||zt(o.backgroundColor,"config.backgroundColor",0,16777215),Nn(o.userConfigExtraInfo)||ei(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!Nn(o.transcodingUsers)&&(ql(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach((a,A)=>{ZI(a.uid),Nn(a.x)||zt(a.x,"transcodingUser[".concat(A,"].x"),0,1e4),Nn(a.y)||zt(a.y,"transcodingUser[".concat(A,"].y"),0,1e4),Nn(a.width)||zt(a.width,"transcodingUser[".concat(A,"].width"),0,1e4),Nn(a.height)||zt(a.height,"transcodingUser[".concat(A,"].height"),0,1e4),Nn(a.zOrder)||zt(a.zOrder-1,"transcodingUser[".concat(A,"].zOrder"),0,100),Nn(a.alpha)||zt(a.alpha,"transcodingUser[".concat(A,"].alpha"),0,1,!1)})),Nn(o.watermark)||EB(o.watermark,"watermark"),Nn(o.backgroundImage)||EB(o.backgroundImage,"backgroundImage"),o.images&&!Nn(o.images)&&(ql(o.images,"config.images"),o.images.forEach((a,A)=>{EB(a,"images[".concat(A,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(o=>to(to(to({},_B),o),{},{zOrder:255}))),n.backgroundImage&&(r.push(to(to(to({},_B),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(to(to(to({},_B),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(o=>to({},o)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map(o=>typeof o.uid=="number"?we.resolve(o.uid):jte(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await we.all(i)).forEach((o,a)=>{n.userConfigs&&n.userConfigs[a]&&(n.userConfigs[a].uid=o)}),this.transcodingConfig=n,this.connection)try{var s;const o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(au(s=this.streamingTasks).call(s)).map(a=>a.taskId).join("#")});S.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(a=>{S.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,o).then(()=>{S.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(a.url," success"))}).catch(A=>{S.error("[".concat(this.spec.clientId,"] live streaming republish failed"),a.url,A.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,A)})})}}async startLiveStreamingTask(e,n,r){if(!this.transcodingConfig&&n===nu.TRANSCODE)throw new te(P.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};S.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(e)&&!r)return s(),new te(P.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(a){throw s(),a}switch(n){case nu.TRANSCODE:i.transcodingConfig=to({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const a=new we((l,d)=>{ai(this.retryTimeout).then(()=>{if(r)return d(r);const f=this.statusError.get(e);return f?(this.statusError.delete(e),d(f)):void 0})}),A=await we.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:n===nu.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),a]);this.isStartingStreamingTask=!1,S.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(A.code)),this.streamingTasks.set(e,{clientRequest:i,mode:n,url:e,taskId:o}),s()}catch(a){if(s(),this.isStartingStreamingTask=!1,!a.data||!a.data.retry||r)throw a;return a.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,a)):await this.startLiveStreamingTask(e,n,a)}}stopLiveStreamingTask(e){return new we((n,r)=>{const i=this.streamingTasks.get(e);if(!i||!this.connection)return new te(P.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:s===nu.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var e;const n=Array.from(au(e=this.streamingTasks).call(e));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Xs.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new te(P.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await vi(this,RP.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new hUe(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(_d.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(_d.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(_d.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new te(P.UNEXPECTED_ERROR,"can not get new live streaming address list"));vi(this,RP.REQUEST_WORKER_MANAGER_LIST,e).then(s=>{this.uapResponse=s,r(s.addressList)}).catch(i)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=e.reason;switch(e.code){case vr.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case vr.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const o=new te(P.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(r)return S.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,o);if(!this.isStartingStreamingTask)return;this.statusError.set(n,o)}case vr.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new te(P.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,o)}case vr.LIVE_STREAM_RESPONSE_WORKER_LOST:case vr.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const o=Array.from(au(s=this.streamingTasks).call(s));for(const a of o)a.abortTask?a.abortTask():(S.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,new te(P.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{S.debug("[".concat(this.spec.clientId,"] republish live stream success"),a.url)}).catch(A=>{S.error(A.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,A)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const pUe={name:"LiveStreaming",create:function(t){return new fUe(t.joinInfo,t.websocketRetryConfig||fr,t.httpRetryConfig||fr)}};function mUe(t){let e=SW();return function(n,r){let i=n.appId;i!==void 0&&(Mt(r,10),UA(r,i));let s=n.cid;s!==void 0&&(Mt(r,16),Mt(r,s));let o=n.cname;o!==void 0&&(Mt(r,26),UA(r,o));let a=n.deviceId;a!==void 0&&(Mt(r,34),UA(r,a));let A=n.elapse;A!==void 0&&(Mt(r,40),sd(r,A));let l=n.fileSize;l!==void 0&&(Mt(r,48),sd(r,sm(l)));let d=n.height;d!==void 0&&(Mt(r,56),sd(r,sm(d)));let f=n.jpg;f!==void 0&&(Mt(r,66),Mt(r,f.length),function(re,Y){let Z=y_(re,Y.length);re.bytes.set(Y,Z)}(r,f));let p=n.networkType;p!==void 0&&(Mt(r,72),sd(r,sm(p)));let g=n.osType;g!==void 0&&(Mt(r,80),sd(r,sm(g)));let y=n.requestId;y!==void 0&&(Mt(r,90),UA(r,y));let E=n.sdkVersion;E!==void 0&&(Mt(r,98),UA(r,E));let w=n.sequence;w!==void 0&&(Mt(r,104),sd(r,sm(w)));let b=n.sid;b!==void 0&&(Mt(r,114),UA(r,b));let I=n.timestamp;I!==void 0&&(Mt(r,120),sd(r,I));let B=n.uid;B!==void 0&&(Mt(r,128),Mt(r,B));let U=n.vid;U!==void 0&&(Mt(r,136),Mt(r,U));let H=n.width;H!==void 0&&(Mt(r,144),sd(r,sm(H)));let K=n.service;K!==void 0&&(Mt(r,152),Mt(r,K));let x=n.callbackData;x!==void 0&&(Mt(r,162),UA(r,x));let V=n.jpgEncryption;V!==void 0&&(Mt(r,168),Mt(r,V));let M=n.requestType;M!==void 0&&(Mt(r,176),Mt(r,M));let O=n.scorePorn;O!==void 0&&(Mt(r,185),E1(r,O));let z=n.scoreSexy;z!==void 0&&(Mt(r,193),E1(r,z));let $=n.scoreNeutral;$!==void 0&&(Mt(r,201),E1(r,$));let q=n.scene;q!==void 0&&(Mt(r,208),Mt(r,q));let Ue=n.ossFilePrefix;Ue!==void 0&&(Mt(r,218),UA(r,Ue));let fe=n.serviceVendor;if(fe!==void 0)for(let re of fe){Mt(r,226);let Y=SW();EUe(re,Y),Mt(r,Y.limit),CUe(r,Y),wUe(Y)}}(t,e),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(e)}function gUe(t){return function(n){let r={};e:for(;!xne(n);){let i=jA(n);switch(i>>>3){case 0:break e;case 1:r.code=jA(n);break;case 2:r.msg=Mne(n,jA(n));break;case 3:{let s=yUe(n);r.data=_Ue(n),n.limit=s;break}default:Une(n,7&i)}}return r}({bytes:e=t,offset:0,limit:e.length});var e}function _Ue(t){let e={};e:for(;!xne(t);){let n=jA(t);switch(n>>>3){case 0:break e;case 1:e.requestId=Mne(t,jA(t));break;case 2:e.requestType=jA(t)>>>0;break;case 3:e.scorePorn=_1(t);break;case 4:e.scoreSexy=_1(t);break;case 5:e.scoreNeutral=_1(t);break;case 6:e.requestScene=jA(t)>>>0;break;case 7:e.scene=jA(t)>>>0;break;default:Une(t,7&n)}}return e}function EUe(t,e){let n=t.service;n!==void 0&&(Mt(e,8),Mt(e,n));let r=t.vendor;r!==void 0&&(Mt(e,16),Mt(e,r));let i=t.token;i!==void 0&&(Mt(e,26),UA(e,i));let s=t.callbackUrl;s!==void 0&&(Mt(e,34),UA(e,s))}function yUe(t){let e=jA(t),n=t.limit;return t.limit=t.offset+e,n}function Une(t,e){switch(e){case 0:for(;128&Fne(t););break;case 2:g1(t,jA(t));break;case 5:g1(t,4);break;case 1:g1(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let vUe=new Float32Array(1);new Uint8Array(vUe.buffer);let N2=new Float64Array(1),oo=new Uint8Array(N2.buffer);function sm(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let kne=[];function SW(){const t=kne.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function wUe(t){kne.push(t)}function g1(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function xne(t){return t.offset>=t.limit}function y_(t,e){let n=t.bytes,r=t.offset,i=t.limit,s=r+e;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),t.bytes=o}return t.offset=s,s>i&&(t.limit=s),r}function D2(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function Mne(t,e){let n=D2(t,e),r=String.fromCharCode,i=t.bytes,s="",o="";for(let a=0;a<e;a++){let A,l,d,f,p=i[a+n];(128&p)==0?o+=r(p):(224&p)==192?a+1>=e?o+=s:(A=i[a+n+1],(192&A)!=128?o+=s:(f=(31&p)<<6|63&A,f<128?o+=s:(o+=r(f),a++))):(240&p)==224?a+2>=e?o+=s:(A=i[a+n+1],l=i[a+n+2],(49344&(A|l<<8))!=32896?o+=s:(f=(15&p)<<12|(63&A)<<6|63&l,f<2048||f>=55296&&f<=57343?o+=s:(o+=r(f),a+=2))):(248&p)==240?a+3>=e?o+=s:(A=i[a+n+1],l=i[a+n+2],d=i[a+n+3],(12632256&(A|l<<8|d<<16))!=8421504?o+=s:(f=(7&p)<<18|(63&A)<<12|(63&l)<<6|63&d,f<65536||f>1114111?o+=s:(f-=65536,o+=r(55296+(f>>10),56320+(1023&f)),a+=3))):o+=s}return o}function UA(t,e){let n=e.length,r=0;for(let o=0;o<n;o++){let a=e.charCodeAt(o);a>=55296&&a<=56319&&o+1<n&&(a=(a<<10)+e.charCodeAt(++o)-56613888),r+=a<128?1:a<2048?2:a<65536?3:4}Mt(t,r);let i=y_(t,r),s=t.bytes;for(let o=0;o<n;o++){let a=e.charCodeAt(o);a>=55296&&a<=56319&&o+1<n&&(a=(a<<10)+e.charCodeAt(++o)-56613888),a<128?s[i++]=a:(a<2048?s[i++]=a>>6&31|192:(a<65536?s[i++]=a>>12&15|224:(s[i++]=a>>18&7|240,s[i++]=a>>12&63|128),s[i++]=a>>6&63|128),s[i++]=63&a|128)}}function CUe(t,e){let n=y_(t,e.limit),r=t.bytes,i=e.bytes;for(let s=0,o=e.limit;s<o;s++)r[s+n]=i[s]}function Fne(t){return t.bytes[D2(t,1)]}function bW(t,e){let n=y_(t,1);t.bytes[n]=e}function _1(t){let e=D2(t,8),n=t.bytes;return oo[0]=n[e++],oo[1]=n[e++],oo[2]=n[e++],oo[3]=n[e++],oo[4]=n[e++],oo[5]=n[e++],oo[6]=n[e++],oo[7]=n[e++],N2[0]}function E1(t,e){let n=y_(t,8),r=t.bytes;N2[0]=e,r[n++]=oo[0],r[n++]=oo[1],r[n++]=oo[2],r[n++]=oo[3],r[n++]=oo[4],r[n++]=oo[5],r[n++]=oo[6],r[n++]=oo[7]}function jA(t){let e,n=0,r=0;do e=Fne(t),n<32&&(r|=(127&e)<<n),n+=7;while(128&e);return r}function Mt(t,e){for(e>>>=0;e>=128;)bW(t,127&e|128),e>>>=7;bW(t,e)}function sd(t,e){let n=e.low>>>0,r=(e.low>>>28|e.high<<4)>>>0,i=e.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=y_(t,s),a=t.bytes;switch(s){case 10:a[o+9]=i>>>7&1;case 9:a[o+8]=s!==9?128|i:127&i;case 8:a[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:a[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:a[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:a[o+4]=s!==5?128|r:127&r;case 4:a[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:a[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:a[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:a[o]=s!==1?128|n:127&n}}function IW(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}const TUe=new Map([["moderation",1],["supervise",2]]);function RW(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}class SUe extends Ln{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Hr.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=Zc(n=e.map(r=>TUe.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),N(this,"name","AgoraRTCVideoContentInspect"),N(this,"_connectionState",ec.CONNECTING),N(this,"_innerConnectionState",void 0),N(this,"sequence",0),N(this,"inspectStartTime",void 0),N(this,"workerManagerConnection",void 0),N(this,"workerConnection",void 0),N(this,"workerMessageLengthLimit",void 0),N(this,"inspectIntervalMinimum",void 0),N(this,"qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",Xs.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"wmSequence",0),N(this,"inspectInterval",void 0),N(this,"inspectTimer",null),N(this,"ossFilePrefix",void 0),N(this,"extraInfo",void 0),N(this,"_inspectType",void 0),N(this,"_inspectMode",void 0),N(this,"_quality",1),N(this,"qualityTimer",null),N(this,"_inspectId",void 0),N(this,"_needWorkUrlOnly",!1),N(this,"inspectImage",()=>{if(this.connectionState!==ec.CONNECTED)throw new te(P.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===ec.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=nn(5,"inspect-"),this.workerMessageLengthLimit=G("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=G("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=G("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new vv("worker-manager-"+this._inspectId,fr),this.on(Hr.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,S.debug("[".concat(this._inspectId,"] Inspect operation :").concat(qa[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new vv("worker-"+this._inspectId,fr),this.handleWorkerEvents()}async init(e,n){this.emit(Hr.STATE_CHANGE,qa.CONNECT_AP),this._connectInfo=e;const r=this._cancelTokenSource.token;return this._retryConfig=n,new we((i,s)=>{this.on(Hr.CONNECTION_STATE_CHANGE,(o,a)=>{a===ec.CONNECTED&&i()}),this.requestAP(e,r,n).then(o=>{this.connectWorkerManager(o)}).catch(o=>{s(o)})})}async requestAP(e,n,r){const i=G("WEBCS_DOMAIN").map(a=>"https://".concat(a,"/api/v1")),s=await function(a,A,l,d){let{appId:f,areaCode:p,cname:g,sid:y,token:E,uid:w}=A;sg++;const b="image_moderation_api",I={service_name:b,json_body:JSON.stringify({appId:f,areaCode:p,cname:g,command:"allocateEdge",requestId:sg,seq:sg,sid:y,token:E,ts:Date.now(),uid:w+""})};let B,U,H=a[0];return nA(async()=>{B=Date.now();const K=await rA(H,{data:I,cancelToken:l,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(U=Date.now()-B,K.code!==0){const O=new te(P.UNEXPECTED_RESPONSE,"image inspect ap error, code"+K.code,{retry:!0,responseTime:U});throw S.error(O.toString()),O}const x=JSON.parse(K.json_body);if(x.code!==200){const O=new te(P.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(x.code,", reason: ").concat(x.reason),{code:x.code,responseTime:U});throw S.error(O.toString()),O}if(!x.servers||!Array.isArray(x.servers)||x.servers.length===0){const O=new te(P.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:x.code,responseTime:U});throw S.error(O.toString()),O}const V=G("VIDEO_INSPECT_WORKER_MANAGER_HOST"),M=G("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:x.servers.map(O=>{let{address:z,wss:$}=O;if(z&&$)return"wss://".concat(z.replace(/\./g,"-"),".").concat(V,":").concat(M||$)}).filter(O=>!!O),workerToken:x.workerToken,vid:x.vid,responseTime:U}},(K,x)=>(Le.apworkerEvent(y,{success:!0,sc:200,serviceName:b,responseDetail:JSON.stringify(K.addressList),firstSuccess:x===0,responseTime:U,serverIp:a[x%a.length]}),!1),(K,x)=>(Le.apworkerEvent(y,{success:!1,sc:K.data&&K.data.code||200,serviceName:b,responseTime:U,serverIp:a[x%a.length]}),!!(K.code!==P.OPERATION_ABORTED&&K.code!==P.UNEXPECTED_RESPONSE||K.data&&K.data.retry)&&(H=a[(x+1)%a.length],!0)),d)}(i,e,n,r);this.emit(Hr.STATE_CHANGE,qa.AP_CONNECTED);const{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Hr.STATE_CHANGE,qa.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ye.CONNECTED,async()=>{this.emit(Hr.STATE_CHANGE,qa.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ye.CLOSED,()=>{this._innerConnectionState<qa.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ye.FAILED,()=>{this._innerConnectionState<qa.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ye.RECONNECTING,()=>{this._innerConnectionState<qa.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ye.ON_MESSAGE,async e=>{this.emit(Hr.STATE_CHANGE,qa.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(e.data);if(r.code!==200)throw S.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new te(P.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw S.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new te(P.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=G("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(i));this.emit(Hr.STATE_CHANGE,qa.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(Hr.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(Ye.WILL_RECONNECT,(e,n,r)=>{r(e)}),this.workerManagerConnection.on(Ye.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Ye.CONNECTED,async()=>{this.emit(Hr.STATE_CHANGE,qa.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=ec.CONNECTED}),this.workerConnection.on(Ye.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const r=gUe(new Uint8Array(e.data));if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&S.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Hr.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=Zc(n=Object.keys(i)).call(n,(a,A)=>i[a]>i[A]?a:A,"porn"),o=Object.keys(i).find(a=>a===s);this.emit(Hr.INSPECT_RESULT,o)}else this.emit(Hr.INSPECT_RESULT,void 0,new te(P.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Hr.INSPECT_RESULT,void 0,new te(P.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else S.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Hr.INSPECT_RESULT,void 0,new te(P.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ye.CLOSED,()=>{this.connectionState=ec.CLOSED}),this.workerConnection.on(Ye.FAILED,()=>{this.connectionState=ec.CLOSED}),this.workerConnection.on(Ye.RECONNECTING,()=>{this.connectionState=this.connectionState===ec.CONNECTED?ec.RECONNECTING:ec.CONNECTING}),this.workerConnection.on(Ye.WILL_RECONNECT,(e,n,r)=>{e==="recover"&&r(e),r("tryNext")}),this.workerConnection.on(Ye.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(Hr.REQUEST_NEW_WORKER_URL,r=>{e([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}async requestToInspectImage(){this.sequence++;const e=Sa(this,Hr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Hr.INSPECT_RESULT,void 0,new te(P.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(e,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Hr.INSPECT_RESULT,void 0,new te(P.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:r,cname:i,cid:s,vid:o,sid:a,uid:A}=n;const l=Date.now(),d=await e.getCurrentFrameImage("image/jpeg",this.quality),f=await Ste(d,r,i),p=this.sequence+"-"+s+"-"+A+"-"+l+"-"+nn(12,""),g={appId:r,cid:s,cname:i,deviceId:"",elapse:RW(Number(l-this.inspectStartTime)),fileSize:f.byteLength,jpgEncryption:2,height:d.height,width:d.width,jpg:f,networkType:6,osType:7,requestId:p,sdkVersion:"4.22.0",sequence:this.sequence,sid:a,timestamp:RW(l),uid:A,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete g.callbackData,this.ossFilePrefix===void 0&&delete g.ossFilePrefix;const y=mUe(g);if(y.byteLength<this.workerMessageLengthLimit){if(G("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const E=function(w){for(var b=1;b<arguments.length;b++){var I=arguments[b]!=null?arguments[b]:{};b%2?IW(Object(I),!0).forEach(function(B){N(w,B,I[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(I)):IW(Object(I)).forEach(function(B){Object.defineProperty(w,B,Object.getOwnPropertyDescriptor(I,B))})}return w}({},g);delete E.jpg,S.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(E))}return y}{const E=this.quality*this.qualityRatio;return this.quality=E,await this.generateRequestData(e,{appId:r,cname:i,cid:s,vid:o,sid:a,uid:A})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Xs.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=ec.CLOSED,this.emit(Hr.STATE_CHANGE,qa.CLOSED)}}const bUe={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new te(P.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new te(P.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach(i=>{var s;if(!Se(s=["supervise","moderation"]).call(s,i))throw new te(P.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new te(P.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new SUe(e)}};Wt("PROCESS_ID","process-".concat(nn(8,""),"-").concat(nn(4,""),"-").concat(nn(4,""),"-").concat(nn(4,""),"-").concat(nn(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void S.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();S.debug("Loading global parameters from cache",e),Object.keys(e).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Jn,r)){const{value:i,expires:s}=e[r];if(s&&s<=n)return;Sd[r]=i,Jn[r]=i}})}catch(e){S.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(Sd.AREAS)&&Sd.AREAS.length>0&&y2(Sd.AREAS,!0);const OW=(t,e,n)=>{S.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),Wt(t,e,n)};kE(dUe,!1),kE(pUe,!1),kE(qLe,!1),kE(bUe,!1),kE(AUe,!1);const Kn=function(t){const e=new Ln,n=t,r={getListeners:e.getListeners.bind(e),on:(i,s)=>(function(o,a){o===QA.SECURITY_POLICY_VIOLATION&&dne(a,!0)}(i,s),e.on.bind(e)(i,s)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return nW(nW({},n),r)}({__TRACK_LIST__:bm,VERSION:ba,BUILD:a2,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:OW,getParameter:G,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(r){let i;return bt().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(e);if(!n)return t;e.close(),e=null,t=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(n)}catch(e){throw new te(P.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=Le.reportApiInvoke(null,{name:Cr.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:xn.TRACER});let e=!1;try{const s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,a=window.WebSocket;e=!!(s&&o&&a),e&&n2()&&Dee(75)&&new s().close()}catch(s){return S.error("check system requirement failed: ",s),!1}let n=!1;const r=Ct();r.name===xt.CHROME&&Number(r.version)>=58&&(Kc.engine.name!=="WebKit"||function(){const s=Ct();if(fb()){if(s.os===Pr.MAC_OS)return!0;if(s.os===Pr.IOS){const o=Kc.os.version&&Kc.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1}())&&(n=!0),(r.name===xt.FIREFOX&&Number(r.version)>=56||r.name===xt.OPERA&&Number(r.version)>=45||r.name===xt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(Is()||gc())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||Uee()||Ct().name===xt.QQ)&&(n=!0),S.debug("checkSystemRequirements, api:",e,"browser",n);const i=e&&n;return t.onSuccess(i),i},getDevices:function(t){return Jo.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Jo.getRecordingDevices(t)},getCameras:function(t){return Jo.getCamerasDevices(t)},getElectronScreenSources:pte,getPlaybackDevices:function(t){return Jo.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Le.reportApiInvoke(null,{name:Cr.CREATE_CLIENT,options:[e],tag:xn.TRACER});try{(function(r){Or(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Or(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&Or(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&ei(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&Vee(r.turnServer),r.httpRetryConfig!==void 0&&y6(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&y6(r.websocketRetryConfig)})(e)}catch(r){throw n.onError(r),r}return(Lee(16,0)||Pee(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",S.debug("browser not support vp9, force use vp8")),Wt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),n.onSuccess(),new YLe(jc(jc({forceWaitGatewayResponse:!0},e),{},{role:Se(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=G("CAMERA_CAPTURE_CONFIG"),n=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.CREATE_CAM_VIDEO_TRACK,options:[wn({},t),e]});e&&(t.encoderConfig=e);const r=_b(t),i=nn(8,"track-cam-");let s=null;S.info("start create camera video track with config",JSON.stringify(t),"trackId",i);try{s=(await zo({video:r},i)).getVideoTracks()[0]||null}catch(a){throw n.onError(a),a}if(!s){const a=new ie(P.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(a),a.throw(S)}t.optimizationMode&&HB(i,s,t,zA(t.encoderConfig));const o=new xP(s,t,r,t.scalabiltyMode?NT(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return n.onSuccess(o.getTrackId()),S.info("create camera video success, trackId:",i),o},createCustomVideoTrack:function(t){const e=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),n=new pn(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?NT(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,nn(8,"track-cus-"),[En.CUSTOM_TRACK]);return e.onSuccess(n.getTrackId()),S.info("create custom video track success with config",t,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.CREATE_SCREEN_VIDEO_TRACK,options:[wn({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const r=function(d){const f={};d.screenSourceType&&(f.mediaSource=d.screenSourceType),d.extensionId&&Fd()&&(f.extensionId=d.extensionId);const{displaySurface:p,selfBrowserSurface:g,surfaceSwitching:y,systemAudio:E}=d;(vP(107)||f6(107)||p6(93))&&(p&&(Or(p,"displaySurface",["browser","window","monitor"]),f.displaySurface=p),g?(Or(g,"selfBrowserSurface",["exclude","include"]),f.selfBrowserSurface=g):f.selfBrowserSurface="include",y&&(Or(y,"surfaceSwitching",["exclude","include"]),f.surfaceSwitching=y)),(vP(105)||f6(105)||p6(91))&&E&&(Or(E,"systemAudio",["exclude","include"]),f.systemAudio=E),d.electronScreenSourceId&&(f.sourceId=d.electronScreenSourceId);const w=d.encoderConfig?MB(d.encoderConfig):null;return f.mandatory={chromeMediaSource:"desktop",maxWidth:w?w.width:void 0,maxHeight:w?w.height:void 0},w&&(w.frameRate&&(typeof w.frameRate=="number"?(f.mandatory.maxFrameRate=w.frameRate,f.mandatory.minFrameRate=w.frameRate):(f.mandatory.maxFrameRate=w.frameRate.max||w.frameRate.ideal||w.frameRate.exact||void 0,f.mandatory.minFrameRate=w.frameRate.min||w.frameRate.ideal||w.frameRate.exact||void 0),f.frameRate=w.frameRate),w.width&&(f.width=w.width),w.height&&(f.height=w.height)),f}(t),i=nn(8,"track-scr-v-");let s=null,o=null;const a=bt();if(!a.supportShareAudio&&e==="enable"){const d=new ie(P.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(d),d.throw(S)}S.info("start create screen video track with config",t,"withAudio",e,"trackId",i);try{const d=await zo({screen:r,screenAudio:e==="auto"?a.supportShareAudio:e==="enable"},i);s=d.getVideoTracks()[0]||null,o=d.getAudioTracks()[0]||null}catch(d){throw n.onError(d),d}if(!s){const d=new ie(P.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(d),d.throw(S)}if(!o&&e==="enable"){s&&s.stop();const d=new ie(P.SHARE_AUDIO_NOT_ALLOWED);return n.onError(d),d.throw(S)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(HB(i,s,t,t.encoderConfig&&MB(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const A=new pn(s,t.encoderConfig?MB(t.encoderConfig):{},t.scalabiltyMode?NT(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[En.SCREEN_TRACK]);if(!o)return n.onSuccess(A.getTrackId()),S.info("create screen video track success","video:",A.getTrackId()),A;const l=new kn(o,void 0,nn(8,"track-scr-a-"),!1);return n.onSuccess([A.getTrackId(),l.getTrackId()]),S.info("create screen video track success","video:",A.getTrackId(),"audio:",l.getTrackId()),[A,l]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=G("CAMERA_CAPTURE_CONFIG"),r=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const i=_b(e),s=CK(t),o=nn(8,"track-mic-"),a=nn(8,"track-cam-");let A=null,l=null;S.info("start create camera video track(".concat(a,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const p=await zo({audio:s,video:i},"".concat(o,"-").concat(a));A=p.getAudioTracks()[0],l=p.getVideoTracks()[0]}catch(p){throw r.onError(p),p}if(!A||!l){const p=new ie(P.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(p),p.throw(S)}e.optimizationMode&&HB(a,l,e,zA(e.encoderConfig));const d=new Eb(A,t,s,o),f=new xP(l,e,i,e.scalabiltyMode?NT(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a);return r.onSuccess([d.getTrackId(),f.getTrackId()]),S.info("create camera video track(".concat(a,") and microphone audio track(").concat(o,") success")),[d,f]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.CREATE_MIC_AUDIO_TRACK,options:[t]}),n=CK(t),r=nn(8,"track-mic-");let i=null;S.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{i=(await zo({audio:n},r)).getAudioTracks()[0]||null}catch(o){throw e.onError(o),o}if(!i){const o=new ie(P.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(o),o.throw(S)}const s=new Eb(i,t,n,r);return e.onSuccess(s.getTrackId()),S.info("create microphone audio track success, trackId:",r),s},createCustomAudioTrack:function(t){const e=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),n=new kn(t.mediaStreamTrack,t.encoderConfig?gb(t.encoderConfig):{},nn(8,"track-cus-"),!1);return S.info("create custom audio track success with config",t,"trackId",n.getTrackId()),e.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:r}=t;let{source:i}=t;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":i,cacheOnlineFile:n,encoderConfig:r},o=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(G("DISABLE_WEBAUDIO"))throw new ie(P.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const a=nn(8,"track-buf-");S.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",a);const A=i;if(!(i instanceof AudioBuffer))try{i=await async function(f,p){let g=null;if(typeof f=="string"){const E=aG.get(f);if(E)return S.debug("use cached audio resource: ",f),E;try{g=(await nA(()=>Xs.get(f,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(w){throw new ie(P.FETCH_AUDIO_FILE_FAILED,w.toString())}}else g=await new we((w,b)=>{const I=new FileReader;I.onload=B=>{B.target?w(B.target.result):b(new ie(P.READ_LOCAL_AUDIO_FILE_ERROR))},I.onerror=()=>{b(new ie(P.READ_LOCAL_AUDIO_FILE_ERROR))},I.readAsArrayBuffer(f)});const y=await function(E){const w=g_();return new we((b,I)=>{w.decodeAudioData(E,B=>{b(B)},B=>{I(new ie(P.DECODE_AUDIO_FILE_FAILED,B.toString()))})})}(g);return typeof f=="string"&&p&&aG.set(f,y),y}(i,n)}catch(f){return o.onError(f),f.throw(S)}const l=new G1e(i),d=new K1e(A,l,r?gb(r):{},a);return S.info("create buffer source audio track success, trackId:",a),o.onSuccess(d.getTrackId()),d},setAppType:function(t){if(S.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw S.debug("Invalid appType"),new te(P.INVALID_PARAMS,"invalid app type",t);Wt("APP_TYPE",Math.floor(t))},setLogLevel:function(t){S.setLogLevel(t)},enableLogUpload:function(){G("USE_NEW_LOG")?Wt("UPLOAD_LOG",!0):S.enableLogUpload()},disableLogUpload:function(){G("USE_NEW_LOG")?Wt("UPLOAD_LOG",!1):S.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new $te},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof kn||t instanceof ig)){const A=new te(P.INVALID_TRACK,"the parameter is not a audio track");return n.onError(A),A.throw()}e&&e<1e3&&(e=1e3);const r=t instanceof kn?t.getTrackLabel():"remote_track",i=t.getVolumeLevel();let s=i,o=i;const a=Date.now();return new we(A=>{const l=setInterval(()=>{const d=t.getVolumeLevel();s=d>s?d:s,o=d<o?d:o;const f=s-o>1e-4,p=Date.now()-a;if(f||p>e){clearInterval(l);const g=f,y={duration:p,deviceLabel:r,maxVolumeLevel:s,result:g};S.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(y))),n.onSuccess(y),A(g)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Le.reportApiInvoke(null,{tag:xn.TRACER,name:Cr.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof pn||t instanceof rg)){const f=new te(P.INVALID_TRACK,"the parameter is not a video track");return n.onError(f),f.throw()}e&&e<1e3&&(e=1e3);const r=t instanceof pn?t.getTrackLabel():"remote_track",i=t.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(yi()||fb())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let a=0,A=0;try{const f=Date.now();a=await function(p,g,y,E){let w,b=0,I=null;return new we((B,U)=>{function H(){b>E&&w&&(w(),B(b));const K=y.getContext("2d");if(!K){const M=new te(P.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(M.toString()),void U(M)}K.drawImage(p,0,0,160,120);const x=K.getImageData(0,0,y.width,y.height),V=Math.floor(x.data.length/3);if(I){for(let M=0;M<V;M+=3)if(x.data[M]!==I[M])return b+=1,void(I=x.data);I=x.data}else I=x.data}setTimeout(()=>{w&&(w(),B(b))},g),w=f2(()=>{H()},30)})}(s,e,o,4),A=Date.now()-f}catch(f){throw n.onError(f),f}LLe===xt.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const l=a>4,d={duration:A,changedPicNum:a,deviceLabel:r,result:l};return S.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(d))),n.onSuccess(d),l},setArea:y2,audioElementPlayCenter:Ws,resumeAudioContext:function(){Ws.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){JLe.processExternalMediaAEC(t)},registerExtensions:function(t){const e=G("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!Se(e).call(e,n.name)&&e.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=S.extLog,r.reporter.hookApiInvoke=Le.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=G(i)})}),OW("PLUGIN_INFO",e)},ChannelMediaRelayError:Sm,ChannelMediaRelayEvent:Kl,ChannelMediaRelayState:ro,RemoteStreamFallbackType:x1e,RemoteStreamType:k1e,ConnectionDisconnectedReason:Ft,AudienceLatencyLevelType:mDe,AREAS:Lt,preload:async function(t,e,n,r){return ine(t,e,n,r)}});Object.defineProperties(Kn,{onAudioAutoplayFailed:{get:()=>jo.onAudioAutoplayFailed,set:t=>{jo.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>jo.onAutoplayFailed,set:t=>{jo.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Kn._onSecurityPolicyViolation,set(t){Kn._onSecurityPolicyViolation=t,dne(t)}},__CLIENT_LIST__:{get:()=>G("SHOW_GLOBAL_CLIENT_LIST")?gd:[]}}),Jo.on(gf.CAMERA_DEVICE_CHANGED,t=>{S.info("camera device changed",JSON.stringify(t)),Kn.onCameraChanged&&Kn.onCameraChanged(t),Kn.safeEmit(QA.CAMERA_CHANGED,t)}),Jo.on(gf.RECORDING_DEVICE_CHANGED,t=>{S.info("microphone device changed",JSON.stringify(t)),Kn.onMicrophoneChanged&&Kn.onMicrophoneChanged(t),Kn.safeEmit(QA.MICROPHONE_CHANGED,t)}),Jo.on(gf.PLAYOUT_DEVICE_CHANGED,t=>{S.debug("playout device changed",JSON.stringify(t)),Kn.onPlaybackDeviceChanged&&Kn.onPlaybackDeviceChanged(t),Kn.safeEmit(QA.PLAYBACK_DEVICE_CHANGED,t)}),Ws.onAutoplayFailed=()=>{S.info("detect audio element autoplay failed"),jo.onAudioAutoplayFailed&&jo.onAudioAutoplayFailed()},jt.on("autoplay-failed",()=>{S.info("detect webaudio autoplay failed"),jo.onAudioAutoplayFailed&&jo.onAudioAutoplayFailed(),Kn.safeEmit(QA.AUTOPLAY_FAILED)}),jt.on(ni.STATE_CHANGE,(t,e)=>{S.info("audio context state changed: ".concat(e," => ").concat(t)),Kn.onAudioContextStateChanged&&Kn.onAudioContextStateChanged(t,e),Kn.safeEmit(QA.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),or.on(xm.NETWORK_STATE_CHANGE,(t,e)=>{S.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=Kn);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IUe=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),RUe=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,r)=>r?r.toUpperCase():n.toLowerCase()),NW=t=>{const e=RUe(t);return e.charAt(0).toUpperCase()+e.slice(1)},Vne=(...t)=>t.filter((e,n,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===n).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var OUe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NUe=J.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:s,iconNode:o,...a},A)=>J.createElement("svg",{ref:A,...OUe,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:Vne("lucide",i),...a},[...o.map(([l,d])=>J.createElement(l,d)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=(t,e)=>{const n=J.forwardRef(({className:r,...i},s)=>J.createElement(NUe,{ref:s,iconNode:e,className:Vne(`lucide-${IUe(NW(t))}`,`lucide-${t}`,r),...i}));return n.displayName=NW(t),n};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DUe=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Qne=Ar("camera",DUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BUe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],LUe=Ar("check",BUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PUe=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],UUe=Ar("circle-check-big",PUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kUe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],xUe=Ar("circle-stop",kUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MUe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],FUe=Ar("circle",MUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VUe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Hne=Ar("clock",VUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QUe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],HUe=Ar("copy",QUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jUe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],KUe=Ar("grid-3x3",jUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GUe=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],WUe=Ar("loader-circle",GUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zUe=[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]],qUe=Ar("maximize-2",zUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YUe=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],XUe=Ar("message-square",YUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JUe=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],$Ue=Ar("mic-off",JUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZUe=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],eke=Ar("mic",ZUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tke=[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]],nke=Ar("mouse-pointer",tke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rke=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],ike=Ar("panels-top-left",rke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ske=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],oke=Ar("phone",ske);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ake=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],cke=Ar("refresh-cw",ake);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ake=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],XP=Ar("share-2",Ake);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lke=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],uke=Ar("shield",lke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dke=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],DW=Ar("square-pen",dke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hke=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],BW=Ar("user-check",hke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fke=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],pke=Ar("user-plus",fke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mke=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ob=Ar("user-x",mke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gke=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],Hy=Ar("users",gke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _ke=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Eke=Ar("video-off",_ke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yke=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],vke=Ar("video",yke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wke=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],cS=Ar("x",wke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cke=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],jne=Ar("zoom-in",Cke);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tke=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Ske=Ar("zoom-out",Tke),LW=t=>t,bke=()=>{let t=LW;return{configure(e){t=e},generate(e){return t(e)},reset(){t=LW}}},Ike=bke();function Kf(t,...e){const n=new URL(`https://mui.com/production-error/?code=${t}`);return e.forEach(r=>n.searchParams.append("args[]",r)),`Minified MUI error #${t}; visit ${n} for the full message.`}function Qg(t){if(typeof t!="string")throw new Error(Kf(7));return t.charAt(0).toUpperCase()+t.slice(1)}function Kne(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(n=Kne(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function Rke(){for(var t,e,n=0,r="",i=arguments.length;n<i;n++)(t=arguments[n])&&(e=Kne(t))&&(r&&(r+=" "),r+=e);return r}function Oke(t,e,n=void 0){const r={};for(const i in t){const s=t[i];let o="",a=!0;for(let A=0;A<s.length;A+=1){const l=s[A];l&&(o+=(a===!0?"":" ")+e(l),a=!1,n&&n[l]&&(o+=" "+n[l]))}r[i]=o}return r}var y1={exports:{}},hr={};/**
 * @license React
 * react-is.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PW;function Nke(){if(PW)return hr;PW=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),l=Symbol.for("react.suspense_list"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.view_transition"),g=Symbol.for("react.client.reference");function y(E){if(typeof E=="object"&&E!==null){var w=E.$$typeof;switch(w){case t:switch(E=E.type,E){case n:case i:case r:case A:case l:case p:return E;default:switch(E=E&&E.$$typeof,E){case o:case a:case f:case d:return E;case s:return E;default:return w}}case e:return w}}}return hr.ContextConsumer=s,hr.ContextProvider=o,hr.Element=t,hr.ForwardRef=a,hr.Fragment=n,hr.Lazy=f,hr.Memo=d,hr.Portal=e,hr.Profiler=i,hr.StrictMode=r,hr.Suspense=A,hr.SuspenseList=l,hr.isContextConsumer=function(E){return y(E)===s},hr.isContextProvider=function(E){return y(E)===o},hr.isElement=function(E){return typeof E=="object"&&E!==null&&E.$$typeof===t},hr.isForwardRef=function(E){return y(E)===a},hr.isFragment=function(E){return y(E)===n},hr.isLazy=function(E){return y(E)===f},hr.isMemo=function(E){return y(E)===d},hr.isPortal=function(E){return y(E)===e},hr.isProfiler=function(E){return y(E)===i},hr.isStrictMode=function(E){return y(E)===r},hr.isSuspense=function(E){return y(E)===A},hr.isSuspenseList=function(E){return y(E)===l},hr.isValidElementType=function(E){return typeof E=="string"||typeof E=="function"||E===n||E===i||E===r||E===A||E===l||typeof E=="object"&&E!==null&&(E.$$typeof===f||E.$$typeof===d||E.$$typeof===o||E.$$typeof===s||E.$$typeof===a||E.$$typeof===g||E.getModuleId!==void 0)},hr.typeOf=y,hr}var UW;function Dke(){return UW||(UW=1,y1.exports=Nke()),y1.exports}var Gne=Dke();function $l(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function Wne(t){if(J.isValidElement(t)||Gne.isValidElementType(t)||!$l(t))return t;const e={};return Object.keys(t).forEach(n=>{e[n]=Wne(t[n])}),e}function Ra(t,e,n={clone:!0}){const r=n.clone?{...t}:t;return $l(t)&&$l(e)&&Object.keys(e).forEach(i=>{J.isValidElement(e[i])||Gne.isValidElementType(e[i])?r[i]=e[i]:$l(e[i])&&Object.prototype.hasOwnProperty.call(t,i)&&$l(t[i])?r[i]=Ra(t[i],e[i],n):n.clone?r[i]=$l(e[i])?Wne(e[i]):e[i]:r[i]=e[i]}),r}function jy(t,e){return e?Ra(t,e,{clone:!1}):t}function Bke(t,e){if(!t.containerQueries)return e;const n=Object.keys(e).filter(r=>r.startsWith("@container")).sort((r,i)=>{var o,a;const s=/min-width:\s*([0-9.]+)/;return+(((o=r.match(s))==null?void 0:o[1])||0)-+(((a=i.match(s))==null?void 0:a[1])||0)});return n.length?n.reduce((r,i)=>{const s=e[i];return delete r[i],r[i]=s,r},{...e}):e}function Lke(t,e){return e==="@"||e.startsWith("@")&&(t.some(n=>e.startsWith(`@${n}`))||!!e.match(/^@\d/))}function Pke(t,e){const n=e.match(/^@([^/]+)?\/?(.+)?$/);if(!n)return null;const[,r,i]=n,s=Number.isNaN(+r)?r||0:+r;return t.containerQueries(i).up(s)}function Uke(t){const e=(s,o)=>s.replace("@media",o?`@container ${o}`:"@container");function n(s,o){s.up=(...a)=>e(t.breakpoints.up(...a),o),s.down=(...a)=>e(t.breakpoints.down(...a),o),s.between=(...a)=>e(t.breakpoints.between(...a),o),s.only=(...a)=>e(t.breakpoints.only(...a),o),s.not=(...a)=>{const A=e(t.breakpoints.not(...a),o);return A.includes("not all and")?A.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):A}}const r={},i=s=>(n(r,s),r);return n(i),{...t,containerQueries:i}}const oR={xs:0,sm:600,md:900,lg:1200,xl:1536},kW={keys:["xs","sm","md","lg","xl"],up:t=>`@media (min-width:${oR[t]}px)`},kke={containerQueries:t=>({up:e=>{let n=typeof e=="number"?e:oR[e]||e;return typeof n=="number"&&(n=`${n}px`),t?`@container ${t} (min-width:${n})`:`@container (min-width:${n})`}})};function gu(t,e,n){const r=t.theme||{};if(Array.isArray(e)){const s=r.breakpoints||kW;return e.reduce((o,a,A)=>(o[s.up(s.keys[A])]=n(e[A]),o),{})}if(typeof e=="object"){const s=r.breakpoints||kW;return Object.keys(e).reduce((o,a)=>{if(Lke(s.keys,a)){const A=Pke(r.containerQueries?r:kke,a);A&&(o[A]=n(e[a],a))}else if(Object.keys(s.values||oR).includes(a)){const A=s.up(a);o[A]=n(e[a],a)}else{const A=a;o[A]=e[A]}return o},{})}return n(e)}function xke(t={}){var n;return((n=t.keys)==null?void 0:n.reduce((r,i)=>{const s=t.up(i);return r[s]={},r},{}))||{}}function Mke(t,e){return t.reduce((n,r)=>{const i=n[r];return(!i||Object.keys(i).length===0)&&delete n[r],n},e)}function aR(t,e,n=!0){if(!e||typeof e!="string")return null;if(t&&t.vars&&n){const r=`vars.${e}`.split(".").reduce((i,s)=>i&&i[s]?i[s]:null,t);if(r!=null)return r}return e.split(".").reduce((r,i)=>r&&r[i]!=null?r[i]:null,t)}function Nb(t,e,n,r=n){let i;return typeof t=="function"?i=t(n):Array.isArray(t)?i=t[n]||r:i=aR(t,n)||r,e&&(i=e(i,r,t)),i}function Fi(t){const{prop:e,cssProperty:n=t.prop,themeKey:r,transform:i}=t,s=o=>{if(o[e]==null)return null;const a=o[e],A=o.theme,l=aR(A,r)||{};return gu(o,a,f=>{let p=Nb(l,i,f);return f===p&&typeof f=="string"&&(p=Nb(l,i,`${e}${f==="default"?"":Qg(f)}`,f)),n===!1?p:{[n]:p}})};return s.propTypes={},s.filterProps=[e],s}function Fke(t){const e={};return n=>(e[n]===void 0&&(e[n]=t(n)),e[n])}const Vke={m:"margin",p:"padding"},Qke={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},xW={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},Hke=Fke(t=>{if(t.length>2)if(xW[t])t=xW[t];else return[t];const[e,n]=t.split(""),r=Vke[e],i=Qke[n]||"";return Array.isArray(i)?i.map(s=>r+s):[r+i]}),B2=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],L2=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...B2,...L2];function Tw(t,e,n,r){const i=aR(t,e,!0)??n;return typeof i=="number"||typeof i=="string"?s=>typeof s=="string"?s:typeof i=="string"?i.startsWith("var(")&&s===0?0:i.startsWith("var(")&&s===1?i:`calc(${s} * ${i})`:i*s:Array.isArray(i)?s=>{if(typeof s=="string")return s;const o=Math.abs(s),a=i[o];return s>=0?a:typeof a=="number"?-a:typeof a=="string"&&a.startsWith("var(")?`calc(-1 * ${a})`:`-${a}`}:typeof i=="function"?i:()=>{}}function P2(t){return Tw(t,"spacing",8)}function Sw(t,e){return typeof e=="string"||e==null?e:t(e)}function jke(t,e){return n=>t.reduce((r,i)=>(r[i]=Sw(e,n),r),{})}function Kke(t,e,n,r){if(!e.includes(n))return null;const i=Hke(n),s=jke(i,r),o=t[n];return gu(t,o,s)}function zne(t,e){const n=P2(t.theme);return Object.keys(t).map(r=>Kke(t,e,r,n)).reduce(jy,{})}function hi(t){return zne(t,B2)}hi.propTypes={};hi.filterProps=B2;function fi(t){return zne(t,L2)}fi.propTypes={};fi.filterProps=L2;function cR(...t){const e=t.reduce((r,i)=>(i.filterProps.forEach(s=>{r[s]=i}),r),{}),n=r=>Object.keys(r).reduce((i,s)=>e[s]?jy(i,e[s](r)):i,{});return n.propTypes={},n.filterProps=t.reduce((r,i)=>r.concat(i.filterProps),[]),n}function oc(t){return typeof t!="number"?t:`${t}px solid`}function Sc(t,e){return Fi({prop:t,themeKey:"borders",transform:e})}const Gke=Sc("border",oc),Wke=Sc("borderTop",oc),zke=Sc("borderRight",oc),qke=Sc("borderBottom",oc),Yke=Sc("borderLeft",oc),Xke=Sc("borderColor"),Jke=Sc("borderTopColor"),$ke=Sc("borderRightColor"),Zke=Sc("borderBottomColor"),exe=Sc("borderLeftColor"),txe=Sc("outline",oc),nxe=Sc("outlineColor"),AR=t=>{if(t.borderRadius!==void 0&&t.borderRadius!==null){const e=Tw(t.theme,"shape.borderRadius",4),n=r=>({borderRadius:Sw(e,r)});return gu(t,t.borderRadius,n)}return null};AR.propTypes={};AR.filterProps=["borderRadius"];cR(Gke,Wke,zke,qke,Yke,Xke,Jke,$ke,Zke,exe,AR,txe,nxe);const lR=t=>{if(t.gap!==void 0&&t.gap!==null){const e=Tw(t.theme,"spacing",8),n=r=>({gap:Sw(e,r)});return gu(t,t.gap,n)}return null};lR.propTypes={};lR.filterProps=["gap"];const uR=t=>{if(t.columnGap!==void 0&&t.columnGap!==null){const e=Tw(t.theme,"spacing",8),n=r=>({columnGap:Sw(e,r)});return gu(t,t.columnGap,n)}return null};uR.propTypes={};uR.filterProps=["columnGap"];const dR=t=>{if(t.rowGap!==void 0&&t.rowGap!==null){const e=Tw(t.theme,"spacing",8),n=r=>({rowGap:Sw(e,r)});return gu(t,t.rowGap,n)}return null};dR.propTypes={};dR.filterProps=["rowGap"];const rxe=Fi({prop:"gridColumn"}),ixe=Fi({prop:"gridRow"}),sxe=Fi({prop:"gridAutoFlow"}),oxe=Fi({prop:"gridAutoColumns"}),axe=Fi({prop:"gridAutoRows"}),cxe=Fi({prop:"gridTemplateColumns"}),Axe=Fi({prop:"gridTemplateRows"}),lxe=Fi({prop:"gridTemplateAreas"}),uxe=Fi({prop:"gridArea"});cR(lR,uR,dR,rxe,ixe,sxe,oxe,axe,cxe,Axe,lxe,uxe);function cg(t,e){return e==="grey"?e:t}const dxe=Fi({prop:"color",themeKey:"palette",transform:cg}),hxe=Fi({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:cg}),fxe=Fi({prop:"backgroundColor",themeKey:"palette",transform:cg});cR(dxe,hxe,fxe);function Ca(t){return t<=1&&t!==0?`${t*100}%`:t}const pxe=Fi({prop:"width",transform:Ca}),U2=t=>{if(t.maxWidth!==void 0&&t.maxWidth!==null){const e=n=>{var i,s,o,a,A;const r=((o=(s=(i=t.theme)==null?void 0:i.breakpoints)==null?void 0:s.values)==null?void 0:o[n])||oR[n];return r?((A=(a=t.theme)==null?void 0:a.breakpoints)==null?void 0:A.unit)!=="px"?{maxWidth:`${r}${t.theme.breakpoints.unit}`}:{maxWidth:r}:{maxWidth:Ca(n)}};return gu(t,t.maxWidth,e)}return null};U2.filterProps=["maxWidth"];const mxe=Fi({prop:"minWidth",transform:Ca}),gxe=Fi({prop:"height",transform:Ca}),_xe=Fi({prop:"maxHeight",transform:Ca}),Exe=Fi({prop:"minHeight",transform:Ca});Fi({prop:"size",cssProperty:"width",transform:Ca});Fi({prop:"size",cssProperty:"height",transform:Ca});const yxe=Fi({prop:"boxSizing"});cR(pxe,U2,mxe,gxe,_xe,Exe,yxe);const hR={border:{themeKey:"borders",transform:oc},borderTop:{themeKey:"borders",transform:oc},borderRight:{themeKey:"borders",transform:oc},borderBottom:{themeKey:"borders",transform:oc},borderLeft:{themeKey:"borders",transform:oc},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:oc},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:AR},color:{themeKey:"palette",transform:cg},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:cg},backgroundColor:{themeKey:"palette",transform:cg},p:{style:fi},pt:{style:fi},pr:{style:fi},pb:{style:fi},pl:{style:fi},px:{style:fi},py:{style:fi},padding:{style:fi},paddingTop:{style:fi},paddingRight:{style:fi},paddingBottom:{style:fi},paddingLeft:{style:fi},paddingX:{style:fi},paddingY:{style:fi},paddingInline:{style:fi},paddingInlineStart:{style:fi},paddingInlineEnd:{style:fi},paddingBlock:{style:fi},paddingBlockStart:{style:fi},paddingBlockEnd:{style:fi},m:{style:hi},mt:{style:hi},mr:{style:hi},mb:{style:hi},ml:{style:hi},mx:{style:hi},my:{style:hi},margin:{style:hi},marginTop:{style:hi},marginRight:{style:hi},marginBottom:{style:hi},marginLeft:{style:hi},marginX:{style:hi},marginY:{style:hi},marginInline:{style:hi},marginInlineStart:{style:hi},marginInlineEnd:{style:hi},marginBlock:{style:hi},marginBlockStart:{style:hi},marginBlockEnd:{style:hi},displayPrint:{cssProperty:!1,transform:t=>({"@media print":{display:t}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:lR},rowGap:{style:dR},columnGap:{style:uR},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:Ca},maxWidth:{style:U2},minWidth:{transform:Ca},height:{transform:Ca},maxHeight:{transform:Ca},minHeight:{transform:Ca},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function vxe(...t){const e=t.reduce((r,i)=>r.concat(Object.keys(i)),[]),n=new Set(e);return t.every(r=>n.size===Object.keys(r).length)}function wxe(t,e){return typeof t=="function"?t(e):t}function Cxe(){function t(n,r,i,s){const o={[n]:r,theme:i},a=s[n];if(!a)return{[n]:r};const{cssProperty:A=n,themeKey:l,transform:d,style:f}=a;if(r==null)return null;if(l==="typography"&&r==="inherit")return{[n]:r};const p=aR(i,l)||{};return f?f(o):gu(o,r,y=>{let E=Nb(p,d,y);return y===E&&typeof y=="string"&&(E=Nb(p,d,`${n}${y==="default"?"":Qg(y)}`,y)),A===!1?E:{[A]:E}})}function e(n){const{sx:r,theme:i={}}=n||{};if(!r)return null;const s=i.unstable_sxConfig??hR;function o(a){let A=a;if(typeof a=="function")A=a(i);else if(typeof a!="object")return a;if(!A)return null;const l=xke(i.breakpoints),d=Object.keys(l);let f=l;return Object.keys(A).forEach(p=>{const g=wxe(A[p],i);if(g!=null)if(typeof g=="object")if(s[p])f=jy(f,t(p,g,i,s));else{const y=gu({theme:i},g,E=>({[p]:E}));vxe(y,g)?f[p]=e({sx:g,theme:i}):f=jy(f,y)}else f=jy(f,t(p,g,i,s))}),Bke(i,Mke(d,f))}return Array.isArray(r)?r.map(o):o(r)}return e}const Hg=Cxe();Hg.filterProps=["sx"];function JP(){return JP=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},JP.apply(null,arguments)}function Txe(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}function Sxe(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),t.nonce!==void 0&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var bxe=function(){function t(n){var r=this;this._insertTag=function(i){var s;r.tags.length===0?r.insertionPoint?s=r.insertionPoint.nextSibling:r.prepend?s=r.container.firstChild:s=r.before:s=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(i,s),r.tags.push(i)},this.isSpeedy=n.speedy===void 0?!0:n.speedy,this.tags=[],this.ctr=0,this.nonce=n.nonce,this.key=n.key,this.container=n.container,this.prepend=n.prepend,this.insertionPoint=n.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(r){r.forEach(this._insertTag)},e.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(Sxe(this));var i=this.tags[this.tags.length-1];if(this.isSpeedy){var s=Txe(i);try{s.insertRule(r,s.cssRules.length)}catch{}}else i.appendChild(document.createTextNode(r));this.ctr++},e.flush=function(){this.tags.forEach(function(r){var i;return(i=r.parentNode)==null?void 0:i.removeChild(r)}),this.tags=[],this.ctr=0},t}(),no="-ms-",Db="-moz-",Hn="-webkit-",qne="comm",k2="rule",x2="decl",Ixe="@import",Yne="@keyframes",Rxe="@layer",Oxe=Math.abs,fR=String.fromCharCode,Nxe=Object.assign;function Dxe(t,e){return zs(t,0)^45?(((e<<2^zs(t,0))<<2^zs(t,1))<<2^zs(t,2))<<2^zs(t,3):0}function Xne(t){return t.trim()}function Bxe(t,e){return(t=e.exec(t))?t[0]:t}function jn(t,e,n){return t.replace(e,n)}function $P(t,e){return t.indexOf(e)}function zs(t,e){return t.charCodeAt(e)|0}function xv(t,e,n){return t.slice(e,n)}function xA(t){return t.length}function M2(t){return t.length}function YT(t,e){return e.push(t),t}function Lxe(t,e){return t.map(e).join("")}var pR=1,jg=1,Jne=0,ea=0,zi=0,v_="";function mR(t,e,n,r,i,s,o){return{value:t,root:e,parent:n,type:r,props:i,children:s,line:pR,column:jg,length:o,return:""}}function FE(t,e){return Nxe(mR("",null,null,"",null,null,0),t,{length:-t.length},e)}function Pxe(){return zi}function Uxe(){return zi=ea>0?zs(v_,--ea):0,jg--,zi===10&&(jg=1,pR--),zi}function Oa(){return zi=ea<Jne?zs(v_,ea++):0,jg++,zi===10&&(jg=1,pR++),zi}function el(){return zs(v_,ea)}function AS(){return ea}function bw(t,e){return xv(v_,t,e)}function Mv(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function $ne(t){return pR=jg=1,Jne=xA(v_=t),ea=0,[]}function Zne(t){return v_="",t}function lS(t){return Xne(bw(ea-1,ZP(t===91?t+2:t===40?t+1:t)))}function kxe(t){for(;(zi=el())&&zi<33;)Oa();return Mv(t)>2||Mv(zi)>3?"":" "}function xxe(t,e){for(;--e&&Oa()&&!(zi<48||zi>102||zi>57&&zi<65||zi>70&&zi<97););return bw(t,AS()+(e<6&&el()==32&&Oa()==32))}function ZP(t){for(;Oa();)switch(zi){case t:return ea;case 34:case 39:t!==34&&t!==39&&ZP(zi);break;case 40:t===41&&ZP(t);break;case 92:Oa();break}return ea}function Mxe(t,e){for(;Oa()&&t+zi!==57;)if(t+zi===84&&el()===47)break;return"/*"+bw(e,ea-1)+"*"+fR(t===47?t:Oa())}function Fxe(t){for(;!Mv(el());)Oa();return bw(t,ea)}function Vxe(t){return Zne(uS("",null,null,null,[""],t=$ne(t),0,[0],t))}function uS(t,e,n,r,i,s,o,a,A){for(var l=0,d=0,f=o,p=0,g=0,y=0,E=1,w=1,b=1,I=0,B="",U=i,H=s,K=r,x=B;w;)switch(y=I,I=Oa()){case 40:if(y!=108&&zs(x,f-1)==58){$P(x+=jn(lS(I),"&","&\f"),"&\f")!=-1&&(b=-1);break}case 34:case 39:case 91:x+=lS(I);break;case 9:case 10:case 13:case 32:x+=kxe(y);break;case 92:x+=xxe(AS()-1,7);continue;case 47:switch(el()){case 42:case 47:YT(Qxe(Mxe(Oa(),AS()),e,n),A);break;default:x+="/"}break;case 123*E:a[l++]=xA(x)*b;case 125*E:case 59:case 0:switch(I){case 0:case 125:w=0;case 59+d:b==-1&&(x=jn(x,/\f/g,"")),g>0&&xA(x)-f&&YT(g>32?FW(x+";",r,n,f-1):FW(jn(x," ","")+";",r,n,f-2),A);break;case 59:x+=";";default:if(YT(K=MW(x,e,n,l,d,i,a,B,U=[],H=[],f),s),I===123)if(d===0)uS(x,e,K,K,U,s,f,a,H);else switch(p===99&&zs(x,3)===110?100:p){case 100:case 108:case 109:case 115:uS(t,K,K,r&&YT(MW(t,K,K,0,0,i,a,B,i,U=[],f),H),i,H,f,a,r?U:H);break;default:uS(x,K,K,K,[""],H,0,a,H)}}l=d=g=0,E=b=1,B=x="",f=o;break;case 58:f=1+xA(x),g=y;default:if(E<1){if(I==123)--E;else if(I==125&&E++==0&&Uxe()==125)continue}switch(x+=fR(I),I*E){case 38:b=d>0?1:(x+="\f",-1);break;case 44:a[l++]=(xA(x)-1)*b,b=1;break;case 64:el()===45&&(x+=lS(Oa())),p=el(),d=f=xA(B=x+=Fxe(AS())),I++;break;case 45:y===45&&xA(x)==2&&(E=0)}}return s}function MW(t,e,n,r,i,s,o,a,A,l,d){for(var f=i-1,p=i===0?s:[""],g=M2(p),y=0,E=0,w=0;y<r;++y)for(var b=0,I=xv(t,f+1,f=Oxe(E=o[y])),B=t;b<g;++b)(B=Xne(E>0?p[b]+" "+I:jn(I,/&\f/g,p[b])))&&(A[w++]=B);return mR(t,e,n,i===0?k2:a,A,l,d)}function Qxe(t,e,n){return mR(t,e,n,qne,fR(Pxe()),xv(t,2,-2),0)}function FW(t,e,n,r){return mR(t,e,n,x2,xv(t,0,r),xv(t,r+1,-1),r)}function Ag(t,e){for(var n="",r=M2(t),i=0;i<r;i++)n+=e(t[i],i,t,e)||"";return n}function Hxe(t,e,n,r){switch(t.type){case Rxe:if(t.children.length)break;case Ixe:case x2:return t.return=t.return||t.value;case qne:return"";case Yne:return t.return=t.value+"{"+Ag(t.children,r)+"}";case k2:t.value=t.props.join(",")}return xA(n=Ag(t.children,r))?t.return=t.value+"{"+n+"}":""}function jxe(t){var e=M2(t);return function(n,r,i,s){for(var o="",a=0;a<e;a++)o+=t[a](n,r,i,s)||"";return o}}function Kxe(t){return function(e){e.root||(e=e.return)&&t(e)}}function ere(t){var e=Object.create(null);return function(n){return e[n]===void 0&&(e[n]=t(n)),e[n]}}var Gxe=function(e,n,r){for(var i=0,s=0;i=s,s=el(),i===38&&s===12&&(n[r]=1),!Mv(s);)Oa();return bw(e,ea)},Wxe=function(e,n){var r=-1,i=44;do switch(Mv(i)){case 0:i===38&&el()===12&&(n[r]=1),e[r]+=Gxe(ea-1,n,r);break;case 2:e[r]+=lS(i);break;case 4:if(i===44){e[++r]=el()===58?"&\f":"",n[r]=e[r].length;break}default:e[r]+=fR(i)}while(i=Oa());return e},zxe=function(e,n){return Zne(Wxe($ne(e),n))},VW=new WeakMap,qxe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var n=e.value,r=e.parent,i=e.column===r.column&&e.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(e.props.length===1&&n.charCodeAt(0)!==58&&!VW.get(r))&&!i){VW.set(e,!0);for(var s=[],o=zxe(n,s),a=r.props,A=0,l=0;A<o.length;A++)for(var d=0;d<a.length;d++,l++)e.props[l]=s[A]?o[A].replace(/&\f/g,a[d]):a[d]+" "+o[A]}}},Yxe=function(e){if(e.type==="decl"){var n=e.value;n.charCodeAt(0)===108&&n.charCodeAt(2)===98&&(e.return="",e.value="")}};function tre(t,e){switch(Dxe(t,e)){case 5103:return Hn+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Hn+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return Hn+t+Db+t+no+t+t;case 6828:case 4268:return Hn+t+no+t+t;case 6165:return Hn+t+no+"flex-"+t+t;case 5187:return Hn+t+jn(t,/(\w+).+(:[^]+)/,Hn+"box-$1$2"+no+"flex-$1$2")+t;case 5443:return Hn+t+no+"flex-item-"+jn(t,/flex-|-self/,"")+t;case 4675:return Hn+t+no+"flex-line-pack"+jn(t,/align-content|flex-|-self/,"")+t;case 5548:return Hn+t+no+jn(t,"shrink","negative")+t;case 5292:return Hn+t+no+jn(t,"basis","preferred-size")+t;case 6060:return Hn+"box-"+jn(t,"-grow","")+Hn+t+no+jn(t,"grow","positive")+t;case 4554:return Hn+jn(t,/([^-])(transform)/g,"$1"+Hn+"$2")+t;case 6187:return jn(jn(jn(t,/(zoom-|grab)/,Hn+"$1"),/(image-set)/,Hn+"$1"),t,"")+t;case 5495:case 3959:return jn(t,/(image-set\([^]*)/,Hn+"$1$`$1");case 4968:return jn(jn(t,/(.+:)(flex-)?(.*)/,Hn+"box-pack:$3"+no+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Hn+t+t;case 4095:case 3583:case 4068:case 2532:return jn(t,/(.+)-inline(.+)/,Hn+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(xA(t)-1-e>6)switch(zs(t,e+1)){case 109:if(zs(t,e+4)!==45)break;case 102:return jn(t,/(.+:)(.+)-([^]+)/,"$1"+Hn+"$2-$3$1"+Db+(zs(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~$P(t,"stretch")?tre(jn(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(zs(t,e+1)!==115)break;case 6444:switch(zs(t,xA(t)-3-(~$P(t,"!important")&&10))){case 107:return jn(t,":",":"+Hn)+t;case 101:return jn(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Hn+(zs(t,14)===45?"inline-":"")+"box$3$1"+Hn+"$2$3$1"+no+"$2box$3")+t}break;case 5936:switch(zs(t,e+11)){case 114:return Hn+t+no+jn(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return Hn+t+no+jn(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return Hn+t+no+jn(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return Hn+t+no+t+t}return t}var Xxe=function(e,n,r,i){if(e.length>-1&&!e.return)switch(e.type){case x2:e.return=tre(e.value,e.length);break;case Yne:return Ag([FE(e,{value:jn(e.value,"@","@"+Hn)})],i);case k2:if(e.length)return Lxe(e.props,function(s){switch(Bxe(s,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Ag([FE(e,{props:[jn(s,/:(read-\w+)/,":"+Db+"$1")]})],i);case"::placeholder":return Ag([FE(e,{props:[jn(s,/:(plac\w+)/,":"+Hn+"input-$1")]}),FE(e,{props:[jn(s,/:(plac\w+)/,":"+Db+"$1")]}),FE(e,{props:[jn(s,/:(plac\w+)/,no+"input-$1")]})],i)}return""})}},Jxe=[Xxe],$xe=function(e){var n=e.key;if(n==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(E){var w=E.getAttribute("data-emotion");w.indexOf(" ")!==-1&&(document.head.appendChild(E),E.setAttribute("data-s",""))})}var i=e.stylisPlugins||Jxe,s={},o,a=[];o=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+n+' "]'),function(E){for(var w=E.getAttribute("data-emotion").split(" "),b=1;b<w.length;b++)s[w[b]]=!0;a.push(E)});var A,l=[qxe,Yxe];{var d,f=[Hxe,Kxe(function(E){d.insert(E)})],p=jxe(l.concat(i,f)),g=function(w){return Ag(Vxe(w),p)};A=function(w,b,I,B){d=I,g(w?w+"{"+b.styles+"}":b.styles),B&&(y.inserted[b.name]=!0)}}var y={key:n,sheet:new bxe({key:n,container:o,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:s,registered:{},insert:A};return y.sheet.hydrate(a),y},Zxe=!0;function e2e(t,e,n){var r="";return n.split(" ").forEach(function(i){t[i]!==void 0?e.push(t[i]+";"):i&&(r+=i+" ")}),r}var nre=function(e,n,r){var i=e.key+"-"+n.name;(r===!1||Zxe===!1)&&e.registered[i]===void 0&&(e.registered[i]=n.styles)},t2e=function(e,n,r){nre(e,n,r);var i=e.key+"-"+n.name;if(e.inserted[n.name]===void 0){var s=n;do e.insert(n===s?"."+i:"",s,e.sheet,!0),s=s.next;while(s!==void 0)}};function n2e(t){for(var e=0,n,r=0,i=t.length;i>=4;++r,i-=4)n=t.charCodeAt(r)&255|(t.charCodeAt(++r)&255)<<8|(t.charCodeAt(++r)&255)<<16|(t.charCodeAt(++r)&255)<<24,n=(n&65535)*1540483477+((n>>>16)*59797<<16),n^=n>>>24,e=(n&65535)*1540483477+((n>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(i){case 3:e^=(t.charCodeAt(r+2)&255)<<16;case 2:e^=(t.charCodeAt(r+1)&255)<<8;case 1:e^=t.charCodeAt(r)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var r2e={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},i2e=/[A-Z]|^ms/g,s2e=/_EMO_([^_]+?)_([^]*?)_EMO_/g,rre=function(e){return e.charCodeAt(1)===45},QW=function(e){return e!=null&&typeof e!="boolean"},v1=ere(function(t){return rre(t)?t:t.replace(i2e,"-$&").toLowerCase()}),HW=function(e,n){switch(e){case"animation":case"animationName":if(typeof n=="string")return n.replace(s2e,function(r,i,s){return MA={name:i,styles:s,next:MA},i})}return r2e[e]!==1&&!rre(e)&&typeof n=="number"&&n!==0?n+"px":n};function Fv(t,e,n){if(n==null)return"";var r=n;if(r.__emotion_styles!==void 0)return r;switch(typeof n){case"boolean":return"";case"object":{var i=n;if(i.anim===1)return MA={name:i.name,styles:i.styles,next:MA},i.name;var s=n;if(s.styles!==void 0){var o=s.next;if(o!==void 0)for(;o!==void 0;)MA={name:o.name,styles:o.styles,next:MA},o=o.next;var a=s.styles+";";return a}return o2e(t,e,n)}case"function":{if(t!==void 0){var A=MA,l=n(t);return MA=A,Fv(t,e,l)}break}}var d=n;if(e==null)return d;var f=e[d];return f!==void 0?f:d}function o2e(t,e,n){var r="";if(Array.isArray(n))for(var i=0;i<n.length;i++)r+=Fv(t,e,n[i])+";";else for(var s in n){var o=n[s];if(typeof o!="object"){var a=o;e!=null&&e[a]!==void 0?r+=s+"{"+e[a]+"}":QW(a)&&(r+=v1(s)+":"+HW(s,a)+";")}else if(Array.isArray(o)&&typeof o[0]=="string"&&(e==null||e[o[0]]===void 0))for(var A=0;A<o.length;A++)QW(o[A])&&(r+=v1(s)+":"+HW(s,o[A])+";");else{var l=Fv(t,e,o);switch(s){case"animation":case"animationName":{r+=v1(s)+":"+l+";";break}default:r+=s+"{"+l+"}"}}}return r}var jW=/label:\s*([^\s;{]+)\s*(;|$)/g,MA;function ire(t,e,n){if(t.length===1&&typeof t[0]=="object"&&t[0]!==null&&t[0].styles!==void 0)return t[0];var r=!0,i="";MA=void 0;var s=t[0];if(s==null||s.raw===void 0)r=!1,i+=Fv(n,e,s);else{var o=s;i+=o[0]}for(var a=1;a<t.length;a++)if(i+=Fv(n,e,t[a]),r){var A=s;i+=A[a]}jW.lastIndex=0;for(var l="",d;(d=jW.exec(i))!==null;)l+="-"+d[1];var f=n2e(i)+l;return{name:f,styles:i,next:MA}}var a2e=function(e){return e()},c2e=l4.useInsertionEffect?l4.useInsertionEffect:!1,A2e=c2e||a2e,sre=J.createContext(typeof HTMLElement<"u"?$xe({key:"css"}):null);sre.Provider;var l2e=function(e){return J.forwardRef(function(n,r){var i=J.useContext(sre);return e(n,i,r)})},u2e=J.createContext({}),d2e=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,h2e=ere(function(t){return d2e.test(t)||t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)<91}),f2e=h2e,p2e=function(e){return e!=="theme"},KW=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?f2e:p2e},GW=function(e,n,r){var i;if(n){var s=n.shouldForwardProp;i=e.__emotion_forwardProp&&s?function(o){return e.__emotion_forwardProp(o)&&s(o)}:s}return typeof i!="function"&&r&&(i=e.__emotion_forwardProp),i},m2e=function(e){var n=e.cache,r=e.serialized,i=e.isStringTag;return nre(n,r,i),A2e(function(){return t2e(n,r,i)}),null},g2e=function t(e,n){var r=e.__emotion_real===e,i=r&&e.__emotion_base||e,s,o;n!==void 0&&(s=n.label,o=n.target);var a=GW(e,n,r),A=a||KW(i),l=!A("as");return function(){var d=arguments,f=r&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(s!==void 0&&f.push("label:"+s+";"),d[0]==null||d[0].raw===void 0)f.push.apply(f,d);else{var p=d[0];f.push(p[0]);for(var g=d.length,y=1;y<g;y++)f.push(d[y],p[y])}var E=l2e(function(w,b,I){var B=l&&w.as||i,U="",H=[],K=w;if(w.theme==null){K={};for(var x in w)K[x]=w[x];K.theme=J.useContext(u2e)}typeof w.className=="string"?U=e2e(b.registered,H,w.className):w.className!=null&&(U=w.className+" ");var V=ire(f.concat(H),b.registered,K);U+=b.key+"-"+V.name,o!==void 0&&(U+=" "+o);var M=l&&a===void 0?KW(B):A,O={};for(var z in w)l&&z==="as"||M(z)&&(O[z]=w[z]);return O.className=U,I&&(O.ref=I),J.createElement(J.Fragment,null,J.createElement(m2e,{cache:b,serialized:V,isStringTag:typeof B=="string"}),J.createElement(B,O))});return E.displayName=s!==void 0?s:"Styled("+(typeof i=="string"?i:i.displayName||i.name||"Component")+")",E.defaultProps=e.defaultProps,E.__emotion_real=E,E.__emotion_base=i,E.__emotion_styles=f,E.__emotion_forwardProp=a,Object.defineProperty(E,"toString",{value:function(){return"."+o}}),E.withComponent=function(w,b){var I=t(w,JP({},n,b,{shouldForwardProp:GW(E,b,!0)}));return I.apply(void 0,f)},E}},_2e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],eU=g2e.bind(null);_2e.forEach(function(t){eU[t]=eU(t)});function E2e(t,e){return eU(t,e)}function y2e(t,e){Array.isArray(t.__emotion_styles)&&(t.__emotion_styles=e(t.__emotion_styles))}const WW=[];function zW(t){return WW[0]=t,ire(WW)}const v2e=t=>{const e=Object.keys(t).map(n=>({key:n,val:t[n]}))||[];return e.sort((n,r)=>n.val-r.val),e.reduce((n,r)=>({...n,[r.key]:r.val}),{})};function w2e(t){const{values:e={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:n="px",step:r=5,...i}=t,s=v2e(e),o=Object.keys(s);function a(p){return`@media (min-width:${typeof e[p]=="number"?e[p]:p}${n})`}function A(p){return`@media (max-width:${(typeof e[p]=="number"?e[p]:p)-r/100}${n})`}function l(p,g){const y=o.indexOf(g);return`@media (min-width:${typeof e[p]=="number"?e[p]:p}${n}) and (max-width:${(y!==-1&&typeof e[o[y]]=="number"?e[o[y]]:g)-r/100}${n})`}function d(p){return o.indexOf(p)+1<o.length?l(p,o[o.indexOf(p)+1]):a(p)}function f(p){const g=o.indexOf(p);return g===0?a(o[1]):g===o.length-1?A(o[g]):l(p,o[o.indexOf(p)+1]).replace("@media","@media not all and")}return{keys:o,values:s,up:a,down:A,between:l,only:d,not:f,unit:n,...i}}const C2e={borderRadius:4};function ore(t=8,e=P2({spacing:t})){if(t.mui)return t;const n=(...r)=>(r.length===0?[1]:r).map(s=>{const o=e(s);return typeof o=="number"?`${o}px`:o}).join(" ");return n.mui=!0,n}function T2e(t,e){var r;const n=this;if(n.vars){if(!((r=n.colorSchemes)!=null&&r[t])||typeof n.getColorSchemeSelector!="function")return{};let i=n.getColorSchemeSelector(t);return i==="&"?e:((i.includes("data-")||i.includes("."))&&(i=`*:where(${i.replace(/\s*&$/,"")}) &`),{[i]:e})}return n.palette.mode===t?e:{}}function are(t={},...e){const{breakpoints:n={},palette:r={},spacing:i,shape:s={},...o}=t,a=w2e(n),A=ore(i);let l=Ra({breakpoints:a,direction:"ltr",components:{},palette:{mode:"light",...r},spacing:A,shape:{...C2e,...s}},o);return l=Uke(l),l.applyStyles=T2e,l=e.reduce((d,f)=>Ra(d,f),l),l.unstable_sxConfig={...hR,...o==null?void 0:o.unstable_sxConfig},l.unstable_sx=function(f){return Hg({sx:f,theme:this})},l}const S2e={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function cre(t,e,n="Mui"){const r=S2e[e];return r?`${n}-${r}`:`${Ike.generate(t)}-${e}`}function b2e(t,e,n="Mui"){const r={};return e.forEach(i=>{r[i]=cre(t,i,n)}),r}function Are(t){const{variants:e,...n}=t,r={variants:e,style:zW(n),isProcessed:!0};return r.style===n||e&&e.forEach(i=>{typeof i.style!="function"&&(i.style=zW(i.style))}),r}const I2e=are();function w1(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}function R2e(t){return t?(e,n)=>n[t]:null}function O2e(t,e,n){t.theme=B2e(t.theme)?n:t.theme[e]||t.theme}function dS(t,e){const n=typeof e=="function"?e(t):e;if(Array.isArray(n))return n.flatMap(r=>dS(t,r));if(Array.isArray(n==null?void 0:n.variants)){let r;if(n.isProcessed)r=n.style;else{const{variants:i,...s}=n;r=s}return lre(t,n.variants,[r])}return n!=null&&n.isProcessed?n.style:n}function lre(t,e,n=[]){var i;let r;e:for(let s=0;s<e.length;s+=1){const o=e[s];if(typeof o.props=="function"){if(r??(r={...t,...t.ownerState,ownerState:t.ownerState}),!o.props(r))continue}else for(const a in o.props)if(t[a]!==o.props[a]&&((i=t.ownerState)==null?void 0:i[a])!==o.props[a])continue e;typeof o.style=="function"?(r??(r={...t,...t.ownerState,ownerState:t.ownerState}),n.push(o.style(r))):n.push(o.style)}return n}function N2e(t={}){const{themeId:e,defaultTheme:n=I2e,rootShouldForwardProp:r=w1,slotShouldForwardProp:i=w1}=t;function s(a){O2e(a,e,n)}return(a,A={})=>{y2e(a,H=>H.filter(K=>K!==Hg));const{name:l,slot:d,skipVariantsResolver:f,skipSx:p,overridesResolver:g=R2e(P2e(d)),...y}=A,E=f!==void 0?f:d&&d!=="Root"&&d!=="root"||!1,w=p||!1;let b=w1;d==="Root"||d==="root"?b=r:d?b=i:L2e(a)&&(b=void 0);const I=E2e(a,{shouldForwardProp:b,label:D2e(),...y}),B=H=>{if(typeof H=="function"&&H.__emotion_real!==H)return function(x){return dS(x,H)};if($l(H)){const K=Are(H);return K.variants?function(V){return dS(V,K)}:K.style}return H},U=(...H)=>{const K=[],x=H.map(B),V=[];if(K.push(s),l&&g&&V.push(function($){var re,Y;const Ue=(Y=(re=$.theme.components)==null?void 0:re[l])==null?void 0:Y.styleOverrides;if(!Ue)return null;const fe={};for(const Z in Ue)fe[Z]=dS($,Ue[Z]);return g($,fe)}),l&&!E&&V.push(function($){var fe,re;const q=$.theme,Ue=(re=(fe=q==null?void 0:q.components)==null?void 0:fe[l])==null?void 0:re.variants;return Ue?lre($,Ue):null}),w||V.push(Hg),Array.isArray(x[0])){const z=x.shift(),$=new Array(K.length).fill(""),q=new Array(V.length).fill("");let Ue;Ue=[...$,...z,...q],Ue.raw=[...$,...z.raw,...q],K.unshift(Ue)}const M=[...K,...x,...V],O=I(...M);return a.muiName&&(O.muiName=a.muiName),O};return I.withConfig&&(U.withConfig=I.withConfig),U}}function D2e(t,e){return void 0}function B2e(t){for(const e in t)return!1;return!0}function L2e(t){return typeof t=="string"&&t.charCodeAt(0)>96}function P2e(t){return t&&t.charAt(0).toLowerCase()+t.slice(1)}function tU(t,e){const n={...e};for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const i=r;if(i==="components"||i==="slots")n[i]={...t[i],...n[i]};else if(i==="componentsProps"||i==="slotProps"){const s=t[i],o=e[i];if(!o)n[i]=s||{};else if(!s)n[i]=o;else{n[i]={...o};for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)){const A=a;n[i][A]=tU(s[A],o[A])}}}else n[i]===void 0&&(n[i]=t[i])}return n}function U2e(t,e=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER){return Math.max(e,Math.min(t,n))}function F2(t,e=0,n=1){return U2e(t,e,n)}function k2e(t){t=t.slice(1);const e=new RegExp(`.{1,${t.length>=6?2:1}}`,"g");let n=t.match(e);return n&&n[0].length===1&&(n=n.map(r=>r+r)),n?`rgb${n.length===4?"a":""}(${n.map((r,i)=>i<3?parseInt(r,16):Math.round(parseInt(r,16)/255*1e3)/1e3).join(", ")})`:""}function sh(t){if(t.type)return t;if(t.charAt(0)==="#")return sh(k2e(t));const e=t.indexOf("("),n=t.substring(0,e);if(!["rgb","rgba","hsl","hsla","color"].includes(n))throw new Error(Kf(9,t));let r=t.substring(e+1,t.length-1),i;if(n==="color"){if(r=r.split(" "),i=r.shift(),r.length===4&&r[3].charAt(0)==="/"&&(r[3]=r[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(i))throw new Error(Kf(10,i))}else r=r.split(",");return r=r.map(s=>parseFloat(s)),{type:n,values:r,colorSpace:i}}const x2e=t=>{const e=sh(t);return e.values.slice(0,3).map((n,r)=>e.type.includes("hsl")&&r!==0?`${n}%`:n).join(" ")},ay=(t,e)=>{try{return x2e(t)}catch{return t}};function gR(t){const{type:e,colorSpace:n}=t;let{values:r}=t;return e.includes("rgb")?r=r.map((i,s)=>s<3?parseInt(i,10):i):e.includes("hsl")&&(r[1]=`${r[1]}%`,r[2]=`${r[2]}%`),e.includes("color")?r=`${n} ${r.join(" ")}`:r=`${r.join(", ")}`,`${e}(${r})`}function ure(t){t=sh(t);const{values:e}=t,n=e[0],r=e[1]/100,i=e[2]/100,s=r*Math.min(i,1-i),o=(l,d=(l+n/30)%12)=>i-s*Math.max(Math.min(d-3,9-d,1),-1);let a="rgb";const A=[Math.round(o(0)*255),Math.round(o(8)*255),Math.round(o(4)*255)];return t.type==="hsla"&&(a+="a",A.push(e[3])),gR({type:a,values:A})}function nU(t){t=sh(t);let e=t.type==="hsl"||t.type==="hsla"?sh(ure(t)).values:t.values;return e=e.map(n=>(t.type!=="color"&&(n/=255),n<=.03928?n/12.92:((n+.055)/1.055)**2.4)),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function M2e(t,e){const n=nU(t),r=nU(e);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}function F2e(t,e){return t=sh(t),e=F2(e),(t.type==="rgb"||t.type==="hsl")&&(t.type+="a"),t.type==="color"?t.values[3]=`/${e}`:t.values[3]=e,gR(t)}function XT(t,e,n){try{return F2e(t,e)}catch{return t}}function V2(t,e){if(t=sh(t),e=F2(e),t.type.includes("hsl"))t.values[2]*=1-e;else if(t.type.includes("rgb")||t.type.includes("color"))for(let n=0;n<3;n+=1)t.values[n]*=1-e;return gR(t)}function Er(t,e,n){try{return V2(t,e)}catch{return t}}function Q2(t,e){if(t=sh(t),e=F2(e),t.type.includes("hsl"))t.values[2]+=(100-t.values[2])*e;else if(t.type.includes("rgb"))for(let n=0;n<3;n+=1)t.values[n]+=(255-t.values[n])*e;else if(t.type.includes("color"))for(let n=0;n<3;n+=1)t.values[n]+=(1-t.values[n])*e;return gR(t)}function yr(t,e,n){try{return Q2(t,e)}catch{return t}}function V2e(t,e=.15){return nU(t)>.5?V2(t,e):Q2(t,e)}function JT(t,e,n){try{return V2e(t,e)}catch{return t}}const Q2e=J.createContext(void 0);function H2e(t){const{theme:e,name:n,props:r}=t;if(!e||!e.components||!e.components[n])return r;const i=e.components[n];return i.defaultProps?tU(i.defaultProps,r):!i.styleOverrides&&!i.variants?tU(i,r):r}function j2e({props:t,name:e}){const n=J.useContext(Q2e);return H2e({props:t,name:e,theme:{components:n}})}const qW={theme:void 0};function K2e(t){let e,n;return function(i){let s=e;return(s===void 0||i.theme!==n)&&(qW.theme=i.theme,s=Are(t(qW)),e=s,n=i.theme),s}}function G2e(t=""){function e(...r){if(!r.length)return"";const i=r[0];return typeof i=="string"&&!i.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${t?`${t}-`:""}${i}${e(...r.slice(1))})`:`, ${i}`}return(r,...i)=>`var(--${t?`${t}-`:""}${r}${e(...i)})`}const YW=(t,e,n,r=[])=>{let i=t;e.forEach((s,o)=>{o===e.length-1?Array.isArray(i)?i[Number(s)]=n:i&&typeof i=="object"&&(i[s]=n):i&&typeof i=="object"&&(i[s]||(i[s]=r.includes(s)?[]:{}),i=i[s])})},W2e=(t,e,n)=>{function r(i,s=[],o=[]){Object.entries(i).forEach(([a,A])=>{(!n||n&&!n([...s,a]))&&A!=null&&(typeof A=="object"&&Object.keys(A).length>0?r(A,[...s,a],Array.isArray(A)?[...o,a]:o):e([...s,a],A,o))})}r(t)},z2e=(t,e)=>typeof e=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(r=>t.includes(r))||t[t.length-1].toLowerCase().includes("opacity")?e:`${e}px`:e;function C1(t,e){const{prefix:n,shouldSkipGeneratingVar:r}=e||{},i={},s={},o={};return W2e(t,(a,A,l)=>{if((typeof A=="string"||typeof A=="number")&&(!r||!r(a,A))){const d=`--${n?`${n}-`:""}${a.join("-")}`,f=z2e(a,A);Object.assign(i,{[d]:f}),YW(s,a,`var(${d})`,l),YW(o,a,`var(${d}, ${f})`,l)}},a=>a[0]==="vars"),{css:i,vars:s,varsWithDefaults:o}}function q2e(t,e={}){const{getSelector:n=w,disableCssColorScheme:r,colorSchemeSelector:i}=e,{colorSchemes:s={},components:o,defaultColorScheme:a="light",...A}=t,{vars:l,css:d,varsWithDefaults:f}=C1(A,e);let p=f;const g={},{[a]:y,...E}=s;if(Object.entries(E||{}).forEach(([B,U])=>{const{vars:H,css:K,varsWithDefaults:x}=C1(U,e);p=Ra(p,x),g[B]={css:K,vars:H}}),y){const{css:B,vars:U,varsWithDefaults:H}=C1(y,e);p=Ra(p,H),g[a]={css:B,vars:U}}function w(B,U){var K,x;let H=i;if(i==="class"&&(H=".%s"),i==="data"&&(H="[data-%s]"),i!=null&&i.startsWith("data-")&&!i.includes("%s")&&(H=`[${i}="%s"]`),B){if(H==="media")return t.defaultColorScheme===B?":root":{[`@media (prefers-color-scheme: ${((x=(K=s[B])==null?void 0:K.palette)==null?void 0:x.mode)||B})`]:{":root":U}};if(H)return t.defaultColorScheme===B?`:root, ${H.replace("%s",String(B))}`:H.replace("%s",String(B))}return":root"}return{vars:p,generateThemeVars:()=>{let B={...l};return Object.entries(g).forEach(([,{vars:U}])=>{B=Ra(B,U)}),B},generateStyleSheets:()=>{var V,M;const B=[],U=t.defaultColorScheme||"light";function H(O,z){Object.keys(z).length&&B.push(typeof O=="string"?{[O]:{...z}}:O)}H(n(void 0,{...d}),d);const{[U]:K,...x}=g;if(K){const{css:O}=K,z=(M=(V=s[U])==null?void 0:V.palette)==null?void 0:M.mode,$=!r&&z?{colorScheme:z,...O}:{...O};H(n(U,{...$}),$)}return Object.entries(x).forEach(([O,{css:z}])=>{var Ue,fe;const $=(fe=(Ue=s[O])==null?void 0:Ue.palette)==null?void 0:fe.mode,q=!r&&$?{colorScheme:$,...z}:{...z};H(n(O,{...q}),q)}),B}}}function Y2e(t){return function(n){return t==="media"?`@media (prefers-color-scheme: ${n})`:t?t.startsWith("data-")&&!t.includes("%s")?`[${t}="${n}"] &`:t==="class"?`.${n} &`:t==="data"?`[data-${n}] &`:`${t.replace("%s",n)} &`:"&"}}const Vv={black:"#000",white:"#fff"},X2e={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},om={50:"#f3e5f5",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",700:"#7b1fa2"},am={300:"#e57373",400:"#ef5350",500:"#f44336",700:"#d32f2f",800:"#c62828"},VE={300:"#ffb74d",400:"#ffa726",500:"#ff9800",700:"#f57c00",900:"#e65100"},cm={50:"#e3f2fd",200:"#90caf9",400:"#42a5f5",700:"#1976d2",800:"#1565c0"},Am={300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",700:"#0288d1",900:"#01579b"},lm={300:"#81c784",400:"#66bb6a",500:"#4caf50",700:"#388e3c",800:"#2e7d32",900:"#1b5e20"};function dre(){return{text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:Vv.white,default:Vv.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}}}const J2e=dre();function hre(){return{text:{primary:Vv.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:Vv.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}}}const XW=hre();function JW(t,e,n,r){const i=r.light||r,s=r.dark||r*1.5;t[e]||(t.hasOwnProperty(n)?t[e]=t[n]:e==="light"?t.light=Q2(t.main,i):e==="dark"&&(t.dark=V2(t.main,s)))}function $2e(t="light"){return t==="dark"?{main:cm[200],light:cm[50],dark:cm[400]}:{main:cm[700],light:cm[400],dark:cm[800]}}function Z2e(t="light"){return t==="dark"?{main:om[200],light:om[50],dark:om[400]}:{main:om[500],light:om[300],dark:om[700]}}function eMe(t="light"){return t==="dark"?{main:am[500],light:am[300],dark:am[700]}:{main:am[700],light:am[400],dark:am[800]}}function tMe(t="light"){return t==="dark"?{main:Am[400],light:Am[300],dark:Am[700]}:{main:Am[700],light:Am[500],dark:Am[900]}}function nMe(t="light"){return t==="dark"?{main:lm[400],light:lm[300],dark:lm[700]}:{main:lm[800],light:lm[500],dark:lm[900]}}function rMe(t="light"){return t==="dark"?{main:VE[400],light:VE[300],dark:VE[700]}:{main:"#ed6c02",light:VE[500],dark:VE[900]}}function H2(t){const{mode:e="light",contrastThreshold:n=3,tonalOffset:r=.2,...i}=t,s=t.primary||$2e(e),o=t.secondary||Z2e(e),a=t.error||eMe(e),A=t.info||tMe(e),l=t.success||nMe(e),d=t.warning||rMe(e);function f(E){return M2e(E,XW.text.primary)>=n?XW.text.primary:J2e.text.primary}const p=({color:E,name:w,mainShade:b=500,lightShade:I=300,darkShade:B=700})=>{if(E={...E},!E.main&&E[b]&&(E.main=E[b]),!E.hasOwnProperty("main"))throw new Error(Kf(11,w?` (${w})`:"",b));if(typeof E.main!="string")throw new Error(Kf(12,w?` (${w})`:"",JSON.stringify(E.main)));return JW(E,"light",I,r),JW(E,"dark",B,r),E.contrastText||(E.contrastText=f(E.main)),E};let g;return e==="light"?g=dre():e==="dark"&&(g=hre()),Ra({common:{...Vv},mode:e,primary:p({color:s,name:"primary"}),secondary:p({color:o,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:p({color:a,name:"error"}),warning:p({color:d,name:"warning"}),info:p({color:A,name:"info"}),success:p({color:l,name:"success"}),grey:X2e,contrastThreshold:n,getContrastText:f,augmentColor:p,tonalOffset:r,...g},i)}function iMe(t){const e={};return Object.entries(t).forEach(r=>{const[i,s]=r;typeof s=="object"&&(e[i]=`${s.fontStyle?`${s.fontStyle} `:""}${s.fontVariant?`${s.fontVariant} `:""}${s.fontWeight?`${s.fontWeight} `:""}${s.fontStretch?`${s.fontStretch} `:""}${s.fontSize||""}${s.lineHeight?`/${s.lineHeight} `:""}${s.fontFamily||""}`)}),e}function sMe(t,e){return{toolbar:{minHeight:56,[t.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[t.up("sm")]:{minHeight:64}},...e}}function oMe(t){return Math.round(t*1e5)/1e5}const $W={textTransform:"uppercase"},ZW='"Roboto", "Helvetica", "Arial", sans-serif';function aMe(t,e){const{fontFamily:n=ZW,fontSize:r=14,fontWeightLight:i=300,fontWeightRegular:s=400,fontWeightMedium:o=500,fontWeightBold:a=700,htmlFontSize:A=16,allVariants:l,pxToRem:d,...f}=typeof e=="function"?e(t):e,p=r/14,g=d||(w=>`${w/A*p}rem`),y=(w,b,I,B,U)=>({fontFamily:n,fontWeight:w,fontSize:g(b),lineHeight:I,...n===ZW?{letterSpacing:`${oMe(B/b)}em`}:{},...U,...l}),E={h1:y(i,96,1.167,-1.5),h2:y(i,60,1.2,-.5),h3:y(s,48,1.167,0),h4:y(s,34,1.235,.25),h5:y(s,24,1.334,0),h6:y(o,20,1.6,.15),subtitle1:y(s,16,1.75,.15),subtitle2:y(o,14,1.57,.1),body1:y(s,16,1.5,.15),body2:y(s,14,1.43,.15),button:y(o,14,1.75,.4,$W),caption:y(s,12,1.66,.4),overline:y(s,12,2.66,1,$W),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return Ra({htmlFontSize:A,pxToRem:g,fontFamily:n,fontSize:r,fontWeightLight:i,fontWeightRegular:s,fontWeightMedium:o,fontWeightBold:a,...E},f,{clone:!1})}const cMe=.2,AMe=.14,lMe=.12;function Vr(...t){return[`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px rgba(0,0,0,${cMe})`,`${t[4]}px ${t[5]}px ${t[6]}px ${t[7]}px rgba(0,0,0,${AMe})`,`${t[8]}px ${t[9]}px ${t[10]}px ${t[11]}px rgba(0,0,0,${lMe})`].join(",")}const uMe=["none",Vr(0,2,1,-1,0,1,1,0,0,1,3,0),Vr(0,3,1,-2,0,2,2,0,0,1,5,0),Vr(0,3,3,-2,0,3,4,0,0,1,8,0),Vr(0,2,4,-1,0,4,5,0,0,1,10,0),Vr(0,3,5,-1,0,5,8,0,0,1,14,0),Vr(0,3,5,-1,0,6,10,0,0,1,18,0),Vr(0,4,5,-2,0,7,10,1,0,2,16,1),Vr(0,5,5,-3,0,8,10,1,0,3,14,2),Vr(0,5,6,-3,0,9,12,1,0,3,16,2),Vr(0,6,6,-3,0,10,14,1,0,4,18,3),Vr(0,6,7,-4,0,11,15,1,0,4,20,3),Vr(0,7,8,-4,0,12,17,2,0,5,22,4),Vr(0,7,8,-4,0,13,19,2,0,5,24,4),Vr(0,7,9,-4,0,14,21,2,0,5,26,4),Vr(0,8,9,-5,0,15,22,2,0,6,28,5),Vr(0,8,10,-5,0,16,24,2,0,6,30,5),Vr(0,8,11,-5,0,17,26,2,0,6,32,5),Vr(0,9,11,-5,0,18,28,2,0,7,34,6),Vr(0,9,12,-6,0,19,29,2,0,7,36,6),Vr(0,10,13,-6,0,20,31,3,0,8,38,7),Vr(0,10,13,-6,0,21,33,3,0,8,40,7),Vr(0,10,14,-6,0,22,35,3,0,8,42,7),Vr(0,11,14,-7,0,23,36,3,0,9,44,8),Vr(0,11,15,-7,0,24,38,3,0,9,46,8)],dMe={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},hMe={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function ez(t){return`${Math.round(t)}ms`}function fMe(t){if(!t)return 0;const e=t/36;return Math.min(Math.round((4+15*e**.25+e/5)*10),3e3)}function pMe(t){const e={...dMe,...t.easing},n={...hMe,...t.duration};return{getAutoHeightDuration:fMe,create:(i=["all"],s={})=>{const{duration:o=n.standard,easing:a=e.easeInOut,delay:A=0,...l}=s;return(Array.isArray(i)?i:[i]).map(d=>`${d} ${typeof o=="string"?o:ez(o)} ${a} ${typeof A=="string"?A:ez(A)}`).join(",")},...t,easing:e,duration:n}}const mMe={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function gMe(t){return $l(t)||typeof t>"u"||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||Array.isArray(t)}function fre(t={}){const e={...t};function n(r){const i=Object.entries(r);for(let s=0;s<i.length;s++){const[o,a]=i[s];!gMe(a)||o.startsWith("unstable_")?delete r[o]:$l(a)&&(r[o]={...a},n(r[o]))}}return n(e),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(e,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function rU(t={},...e){const{breakpoints:n,mixins:r={},spacing:i,palette:s={},transitions:o={},typography:a={},shape:A,...l}=t;if(t.vars&&t.generateThemeVars===void 0)throw new Error(Kf(20));const d=H2(s),f=are(t);let p=Ra(f,{mixins:sMe(f.breakpoints,r),palette:d,shadows:uMe.slice(),typography:aMe(d,a),transitions:pMe(o),zIndex:{...mMe}});return p=Ra(p,l),p=e.reduce((g,y)=>Ra(g,y),p),p.unstable_sxConfig={...hR,...l==null?void 0:l.unstable_sxConfig},p.unstable_sx=function(y){return Hg({sx:y,theme:this})},p.toRuntimeSource=fre,p}function _Me(t){let e;return t<1?e=5.11916*t**2:e=4.5*Math.log(t+1)+2,Math.round(e*10)/1e3}const EMe=[...Array(25)].map((t,e)=>{if(e===0)return"none";const n=_Me(e);return`linear-gradient(rgba(255 255 255 / ${n}), rgba(255 255 255 / ${n}))`});function pre(t){return{inputPlaceholder:t==="dark"?.5:.42,inputUnderline:t==="dark"?.7:.42,switchTrackDisabled:t==="dark"?.2:.12,switchTrack:t==="dark"?.3:.38}}function mre(t){return t==="dark"?EMe:[]}function yMe(t){const{palette:e={mode:"light"},opacity:n,overlays:r,...i}=t,s=H2(e);return{palette:s,opacity:{...pre(s.mode),...n},overlays:r||mre(s.mode),...i}}function vMe(t){var e;return!!t[0].match(/(cssVarPrefix|colorSchemeSelector|rootSelector|typography|mixins|breakpoints|direction|transitions)/)||!!t[0].match(/sxConfig$/)||t[0]==="palette"&&!!((e=t[1])!=null&&e.match(/(mode|contrastThreshold|tonalOffset)/))}const wMe=t=>[...[...Array(25)].map((e,n)=>`--${t?`${t}-`:""}overlays-${n}`),`--${t?`${t}-`:""}palette-AppBar-darkBg`,`--${t?`${t}-`:""}palette-AppBar-darkColor`],CMe=t=>(e,n)=>{const r=t.rootSelector||":root",i=t.colorSchemeSelector;let s=i;if(i==="class"&&(s=".%s"),i==="data"&&(s="[data-%s]"),i!=null&&i.startsWith("data-")&&!i.includes("%s")&&(s=`[${i}="%s"]`),t.defaultColorScheme===e){if(e==="dark"){const o={};return wMe(t.cssVarPrefix).forEach(a=>{o[a]=n[a],delete n[a]}),s==="media"?{[r]:n,"@media (prefers-color-scheme: dark)":{[r]:o}}:s?{[s.replace("%s",e)]:o,[`${r}, ${s.replace("%s",e)}`]:n}:{[r]:{...n,...o}}}if(s&&s!=="media")return`${r}, ${s.replace("%s",String(e))}`}else if(e){if(s==="media")return{[`@media (prefers-color-scheme: ${String(e)})`]:{[r]:n}};if(s)return s.replace("%s",String(e))}return r};function TMe(t,e){e.forEach(n=>{t[n]||(t[n]={})})}function ve(t,e,n){!t[e]&&n&&(t[e]=n)}function cy(t){return typeof t!="string"||!t.startsWith("hsl")?t:ure(t)}function Vl(t,e){`${e}Channel`in t||(t[`${e}Channel`]=ay(cy(t[e])))}function SMe(t){return typeof t=="number"?`${t}px`:typeof t=="string"||typeof t=="function"||Array.isArray(t)?t:"8px"}const LA=t=>{try{return t()}catch{}},bMe=(t="mui")=>G2e(t);function T1(t,e,n,r){if(!e)return;e=e===!0?{}:e;const i=r==="dark"?"dark":"light";if(!n){t[r]=yMe({...e,palette:{mode:i,...e==null?void 0:e.palette}});return}const{palette:s,...o}=rU({...n,palette:{mode:i,...e==null?void 0:e.palette}});return t[r]={...e,palette:s,opacity:{...pre(i),...e==null?void 0:e.opacity},overlays:(e==null?void 0:e.overlays)||mre(i)},o}function IMe(t={},...e){const{colorSchemes:n={light:!0},defaultColorScheme:r,disableCssColorScheme:i=!1,cssVarPrefix:s="mui",shouldSkipGeneratingVar:o=vMe,colorSchemeSelector:a=n.light&&n.dark?"media":void 0,rootSelector:A=":root",...l}=t,d=Object.keys(n)[0],f=r||(n.light&&d!=="light"?"light":d),p=bMe(s),{[f]:g,light:y,dark:E,...w}=n,b={...w};let I=g;if((f==="dark"&&!("dark"in n)||f==="light"&&!("light"in n))&&(I=!0),!I)throw new Error(Kf(21,f));const B=T1(b,I,l,f);y&&!b.light&&T1(b,y,void 0,"light"),E&&!b.dark&&T1(b,E,void 0,"dark");let U={defaultColorScheme:f,...B,cssVarPrefix:s,colorSchemeSelector:a,rootSelector:A,getCssVar:p,colorSchemes:b,font:{...iMe(B.typography),...B.font},spacing:SMe(l.spacing)};Object.keys(U.colorSchemes).forEach(M=>{const O=U.colorSchemes[M].palette,z=$=>{const q=$.split("-"),Ue=q[1],fe=q[2];return p($,O[Ue][fe])};if(O.mode==="light"&&(ve(O.common,"background","#fff"),ve(O.common,"onBackground","#000")),O.mode==="dark"&&(ve(O.common,"background","#000"),ve(O.common,"onBackground","#fff")),TMe(O,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),O.mode==="light"){ve(O.Alert,"errorColor",Er(O.error.light,.6)),ve(O.Alert,"infoColor",Er(O.info.light,.6)),ve(O.Alert,"successColor",Er(O.success.light,.6)),ve(O.Alert,"warningColor",Er(O.warning.light,.6)),ve(O.Alert,"errorFilledBg",z("palette-error-main")),ve(O.Alert,"infoFilledBg",z("palette-info-main")),ve(O.Alert,"successFilledBg",z("palette-success-main")),ve(O.Alert,"warningFilledBg",z("palette-warning-main")),ve(O.Alert,"errorFilledColor",LA(()=>O.getContrastText(O.error.main))),ve(O.Alert,"infoFilledColor",LA(()=>O.getContrastText(O.info.main))),ve(O.Alert,"successFilledColor",LA(()=>O.getContrastText(O.success.main))),ve(O.Alert,"warningFilledColor",LA(()=>O.getContrastText(O.warning.main))),ve(O.Alert,"errorStandardBg",yr(O.error.light,.9)),ve(O.Alert,"infoStandardBg",yr(O.info.light,.9)),ve(O.Alert,"successStandardBg",yr(O.success.light,.9)),ve(O.Alert,"warningStandardBg",yr(O.warning.light,.9)),ve(O.Alert,"errorIconColor",z("palette-error-main")),ve(O.Alert,"infoIconColor",z("palette-info-main")),ve(O.Alert,"successIconColor",z("palette-success-main")),ve(O.Alert,"warningIconColor",z("palette-warning-main")),ve(O.AppBar,"defaultBg",z("palette-grey-100")),ve(O.Avatar,"defaultBg",z("palette-grey-400")),ve(O.Button,"inheritContainedBg",z("palette-grey-300")),ve(O.Button,"inheritContainedHoverBg",z("palette-grey-A100")),ve(O.Chip,"defaultBorder",z("palette-grey-400")),ve(O.Chip,"defaultAvatarColor",z("palette-grey-700")),ve(O.Chip,"defaultIconColor",z("palette-grey-700")),ve(O.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),ve(O.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),ve(O.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),ve(O.LinearProgress,"primaryBg",yr(O.primary.main,.62)),ve(O.LinearProgress,"secondaryBg",yr(O.secondary.main,.62)),ve(O.LinearProgress,"errorBg",yr(O.error.main,.62)),ve(O.LinearProgress,"infoBg",yr(O.info.main,.62)),ve(O.LinearProgress,"successBg",yr(O.success.main,.62)),ve(O.LinearProgress,"warningBg",yr(O.warning.main,.62)),ve(O.Skeleton,"bg",`rgba(${z("palette-text-primaryChannel")} / 0.11)`),ve(O.Slider,"primaryTrack",yr(O.primary.main,.62)),ve(O.Slider,"secondaryTrack",yr(O.secondary.main,.62)),ve(O.Slider,"errorTrack",yr(O.error.main,.62)),ve(O.Slider,"infoTrack",yr(O.info.main,.62)),ve(O.Slider,"successTrack",yr(O.success.main,.62)),ve(O.Slider,"warningTrack",yr(O.warning.main,.62));const $=JT(O.background.default,.8);ve(O.SnackbarContent,"bg",$),ve(O.SnackbarContent,"color",LA(()=>O.getContrastText($))),ve(O.SpeedDialAction,"fabHoverBg",JT(O.background.paper,.15)),ve(O.StepConnector,"border",z("palette-grey-400")),ve(O.StepContent,"border",z("palette-grey-400")),ve(O.Switch,"defaultColor",z("palette-common-white")),ve(O.Switch,"defaultDisabledColor",z("palette-grey-100")),ve(O.Switch,"primaryDisabledColor",yr(O.primary.main,.62)),ve(O.Switch,"secondaryDisabledColor",yr(O.secondary.main,.62)),ve(O.Switch,"errorDisabledColor",yr(O.error.main,.62)),ve(O.Switch,"infoDisabledColor",yr(O.info.main,.62)),ve(O.Switch,"successDisabledColor",yr(O.success.main,.62)),ve(O.Switch,"warningDisabledColor",yr(O.warning.main,.62)),ve(O.TableCell,"border",yr(XT(O.divider,1),.88)),ve(O.Tooltip,"bg",XT(O.grey[700],.92))}if(O.mode==="dark"){ve(O.Alert,"errorColor",yr(O.error.light,.6)),ve(O.Alert,"infoColor",yr(O.info.light,.6)),ve(O.Alert,"successColor",yr(O.success.light,.6)),ve(O.Alert,"warningColor",yr(O.warning.light,.6)),ve(O.Alert,"errorFilledBg",z("palette-error-dark")),ve(O.Alert,"infoFilledBg",z("palette-info-dark")),ve(O.Alert,"successFilledBg",z("palette-success-dark")),ve(O.Alert,"warningFilledBg",z("palette-warning-dark")),ve(O.Alert,"errorFilledColor",LA(()=>O.getContrastText(O.error.dark))),ve(O.Alert,"infoFilledColor",LA(()=>O.getContrastText(O.info.dark))),ve(O.Alert,"successFilledColor",LA(()=>O.getContrastText(O.success.dark))),ve(O.Alert,"warningFilledColor",LA(()=>O.getContrastText(O.warning.dark))),ve(O.Alert,"errorStandardBg",Er(O.error.light,.9)),ve(O.Alert,"infoStandardBg",Er(O.info.light,.9)),ve(O.Alert,"successStandardBg",Er(O.success.light,.9)),ve(O.Alert,"warningStandardBg",Er(O.warning.light,.9)),ve(O.Alert,"errorIconColor",z("palette-error-main")),ve(O.Alert,"infoIconColor",z("palette-info-main")),ve(O.Alert,"successIconColor",z("palette-success-main")),ve(O.Alert,"warningIconColor",z("palette-warning-main")),ve(O.AppBar,"defaultBg",z("palette-grey-900")),ve(O.AppBar,"darkBg",z("palette-background-paper")),ve(O.AppBar,"darkColor",z("palette-text-primary")),ve(O.Avatar,"defaultBg",z("palette-grey-600")),ve(O.Button,"inheritContainedBg",z("palette-grey-800")),ve(O.Button,"inheritContainedHoverBg",z("palette-grey-700")),ve(O.Chip,"defaultBorder",z("palette-grey-700")),ve(O.Chip,"defaultAvatarColor",z("palette-grey-300")),ve(O.Chip,"defaultIconColor",z("palette-grey-300")),ve(O.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),ve(O.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),ve(O.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),ve(O.LinearProgress,"primaryBg",Er(O.primary.main,.5)),ve(O.LinearProgress,"secondaryBg",Er(O.secondary.main,.5)),ve(O.LinearProgress,"errorBg",Er(O.error.main,.5)),ve(O.LinearProgress,"infoBg",Er(O.info.main,.5)),ve(O.LinearProgress,"successBg",Er(O.success.main,.5)),ve(O.LinearProgress,"warningBg",Er(O.warning.main,.5)),ve(O.Skeleton,"bg",`rgba(${z("palette-text-primaryChannel")} / 0.13)`),ve(O.Slider,"primaryTrack",Er(O.primary.main,.5)),ve(O.Slider,"secondaryTrack",Er(O.secondary.main,.5)),ve(O.Slider,"errorTrack",Er(O.error.main,.5)),ve(O.Slider,"infoTrack",Er(O.info.main,.5)),ve(O.Slider,"successTrack",Er(O.success.main,.5)),ve(O.Slider,"warningTrack",Er(O.warning.main,.5));const $=JT(O.background.default,.98);ve(O.SnackbarContent,"bg",$),ve(O.SnackbarContent,"color",LA(()=>O.getContrastText($))),ve(O.SpeedDialAction,"fabHoverBg",JT(O.background.paper,.15)),ve(O.StepConnector,"border",z("palette-grey-600")),ve(O.StepContent,"border",z("palette-grey-600")),ve(O.Switch,"defaultColor",z("palette-grey-300")),ve(O.Switch,"defaultDisabledColor",z("palette-grey-600")),ve(O.Switch,"primaryDisabledColor",Er(O.primary.main,.55)),ve(O.Switch,"secondaryDisabledColor",Er(O.secondary.main,.55)),ve(O.Switch,"errorDisabledColor",Er(O.error.main,.55)),ve(O.Switch,"infoDisabledColor",Er(O.info.main,.55)),ve(O.Switch,"successDisabledColor",Er(O.success.main,.55)),ve(O.Switch,"warningDisabledColor",Er(O.warning.main,.55)),ve(O.TableCell,"border",Er(XT(O.divider,1),.68)),ve(O.Tooltip,"bg",XT(O.grey[700],.92))}Vl(O.background,"default"),Vl(O.background,"paper"),Vl(O.common,"background"),Vl(O.common,"onBackground"),Vl(O,"divider"),Object.keys(O).forEach($=>{const q=O[$];$!=="tonalOffset"&&q&&typeof q=="object"&&(q.main&&ve(O[$],"mainChannel",ay(cy(q.main))),q.light&&ve(O[$],"lightChannel",ay(cy(q.light))),q.dark&&ve(O[$],"darkChannel",ay(cy(q.dark))),q.contrastText&&ve(O[$],"contrastTextChannel",ay(cy(q.contrastText))),$==="text"&&(Vl(O[$],"primary"),Vl(O[$],"secondary")),$==="action"&&(q.active&&Vl(O[$],"active"),q.selected&&Vl(O[$],"selected")))})}),U=e.reduce((M,O)=>Ra(M,O),U);const H={prefix:s,disableCssColorScheme:i,shouldSkipGeneratingVar:o,getSelector:CMe(U)},{vars:K,generateThemeVars:x,generateStyleSheets:V}=q2e(U,H);return U.vars=K,Object.entries(U.colorSchemes[U.defaultColorScheme]).forEach(([M,O])=>{U[M]=O}),U.generateThemeVars=x,U.generateStyleSheets=V,U.generateSpacing=function(){return ore(l.spacing,P2(this))},U.getColorSchemeSelector=Y2e(a),U.spacing=U.generateSpacing(),U.shouldSkipGeneratingVar=o,U.unstable_sxConfig={...hR,...l==null?void 0:l.unstable_sxConfig},U.unstable_sx=function(O){return Hg({sx:O,theme:this})},U.toRuntimeSource=fre,U}function tz(t,e,n){t.colorSchemes&&n&&(t.colorSchemes[e]={...n!==!0&&n,palette:H2({...n===!0?{}:n.palette,mode:e})})}function RMe(t={},...e){const{palette:n,cssVariables:r=!1,colorSchemes:i=n?void 0:{light:!0},defaultColorScheme:s=n==null?void 0:n.mode,...o}=t,a=s||"light",A=i==null?void 0:i[a],l={...i,...n?{[a]:{...typeof A!="boolean"&&A,palette:n}}:void 0};if(r===!1){if(!("colorSchemes"in t))return rU(t,...e);let d=n;"palette"in t||l[a]&&(l[a]!==!0?d=l[a].palette:a==="dark"&&(d={mode:"dark"}));const f=rU({...t,palette:d},...e);return f.defaultColorScheme=a,f.colorSchemes=l,f.palette.mode==="light"&&(f.colorSchemes.light={...l.light!==!0&&l.light,palette:f.palette},tz(f,"dark",l.dark)),f.palette.mode==="dark"&&(f.colorSchemes.dark={...l.dark!==!0&&l.dark,palette:f.palette},tz(f,"light",l.light)),f}return!n&&!("light"in l)&&a==="light"&&(l.light=!0),IMe({...o,colorSchemes:l,defaultColorScheme:a,...typeof r!="boolean"&&r},...e)}const OMe=RMe(),NMe="$$material";function DMe(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}const BMe=t=>DMe(t)&&t!=="classes",LMe=N2e({themeId:NMe,defaultTheme:OMe,rootShouldForwardProp:BMe}),PMe=K2e;function UMe(t){return j2e(t)}function kMe(t){return cre("MuiSvgIcon",t)}b2e("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const xMe=t=>{const{color:e,fontSize:n,classes:r}=t,i={root:["root",e!=="inherit"&&`color${Qg(e)}`,`fontSize${Qg(n)}`]};return Oke(i,kMe,r)},MMe=LMe("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:n}=t;return[e.root,n.color!=="inherit"&&e[`color${Qg(n.color)}`],e[`fontSize${Qg(n.fontSize)}`]]}})(PMe(({theme:t})=>{var e,n,r,i,s,o,a,A,l,d,f,p,g,y;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:(i=(e=t.transitions)==null?void 0:e.create)==null?void 0:i.call(e,"fill",{duration:(r=(n=(t.vars??t).transitions)==null?void 0:n.duration)==null?void 0:r.shorter}),variants:[{props:E=>!E.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:((o=(s=t.typography)==null?void 0:s.pxToRem)==null?void 0:o.call(s,20))||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:((A=(a=t.typography)==null?void 0:a.pxToRem)==null?void 0:A.call(a,24))||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:((d=(l=t.typography)==null?void 0:l.pxToRem)==null?void 0:d.call(l,35))||"2.1875rem"}},...Object.entries((t.vars??t).palette).filter(([,E])=>E&&E.main).map(([E])=>{var w,b;return{props:{color:E},style:{color:(b=(w=(t.vars??t).palette)==null?void 0:w[E])==null?void 0:b.main}}}),{props:{color:"action"},style:{color:(p=(f=(t.vars??t).palette)==null?void 0:f.action)==null?void 0:p.active}},{props:{color:"disabled"},style:{color:(y=(g=(t.vars??t).palette)==null?void 0:g.action)==null?void 0:y.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}})),iU=J.forwardRef(function(e,n){const r=UMe({props:e,name:"MuiSvgIcon"}),{children:i,className:s,color:o="inherit",component:a="svg",fontSize:A="medium",htmlColor:l,inheritViewBox:d=!1,titleAccess:f,viewBox:p="0 0 24 24",...g}=r,y=J.isValidElement(i)&&i.type==="svg",E={...r,color:o,component:a,fontSize:A,instanceFontSize:e.fontSize,inheritViewBox:d,viewBox:p,hasSvgAsChild:y},w={};d||(w.viewBox=p);const b=xMe(E);return D.jsxs(MMe,{as:a,className:Rke(b.root,s),focusable:"false",color:l,"aria-hidden":f?void 0:!0,role:f?"img":void 0,ref:n,...w,...g,...y&&i.props,ownerState:E,children:[y?i.props.children:i,f?D.jsx("title",{children:f}):null]})});iU.muiName="SvgIcon";function FMe(t,e){function n(r,i){return D.jsx(iU,{"data-testid":void 0,ref:i,...r,children:t})}return n.muiName=iU.muiName,J.memo(J.forwardRef(n))}const VMe=FMe(D.jsx("path",{d:"M22 11h-4.17l3.24-3.24-1.41-1.42L15 11h-2V9l4.66-4.66-1.42-1.41L13 6.17V2h-2v4.17L7.76 2.93 6.34 4.34 11 9v2H9L4.34 6.34 2.93 7.76 6.17 11H2v2h4.17l-3.24 3.24 1.41 1.42L9 13h2v2l-4.66 4.66 1.42 1.41L11 17.83V22h2v-4.17l3.24 3.24 1.42-1.41L13 15v-2h2l4.66 4.66 1.41-1.42L17.83 13H22z"})),QMe=({callId:t,database:e,clientRef:n,localAudioTrackRef:r,localVideoTrackRef:i,remoteVideoContainerRef:s,channelRef:o,recordingRef:a,isMuted:A,setIsMuted:l,stopVideoState:d,setStopVideoState:f,isVideoFrozen:p,setIsVideoFrozen:g,setFreezeOverlayVisible:y,frozenFrame:E,setFrozenFrame:w,isScreenSharing:b,setIsScreenSharing:I,isRecording:B,setIsRecording:U,toggleChat:H,endCall:K,setARHandActive:x,isARHandActive:V,cursorActive:M,setCursorActive:O,onScreenShare:z})=>{const $=()=>{if(r.current){const C=!A;r.current.setMuted(C),l(C)}},q=J.useCallback(async()=>{var _e;const C=Xe(e,`videoCalls/${t}`),ee=(((_e=(await Pi(C)).val())==null?void 0:_e.stopVideo)||"stop")==="stop"?"start":"stop";await Jr(C,{stopVideo:ee}),f(ee),i.current&&(ee==="stop"?i.current.setEnabled(!1):(i.current.setEnabled(!0),i.current.play("local-player")))},[t,e,i,f]),Ue=J.useCallback(()=>{if(!s.current)return;const C=s.current.querySelector("video");if(!C)return;const L=document.createElement("canvas");L.width=C.videoWidth||640,L.height=C.videoHeight||480,L.getContext("2d").drawImage(C,0,0,L.width,L.height);const k=L.toDataURL("image/png");w(k),o.current&&Jr(o.current,{frozenFrameUrl:k})},[s,w,o]),fe=J.useCallback(async()=>{var ee;if(!o.current)return;const k=(((ee=(await Pi(o.current)).val())==null?void 0:ee.freeze)||"off")==="off"?"on":"off";await Jr(o.current,{freeze:k}),g(k==="on"),y(k==="on"),k==="on"&&!E&&Ue(),k==="off"&&w(null)},[o,E,g,y,w,Ue]),re=C=>{Jr(Xe(e,`videoCalls/${t}`),{zoom:C})},Y=async()=>{typeof z=="function"&&await z()},Z=J.useCallback(()=>{if(!s.current)return;const C=s.current.querySelector("video");if(!(!C||!C.srcObject))try{const L=new MediaRecorder(C.srcObject,{mimeType:"video/webm; codecs=vp9"}),k=[];L.ondataavailable=ee=>ee.data.size&&k.push(ee.data),L.onstop=()=>{const ee=new Blob(k,{type:"video/webm"}),_e=new FileReader;_e.onloadend=()=>Jr(Xe(e,`videoCalls/${t}/captures/${Date.now()}`),{videoUrl:_e.result,timestamp:new Date().toISOString()}),_e.readAsDataURL(ee)},L.start(),a.current=L,U(!0)}catch(L){console.error(L)}},[s,e,t,a,U]),ae=J.useCallback(()=>{a.current&&a.current.state!=="inactive"&&(a.current.stop(),a.current=null,U(!1))},[a,U]),j=J.useCallback(()=>{if(!s.current)return;const C=s.current.querySelector("video");if(!C)return;const L=document.createElement("canvas");L.width=C.videoWidth||640,L.height=C.videoHeight||480,L.getContext("2d").drawImage(C,0,0,L.width,L.height);const k=L.toDataURL("image/png");Jr(Xe(e,`videoCalls/${t}/captures/${Date.now()}`),{imageUrl:k,timestamp:new Date().toISOString()});const ee=document.createElement("a");ee.href=k,ee.download=`screenshot-${Date.now()}.png`,ee.click()},[s,e,t]);return D.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black/80 backdrop-blur-lg rounded-2xl p-3 flex justify-center items-center gap-2 z-20 border border-white/10 shadow-2xl",children:[D.jsx(Mc,{icon:A?D.jsx($Ue,{}):D.jsx(eke,{}),label:A?"Unmute":"Mute",onClick:$,isActive:!A}),D.jsx(Mc,{icon:d==="stop"?D.jsx(vke,{}):D.jsx(Eke,{}),label:d==="stop"?"Turn Video On":"Turn Video Off",onClick:q,isActive:d!=="stop"}),D.jsx(Mc,{icon:D.jsx(VMe,{}),label:p?"Unfreeze Video":"Freeze Video",onClick:fe,isActive:p}),D.jsx(Mc,{icon:D.jsx(jne,{}),label:"Zoom In",onClick:()=>re("zoomin")}),D.jsx(Mc,{icon:D.jsx(Ske,{}),label:"Zoom Out",onClick:()=>re("zoomout")}),D.jsx(Mc,{icon:D.jsx(XP,{}),label:b?"Stop Screen Share":"Share Screen",onClick:Y,isActive:b}),D.jsx(Mc,{icon:D.jsx(XUe,{}),label:"Toggle Chat",onClick:H}),D.jsx(Mc,{icon:D.jsx(Qne,{}),label:"Capture Photo",onClick:j}),D.jsx(Mc,{icon:B?D.jsx(xUe,{}):D.jsx(FUe,{className:"text-red-400"}),label:B?"Stop Recording":"Start Recording",onClick:B?ae:Z,isActive:B,variant:B?"danger":"record"}),D.jsx(Mc,{icon:D.jsx(nke,{}),label:M?"Disable Pointer":"Enable Pointer",onClick:()=>O(C=>!C),isActive:M}),D.jsx(Mc,{icon:D.jsx(oke,{}),label:"End Call",onClick:K,variant:"danger"})]})},Mc=({icon:t,label:e,onClick:n,isActive:r=!1,variant:i="default"})=>{const[s,o]=J.useState(!1),a=()=>{const A="relative flex items-center justify-center w-11 h-11 rounded-full transition-all duration-200 ease-in-out transform hover:scale-105 active:scale-95";switch(i){case"danger":return`${A} bg-red-600/90 hover:bg-red-500 text-white shadow-lg hover:shadow-red-500/30`;case"record":return`${A} ${r?"bg-red-600/90 hover:bg-red-500 text-white shadow-lg hover:shadow-red-500/30":"bg-white/10 hover:bg-white/20 text-white shadow-lg hover:shadow-white/20"}`;default:return`${A} ${r?"bg-blue-600/90 hover:bg-blue-500 text-white shadow-lg hover:shadow-blue-500/30":"bg-white/10 hover:bg-white/20 text-white shadow-lg hover:shadow-white/20"}`}};return D.jsxs("div",{className:"relative",children:[D.jsx("button",{onClick:n,className:a(),onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),"aria-label":e,children:qA.cloneElement(t,{size:20})}),s&&D.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-1.5 bg-gray-900/95 text-white text-xs rounded-lg whitespace-nowrap shadow-lg border border-white/10 backdrop-blur-sm",children:[e,D.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900/95"})]})]})};var gre={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},nz=qA.createContext&&qA.createContext(gre),HMe=["attr","size","title"];function jMe(t,e){if(t==null)return{};var n=KMe(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function KMe(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function Bb(){return Bb=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Bb.apply(this,arguments)}function rz(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Lb(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?rz(Object(n),!0).forEach(function(r){GMe(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rz(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function GMe(t,e,n){return e=WMe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function WMe(t){var e=zMe(t,"string");return typeof e=="symbol"?e:e+""}function zMe(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function _re(t){return t&&t.map((e,n)=>qA.createElement(e.tag,Lb({key:n},e.attr),_re(e.child)))}function qMe(t){return e=>qA.createElement(YMe,Bb({attr:Lb({},t.attr)},e),_re(t.child))}function YMe(t){var e=n=>{var{attr:r,size:i,title:s}=t,o=jMe(t,HMe),a=i||n.size||"1em",A;return n.className&&(A=n.className),t.className&&(A=(A?A+" ":"")+t.className),qA.createElement("svg",Bb({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,o,{className:A,style:Lb(Lb({color:t.color||n.color},n.style),t.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),s&&qA.createElement("title",null,s),t.children)};return nz!==void 0?qA.createElement(nz.Consumer,null,n=>e(n)):e(gre)}function XMe(t){return qMe({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"},child:[]}]})(t)}const JMe=({callId:t,userId:e,userName:n,onCloseChat:r})=>{const[i,s]=J.useState([]),[o,a]=J.useState(""),A=J.useRef(),l=EJ();J.useEffect(()=>{if(!t)return;const p=Xe(l,`videoCalls/${t}/chatMessages`),g=k_e(p,y=>{if(y.exists()){const E=y.val();s(w=>[...w,E])}});return()=>{g()}},[t,l]);const d=async p=>{if(p.trim())try{const g=Xe(l,`videoCalls/${t}/chatMessages`),y=ML(g),E={senderId:e,senderName:n,timestamp:Date.now(),type:"text",content:p.trim()};await Zr(y,E),a("")}catch(g){alert("Send failed: "+g.message)}},f=async p=>{const g=p.target.files[0];if(!g)return;if(!g.type.startsWith("image/")){alert("Only image files are supported without Firebase Storage.");return}const y=new FileReader;y.onload=async E=>{const w=E.target.result,b=Xe(l,`videoCalls/${t}/chatMessages`),I=ML(b),B={senderId:e,senderName:n,timestamp:Date.now(),type:"image",content:w,fileName:g.name,fileMimeType:g.type};await Zr(I,B),A.current&&(A.current.value="")},y.readAsDataURL(g)};return D.jsxs("div",{className:"absolute top-0 right-0 w-80 h-full bg-gray-700 p-4 flex flex-col shadow-lg z-30",children:[D.jsxs("div",{className:"flex justify-between items-center mb-4",children:[D.jsx("h2",{className:"text-lg font-bold text-white",children:"Chat"}),D.jsx("button",{onClick:r,className:"p-1 rounded-full hover:bg-gray-600","aria-label":"Close Chat",children:D.jsx("svg",{className:"w-5 h-5 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:D.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),D.jsx("div",{className:"flex-1 overflow-y-auto mb-2",children:i.map((p,g)=>D.jsxs("div",{className:`mb-2 p-3 rounded-xl max-w-xs ${p.senderId===e?"ml-auto bg-blue-600 text-white":"mr-auto bg-gray-600 text-white"}`,children:[D.jsx("div",{className:"text-sm font-semibold",children:p.senderName}),p.type==="text"&&D.jsx("div",{children:p.content}),p.type==="image"&&D.jsx("a",{href:p.content.startsWith("data:image")?p.content:`data:image/jpeg;base64,${p.content}`,download:p.fileName||"chat_image.jpg",target:"_blank",rel:"noopener noreferrer",children:D.jsx("img",{src:p.content.startsWith("data:image")?p.content:`data:image/jpeg;base64,${p.content}`,alt:p.fileName||"Image",className:"max-w-full rounded mt-1",onError:y=>{y.target.src="/fallback-image.png"}})}),p.type==="file"&&D.jsx("a",{href:p.content,target:"_blank",rel:"noopener noreferrer",className:"underline text-white",children:p.fileName||"Download file"}),D.jsx("div",{className:"text-xs text-gray-300 mt-1",children:new Date(p.timestamp).toLocaleString()})]},g))}),D.jsxs("div",{className:"flex items-center space-x-2",children:[D.jsx("input",{type:"text",value:o,onChange:p=>a(p.target.value),onKeyDown:p=>p.key==="Enter"&&d(o),placeholder:"Type a message...",className:"flex-1 p-2 border border-gray-500 rounded-l bg-gray-800 text-white","aria-label":"Message input"}),D.jsx("button",{onClick:()=>d(o),className:"p-2 bg-blue-500 text-white rounded-r","aria-label":"Send message",children:"Send"})]}),D.jsxs("div",{className:"mt-2",children:[D.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer text-white",children:D.jsx(XMe,{size:24})}),D.jsx("input",{id:"file-upload",type:"file",ref:A,onChange:f,className:"hidden","aria-label":"Choose file to send"})]})]})},$Me=({callId:t,database:e,agoraEngine:n,remoteVideos:r,remoteVideoContainerRef:i,uidRef:s,annotations:o,setAnnotations:a,isVideoFrozen:A,frozenFrameRef:l,frozenFrame:d})=>{const[f,p]=J.useState(!1),[g,y]=J.useState(null),E=J.useRef(null),w=J.useRef(!1),b=J.useRef(0),I=J.useRef(0);J.useEffect(()=>{n&&n.on("stream-message",(fe,re)=>{try{const Y=JSON.parse(new TextDecoder().decode(re));(Y.type==="annotation"||Y.type==="clear-annotations")&&Ue(Y)}catch(Y){console.error("Error handling stream message:",Y)}})},[n]),J.useEffect(()=>{const fe=E.current;if(!fe)return;const re=k=>x(k),Y=k=>V(k),Z=()=>M(),ae=()=>M(),j=k=>{k.preventDefault(),x(k)},C=k=>{k.preventDefault(),V(k)},L=()=>M();return f&&(fe.addEventListener("mousedown",re),fe.addEventListener("mousemove",Y),fe.addEventListener("mouseup",Z),fe.addEventListener("mouseout",ae),fe.addEventListener("touchstart",j),fe.addEventListener("touchmove",C),fe.addEventListener("touchend",L)),()=>{fe.removeEventListener("mousedown",re),fe.removeEventListener("mousemove",Y),fe.removeEventListener("mouseup",Z),fe.removeEventListener("mouseout",ae),fe.removeEventListener("touchstart",j),fe.removeEventListener("touchmove",C),fe.removeEventListener("touchend",L)}},[f]),J.useEffect(()=>{const fe=()=>{setTimeout(()=>{f&&g&&(g==="frozen"?H():U())},100)};return window.addEventListener("resize",fe),()=>window.removeEventListener("resize",fe)},[f,g]);const B=fe=>{f&&g===fe?(p(!1),y(null),K(),$()):(p(!0),y(fe),fe==="frozen"?H():U())},U=()=>{const fe=i.current,re=E.current;if(!fe||!re)return;const Y=fe.getBoundingClientRect(),Z=Math.round(Y.width),ae=Math.round(Y.height);re.width=Z,re.height=ae,re.style.position="absolute",re.style.left="50%",re.style.top="50%",re.style.transform="translate(-50%, -50%)",re.style.width=`${Z}px`,re.style.height=`${ae}px`,re.style.zIndex="30",re.style.display="block",re.style.pointerEvents="auto",re.style.backgroundColor="transparent",re.getContext("2d").clearRect(0,0,re.width,re.height)},H=()=>{const fe=l==null?void 0:l.current,re=E.current;if(!fe||!re)return;const Y=fe.getBoundingClientRect(),Z=Math.round(Y.width),ae=Math.round(Y.height);re.width=Z,re.height=ae,re.style.position="absolute",re.style.left="0",re.style.top="0",re.style.width=`${Z}px`,re.style.height=`${ae}px`,re.style.zIndex="35",re.style.display="block",re.style.pointerEvents="auto",re.style.backgroundColor="transparent",re.getContext("2d").clearRect(0,0,re.width,re.height)},K=()=>{const fe=E.current;if(!fe)return;fe.getContext("2d").clearRect(0,0,fe.width,fe.height),fe.style.display="none"},x=fe=>{if(!f)return;w.current=!0;const{offsetX:re,offsetY:Y}=O(fe);b.current=re,I.current=Y},V=fe=>{if(!w.current||!f)return;const re=E.current;if(!re)return;const Y=re.getContext("2d"),{offsetX:Z,offsetY:ae}=O(fe);Y.beginPath(),Y.moveTo(b.current,I.current),Y.lineTo(Z,ae),Y.strokeStyle="#FF0000",Y.lineWidth=3,Y.stroke(),z({fromX:b.current/re.width,fromY:I.current/re.height,toX:Z/re.width,toY:ae/re.height}),b.current=Z,I.current=ae},M=()=>{w.current=!1},O=fe=>{const re=E.current;if(!re)return{offsetX:0,offsetY:0};if(fe.type.includes("touch")){const Y=re.getBoundingClientRect(),Z=fe.touches[0]||fe.changedTouches[0];return{offsetX:Z.clientX-Y.left,offsetY:Z.clientY-Y.top}}else return{offsetX:fe.offsetX||0,offsetY:fe.offsetY||0}},z=async fe=>{try{if(!g||!n)return;const re=JSON.stringify({type:"annotation",targetUid:g,sourceUid:s.current,points:fe}),Z=new TextEncoder().encode(re);await n.sendStreamMessage(Z)}catch(re){console.error("Error sending annotation data:",re)}},$=async()=>{try{if(!n||!s.current)return;const fe=JSON.stringify({type:"clear-annotations",sourceUid:s.current}),Y=new TextEncoder().encode(fe);await n.sendStreamMessage(Y)}catch(fe){console.error("Error sending clear annotations message:",fe)}},q=fe=>{const re=o[fe]||[];if(re.length===0)return null;const Y=document.querySelector(".w-[790px].h-[480px]")||document.querySelector(".relative.w-[790px].h-[480px]");if(!Y)return null;const Z=Y.getBoundingClientRect();return D.jsx("svg",{style:{position:"absolute",left:Z.left,top:Z.top,width:Z.width,height:Z.height,pointerEvents:"none",zIndex:20},children:re.map((ae,j)=>{const C=ae.points||{},L=C.fromX*Z.width,k=C.fromY*Z.height,ee=C.toX*Z.width,_e=C.toY*Z.height;return D.jsx("line",{x1:L,y1:k,x2:ee,y2:_e,stroke:"red",strokeWidth:"3"},`anno-${fe}-${j}`)})})},Ue=fe=>{const{sourceUid:re,points:Y,type:Z}=fe;if(Z==="clear-annotations"){a(ae=>{const j={...ae};return delete j[re],j});return}Z==="annotation"&&(a(ae=>{const j={id:Date.now(),points:Y,timestamp:Date.now()};return{...ae,[re]:[...ae[re]||[],j]}}),setTimeout(()=>{a(ae=>{const j=ae[re]||[];if(j.length===0)return ae;const C=j.slice(1);return{...ae,[re]:C}})},3e3))};return D.jsxs(D.Fragment,{children:[!A&&D.jsxs(D.Fragment,{children:[D.jsx("canvas",{ref:E,className:"absolute z-30",style:{display:f?"block":"none"}}),Object.keys(r).map(fe=>D.jsxs("div",{className:"relative w-full h-full flex justify-center items-center",children:[D.jsx("div",{className:`absolute bottom-3 right-3 p-2 rounded-full ${f&&g===fe?"bg-red-600":"bg-blue-600"} z-40`,children:D.jsx(DW,{size:24,className:"cursor-pointer text-white",onClick:()=>B(fe)})}),D.jsx("div",{id:`player-${fe}`,className:"absolute inset-0 w-full h-full"}),q(fe)]},fe))]}),A&&d&&D.jsxs("div",{className:"absolute inset-0 z-20 pointer-events-none flex items-center justify-center",style:{userSelect:"none",touchAction:"none"},ref:l,children:[D.jsx("img",{src:typeof d=="string"?d:"",alt:"Frozen Frame",style:{width:"100%",height:"100%",objectFit:"cover",position:"absolute",top:0,left:0,pointerEvents:"none",zIndex:30},draggable:!1}),D.jsx("canvas",{ref:E,className:"absolute",style:{display:f&&g==="frozen"?"block":"none",pointerEvents:f&&g==="frozen"?"auto":"none",zIndex:35}}),D.jsx("div",{className:`absolute bottom-3 right-3 p-2 rounded-full ${f&&g==="frozen"?"bg-red-600":"bg-blue-600"} cursor-pointer shadow-lg`,style:{pointerEvents:"auto",zIndex:50},onClick:fe=>{fe.stopPropagation(),B("frozen")},title:"Toggle Annotation on Frozen Frame",children:D.jsx(DW,{size:24,className:"text-white"})})]}),f&&D.jsxs("div",{className:"absolute top-20 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-4 py-2 rounded-md shadow-lg z-50",children:["Annotation Mode: Drawing on ",g?`User ${g}`:"Remote Video"]})]})},ZMe=({waitingUsers:t,admitUser:e,denyUser:n,admitAll:r,denyAll:i})=>!t||t.length===0?D.jsxs("div",{className:"p-4 text-center bg-gray-800 rounded-lg shadow-lg border border-gray-700",children:[D.jsx(Hy,{className:"mx-auto text-gray-400 mb-2",size:24}),D.jsx("p",{className:"text-gray-400",children:"No users waiting to join"})]}):D.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 overflow-hidden",children:[D.jsxs("div",{className:"bg-gray-700 px-4 py-3 flex justify-between items-center",children:[D.jsxs("div",{className:"flex items-center",children:[D.jsx(Hy,{className:"text-blue-400 mr-2",size:20}),D.jsx("h3",{className:"font-semibold text-white",children:"Waiting Room"}),D.jsx("span",{className:"ml-2 bg-blue-600 text-white text-xs px-2 py-1 rounded-full",children:t.length})]}),D.jsxs("div",{className:"flex space-x-2",children:[D.jsxs("button",{onClick:r,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-sm flex items-center",children:[D.jsx(BW,{size:16,className:"mr-1"}),"Admit All"]}),D.jsxs("button",{onClick:i,className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md text-sm flex items-center",children:[D.jsx(Ob,{size:16,className:"mr-1"}),"Deny All"]})]})]}),D.jsx("div",{className:"max-h-60 overflow-y-auto",children:t.map(s=>D.jsxs("div",{className:"border-b border-gray-700 px-4 py-3 flex justify-between items-center",children:[D.jsx("div",{children:D.jsxs("div",{className:"flex items-center",children:[D.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold mr-3",children:(s.name||s.id).charAt(0).toUpperCase()}),D.jsxs("div",{children:[D.jsx("p",{className:"font-medium text-white",children:s.name||`User ${s.id.substring(0,6)}`}),D.jsxs("div",{className:"flex items-center text-xs text-gray-400",children:[D.jsx(Hne,{size:12,className:"mr-1"}),D.jsxs("span",{children:["Waiting for ",Math.floor((Date.now()-s.joinTime)/6e4)," min"]})]})]})]})}),D.jsxs("div",{className:"flex space-x-2",children:[D.jsx("button",{onClick:()=>e(s.id),className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded-full","aria-label":"Admit user",children:D.jsx(BW,{size:16})}),D.jsx("button",{onClick:()=>n(s.id),className:"bg-red-600 hover:bg-red-700 text-white p-2 rounded-full","aria-label":"Deny user",children:D.jsx(Ob,{size:16})})]})]},s.id))})]});/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var sU=function(t,e){return sU=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},sU(t,e)};function iA(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");sU(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var oU=function(){return oU=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},oU.apply(this,arguments)};function So(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{l(r.next(d))}catch(f){o(f)}}function A(d){try{l(r.throw(d))}catch(f){o(f)}}function l(d){d.done?s(d.value):i(d.value).then(a,A)}l((r=r.apply(t,[])).next())})}function io(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(d){return A([l,d])}}function A(l){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return n.label++,{value:l[1],done:!1};case 5:n.label++,i=l[1],l=[0];continue;case 7:l=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){n=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){n.label=l[1];break}if(l[0]===6&&n.label<s[1]){n.label=s[1],s=l;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(l);break}s[2]&&n.ops.pop(),n.trys.pop();continue}l=e.call(t,n)}catch(d){l=[6,d],i=0}finally{r=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function $T(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||e)}var _u=function(){function t(e,n,r,i){this.left=e,this.top=n,this.width=r,this.height=i}return t.prototype.add=function(e,n,r,i){return new t(this.left+e,this.top+n,this.width+r,this.height+i)},t.fromClientRect=function(e,n){return new t(n.left+e.windowBounds.left,n.top+e.windowBounds.top,n.width,n.height)},t.fromDOMRectList=function(e,n){var r=Array.from(n).find(function(i){return i.width!==0});return r?new t(r.left+e.windowBounds.left,r.top+e.windowBounds.top,r.width,r.height):t.EMPTY},t.EMPTY=new t(0,0,0,0),t}(),_R=function(t,e){return _u.fromClientRect(t,e.getBoundingClientRect())},eFe=function(t){var e=t.body,n=t.documentElement;if(!e||!n)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,n.scrollWidth),Math.max(e.offsetWidth,n.offsetWidth),Math.max(e.clientWidth,n.clientWidth)),i=Math.max(Math.max(e.scrollHeight,n.scrollHeight),Math.max(e.offsetHeight,n.offsetHeight),Math.max(e.clientHeight,n.clientHeight));return new _u(0,0,r,i)},ER=function(t){for(var e=[],n=0,r=t.length;n<r;){var i=t.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var s=t.charCodeAt(n++);(s&64512)===56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),n--)}else e.push(i)}return e},Li=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var n=t.length;if(!n)return"";for(var r=[],i=-1,s="";++i<n;){var o=t[i];o<=65535?r.push(o):(o-=65536,r.push((o>>10)+55296,o%1024+56320)),(i+1===n||r.length>16384)&&(s+=String.fromCharCode.apply(String,r),r.length=0)}return s},iz="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tFe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var ZT=0;ZT<iz.length;ZT++)tFe[iz.charCodeAt(ZT)]=ZT;var sz="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ay=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var e0=0;e0<sz.length;e0++)Ay[sz.charCodeAt(e0)]=e0;var nFe=function(t){var e=t.length*.75,n=t.length,r,i=0,s,o,a,A;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);var l=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),d=Array.isArray(l)?l:new Uint8Array(l);for(r=0;r<n;r+=4)s=Ay[t.charCodeAt(r)],o=Ay[t.charCodeAt(r+1)],a=Ay[t.charCodeAt(r+2)],A=Ay[t.charCodeAt(r+3)],d[i++]=s<<2|o>>4,d[i++]=(o&15)<<4|a>>2,d[i++]=(a&3)<<6|A&63;return l},rFe=function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n.push(t[r+1]<<8|t[r]);return n},iFe=function(t){for(var e=t.length,n=[],r=0;r<e;r+=4)n.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return n},Nf=5,j2=11,S1=2,sFe=j2-Nf,Ere=65536>>Nf,oFe=1<<Nf,b1=oFe-1,aFe=1024>>Nf,cFe=Ere+aFe,AFe=cFe,lFe=32,uFe=AFe+lFe,dFe=65536>>j2,hFe=1<<sFe,fFe=hFe-1,oz=function(t,e,n){return t.slice?t.slice(e,n):new Uint16Array(Array.prototype.slice.call(t,e,n))},pFe=function(t,e,n){return t.slice?t.slice(e,n):new Uint32Array(Array.prototype.slice.call(t,e,n))},mFe=function(t,e){var n=nFe(t),r=Array.isArray(n)?iFe(n):new Uint32Array(n),i=Array.isArray(n)?rFe(n):new Uint16Array(n),s=24,o=oz(i,s/2,r[4]/2),a=r[5]===2?oz(i,(s+r[4])/2):pFe(r,Math.ceil((s+r[4])/4));return new gFe(r[0],r[1],r[2],r[3],o,a)},gFe=function(){function t(e,n,r,i,s,o){this.initialValue=e,this.errorValue=n,this.highStart=r,this.highValueIndex=i,this.index=s,this.data=o}return t.prototype.get=function(e){var n;if(e>=0){if(e<55296||e>56319&&e<=65535)return n=this.index[e>>Nf],n=(n<<S1)+(e&b1),this.data[n];if(e<=65535)return n=this.index[Ere+(e-55296>>Nf)],n=(n<<S1)+(e&b1),this.data[n];if(e<this.highStart)return n=uFe-dFe+(e>>j2),n=this.index[n],n+=e>>Nf&fFe,n=this.index[n],n=(n<<S1)+(e&b1),this.data[n];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),az="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_Fe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var t0=0;t0<az.length;t0++)_Fe[az.charCodeAt(t0)]=t0;var EFe="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",cz=50,yFe=1,yre=2,vre=3,vFe=4,wFe=5,Az=7,wre=8,lz=9,Od=10,aU=11,uz=12,cU=13,CFe=14,ly=15,AU=16,n0=17,QE=18,TFe=19,dz=20,lU=21,HE=22,I1=23,um=24,ga=25,uy=26,dy=27,dm=28,SFe=29,Af=30,bFe=31,r0=32,i0=33,uU=34,dU=35,hU=36,Qv=37,fU=38,hS=39,fS=40,R1=41,Cre=42,IFe=43,RFe=[9001,65288],Tre="!",gn="",s0="",pU=mFe(EFe),Ql=[Af,hU],mU=[yFe,yre,vre,wFe],Sre=[Od,wre],hz=[dy,uy],OFe=mU.concat(Sre),fz=[fU,hS,fS,uU,dU],NFe=[ly,cU],DFe=function(t,e){e===void 0&&(e="strict");var n=[],r=[],i=[];return t.forEach(function(s,o){var a=pU.get(s);if(a>cz?(i.push(!0),a-=cz):i.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(s)!==-1)return r.push(o),n.push(AU);if(a===vFe||a===aU){if(o===0)return r.push(o),n.push(Af);var A=n[o-1];return OFe.indexOf(A)===-1?(r.push(r[o-1]),n.push(A)):(r.push(o),n.push(Af))}if(r.push(o),a===bFe)return n.push(e==="strict"?lU:Qv);if(a===Cre||a===SFe)return n.push(Af);if(a===IFe)return s>=131072&&s<=196605||s>=196608&&s<=262141?n.push(Qv):n.push(Af);n.push(a)}),[r,n,i]},O1=function(t,e,n,r){var i=r[n];if(Array.isArray(t)?t.indexOf(i)!==-1:t===i)for(var s=n;s<=r.length;){s++;var o=r[s];if(o===e)return!0;if(o!==Od)break}if(i===Od)for(var s=n;s>0;){s--;var a=r[s];if(Array.isArray(t)?t.indexOf(a)!==-1:t===a)for(var A=n;A<=r.length;){A++;var o=r[A];if(o===e)return!0;if(o!==Od)break}if(a!==Od)break}return!1},pz=function(t,e){for(var n=t;n>=0;){var r=e[n];if(r===Od)n--;else return r}return 0},BFe=function(t,e,n,r,i){if(n[r]===0)return gn;var s=r-1;if(Array.isArray(i)&&i[s]===!0)return gn;var o=s-1,a=s+1,A=e[s],l=o>=0?e[o]:0,d=e[a];if(A===yre&&d===vre)return gn;if(mU.indexOf(A)!==-1)return Tre;if(mU.indexOf(d)!==-1||Sre.indexOf(d)!==-1)return gn;if(pz(s,e)===wre)return s0;if(pU.get(t[s])===aU||(A===r0||A===i0)&&pU.get(t[a])===aU||A===Az||d===Az||A===lz||[Od,cU,ly].indexOf(A)===-1&&d===lz||[n0,QE,TFe,um,dm].indexOf(d)!==-1||pz(s,e)===HE||O1(I1,HE,s,e)||O1([n0,QE],lU,s,e)||O1(uz,uz,s,e))return gn;if(A===Od)return s0;if(A===I1||d===I1)return gn;if(d===AU||A===AU)return s0;if([cU,ly,lU].indexOf(d)!==-1||A===CFe||l===hU&&NFe.indexOf(A)!==-1||A===dm&&d===hU||d===dz||Ql.indexOf(d)!==-1&&A===ga||Ql.indexOf(A)!==-1&&d===ga||A===dy&&[Qv,r0,i0].indexOf(d)!==-1||[Qv,r0,i0].indexOf(A)!==-1&&d===uy||Ql.indexOf(A)!==-1&&hz.indexOf(d)!==-1||hz.indexOf(A)!==-1&&Ql.indexOf(d)!==-1||[dy,uy].indexOf(A)!==-1&&(d===ga||[HE,ly].indexOf(d)!==-1&&e[a+1]===ga)||[HE,ly].indexOf(A)!==-1&&d===ga||A===ga&&[ga,dm,um].indexOf(d)!==-1)return gn;if([ga,dm,um,n0,QE].indexOf(d)!==-1)for(var f=s;f>=0;){var p=e[f];if(p===ga)return gn;if([dm,um].indexOf(p)!==-1)f--;else break}if([dy,uy].indexOf(d)!==-1)for(var f=[n0,QE].indexOf(A)!==-1?o:s;f>=0;){var p=e[f];if(p===ga)return gn;if([dm,um].indexOf(p)!==-1)f--;else break}if(fU===A&&[fU,hS,uU,dU].indexOf(d)!==-1||[hS,uU].indexOf(A)!==-1&&[hS,fS].indexOf(d)!==-1||[fS,dU].indexOf(A)!==-1&&d===fS||fz.indexOf(A)!==-1&&[dz,uy].indexOf(d)!==-1||fz.indexOf(d)!==-1&&A===dy||Ql.indexOf(A)!==-1&&Ql.indexOf(d)!==-1||A===um&&Ql.indexOf(d)!==-1||Ql.concat(ga).indexOf(A)!==-1&&d===HE&&RFe.indexOf(t[a])===-1||Ql.concat(ga).indexOf(d)!==-1&&A===QE)return gn;if(A===R1&&d===R1){for(var g=n[s],y=1;g>0&&(g--,e[g]===R1);)y++;if(y%2!==0)return gn}return A===r0&&d===i0?gn:s0},LFe=function(t,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var n=DFe(t,e.lineBreak),r=n[0],i=n[1],s=n[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(i=i.map(function(a){return[ga,Af,Cre].indexOf(a)!==-1?Qv:a}));var o=e.wordBreak==="keep-all"?s.map(function(a,A){return a&&t[A]>=19968&&t[A]<=40959}):void 0;return[r,i,o]},PFe=function(){function t(e,n,r,i){this.codePoints=e,this.required=n===Tre,this.start=r,this.end=i}return t.prototype.slice=function(){return Li.apply(void 0,this.codePoints.slice(this.start,this.end))},t}(),UFe=function(t,e){var n=ER(t),r=LFe(n,e),i=r[0],s=r[1],o=r[2],a=n.length,A=0,l=0;return{next:function(){if(l>=a)return{done:!0,value:null};for(var d=gn;l<a&&(d=BFe(n,s,i,++l,o))===gn;);if(d!==gn||l===a){var f=new PFe(n,d,A,l);return A=l,{value:f,done:!1}}return{done:!0,value:null}}}},kFe=1,xFe=2,Iw=4,mz=8,Pb=10,gz=47,Ky=92,MFe=9,FFe=32,o0=34,jE=61,VFe=35,QFe=36,HFe=37,a0=39,c0=40,KE=41,jFe=95,Go=45,KFe=33,GFe=60,WFe=62,zFe=64,qFe=91,YFe=93,XFe=61,JFe=123,A0=63,$Fe=125,_z=124,ZFe=126,eVe=128,Ez=65533,N1=42,vf=43,tVe=44,nVe=58,rVe=59,Hv=46,iVe=0,sVe=8,oVe=11,aVe=14,cVe=31,AVe=127,PA=-1,bre=48,Ire=97,Rre=101,lVe=102,uVe=117,dVe=122,Ore=65,Nre=69,Dre=70,hVe=85,fVe=90,ao=function(t){return t>=bre&&t<=57},pVe=function(t){return t>=55296&&t<=57343},hm=function(t){return ao(t)||t>=Ore&&t<=Dre||t>=Ire&&t<=lVe},mVe=function(t){return t>=Ire&&t<=dVe},gVe=function(t){return t>=Ore&&t<=fVe},_Ve=function(t){return mVe(t)||gVe(t)},EVe=function(t){return t>=eVe},l0=function(t){return t===Pb||t===MFe||t===FFe},Ub=function(t){return _Ve(t)||EVe(t)||t===jFe},yz=function(t){return Ub(t)||ao(t)||t===Go},yVe=function(t){return t>=iVe&&t<=sVe||t===oVe||t>=aVe&&t<=cVe||t===AVe},ud=function(t,e){return t!==Ky?!1:e!==Pb},u0=function(t,e,n){return t===Go?Ub(e)||ud(e,n):Ub(t)?!0:!!(t===Ky&&ud(t,e))},D1=function(t,e,n){return t===vf||t===Go?ao(e)?!0:e===Hv&&ao(n):ao(t===Hv?e:t)},vVe=function(t){var e=0,n=1;(t[e]===vf||t[e]===Go)&&(t[e]===Go&&(n=-1),e++);for(var r=[];ao(t[e]);)r.push(t[e++]);var i=r.length?parseInt(Li.apply(void 0,r),10):0;t[e]===Hv&&e++;for(var s=[];ao(t[e]);)s.push(t[e++]);var o=s.length,a=o?parseInt(Li.apply(void 0,s),10):0;(t[e]===Nre||t[e]===Rre)&&e++;var A=1;(t[e]===vf||t[e]===Go)&&(t[e]===Go&&(A=-1),e++);for(var l=[];ao(t[e]);)l.push(t[e++]);var d=l.length?parseInt(Li.apply(void 0,l),10):0;return n*(i+a*Math.pow(10,-o))*Math.pow(10,A*d)},wVe={type:2},CVe={type:3},TVe={type:4},SVe={type:13},bVe={type:8},IVe={type:21},RVe={type:9},OVe={type:10},NVe={type:11},DVe={type:12},BVe={type:14},d0={type:23},LVe={type:1},PVe={type:25},UVe={type:24},kVe={type:26},xVe={type:27},MVe={type:28},FVe={type:29},VVe={type:31},gU={type:32},Bre=function(){function t(){this._value=[]}return t.prototype.write=function(e){this._value=this._value.concat(ER(e))},t.prototype.read=function(){for(var e=[],n=this.consumeToken();n!==gU;)e.push(n),n=this.consumeToken();return e},t.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case o0:return this.consumeStringToken(o0);case VFe:var n=this.peekCodePoint(0),r=this.peekCodePoint(1),i=this.peekCodePoint(2);if(yz(n)||ud(r,i)){var s=u0(n,r,i)?xFe:kFe,o=this.consumeName();return{type:5,value:o,flags:s}}break;case QFe:if(this.peekCodePoint(0)===jE)return this.consumeCodePoint(),SVe;break;case a0:return this.consumeStringToken(a0);case c0:return wVe;case KE:return CVe;case N1:if(this.peekCodePoint(0)===jE)return this.consumeCodePoint(),BVe;break;case vf:if(D1(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case tVe:return TVe;case Go:var a=e,A=this.peekCodePoint(0),l=this.peekCodePoint(1);if(D1(a,A,l))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(u0(a,A,l))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(A===Go&&l===WFe)return this.consumeCodePoint(),this.consumeCodePoint(),UVe;break;case Hv:if(D1(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case gz:if(this.peekCodePoint(0)===N1)for(this.consumeCodePoint();;){var d=this.consumeCodePoint();if(d===N1&&(d=this.consumeCodePoint(),d===gz))return this.consumeToken();if(d===PA)return this.consumeToken()}break;case nVe:return kVe;case rVe:return xVe;case GFe:if(this.peekCodePoint(0)===KFe&&this.peekCodePoint(1)===Go&&this.peekCodePoint(2)===Go)return this.consumeCodePoint(),this.consumeCodePoint(),PVe;break;case zFe:var f=this.peekCodePoint(0),p=this.peekCodePoint(1),g=this.peekCodePoint(2);if(u0(f,p,g)){var o=this.consumeName();return{type:7,value:o}}break;case qFe:return MVe;case Ky:if(ud(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case YFe:return FVe;case XFe:if(this.peekCodePoint(0)===jE)return this.consumeCodePoint(),bVe;break;case JFe:return NVe;case $Fe:return DVe;case uVe:case hVe:var y=this.peekCodePoint(0),E=this.peekCodePoint(1);return y===vf&&(hm(E)||E===A0)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case _z:if(this.peekCodePoint(0)===jE)return this.consumeCodePoint(),RVe;if(this.peekCodePoint(0)===_z)return this.consumeCodePoint(),IVe;break;case ZFe:if(this.peekCodePoint(0)===jE)return this.consumeCodePoint(),OVe;break;case PA:return gU}return l0(e)?(this.consumeWhiteSpace(),VVe):ao(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):Ub(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:Li(e)}},t.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},t.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},t.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},t.prototype.consumeUnicodeRangeToken=function(){for(var e=[],n=this.consumeCodePoint();hm(n)&&e.length<6;)e.push(n),n=this.consumeCodePoint();for(var r=!1;n===A0&&e.length<6;)e.push(n),n=this.consumeCodePoint(),r=!0;if(r){var i=parseInt(Li.apply(void 0,e.map(function(A){return A===A0?bre:A})),16),s=parseInt(Li.apply(void 0,e.map(function(A){return A===A0?Dre:A})),16);return{type:30,start:i,end:s}}var o=parseInt(Li.apply(void 0,e),16);if(this.peekCodePoint(0)===Go&&hm(this.peekCodePoint(1))){this.consumeCodePoint(),n=this.consumeCodePoint();for(var a=[];hm(n)&&a.length<6;)a.push(n),n=this.consumeCodePoint();var s=parseInt(Li.apply(void 0,a),16);return{type:30,start:o,end:s}}else return{type:30,start:o,end:o}},t.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===c0?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===c0?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},t.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===PA)return{type:22,value:""};var n=this.peekCodePoint(0);if(n===a0||n===o0){var r=this.consumeStringToken(this.consumeCodePoint());return r.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===PA||this.peekCodePoint(0)===KE)?(this.consumeCodePoint(),{type:22,value:r.value}):(this.consumeBadUrlRemnants(),d0)}for(;;){var i=this.consumeCodePoint();if(i===PA||i===KE)return{type:22,value:Li.apply(void 0,e)};if(l0(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===PA||this.peekCodePoint(0)===KE?(this.consumeCodePoint(),{type:22,value:Li.apply(void 0,e)}):(this.consumeBadUrlRemnants(),d0);if(i===o0||i===a0||i===c0||yVe(i))return this.consumeBadUrlRemnants(),d0;if(i===Ky)if(ud(i,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),d0;else e.push(i)}},t.prototype.consumeWhiteSpace=function(){for(;l0(this.peekCodePoint(0));)this.consumeCodePoint()},t.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===KE||e===PA)return;ud(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},t.prototype.consumeStringSlice=function(e){for(var n=5e4,r="";e>0;){var i=Math.min(n,e);r+=Li.apply(void 0,this._value.splice(0,i)),e-=i}return this._value.shift(),r},t.prototype.consumeStringToken=function(e){var n="",r=0;do{var i=this._value[r];if(i===PA||i===void 0||i===e)return n+=this.consumeStringSlice(r),{type:0,value:n};if(i===Pb)return this._value.splice(0,r),LVe;if(i===Ky){var s=this._value[r+1];s!==PA&&s!==void 0&&(s===Pb?(n+=this.consumeStringSlice(r),r=-1,this._value.shift()):ud(i,s)&&(n+=this.consumeStringSlice(r),n+=Li(this.consumeEscapedCodePoint()),r=-1))}r++}while(!0)},t.prototype.consumeNumber=function(){var e=[],n=Iw,r=this.peekCodePoint(0);for((r===vf||r===Go)&&e.push(this.consumeCodePoint());ao(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(r===Hv&&ao(i))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),n=mz;ao(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0),i=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((r===Nre||r===Rre)&&((i===vf||i===Go)&&ao(s)||ao(i)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),n=mz;ao(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[vVe(e),n]},t.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),n=e[0],r=e[1],i=this.peekCodePoint(0),s=this.peekCodePoint(1),o=this.peekCodePoint(2);if(u0(i,s,o)){var a=this.consumeName();return{type:15,number:n,flags:r,unit:a}}return i===HFe?(this.consumeCodePoint(),{type:16,number:n,flags:r}):{type:17,number:n,flags:r}},t.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(hm(e)){for(var n=Li(e);hm(this.peekCodePoint(0))&&n.length<6;)n+=Li(this.consumeCodePoint());l0(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(n,16);return r===0||pVe(r)||r>1114111?Ez:r}return e===PA?Ez:e},t.prototype.consumeName=function(){for(var e="";;){var n=this.consumeCodePoint();if(yz(n))e+=Li(n);else if(ud(n,this.peekCodePoint(0)))e+=Li(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(n),e}},t}(),Lre=function(){function t(e){this._tokens=e}return t.create=function(e){var n=new Bre;return n.write(e),new t(n.read())},t.parseValue=function(e){return t.create(e).parseComponentValue()},t.parseValues=function(e){return t.create(e).parseComponentValues()},t.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var n=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return n;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},t.prototype.parseComponentValues=function(){for(var e=[];;){var n=this.consumeComponentValue();if(n.type===32)return e;e.push(n),e.push()}},t.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},t.prototype.consumeSimpleBlock=function(e){for(var n={type:e,values:[]},r=this.consumeToken();;){if(r.type===32||HVe(r,e))return n;this.reconsumeToken(r),n.values.push(this.consumeComponentValue()),r=this.consumeToken()}},t.prototype.consumeFunction=function(e){for(var n={name:e.value,values:[],type:18};;){var r=this.consumeToken();if(r.type===32||r.type===3)return n;this.reconsumeToken(r),n.values.push(this.consumeComponentValue())}},t.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?gU:e},t.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},t}(),Rw=function(t){return t.type===15},w_=function(t){return t.type===17},pr=function(t){return t.type===20},QVe=function(t){return t.type===0},_U=function(t,e){return pr(t)&&t.value===e},Pre=function(t){return t.type!==31},Kg=function(t){return t.type!==31&&t.type!==4},hl=function(t){var e=[],n=[];return t.forEach(function(r){if(r.type===4){if(n.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(n),n=[];return}r.type!==31&&n.push(r)}),n.length&&e.push(n),e},HVe=function(t,e){return e===11&&t.type===12||e===28&&t.type===29?!0:e===2&&t.type===3},oh=function(t){return t.type===17||t.type===15},qi=function(t){return t.type===16||oh(t)},Ure=function(t){return t.length>1?[t[0],t[1]]:[t[0]]},qs={type:17,number:0,flags:Iw},K2={type:16,number:50,flags:Iw},Nd={type:16,number:100,flags:Iw},hy=function(t,e,n){var r=t[0],i=t[1];return[Dr(r,e),Dr(typeof i<"u"?i:r,n)]},Dr=function(t,e){if(t.type===16)return t.number/100*e;if(Rw(t))switch(t.unit){case"rem":case"em":return 16*t.number;case"px":default:return t.number}return t.number},kre="deg",xre="grad",Mre="rad",Fre="turn",yR={name:"angle",parse:function(t,e){if(e.type===15)switch(e.unit){case kre:return Math.PI*e.number/180;case xre:return Math.PI/200*e.number;case Mre:return e.number;case Fre:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},Vre=function(t){return t.type===15&&(t.unit===kre||t.unit===xre||t.unit===Mre||t.unit===Fre)},Qre=function(t){var e=t.filter(pr).map(function(n){return n.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[qs,qs];case"to top":case"bottom":return pc(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[qs,Nd];case"to right":case"left":return pc(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Nd,Nd];case"to bottom":case"top":return pc(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Nd,qs];case"to left":case"right":return pc(270)}return 0},pc=function(t){return Math.PI*t/180},Kd={name:"color",parse:function(t,e){if(e.type===18){var n=jVe[e.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return n(t,e.values)}if(e.type===5){if(e.value.length===3){var r=e.value.substring(0,1),i=e.value.substring(1,2),s=e.value.substring(2,3);return Dd(parseInt(r+r,16),parseInt(i+i,16),parseInt(s+s,16),1)}if(e.value.length===4){var r=e.value.substring(0,1),i=e.value.substring(1,2),s=e.value.substring(2,3),o=e.value.substring(3,4);return Dd(parseInt(r+r,16),parseInt(i+i,16),parseInt(s+s,16),parseInt(o+o,16)/255)}if(e.value.length===6){var r=e.value.substring(0,2),i=e.value.substring(2,4),s=e.value.substring(4,6);return Dd(parseInt(r,16),parseInt(i,16),parseInt(s,16),1)}if(e.value.length===8){var r=e.value.substring(0,2),i=e.value.substring(2,4),s=e.value.substring(4,6),o=e.value.substring(6,8);return Dd(parseInt(r,16),parseInt(i,16),parseInt(s,16),parseInt(o,16)/255)}}if(e.type===20){var a=cu[e.value.toUpperCase()];if(typeof a<"u")return a}return cu.TRANSPARENT}},Gd=function(t){return(255&t)===0},Es=function(t){var e=255&t,n=255&t>>8,r=255&t>>16,i=255&t>>24;return e<255?"rgba("+i+","+r+","+n+","+e/255+")":"rgb("+i+","+r+","+n+")"},Dd=function(t,e,n,r){return(t<<24|e<<16|n<<8|Math.round(r*255)<<0)>>>0},vz=function(t,e){if(t.type===17)return t.number;if(t.type===16){var n=e===3?1:255;return e===3?t.number/100*n:Math.round(t.number/100*n)}return 0},wz=function(t,e){var n=e.filter(Kg);if(n.length===3){var r=n.map(vz),i=r[0],s=r[1],o=r[2];return Dd(i,s,o,1)}if(n.length===4){var a=n.map(vz),i=a[0],s=a[1],o=a[2],A=a[3];return Dd(i,s,o,A)}return 0};function B1(t,e,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(e-t)*n*6+t:n<1/2?e:n<2/3?(e-t)*6*(2/3-n)+t:t}var Cz=function(t,e){var n=e.filter(Kg),r=n[0],i=n[1],s=n[2],o=n[3],a=(r.type===17?pc(r.number):yR.parse(t,r))/(Math.PI*2),A=qi(i)?i.number/100:0,l=qi(s)?s.number/100:0,d=typeof o<"u"&&qi(o)?Dr(o,1):1;if(A===0)return Dd(l*255,l*255,l*255,1);var f=l<=.5?l*(A+1):l+A-l*A,p=l*2-f,g=B1(p,f,a+1/3),y=B1(p,f,a),E=B1(p,f,a-1/3);return Dd(g*255,y*255,E*255,d)},jVe={hsl:Cz,hsla:Cz,rgb:wz,rgba:wz},Gy=function(t,e){return Kd.parse(t,Lre.create(e).parseComponentValue())},cu={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},KVe={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map(function(n){if(pr(n))switch(n.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},GVe={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},vR=function(t,e){var n=Kd.parse(t,e[0]),r=e[1];return r&&qi(r)?{color:n,stop:r}:{color:n,stop:null}},Tz=function(t,e){var n=t[0],r=t[t.length-1];n.stop===null&&(n.stop=qs),r.stop===null&&(r.stop=Nd);for(var i=[],s=0,o=0;o<t.length;o++){var a=t[o].stop;if(a!==null){var A=Dr(a,e);A>s?i.push(A):i.push(s),s=A}else i.push(null)}for(var l=null,o=0;o<i.length;o++){var d=i[o];if(d===null)l===null&&(l=o);else if(l!==null){for(var f=o-l,p=i[l-1],g=(d-p)/(f+1),y=1;y<=f;y++)i[l+y-1]=g*y;l=null}}return t.map(function(E,w){var b=E.color;return{color:b,stop:Math.max(Math.min(1,i[w]/e),0)}})},WVe=function(t,e,n){var r=e/2,i=n/2,s=Dr(t[0],e)-r,o=i-Dr(t[1],n);return(Math.atan2(o,s)+Math.PI*2)%(Math.PI*2)},zVe=function(t,e,n){var r=typeof t=="number"?t:WVe(t,e,n),i=Math.abs(e*Math.sin(r))+Math.abs(n*Math.cos(r)),s=e/2,o=n/2,a=i/2,A=Math.sin(r-Math.PI/2)*a,l=Math.cos(r-Math.PI/2)*a;return[i,s-l,s+l,o-A,o+A]},Vc=function(t,e){return Math.sqrt(t*t+e*e)},Sz=function(t,e,n,r,i){var s=[[0,0],[0,e],[t,0],[t,e]];return s.reduce(function(o,a){var A=a[0],l=a[1],d=Vc(n-A,r-l);return(i?d<o.optimumDistance:d>o.optimumDistance)?{optimumCorner:a,optimumDistance:d}:o},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},qVe=function(t,e,n,r,i){var s=0,o=0;switch(t.size){case 0:t.shape===0?s=o=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(n),Math.abs(n-i)):t.shape===1&&(s=Math.min(Math.abs(e),Math.abs(e-r)),o=Math.min(Math.abs(n),Math.abs(n-i)));break;case 2:if(t.shape===0)s=o=Math.min(Vc(e,n),Vc(e,n-i),Vc(e-r,n),Vc(e-r,n-i));else if(t.shape===1){var a=Math.min(Math.abs(n),Math.abs(n-i))/Math.min(Math.abs(e),Math.abs(e-r)),A=Sz(r,i,e,n,!0),l=A[0],d=A[1];s=Vc(l-e,(d-n)/a),o=a*s}break;case 1:t.shape===0?s=o=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(n),Math.abs(n-i)):t.shape===1&&(s=Math.max(Math.abs(e),Math.abs(e-r)),o=Math.max(Math.abs(n),Math.abs(n-i)));break;case 3:if(t.shape===0)s=o=Math.max(Vc(e,n),Vc(e,n-i),Vc(e-r,n),Vc(e-r,n-i));else if(t.shape===1){var a=Math.max(Math.abs(n),Math.abs(n-i))/Math.max(Math.abs(e),Math.abs(e-r)),f=Sz(r,i,e,n,!1),l=f[0],d=f[1];s=Vc(l-e,(d-n)/a),o=a*s}break}return Array.isArray(t.size)&&(s=Dr(t.size[0],r),o=t.size.length===2?Dr(t.size[1],i):s),[s,o]},YVe=function(t,e){var n=pc(180),r=[];return hl(e).forEach(function(i,s){if(s===0){var o=i[0];if(o.type===20&&o.value==="to"){n=Qre(i);return}else if(Vre(o)){n=yR.parse(t,o);return}}var a=vR(t,i);r.push(a)}),{angle:n,stops:r,type:1}},h0=function(t,e){var n=pc(180),r=[];return hl(e).forEach(function(i,s){if(s===0){var o=i[0];if(o.type===20&&["top","left","right","bottom"].indexOf(o.value)!==-1){n=Qre(i);return}else if(Vre(o)){n=(yR.parse(t,o)+pc(270))%pc(360);return}}var a=vR(t,i);r.push(a)}),{angle:n,stops:r,type:1}},XVe=function(t,e){var n=pc(180),r=[],i=1,s=0,o=3,a=[];return hl(e).forEach(function(A,l){var d=A[0];if(l===0){if(pr(d)&&d.value==="linear"){i=1;return}else if(pr(d)&&d.value==="radial"){i=2;return}}if(d.type===18){if(d.name==="from"){var f=Kd.parse(t,d.values[0]);r.push({stop:qs,color:f})}else if(d.name==="to"){var f=Kd.parse(t,d.values[0]);r.push({stop:Nd,color:f})}else if(d.name==="color-stop"){var p=d.values.filter(Kg);if(p.length===2){var f=Kd.parse(t,p[1]),g=p[0];w_(g)&&r.push({stop:{type:16,number:g.number*100,flags:g.flags},color:f})}}}}),i===1?{angle:(n+pc(180))%pc(360),stops:r,type:i}:{size:o,shape:s,stops:r,position:a,type:i}},Hre="closest-side",jre="farthest-side",Kre="closest-corner",Gre="farthest-corner",Wre="circle",zre="ellipse",qre="cover",Yre="contain",JVe=function(t,e){var n=0,r=3,i=[],s=[];return hl(e).forEach(function(o,a){var A=!0;if(a===0){var l=!1;A=o.reduce(function(f,p){if(l)if(pr(p))switch(p.value){case"center":return s.push(K2),f;case"top":case"left":return s.push(qs),f;case"right":case"bottom":return s.push(Nd),f}else(qi(p)||oh(p))&&s.push(p);else if(pr(p))switch(p.value){case Wre:return n=0,!1;case zre:return n=1,!1;case"at":return l=!0,!1;case Hre:return r=0,!1;case qre:case jre:return r=1,!1;case Yre:case Kre:return r=2,!1;case Gre:return r=3,!1}else if(oh(p)||qi(p))return Array.isArray(r)||(r=[]),r.push(p),!1;return f},A)}if(A){var d=vR(t,o);i.push(d)}}),{size:r,shape:n,stops:i,position:s,type:2}},f0=function(t,e){var n=0,r=3,i=[],s=[];return hl(e).forEach(function(o,a){var A=!0;if(a===0?A=o.reduce(function(d,f){if(pr(f))switch(f.value){case"center":return s.push(K2),!1;case"top":case"left":return s.push(qs),!1;case"right":case"bottom":return s.push(Nd),!1}else if(qi(f)||oh(f))return s.push(f),!1;return d},A):a===1&&(A=o.reduce(function(d,f){if(pr(f))switch(f.value){case Wre:return n=0,!1;case zre:return n=1,!1;case Yre:case Hre:return r=0,!1;case jre:return r=1,!1;case Kre:return r=2,!1;case qre:case Gre:return r=3,!1}else if(oh(f)||qi(f))return Array.isArray(r)||(r=[]),r.push(f),!1;return d},A)),A){var l=vR(t,o);i.push(l)}}),{size:r,shape:n,stops:i,position:s,type:2}},$Ve=function(t){return t.type===1},ZVe=function(t){return t.type===2},G2={name:"image",parse:function(t,e){if(e.type===22){var n={url:e.value,type:0};return t.cache.addImage(e.value),n}if(e.type===18){var r=Xre[e.name];if(typeof r>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return r(t,e.values)}throw new Error("Unsupported image type "+e.type)}};function e4e(t){return!(t.type===20&&t.value==="none")&&(t.type!==18||!!Xre[t.name])}var Xre={"linear-gradient":YVe,"-moz-linear-gradient":h0,"-ms-linear-gradient":h0,"-o-linear-gradient":h0,"-webkit-linear-gradient":h0,"radial-gradient":JVe,"-moz-radial-gradient":f0,"-ms-radial-gradient":f0,"-o-radial-gradient":f0,"-webkit-radial-gradient":f0,"-webkit-gradient":XVe},t4e={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(e.length===0)return[];var n=e[0];return n.type===20&&n.value==="none"?[]:e.filter(function(r){return Kg(r)&&e4e(r)}).map(function(r){return G2.parse(t,r)})}},n4e={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map(function(n){if(pr(n))switch(n.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},r4e={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(t,e){return hl(e).map(function(n){return n.filter(qi)}).map(Ure)}},i4e={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(t,e){return hl(e).map(function(n){return n.filter(pr).map(function(r){return r.value}).join(" ")}).map(s4e)}},s4e=function(t){switch(t){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},lg;(function(t){t.AUTO="auto",t.CONTAIN="contain",t.COVER="cover"})(lg||(lg={}));var o4e={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(t,e){return hl(e).map(function(n){return n.filter(a4e)})}},a4e=function(t){return pr(t)||qi(t)},wR=function(t){return{name:"border-"+t+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},c4e=wR("top"),A4e=wR("right"),l4e=wR("bottom"),u4e=wR("left"),CR=function(t){return{name:"border-radius-"+t,initialValue:"0 0",prefix:!1,type:1,parse:function(e,n){return Ure(n.filter(qi))}}},d4e=CR("top-left"),h4e=CR("top-right"),f4e=CR("bottom-right"),p4e=CR("bottom-left"),TR=function(t){return{name:"border-"+t+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,n){switch(n){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},m4e=TR("top"),g4e=TR("right"),_4e=TR("bottom"),E4e=TR("left"),SR=function(t){return{name:"border-"+t+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,n){return Rw(n)?n.number:0}}},y4e=SR("top"),v4e=SR("right"),w4e=SR("bottom"),C4e=SR("left"),T4e={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},S4e={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(t,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},b4e={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(t,e){return e.filter(pr).reduce(function(n,r){return n|I4e(r.value)},0)}},I4e=function(t){switch(t){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},R4e={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},O4e={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(t,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},kb;(function(t){t.NORMAL="normal",t.STRICT="strict"})(kb||(kb={}));var N4e={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"strict":return kb.STRICT;case"normal":default:return kb.NORMAL}}},D4e={name:"line-height",initialValue:"normal",prefix:!1,type:4},bz=function(t,e){return pr(t)&&t.value==="normal"?1.2*e:t.type===17?e*t.number:qi(t)?Dr(t,e):e},B4e={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(t,e){return e.type===20&&e.value==="none"?null:G2.parse(t,e)}},L4e={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(t,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},EU={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},bR=function(t){return{name:"margin-"+t,initialValue:"0",prefix:!1,type:4}},P4e=bR("top"),U4e=bR("right"),k4e=bR("bottom"),x4e=bR("left"),M4e={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(t,e){return e.filter(pr).map(function(n){switch(n.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},F4e={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},IR=function(t){return{name:"padding-"+t,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},V4e=IR("top"),Q4e=IR("right"),H4e=IR("bottom"),j4e=IR("left"),K4e={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(t,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},G4e={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(t,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},W4e={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.length===1&&_U(e[0],"none")?[]:hl(e).map(function(n){for(var r={color:cu.TRANSPARENT,offsetX:qs,offsetY:qs,blur:qs},i=0,s=0;s<n.length;s++){var o=n[s];oh(o)?(i===0?r.offsetX=o:i===1?r.offsetY=o:r.blur=o,i++):r.color=Kd.parse(t,o)}return r})}},z4e={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},q4e={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(t,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var n=J4e[e.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return n(e.values)}return null}},Y4e=function(t){var e=t.filter(function(n){return n.type===17}).map(function(n){return n.number});return e.length===6?e:null},X4e=function(t){var e=t.filter(function(A){return A.type===17}).map(function(A){return A.number}),n=e[0],r=e[1];e[2],e[3];var i=e[4],s=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var o=e[12],a=e[13];return e[14],e[15],e.length===16?[n,r,i,s,o,a]:null},J4e={matrix:Y4e,matrix3d:X4e},Iz={type:16,number:50,flags:Iw},$4e=[Iz,Iz],Z4e={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(t,e){var n=e.filter(qi);return n.length!==2?$4e:[n[0],n[1]]}},eQe={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},Wy;(function(t){t.NORMAL="normal",t.BREAK_ALL="break-all",t.KEEP_ALL="keep-all"})(Wy||(Wy={}));var tQe={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"break-all":return Wy.BREAK_ALL;case"keep-all":return Wy.KEEP_ALL;case"normal":default:return Wy.NORMAL}}},nQe={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(t,e){if(e.type===20)return{auto:!0,order:0};if(w_(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},Jre={name:"time",parse:function(t,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},rQe={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(t,e){return w_(e)?e.number:1}},iQe={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},sQe={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(t,e){return e.filter(pr).map(function(n){switch(n.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(n){return n!==0})}},oQe={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(t,e){var n=[],r=[];return e.forEach(function(i){switch(i.type){case 20:case 0:n.push(i.value);break;case 17:n.push(i.number.toString());break;case 4:r.push(n.join(" ")),n.length=0;break}}),n.length&&r.push(n.join(" ")),r.map(function(i){return i.indexOf(" ")===-1?i:"'"+i+"'"})}},aQe={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},cQe={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(t,e){if(w_(e))return e.number;if(pr(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},AQe={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.filter(pr).map(function(n){return n.value})}},lQe={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},cs=function(t,e){return(t&e)!==0},uQe={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(e.length===0)return[];var n=e[0];return n.type===20&&n.value==="none"?[]:e}},dQe={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(e.length===0)return null;var n=e[0];if(n.type===20&&n.value==="none")return null;for(var r=[],i=e.filter(Pre),s=0;s<i.length;s++){var o=i[s],a=i[s+1];if(o.type===20){var A=a&&w_(a)?a.number:1;r.push({counter:o.value,increment:A})}}return r}},hQe={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(e.length===0)return[];for(var n=[],r=e.filter(Pre),i=0;i<r.length;i++){var s=r[i],o=r[i+1];if(pr(s)&&s.value!=="none"){var a=o&&w_(o)?o.number:0;n.push({counter:s.value,reset:a})}}return n}},fQe={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(t,e){return e.filter(Rw).map(function(n){return Jre.parse(t,n)})}},pQe={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(e.length===0)return null;var n=e[0];if(n.type===20&&n.value==="none")return null;var r=[],i=e.filter(QVe);if(i.length%2!==0)return null;for(var s=0;s<i.length;s+=2){var o=i[s].value,a=i[s+1].value;r.push({open:o,close:a})}return r}},Rz=function(t,e,n){if(!t)return"";var r=t[Math.min(e,t.length-1)];return r?n?r.open:r.close:""},mQe={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.length===1&&_U(e[0],"none")?[]:hl(e).map(function(n){for(var r={color:255,offsetX:qs,offsetY:qs,blur:qs,spread:qs,inset:!1},i=0,s=0;s<n.length;s++){var o=n[s];_U(o,"inset")?r.inset=!0:oh(o)?(i===0?r.offsetX=o:i===1?r.offsetY=o:i===2?r.blur=o:r.spread=o,i++):r.color=Kd.parse(t,o)}return r})}},gQe={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(t,e){var n=[0,1,2],r=[];return e.filter(pr).forEach(function(i){switch(i.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2);break}}),n.forEach(function(i){r.indexOf(i)===-1&&r.push(i)}),r}},_Qe={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},EQe={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Rw(e)?e.number:0}},yQe=function(){function t(e,n){var r,i;this.animationDuration=Ze(e,fQe,n.animationDuration),this.backgroundClip=Ze(e,KVe,n.backgroundClip),this.backgroundColor=Ze(e,GVe,n.backgroundColor),this.backgroundImage=Ze(e,t4e,n.backgroundImage),this.backgroundOrigin=Ze(e,n4e,n.backgroundOrigin),this.backgroundPosition=Ze(e,r4e,n.backgroundPosition),this.backgroundRepeat=Ze(e,i4e,n.backgroundRepeat),this.backgroundSize=Ze(e,o4e,n.backgroundSize),this.borderTopColor=Ze(e,c4e,n.borderTopColor),this.borderRightColor=Ze(e,A4e,n.borderRightColor),this.borderBottomColor=Ze(e,l4e,n.borderBottomColor),this.borderLeftColor=Ze(e,u4e,n.borderLeftColor),this.borderTopLeftRadius=Ze(e,d4e,n.borderTopLeftRadius),this.borderTopRightRadius=Ze(e,h4e,n.borderTopRightRadius),this.borderBottomRightRadius=Ze(e,f4e,n.borderBottomRightRadius),this.borderBottomLeftRadius=Ze(e,p4e,n.borderBottomLeftRadius),this.borderTopStyle=Ze(e,m4e,n.borderTopStyle),this.borderRightStyle=Ze(e,g4e,n.borderRightStyle),this.borderBottomStyle=Ze(e,_4e,n.borderBottomStyle),this.borderLeftStyle=Ze(e,E4e,n.borderLeftStyle),this.borderTopWidth=Ze(e,y4e,n.borderTopWidth),this.borderRightWidth=Ze(e,v4e,n.borderRightWidth),this.borderBottomWidth=Ze(e,w4e,n.borderBottomWidth),this.borderLeftWidth=Ze(e,C4e,n.borderLeftWidth),this.boxShadow=Ze(e,mQe,n.boxShadow),this.color=Ze(e,T4e,n.color),this.direction=Ze(e,S4e,n.direction),this.display=Ze(e,b4e,n.display),this.float=Ze(e,R4e,n.cssFloat),this.fontFamily=Ze(e,oQe,n.fontFamily),this.fontSize=Ze(e,aQe,n.fontSize),this.fontStyle=Ze(e,lQe,n.fontStyle),this.fontVariant=Ze(e,AQe,n.fontVariant),this.fontWeight=Ze(e,cQe,n.fontWeight),this.letterSpacing=Ze(e,O4e,n.letterSpacing),this.lineBreak=Ze(e,N4e,n.lineBreak),this.lineHeight=Ze(e,D4e,n.lineHeight),this.listStyleImage=Ze(e,B4e,n.listStyleImage),this.listStylePosition=Ze(e,L4e,n.listStylePosition),this.listStyleType=Ze(e,EU,n.listStyleType),this.marginTop=Ze(e,P4e,n.marginTop),this.marginRight=Ze(e,U4e,n.marginRight),this.marginBottom=Ze(e,k4e,n.marginBottom),this.marginLeft=Ze(e,x4e,n.marginLeft),this.opacity=Ze(e,rQe,n.opacity);var s=Ze(e,M4e,n.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=Ze(e,F4e,n.overflowWrap),this.paddingTop=Ze(e,V4e,n.paddingTop),this.paddingRight=Ze(e,Q4e,n.paddingRight),this.paddingBottom=Ze(e,H4e,n.paddingBottom),this.paddingLeft=Ze(e,j4e,n.paddingLeft),this.paintOrder=Ze(e,gQe,n.paintOrder),this.position=Ze(e,G4e,n.position),this.textAlign=Ze(e,K4e,n.textAlign),this.textDecorationColor=Ze(e,iQe,(r=n.textDecorationColor)!==null&&r!==void 0?r:n.color),this.textDecorationLine=Ze(e,sQe,(i=n.textDecorationLine)!==null&&i!==void 0?i:n.textDecoration),this.textShadow=Ze(e,W4e,n.textShadow),this.textTransform=Ze(e,z4e,n.textTransform),this.transform=Ze(e,q4e,n.transform),this.transformOrigin=Ze(e,Z4e,n.transformOrigin),this.visibility=Ze(e,eQe,n.visibility),this.webkitTextStrokeColor=Ze(e,_Qe,n.webkitTextStrokeColor),this.webkitTextStrokeWidth=Ze(e,EQe,n.webkitTextStrokeWidth),this.wordBreak=Ze(e,tQe,n.wordBreak),this.zIndex=Ze(e,nQe,n.zIndex)}return t.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},t.prototype.isTransparent=function(){return Gd(this.backgroundColor)},t.prototype.isTransformed=function(){return this.transform!==null},t.prototype.isPositioned=function(){return this.position!==0},t.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},t.prototype.isFloating=function(){return this.float!==0},t.prototype.isInlineLevel=function(){return cs(this.display,4)||cs(this.display,33554432)||cs(this.display,268435456)||cs(this.display,536870912)||cs(this.display,67108864)||cs(this.display,134217728)},t}(),vQe=function(){function t(e,n){this.content=Ze(e,uQe,n.content),this.quotes=Ze(e,pQe,n.quotes)}return t}(),Oz=function(){function t(e,n){this.counterIncrement=Ze(e,dQe,n.counterIncrement),this.counterReset=Ze(e,hQe,n.counterReset)}return t}(),Ze=function(t,e,n){var r=new Bre,i=n!==null&&typeof n<"u"?n.toString():e.initialValue;r.write(i);var s=new Lre(r.read());switch(e.type){case 2:var o=s.parseComponentValue();return e.parse(t,pr(o)?o.value:e.initialValue);case 0:return e.parse(t,s.parseComponentValue());case 1:return e.parse(t,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(e.format){case"angle":return yR.parse(t,s.parseComponentValue());case"color":return Kd.parse(t,s.parseComponentValue());case"image":return G2.parse(t,s.parseComponentValue());case"length":var a=s.parseComponentValue();return oh(a)?a:qs;case"length-percentage":var A=s.parseComponentValue();return qi(A)?A:qs;case"time":return Jre.parse(t,s.parseComponentValue())}break}},wQe="data-html2canvas-debug",CQe=function(t){var e=t.getAttribute(wQe);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},yU=function(t,e){var n=CQe(t);return n===1||e===n},fl=function(){function t(e,n){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,yU(n,3))debugger;this.styles=new yQe(e,window.getComputedStyle(n,null)),CU(n)&&(this.styles.animationDuration.some(function(r){return r>0})&&(n.style.animationDuration="0s"),this.styles.transform!==null&&(n.style.transform="none")),this.bounds=_R(this.context,n),yU(n,4)&&(this.flags|=16)}return t}(),TQe="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Nz="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fy=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var p0=0;p0<Nz.length;p0++)fy[Nz.charCodeAt(p0)]=p0;var SQe=function(t){var e=t.length*.75,n=t.length,r,i=0,s,o,a,A;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);var l=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),d=Array.isArray(l)?l:new Uint8Array(l);for(r=0;r<n;r+=4)s=fy[t.charCodeAt(r)],o=fy[t.charCodeAt(r+1)],a=fy[t.charCodeAt(r+2)],A=fy[t.charCodeAt(r+3)],d[i++]=s<<2|o>>4,d[i++]=(o&15)<<4|a>>2,d[i++]=(a&3)<<6|A&63;return l},bQe=function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n.push(t[r+1]<<8|t[r]);return n},IQe=function(t){for(var e=t.length,n=[],r=0;r<e;r+=4)n.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return n},Df=5,W2=11,L1=2,RQe=W2-Df,$re=65536>>Df,OQe=1<<Df,P1=OQe-1,NQe=1024>>Df,DQe=$re+NQe,BQe=DQe,LQe=32,PQe=BQe+LQe,UQe=65536>>W2,kQe=1<<RQe,xQe=kQe-1,Dz=function(t,e,n){return t.slice?t.slice(e,n):new Uint16Array(Array.prototype.slice.call(t,e,n))},MQe=function(t,e,n){return t.slice?t.slice(e,n):new Uint32Array(Array.prototype.slice.call(t,e,n))},FQe=function(t,e){var n=SQe(t),r=Array.isArray(n)?IQe(n):new Uint32Array(n),i=Array.isArray(n)?bQe(n):new Uint16Array(n),s=24,o=Dz(i,s/2,r[4]/2),a=r[5]===2?Dz(i,(s+r[4])/2):MQe(r,Math.ceil((s+r[4])/4));return new VQe(r[0],r[1],r[2],r[3],o,a)},VQe=function(){function t(e,n,r,i,s,o){this.initialValue=e,this.errorValue=n,this.highStart=r,this.highValueIndex=i,this.index=s,this.data=o}return t.prototype.get=function(e){var n;if(e>=0){if(e<55296||e>56319&&e<=65535)return n=this.index[e>>Df],n=(n<<L1)+(e&P1),this.data[n];if(e<=65535)return n=this.index[$re+(e-55296>>Df)],n=(n<<L1)+(e&P1),this.data[n];if(e<this.highStart)return n=PQe-UQe+(e>>W2),n=this.index[n],n+=e>>Df&xQe,n=this.index[n],n=(n<<L1)+(e&P1),this.data[n];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),Bz="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",QQe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var m0=0;m0<Bz.length;m0++)QQe[Bz.charCodeAt(m0)]=m0;var HQe=1,U1=2,k1=3,Lz=4,Pz=5,jQe=7,Uz=8,x1=9,M1=10,kz=11,xz=12,Mz=13,Fz=14,F1=15,KQe=function(t){for(var e=[],n=0,r=t.length;n<r;){var i=t.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var s=t.charCodeAt(n++);(s&64512)===56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),n--)}else e.push(i)}return e},GQe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var n=t.length;if(!n)return"";for(var r=[],i=-1,s="";++i<n;){var o=t[i];o<=65535?r.push(o):(o-=65536,r.push((o>>10)+55296,o%1024+56320)),(i+1===n||r.length>16384)&&(s+=String.fromCharCode.apply(String,r),r.length=0)}return s},WQe=FQe(TQe),sc="",V1="",zQe=function(t){return WQe.get(t)},qQe=function(t,e,n){var r=n-2,i=e[r],s=e[n-1],o=e[n];if(s===U1&&o===k1)return sc;if(s===U1||s===k1||s===Lz||o===U1||o===k1||o===Lz)return V1;if(s===Uz&&[Uz,x1,kz,xz].indexOf(o)!==-1||(s===kz||s===x1)&&(o===x1||o===M1)||(s===xz||s===M1)&&o===M1||o===Mz||o===Pz||o===jQe||s===HQe)return sc;if(s===Mz&&o===Fz){for(;i===Pz;)i=e[--r];if(i===Fz)return sc}if(s===F1&&o===F1){for(var a=0;i===F1;)a++,i=e[--r];if(a%2===0)return sc}return V1},YQe=function(t){var e=KQe(t),n=e.length,r=0,i=0,s=e.map(zQe);return{next:function(){if(r>=n)return{done:!0,value:null};for(var o=sc;r<n&&(o=qQe(e,s,++r))===sc;);if(o!==sc||r===n){var a=GQe.apply(null,e.slice(i,r));return i=r,{value:a,done:!1}}return{done:!0,value:null}}}},XQe=function(t){for(var e=YQe(t),n=[],r;!(r=e.next()).done;)r.value&&n.push(r.value.slice());return n},JQe=function(t){var e=123;if(t.createRange){var n=t.createRange();if(n.getBoundingClientRect){var r=t.createElement("boundtest");r.style.height=e+"px",r.style.display="block",t.body.appendChild(r),n.selectNode(r);var i=n.getBoundingClientRect(),s=Math.round(i.height);if(t.body.removeChild(r),s===e)return!0}}return!1},$Qe=function(t){var e=t.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",t.body.appendChild(e);var n=t.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var r=e.firstChild,i=ER(r.data).map(function(A){return Li(A)}),s=0,o={},a=i.every(function(A,l){n.setStart(r,s),n.setEnd(r,s+A.length);var d=n.getBoundingClientRect();s+=A.length;var f=d.x>o.x||d.y>o.y;return o=d,l===0?!0:f});return t.body.removeChild(e),a},ZQe=function(){return typeof new Image().crossOrigin<"u"},eHe=function(){return typeof new XMLHttpRequest().responseType=="string"},tHe=function(t){var e=new Image,n=t.createElement("canvas"),r=n.getContext("2d");if(!r)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),n.toDataURL()}catch{return!1}return!0},Vz=function(t){return t[0]===0&&t[1]===255&&t[2]===0&&t[3]===255},nHe=function(t){var e=t.createElement("canvas"),n=100;e.width=n,e.height=n;var r=e.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,n,n);var i=new Image,s=e.toDataURL();i.src=s;var o=vU(n,n,0,0,i);return r.fillStyle="red",r.fillRect(0,0,n,n),Qz(o).then(function(a){r.drawImage(a,0,0);var A=r.getImageData(0,0,n,n).data;r.fillStyle="red",r.fillRect(0,0,n,n);var l=t.createElement("div");return l.style.backgroundImage="url("+s+")",l.style.height=n+"px",Vz(A)?Qz(vU(n,n,0,0,l)):Promise.reject(!1)}).then(function(a){return r.drawImage(a,0,0),Vz(r.getImageData(0,0,n,n).data)}).catch(function(){return!1})},vU=function(t,e,n,r,i){var s="http://www.w3.org/2000/svg",o=document.createElementNS(s,"svg"),a=document.createElementNS(s,"foreignObject");return o.setAttributeNS(null,"width",t.toString()),o.setAttributeNS(null,"height",e.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",n.toString()),a.setAttributeNS(null,"y",r.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),o.appendChild(a),a.appendChild(i),o},Qz=function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){return e(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(t))})},Gs={get SUPPORT_RANGE_BOUNDS(){var t=JQe(document);return Object.defineProperty(Gs,"SUPPORT_RANGE_BOUNDS",{value:t}),t},get SUPPORT_WORD_BREAKING(){var t=Gs.SUPPORT_RANGE_BOUNDS&&$Qe(document);return Object.defineProperty(Gs,"SUPPORT_WORD_BREAKING",{value:t}),t},get SUPPORT_SVG_DRAWING(){var t=tHe(document);return Object.defineProperty(Gs,"SUPPORT_SVG_DRAWING",{value:t}),t},get SUPPORT_FOREIGNOBJECT_DRAWING(){var t=typeof Array.from=="function"&&typeof window.fetch=="function"?nHe(document):Promise.resolve(!1);return Object.defineProperty(Gs,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:t}),t},get SUPPORT_CORS_IMAGES(){var t=ZQe();return Object.defineProperty(Gs,"SUPPORT_CORS_IMAGES",{value:t}),t},get SUPPORT_RESPONSE_TYPE(){var t=eHe();return Object.defineProperty(Gs,"SUPPORT_RESPONSE_TYPE",{value:t}),t},get SUPPORT_CORS_XHR(){var t="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Gs,"SUPPORT_CORS_XHR",{value:t}),t},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var t=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(Gs,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:t}),t}},zy=function(){function t(e,n){this.text=e,this.bounds=n}return t}(),rHe=function(t,e,n,r){var i=oHe(e,n),s=[],o=0;return i.forEach(function(a){if(n.textDecorationLine.length||a.trim().length>0)if(Gs.SUPPORT_RANGE_BOUNDS){var A=Hz(r,o,a.length).getClientRects();if(A.length>1){var l=z2(a),d=0;l.forEach(function(p){s.push(new zy(p,_u.fromDOMRectList(t,Hz(r,d+o,p.length).getClientRects()))),d+=p.length})}else s.push(new zy(a,_u.fromDOMRectList(t,A)))}else{var f=r.splitText(a.length);s.push(new zy(a,iHe(t,r))),r=f}else Gs.SUPPORT_RANGE_BOUNDS||(r=r.splitText(a.length));o+=a.length}),s},iHe=function(t,e){var n=e.ownerDocument;if(n){var r=n.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));var i=e.parentNode;if(i){i.replaceChild(r,e);var s=_R(t,r);return r.firstChild&&i.replaceChild(r.firstChild,r),s}}return _u.EMPTY},Hz=function(t,e,n){var r=t.ownerDocument;if(!r)throw new Error("Node has no owner document");var i=r.createRange();return i.setStart(t,e),i.setEnd(t,e+n),i},z2=function(t){if(Gs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(t)).map(function(n){return n.segment})}return XQe(t)},sHe=function(t,e){if(Gs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var n=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(n.segment(t)).map(function(r){return r.segment})}return cHe(t,e)},oHe=function(t,e){return e.letterSpacing!==0?z2(t):sHe(t,e)},aHe=[32,160,4961,65792,65793,4153,4241],cHe=function(t,e){for(var n=UFe(t,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),r=[],i,s=function(){if(i.value){var o=i.value.slice(),a=ER(o),A="";a.forEach(function(l){aHe.indexOf(l)===-1?A+=Li(l):(A.length&&r.push(A),r.push(Li(l)),A="")}),A.length&&r.push(A)}};!(i=n.next()).done;)s();return r},AHe=function(){function t(e,n,r){this.text=lHe(n.data,r.textTransform),this.textBounds=rHe(e,this.text,r,n)}return t}(),lHe=function(t,e){switch(e){case 1:return t.toLowerCase();case 3:return t.replace(uHe,dHe);case 2:return t.toUpperCase();default:return t}},uHe=/(^|\s|:|-|\(|\))([a-z])/g,dHe=function(t,e,n){return t.length>0?e+n.toUpperCase():t},Zre=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.src=r.currentSrc||r.src,i.intrinsicWidth=r.naturalWidth,i.intrinsicHeight=r.naturalHeight,i.context.cache.addImage(i.src),i}return e}(fl),eie=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.canvas=r,i.intrinsicWidth=r.width,i.intrinsicHeight=r.height,i}return e}(fl),tie=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this,s=new XMLSerializer,o=_R(n,r);return r.setAttribute("width",o.width+"px"),r.setAttribute("height",o.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(r)),i.intrinsicWidth=r.width.baseVal.value,i.intrinsicHeight=r.height.baseVal.value,i.context.cache.addImage(i.svg),i}return e}(fl),nie=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.value=r.value,i}return e}(fl),wU=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.start=r.start,i.reversed=typeof r.reversed=="boolean"&&r.reversed===!0,i}return e}(fl),hHe=[{type:15,flags:0,unit:"px",number:3}],fHe=[{type:16,flags:0,number:50}],pHe=function(t){return t.width>t.height?new _u(t.left+(t.width-t.height)/2,t.top,t.height,t.height):t.width<t.height?new _u(t.left,t.top+(t.height-t.width)/2,t.width,t.width):t},mHe=function(t){var e=t.type===gHe?new Array(t.value.length+1).join(""):t.value;return e.length===0?t.placeholder||"":e},xb="checkbox",Mb="radio",gHe="password",jz=707406591,q2=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this;switch(i.type=r.type.toLowerCase(),i.checked=r.checked,i.value=mHe(r),(i.type===xb||i.type===Mb)&&(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1,i.styles.backgroundClip=[0],i.styles.backgroundOrigin=[0],i.bounds=pHe(i.bounds)),i.type){case xb:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=hHe;break;case Mb:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=fHe;break}return i}return e}(fl),rie=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this,s=r.options[r.selectedIndex||0];return i.value=s&&s.text||"",i}return e}(fl),iie=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.value=r.value,i}return e}(fl),sie=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this;i.src=r.src,i.width=parseInt(r.width,10)||0,i.height=parseInt(r.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(r.contentWindow&&r.contentWindow.document&&r.contentWindow.document.documentElement){i.tree=aie(n,r.contentWindow.document.documentElement);var s=r.contentWindow.document.documentElement?Gy(n,getComputedStyle(r.contentWindow.document.documentElement).backgroundColor):cu.TRANSPARENT,o=r.contentWindow.document.body?Gy(n,getComputedStyle(r.contentWindow.document.body).backgroundColor):cu.TRANSPARENT;i.backgroundColor=Gd(s)?Gd(o)?i.styles.backgroundColor:o:s}}catch{}return i}return e}(fl),_He=["OL","UL","MENU"],pS=function(t,e,n,r){for(var i=e.firstChild,s=void 0;i;i=s)if(s=i.nextSibling,cie(i)&&i.data.trim().length>0)n.textNodes.push(new AHe(t,i,n.styles));else if(jm(i))if(die(i)&&i.assignedNodes)i.assignedNodes().forEach(function(a){return pS(t,a,n,r)});else{var o=oie(t,i);o.styles.isVisible()&&(EHe(i,o,r)?o.flags|=4:yHe(o.styles)&&(o.flags|=2),_He.indexOf(i.tagName)!==-1&&(o.flags|=8),n.elements.push(o),i.slot,i.shadowRoot?pS(t,i.shadowRoot,o,r):!Fb(i)&&!Aie(i)&&!Vb(i)&&pS(t,i,o,r))}},oie=function(t,e){return TU(e)?new Zre(t,e):lie(e)?new eie(t,e):Aie(e)?new tie(t,e):vHe(e)?new nie(t,e):wHe(e)?new wU(t,e):CHe(e)?new q2(t,e):Vb(e)?new rie(t,e):Fb(e)?new iie(t,e):uie(e)?new sie(t,e):new fl(t,e)},aie=function(t,e){var n=oie(t,e);return n.flags|=4,pS(t,e,n,n),n},EHe=function(t,e,n){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||Y2(t)&&n.styles.isTransparent()},yHe=function(t){return t.isPositioned()||t.isFloating()},cie=function(t){return t.nodeType===Node.TEXT_NODE},jm=function(t){return t.nodeType===Node.ELEMENT_NODE},CU=function(t){return jm(t)&&typeof t.style<"u"&&!mS(t)},mS=function(t){return typeof t.className=="object"},vHe=function(t){return t.tagName==="LI"},wHe=function(t){return t.tagName==="OL"},CHe=function(t){return t.tagName==="INPUT"},THe=function(t){return t.tagName==="HTML"},Aie=function(t){return t.tagName==="svg"},Y2=function(t){return t.tagName==="BODY"},lie=function(t){return t.tagName==="CANVAS"},Kz=function(t){return t.tagName==="VIDEO"},TU=function(t){return t.tagName==="IMG"},uie=function(t){return t.tagName==="IFRAME"},Gz=function(t){return t.tagName==="STYLE"},SHe=function(t){return t.tagName==="SCRIPT"},Fb=function(t){return t.tagName==="TEXTAREA"},Vb=function(t){return t.tagName==="SELECT"},die=function(t){return t.tagName==="SLOT"},Wz=function(t){return t.tagName.indexOf("-")>0},bHe=function(){function t(){this.counters={}}return t.prototype.getCounterValue=function(e){var n=this.counters[e];return n&&n.length?n[n.length-1]:1},t.prototype.getCounterValues=function(e){var n=this.counters[e];return n||[]},t.prototype.pop=function(e){var n=this;e.forEach(function(r){return n.counters[r].pop()})},t.prototype.parse=function(e){var n=this,r=e.counterIncrement,i=e.counterReset,s=!0;r!==null&&r.forEach(function(a){var A=n.counters[a.counter];A&&a.increment!==0&&(s=!1,A.length||A.push(1),A[Math.max(0,A.length-1)]+=a.increment)});var o=[];return s&&i.forEach(function(a){var A=n.counters[a.counter];o.push(a.counter),A||(A=n.counters[a.counter]=[]),A.push(a.reset)}),o},t}(),zz={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},qz={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},IHe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},RHe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},fm=function(t,e,n,r,i,s){return t<e||t>n?jv(t,i,s.length>0):r.integers.reduce(function(o,a,A){for(;t>=a;)t-=a,o+=r.values[A];return o},"")+s},hie=function(t,e,n,r){var i="";do n||t--,i=r(t)+i,t/=e;while(t*e>=e);return i},Di=function(t,e,n,r,i){var s=n-e+1;return(t<0?"-":"")+(hie(Math.abs(t),s,r,function(o){return Li(Math.floor(o%s)+e)})+i)},Jh=function(t,e,n){n===void 0&&(n=". ");var r=e.length;return hie(Math.abs(t),r,!1,function(i){return e[Math.floor(i%r)]})+n},Rm=1,cd=2,Ad=4,py=8,Hl=function(t,e,n,r,i,s){if(t<-9999||t>9999)return jv(t,4,i.length>0);var o=Math.abs(t),a=i;if(o===0)return e[0]+a;for(var A=0;o>0&&A<=4;A++){var l=o%10;l===0&&cs(s,Rm)&&a!==""?a=e[l]+a:l>1||l===1&&A===0||l===1&&A===1&&cs(s,cd)||l===1&&A===1&&cs(s,Ad)&&t>100||l===1&&A>1&&cs(s,py)?a=e[l]+(A>0?n[A-1]:"")+a:l===1&&A>0&&(a=n[A-1]+a),o=Math.floor(o/10)}return(t<0?r:"")+a},Yz="",Xz="",Jz="",Q1="",jv=function(t,e,n){var r=n?". ":"",i=n?"":"",s=n?", ":"",o=n?" ":"";switch(e){case 0:return""+o;case 1:return""+o;case 2:return""+o;case 5:var a=Di(t,48,57,!0,r);return a.length<4?"0"+a:a;case 4:return Jh(t,"",i);case 6:return fm(t,1,3999,zz,3,r).toLowerCase();case 7:return fm(t,1,3999,zz,3,r);case 8:return Di(t,945,969,!1,r);case 9:return Di(t,97,122,!1,r);case 10:return Di(t,65,90,!1,r);case 11:return Di(t,1632,1641,!0,r);case 12:case 49:return fm(t,1,9999,qz,3,r);case 35:return fm(t,1,9999,qz,3,r).toLowerCase();case 13:return Di(t,2534,2543,!0,r);case 14:case 30:return Di(t,6112,6121,!0,r);case 15:return Jh(t,"",i);case 16:return Jh(t,"",i);case 17:case 48:return Hl(t,"",Yz,"",i,cd|Ad|py);case 47:return Hl(t,"",Xz,"",i,Rm|cd|Ad|py);case 42:return Hl(t,"",Yz,"",i,cd|Ad|py);case 41:return Hl(t,"",Xz,"",i,Rm|cd|Ad|py);case 26:return Hl(t,"","",Jz,i,0);case 25:return Hl(t,"","",Jz,i,Rm|cd|Ad);case 31:return Hl(t,"","",Q1,s,Rm|cd|Ad);case 33:return Hl(t,"","",Q1,s,0);case 32:return Hl(t,"","",Q1,s,Rm|cd|Ad);case 18:return Di(t,2406,2415,!0,r);case 20:return fm(t,1,19999,RHe,3,r);case 21:return Di(t,2790,2799,!0,r);case 22:return Di(t,2662,2671,!0,r);case 22:return fm(t,1,10999,IHe,3,r);case 23:return Jh(t,"");case 24:return Jh(t,"");case 27:return Di(t,3302,3311,!0,r);case 28:return Jh(t,"",i);case 29:return Jh(t,"",i);case 34:return Di(t,3792,3801,!0,r);case 37:return Di(t,6160,6169,!0,r);case 38:return Di(t,4160,4169,!0,r);case 39:return Di(t,2918,2927,!0,r);case 40:return Di(t,1776,1785,!0,r);case 43:return Di(t,3046,3055,!0,r);case 44:return Di(t,3174,3183,!0,r);case 45:return Di(t,3664,3673,!0,r);case 46:return Di(t,3872,3881,!0,r);case 3:default:return Di(t,48,57,!0,r)}},fie="data-html2canvas-ignore",$z=function(){function t(e,n,r){if(this.context=e,this.options=r,this.scrolledElements=[],this.referenceElement=n,this.counters=new bHe,this.quoteDepth=0,!n.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(n.ownerDocument.documentElement,!1)}return t.prototype.toIFrame=function(e,n){var r=this,i=OHe(e,n);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var s=e.defaultView.pageXOffset,o=e.defaultView.pageYOffset,a=i.contentWindow,A=a.document,l=BHe(i).then(function(){return So(r,void 0,void 0,function(){var d,f;return io(this,function(p){switch(p.label){case 0:return this.scrolledElements.forEach(kHe),a&&(a.scrollTo(n.left,n.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(a.scrollY!==n.top||a.scrollX!==n.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(a.scrollX-n.left,a.scrollY-n.top,0,0))),d=this.options.onclone,f=this.clonedReferenceElement,typeof f>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:A.fonts&&A.fonts.ready?[4,A.fonts.ready]:[3,2];case 1:p.sent(),p.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,DHe(A)]:[3,4];case 3:p.sent(),p.label=4;case 4:return typeof d=="function"?[2,Promise.resolve().then(function(){return d(A,f)}).then(function(){return i})]:[2,i]}})})});return A.open(),A.write(PHe(document.doctype)+"<html></html>"),UHe(this.referenceElement.ownerDocument,s,o),A.replaceChild(A.adoptNode(this.documentElement),A.documentElement),A.close(),l},t.prototype.createElementClone=function(e){if(yU(e,2))debugger;if(lie(e))return this.createCanvasClone(e);if(Kz(e))return this.createVideoClone(e);if(Gz(e))return this.createStyleClone(e);var n=e.cloneNode(!1);return TU(n)&&(TU(e)&&e.currentSrc&&e.currentSrc!==e.src&&(n.src=e.currentSrc,n.srcset=""),n.loading==="lazy"&&(n.loading="eager")),Wz(n)?this.createCustomElementClone(n):n},t.prototype.createCustomElementClone=function(e){var n=document.createElement("html2canvascustomelement");return H1(e.style,n),n},t.prototype.createStyleClone=function(e){try{var n=e.sheet;if(n&&n.cssRules){var r=[].slice.call(n.cssRules,0).reduce(function(s,o){return o&&typeof o.cssText=="string"?s+o.cssText:s},""),i=e.cloneNode(!1);return i.textContent=r,i}}catch(s){if(this.context.logger.error("Unable to access cssRules property",s),s.name!=="SecurityError")throw s}return e.cloneNode(!1)},t.prototype.createCanvasClone=function(e){var n;if(this.options.inlineImages&&e.ownerDocument){var r=e.ownerDocument.createElement("img");try{return r.src=e.toDataURL(),r}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var i=e.cloneNode(!1);try{i.width=e.width,i.height=e.height;var s=e.getContext("2d"),o=i.getContext("2d");if(o)if(!this.options.allowTaint&&s)o.putImageData(s.getImageData(0,0,e.width,e.height),0,0);else{var a=(n=e.getContext("webgl2"))!==null&&n!==void 0?n:e.getContext("webgl");if(a){var A=a.getContextAttributes();(A==null?void 0:A.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}o.drawImage(e,0,0)}return i}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return i},t.prototype.createVideoClone=function(e){var n=e.ownerDocument.createElement("canvas");n.width=e.offsetWidth,n.height=e.offsetHeight;var r=n.getContext("2d");try{return r&&(r.drawImage(e,0,0,n.width,n.height),this.options.allowTaint||r.getImageData(0,0,n.width,n.height)),n}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var i=e.ownerDocument.createElement("canvas");return i.width=e.offsetWidth,i.height=e.offsetHeight,i},t.prototype.appendChildNode=function(e,n,r){(!jm(n)||!SHe(n)&&!n.hasAttribute(fie)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(n)))&&(!this.options.copyStyles||!jm(n)||!Gz(n))&&e.appendChild(this.cloneNode(n,r))},t.prototype.cloneChildNodes=function(e,n,r){for(var i=this,s=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;s;s=s.nextSibling)if(jm(s)&&die(s)&&typeof s.assignedNodes=="function"){var o=s.assignedNodes();o.length&&o.forEach(function(a){return i.appendChildNode(n,a,r)})}else this.appendChildNode(n,s,r)},t.prototype.cloneNode=function(e,n){if(cie(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var r=e.ownerDocument.defaultView;if(r&&jm(e)&&(CU(e)||mS(e))){var i=this.createElementClone(e);i.style.transitionProperty="none";var s=r.getComputedStyle(e),o=r.getComputedStyle(e,":before"),a=r.getComputedStyle(e,":after");this.referenceElement===e&&CU(i)&&(this.clonedReferenceElement=i),Y2(i)&&FHe(i);var A=this.counters.parse(new Oz(this.context,s)),l=this.resolvePseudoContent(e,i,o,qy.BEFORE);Wz(e)&&(n=!0),Kz(e)||this.cloneChildNodes(e,i,n),l&&i.insertBefore(l,i.firstChild);var d=this.resolvePseudoContent(e,i,a,qy.AFTER);return d&&i.appendChild(d),this.counters.pop(A),(s&&(this.options.copyStyles||mS(e))&&!uie(e)||n)&&H1(s,i),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([i,e.scrollLeft,e.scrollTop]),(Fb(e)||Vb(e))&&(Fb(i)||Vb(i))&&(i.value=e.value),i}return e.cloneNode(!1)},t.prototype.resolvePseudoContent=function(e,n,r,i){var s=this;if(r){var o=r.content,a=n.ownerDocument;if(!(!a||!o||o==="none"||o==="-moz-alt-content"||r.display==="none")){this.counters.parse(new Oz(this.context,r));var A=new vQe(this.context,r),l=a.createElement("html2canvaspseudoelement");H1(r,l),A.content.forEach(function(f){if(f.type===0)l.appendChild(a.createTextNode(f.value));else if(f.type===22){var p=a.createElement("img");p.src=f.value,p.style.opacity="1",l.appendChild(p)}else if(f.type===18){if(f.name==="attr"){var g=f.values.filter(pr);g.length&&l.appendChild(a.createTextNode(e.getAttribute(g[0].value)||""))}else if(f.name==="counter"){var y=f.values.filter(Kg),E=y[0],w=y[1];if(E&&pr(E)){var b=s.counters.getCounterValue(E.value),I=w&&pr(w)?EU.parse(s.context,w.value):3;l.appendChild(a.createTextNode(jv(b,I,!1)))}}else if(f.name==="counters"){var B=f.values.filter(Kg),E=B[0],U=B[1],w=B[2];if(E&&pr(E)){var H=s.counters.getCounterValues(E.value),K=w&&pr(w)?EU.parse(s.context,w.value):3,x=U&&U.type===0?U.value:"",V=H.map(function(z){return jv(z,K,!1)}).join(x);l.appendChild(a.createTextNode(V))}}}else if(f.type===20)switch(f.value){case"open-quote":l.appendChild(a.createTextNode(Rz(A.quotes,s.quoteDepth++,!0)));break;case"close-quote":l.appendChild(a.createTextNode(Rz(A.quotes,--s.quoteDepth,!1)));break;default:l.appendChild(a.createTextNode(f.value))}}),l.className=SU+" "+bU;var d=i===qy.BEFORE?" "+SU:" "+bU;return mS(n)?n.className.baseValue+=d:n.className+=d,l}}},t.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},t}(),qy;(function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER"})(qy||(qy={}));var OHe=function(t,e){var n=t.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=e.width.toString(),n.height=e.height.toString(),n.scrolling="no",n.setAttribute(fie,"true"),t.body.appendChild(n),n},NHe=function(t){return new Promise(function(e){if(t.complete){e();return}if(!t.src){e();return}t.onload=e,t.onerror=e})},DHe=function(t){return Promise.all([].slice.call(t.images,0).map(NHe))},BHe=function(t){return new Promise(function(e,n){var r=t.contentWindow;if(!r)return n("No window assigned for iframe");var i=r.document;r.onload=t.onload=function(){r.onload=t.onload=null;var s=setInterval(function(){i.body.childNodes.length>0&&i.readyState==="complete"&&(clearInterval(s),e(t))},50)}})},LHe=["all","d","content"],H1=function(t,e){for(var n=t.length-1;n>=0;n--){var r=t.item(n);LHe.indexOf(r)===-1&&e.style.setProperty(r,t.getPropertyValue(r))}return e},PHe=function(t){var e="";return t&&(e+="<!DOCTYPE ",t.name&&(e+=t.name),t.internalSubset&&(e+=t.internalSubset),t.publicId&&(e+='"'+t.publicId+'"'),t.systemId&&(e+='"'+t.systemId+'"'),e+=">"),e},UHe=function(t,e,n){t&&t.defaultView&&(e!==t.defaultView.pageXOffset||n!==t.defaultView.pageYOffset)&&t.defaultView.scrollTo(e,n)},kHe=function(t){var e=t[0],n=t[1],r=t[2];e.scrollLeft=n,e.scrollTop=r},xHe=":before",MHe=":after",SU="___html2canvas___pseudoelement_before",bU="___html2canvas___pseudoelement_after",Zz=`{
    content: "" !important;
    display: none !important;
}`,FHe=function(t){VHe(t,"."+SU+xHe+Zz+`
         .`+bU+MHe+Zz)},VHe=function(t,e){var n=t.ownerDocument;if(n){var r=n.createElement("style");r.textContent=e,t.appendChild(r)}},pie=function(){function t(){}return t.getOrigin=function(e){var n=t._link;return n?(n.href=e,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},t.isSameOrigin=function(e){return t.getOrigin(e)===t._origin},t.setContext=function(e){t._link=e.document.createElement("a"),t._origin=t.getOrigin(e.location.href)},t._origin="about:blank",t}(),QHe=function(){function t(e,n){this.context=e,this._options=n,this._cache={}}return t.prototype.addImage=function(e){var n=Promise.resolve();return this.has(e)||(K1(e)||GHe(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),n},t.prototype.match=function(e){return this._cache[e]},t.prototype.loadImage=function(e){return So(this,void 0,void 0,function(){var n,r,i,s,o=this;return io(this,function(a){switch(a.label){case 0:return n=pie.isSameOrigin(e),r=!j1(e)&&this._options.useCORS===!0&&Gs.SUPPORT_CORS_IMAGES&&!n,i=!j1(e)&&!n&&!K1(e)&&typeof this._options.proxy=="string"&&Gs.SUPPORT_CORS_XHR&&!r,!n&&this._options.allowTaint===!1&&!j1(e)&&!K1(e)&&!i&&!r?[2]:(s=e,i?[4,this.proxy(s)]:[3,2]);case 1:s=a.sent(),a.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(A,l){var d=new Image;d.onload=function(){return A(d)},d.onerror=l,(WHe(s)||r)&&(d.crossOrigin="anonymous"),d.src=s,d.complete===!0&&setTimeout(function(){return A(d)},500),o._options.imageTimeout>0&&setTimeout(function(){return l("Timed out ("+o._options.imageTimeout+"ms) loading image")},o._options.imageTimeout)})];case 3:return[2,a.sent()]}})})},t.prototype.has=function(e){return typeof this._cache[e]<"u"},t.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},t.prototype.proxy=function(e){var n=this,r=this._options.proxy;if(!r)throw new Error("No proxy defined");var i=e.substring(0,256);return new Promise(function(s,o){var a=Gs.SUPPORT_RESPONSE_TYPE?"blob":"text",A=new XMLHttpRequest;A.onload=function(){if(A.status===200)if(a==="text")s(A.response);else{var f=new FileReader;f.addEventListener("load",function(){return s(f.result)},!1),f.addEventListener("error",function(p){return o(p)},!1),f.readAsDataURL(A.response)}else o("Failed to proxy resource "+i+" with status code "+A.status)},A.onerror=o;var l=r.indexOf("?")>-1?"&":"?";if(A.open("GET",""+r+l+"url="+encodeURIComponent(e)+"&responseType="+a),a!=="text"&&A instanceof XMLHttpRequest&&(A.responseType=a),n._options.imageTimeout){var d=n._options.imageTimeout;A.timeout=d,A.ontimeout=function(){return o("Timed out ("+d+"ms) proxying "+i)}}A.send()})},t}(),HHe=/^data:image\/svg\+xml/i,jHe=/^data:image\/.*;base64,/i,KHe=/^data:image\/.*/i,GHe=function(t){return Gs.SUPPORT_SVG_DRAWING||!zHe(t)},j1=function(t){return KHe.test(t)},WHe=function(t){return jHe.test(t)},K1=function(t){return t.substr(0,4)==="blob"},zHe=function(t){return t.substr(-3).toLowerCase()==="svg"||HHe.test(t)},Je=function(){function t(e,n){this.type=0,this.x=e,this.y=n}return t.prototype.add=function(e,n){return new t(this.x+e,this.y+n)},t}(),pm=function(t,e,n){return new Je(t.x+(e.x-t.x)*n,t.y+(e.y-t.y)*n)},g0=function(){function t(e,n,r,i){this.type=1,this.start=e,this.startControl=n,this.endControl=r,this.end=i}return t.prototype.subdivide=function(e,n){var r=pm(this.start,this.startControl,e),i=pm(this.startControl,this.endControl,e),s=pm(this.endControl,this.end,e),o=pm(r,i,e),a=pm(i,s,e),A=pm(o,a,e);return n?new t(this.start,r,o,A):new t(A,a,s,this.end)},t.prototype.add=function(e,n){return new t(this.start.add(e,n),this.startControl.add(e,n),this.endControl.add(e,n),this.end.add(e,n))},t.prototype.reverse=function(){return new t(this.end,this.endControl,this.startControl,this.start)},t}(),ac=function(t){return t.type===1},qHe=function(){function t(e){var n=e.styles,r=e.bounds,i=hy(n.borderTopLeftRadius,r.width,r.height),s=i[0],o=i[1],a=hy(n.borderTopRightRadius,r.width,r.height),A=a[0],l=a[1],d=hy(n.borderBottomRightRadius,r.width,r.height),f=d[0],p=d[1],g=hy(n.borderBottomLeftRadius,r.width,r.height),y=g[0],E=g[1],w=[];w.push((s+A)/r.width),w.push((y+f)/r.width),w.push((o+E)/r.height),w.push((l+p)/r.height);var b=Math.max.apply(Math,w);b>1&&(s/=b,o/=b,A/=b,l/=b,f/=b,p/=b,y/=b,E/=b);var I=r.width-A,B=r.height-p,U=r.width-f,H=r.height-E,K=n.borderTopWidth,x=n.borderRightWidth,V=n.borderBottomWidth,M=n.borderLeftWidth,O=Dr(n.paddingTop,e.bounds.width),z=Dr(n.paddingRight,e.bounds.width),$=Dr(n.paddingBottom,e.bounds.width),q=Dr(n.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||o>0?Qr(r.left+M/3,r.top+K/3,s-M/3,o-K/3,qn.TOP_LEFT):new Je(r.left+M/3,r.top+K/3),this.topRightBorderDoubleOuterBox=s>0||o>0?Qr(r.left+I,r.top+K/3,A-x/3,l-K/3,qn.TOP_RIGHT):new Je(r.left+r.width-x/3,r.top+K/3),this.bottomRightBorderDoubleOuterBox=f>0||p>0?Qr(r.left+U,r.top+B,f-x/3,p-V/3,qn.BOTTOM_RIGHT):new Je(r.left+r.width-x/3,r.top+r.height-V/3),this.bottomLeftBorderDoubleOuterBox=y>0||E>0?Qr(r.left+M/3,r.top+H,y-M/3,E-V/3,qn.BOTTOM_LEFT):new Je(r.left+M/3,r.top+r.height-V/3),this.topLeftBorderDoubleInnerBox=s>0||o>0?Qr(r.left+M*2/3,r.top+K*2/3,s-M*2/3,o-K*2/3,qn.TOP_LEFT):new Je(r.left+M*2/3,r.top+K*2/3),this.topRightBorderDoubleInnerBox=s>0||o>0?Qr(r.left+I,r.top+K*2/3,A-x*2/3,l-K*2/3,qn.TOP_RIGHT):new Je(r.left+r.width-x*2/3,r.top+K*2/3),this.bottomRightBorderDoubleInnerBox=f>0||p>0?Qr(r.left+U,r.top+B,f-x*2/3,p-V*2/3,qn.BOTTOM_RIGHT):new Je(r.left+r.width-x*2/3,r.top+r.height-V*2/3),this.bottomLeftBorderDoubleInnerBox=y>0||E>0?Qr(r.left+M*2/3,r.top+H,y-M*2/3,E-V*2/3,qn.BOTTOM_LEFT):new Je(r.left+M*2/3,r.top+r.height-V*2/3),this.topLeftBorderStroke=s>0||o>0?Qr(r.left+M/2,r.top+K/2,s-M/2,o-K/2,qn.TOP_LEFT):new Je(r.left+M/2,r.top+K/2),this.topRightBorderStroke=s>0||o>0?Qr(r.left+I,r.top+K/2,A-x/2,l-K/2,qn.TOP_RIGHT):new Je(r.left+r.width-x/2,r.top+K/2),this.bottomRightBorderStroke=f>0||p>0?Qr(r.left+U,r.top+B,f-x/2,p-V/2,qn.BOTTOM_RIGHT):new Je(r.left+r.width-x/2,r.top+r.height-V/2),this.bottomLeftBorderStroke=y>0||E>0?Qr(r.left+M/2,r.top+H,y-M/2,E-V/2,qn.BOTTOM_LEFT):new Je(r.left+M/2,r.top+r.height-V/2),this.topLeftBorderBox=s>0||o>0?Qr(r.left,r.top,s,o,qn.TOP_LEFT):new Je(r.left,r.top),this.topRightBorderBox=A>0||l>0?Qr(r.left+I,r.top,A,l,qn.TOP_RIGHT):new Je(r.left+r.width,r.top),this.bottomRightBorderBox=f>0||p>0?Qr(r.left+U,r.top+B,f,p,qn.BOTTOM_RIGHT):new Je(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=y>0||E>0?Qr(r.left,r.top+H,y,E,qn.BOTTOM_LEFT):new Je(r.left,r.top+r.height),this.topLeftPaddingBox=s>0||o>0?Qr(r.left+M,r.top+K,Math.max(0,s-M),Math.max(0,o-K),qn.TOP_LEFT):new Je(r.left+M,r.top+K),this.topRightPaddingBox=A>0||l>0?Qr(r.left+Math.min(I,r.width-x),r.top+K,I>r.width+x?0:Math.max(0,A-x),Math.max(0,l-K),qn.TOP_RIGHT):new Je(r.left+r.width-x,r.top+K),this.bottomRightPaddingBox=f>0||p>0?Qr(r.left+Math.min(U,r.width-M),r.top+Math.min(B,r.height-V),Math.max(0,f-x),Math.max(0,p-V),qn.BOTTOM_RIGHT):new Je(r.left+r.width-x,r.top+r.height-V),this.bottomLeftPaddingBox=y>0||E>0?Qr(r.left+M,r.top+Math.min(H,r.height-V),Math.max(0,y-M),Math.max(0,E-V),qn.BOTTOM_LEFT):new Je(r.left+M,r.top+r.height-V),this.topLeftContentBox=s>0||o>0?Qr(r.left+M+q,r.top+K+O,Math.max(0,s-(M+q)),Math.max(0,o-(K+O)),qn.TOP_LEFT):new Je(r.left+M+q,r.top+K+O),this.topRightContentBox=A>0||l>0?Qr(r.left+Math.min(I,r.width+M+q),r.top+K+O,I>r.width+M+q?0:A-M+q,l-(K+O),qn.TOP_RIGHT):new Je(r.left+r.width-(x+z),r.top+K+O),this.bottomRightContentBox=f>0||p>0?Qr(r.left+Math.min(U,r.width-(M+q)),r.top+Math.min(B,r.height+K+O),Math.max(0,f-(x+z)),p-(V+$),qn.BOTTOM_RIGHT):new Je(r.left+r.width-(x+z),r.top+r.height-(V+$)),this.bottomLeftContentBox=y>0||E>0?Qr(r.left+M+q,r.top+H,Math.max(0,y-(M+q)),E-(V+$),qn.BOTTOM_LEFT):new Je(r.left+M+q,r.top+r.height-(V+$))}return t}(),qn;(function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",t[t.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(qn||(qn={}));var Qr=function(t,e,n,r,i){var s=4*((Math.sqrt(2)-1)/3),o=n*s,a=r*s,A=t+n,l=e+r;switch(i){case qn.TOP_LEFT:return new g0(new Je(t,l),new Je(t,l-a),new Je(A-o,e),new Je(A,e));case qn.TOP_RIGHT:return new g0(new Je(t,e),new Je(t+o,e),new Je(A,l-a),new Je(A,l));case qn.BOTTOM_RIGHT:return new g0(new Je(A,e),new Je(A,e+a),new Je(t+o,l),new Je(t,l));case qn.BOTTOM_LEFT:default:return new g0(new Je(A,l),new Je(A-o,l),new Je(t,e+a),new Je(t,e))}},Qb=function(t){return[t.topLeftBorderBox,t.topRightBorderBox,t.bottomRightBorderBox,t.bottomLeftBorderBox]},YHe=function(t){return[t.topLeftContentBox,t.topRightContentBox,t.bottomRightContentBox,t.bottomLeftContentBox]},Hb=function(t){return[t.topLeftPaddingBox,t.topRightPaddingBox,t.bottomRightPaddingBox,t.bottomLeftPaddingBox]},XHe=function(){function t(e,n,r){this.offsetX=e,this.offsetY=n,this.matrix=r,this.type=0,this.target=6}return t}(),_0=function(){function t(e,n){this.path=e,this.target=n,this.type=1}return t}(),JHe=function(){function t(e){this.opacity=e,this.type=2,this.target=6}return t}(),$He=function(t){return t.type===0},mie=function(t){return t.type===1},ZHe=function(t){return t.type===2},e7=function(t,e){return t.length===e.length?t.some(function(n,r){return n===e[r]}):!1},e3e=function(t,e,n,r,i){return t.map(function(s,o){switch(o){case 0:return s.add(e,n);case 1:return s.add(e+r,n);case 2:return s.add(e+r,n+i);case 3:return s.add(e,n+i)}return s})},gie=function(){function t(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return t}(),_ie=function(){function t(e,n){if(this.container=e,this.parent=n,this.effects=[],this.curves=new qHe(this.container),this.container.styles.opacity<1&&this.effects.push(new JHe(this.container.styles.opacity)),this.container.styles.transform!==null){var r=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new XHe(r,i,s))}if(this.container.styles.overflowX!==0){var o=Qb(this.curves),a=Hb(this.curves);e7(o,a)?this.effects.push(new _0(o,6)):(this.effects.push(new _0(o,2)),this.effects.push(new _0(a,4)))}}return t.prototype.getEffects=function(e){for(var n=[2,3].indexOf(this.container.styles.position)===-1,r=this.parent,i=this.effects.slice(0);r;){var s=r.effects.filter(function(A){return!mie(A)});if(n||r.container.styles.position!==0||!r.parent){if(i.unshift.apply(i,s),n=[2,3].indexOf(r.container.styles.position)===-1,r.container.styles.overflowX!==0){var o=Qb(r.curves),a=Hb(r.curves);e7(o,a)||i.unshift(new _0(a,6))}}else i.unshift.apply(i,s);r=r.parent}return i.filter(function(A){return cs(A.target,e)})},t}(),IU=function(t,e,n,r){t.container.elements.forEach(function(i){var s=cs(i.flags,4),o=cs(i.flags,2),a=new _ie(i,t);cs(i.styles.display,2048)&&r.push(a);var A=cs(i.flags,8)?[]:r;if(s||o){var l=s||i.styles.isPositioned()?n:e,d=new gie(a);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var f=i.styles.zIndex.order;if(f<0){var p=0;l.negativeZIndex.some(function(y,E){return f>y.element.container.styles.zIndex.order?(p=E,!1):p>0}),l.negativeZIndex.splice(p,0,d)}else if(f>0){var g=0;l.positiveZIndex.some(function(y,E){return f>=y.element.container.styles.zIndex.order?(g=E+1,!1):g>0}),l.positiveZIndex.splice(g,0,d)}else l.zeroOrAutoZIndexOrTransformedOrOpacity.push(d)}else i.styles.isFloating()?l.nonPositionedFloats.push(d):l.nonPositionedInlineLevel.push(d);IU(a,d,s?d:n,A)}else i.styles.isInlineLevel()?e.inlineLevel.push(a):e.nonInlineLevel.push(a),IU(a,e,n,A);cs(i.flags,8)&&Eie(i,A)})},Eie=function(t,e){for(var n=t instanceof wU?t.start:1,r=t instanceof wU?t.reversed:!1,i=0;i<e.length;i++){var s=e[i];s.container instanceof nie&&typeof s.container.value=="number"&&s.container.value!==0&&(n=s.container.value),s.listValue=jv(n,s.container.styles.listStyleType,!0),n+=r?-1:1}},t3e=function(t){var e=new _ie(t,null),n=new gie(e),r=[];return IU(e,n,n,r),Eie(e.container,r),n},t7=function(t,e){switch(e){case 0:return mc(t.topLeftBorderBox,t.topLeftPaddingBox,t.topRightBorderBox,t.topRightPaddingBox);case 1:return mc(t.topRightBorderBox,t.topRightPaddingBox,t.bottomRightBorderBox,t.bottomRightPaddingBox);case 2:return mc(t.bottomRightBorderBox,t.bottomRightPaddingBox,t.bottomLeftBorderBox,t.bottomLeftPaddingBox);case 3:default:return mc(t.bottomLeftBorderBox,t.bottomLeftPaddingBox,t.topLeftBorderBox,t.topLeftPaddingBox)}},n3e=function(t,e){switch(e){case 0:return mc(t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox,t.topRightBorderBox,t.topRightBorderDoubleOuterBox);case 1:return mc(t.topRightBorderBox,t.topRightBorderDoubleOuterBox,t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox);case 2:return mc(t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox,t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox);case 3:default:return mc(t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox,t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox)}},r3e=function(t,e){switch(e){case 0:return mc(t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox,t.topRightBorderDoubleInnerBox,t.topRightPaddingBox);case 1:return mc(t.topRightBorderDoubleInnerBox,t.topRightPaddingBox,t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox);case 2:return mc(t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox,t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox);case 3:default:return mc(t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox,t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox)}},i3e=function(t,e){switch(e){case 0:return E0(t.topLeftBorderStroke,t.topRightBorderStroke);case 1:return E0(t.topRightBorderStroke,t.bottomRightBorderStroke);case 2:return E0(t.bottomRightBorderStroke,t.bottomLeftBorderStroke);case 3:default:return E0(t.bottomLeftBorderStroke,t.topLeftBorderStroke)}},E0=function(t,e){var n=[];return ac(t)?n.push(t.subdivide(.5,!1)):n.push(t),ac(e)?n.push(e.subdivide(.5,!0)):n.push(e),n},mc=function(t,e,n,r){var i=[];return ac(t)?i.push(t.subdivide(.5,!1)):i.push(t),ac(n)?i.push(n.subdivide(.5,!0)):i.push(n),ac(r)?i.push(r.subdivide(.5,!0).reverse()):i.push(r),ac(e)?i.push(e.subdivide(.5,!1).reverse()):i.push(e),i},yie=function(t){var e=t.bounds,n=t.styles;return e.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},jb=function(t){var e=t.styles,n=t.bounds,r=Dr(e.paddingLeft,n.width),i=Dr(e.paddingRight,n.width),s=Dr(e.paddingTop,n.width),o=Dr(e.paddingBottom,n.width);return n.add(r+e.borderLeftWidth,s+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+i),-(e.borderTopWidth+e.borderBottomWidth+s+o))},s3e=function(t,e){return t===0?e.bounds:t===2?jb(e):yie(e)},o3e=function(t,e){return t===0?e.bounds:t===2?jb(e):yie(e)},G1=function(t,e,n){var r=s3e(Om(t.styles.backgroundOrigin,e),t),i=o3e(Om(t.styles.backgroundClip,e),t),s=a3e(Om(t.styles.backgroundSize,e),n,r),o=s[0],a=s[1],A=hy(Om(t.styles.backgroundPosition,e),r.width-o,r.height-a),l=c3e(Om(t.styles.backgroundRepeat,e),A,s,r,i),d=Math.round(r.left+A[0]),f=Math.round(r.top+A[1]);return[l,d,f,o,a]},mm=function(t){return pr(t)&&t.value===lg.AUTO},y0=function(t){return typeof t=="number"},a3e=function(t,e,n){var r=e[0],i=e[1],s=e[2],o=t[0],a=t[1];if(!o)return[0,0];if(qi(o)&&a&&qi(a))return[Dr(o,n.width),Dr(a,n.height)];var A=y0(s);if(pr(o)&&(o.value===lg.CONTAIN||o.value===lg.COVER)){if(y0(s)){var l=n.width/n.height;return l<s!=(o.value===lg.COVER)?[n.width,n.width/s]:[n.height*s,n.height]}return[n.width,n.height]}var d=y0(r),f=y0(i),p=d||f;if(mm(o)&&(!a||mm(a))){if(d&&f)return[r,i];if(!A&&!p)return[n.width,n.height];if(p&&A){var g=d?r:i*s,y=f?i:r/s;return[g,y]}var E=d?r:n.width,w=f?i:n.height;return[E,w]}if(A){var b=0,I=0;return qi(o)?b=Dr(o,n.width):qi(a)&&(I=Dr(a,n.height)),mm(o)?b=I*s:(!a||mm(a))&&(I=b/s),[b,I]}var B=null,U=null;if(qi(o)?B=Dr(o,n.width):a&&qi(a)&&(U=Dr(a,n.height)),B!==null&&(!a||mm(a))&&(U=d&&f?B/r*i:n.height),U!==null&&mm(o)&&(B=d&&f?U/i*r:n.width),B!==null&&U!==null)return[B,U];throw new Error("Unable to calculate background-size for element")},Om=function(t,e){var n=t[e];return typeof n>"u"?t[0]:n},c3e=function(t,e,n,r,i){var s=e[0],o=e[1],a=n[0],A=n[1];switch(t){case 2:return[new Je(Math.round(r.left),Math.round(r.top+o)),new Je(Math.round(r.left+r.width),Math.round(r.top+o)),new Je(Math.round(r.left+r.width),Math.round(A+r.top+o)),new Je(Math.round(r.left),Math.round(A+r.top+o))];case 3:return[new Je(Math.round(r.left+s),Math.round(r.top)),new Je(Math.round(r.left+s+a),Math.round(r.top)),new Je(Math.round(r.left+s+a),Math.round(r.height+r.top)),new Je(Math.round(r.left+s),Math.round(r.height+r.top))];case 1:return[new Je(Math.round(r.left+s),Math.round(r.top+o)),new Je(Math.round(r.left+s+a),Math.round(r.top+o)),new Je(Math.round(r.left+s+a),Math.round(r.top+o+A)),new Je(Math.round(r.left+s),Math.round(r.top+o+A))];default:return[new Je(Math.round(i.left),Math.round(i.top)),new Je(Math.round(i.left+i.width),Math.round(i.top)),new Je(Math.round(i.left+i.width),Math.round(i.height+i.top)),new Je(Math.round(i.left),Math.round(i.height+i.top))]}},A3e="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",n7="Hidden Text",l3e=function(){function t(e){this._data={},this._document=e}return t.prototype.parseMetrics=function(e,n){var r=this._document.createElement("div"),i=this._document.createElement("img"),s=this._document.createElement("span"),o=this._document.body;r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=n,r.style.margin="0",r.style.padding="0",r.style.whiteSpace="nowrap",o.appendChild(r),i.src=A3e,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",s.style.fontFamily=e,s.style.fontSize=n,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(n7)),r.appendChild(s),r.appendChild(i);var a=i.offsetTop-s.offsetTop+2;r.removeChild(s),r.appendChild(this._document.createTextNode(n7)),r.style.lineHeight="normal",i.style.verticalAlign="super";var A=i.offsetTop-r.offsetTop+2;return o.removeChild(r),{baseline:a,middle:A}},t.prototype.getMetrics=function(e,n){var r=e+" "+n;return typeof this._data[r]>"u"&&(this._data[r]=this.parseMetrics(e,n)),this._data[r]},t}(),vie=function(){function t(e,n){this.context=e,this.options=n}return t}(),u3e=1e4,d3e=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i._activeEffects=[],i.canvas=r.canvas?r.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),r.canvas||(i.canvas.width=Math.floor(r.width*r.scale),i.canvas.height=Math.floor(r.height*r.scale),i.canvas.style.width=r.width+"px",i.canvas.style.height=r.height+"px"),i.fontMetrics=new l3e(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-r.x,-r.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+r.width+"x"+r.height+") with scale "+r.scale),i}return e.prototype.applyEffects=function(n){for(var r=this;this._activeEffects.length;)this.popEffect();n.forEach(function(i){return r.applyEffect(i)})},e.prototype.applyEffect=function(n){this.ctx.save(),ZHe(n)&&(this.ctx.globalAlpha=n.opacity),$He(n)&&(this.ctx.translate(n.offsetX,n.offsetY),this.ctx.transform(n.matrix[0],n.matrix[1],n.matrix[2],n.matrix[3],n.matrix[4],n.matrix[5]),this.ctx.translate(-n.offsetX,-n.offsetY)),mie(n)&&(this.path(n.path),this.ctx.clip()),this._activeEffects.push(n)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(n){return So(this,void 0,void 0,function(){var r;return io(this,function(i){switch(i.label){case 0:return r=n.element.container.styles,r.isVisible()?[4,this.renderStackContent(n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(n){return So(this,void 0,void 0,function(){return io(this,function(r){switch(r.label){case 0:if(cs(n.container.flags,16))debugger;return n.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(n)]:[3,3];case 1:return r.sent(),[4,this.renderNodeContent(n)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(n,r,i){var s=this;if(r===0)this.ctx.fillText(n.text,n.bounds.left,n.bounds.top+i);else{var o=z2(n.text);o.reduce(function(a,A){return s.ctx.fillText(A,a,n.bounds.top+i),a+s.ctx.measureText(A).width},n.bounds.left)}},e.prototype.createFontStyle=function(n){var r=n.fontVariant.filter(function(o){return o==="normal"||o==="small-caps"}).join(""),i=g3e(n.fontFamily).join(", "),s=Rw(n.fontSize)?""+n.fontSize.number+n.fontSize.unit:n.fontSize.number+"px";return[[n.fontStyle,r,n.fontWeight,s,i].join(" "),i,s]},e.prototype.renderTextNode=function(n,r){return So(this,void 0,void 0,function(){var i,s,o,a,A,l,d,f,p=this;return io(this,function(g){return i=this.createFontStyle(r),s=i[0],o=i[1],a=i[2],this.ctx.font=s,this.ctx.direction=r.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",A=this.fontMetrics.getMetrics(o,a),l=A.baseline,d=A.middle,f=r.paintOrder,n.textBounds.forEach(function(y){f.forEach(function(E){switch(E){case 0:p.ctx.fillStyle=Es(r.color),p.renderTextWithLetterSpacing(y,r.letterSpacing,l);var w=r.textShadow;w.length&&y.text.trim().length&&(w.slice(0).reverse().forEach(function(b){p.ctx.shadowColor=Es(b.color),p.ctx.shadowOffsetX=b.offsetX.number*p.options.scale,p.ctx.shadowOffsetY=b.offsetY.number*p.options.scale,p.ctx.shadowBlur=b.blur.number,p.renderTextWithLetterSpacing(y,r.letterSpacing,l)}),p.ctx.shadowColor="",p.ctx.shadowOffsetX=0,p.ctx.shadowOffsetY=0,p.ctx.shadowBlur=0),r.textDecorationLine.length&&(p.ctx.fillStyle=Es(r.textDecorationColor||r.color),r.textDecorationLine.forEach(function(b){switch(b){case 1:p.ctx.fillRect(y.bounds.left,Math.round(y.bounds.top+l),y.bounds.width,1);break;case 2:p.ctx.fillRect(y.bounds.left,Math.round(y.bounds.top),y.bounds.width,1);break;case 3:p.ctx.fillRect(y.bounds.left,Math.ceil(y.bounds.top+d),y.bounds.width,1);break}}));break;case 1:r.webkitTextStrokeWidth&&y.text.trim().length&&(p.ctx.strokeStyle=Es(r.webkitTextStrokeColor),p.ctx.lineWidth=r.webkitTextStrokeWidth,p.ctx.lineJoin=window.chrome?"miter":"round",p.ctx.strokeText(y.text,y.bounds.left,y.bounds.top+l)),p.ctx.strokeStyle="",p.ctx.lineWidth=0,p.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(n,r,i){if(i&&n.intrinsicWidth>0&&n.intrinsicHeight>0){var s=jb(n),o=Hb(r);this.path(o),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,n.intrinsicWidth,n.intrinsicHeight,s.left,s.top,s.width,s.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(n){return So(this,void 0,void 0,function(){var r,i,s,o,a,A,I,I,l,d,f,p,U,g,y,H,E,w,b,I,B,U,H;return io(this,function(K){switch(K.label){case 0:this.applyEffects(n.getEffects(4)),r=n.container,i=n.curves,s=r.styles,o=0,a=r.textNodes,K.label=1;case 1:return o<a.length?(A=a[o],[4,this.renderTextNode(A,s)]):[3,4];case 2:K.sent(),K.label=3;case 3:return o++,[3,1];case 4:if(!(r instanceof Zre))return[3,8];K.label=5;case 5:return K.trys.push([5,7,,8]),[4,this.context.cache.match(r.src)];case 6:return I=K.sent(),this.renderReplacedElement(r,i,I),[3,8];case 7:return K.sent(),this.context.logger.error("Error loading image "+r.src),[3,8];case 8:if(r instanceof eie&&this.renderReplacedElement(r,i,r.canvas),!(r instanceof tie))return[3,12];K.label=9;case 9:return K.trys.push([9,11,,12]),[4,this.context.cache.match(r.svg)];case 10:return I=K.sent(),this.renderReplacedElement(r,i,I),[3,12];case 11:return K.sent(),this.context.logger.error("Error loading svg "+r.svg.substring(0,255)),[3,12];case 12:return r instanceof sie&&r.tree?(l=new e(this.context,{scale:this.options.scale,backgroundColor:r.backgroundColor,x:0,y:0,width:r.width,height:r.height}),[4,l.render(r.tree)]):[3,14];case 13:d=K.sent(),r.width&&r.height&&this.ctx.drawImage(d,0,0,r.width,r.height,r.bounds.left,r.bounds.top,r.bounds.width,r.bounds.height),K.label=14;case 14:if(r instanceof q2&&(f=Math.min(r.bounds.width,r.bounds.height),r.type===xb?r.checked&&(this.ctx.save(),this.path([new Je(r.bounds.left+f*.39363,r.bounds.top+f*.79),new Je(r.bounds.left+f*.16,r.bounds.top+f*.5549),new Je(r.bounds.left+f*.27347,r.bounds.top+f*.44071),new Je(r.bounds.left+f*.39694,r.bounds.top+f*.5649),new Je(r.bounds.left+f*.72983,r.bounds.top+f*.23),new Je(r.bounds.left+f*.84,r.bounds.top+f*.34085),new Je(r.bounds.left+f*.39363,r.bounds.top+f*.79)]),this.ctx.fillStyle=Es(jz),this.ctx.fill(),this.ctx.restore()):r.type===Mb&&r.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.bounds.left+f/2,r.bounds.top+f/2,f/4,0,Math.PI*2,!0),this.ctx.fillStyle=Es(jz),this.ctx.fill(),this.ctx.restore())),h3e(r)&&r.value.length){switch(p=this.createFontStyle(s),U=p[0],g=p[1],y=this.fontMetrics.getMetrics(U,g).baseline,this.ctx.font=U,this.ctx.fillStyle=Es(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=p3e(r.styles.textAlign),H=jb(r),E=0,r.styles.textAlign){case 1:E+=H.width/2;break;case 2:E+=H.width;break}w=H.add(E,0,0,-H.height/2+1),this.ctx.save(),this.path([new Je(H.left,H.top),new Je(H.left+H.width,H.top),new Je(H.left+H.width,H.top+H.height),new Je(H.left,H.top+H.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new zy(r.value,w),s.letterSpacing,y),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!cs(r.styles.display,2048))return[3,20];if(r.styles.listStyleImage===null)return[3,19];if(b=r.styles.listStyleImage,b.type!==0)return[3,18];I=void 0,B=b.url,K.label=15;case 15:return K.trys.push([15,17,,18]),[4,this.context.cache.match(B)];case 16:return I=K.sent(),this.ctx.drawImage(I,r.bounds.left-(I.width+10),r.bounds.top),[3,18];case 17:return K.sent(),this.context.logger.error("Error loading list-style-image "+B),[3,18];case 18:return[3,20];case 19:n.listValue&&r.styles.listStyleType!==-1&&(U=this.createFontStyle(s)[0],this.ctx.font=U,this.ctx.fillStyle=Es(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",H=new _u(r.bounds.left,r.bounds.top+Dr(r.styles.paddingTop,r.bounds.width),r.bounds.width,bz(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new zy(n.listValue,H),s.letterSpacing,bz(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),K.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(n){return So(this,void 0,void 0,function(){var r,i,b,s,o,b,a,A,b,l,d,b,f,p,b,g,y,b,E,w,b;return io(this,function(I){switch(I.label){case 0:if(cs(n.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(n.element)];case 1:I.sent(),r=0,i=n.negativeZIndex,I.label=2;case 2:return r<i.length?(b=i[r],[4,this.renderStack(b)]):[3,5];case 3:I.sent(),I.label=4;case 4:return r++,[3,2];case 5:return[4,this.renderNodeContent(n.element)];case 6:I.sent(),s=0,o=n.nonInlineLevel,I.label=7;case 7:return s<o.length?(b=o[s],[4,this.renderNode(b)]):[3,10];case 8:I.sent(),I.label=9;case 9:return s++,[3,7];case 10:a=0,A=n.nonPositionedFloats,I.label=11;case 11:return a<A.length?(b=A[a],[4,this.renderStack(b)]):[3,14];case 12:I.sent(),I.label=13;case 13:return a++,[3,11];case 14:l=0,d=n.nonPositionedInlineLevel,I.label=15;case 15:return l<d.length?(b=d[l],[4,this.renderStack(b)]):[3,18];case 16:I.sent(),I.label=17;case 17:return l++,[3,15];case 18:f=0,p=n.inlineLevel,I.label=19;case 19:return f<p.length?(b=p[f],[4,this.renderNode(b)]):[3,22];case 20:I.sent(),I.label=21;case 21:return f++,[3,19];case 22:g=0,y=n.zeroOrAutoZIndexOrTransformedOrOpacity,I.label=23;case 23:return g<y.length?(b=y[g],[4,this.renderStack(b)]):[3,26];case 24:I.sent(),I.label=25;case 25:return g++,[3,23];case 26:E=0,w=n.positiveZIndex,I.label=27;case 27:return E<w.length?(b=w[E],[4,this.renderStack(b)]):[3,30];case 28:I.sent(),I.label=29;case 29:return E++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(n){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(n.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(n){this.ctx.beginPath(),this.formatPath(n),this.ctx.closePath()},e.prototype.formatPath=function(n){var r=this;n.forEach(function(i,s){var o=ac(i)?i.start:i;s===0?r.ctx.moveTo(o.x,o.y):r.ctx.lineTo(o.x,o.y),ac(i)&&r.ctx.bezierCurveTo(i.startControl.x,i.startControl.y,i.endControl.x,i.endControl.y,i.end.x,i.end.y)})},e.prototype.renderRepeat=function(n,r,i,s){this.path(n),this.ctx.fillStyle=r,this.ctx.translate(i,s),this.ctx.fill(),this.ctx.translate(-i,-s)},e.prototype.resizeImage=function(n,r,i){var s;if(n.width===r&&n.height===i)return n;var o=(s=this.canvas.ownerDocument)!==null&&s!==void 0?s:document,a=o.createElement("canvas");a.width=Math.max(1,r),a.height=Math.max(1,i);var A=a.getContext("2d");return A.drawImage(n,0,0,n.width,n.height,0,0,r,i),a},e.prototype.renderBackgroundImage=function(n){return So(this,void 0,void 0,function(){var r,i,s,o,a,A;return io(this,function(l){switch(l.label){case 0:r=n.styles.backgroundImage.length-1,i=function(d){var f,p,g,O,re,Y,q,Ue,V,y,O,re,Y,q,Ue,E,w,b,I,B,U,H,K,x,V,M,O,z,$,q,Ue,fe,re,Y,Z,ae,j,C,L,k,ee,_e;return io(this,function(ke){switch(ke.label){case 0:if(d.type!==0)return[3,5];f=void 0,p=d.url,ke.label=1;case 1:return ke.trys.push([1,3,,4]),[4,s.context.cache.match(p)];case 2:return f=ke.sent(),[3,4];case 3:return ke.sent(),s.context.logger.error("Error loading background-image "+p),[3,4];case 4:return f&&(g=G1(n,r,[f.width,f.height,f.width/f.height]),O=g[0],re=g[1],Y=g[2],q=g[3],Ue=g[4],V=s.ctx.createPattern(s.resizeImage(f,q,Ue),"repeat"),s.renderRepeat(O,V,re,Y)),[3,6];case 5:$Ve(d)?(y=G1(n,r,[null,null,null]),O=y[0],re=y[1],Y=y[2],q=y[3],Ue=y[4],E=zVe(d.angle,q,Ue),w=E[0],b=E[1],I=E[2],B=E[3],U=E[4],H=document.createElement("canvas"),H.width=q,H.height=Ue,K=H.getContext("2d"),x=K.createLinearGradient(b,B,I,U),Tz(d.stops,w).forEach(function(ft){return x.addColorStop(ft.stop,Es(ft.color))}),K.fillStyle=x,K.fillRect(0,0,q,Ue),q>0&&Ue>0&&(V=s.ctx.createPattern(H,"repeat"),s.renderRepeat(O,V,re,Y))):ZVe(d)&&(M=G1(n,r,[null,null,null]),O=M[0],z=M[1],$=M[2],q=M[3],Ue=M[4],fe=d.position.length===0?[K2]:d.position,re=Dr(fe[0],q),Y=Dr(fe[fe.length-1],Ue),Z=qVe(d,re,Y,q,Ue),ae=Z[0],j=Z[1],ae>0&&j>0&&(C=s.ctx.createRadialGradient(z+re,$+Y,0,z+re,$+Y,ae),Tz(d.stops,ae*2).forEach(function(ft){return C.addColorStop(ft.stop,Es(ft.color))}),s.path(O),s.ctx.fillStyle=C,ae!==j?(L=n.bounds.left+.5*n.bounds.width,k=n.bounds.top+.5*n.bounds.height,ee=j/ae,_e=1/ee,s.ctx.save(),s.ctx.translate(L,k),s.ctx.transform(1,0,0,ee,0,0),s.ctx.translate(-L,-k),s.ctx.fillRect(z,_e*($-k)+k,q,Ue*_e),s.ctx.restore()):s.ctx.fill())),ke.label=6;case 6:return r--,[2]}})},s=this,o=0,a=n.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return o<a.length?(A=a[o],[5,i(A)]):[3,4];case 2:l.sent(),l.label=3;case 3:return o++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(n,r,i){return So(this,void 0,void 0,function(){return io(this,function(s){return this.path(t7(i,r)),this.ctx.fillStyle=Es(n),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(n,r,i,s){return So(this,void 0,void 0,function(){var o,a;return io(this,function(A){switch(A.label){case 0:return r<3?[4,this.renderSolidBorder(n,i,s)]:[3,2];case 1:return A.sent(),[2];case 2:return o=n3e(s,i),this.path(o),this.ctx.fillStyle=Es(n),this.ctx.fill(),a=r3e(s,i),this.path(a),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(n){return So(this,void 0,void 0,function(){var r,i,s,o,a,A,l,d,f=this;return io(this,function(p){switch(p.label){case 0:return this.applyEffects(n.getEffects(2)),r=n.container.styles,i=!Gd(r.backgroundColor)||r.backgroundImage.length,s=[{style:r.borderTopStyle,color:r.borderTopColor,width:r.borderTopWidth},{style:r.borderRightStyle,color:r.borderRightColor,width:r.borderRightWidth},{style:r.borderBottomStyle,color:r.borderBottomColor,width:r.borderBottomWidth},{style:r.borderLeftStyle,color:r.borderLeftColor,width:r.borderLeftWidth}],o=f3e(Om(r.backgroundClip,0),n.curves),i||r.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),Gd(r.backgroundColor)||(this.ctx.fillStyle=Es(r.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(n.container)]):[3,2];case 1:p.sent(),this.ctx.restore(),r.boxShadow.slice(0).reverse().forEach(function(g){f.ctx.save();var y=Qb(n.curves),E=g.inset?0:u3e,w=e3e(y,-E+(g.inset?1:-1)*g.spread.number,(g.inset?1:-1)*g.spread.number,g.spread.number*(g.inset?-2:2),g.spread.number*(g.inset?-2:2));g.inset?(f.path(y),f.ctx.clip(),f.mask(w)):(f.mask(y),f.ctx.clip(),f.path(w)),f.ctx.shadowOffsetX=g.offsetX.number+E,f.ctx.shadowOffsetY=g.offsetY.number,f.ctx.shadowColor=Es(g.color),f.ctx.shadowBlur=g.blur.number,f.ctx.fillStyle=g.inset?Es(g.color):"rgba(0,0,0,1)",f.ctx.fill(),f.ctx.restore()}),p.label=2;case 2:a=0,A=0,l=s,p.label=3;case 3:return A<l.length?(d=l[A],d.style!==0&&!Gd(d.color)&&d.width>0?d.style!==2?[3,5]:[4,this.renderDashedDottedBorder(d.color,d.width,a,n.curves,2)]:[3,11]):[3,13];case 4:return p.sent(),[3,11];case 5:return d.style!==3?[3,7]:[4,this.renderDashedDottedBorder(d.color,d.width,a,n.curves,3)];case 6:return p.sent(),[3,11];case 7:return d.style!==4?[3,9]:[4,this.renderDoubleBorder(d.color,d.width,a,n.curves)];case 8:return p.sent(),[3,11];case 9:return[4,this.renderSolidBorder(d.color,a,n.curves)];case 10:p.sent(),p.label=11;case 11:a++,p.label=12;case 12:return A++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(n,r,i,s,o){return So(this,void 0,void 0,function(){var a,A,l,d,f,p,g,y,E,w,b,I,B,U,H,K,H,K;return io(this,function(x){return this.ctx.save(),a=i3e(s,i),A=t7(s,i),o===2&&(this.path(A),this.ctx.clip()),ac(A[0])?(l=A[0].start.x,d=A[0].start.y):(l=A[0].x,d=A[0].y),ac(A[1])?(f=A[1].end.x,p=A[1].end.y):(f=A[1].x,p=A[1].y),i===0||i===2?g=Math.abs(l-f):g=Math.abs(d-p),this.ctx.beginPath(),o===3?this.formatPath(a):this.formatPath(A.slice(0,2)),y=r<3?r*3:r*2,E=r<3?r*2:r,o===3&&(y=r,E=r),w=!0,g<=y*2?w=!1:g<=y*2+E?(b=g/(2*y+E),y*=b,E*=b):(I=Math.floor((g+E)/(y+E)),B=(g-I*y)/(I-1),U=(g-(I+1)*y)/I,E=U<=0||Math.abs(E-B)<Math.abs(E-U)?B:U),w&&(o===3?this.ctx.setLineDash([0,y+E]):this.ctx.setLineDash([y,E])),o===3?(this.ctx.lineCap="round",this.ctx.lineWidth=r):this.ctx.lineWidth=r*2+1.1,this.ctx.strokeStyle=Es(n),this.ctx.stroke(),this.ctx.setLineDash([]),o===2&&(ac(A[0])&&(H=A[3],K=A[0],this.ctx.beginPath(),this.formatPath([new Je(H.end.x,H.end.y),new Je(K.start.x,K.start.y)]),this.ctx.stroke()),ac(A[1])&&(H=A[1],K=A[2],this.ctx.beginPath(),this.formatPath([new Je(H.end.x,H.end.y),new Je(K.start.x,K.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(n){return So(this,void 0,void 0,function(){var r;return io(this,function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=Es(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),r=t3e(n),[4,this.renderStack(r)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(vie),h3e=function(t){return t instanceof iie||t instanceof rie?!0:t instanceof q2&&t.type!==Mb&&t.type!==xb},f3e=function(t,e){switch(t){case 0:return Qb(e);case 2:return YHe(e);case 1:default:return Hb(e)}},p3e=function(t){switch(t){case 1:return"center";case 2:return"right";case 0:default:return"left"}},m3e=["-apple-system","system-ui"],g3e=function(t){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?t.filter(function(e){return m3e.indexOf(e)===-1}):t},_3e=function(t){iA(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.canvas=r.canvas?r.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=r,i.canvas.width=Math.floor(r.width*r.scale),i.canvas.height=Math.floor(r.height*r.scale),i.canvas.style.width=r.width+"px",i.canvas.style.height=r.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-r.x,-r.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+r.width+"x"+r.height+" at "+r.x+","+r.y+") with scale "+r.scale),i}return e.prototype.render=function(n){return So(this,void 0,void 0,function(){var r,i;return io(this,function(s){switch(s.label){case 0:return r=vU(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,n),[4,E3e(r)];case 1:return i=s.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=Es(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(vie),E3e=function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(t))})},y3e=function(){function t(e){var n=e.id,r=e.enabled;this.id=n,this.enabled=r,this.start=Date.now()}return t.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,$T([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},t.prototype.getTime=function(){return Date.now()-this.start},t.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,$T([this.id,this.getTime()+"ms"],e))},t.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,$T([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},t.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,$T([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},t.instances={},t}(),v3e=function(){function t(e,n){var r;this.windowBounds=n,this.instanceName="#"+t.instanceCount++,this.logger=new y3e({id:this.instanceName,enabled:e.logging}),this.cache=(r=e.cache)!==null&&r!==void 0?r:new QHe(this,e)}return t.instanceCount=1,t}(),r7=function(t,e){return e===void 0&&(e={}),w3e(t,e)};typeof window<"u"&&pie.setContext(window);var w3e=function(t,e){return So(void 0,void 0,void 0,function(){var n,r,i,s,o,a,A,l,d,f,p,g,y,E,w,b,I,B,U,H,x,K,x,V,M,O,z,$,q,Ue,fe,re,Y,Z,ae,j,C,L,k,ee;return io(this,function(_e){switch(_e.label){case 0:if(!t||typeof t!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(n=t.ownerDocument,!n)throw new Error("Element is not attached to a Document");if(r=n.defaultView,!r)throw new Error("Document is not attached to a Window");return i={allowTaint:(V=e.allowTaint)!==null&&V!==void 0?V:!1,imageTimeout:(M=e.imageTimeout)!==null&&M!==void 0?M:15e3,proxy:e.proxy,useCORS:(O=e.useCORS)!==null&&O!==void 0?O:!1},s=oU({logging:(z=e.logging)!==null&&z!==void 0?z:!0,cache:e.cache},i),o={windowWidth:($=e.windowWidth)!==null&&$!==void 0?$:r.innerWidth,windowHeight:(q=e.windowHeight)!==null&&q!==void 0?q:r.innerHeight,scrollX:(Ue=e.scrollX)!==null&&Ue!==void 0?Ue:r.pageXOffset,scrollY:(fe=e.scrollY)!==null&&fe!==void 0?fe:r.pageYOffset},a=new _u(o.scrollX,o.scrollY,o.windowWidth,o.windowHeight),A=new v3e(s,a),l=(re=e.foreignObjectRendering)!==null&&re!==void 0?re:!1,d={allowTaint:(Y=e.allowTaint)!==null&&Y!==void 0?Y:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:l,copyStyles:l},A.logger.debug("Starting document clone with size "+a.width+"x"+a.height+" scrolled to "+-a.left+","+-a.top),f=new $z(A,t,d),p=f.clonedReferenceElement,p?[4,f.toIFrame(n,a)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return g=_e.sent(),y=Y2(p)||THe(p)?eFe(p.ownerDocument):_R(A,p),E=y.width,w=y.height,b=y.left,I=y.top,B=C3e(A,p,e.backgroundColor),U={canvas:e.canvas,backgroundColor:B,scale:(ae=(Z=e.scale)!==null&&Z!==void 0?Z:r.devicePixelRatio)!==null&&ae!==void 0?ae:1,x:((j=e.x)!==null&&j!==void 0?j:0)+b,y:((C=e.y)!==null&&C!==void 0?C:0)+I,width:(L=e.width)!==null&&L!==void 0?L:Math.ceil(E),height:(k=e.height)!==null&&k!==void 0?k:Math.ceil(w)},l?(A.logger.debug("Document cloned, using foreign object rendering"),x=new _3e(A,U),[4,x.render(p)]):[3,3];case 2:return H=_e.sent(),[3,5];case 3:return A.logger.debug("Document cloned, element located at "+b+","+I+" with size "+E+"x"+w+" using computed rendering"),A.logger.debug("Starting DOM parsing"),K=aie(A,p),B===K.styles.backgroundColor&&(K.styles.backgroundColor=cu.TRANSPARENT),A.logger.debug("Starting renderer for element at "+U.x+","+U.y+" with size "+U.width+"x"+U.height),x=new d3e(A,U),[4,x.render(K)];case 4:H=_e.sent(),_e.label=5;case 5:return(!((ee=e.removeContainer)!==null&&ee!==void 0)||ee)&&($z.destroy(g)||A.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),A.logger.debug("Finished rendering"),[2,H]}})})},C3e=function(t,e,n){var r=e.ownerDocument,i=r.documentElement?Gy(t,getComputedStyle(r.documentElement).backgroundColor):cu.TRANSPARENT,s=r.body?Gy(t,getComputedStyle(r.body).backgroundColor):cu.TRANSPARENT,o=typeof n=="string"?Gy(t,n):n===null?cu.TRANSPARENT:4294967295;return e===r.documentElement?Gd(i)?Gd(s)?o:s:i:o};const T3e=({onSubmit:t,onClose:e,isOpen:n=!0})=>{console.log("Dialog render. isOpen:",n);const[r,i]=J.useState(""),[s,o]=J.useState("");J.useEffect(()=>{if(n){const A=setTimeout(()=>{const l=document.getElementById("call-title-input");l&&l.focus()},100);return()=>clearTimeout(A)}},[n]);const a=A=>{if(A.preventDefault(),!r.trim()){o("Please enter a title for this call");return}t(r.trim())};return D.jsxs(D.Fragment,{children:[console.log("Rendering dialog, isOpen:",n),n&&D.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:D.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-11/12 max-w-md",children:[D.jsxs("div",{className:"flex justify-between items-center border-b border-gray-200 dark:border-gray-700 p-4",children:[D.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Enter Video Call Title"}),D.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:D.jsx(cS,{size:20})})]}),D.jsx("div",{className:"p-6",children:D.jsxs("form",{onSubmit:a,children:[D.jsxs("div",{className:"mb-4",children:[D.jsx("label",{htmlFor:"call-title-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Call Purpose"}),D.jsx("input",{id:"call-title-input",type:"text",value:r,onChange:A=>{i(A.target.value),o("")},placeholder:"e.g. Patient Consultation",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:!0}),s&&D.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:s})]}),D.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[D.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600",children:"Cancel"}),D.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Start Call"})]})]})})]})})]})},S3e=J.forwardRef(({clientRef:t,isScreenSharing:e,setIsScreenSharing:n,setRemoteVideos:r,remoteVideoContainerRef:i,localVideoTrackRef:s},o)=>{const a=J.useRef(null),A=J.useRef(null),l=async()=>{try{if(!t.current){console.error("Agora client not initialized");return}s.current&&(A.current=s.current,await t.current.unpublish(s.current));const f=await Kn.createScreenVideoTrack({encoderConfig:{width:1920,height:1080,frameRate:30,bitrateMin:1e3,bitrateMax:3e3},optimizationMode:"detail"});a.current=f;let p=document.getElementById("screen-share-container");if(!p){if(p=document.createElement("div"),p.id="screen-share-container",p.className="screen-share-container",!i.current){const g=document.createElement("div");g.id="remote-video-container",g.className="remote-video-container",document.body.appendChild(g),i.current=g}i.current.appendChild(p)}i.current.classList.add("screen-sharing-active"),await f.play(p),console.log("Screen track playing successfully"),await t.current.publish(f),console.log("Screen sharing track published successfully"),r(g=>({...g,screen:f})),n(!0),f.on("track-ended",()=>{console.log("Screen sharing ended by user"),d()}),f.on("track-error",g=>{console.error("Screen sharing error:",g),d()})}catch(f){console.error("Error starting screen share:",f),n(!1),a.current&&(a.current.close(),a.current=null),A.current&&await t.current.publish(A.current)}},d=async()=>{try{if(a.current){await t.current.unpublish(a.current),a.current.close(),a.current=null,r(p=>{const g={...p};return delete g.screen,g});const f=document.getElementById("screen-share-container");f&&f.remove(),i.current&&i.current.classList.remove("screen-sharing-active"),A.current&&(await t.current.publish(A.current),A.current=null)}n(!1)}catch(f){console.error("Error stopping screen share:",f)}};return J.useImperativeHandle(o,()=>({startScreenShare:l,stopScreenShare:d})),J.useEffect(()=>()=>{a.current&&d()},[]),null}),Gc={isActive:!1,isFrozen:!1,capturedFrame:null,freezeInProgress:!1,fallbackImage:null,createFallbackImage:()=>{try{const t=document.createElement("canvas");t.width=640,t.height=480;const e=t.getContext("2d"),n=e.createLinearGradient(0,0,640,480);return n.addColorStop(0,"#1a365d"),n.addColorStop(1,"#2a4365"),e.fillStyle=n,e.fillRect(0,0,640,480),e.font="24px Arial",e.fillStyle="white",e.textAlign="center",e.fillText("Video Feed Frozen",320,220),e.font="16px Arial",e.fillText(new Date().toLocaleTimeString(),320,250),t.toDataURL("image/jpeg",.9)}catch(t){return console.error("Error creating fallback image:",t),null}},initialize:()=>{Gc.fallbackImage=Gc.createFallbackImage(),window.FreezeManager=Gc}};Gc.initialize();const b3e=({onCallEnd:t})=>{var Sh,fA,Po;const[e,n]=J.useState([]),[r,i]=J.useState(""),[s,o]=J.useState(!1),[a,A]=J.useState(""),[l,d]=J.useState(!1),[f,p]=J.useState(!1),[g,y]=J.useState(!1),[E,w]=J.useState(!1),[b,I]=J.useState(!1),[B,U]=J.useState(null),[H,K]=J.useState({}),[x,V]=J.useState(null),[M,O]=J.useState(!1),[z,$]=J.useState(0),[q,Ue]=J.useState("Remote Consultation"),[fe,re]=J.useState(!1),[Y,Z]=J.useState(!1),[ae,j]=J.useState(null),[C,L]=J.useState({}),[k,ee]=J.useState(!1),[_e,ke]=J.useState(null),[ft,Rt]=J.useState(!0),[Gr,Xi]=J.useState(!1),[Ls,Ur]=J.useState(!0),[Wr,kr]=J.useState(!1),[qt,$t]=J.useState(!1),[pt,Gn]=J.useState([]),[br,Kt]=J.useState([]),[at,er]=J.useState(!1),[xe,ze]=J.useState(""),[ut,$e]=J.useState(!1),[et,on]=J.useState("participant"),[mn,Wn]=J.useState({}),[Ji,xr]=J.useState({canShareScreen:!0,canRecord:!1,canAnnotate:!0,canSendMessages:!0,canInviteOthers:!1}),[Ps,na]=J.useState(!0),[zr,Us]=J.useState([]),[bc,sA]=J.useState(!1),[Cu,Tu]=J.useState(!1),[oA,Ic]=J.useState([]),[tp,Pa]=J.useState(null),[fo,ra]=J.useState("grid"),[fh,aA]=J.useState([]),[Rc,Ir]=J.useState({x:0,y:0}),[Vi,bi]=J.useState(!1),[$i,ph]=J.useState(!1),[Su,cA]=J.useState({x:0,y:0}),[np,Oc]=J.useState({}),ia=J.useRef({x:0,y:0,time:0}),Pn=J.useRef(null),Qi=J.useRef(null),po=J.useRef(null),gr=J.useRef(null),qr=J.useRef(B);J.useRef(null);const mh=J.useRef(null),Ii=J.useRef(null),ks=J.useRef(null),mo=J.useRef(null);J.useRef(!1),J.useRef(0),J.useRef(0);const gh=J.useRef(null),_h=J.useRef(null),AA=J.useRef(null),[lA]=Cae(),Ge=lA.get("callId"),mt=lA.get("uid"),Ri=lA.get("title"),uA=zg(),rp="de690d378ebd4634a39ed1a2c3d6e663",Nc=null,dA=()=>{console.log("Ending call...");try{Ii.current&&Jr(Ii.current,{endCall:"true"}),window._cursorDataChannel&&(window._cursorDataChannel.close(),window._cursorDataChannel=null),Qi.current&&(Qi.current.close(),Qi.current=null),window._screenTrack&&(window._screenTrack.close(),window._screenTrack=null),Pn.current&&Pn.current.leave().then(()=>{console.log("Successfully left the channel")}).catch(ce=>{console.error("Error leaving channel:",ce)}),ks.current&&clearInterval(ks.current),$e(!0)}catch(ce){console.error("Error ending call:",ce),$e(!0)}},bu=async ce=>{if(console.log("[ICE] handleFreeze called with parameter:",ce),console.log("[ICE] Current freeze state:",f),!Ge){console.error("Cannot toggle freeze: callId not available."),A("Call ID is missing, cannot toggle freeze."),setTimeout(()=>A(""),3e3);return}const Ee=Xe(tt,`videoCalls/${Ge}`),ye=ce!==void 0?ce?"on":"off":f?"off":"on";console.log("[ICE] Calculated new freeze state:",ye);try{if(ye==="on"&&!B){console.log("[ICE] Capturing frame before setting freeze state");const Me=await us();console.log("[ICE] Frame captured:",Me?"success":"failed")}console.log(`[ICE] Setting freeze state in Firebase to: ${ye} for call ${Ge}`),await Jr(Ee,{freeze:ye}),p(ye==="on"),O(ye==="on"),ye==="off"&&(console.log("[ICE] UNFREEZE SEQUENCE STARTING"),kr(!0),Ua(),setTimeout(()=>{console.log("[ICE] Now clearing frozen frame"),U(null),window.FreezeManager&&(window.FreezeManager.capturedFrame=null),setTimeout(()=>{Object.keys(H).length===0&&(console.log("[ICE] Still no video after unfreezing, trying one final media rebuild"),Ua())},500)},2500))}catch(Me){console.error("Error toggling freeze state in Firebase:",Me),A("Failed to toggle video freeze state."),setTimeout(()=>A(""),3e3)}},Ua=()=>{var Ee;console.log("[ICE] REBUILD: Starting full media connection rebuild"),kr(!0);const ce=((Ee=Pn.current)==null?void 0:Ee.remoteUsers)||[];if(console.log(`[ICE] REBUILD: Found ${ce.length} remote users`),ce.length===0){console.log("[ICE] REBUILD: No remote users found, will try again in 1 second"),setTimeout(Ua,1e3);return}ce.forEach(ye=>{if(ye.videoTrack){const Me=document.getElementById(`player-${ye.uid}`);if(Me)try{console.log(`[ICE] REBUILD: Reinitializing video for ${ye.uid}`);try{ye.videoTrack.stop()}catch(it){console.log(`[ICE] REBUILD: Ignoring stop error: ${it.message}`)}setTimeout(()=>{try{ye.videoTrack.play(Me.id,{fit:"cover"}),console.log(`[ICE] REBUILD: Successfully rebuilt video for ${ye.uid}`),K(it=>({...it,[ye.uid]:ye.videoTrack}))}catch(it){console.error(`[ICE] REBUILD: Failed to play video for ${ye.uid}:`,it)}},200)}catch(it){console.warn(`[ICE] REBUILD: Error handling video for ${ye.uid}:`,it)}else console.warn(`[ICE] REBUILD: Could not find player div for user ${ye.uid}`)}if(ye.audioTrack)try{console.log(`[ICE] REBUILD: Reinitializing audio for ${ye.uid}`);try{ye.audioTrack.stop()}catch(Me){console.log(` REBUILD: Ignoring audio stop error: ${Me.message}`)}setTimeout(()=>{try{ye.audioTrack.play(),console.log(` REBUILD: Successfully rebuilt audio for ${ye.uid}`)}catch(Me){console.warn(" REBUILD: Error playing audio:",Me)}},200)}catch(Me){console.warn(` REBUILD: Error handling audio for ${ye.uid}:`,Me)}}),console.log(" REBUILD: Media connection rebuild completed")};J.useEffect(()=>{const ce=()=>{mo.current&&clearTimeout(mo.current),Rt(!0),mo.current=setTimeout(()=>{Rt(!1)},5e3)};ce();const Ee=()=>ce();return document.addEventListener("mousemove",Ee),document.addEventListener("click",Ee),document.addEventListener("keydown",Ee),()=>{mo.current&&clearTimeout(mo.current),document.removeEventListener("mousemove",Ee),document.removeEventListener("click",Ee),document.removeEventListener("keydown",Ee)}},[]);const Iu=()=>{document.fullscreenElement?document.exitFullscreen&&(document.exitFullscreen(),Xi(!1)):(AA.current.requestFullscreen().catch(ce=>{console.error(`Error attempting to enable full-screen mode: ${ce.message}`)}),Xi(!0))};J.useEffect(()=>{const ce=()=>{Xi(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",ce),()=>{document.removeEventListener("fullscreenchange",ce)}},[]),J.useEffect(()=>{Ue(Ri||"Remote Consultation"),mt&&(gh.current=mt)},[Ri,mt]),J.useEffect(()=>{if(Ge){const ce=Xe(tt,`videoCalls/${Ge}/endCall`),Ee=ya(ce,ye=>{ye.exists()&&ye.val()==="true"&&dA()});return()=>Ee()}},[Ge,dA]),J.useEffect(()=>{var ce,Ee;if(Ge){Ii.current=Xe(tt,`videoCalls/${Ge}`);const ye=((ce=Ul.currentUser)==null?void 0:ce.displayName)||`User ${mt.substring(0,6)}`;(Ee=Ul.currentUser)!=null&&Ee.uid;const Me=Xe(tt,`calls/${Ge}`);Pi(Me).then(Tt=>{if(!Tt.exists()){Zr(Me,{createdAt:Date.now(),createdBy:mt,waitingRoomEnabled:!0,viewMode:"grid",raisedHands:[],pinnedUsers:[],spotlightUser:null});const Zt=Xe(tt,`calls/${Ge}/participants/${mt}`);Zr(Zt,{name:ye,joinTime:Date.now(),role:"host",isMuted:!1,hasVideo:!0,networkQuality:5}),on("host"),xr({canShareScreen:!0,canRecord:!0,canAnnotate:!0,canSendMessages:!0,canInviteOthers:!0})}}),(async()=>{await yh(Ge)})(),Pi(Ii.current).then(Tt=>{Tt.exists()&&Tt.val().purpose&&Ue(Tt.val().purpose)}),ks.current=setInterval(()=>{$(Tt=>Tt+1)},1e3);const yn=Xe(tt,`videoCalls/${Ge}/annotations`),Gt=ya(yn,Tt=>{Tt.exists()&&L(Tt.val())});return()=>{Pn.current&&Pn.current.leave(),Qi.current&&Qi.current.close(),ks.current&&clearInterval(ks.current),Gt()}}},[Ge]),J.useEffect(()=>{if(Ge){const ce=Xe(tt,`videoCalls/${Ge}/freeze`),Ee=ya(ce,ye=>{const Me=ye.val();console.log(" Firebase freeze state changed:",Me);const it=Me==="on";p(it),O(it),console.log(" Updated local state - isVideoFrozen:",it),it&&!B?(console.log(" No frozen frame available, capturing video frame"),us()):it||(console.log(" FIREBASE UNFREEZE DETECTED"),kr(!0),Ua(),setTimeout(()=>{console.log(" First scheduled rebuild (500ms)"),Ua(),setTimeout(()=>{console.log(" Second scheduled rebuild (1500ms)"),Ua(),setTimeout(()=>{console.log(" Final scheduled task: clearing frozen frame (3000ms)"),U(null),window.FreezeManager&&(window.FreezeManager.capturedFrame=null)},1500)},1e3)},500))});return()=>Ee()}},[Ge,B]),J.useEffect(()=>{if(Ge){const ce=Xe(tt,`videoCalls/${Ge}`);Pi(ce).then(Ee=>{var ye;V(((ye=Ee.val())==null?void 0:ye.stopVideo)||"stop")})}},[Ge]);const us=()=>{if(console.log(" captureVideoFrame function called"),Gc.capturedFrame)return console.log(" Using existing cached frame"),U(Gc.capturedFrame),Gc.capturedFrame;console.log(" No cached frame found, attempting to capture new frame");try{if(gr.current){const Ee=document.querySelectorAll("video"),ye=gr.current.querySelectorAll("video");for(const Me of[...Ee,...ye])if(Me&&Me.videoWidth&&Me.videoHeight&&!Me.paused){const it=document.createElement("canvas");it.width=Me.videoWidth,it.height=Me.videoHeight,it.getContext("2d").drawImage(Me,0,0,it.width,it.height);const Gt=it.toDataURL("image/jpeg",.9);return console.log(" Successfully captured video frame"),Gc.capturedFrame=Gt,U(Gt),kr(!0),console.log(" Setting wasInCall=true during freeze"),Ii.current&&Jr(Ii.current,{frozenFrameUrl:Gt}),Gt}}}catch(Ee){console.warn("First capture approach failed:",Ee)}if(typeof r7<"u")try{const Ee=gr.current;Ee&&r7(Ee,{useCORS:!0,allowTaint:!0,backgroundColor:"#000000"}).then(ye=>{const Me=ye.toDataURL("image/jpeg",.9);console.log(" Successfully captured frame using html2canvas"),Gc.capturedFrame=Me,U(Me),kr(!0),console.log(" Setting wasInCall=true during freeze (html2canvas method)"),Ii.current&&Jr(Ii.current,{frozenFrameUrl:Me})})}catch(Ee){console.warn("HTML2Canvas approach failed:",Ee)}const ce=Gc.fallbackImage||Gc.createFallbackImage();return ce&&(U(ce),Ii.current&&Jr(Ii.current,{frozenFrameUrl:ce})),null},Eh=ce=>{const Ee=Math.floor(ce/3600),ye=Math.floor(ce%3600/60),Me=ce%60;return[Ee>0?Ee.toString().padStart(2,"0"):null,ye.toString().padStart(2,"0"),Me.toString().padStart(2,"0")].filter(Boolean).join(":")},C_=()=>{navigator.clipboard.writeText(Ge),re(!0),setTimeout(()=>re(!1),2e3)},pl=()=>{const ce=`${window.location.origin}/join?callId=${Ge}`;navigator.share?navigator.share({title:`Join ${q}`,text:"Join my video call session",url:ce}).catch(Ee=>console.error("Share failed:",Ee)):(navigator.clipboard.writeText(ce),re(!0),setTimeout(()=>re(!1),2e3))},yh=async ce=>{Pn.current=Kn.createClient({mode:"rtc",codec:"vp8",statsReportInterval:0}),_h.current=Pn.current;try{await Pn.current.join(rp,ce,Nc,null),console.log("Successfully joined Agora channel:",ce),ee(!0),Pn.current.on("user-published",T_),Pn.current.on("user-unpublished",Ai),Pn.current.on("user-left",go),Pn.current.on("exception",Ee=>{console.warn("Agora exception:",Ee)}),xa(),await ml(),Ii.current&&Pi(Ii.current).then(Ee=>{Ee.exists()||Zr(Ii.current,{freeze:"off",annotations:{},frozenFrameUrl:null})})}catch(Ee){console.error("Agora initialization error:",Ee),A("Failed to join call"),ee(!1)}},ml=async()=>{try{Qi.current=await Kn.createMicrophoneAudioTrack(),Qi.current.setMuted(l);const ce=await Kn.createCameraVideoTrack();po.current=ce,ce.play("local-player"),document.getElementById("local-player")?(console.log("Playing local video in local-player container"),po.current.play("local-player",{fit:"cover"})):console.error("Local video container not found"),await Pn.current.publish([Qi.current,ce]),console.log(`Audio and video tracks published, audio muted: ${l}`)}catch(ce){console.error("Error joining channel:",ce),ce.message&&ce.message.includes("video")?A("Failed to initialize video. Please check camera permissions."):ce.message&&ce.message.includes("audio")?A("Failed to initialize audio. Please check microphone permissions."):A("Failed to initialize audio/video tracks")}},T_=async(ce,Ee)=>{console.log(`User ${ce.uid} published ${Ee}`);try{if(await Pn.current.subscribe(ce,Ee),console.log(`Subscribed to ${Ee} track from user ${ce.uid}`),Ee==="video"){const ye=document.createElement("div");ye.id=`player-${ce.uid}`,ye.className="remote-player",gr.current&&(gr.current.appendChild(ye),ce.videoTrack.play(ye),K(Me=>({...Me,[ce.uid]:ce.videoTrack})))}Ee==="audio"&&ce.audioTrack.play()}catch(ye){console.error("Error handling user published event:",ye)}},Ai=async(ce,Ee)=>{try{if(await Pn.current.unsubscribe(ce,Ee),Ee==="video"){const ye=document.getElementById(`player-${ce.uid}`);ye&&ye.remove()}}catch(ye){console.error("Error handling user unpublished event:",ye)}},go=ce=>{console.log(`User ${ce.uid} left`);const Ee=document.getElementById(`player-${ce.uid}`);Ee&&Ee.parentNode&&Ee.parentNode.removeChild(Ee),Oc(ye=>{const Me={...ye};return delete Me[ce.uid],Me}),K(ye=>{const Me={...ye};return delete Me[ce.uid],Me}),ae===ce.uid&&(Z(!1),j(null))},gl=()=>{o(!1)},hA=ce=>{Kt(Ee=>Ee.includes(ce)?Ee.filter(ye=>ye!==ce):[...Ee,ce])},ka=async()=>{console.log("Fetching available users..."),er(!0);try{const ce=lA.get("uid")||(Ul.currentUser?Ul.currentUser.uid:null);if(!ce){console.error("No user ID available"),er(!1);return}let Ee=[];try{const Me=Xe(tt,`videoCalls/${Ge}`),it=await Pi(Me);if(it.exists()){const yn=it.val();yn.users&&(Array.isArray(yn.users)?Ee=yn.users:typeof yn.users=="object"&&(Ee=Object.keys(yn.users))),console.log("Active participants:",Ee)}}catch(Me){console.error("Error fetching active participants:",Me)}let ye=[];try{const Me=Xe(tt,"active_users"),it=await Pi(Me);it.exists()&&it.forEach(yn=>{const Gt=yn.key;Gt!==ce&&!Ee.includes(Gt)&&ye.push(Gt)})}catch(Me){console.error("Error fetching online users:",Me)}if(ye.length===0)try{const Me=Xe(tt,"users"),it=await Pi(Me);it.exists()&&it.forEach(yn=>{const Gt=yn.key;Gt!==ce&&!Ee.includes(Gt)&&ye.push(Gt)})}catch(Me){console.error("Error fetching all users:",Me)}console.log("Users available to invite:",ye),Gn(ye),ye.length===0&&(console.log("No users found in database, using test users for development"),Gn(["user1","user2","user3","user4","user5"]))}catch(ce){console.error("Error in fetchAvailableUsers:",ce),Gn(["test1","test2","test3"])}finally{er(!1)}},zn=async()=>{var ce;if(br.length!==0){er(!0);try{const Ee=((ce=Ul.currentUser)==null?void 0:ce.uid)||mt;let ye=Ee;try{const Tt=Xe(tt,`users/${Ee}`),Zt=await Pi(Tt);if(Zt.exists()){const Nt=Zt.val();(Nt.name||Nt.displayName||Nt.email)&&(ye=Nt.name||Nt.displayName||Nt.email)}}catch(Tt){console.log("Could not fetch sender name",Tt)}const Me=Xe(tt,`videoCalls/${Ge}`),it=await Pi(Me),Gt=(it.exists()?it.val():{}).title||lA.get("title")||"Untitled Call";await Promise.all(br.map(async Tt=>{const Zt=Xe(tt,`active_users/${Tt}/incoming_calls`),Nt=ML(Zt);await Zr(Nt,{id:Nt.key,roomId:Ge,userId:Ee,name:ye,status:"pending",timestamp:Date.now(),title:Gt,isNew:!0,type:"invitation"}),await Jr(Xe(tt,`videoCalls/${Ge}`),{[`users/${Tt}`]:{invited:!0,invitedBy:Ee,invitedAt:Date.now(),status:"invited"}});const Ht=Xe(tt,`active_users/${Tt}/notifications`);await Zr(Ht,{type:"call_invitation",callId:Ge,senderId:Ee,senderName:ye,message:`${ye} is inviting you to join a call: ${Gt}`,timestamp:Date.now()})})),$t(!1),Kt([])}catch(Ee){console.error("Error sending invitations:",Ee),alert("Failed to send invitations: "+Ee.message)}finally{er(!1)}}},_l=ce=>{if(!Ge)return;const Ee=Xe(tt,`calls/${Ge}`);Jr(Ee,{waitingRoomEnabled:ce}).then(()=>{na(ce)}).catch(ye=>{console.error("Error toggling waiting room:",ye)})},Bo=ce=>{if(!Ge)return;const Ee=Xe(tt,`calls/${Ge}/waitingRoom/${ce}`);Pi(Ee).then(ye=>{if(ye.exists()){const Me=ye.val(),it={};it[`calls/${Ge}/waitingRoom/${ce}`]=null,it[`calls/${Ge}/participants/${ce}`]={...Me,licenseId:ce,joinTime:Date.now(),role:"participant"},Jr(Xe(tt),it).then(()=>{Us(yn=>yn.filter(Gt=>Gt.id!==ce))}).catch(yn=>{console.error("Error admitting user:",yn)})}})},El=ce=>{if(!Ge)return;const Ee=Xe(tt,`calls/${Ge}/waitingRoom/${ce}`);Jr(Ee,{denied:!0}).then(()=>{Us(ye=>ye.filter(Me=>Me.id!==ce))}).catch(ye=>{console.error("Error denying user:",ye)})},ip=()=>{if(!Ge||zr.length===0)return;const ce={};zr.forEach(Ee=>{ce[`calls/${Ge}/waitingRoom/${Ee.id}`]=null,ce[`calls/${Ge}/participants/${Ee.id}`]={name:Ee.name,licenseId:Ee.id,joinTime:Date.now(),role:"participant"}}),Jr(Xe(tt),ce).then(()=>{Us([])}).catch(Ee=>{console.error("Error admitting all users:",Ee)})},vh=()=>{if(!Ge||zr.length===0)return;const ce={};zr.forEach(Ee=>{ce[`calls/${Ge}/waitingRoom/${Ee.id}/denied`]=!0}),Jr(Xe(tt),ce).then(()=>{Us([])}).catch(Ee=>{console.error("Error denying all users:",Ee)})},wh=()=>{Tu(ce=>!ce)},Ch=ce=>{if(["grid","speaker","sidebar"].includes(ce)&&(ra(ce),et==="host"&&Ge)){const Ee=Xe(tt,`calls/${Ge}`);Jr(Ee,{viewMode:ce})}},S_=ce=>{if(!Ge||et!=="host")return;const Ee=Xe(tt,`calls/${Ge}/participants/${ce}`);Jr(Ee,{removed:!0}).then(()=>{const ye={...mn};delete ye[ce],Wn(ye)})};J.useEffect(()=>{if(!Ge)return;const ce=Xe(tt,`calls/${Ge}/participants`),Ee=ya(ce,Tt=>{if(Tt.exists()){const Zt=Tt.val();if(Wn(Zt),Zt[mt]&&Zt[mt].role){on(Zt[mt].role);const Nt=Zt[mt].role;xr({canShareScreen:Nt==="host"||Nt==="participant",canRecord:Nt==="host",canAnnotate:Nt==="host"||Nt==="participant",canSendMessages:Nt==="host"||Nt==="participant",canInviteOthers:Nt==="host"})}}}),ye=Xe(tt,`calls/${Ge}/waitingRoom`),Me=ya(ye,Tt=>{if(Tt.exists()){const Zt=Tt.val(),Nt=Object.entries(Zt).filter(([,Ht])=>!Ht.denied).map(([Ht,xs])=>({id:Ht,name:xs.name||`User ${Ht.substring(0,6)}`,joinTime:xs.joinTime||Date.now()}));Us(Nt),et==="host"&&Nt.length>0&&!bc&&sA(!0)}else Us([])}),it=Xe(tt,`calls/${Ge}`),yn=ya(it,Tt=>{if(Tt.exists()){const Zt=Tt.val();"waitingRoomEnabled"in Zt&&na(Zt.waitingRoomEnabled),"spotlightUser"in Zt&&Pa(Zt.spotlightUser),"raisedHands"in Zt&&Ic(Zt.raisedHands||[]),"viewMode"in Zt&&et!=="host"&&ra(Zt.viewMode),"pinnedUsers"in Zt&&aA(Zt.pinnedUsers||[])}});return(async()=>{var Tt,Zt;if(!(!Ge||!mt))try{const Nt=Xe(tt,`calls/${Ge}`),Ht=await Pi(Nt);if(Ht.exists()){const xs=Ht.val(),ds=await Pi(Xe(tt,`calls/${Ge}/participants/${mt}`));if(ds.exists()){const Js=ds.val();on(Js.role||"participant");const _o=Js.role||"participant";xr({canShareScreen:_o==="host"||_o==="participant",canRecord:_o==="host",canAnnotate:_o==="host"||_o==="participant",canSendMessages:_o==="host"||_o==="participant",canInviteOthers:_o==="host"});return}const pA=((Tt=Ul.currentUser)==null?void 0:Tt.displayName)||`User ${mt.substring(0,6)}`;if(xs.waitingRoomEnabled&&xs.createdBy!==mt){const Js=Xe(tt,`calls/${Ge}/waitingRoom/${mt}`);await Zr(Js,{name:pA,joinTime:Date.now()}),console.log("User added to waiting room")}else{const Js=Xe(tt,`calls/${Ge}/participants/${mt}`);await Zr(Js,{name:pA,licenseId:mt,joinTime:Date.now(),role:"participant",isMuted:!1,hasVideo:!0,networkQuality:5}),on("participant"),console.log("User added as participant")}}else{await Zr(Nt,{createdAt:Date.now(),createdBy:mt,waitingRoomEnabled:!0,viewMode:"grid",raisedHands:[],pinnedUsers:[],spotlightUser:null});const xs=Xe(tt,`calls/${Ge}/participants/${mt}`),ds=((Zt=Ul.currentUser)==null?void 0:Zt.displayName)||`User ${mt.substring(0,6)}`;await Zr(xs,{name:ds,licenseId:mt,joinTime:Date.now(),role:"host",isMuted:!1,hasVideo:!0,networkQuality:5}),on("host"),xr({canShareScreen:!0,canRecord:!0,canAnnotate:!0,canSendMessages:!0,canInviteOthers:!0}),console.log("Call created, user added as host")}}catch(Nt){console.error("Error handling participant joining:",Nt)}})(),()=>{Ee(),Me(),yn()}},[Ge,mt,et,bc]),J.useEffect(()=>{var it,yn,Gt,Tt;const ce=Object.keys(H).length,Ee=((yn=(it=Pn.current)==null?void 0:it.remoteUsers)==null?void 0:yn.length)>0,ye=(Tt=(Gt=Pn.current)==null?void 0:Gt.remoteUsers)==null?void 0:Tt.some(Zt=>Zt.audioTrack),Me=f||B!==null;console.log(` Call state check: remoteVideos=${ce}, remoteUsers=${Ee}, audioTracks=${ye}, wasInCall=${Wr}, frozenStatus=${Me}`),(ce>0||Ee||ye||Me)&&!Wr&&(console.log(" Setting wasInCall to true due to detected participants or recent unfreeze"),kr(!0))},[H,B,f]),J.useEffect(()=>{var ce,Ee;Wr||(Ee=(ce=Pn.current)==null?void 0:ce.remoteUsers)!=null&&Ee.some(Me=>Me.audioTrack)&&Object.keys(H).length===0&&(console.log(" AUDIO ONLY DETECTED: Setting wasInCall=true even though video is not visible yet"),kr(!0))},[(Sh=Pn.current)==null?void 0:Sh.remoteUsers]),J.useEffect(()=>{const ce=Object.keys(H).length;ce===1&&fo!=="speaker"?ra("speaker"):ce>1&&fo==="speaker"&&ra("grid")},[H,fo]);const Ru=ce=>{$e(!1),typeof t=="function"&&t(),uA("/dashboard")},Dc=()=>{$e(!1),typeof t=="function"&&t(),uA("/dashboard")};J.useEffect(()=>{if(!f&&B){const ce=gr.current;let Ee=!1,ye;if(ce){const Me=ce.querySelector("video");if(Me){const it=()=>{Ee||(Ee=!0,setTimeout(()=>U(null),100),Me.removeEventListener("playing",it),ye&&clearTimeout(ye))};return Me.addEventListener("playing",it),ye=setTimeout(()=>{Ee||(Ee=!0,U(null),Me.removeEventListener("playing",it))},2e3),()=>{Me.removeEventListener("playing",it),ye&&clearTimeout(ye)}}else return ye=setTimeout(()=>U(null),2e3),()=>clearTimeout(ye)}}},[f,B]);const Lo=async()=>{var ce,Ee;E?(Ee=sa.current)==null||Ee.stopScreenShare():(ce=sa.current)==null||ce.startScreenShare()},sa=J.useRef(null),oa=ce=>{if($i){const Ee=performance.now(),ye=Ee-ia.current.time;if(ye>0){const Me=ce.clientX-ia.current.x,it=ce.clientY-ia.current.y,yn=Me/ye,Gt=it/ye;cA({x:yn,y:Gt}),Ir({x:ce.clientX,y:ce.clientY}),ye>16&&Th(ce.clientX,ce.clientY)}ia.current={x:ce.clientX,y:ce.clientY,time:Ee}}};J.useEffect(()=>($i?(document.body.style.cursor="none",document.addEventListener("mousemove",oa)):(document.body.style.cursor="auto",document.removeEventListener("mousemove",oa)),()=>{document.body.style.cursor="auto",document.removeEventListener("mousemove",oa)}),[$i]);const Th=(ce,Ee)=>{if(!(!$i||!Ge))try{const ye={x:ce,y:Ee,userId:mt,timestamp:Date.now()},Me=Xe(tt,`videoCalls/${Ge}/cursors/${mt}`);Jr(Me,ye)}catch(ye){console.error("Error sending cursor position:",ye)}};J.useEffect(()=>{if(!Ge)return;const ce=Xe(tt,`videoCalls/${Ge}/cursors`),Ee=ya(ce,ye=>{if(ye.exists()){const Me=ye.val(),it=Date.now(),yn={};Object.entries(Me).forEach(([Gt,Tt])=>{Gt!==mt&&it-Tt.timestamp<2e3&&(yn[Gt]=Tt)}),Oc(yn)}else Oc({})});return()=>{if(Ee(),Ge&&mt){const ye=Xe(tt,`videoCalls/${Ge}/cursors/${mt}`);ld(ye)}}},[Ge,mt]);const xa=()=>{if(!Ge||!mt)return;const ce=Xe(tt,`videoCalls/${Ge}/cursors/${mt}`);Zr(ce,{x:0,y:0,userId:mt,timestamp:Date.now()})};return J.useEffect(()=>()=>{if(Ge&&mt){const ce=Xe(tt,`videoCalls/${Ge}/cursors/${mt}`);ld(ce)}},[Ge,mt]),D.jsxs("div",{ref:AA,className:"relative w-full h-screen overflow-hidden bg-black",children:[$i&&D.jsxs(D.Fragment,{children:[D.jsx("div",{style:{position:"fixed",left:Rc.x,top:Rc.y,pointerEvents:"none",zIndex:9999,width:"20px",height:"20px",backgroundColor:"rgba(59, 130, 246, 0.9)",borderRadius:"50%",boxShadow:"0 0 8px 2px rgba(59, 130, 246, 0.8)",transition:"all 0.05s cubic-bezier(0.4, 0, 0.2, 1)",transform:"translate3d(-50%, -50%, 0)",border:"2px solid white",willChange:"transform, left, top",backfaceVisibility:"hidden"}}),D.jsx("div",{style:{position:"fixed",left:Rc.x,top:Rc.y,pointerEvents:"none",zIndex:9998,width:"8px",height:"8px",backgroundColor:"rgba(59, 130, 246, 0.4)",borderRadius:"50%",transform:"translate3d(-50%, -50%, 0)",transition:"all 0.1s cubic-bezier(0.4, 0, 0.2, 1)",willChange:"transform, left, top",backfaceVisibility:"hidden",filter:"blur(2px)"}}),D.jsx("div",{style:{position:"fixed",left:Rc.x,top:Rc.y,pointerEvents:"none",zIndex:9997,width:`${Math.min(40+Math.abs(Su.x+Su.y)*100,80)}px`,height:`${Math.min(40+Math.abs(Su.x+Su.y)*100,80)}px`,backgroundColor:"rgba(59, 130, 246, 0.1)",borderRadius:"50%",transform:"translate3d(-50%, -50%, 0)",transition:"all 0.1s cubic-bezier(0.4, 0, 0.2, 1)",willChange:"transform, width, height",backfaceVisibility:"hidden",filter:"blur(8px)"}})]}),Object.entries(np).map(([ce,Ee])=>D.jsx("div",{style:{position:"fixed",left:Ee.x,top:Ee.y,pointerEvents:"none",zIndex:9999,width:"20px",height:"20px",backgroundColor:"rgba(255, 0, 0, 0.9)",borderRadius:"50%",boxShadow:"0 0 8px 2px rgba(255, 0, 0, 0.8)",transition:"all 0.05s cubic-bezier(0.4, 0, 0.2, 1)",transform:"translate3d(-50%, -50%, 0)",border:"2px solid white",willChange:"transform, left, top",backfaceVisibility:"hidden"},children:D.jsx("div",{style:{position:"absolute",top:"-20px",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"12px",whiteSpace:"nowrap"},children:ce})},ce)),D.jsx("style",{children:`
          .remote-player {
            position: relative;
            width: 100%;
            height: 100%;
          }
          .remote-player video {
            width: 100%;
            height: 100%;
            object-fit: contain;
          }
        `}),D.jsx("div",{className:`absolute top-0 left-0 right-0 z-30 transition-opacity duration-300 ease-in-out ${ft?"opacity-100":"opacity-0"}`,children:D.jsx("div",{className:"mx-auto max-w-5xl px-4 pt-6",children:D.jsxs("div",{className:"bg-gradient-to-r from-gray-900/90 via-gray-800/90 to-gray-900/90 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/5 px-6 py-4 flex items-center justify-between",children:[D.jsxs("div",{className:"flex items-center",children:[D.jsx("div",{className:"mr-4",children:D.jsx("div",{className:"w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-700 flex items-center justify-center shadow-lg shadow-blue-900/30 border border-blue-400/20",children:D.jsx(uke,{size:24,className:"text-white drop-shadow filter-shadow"})})}),D.jsxs("div",{children:[D.jsx("h1",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-blue-100",children:q}),D.jsxs("div",{className:"flex items-center text-gray-300 text-sm mt-1.5",children:[D.jsxs("div",{className:"flex items-center bg-gray-800/50 rounded-full px-2.5 py-1 border border-white/10 shadow-inner",children:[D.jsx(Hne,{size:12,className:"mr-1.5 text-blue-400"}),D.jsx("span",{className:"font-medium text-xs text-blue-100",children:Eh(z)})]}),D.jsx("span",{className:"mx-2 text-gray-500",children:""}),D.jsxs("div",{className:"flex items-center",children:[D.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 mr-1.5 animate-pulse shadow-sm shadow-green-500/50"}),D.jsx("span",{className:"text-gray-400",children:"Secure Connection"})]})]})]})]}),D.jsxs("div",{className:"flex items-center space-x-3",children:[D.jsx("button",{onClick:Iu,className:"p-2.5 rounded-xl bg-gray-800/70 hover:bg-gray-700/80 text-gray-300 hover:text-white transition-colors border border-white/5 shadow-lg",title:"Toggle fullscreen",children:D.jsx(jne,{size:18})}),D.jsxs("button",{onClick:pl,className:"flex items-center bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 py-2.5 rounded-xl transition-transform hover:scale-105 shadow-lg shadow-blue-900/20 hover:shadow-blue-900/40 border border-blue-400/20",children:[D.jsx(XP,{size:16,className:"mr-2 drop-shadow-sm"}),D.jsx("span",{className:"font-medium drop-shadow-sm",children:"Share"})]})]})]})})}),D.jsx("div",{className:"absolute inset-0 pt-[60px] pb-[76px]",children:D.jsxs("div",{className:"relative w-full h-full flex items-center justify-center bg-gradient-to-b from-gray-900 to-gray-800",children:[" ",(et==="host"||et==="participant")&&D.jsxs("div",{className:"absolute top-4 left-4 z-30 flex items-center bg-gray-800/80 backdrop-blur-sm rounded-xl shadow-lg border border-gray-700 p-1",children:[D.jsx("button",{onClick:()=>Ch("grid"),className:`p-2 rounded-lg flex items-center ${fo==="grid"?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"}`,title:"Grid View",children:D.jsx(KUe,{size:18})}),D.jsx("button",{onClick:()=>Ch("speaker"),className:`p-2 rounded-lg flex items-center ${fo==="speaker"?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"}`,title:"Speaker View",children:D.jsx(qUe,{size:18})}),D.jsx("button",{onClick:()=>Ch("sidebar"),className:`p-2 rounded-lg flex items-center ${fo==="sidebar"?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"}`,title:"Sidebar View",children:D.jsx(ike,{size:18})})]}),D.jsxs("button",{onClick:wh,className:`absolute top-4 right-4 z-30 flex items-center bg-gray-800/80 backdrop-blur-sm rounded-lg shadow-lg border border-gray-700 p-2 ${Cu?"bg-blue-600 text-white border-blue-500":"text-gray-300 hover:text-white hover:bg-gray-700"}`,title:"Participants",children:[D.jsx(Hy,{size:18,className:"mr-2"}),D.jsx("span",{className:"text-sm font-medium",children:Object.keys(mn).length||1})]})," ","          ",D.jsxs("div",{className:"relative w-full h-full max-w-[1920px] max-h-[1080px] overflow-hidden",children:["            ",D.jsx("div",{id:"local-player",className:"absolute right-4 top-20 z-30 w-[180px] h-[100px] rounded-lg overflow-hidden shadow-lg border-2 border-gray-700 bg-black",style:{transform:"translateZ(0)",willChange:"transform",backfaceVisibility:"hidden",objectFit:"cover"}}),D.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[" ",D.jsxs("div",{ref:gr,className:`absolute inset-0 bg-black ${fo==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1":fo==="speaker"?"flex items-center justify-center":fo==="sidebar"?"flex flex-row":""} ${E?"screen-sharing-active":""}`,style:{transform:"translateZ(0)",willChange:"transform",backfaceVisibility:"hidden",zIndex:10,transition:"all 0.3s ease"},children:[D.jsx(S3e,{ref:sa,clientRef:Pn,isScreenSharing:E,setIsScreenSharing:w,setRemoteVideos:K,remoteVideoContainerRef:gr,localVideoTrackRef:po}),(()=>{var Zt,Nt,Ht,xs;const ce=Object.keys(H).length;console.log(` Remote video status: ${ce} tracks available`,Object.keys(H).map(ds=>{var pA,Js;return{uid:ds,enabled:(pA=H[ds])==null?void 0:pA.isEnabled,muted:(Js=H[ds])==null?void 0:Js.muted}}));const Ee=((Nt=(Zt=gr.current)==null?void 0:Zt.querySelectorAll("video"))==null?void 0:Nt.length)>0;console.log(` Has active video elements: ${Ee}`);const ye=((xs=(Ht=Pn.current)==null?void 0:Ht.remoteUsers)==null?void 0:xs.some(ds=>ds.audioTrack))||!1,Me=f||B!==null,it=B!==null&&!f,yn=k&&z<5,Gt=ce===0&&!Me&&!it&&!Wr&&!ye&&!yn,Tt=Ee||ce>0||Me||ye;return console.log(` Decision: showWaitingForParticipants=${Gt}, hasVideoPlaying=${Tt}, isVideoFrozen=${f}, wasRecentlyFrozen=${Me}`),Gt?D.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-gray-900 to-gray-800",children:[D.jsx("div",{className:"mb-6",children:D.jsx(Qne,{className:"w-16 h-16 text-blue-400 animate-pulse"})}),D.jsx("h2",{className:"text-2xl font-semibold text-white mb-2",children:"Waiting for participants..."}),D.jsx("p",{className:"text-gray-400",children:"Your call is ready. Share the call link to invite others."}),D.jsxs("div",{className:"mt-8 flex items-center space-x-3",children:[D.jsxs("div",{className:"flex items-center bg-gray-800/70 backdrop-blur px-4 py-2 rounded-lg border border-gray-700",children:[D.jsx("span",{className:"text-gray-300 mr-2 font-medium",children:"ID:"}),D.jsx("span",{className:"text-blue-400 font-mono",children:Ge}),D.jsx("button",{onClick:C_,className:"ml-3 text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-700/50",children:fe?D.jsx(UUe,{size:18,className:"text-green-500"}):D.jsx(HUe,{size:18})})]}),D.jsxs("button",{onClick:pl,className:"flex items-center bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full border border-white/35 transition-colors shadow-lg",children:[D.jsx(XP,{size:18,className:"mr-2"}),D.jsx("span",{children:"Share Invite"})]})]})]}):!Tt&&!f?D.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60",children:D.jsxs("div",{className:"flex flex-col items-center",children:[D.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),D.jsx("p",{className:"mt-4 text-gray-300 text-sm",children:"Connecting video stream..."})]})}):null})()]}),D.jsx("div",{className:"absolute top-0 left-0 right-0 z-20 px-4 py-3 bg-gradient-to-b from-gray-900/90 to-transparent",children:D.jsx("div",{className:"flex items-center justify-between",children:D.jsxs("div",{className:"flex items-center space-x-3",children:[" ",D.jsxs("div",{className:"flex items-center space-x-2",children:[D.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),D.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Live"})]}),b&&D.jsxs("div",{className:"flex items-center space-x-2",children:[D.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),D.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Recording"})]})]})})}),D.jsx($Me,{callId:Ge,database:tt,agoraEngine:_h.current,remoteVideos:H,remoteVideoContainerRef:gr,uidRef:gh,annotations:C,setAnnotations:L,isVideoFrozen:f,frozenFrameRef:qr,frozenFrame:B,isRemoteVideoFrozen:g}),g&&D.jsx("div",{className:"absolute inset-0 z-30 backdrop-blur-sm bg-black/40 flex items-center justify-center",children:D.jsxs("div",{className:"text-center px-6 py-4 rounded-lg bg-gray-900/80 backdrop-blur-lg border border-gray-700",children:[D.jsx(VideoOff,{size:32,className:"mx-auto mb-2 text-yellow-500"}),D.jsx("p",{className:"text-gray-200",children:"Video connection interrupted"}),D.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Attempting to reconnect..."})]})})]})]})]})}),D.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gray-800/95 backdrop-blur-sm p-4 flex justify-center space-x-4 z-40 border-t border-gray-700",children:D.jsx(QMe,{callId:Ge,database:tt,clientRef:Pn,localAudioTrackRef:Qi,remoteVideoContainerRef:gr,channelRef:Ii,recordingRef:mh,isMuted:l,setIsMuted:d,stopVideoState:x,setStopVideoState:V,isVideoFrozen:f,setIsVideoFrozen:p,setFreezeOverlayVisible:O,frozenFrame:B,setFrozenFrame:U,isScreenSharing:E,onScreenShare:Lo,isRecording:b,setIsRecording:I,handleFreeze:bu,toggleChat:()=>o(ce=>!ce),endCall:dA,setError:A,cursorActive:$i,localVideoTrackRef:po,setCursorActive:ph})}),s&&D.jsx("div",{className:"fixed right-0 top-[60px] bottom-[76px] w-80 bg-gray-800 shadow-xl z-50",children:D.jsx(JMe,{callId:Ge,userId:((fA=Ul.currentUser)==null?void 0:fA.uid)||"anonymous",userName:((Po=Ul.currentUser)==null?void 0:Po.displayName)||`${(mt==null?void 0:mt.substring(0,20))||"Anonymous"}`,onCloseChat:gl})}),"      ",D.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",zIndex:45,backgroundColor:"#4CAF50",color:"white",padding:"12px 24px",borderRadius:"8px",cursor:"pointer",fontWeight:"bold",boxShadow:"0 4px 8px rgba(0,0,0,0.3)",display:"flex",alignItems:"center",gap:"8px"},onClick:()=>{console.log("Invite button clicked"),$t(!0),ka()},children:[D.jsx(pke,{size:24}),D.jsx("span",{children:"Add User"})]}),qt&&D.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:D.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-96 max-w-full max-h-[80vh] flex flex-col",children:[D.jsxs("div",{className:"flex justify-between items-center mb-4",children:[D.jsx("h2",{className:"text-xl font-bold text-white",children:"Invite Users to Call"}),D.jsx("button",{onClick:()=>$t(!1),className:"text-gray-400 hover:text-white",children:D.jsx(cS,{size:24})})]}),D.jsx("div",{className:"mb-4",children:D.jsx("input",{type:"text",placeholder:"Search contacts...",value:xe,onChange:ce=>ze(ce.target.value),className:"w-full px-4 py-2 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),at?D.jsx("div",{className:"flex justify-center py-4",children:D.jsx(WUe,{className:"animate-spin text-blue-500",size:24})}):D.jsxs(D.Fragment,{children:[pt.length===0?D.jsxs("div",{className:"text-center py-8 text-gray-400",children:[D.jsx(Ob,{size:48,className:"mx-auto mb-2"}),D.jsx("p",{children:"No contacts available to invite"}),D.jsxs("button",{onClick:ka,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[D.jsx(cke,{size:16,className:"inline mr-2"}),"Refresh Contacts"]})]}):D.jsx("div",{className:"flex-1 overflow-y-auto my-4 space-y-2",children:pt.filter(ce=>typeof ce=="string"&&ce.toLowerCase().includes(xe.toLowerCase())).map(ce=>D.jsxs("div",{className:`flex items-center p-3 rounded-md cursor-pointer transition-colors bg-gray-700 hover:bg-gray-600 ${br.includes(ce)?"bg-blue-600":""}`,onClick:()=>hA(ce),children:[D.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold mr-3",children:ce.charAt(0).toUpperCase()}),D.jsxs("div",{className:"flex-1",children:[D.jsx("p",{className:"font-medium",children:ce}),D.jsxs("div",{className:"text-sm text-gray-400 flex items-center",children:[D.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 mr-1"}),D.jsx("span",{children:"Online"})]})]}),br.includes(ce)&&D.jsx(LUe,{size:20,className:"ml-2 text-white"})]},ce))}),D.jsxs("div",{className:"flex justify-end pt-4 border-t border-gray-700",children:[D.jsx("button",{onClick:()=>$t(!1),className:"px-4 py-2 text-gray-300 mr-2 hover:text-white transition-colors",children:"Cancel"}),D.jsxs("button",{onClick:zn,disabled:br.length===0,className:`px-4 py-2 rounded-md ${br.length===0?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:["Invite Selected (",br.length,")"]})]})]})]})}),bc&&zr.length>0&&et==="host"&&D.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[55]",children:D.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-96 max-w-full max-h-[80vh] flex flex-col",children:[D.jsxs("div",{className:"flex justify-between items-center mb-4",children:[D.jsxs("h2",{className:"text-xl font-bold text-white flex items-center",children:[D.jsx(Hy,{size:20,className:"text-blue-400 mr-2"}),"Waiting Room",D.jsx("span",{className:"ml-2 bg-blue-600 text-white text-xs px-2 py-1 rounded-full",children:zr.length})]}),D.jsx("button",{onClick:()=>sA(!1),className:"text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-700",children:D.jsx(cS,{size:20})})]}),D.jsx("div",{className:"flex-1 overflow-y-auto",children:D.jsx(ZMe,{waitingUsers:zr,admitUser:Bo,denyUser:El,admitAll:ip,denyAll:vh})}),D.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t border-gray-700",children:[D.jsxs("label",{className:"flex items-center",children:[D.jsx("input",{type:"checkbox",checked:Ps,onChange:ce=>_l(ce.target.checked),className:"w-4 h-4 rounded-sm text-blue-600 border-gray-600 bg-gray-700 focus:ring-blue-500 focus:ring-offset-gray-800"}),D.jsx("span",{className:"ml-2 text-sm text-gray-300",children:"Enable waiting room"})]}),D.jsx("button",{onClick:()=>sA(!1),className:"px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition-colors",children:"Close"})]})]})}),Cu&&D.jsx("div",{className:"fixed right-0 top-[60px] bottom-[76px] z-50 flex items-start justify-end p-4",children:D.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl w-80 max-h-full overflow-hidden",children:[D.jsxs("div",{className:"p-4 border-b border-gray-700 flex justify-between items-center",children:[D.jsx("h3",{className:"text-lg font-semibold text-white",children:"Participants"}),D.jsx("button",{onClick:()=>Tu(!1),className:"text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-700",title:"Close panel",children:D.jsx(cS,{size:20})})]}),D.jsx("div",{className:"overflow-y-auto max-h-[calc(100vh-200px)]"}),D.jsxs("div",{className:"overflow-y-auto max-h-[calc(100vh-200px)]",children:[D.jsx("div",{className:"p-3 border-b border-gray-700 hover:bg-gray-700/50",children:D.jsx("div",{className:"flex items-center justify-between",children:D.jsxs("div",{className:"flex items-center",children:[D.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold mr-3",children:mt==null?void 0:mt.charAt(0).toUpperCase()}),D.jsxs("div",{children:[D.jsx("p",{className:"text-white font-medium",children:mt}),D.jsx("p",{className:"text-sm text-gray-400",children:"host"})]})]})})}),Object.entries(mn).map(([ce,Ee])=>{if(ce===mt)return null;const ye=Ee.licenseId||ce;return Object.keys(H).includes(ce),D.jsx("div",{className:"p-3 border-b border-gray-700 hover:bg-gray-700/50",children:D.jsxs("div",{className:"flex items-center justify-between",children:[D.jsxs("div",{className:"flex items-center",children:[D.jsx("div",{className:"w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white font-bold mr-3",children:ye.charAt(0).toUpperCase()}),D.jsxs("div",{children:[D.jsx("p",{className:"text-white font-medium",children:ye}),D.jsx("p",{className:"text-sm text-gray-400",children:Ee.role||"participant"})]})]}),et==="host"&&D.jsx("button",{onClick:()=>S_(ce),className:"text-gray-400 hover:text-red-500 p-1",title:"Remove participant",children:D.jsx(Ob,{size:18})})]})},ce)}),Object.keys(mn).length<=1&&D.jsx("div",{className:"p-4 text-center text-gray-400",children:"No other participants yet"})]})]})}),et==="host"&&Ps&&zr.length>0&&D.jsxs("div",{className:"fixed top-20 right-4 z-50 bg-blue-600 text-white px-3 py-2 rounded-lg shadow-lg cursor-pointer flex items-center animate-pulse",onClick:()=>sA(!0),children:[D.jsx(Hy,{size:18,className:"mr-2"}),D.jsxs("span",{className:"font-medium",children:[zr.length," waiting"]})]}),ut&&D.jsx(T3e,{isOpen:ut,onSubmit:Ru,onClose:Dc})]})};function i7(){const t="/signin",e="https://client-admin-6ac45.web.app/",[n,r]=J.useState(!1),[i,s]=J.useState(!1),o=J.useRef(null),a=J.useRef(null),[A,l]=J.useState(0),[d,f]=J.useState(0);return J.useEffect(()=>{o.current&&l(o.current.offsetWidth),a.current&&f(a.current.offsetWidth)},[]),D.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-blue-950 to-blue-950 overflow-hidden relative",children:[D.jsx("div",{className:"absolute inset-0 z-0 opacity-50"}),D.jsxs("div",{className:"relative z-10",children:[D.jsxs("header",{className:"flex justify-between items-center p-4 md:p-6",children:[D.jsx("div",{className:"flex items-center",children:D.jsx("img",{src:px,alt:"XRAI Logo",className:"w-35 h-28"})}),D.jsx("div",{className:"flex items-center gap-4"})]}),D.jsxs("div",{className:"bg-blue-950 text-white py-2 px-4 text-center text-sm",children:[D.jsx("span",{className:"mr-2",children:""}),"Remote Collaboration upgraded: comprehensive progress in key capabilities."]}),D.jsxs("main",{className:"max-w-6xl mx-auto px-4 pt-16 pb-24 text-center",children:[D.jsx("h1",{className:"text-purple-500  text-6xl md:text-6xl font-bold mb-4",children:"XRAI VISION"}),D.jsx("h2",{className:"text-white text-3xl md:text-3xl font-medium mb-16",children:"Remote Colloboration"}),D.jsxs("div",{className:"grid md:grid-cols-2 gap-6 max-w-4xl mx-auto",children:[D.jsxs(kU,{to:t,className:"bg-white rounded-xl p-8 shadow-lg hover:shadow-xl transition-shadow text-left",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[D.jsx("h3",{ref:o,className:"text-purple-500 text-2xl font-bold mb-2",children:"User Login"}),D.jsx("div",{style:{width:A},className:`h-[2px] bg-blue-500 mb-4 transition-opacity duration-300 ${n?"opacity-100":"opacity-0"}`}),D.jsxs("p",{className:"text-gray-600",children:["Access to Remote Collaboration platform.",D.jsx("br",{})]})]}),D.jsxs("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"bg-white rounded-xl p-8 shadow-lg hover:shadow-xl transition-shadow text-left",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[D.jsx("h3",{ref:a,className:"text-purple-500 text-2xl font-bold mb-2",children:"Admin Login"}),D.jsx("div",{style:{width:d},className:`h-[2px] bg-blue-500 mb-4 transition-opacity duration-300 ${i?"opacity-100":"opacity-0"}`}),D.jsx("p",{className:"text-gray-600",children:"Manage your team's users, licenses, and subscriptions with ease."})]})]})]})]})]})}const I3e=()=>{const[t,e]=J.useState(!1),[n,r]=J.useState(null),i=o=>{e(!0),r(o)},s=()=>{e(!1),r(null)};return D.jsx(_ae,{children:D.jsxs(zoe,{children:[D.jsx(gm,{path:"/",element:D.jsx(i7,{user:n,onLogout:s})}),D.jsx(gm,{path:"/signin",element:t?D.jsx(QC,{to:"/dashboard"}):D.jsx(iye,{onSignIn:i})}),D.jsx(gm,{path:"/dashboard",element:t?D.jsx(hye,{user:n,onLogout:s}):D.jsx(QC,{to:"/signin"})}),D.jsx(gm,{path:"/video-call",element:t?D.jsx(b3e,{user:n,onCallEnd:()=>{}}):D.jsx(QC,{to:"/signin"})}),D.jsx(gm,{path:"/mainpage",element:t?D.jsx(i7,{user:n,onLogout:s}):D.jsx(QC,{to:"/signin"})})]})})};roe.createRoot(document.getElementById("root")).render(D.jsx(J.StrictMode,{children:D.jsx(I3e,{})}));

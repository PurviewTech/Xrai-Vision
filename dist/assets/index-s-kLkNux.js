(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function are(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var zR={exports:{}},I_={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fF;function cre(){if(fF)return I_;fF=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:t,type:r,key:o,ref:i!==void 0?i:null,props:s}}return I_.Fragment=e,I_.jsx=n,I_.jsxs=n,I_}var pF;function Are(){return pF||(pF=1,zR.exports=cre()),zR.exports}var R=Are(),qR={exports:{}},zt={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mF;function lre(){if(mF)return zt;mF=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function m(P){return P===null||typeof P!="object"?null:(P=f&&P[f]||P["@@iterator"],typeof P=="function"?P:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,y={};function w(P,C,D){this.props=P,this.context=C,this.refs=y,this.updater=D||g}w.prototype.isReactComponent={},w.prototype.setState=function(P,C){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,C,"setState")},w.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function b(){}b.prototype=w.prototype;function I(P,C,D){this.props=P,this.context=C,this.refs=y,this.updater=D||g}var B=I.prototype=new b;B.constructor=I,v(B,w.prototype),B.isPureReactComponent=!0;var M=Array.isArray,H={H:null,A:null,T:null,S:null,V:null},K=Object.prototype.hasOwnProperty;function Q(P,C,D,U,ee,Ee){return D=Ee.ref,{$$typeof:t,type:P,key:C,ref:D!==void 0?D:null,props:Ee}}function F(P,C){return Q(P.type,C,void 0,void 0,void 0,P.props)}function k(P){return typeof P=="object"&&P!==null&&P.$$typeof===t}function G(P){var C={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(D){return C[D]})}var $=/\/+/g;function ne(P,C){return typeof P=="object"&&P!==null&&P.key!=null?G(""+P.key):C.toString(36)}function q(){}function qe(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(q,q):(P.status="pending",P.then(function(C){P.status==="pending"&&(P.status="fulfilled",P.value=C)},function(C){P.status==="pending"&&(P.status="rejected",P.reason=C)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function je(P,C,D,U,ee){var Ee=typeof P;(Ee==="undefined"||Ee==="boolean")&&(P=null);var Re=!1;if(P===null)Re=!0;else switch(Ee){case"bigint":case"string":case"number":Re=!0;break;case"object":switch(P.$$typeof){case t:case e:Re=!0;break;case d:return Re=P._init,je(Re(P._payload),C,D,U,ee)}}if(Re)return ee=ee(P),Re=U===""?"."+ne(P,0):U,M(ee)?(D="",Re!=null&&(D=Re.replace($,"$&/")+"/"),je(ee,C,D,"",function(Tr){return Tr})):ee!=null&&(k(ee)&&(ee=F(ee,D+(ee.key==null||P&&P.key===ee.key?"":(""+ee.key).replace($,"$&/")+"/")+Re)),C.push(ee)),1;Re=0;var lt=U===""?".":U+":";if(M(P))for(var St=0;St<P.length;St++)U=P[St],Ee=lt+ne(U,St),Re+=je(U,C,D,Ee,ee);else if(St=m(P),typeof St=="function")for(P=St.call(P),St=0;!(U=P.next()).done;)U=U.value,Ee=lt+ne(U,St++),Re+=je(U,C,D,Ee,ee);else if(Ee==="object"){if(typeof P.then=="function")return je(qe(P),C,D,U,ee);throw C=String(P),Error("Objects are not valid as a React child (found: "+(C==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":C)+"). If you meant to render a collection of children, use an array instead.")}return Re}function de(P,C,D){if(P==null)return P;var U=[],ee=0;return je(P,U,"","",function(Ee){return C.call(D,Ee,ee++)}),U}function J(P){if(P._status===-1){var C=P._result;C=C(),C.then(function(D){(P._status===0||P._status===-1)&&(P._status=1,P._result=D)},function(D){(P._status===0||P._status===-1)&&(P._status=2,P._result=D)}),P._status===-1&&(P._status=0,P._result=C)}if(P._status===1)return P._result.default;throw P._result}var Y=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var C=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(C))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)};function Z(){}return zt.Children={map:de,forEach:function(P,C,D){de(P,function(){C.apply(this,arguments)},D)},count:function(P){var C=0;return de(P,function(){C++}),C},toArray:function(P){return de(P,function(C){return C})||[]},only:function(P){if(!k(P))throw Error("React.Children.only expected to receive a single React element child.");return P}},zt.Component=w,zt.Fragment=n,zt.Profiler=i,zt.PureComponent=I,zt.StrictMode=r,zt.Suspense=A,zt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,zt.__COMPILER_RUNTIME={__proto__:null,c:function(P){return H.H.useMemoCache(P)}},zt.cache=function(P){return function(){return P.apply(null,arguments)}},zt.cloneElement=function(P,C,D){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var U=v({},P.props),ee=P.key,Ee=void 0;if(C!=null)for(Re in C.ref!==void 0&&(Ee=void 0),C.key!==void 0&&(ee=""+C.key),C)!K.call(C,Re)||Re==="key"||Re==="__self"||Re==="__source"||Re==="ref"&&C.ref===void 0||(U[Re]=C[Re]);var Re=arguments.length-2;if(Re===1)U.children=D;else if(1<Re){for(var lt=Array(Re),St=0;St<Re;St++)lt[St]=arguments[St+2];U.children=lt}return Q(P.type,ee,void 0,void 0,Ee,U)},zt.createContext=function(P){return P={$$typeof:o,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:s,_context:P},P},zt.createElement=function(P,C,D){var U,ee={},Ee=null;if(C!=null)for(U in C.key!==void 0&&(Ee=""+C.key),C)K.call(C,U)&&U!=="key"&&U!=="__self"&&U!=="__source"&&(ee[U]=C[U]);var Re=arguments.length-2;if(Re===1)ee.children=D;else if(1<Re){for(var lt=Array(Re),St=0;St<Re;St++)lt[St]=arguments[St+2];ee.children=lt}if(P&&P.defaultProps)for(U in Re=P.defaultProps,Re)ee[U]===void 0&&(ee[U]=Re[U]);return Q(P,Ee,void 0,void 0,null,ee)},zt.createRef=function(){return{current:null}},zt.forwardRef=function(P){return{$$typeof:a,render:P}},zt.isValidElement=k,zt.lazy=function(P){return{$$typeof:d,_payload:{_status:-1,_result:P},_init:J}},zt.memo=function(P,C){return{$$typeof:u,type:P,compare:C===void 0?null:C}},zt.startTransition=function(P){var C=H.T,D={};H.T=D;try{var U=P(),ee=H.S;ee!==null&&ee(D,U),typeof U=="object"&&U!==null&&typeof U.then=="function"&&U.then(Z,Y)}catch(Ee){Y(Ee)}finally{H.T=C}},zt.unstable_useCacheRefresh=function(){return H.H.useCacheRefresh()},zt.use=function(P){return H.H.use(P)},zt.useActionState=function(P,C,D){return H.H.useActionState(P,C,D)},zt.useCallback=function(P,C){return H.H.useCallback(P,C)},zt.useContext=function(P){return H.H.useContext(P)},zt.useDebugValue=function(){},zt.useDeferredValue=function(P,C){return H.H.useDeferredValue(P,C)},zt.useEffect=function(P,C,D){var U=H.H;if(typeof D=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return U.useEffect(P,C)},zt.useId=function(){return H.H.useId()},zt.useImperativeHandle=function(P,C,D){return H.H.useImperativeHandle(P,C,D)},zt.useInsertionEffect=function(P,C){return H.H.useInsertionEffect(P,C)},zt.useLayoutEffect=function(P,C){return H.H.useLayoutEffect(P,C)},zt.useMemo=function(P,C){return H.H.useMemo(P,C)},zt.useOptimistic=function(P,C){return H.H.useOptimistic(P,C)},zt.useReducer=function(P,C,D){return H.H.useReducer(P,C,D)},zt.useRef=function(P){return H.H.useRef(P)},zt.useState=function(P){return H.H.useState(P)},zt.useSyncExternalStore=function(P,C,D){return H.H.useSyncExternalStore(P,C,D)},zt.useTransition=function(){return H.H.useTransition()},zt.version="19.1.0",zt}var gF;function GU(){return gF||(gF=1,qR.exports=lre()),qR.exports}var X=GU();const qh=are(X);var YR={exports:{}},R_={},XR={exports:{}},JR={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _F;function ure(){return _F||(_F=1,function(t){function e(de,J){var Y=de.length;de.push(J);e:for(;0<Y;){var Z=Y-1>>>1,P=de[Z];if(0<i(P,J))de[Z]=J,de[Y]=P,Y=Z;else break e}}function n(de){return de.length===0?null:de[0]}function r(de){if(de.length===0)return null;var J=de[0],Y=de.pop();if(Y!==J){de[0]=Y;e:for(var Z=0,P=de.length,C=P>>>1;Z<C;){var D=2*(Z+1)-1,U=de[D],ee=D+1,Ee=de[ee];if(0>i(U,Y))ee<P&&0>i(Ee,U)?(de[Z]=Ee,de[ee]=Y,Z=ee):(de[Z]=U,de[D]=Y,Z=D);else if(ee<P&&0>i(Ee,Y))de[Z]=Ee,de[ee]=Y,Z=ee;else break e}}return J}function i(de,J){var Y=de.sortIndex-J.sortIndex;return Y!==0?Y:de.id-J.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var A=[],u=[],d=1,f=null,m=3,g=!1,v=!1,y=!1,w=!1,b=typeof setTimeout=="function"?setTimeout:null,I=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function M(de){for(var J=n(u);J!==null;){if(J.callback===null)r(u);else if(J.startTime<=de)r(u),J.sortIndex=J.expirationTime,e(A,J);else break;J=n(u)}}function H(de){if(y=!1,M(de),!v)if(n(A)!==null)v=!0,K||(K=!0,ne());else{var J=n(u);J!==null&&je(H,J.startTime-de)}}var K=!1,Q=-1,F=5,k=-1;function G(){return w?!0:!(t.unstable_now()-k<F)}function $(){if(w=!1,K){var de=t.unstable_now();k=de;var J=!0;try{e:{v=!1,y&&(y=!1,I(Q),Q=-1),g=!0;var Y=m;try{t:{for(M(de),f=n(A);f!==null&&!(f.expirationTime>de&&G());){var Z=f.callback;if(typeof Z=="function"){f.callback=null,m=f.priorityLevel;var P=Z(f.expirationTime<=de);if(de=t.unstable_now(),typeof P=="function"){f.callback=P,M(de),J=!0;break t}f===n(A)&&r(A),M(de)}else r(A);f=n(A)}if(f!==null)J=!0;else{var C=n(u);C!==null&&je(H,C.startTime-de),J=!1}}break e}finally{f=null,m=Y,g=!1}J=void 0}}finally{J?ne():K=!1}}}var ne;if(typeof B=="function")ne=function(){B($)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,qe=q.port2;q.port1.onmessage=$,ne=function(){qe.postMessage(null)}}else ne=function(){b($,0)};function je(de,J){Q=b(function(){de(t.unstable_now())},J)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(de){de.callback=null},t.unstable_forceFrameRate=function(de){0>de||125<de?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<de?Math.floor(1e3/de):5},t.unstable_getCurrentPriorityLevel=function(){return m},t.unstable_next=function(de){switch(m){case 1:case 2:case 3:var J=3;break;default:J=m}var Y=m;m=J;try{return de()}finally{m=Y}},t.unstable_requestPaint=function(){w=!0},t.unstable_runWithPriority=function(de,J){switch(de){case 1:case 2:case 3:case 4:case 5:break;default:de=3}var Y=m;m=de;try{return J()}finally{m=Y}},t.unstable_scheduleCallback=function(de,J,Y){var Z=t.unstable_now();switch(typeof Y=="object"&&Y!==null?(Y=Y.delay,Y=typeof Y=="number"&&0<Y?Z+Y:Z):Y=Z,de){case 1:var P=-1;break;case 2:P=250;break;case 5:P=1073741823;break;case 4:P=1e4;break;default:P=5e3}return P=Y+P,de={id:d++,callback:J,priorityLevel:de,startTime:Y,expirationTime:P,sortIndex:-1},Y>Z?(de.sortIndex=Y,e(u,de),n(A)===null&&de===n(u)&&(y?(I(Q),Q=-1):y=!0,je(H,Y-Z))):(de.sortIndex=P,e(A,de),v||g||(v=!0,K||(K=!0,ne()))),de},t.unstable_shouldYield=G,t.unstable_wrapCallback=function(de){var J=m;return function(){var Y=m;m=J;try{return de.apply(this,arguments)}finally{m=Y}}}}(JR)),JR}var EF;function dre(){return EF||(EF=1,XR.exports=ure()),XR.exports}var $R={exports:{}},zs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vF;function hre(){if(vF)return zs;vF=1;var t=GU();function e(A){var u="https://react.dev/errors/"+A;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)u+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+A+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(A,u,d){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:f==null?null:""+f,children:A,containerInfo:u,implementation:d}}var o=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(A,u){if(A==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return zs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,zs.createPortal=function(A,u){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return s(A,u,null,d)},zs.flushSync=function(A){var u=o.T,d=r.p;try{if(o.T=null,r.p=2,A)return A()}finally{o.T=u,r.p=d,r.d.f()}},zs.preconnect=function(A,u){typeof A=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,r.d.C(A,u))},zs.prefetchDNS=function(A){typeof A=="string"&&r.d.D(A)},zs.preinit=function(A,u){if(typeof A=="string"&&u&&typeof u.as=="string"){var d=u.as,f=a(d,u.crossOrigin),m=typeof u.integrity=="string"?u.integrity:void 0,g=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;d==="style"?r.d.S(A,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:f,integrity:m,fetchPriority:g}):d==="script"&&r.d.X(A,{crossOrigin:f,integrity:m,fetchPriority:g,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},zs.preinitModule=function(A,u){if(typeof A=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var d=a(u.as,u.crossOrigin);r.d.M(A,{crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&r.d.M(A)},zs.preload=function(A,u){if(typeof A=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var d=u.as,f=a(d,u.crossOrigin);r.d.L(A,d,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},zs.preloadModule=function(A,u){if(typeof A=="string")if(u){var d=a(u.as,u.crossOrigin);r.d.m(A,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:d,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else r.d.m(A)},zs.requestFormReset=function(A){r.d.r(A)},zs.unstable_batchedUpdates=function(A,u){return A(u)},zs.useFormState=function(A,u,d){return o.H.useFormState(A,u,d)},zs.useFormStatus=function(){return o.H.useHostTransitionStatus()},zs.version="19.1.0",zs}var yF;function fre(){if(yF)return $R.exports;yF=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),$R.exports=hre(),$R.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wF;function pre(){if(wF)return R_;wF=1;var t=dre(),e=GU(),n=fre();function r(c){var l="https://react.dev/errors/"+c;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+c+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function s(c){var l=c,h=c;if(c.alternate)for(;l.return;)l=l.return;else{c=l;do l=c,(l.flags&4098)!==0&&(h=l.return),c=l.return;while(c)}return l.tag===3?h:null}function o(c){if(c.tag===13){var l=c.memoizedState;if(l===null&&(c=c.alternate,c!==null&&(l=c.memoizedState)),l!==null)return l.dehydrated}return null}function a(c){if(s(c)!==c)throw Error(r(188))}function A(c){var l=c.alternate;if(!l){if(l=s(c),l===null)throw Error(r(188));return l!==c?null:c}for(var h=c,p=l;;){var E=h.return;if(E===null)break;var T=E.alternate;if(T===null){if(p=E.return,p!==null){h=p;continue}break}if(E.child===T.child){for(T=E.child;T;){if(T===h)return a(E),c;if(T===p)return a(E),l;T=T.sibling}throw Error(r(188))}if(h.return!==p.return)h=E,p=T;else{for(var V=!1,W=E.child;W;){if(W===h){V=!0,h=E,p=T;break}if(W===p){V=!0,p=E,h=T;break}W=W.sibling}if(!V){for(W=T.child;W;){if(W===h){V=!0,h=T,p=E;break}if(W===p){V=!0,p=T,h=E;break}W=W.sibling}if(!V)throw Error(r(189))}}if(h.alternate!==p)throw Error(r(190))}if(h.tag!==3)throw Error(r(188));return h.stateNode.current===h?c:l}function u(c){var l=c.tag;if(l===5||l===26||l===27||l===6)return c;for(c=c.child;c!==null;){if(l=u(c),l!==null)return l;c=c.sibling}return null}var d=Object.assign,f=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),y=Symbol.for("react.strict_mode"),w=Symbol.for("react.profiler"),b=Symbol.for("react.provider"),I=Symbol.for("react.consumer"),B=Symbol.for("react.context"),M=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),K=Symbol.for("react.suspense_list"),Q=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),k=Symbol.for("react.activity"),G=Symbol.for("react.memo_cache_sentinel"),$=Symbol.iterator;function ne(c){return c===null||typeof c!="object"?null:(c=$&&c[$]||c["@@iterator"],typeof c=="function"?c:null)}var q=Symbol.for("react.client.reference");function qe(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===q?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case v:return"Fragment";case w:return"Profiler";case y:return"StrictMode";case H:return"Suspense";case K:return"SuspenseList";case k:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case g:return"Portal";case B:return(c.displayName||"Context")+".Provider";case I:return(c._context.displayName||"Context")+".Consumer";case M:var l=c.render;return c=c.displayName,c||(c=l.displayName||l.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case Q:return l=c.displayName||null,l!==null?l:qe(c.type)||"Memo";case F:l=c._payload,c=c._init;try{return qe(c(l))}catch{}}return null}var je=Array.isArray,de=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y={pending:!1,data:null,method:null,action:null},Z=[],P=-1;function C(c){return{current:c}}function D(c){0>P||(c.current=Z[P],Z[P]=null,P--)}function U(c,l){P++,Z[P]=c.current,c.current=l}var ee=C(null),Ee=C(null),Re=C(null),lt=C(null);function St(c,l){switch(U(Re,l),U(Ee,c),U(ee,null),l.nodeType){case 9:case 11:c=(c=l.documentElement)&&(c=c.namespaceURI)?H2(c):0;break;default:if(c=l.tagName,l=l.namespaceURI)l=H2(l),c=j2(l,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}D(ee),U(ee,c)}function Tr(){D(ee),D(Ee),D(Re)}function cs(c){c.memoizedState!==null&&U(lt,c);var l=ee.current,h=j2(l,c.type);l!==h&&(U(Ee,c),U(ee,h))}function As(c){Ee.current===c&&(D(ee),D(Ee)),lt.current===c&&(D(lt),w_._currentValue=Y)}var gr=Object.prototype.hasOwnProperty,xi=t.unstable_scheduleCallback,vi=t.unstable_cancelCallback,Jt=t.unstable_shouldYield,Xt=t.unstable_requestPaint,dt=t.unstable_now,Ar=t.unstable_getCurrentPriorityLevel,yi=t.unstable_ImmediatePriority,Pt=t.unstable_UserBlockingPriority,st=t.unstable_NormalPriority,Sr=t.unstable_LowPriority,br=t.unstable_IdlePriority,ei=t.log,Ks=t.unstable_setDisableYieldValue,qn=null,yn=null;function Rs(c){if(typeof ei=="function"&&Ks(c),yn&&typeof yn.setStrictMode=="function")try{yn.setStrictMode(qn,c)}catch{}}var wi=Math.clz32?Math.clz32:eA,Ia=Math.log,Rf=Math.LN2;function eA(c){return c>>>=0,c===0?32:31-(Ia(c)/Rf|0)|0}var ti=256,He=4194304;function Xe(c){var l=c&42;if(l!==0)return l;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function kt(c,l,h){var p=c.pendingLanes;if(p===0)return 0;var E=0,T=c.suspendedLanes,V=c.pingedLanes;c=c.warmLanes;var W=p&134217727;return W!==0?(p=W&~T,p!==0?E=Xe(p):(V&=W,V!==0?E=Xe(V):h||(h=W&~c,h!==0&&(E=Xe(h))))):(W=p&~T,W!==0?E=Xe(W):V!==0?E=Xe(V):h||(h=p&~c,h!==0&&(E=Xe(h)))),E===0?0:l!==0&&l!==E&&(l&T)===0&&(T=E&-E,h=l&-l,T>=h||T===32&&(h&4194048)!==0)?l:E}function Nt(c,l){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&l)===0}function _n(c,l){switch(c){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Br(){var c=ti;return ti<<=1,(ti&4194048)===0&&(ti=256),c}function Ci(){var c=He;return He<<=1,(He&62914560)===0&&(He=4194304),c}function fn(c){for(var l=[],h=0;31>h;h++)l.push(c);return l}function Un(c,l){c.pendingLanes|=l,l!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function Mi(c,l,h,p,E,T){var V=c.pendingLanes;c.pendingLanes=h,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=h,c.entangledLanes&=h,c.errorRecoveryDisabledLanes&=h,c.shellSuspendCounter=0;var W=c.entanglements,re=c.expirationTimes,fe=c.hiddenUpdates;for(h=V&~h;0<h;){var we=31-wi(h),Ne=1<<we;W[we]=0,re[we]=-1;var me=fe[we];if(me!==null)for(fe[we]=null,we=0;we<me.length;we++){var ge=me[we];ge!==null&&(ge.lane&=-536870913)}h&=~Ne}p!==0&&Ti(c,p,0),T!==0&&E===0&&c.tag!==0&&(c.suspendedLanes|=T&~(V&~l))}function Ti(c,l,h){c.pendingLanes|=l,c.suspendedLanes&=~l;var p=31-wi(l);c.entangledLanes|=l,c.entanglements[p]=c.entanglements[p]|1073741824|h&4194090}function Kd(c,l){var h=c.entangledLanes|=l;for(c=c.entanglements;h;){var p=31-wi(h),E=1<<p;E&l|c[p]&l&&(c[p]|=l),h&=~E}}function Gs(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function Yo(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function gc(){var c=J.p;return c!==0?c:(c=window.event,c===void 0?32:cF(c.type))}function Co(c,l){var h=J.p;try{return J.p=c,l()}finally{J.p=h}}var Hn=Math.random().toString(36).slice(2),jr="__reactFiber$"+Hn,Lr="__reactProps$"+Hn,To="__reactContainer$"+Hn,ru="__reactEvents$"+Hn,Gd="__reactListeners$"+Hn,_c="__reactHandles$"+Hn,Ec="__reactResources$"+Hn,vc="__reactMarker$"+Hn;function Si(c){delete c[jr],delete c[Lr],delete c[ru],delete c[Gd],delete c[_c]}function So(c){var l=c[jr];if(l)return l;for(var h=c.parentNode;h;){if(l=h[To]||h[jr]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(c=z2(c);c!==null;){if(h=c[jr])return h;c=z2(c)}return l}c=h,h=c.parentNode}return null}function Wi(c){if(c=c[jr]||c[To]){var l=c.tag;if(l===5||l===6||l===13||l===26||l===27||l===3)return c}return null}function Xo(c){var l=c.tag;if(l===5||l===26||l===27||l===6)return c.stateNode;throw Error(r(33))}function $t(c){var l=c[Ec];return l||(l=c[Ec]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function jn(c){c[vc]=!0}var yc=new Set,Os={};function Jo(c,l){wc(c,l),wc(c+"Capture",l)}function wc(c,l){for(Os[c]=l,c=0;c<l.length;c++)yc.add(l[c])}var zi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),tA={},$o={};function Wd(c){return gr.call($o,c)?!0:gr.call(tA,c)?!1:zi.test(c)?$o[c]=!0:(tA[c]=!0,!1)}function Cc(c,l,h){if(Wd(l))if(h===null)c.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":c.removeAttribute(l);return;case"boolean":var p=l.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){c.removeAttribute(l);return}}c.setAttribute(l,""+h)}}function Zo(c,l,h){if(h===null)c.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(l);return}c.setAttribute(l,""+h)}}function ni(c,l,h,p){if(p===null)c.removeAttribute(h);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(h);return}c.setAttributeNS(l,h,""+p)}}var ea,Ge;function Kt(c){if(ea===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);ea=l&&l[1]||"",Ge=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ea+c+Ge}var nA=!1;function JA(c,l){if(!c||nA)return"";nA=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(l){var Ne=function(){throw Error()};if(Object.defineProperty(Ne.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ne,[])}catch(ge){var me=ge}Reflect.construct(c,[],Ne)}else{try{Ne.call()}catch(ge){me=ge}c.call(Ne.prototype)}}else{try{throw Error()}catch(ge){me=ge}(Ne=c())&&typeof Ne.catch=="function"&&Ne.catch(function(){})}}catch(ge){if(ge&&me&&typeof ge.stack=="string")return[ge.stack,me.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var T=p.DetermineComponentFrameRoot(),V=T[0],W=T[1];if(V&&W){var re=V.split(`
`),fe=W.split(`
`);for(E=p=0;p<re.length&&!re[p].includes("DetermineComponentFrameRoot");)p++;for(;E<fe.length&&!fe[E].includes("DetermineComponentFrameRoot");)E++;if(p===re.length||E===fe.length)for(p=re.length-1,E=fe.length-1;1<=p&&0<=E&&re[p]!==fe[E];)E--;for(;1<=p&&0<=E;p--,E--)if(re[p]!==fe[E]){if(p!==1||E!==1)do if(p--,E--,0>E||re[p]!==fe[E]){var we=`
`+re[p].replace(" at new "," at ");return c.displayName&&we.includes("<anonymous>")&&(we=we.replace("<anonymous>",c.displayName)),we}while(1<=p&&0<=E);break}}}finally{nA=!1,Error.prepareStackTrace=h}return(h=c?c.displayName||c.name:"")?Kt(h):""}function zd(c){switch(c.tag){case 26:case 27:case 5:return Kt(c.type);case 16:return Kt("Lazy");case 13:return Kt("Suspense");case 19:return Kt("SuspenseList");case 0:case 15:return JA(c.type,!1);case 11:return JA(c.type.render,!1);case 1:return JA(c.type,!0);case 31:return Kt("Activity");default:return""}}function iu(c){try{var l="";do l+=zd(c),c=c.return;while(c);return l}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}function qi(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function rA(c){var l=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function Ug(c){var l=rA(c)?"checked":"value",h=Object.getOwnPropertyDescriptor(c.constructor.prototype,l),p=""+c[l];if(!c.hasOwnProperty(l)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var E=h.get,T=h.set;return Object.defineProperty(c,l,{configurable:!0,get:function(){return E.call(this)},set:function(V){p=""+V,T.call(this,V)}}),Object.defineProperty(c,l,{enumerable:h.enumerable}),{getValue:function(){return p},setValue:function(V){p=""+V},stopTracking:function(){c._valueTracker=null,delete c[l]}}}}function su(c){c._valueTracker||(c._valueTracker=Ug(c))}function qd(c){if(!c)return!1;var l=c._valueTracker;if(!l)return!0;var h=l.getValue(),p="";return c&&(p=rA(c)?c.checked?"true":"false":c.value),c=p,c!==h?(l.setValue(c),!0):!1}function iA(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var Of=/[\n"\\]/g;function ri(c){return c.replace(Of,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function oo(c,l,h,p,E,T,V,W){c.name="",V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?c.type=V:c.removeAttribute("type"),l!=null?V==="number"?(l===0&&c.value===""||c.value!=l)&&(c.value=""+qi(l)):c.value!==""+qi(l)&&(c.value=""+qi(l)):V!=="submit"&&V!=="reset"||c.removeAttribute("value"),l!=null?sA(c,V,qi(l)):h!=null?sA(c,V,qi(h)):p!=null&&c.removeAttribute("value"),E==null&&T!=null&&(c.defaultChecked=!!T),E!=null&&(c.checked=E&&typeof E!="function"&&typeof E!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?c.name=""+qi(W):c.removeAttribute("name")}function $A(c,l,h,p,E,T,V,W){if(T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(c.type=T),l!=null||h!=null){if(!(T!=="submit"&&T!=="reset"||l!=null))return;h=h!=null?""+qi(h):"",l=l!=null?""+qi(l):h,W||l===c.value||(c.value=l),c.defaultValue=l}p=p??E,p=typeof p!="function"&&typeof p!="symbol"&&!!p,c.checked=W?c.checked:!!p,c.defaultChecked=!!p,V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"&&(c.name=V)}function sA(c,l,h){l==="number"&&iA(c.ownerDocument)===c||c.defaultValue===""+h||(c.defaultValue=""+h)}function Tc(c,l,h,p){if(c=c.options,l){l={};for(var E=0;E<h.length;E++)l["$"+h[E]]=!0;for(h=0;h<c.length;h++)E=l.hasOwnProperty("$"+c[h].value),c[h].selected!==E&&(c[h].selected=E),E&&p&&(c[h].defaultSelected=!0)}else{for(h=""+qi(h),l=null,E=0;E<c.length;E++){if(c[E].value===h){c[E].selected=!0,p&&(c[E].defaultSelected=!0);return}l!==null||c[E].disabled||(l=c[E])}l!==null&&(l.selected=!0)}}function Yn(c,l,h){if(l!=null&&(l=""+qi(l),l!==c.value&&(c.value=l),h==null)){c.defaultValue!==l&&(c.defaultValue=l);return}c.defaultValue=h!=null?""+qi(h):""}function ZA(c,l,h,p){if(l==null){if(p!=null){if(h!=null)throw Error(r(92));if(je(p)){if(1<p.length)throw Error(r(93));p=p[0]}h=p}h==null&&(h=""),l=h}h=qi(l),c.defaultValue=h,p=c.textContent,p===h&&p!==""&&p!==null&&(c.value=p)}function ao(c,l){if(l){var h=c.firstChild;if(h&&h===c.lastChild&&h.nodeType===3){h.nodeValue=l;return}}c.textContent=l}var el=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Yd(c,l,h){var p=l.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?p?c.setProperty(l,""):l==="float"?c.cssFloat="":c[l]="":p?c.setProperty(l,h):typeof h!="number"||h===0||el.has(l)?l==="float"?c.cssFloat=h:c[l]=(""+h).trim():c[l]=h+"px"}function Xd(c,l,h){if(l!=null&&typeof l!="object")throw Error(r(62));if(c=c.style,h!=null){for(var p in h)!h.hasOwnProperty(p)||l!=null&&l.hasOwnProperty(p)||(p.indexOf("--")===0?c.setProperty(p,""):p==="float"?c.cssFloat="":c[p]="");for(var E in l)p=l[E],l.hasOwnProperty(E)&&h[E]!==p&&Yd(c,E,p)}else for(var T in l)l.hasOwnProperty(T)&&Yd(c,T,l[T])}function Jd(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Pg=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),kg=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ou(c){return kg.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}var Sc=null;function bo(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var bc=null,ta=null;function $d(c){var l=Wi(c);if(l&&(c=l.stateNode)){var h=c[Lr]||null;e:switch(c=l.stateNode,l.type){case"input":if(oo(c,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),l=h.name,h.type==="radio"&&l!=null){for(h=c;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+ri(""+l)+'"][type="radio"]'),l=0;l<h.length;l++){var p=h[l];if(p!==c&&p.form===c.form){var E=p[Lr]||null;if(!E)throw Error(r(90));oo(p,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(l=0;l<h.length;l++)p=h[l],p.form===c.form&&qd(p)}break e;case"textarea":Yn(c,h.value,h.defaultValue);break e;case"select":l=h.value,l!=null&&Tc(c,!!h.multiple,l,!1)}}}var Ra=!1;function au(c,l,h){if(Ra)return c(l,h);Ra=!0;try{var p=c(l);return p}finally{if(Ra=!1,(bc!==null||ta!==null)&&(Ew(),bc&&(l=bc,c=ta,ta=bc=null,$d(l),c)))for(l=0;l<c.length;l++)$d(c[l])}}function tl(c,l){var h=c.stateNode;if(h===null)return null;var p=h[Lr]||null;if(p===null)return null;h=p[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(c=c.type,p=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!p;break e;default:c=!1}if(c)return null;if(h&&typeof h!="function")throw Error(r(231,l,typeof h));return h}var na=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Io=!1;if(na)try{var nl={};Object.defineProperty(nl,"passive",{get:function(){Io=!0}}),window.addEventListener("test",nl,nl),window.removeEventListener("test",nl,nl)}catch{Io=!1}var ra=null,Ic=null,Oa=null;function oe(){if(Oa)return Oa;var c,l=Ic,h=l.length,p,E="value"in ra?ra.value:ra.textContent,T=E.length;for(c=0;c<h&&l[c]===E[c];c++);var V=h-c;for(p=1;p<=V&&l[h-p]===E[T-p];p++);return Oa=E.slice(c,1<p?1-p:void 0)}function pe(c){var l=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&l===13&&(c=13)):c=l,c===10&&(c=13),32<=c||c===13?c:0}function ve(){return!0}function he(){return!1}function Pe(c){function l(h,p,E,T,V){this._reactName=h,this._targetInst=E,this.type=p,this.nativeEvent=T,this.target=V,this.currentTarget=null;for(var W in c)c.hasOwnProperty(W)&&(h=c[W],this[W]=h?h(T):T[W]);return this.isDefaultPrevented=(T.defaultPrevented!=null?T.defaultPrevented:T.returnValue===!1)?ve:he,this.isPropagationStopped=he,this}return d(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=ve)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=ve)},persist:function(){},isPersistent:ve}),l}var $e={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Gt=Pe($e),ct=d({},$e,{view:0,detail:0}),Wt=Pe(ct),it,Kn,Pn,Gn=d({},ct,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:th,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==Pn&&(Pn&&c.type==="mousemove"?(it=c.screenX-Pn.screenX,Kn=c.screenY-Pn.screenY):Kn=it=0,Pn=c),it)},movementY:function(c){return"movementY"in c?c.movementY:Kn}}),bi=Pe(Gn),Ro=d({},Gn,{dataTransfer:0}),Na=Pe(Ro),Zd=d({},ct,{relatedTarget:0}),Nf=Pe(Zd),xg=d({},$e,{animationName:0,elapsedTime:0,pseudoElement:0}),Df=Pe(xg),Oy=d({},$e,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),Bf=Pe(Oy),nI=d({},$e,{data:0}),Mg=Pe(nI),eh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ny={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Fg(c){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(c):(c=Dy[c])?!!l[c]:!1}function th(){return Fg}var By=d({},ct,{key:function(c){if(c.key){var l=eh[c.key]||c.key;if(l!=="Unidentified")return l}return c.type==="keypress"?(c=pe(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?Ny[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:th,charCode:function(c){return c.type==="keypress"?pe(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?pe(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),Lf=Pe(By),Ly=d({},Gn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Vg=Pe(Ly),rl=d({},ct,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:th}),Uy=Pe(rl),Py=d({},$e,{propertyName:0,elapsedTime:0,pseudoElement:0}),ky=Pe(Py),xy=d({},Gn,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),Uf=Pe(xy),co=d({},$e,{newState:0,oldState:0}),My=Pe(co),Fy=[9,13,27,32],oA=na&&"CompositionEvent"in window,_=null;na&&"documentMode"in document&&(_=document.documentMode);var O=na&&"TextEvent"in window&&!_,x=na&&(!oA||_&&8<_&&11>=_),z=" ",le=!1;function _e(c,l){switch(c){case"keyup":return Fy.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fe(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var wn=!1;function Yi(c,l){switch(c){case"compositionend":return Fe(l);case"keypress":return l.which!==32?null:(le=!0,z);case"textInput":return c=l.data,c===z&&le?null:c;default:return null}}function Cn(c,l){if(wn)return c==="compositionend"||!oA&&_e(c,l)?(c=oe(),Oa=Ic=ra=null,wn=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return x&&l.locale!=="ko"?null:l.data;default:return null}}var ls={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xi(c){var l=c&&c.nodeName&&c.nodeName.toLowerCase();return l==="input"?!!ls[c.type]:l==="textarea"}function il(c,l,h,p){bc?ta?ta.push(p):ta=[p]:bc=p,l=Sw(l,"onChange"),0<l.length&&(h=new Gt("onChange","change",null,h,p),c.push({event:h,listeners:l}))}var Ns=null,aA=null;function Qg(c){x2(c,0)}function Vy(c){var l=Xo(c);if(qd(l))return c}function ix(c,l){if(c==="change")return l}var sx=!1;if(na){var rI;if(na){var iI="oninput"in document;if(!iI){var ox=document.createElement("div");ox.setAttribute("oninput","return;"),iI=typeof ox.oninput=="function"}rI=iI}else rI=!1;sx=rI&&(!document.documentMode||9<document.documentMode)}function ax(){Ns&&(Ns.detachEvent("onpropertychange",cx),aA=Ns=null)}function cx(c){if(c.propertyName==="value"&&Vy(aA)){var l=[];il(l,aA,c,bo(c)),au(Qg,l)}}function xte(c,l,h){c==="focusin"?(ax(),Ns=l,aA=h,Ns.attachEvent("onpropertychange",cx)):c==="focusout"&&ax()}function Mte(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return Vy(aA)}function Fte(c,l){if(c==="click")return Vy(l)}function Vte(c,l){if(c==="input"||c==="change")return Vy(l)}function Qte(c,l){return c===l&&(c!==0||1/c===1/l)||c!==c&&l!==l}var ia=typeof Object.is=="function"?Object.is:Qte;function Hg(c,l){if(ia(c,l))return!0;if(typeof c!="object"||c===null||typeof l!="object"||l===null)return!1;var h=Object.keys(c),p=Object.keys(l);if(h.length!==p.length)return!1;for(p=0;p<h.length;p++){var E=h[p];if(!gr.call(l,E)||!ia(c[E],l[E]))return!1}return!0}function Ax(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function lx(c,l){var h=Ax(c);c=0;for(var p;h;){if(h.nodeType===3){if(p=c+h.textContent.length,c<=l&&p>=l)return{node:h,offset:l-c};c=p}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=Ax(h)}}function ux(c,l){return c&&l?c===l?!0:c&&c.nodeType===3?!1:l&&l.nodeType===3?ux(c,l.parentNode):"contains"in c?c.contains(l):c.compareDocumentPosition?!!(c.compareDocumentPosition(l)&16):!1:!1}function dx(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var l=iA(c.document);l instanceof c.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)c=l.contentWindow;else break;l=iA(c.document)}return l}function sI(c){var l=c&&c.nodeName&&c.nodeName.toLowerCase();return l&&(l==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||l==="textarea"||c.contentEditable==="true")}var Hte=na&&"documentMode"in document&&11>=document.documentMode,Pf=null,oI=null,jg=null,aI=!1;function hx(c,l,h){var p=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;aI||Pf==null||Pf!==iA(p)||(p=Pf,"selectionStart"in p&&sI(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),jg&&Hg(jg,p)||(jg=p,p=Sw(oI,"onSelect"),0<p.length&&(l=new Gt("onSelect","select",null,l,h),c.push({event:l,listeners:p}),l.target=Pf)))}function nh(c,l){var h={};return h[c.toLowerCase()]=l.toLowerCase(),h["Webkit"+c]="webkit"+l,h["Moz"+c]="moz"+l,h}var kf={animationend:nh("Animation","AnimationEnd"),animationiteration:nh("Animation","AnimationIteration"),animationstart:nh("Animation","AnimationStart"),transitionrun:nh("Transition","TransitionRun"),transitionstart:nh("Transition","TransitionStart"),transitioncancel:nh("Transition","TransitionCancel"),transitionend:nh("Transition","TransitionEnd")},cI={},fx={};na&&(fx=document.createElement("div").style,"AnimationEvent"in window||(delete kf.animationend.animation,delete kf.animationiteration.animation,delete kf.animationstart.animation),"TransitionEvent"in window||delete kf.transitionend.transition);function rh(c){if(cI[c])return cI[c];if(!kf[c])return c;var l=kf[c],h;for(h in l)if(l.hasOwnProperty(h)&&h in fx)return cI[c]=l[h];return c}var px=rh("animationend"),mx=rh("animationiteration"),gx=rh("animationstart"),jte=rh("transitionrun"),Kte=rh("transitionstart"),Gte=rh("transitioncancel"),_x=rh("transitionend"),Ex=new Map,AI="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");AI.push("scrollEnd");function Rc(c,l){Ex.set(c,l),Jo(l,[c])}var vx=new WeakMap;function Da(c,l){if(typeof c=="object"&&c!==null){var h=vx.get(c);return h!==void 0?h:(l={value:c,source:l,stack:iu(l)},vx.set(c,l),l)}return{value:c,source:l,stack:iu(l)}}var Ba=[],xf=0,lI=0;function Qy(){for(var c=xf,l=lI=xf=0;l<c;){var h=Ba[l];Ba[l++]=null;var p=Ba[l];Ba[l++]=null;var E=Ba[l];Ba[l++]=null;var T=Ba[l];if(Ba[l++]=null,p!==null&&E!==null){var V=p.pending;V===null?E.next=E:(E.next=V.next,V.next=E),p.pending=E}T!==0&&yx(h,E,T)}}function Hy(c,l,h,p){Ba[xf++]=c,Ba[xf++]=l,Ba[xf++]=h,Ba[xf++]=p,lI|=p,c.lanes|=p,c=c.alternate,c!==null&&(c.lanes|=p)}function uI(c,l,h,p){return Hy(c,l,h,p),jy(c)}function Mf(c,l){return Hy(c,null,null,l),jy(c)}function yx(c,l,h){c.lanes|=h;var p=c.alternate;p!==null&&(p.lanes|=h);for(var E=!1,T=c.return;T!==null;)T.childLanes|=h,p=T.alternate,p!==null&&(p.childLanes|=h),T.tag===22&&(c=T.stateNode,c===null||c._visibility&1||(E=!0)),c=T,T=T.return;return c.tag===3?(T=c.stateNode,E&&l!==null&&(E=31-wi(h),c=T.hiddenUpdates,p=c[E],p===null?c[E]=[l]:p.push(l),l.lane=h|536870912),T):null}function jy(c){if(50<f_)throw f_=0,gR=null,Error(r(185));for(var l=c.return;l!==null;)c=l,l=c.return;return c.tag===3?c.stateNode:null}var Ff={};function Wte(c,l,h,p){this.tag=c,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sa(c,l,h,p){return new Wte(c,l,h,p)}function dI(c){return c=c.prototype,!(!c||!c.isReactComponent)}function sl(c,l){var h=c.alternate;return h===null?(h=sa(c.tag,l,c.key,c.mode),h.elementType=c.elementType,h.type=c.type,h.stateNode=c.stateNode,h.alternate=c,c.alternate=h):(h.pendingProps=l,h.type=c.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=c.flags&65011712,h.childLanes=c.childLanes,h.lanes=c.lanes,h.child=c.child,h.memoizedProps=c.memoizedProps,h.memoizedState=c.memoizedState,h.updateQueue=c.updateQueue,l=c.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=c.sibling,h.index=c.index,h.ref=c.ref,h.refCleanup=c.refCleanup,h}function wx(c,l){c.flags&=65011714;var h=c.alternate;return h===null?(c.childLanes=0,c.lanes=l,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=h.childLanes,c.lanes=h.lanes,c.child=h.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=h.memoizedProps,c.memoizedState=h.memoizedState,c.updateQueue=h.updateQueue,c.type=h.type,l=h.dependencies,c.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),c}function Ky(c,l,h,p,E,T){var V=0;if(p=c,typeof c=="function")dI(c)&&(V=1);else if(typeof c=="string")V=qne(c,h,ee.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case k:return c=sa(31,h,l,E),c.elementType=k,c.lanes=T,c;case v:return ih(h.children,E,T,l);case y:V=8,E|=24;break;case w:return c=sa(12,h,l,E|2),c.elementType=w,c.lanes=T,c;case H:return c=sa(13,h,l,E),c.elementType=H,c.lanes=T,c;case K:return c=sa(19,h,l,E),c.elementType=K,c.lanes=T,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case b:case B:V=10;break e;case I:V=9;break e;case M:V=11;break e;case Q:V=14;break e;case F:V=16,p=null;break e}V=29,h=Error(r(130,c===null?"null":typeof c,"")),p=null}return l=sa(V,h,l,E),l.elementType=c,l.type=p,l.lanes=T,l}function ih(c,l,h,p){return c=sa(7,c,p,l),c.lanes=h,c}function hI(c,l,h){return c=sa(6,c,null,l),c.lanes=h,c}function fI(c,l,h){return l=sa(4,c.children!==null?c.children:[],c.key,l),l.lanes=h,l.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},l}var Vf=[],Qf=0,Gy=null,Wy=0,La=[],Ua=0,sh=null,ol=1,al="";function oh(c,l){Vf[Qf++]=Wy,Vf[Qf++]=Gy,Gy=c,Wy=l}function Cx(c,l,h){La[Ua++]=ol,La[Ua++]=al,La[Ua++]=sh,sh=c;var p=ol;c=al;var E=32-wi(p)-1;p&=~(1<<E),h+=1;var T=32-wi(l)+E;if(30<T){var V=E-E%5;T=(p&(1<<V)-1).toString(32),p>>=V,E-=V,ol=1<<32-wi(l)+E|h<<E|p,al=T+c}else ol=1<<T|h<<E|p,al=c}function pI(c){c.return!==null&&(oh(c,1),Cx(c,1,0))}function mI(c){for(;c===Gy;)Gy=Vf[--Qf],Vf[Qf]=null,Wy=Vf[--Qf],Vf[Qf]=null;for(;c===sh;)sh=La[--Ua],La[Ua]=null,al=La[--Ua],La[Ua]=null,ol=La[--Ua],La[Ua]=null}var Ao=null,ii=null,Wn=!1,ah=null,cA=!1,gI=Error(r(519));function ch(c){var l=Error(r(418,""));throw Wg(Da(l,c)),gI}function Tx(c){var l=c.stateNode,h=c.type,p=c.memoizedProps;switch(l[jr]=c,l[Lr]=p,h){case"dialog":ln("cancel",l),ln("close",l);break;case"iframe":case"object":case"embed":ln("load",l);break;case"video":case"audio":for(h=0;h<m_.length;h++)ln(m_[h],l);break;case"source":ln("error",l);break;case"img":case"image":case"link":ln("error",l),ln("load",l);break;case"details":ln("toggle",l);break;case"input":ln("invalid",l),$A(l,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),su(l);break;case"select":ln("invalid",l);break;case"textarea":ln("invalid",l),ZA(l,p.value,p.defaultValue,p.children),su(l)}h=p.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||l.textContent===""+h||p.suppressHydrationWarning===!0||Q2(l.textContent,h)?(p.popover!=null&&(ln("beforetoggle",l),ln("toggle",l)),p.onScroll!=null&&ln("scroll",l),p.onScrollEnd!=null&&ln("scrollend",l),p.onClick!=null&&(l.onclick=bw),l=!0):l=!1,l||ch(c)}function Sx(c){for(Ao=c.return;Ao;)switch(Ao.tag){case 5:case 13:cA=!1;return;case 27:case 3:cA=!0;return;default:Ao=Ao.return}}function Kg(c){if(c!==Ao)return!1;if(!Wn)return Sx(c),Wn=!0,!1;var l=c.tag,h;if((h=l!==3&&l!==27)&&((h=l===5)&&(h=c.type,h=!(h!=="form"&&h!=="button")||LR(c.type,c.memoizedProps)),h=!h),h&&ii&&ch(c),Sx(c),l===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(r(317));e:{for(c=c.nextSibling,l=0;c;){if(c.nodeType===8)if(h=c.data,h==="/$"){if(l===0){ii=Nc(c.nextSibling);break e}l--}else h!=="$"&&h!=="$!"&&h!=="$?"||l++;c=c.nextSibling}ii=null}}else l===27?(l=ii,Cu(c.type)?(c=xR,xR=null,ii=c):ii=l):ii=Ao?Nc(c.stateNode.nextSibling):null;return!0}function Gg(){ii=Ao=null,Wn=!1}function bx(){var c=ah;return c!==null&&(Do===null?Do=c:Do.push.apply(Do,c),ah=null),c}function Wg(c){ah===null?ah=[c]:ah.push(c)}var _I=C(null),Ah=null,cl=null;function cu(c,l,h){U(_I,l._currentValue),l._currentValue=h}function Al(c){c._currentValue=_I.current,D(_I)}function EI(c,l,h){for(;c!==null;){var p=c.alternate;if((c.childLanes&l)!==l?(c.childLanes|=l,p!==null&&(p.childLanes|=l)):p!==null&&(p.childLanes&l)!==l&&(p.childLanes|=l),c===h)break;c=c.return}}function vI(c,l,h,p){var E=c.child;for(E!==null&&(E.return=c);E!==null;){var T=E.dependencies;if(T!==null){var V=E.child;T=T.firstContext;e:for(;T!==null;){var W=T;T=E;for(var re=0;re<l.length;re++)if(W.context===l[re]){T.lanes|=h,W=T.alternate,W!==null&&(W.lanes|=h),EI(T.return,h,c),p||(V=null);break e}T=W.next}}else if(E.tag===18){if(V=E.return,V===null)throw Error(r(341));V.lanes|=h,T=V.alternate,T!==null&&(T.lanes|=h),EI(V,h,c),V=null}else V=E.child;if(V!==null)V.return=E;else for(V=E;V!==null;){if(V===c){V=null;break}if(E=V.sibling,E!==null){E.return=V.return,V=E;break}V=V.return}E=V}}function zg(c,l,h,p){c=null;for(var E=l,T=!1;E!==null;){if(!T){if((E.flags&524288)!==0)T=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var V=E.alternate;if(V===null)throw Error(r(387));if(V=V.memoizedProps,V!==null){var W=E.type;ia(E.pendingProps.value,V.value)||(c!==null?c.push(W):c=[W])}}else if(E===lt.current){if(V=E.alternate,V===null)throw Error(r(387));V.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(c!==null?c.push(w_):c=[w_])}E=E.return}c!==null&&vI(l,c,h,p),l.flags|=262144}function zy(c){for(c=c.firstContext;c!==null;){if(!ia(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function lh(c){Ah=c,cl=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function Ws(c){return Ix(Ah,c)}function qy(c,l){return Ah===null&&lh(c),Ix(c,l)}function Ix(c,l){var h=l._currentValue;if(l={context:l,memoizedValue:h,next:null},cl===null){if(c===null)throw Error(r(308));cl=l,c.dependencies={lanes:0,firstContext:l},c.flags|=524288}else cl=cl.next=l;return h}var zte=typeof AbortController<"u"?AbortController:function(){var c=[],l=this.signal={aborted:!1,addEventListener:function(h,p){c.push(p)}};this.abort=function(){l.aborted=!0,c.forEach(function(h){return h()})}},qte=t.unstable_scheduleCallback,Yte=t.unstable_NormalPriority,Ji={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function yI(){return{controller:new zte,data:new Map,refCount:0}}function qg(c){c.refCount--,c.refCount===0&&qte(Yte,function(){c.controller.abort()})}var Yg=null,wI=0,Hf=0,jf=null;function Xte(c,l){if(Yg===null){var h=Yg=[];wI=0,Hf=TR(),jf={status:"pending",value:void 0,then:function(p){h.push(p)}}}return wI++,l.then(Rx,Rx),l}function Rx(){if(--wI===0&&Yg!==null){jf!==null&&(jf.status="fulfilled");var c=Yg;Yg=null,Hf=0,jf=null;for(var l=0;l<c.length;l++)(0,c[l])()}}function Jte(c,l){var h=[],p={status:"pending",value:null,reason:null,then:function(E){h.push(E)}};return c.then(function(){p.status="fulfilled",p.value=l;for(var E=0;E<h.length;E++)(0,h[E])(l)},function(E){for(p.status="rejected",p.reason=E,E=0;E<h.length;E++)(0,h[E])(void 0)}),p}var Ox=de.S;de.S=function(c,l){typeof l=="object"&&l!==null&&typeof l.then=="function"&&Xte(c,l),Ox!==null&&Ox(c,l)};var uh=C(null);function CI(){var c=uh.current;return c!==null?c:Ir.pooledCache}function Yy(c,l){l===null?U(uh,uh.current):U(uh,l.pool)}function Nx(){var c=CI();return c===null?null:{parent:Ji._currentValue,pool:c}}var Xg=Error(r(460)),Dx=Error(r(474)),Xy=Error(r(542)),TI={then:function(){}};function Bx(c){return c=c.status,c==="fulfilled"||c==="rejected"}function Jy(){}function Lx(c,l,h){switch(h=c[h],h===void 0?c.push(l):h!==l&&(l.then(Jy,Jy),l=h),l.status){case"fulfilled":return l.value;case"rejected":throw c=l.reason,Px(c),c;default:if(typeof l.status=="string")l.then(Jy,Jy);else{if(c=Ir,c!==null&&100<c.shellSuspendCounter)throw Error(r(482));c=l,c.status="pending",c.then(function(p){if(l.status==="pending"){var E=l;E.status="fulfilled",E.value=p}},function(p){if(l.status==="pending"){var E=l;E.status="rejected",E.reason=p}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw c=l.reason,Px(c),c}throw Jg=l,Xg}}var Jg=null;function Ux(){if(Jg===null)throw Error(r(459));var c=Jg;return Jg=null,c}function Px(c){if(c===Xg||c===Xy)throw Error(r(483))}var Au=!1;function SI(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function bI(c,l){c=c.updateQueue,l.updateQueue===c&&(l.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function lu(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function uu(c,l,h){var p=c.updateQueue;if(p===null)return null;if(p=p.shared,(nr&2)!==0){var E=p.pending;return E===null?l.next=l:(l.next=E.next,E.next=l),p.pending=l,l=jy(c),yx(c,null,h),l}return Hy(c,p,l,h),jy(c)}function $g(c,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194048)!==0)){var p=l.lanes;p&=c.pendingLanes,h|=p,l.lanes=h,Kd(c,h)}}function II(c,l){var h=c.updateQueue,p=c.alternate;if(p!==null&&(p=p.updateQueue,h===p)){var E=null,T=null;if(h=h.firstBaseUpdate,h!==null){do{var V={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};T===null?E=T=V:T=T.next=V,h=h.next}while(h!==null);T===null?E=T=l:T=T.next=l}else E=T=l;h={baseState:p.baseState,firstBaseUpdate:E,lastBaseUpdate:T,shared:p.shared,callbacks:p.callbacks},c.updateQueue=h;return}c=h.lastBaseUpdate,c===null?h.firstBaseUpdate=l:c.next=l,h.lastBaseUpdate=l}var RI=!1;function Zg(){if(RI){var c=jf;if(c!==null)throw c}}function e_(c,l,h,p){RI=!1;var E=c.updateQueue;Au=!1;var T=E.firstBaseUpdate,V=E.lastBaseUpdate,W=E.shared.pending;if(W!==null){E.shared.pending=null;var re=W,fe=re.next;re.next=null,V===null?T=fe:V.next=fe,V=re;var we=c.alternate;we!==null&&(we=we.updateQueue,W=we.lastBaseUpdate,W!==V&&(W===null?we.firstBaseUpdate=fe:W.next=fe,we.lastBaseUpdate=re))}if(T!==null){var Ne=E.baseState;V=0,we=fe=re=null,W=T;do{var me=W.lane&-536870913,ge=me!==W.lane;if(ge?(Tn&me)===me:(p&me)===me){me!==0&&me===Hf&&(RI=!0),we!==null&&(we=we.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var It=c,vt=W;me=l;var dr=h;switch(vt.tag){case 1:if(It=vt.payload,typeof It=="function"){Ne=It.call(dr,Ne,me);break e}Ne=It;break e;case 3:It.flags=It.flags&-65537|128;case 0:if(It=vt.payload,me=typeof It=="function"?It.call(dr,Ne,me):It,me==null)break e;Ne=d({},Ne,me);break e;case 2:Au=!0}}me=W.callback,me!==null&&(c.flags|=64,ge&&(c.flags|=8192),ge=E.callbacks,ge===null?E.callbacks=[me]:ge.push(me))}else ge={lane:me,tag:W.tag,payload:W.payload,callback:W.callback,next:null},we===null?(fe=we=ge,re=Ne):we=we.next=ge,V|=me;if(W=W.next,W===null){if(W=E.shared.pending,W===null)break;ge=W,W=ge.next,ge.next=null,E.lastBaseUpdate=ge,E.shared.pending=null}}while(!0);we===null&&(re=Ne),E.baseState=re,E.firstBaseUpdate=fe,E.lastBaseUpdate=we,T===null&&(E.shared.lanes=0),Eu|=V,c.lanes=V,c.memoizedState=Ne}}function kx(c,l){if(typeof c!="function")throw Error(r(191,c));c.call(l)}function xx(c,l){var h=c.callbacks;if(h!==null)for(c.callbacks=null,c=0;c<h.length;c++)kx(h[c],l)}var Kf=C(null),$y=C(0);function Mx(c,l){c=ml,U($y,c),U(Kf,l),ml=c|l.baseLanes}function OI(){U($y,ml),U(Kf,Kf.current)}function NI(){ml=$y.current,D(Kf),D($y)}var du=0,Zt=null,lr=null,Fi=null,Zy=!1,Gf=!1,dh=!1,ew=0,t_=0,Wf=null,$te=0;function Ii(){throw Error(r(321))}function DI(c,l){if(l===null)return!1;for(var h=0;h<l.length&&h<c.length;h++)if(!ia(c[h],l[h]))return!1;return!0}function BI(c,l,h,p,E,T){return du=T,Zt=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,de.H=c===null||c.memoizedState===null?yM:wM,dh=!1,T=h(p,E),dh=!1,Gf&&(T=Vx(l,h,p,E)),Fx(c),T}function Fx(c){de.H=ow;var l=lr!==null&&lr.next!==null;if(du=0,Fi=lr=Zt=null,Zy=!1,t_=0,Wf=null,l)throw Error(r(300));c===null||us||(c=c.dependencies,c!==null&&zy(c)&&(us=!0))}function Vx(c,l,h,p){Zt=c;var E=0;do{if(Gf&&(Wf=null),t_=0,Gf=!1,25<=E)throw Error(r(301));if(E+=1,Fi=lr=null,c.updateQueue!=null){var T=c.updateQueue;T.lastEffect=null,T.events=null,T.stores=null,T.memoCache!=null&&(T.memoCache.index=0)}de.H=sne,T=l(h,p)}while(Gf);return T}function Zte(){var c=de.H,l=c.useState()[0];return l=typeof l.then=="function"?n_(l):l,c=c.useState()[0],(lr!==null?lr.memoizedState:null)!==c&&(Zt.flags|=1024),l}function LI(){var c=ew!==0;return ew=0,c}function UI(c,l,h){l.updateQueue=c.updateQueue,l.flags&=-2053,c.lanes&=~h}function PI(c){if(Zy){for(c=c.memoizedState;c!==null;){var l=c.queue;l!==null&&(l.pending=null),c=c.next}Zy=!1}du=0,Fi=lr=Zt=null,Gf=!1,t_=ew=0,Wf=null}function Oo(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fi===null?Zt.memoizedState=Fi=c:Fi=Fi.next=c,Fi}function Vi(){if(lr===null){var c=Zt.alternate;c=c!==null?c.memoizedState:null}else c=lr.next;var l=Fi===null?Zt.memoizedState:Fi.next;if(l!==null)Fi=l,lr=c;else{if(c===null)throw Zt.alternate===null?Error(r(467)):Error(r(310));lr=c,c={memoizedState:lr.memoizedState,baseState:lr.baseState,baseQueue:lr.baseQueue,queue:lr.queue,next:null},Fi===null?Zt.memoizedState=Fi=c:Fi=Fi.next=c}return Fi}function kI(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function n_(c){var l=t_;return t_+=1,Wf===null&&(Wf=[]),c=Lx(Wf,c,l),l=Zt,(Fi===null?l.memoizedState:Fi.next)===null&&(l=l.alternate,de.H=l===null||l.memoizedState===null?yM:wM),c}function tw(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return n_(c);if(c.$$typeof===B)return Ws(c)}throw Error(r(438,String(c)))}function xI(c){var l=null,h=Zt.updateQueue;if(h!==null&&(l=h.memoCache),l==null){var p=Zt.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(l={data:p.data.map(function(E){return E.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),h===null&&(h=kI(),Zt.updateQueue=h),h.memoCache=l,h=l.data[l.index],h===void 0)for(h=l.data[l.index]=Array(c),p=0;p<c;p++)h[p]=G;return l.index++,h}function ll(c,l){return typeof l=="function"?l(c):l}function nw(c){var l=Vi();return MI(l,lr,c)}function MI(c,l,h){var p=c.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=h;var E=c.baseQueue,T=p.pending;if(T!==null){if(E!==null){var V=E.next;E.next=T.next,T.next=V}l.baseQueue=E=T,p.pending=null}if(T=c.baseState,E===null)c.memoizedState=T;else{l=E.next;var W=V=null,re=null,fe=l,we=!1;do{var Ne=fe.lane&-536870913;if(Ne!==fe.lane?(Tn&Ne)===Ne:(du&Ne)===Ne){var me=fe.revertLane;if(me===0)re!==null&&(re=re.next={lane:0,revertLane:0,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null}),Ne===Hf&&(we=!0);else if((du&me)===me){fe=fe.next,me===Hf&&(we=!0);continue}else Ne={lane:0,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},re===null?(W=re=Ne,V=T):re=re.next=Ne,Zt.lanes|=me,Eu|=me;Ne=fe.action,dh&&h(T,Ne),T=fe.hasEagerState?fe.eagerState:h(T,Ne)}else me={lane:Ne,revertLane:fe.revertLane,action:fe.action,hasEagerState:fe.hasEagerState,eagerState:fe.eagerState,next:null},re===null?(W=re=me,V=T):re=re.next=me,Zt.lanes|=Ne,Eu|=Ne;fe=fe.next}while(fe!==null&&fe!==l);if(re===null?V=T:re.next=W,!ia(T,c.memoizedState)&&(us=!0,we&&(h=jf,h!==null)))throw h;c.memoizedState=T,c.baseState=V,c.baseQueue=re,p.lastRenderedState=T}return E===null&&(p.lanes=0),[c.memoizedState,p.dispatch]}function FI(c){var l=Vi(),h=l.queue;if(h===null)throw Error(r(311));h.lastRenderedReducer=c;var p=h.dispatch,E=h.pending,T=l.memoizedState;if(E!==null){h.pending=null;var V=E=E.next;do T=c(T,V.action),V=V.next;while(V!==E);ia(T,l.memoizedState)||(us=!0),l.memoizedState=T,l.baseQueue===null&&(l.baseState=T),h.lastRenderedState=T}return[T,p]}function Qx(c,l,h){var p=Zt,E=Vi(),T=Wn;if(T){if(h===void 0)throw Error(r(407));h=h()}else h=l();var V=!ia((lr||E).memoizedState,h);V&&(E.memoizedState=h,us=!0),E=E.queue;var W=Kx.bind(null,p,E,c);if(r_(2048,8,W,[c]),E.getSnapshot!==l||V||Fi!==null&&Fi.memoizedState.tag&1){if(p.flags|=2048,zf(9,rw(),jx.bind(null,p,E,h,l),null),Ir===null)throw Error(r(349));T||(du&124)!==0||Hx(p,l,h)}return h}function Hx(c,l,h){c.flags|=16384,c={getSnapshot:l,value:h},l=Zt.updateQueue,l===null?(l=kI(),Zt.updateQueue=l,l.stores=[c]):(h=l.stores,h===null?l.stores=[c]:h.push(c))}function jx(c,l,h,p){l.value=h,l.getSnapshot=p,Gx(l)&&Wx(c)}function Kx(c,l,h){return h(function(){Gx(l)&&Wx(c)})}function Gx(c){var l=c.getSnapshot;c=c.value;try{var h=l();return!ia(c,h)}catch{return!0}}function Wx(c){var l=Mf(c,2);l!==null&&la(l,c,2)}function VI(c){var l=Oo();if(typeof c=="function"){var h=c;if(c=h(),dh){Rs(!0);try{h()}finally{Rs(!1)}}}return l.memoizedState=l.baseState=c,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ll,lastRenderedState:c},l}function zx(c,l,h,p){return c.baseState=h,MI(c,lr,typeof p=="function"?p:ll)}function ene(c,l,h,p,E){if(sw(c))throw Error(r(485));if(c=l.action,c!==null){var T={payload:E,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(V){T.listeners.push(V)}};de.T!==null?h(!0):T.isTransition=!1,p(T),h=l.pending,h===null?(T.next=l.pending=T,qx(l,T)):(T.next=h.next,l.pending=h.next=T)}}function qx(c,l){var h=l.action,p=l.payload,E=c.state;if(l.isTransition){var T=de.T,V={};de.T=V;try{var W=h(E,p),re=de.S;re!==null&&re(V,W),Yx(c,l,W)}catch(fe){QI(c,l,fe)}finally{de.T=T}}else try{T=h(E,p),Yx(c,l,T)}catch(fe){QI(c,l,fe)}}function Yx(c,l,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(p){Xx(c,l,p)},function(p){return QI(c,l,p)}):Xx(c,l,h)}function Xx(c,l,h){l.status="fulfilled",l.value=h,Jx(l),c.state=h,l=c.pending,l!==null&&(h=l.next,h===l?c.pending=null:(h=h.next,l.next=h,qx(c,h)))}function QI(c,l,h){var p=c.pending;if(c.pending=null,p!==null){p=p.next;do l.status="rejected",l.reason=h,Jx(l),l=l.next;while(l!==p)}c.action=null}function Jx(c){c=c.listeners;for(var l=0;l<c.length;l++)(0,c[l])()}function $x(c,l){return l}function Zx(c,l){if(Wn){var h=Ir.formState;if(h!==null){e:{var p=Zt;if(Wn){if(ii){t:{for(var E=ii,T=cA;E.nodeType!==8;){if(!T){E=null;break t}if(E=Nc(E.nextSibling),E===null){E=null;break t}}T=E.data,E=T==="F!"||T==="F"?E:null}if(E){ii=Nc(E.nextSibling),p=E.data==="F!";break e}}ch(p)}p=!1}p&&(l=h[0])}}return h=Oo(),h.memoizedState=h.baseState=l,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$x,lastRenderedState:l},h.queue=p,h=_M.bind(null,Zt,p),p.dispatch=h,p=VI(!1),T=WI.bind(null,Zt,!1,p.queue),p=Oo(),E={state:l,dispatch:null,action:c,pending:null},p.queue=E,h=ene.bind(null,Zt,E,T,h),E.dispatch=h,p.memoizedState=c,[l,h,!1]}function eM(c){var l=Vi();return tM(l,lr,c)}function tM(c,l,h){if(l=MI(c,l,$x)[0],c=nw(ll)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var p=n_(l)}catch(V){throw V===Xg?Xy:V}else p=l;l=Vi();var E=l.queue,T=E.dispatch;return h!==l.memoizedState&&(Zt.flags|=2048,zf(9,rw(),tne.bind(null,E,h),null)),[p,T,c]}function tne(c,l){c.action=l}function nM(c){var l=Vi(),h=lr;if(h!==null)return tM(l,h,c);Vi(),l=l.memoizedState,h=Vi();var p=h.queue.dispatch;return h.memoizedState=c,[l,p,!1]}function zf(c,l,h,p){return c={tag:c,create:h,deps:p,inst:l,next:null},l=Zt.updateQueue,l===null&&(l=kI(),Zt.updateQueue=l),h=l.lastEffect,h===null?l.lastEffect=c.next=c:(p=h.next,h.next=c,c.next=p,l.lastEffect=c),c}function rw(){return{destroy:void 0,resource:void 0}}function rM(){return Vi().memoizedState}function iw(c,l,h,p){var E=Oo();p=p===void 0?null:p,Zt.flags|=c,E.memoizedState=zf(1|l,rw(),h,p)}function r_(c,l,h,p){var E=Vi();p=p===void 0?null:p;var T=E.memoizedState.inst;lr!==null&&p!==null&&DI(p,lr.memoizedState.deps)?E.memoizedState=zf(l,T,h,p):(Zt.flags|=c,E.memoizedState=zf(1|l,T,h,p))}function iM(c,l){iw(8390656,8,c,l)}function sM(c,l){r_(2048,8,c,l)}function oM(c,l){return r_(4,2,c,l)}function aM(c,l){return r_(4,4,c,l)}function cM(c,l){if(typeof l=="function"){c=c();var h=l(c);return function(){typeof h=="function"?h():l(null)}}if(l!=null)return c=c(),l.current=c,function(){l.current=null}}function AM(c,l,h){h=h!=null?h.concat([c]):null,r_(4,4,cM.bind(null,l,c),h)}function HI(){}function lM(c,l){var h=Vi();l=l===void 0?null:l;var p=h.memoizedState;return l!==null&&DI(l,p[1])?p[0]:(h.memoizedState=[c,l],c)}function uM(c,l){var h=Vi();l=l===void 0?null:l;var p=h.memoizedState;if(l!==null&&DI(l,p[1]))return p[0];if(p=c(),dh){Rs(!0);try{c()}finally{Rs(!1)}}return h.memoizedState=[p,l],p}function jI(c,l,h){return h===void 0||(du&1073741824)!==0?c.memoizedState=l:(c.memoizedState=h,c=f2(),Zt.lanes|=c,Eu|=c,h)}function dM(c,l,h,p){return ia(h,l)?h:Kf.current!==null?(c=jI(c,h,p),ia(c,l)||(us=!0),c):(du&42)===0?(us=!0,c.memoizedState=h):(c=f2(),Zt.lanes|=c,Eu|=c,l)}function hM(c,l,h,p,E){var T=J.p;J.p=T!==0&&8>T?T:8;var V=de.T,W={};de.T=W,WI(c,!1,l,h);try{var re=E(),fe=de.S;if(fe!==null&&fe(W,re),re!==null&&typeof re=="object"&&typeof re.then=="function"){var we=Jte(re,p);i_(c,l,we,Aa(c))}else i_(c,l,p,Aa(c))}catch(Ne){i_(c,l,{then:function(){},status:"rejected",reason:Ne},Aa())}finally{J.p=T,de.T=V}}function nne(){}function KI(c,l,h,p){if(c.tag!==5)throw Error(r(476));var E=fM(c).queue;hM(c,E,l,Y,h===null?nne:function(){return pM(c),h(p)})}function fM(c){var l=c.memoizedState;if(l!==null)return l;l={memoizedState:Y,baseState:Y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ll,lastRenderedState:Y},next:null};var h={};return l.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ll,lastRenderedState:h},next:null},c.memoizedState=l,c=c.alternate,c!==null&&(c.memoizedState=l),l}function pM(c){var l=fM(c).next.queue;i_(c,l,{},Aa())}function GI(){return Ws(w_)}function mM(){return Vi().memoizedState}function gM(){return Vi().memoizedState}function rne(c){for(var l=c.return;l!==null;){switch(l.tag){case 24:case 3:var h=Aa();c=lu(h);var p=uu(l,c,h);p!==null&&(la(p,l,h),$g(p,l,h)),l={cache:yI()},c.payload=l;return}l=l.return}}function ine(c,l,h){var p=Aa();h={lane:p,revertLane:0,action:h,hasEagerState:!1,eagerState:null,next:null},sw(c)?EM(l,h):(h=uI(c,l,h,p),h!==null&&(la(h,c,p),vM(h,l,p)))}function _M(c,l,h){var p=Aa();i_(c,l,h,p)}function i_(c,l,h,p){var E={lane:p,revertLane:0,action:h,hasEagerState:!1,eagerState:null,next:null};if(sw(c))EM(l,E);else{var T=c.alternate;if(c.lanes===0&&(T===null||T.lanes===0)&&(T=l.lastRenderedReducer,T!==null))try{var V=l.lastRenderedState,W=T(V,h);if(E.hasEagerState=!0,E.eagerState=W,ia(W,V))return Hy(c,l,E,0),Ir===null&&Qy(),!1}catch{}finally{}if(h=uI(c,l,E,p),h!==null)return la(h,c,p),vM(h,l,p),!0}return!1}function WI(c,l,h,p){if(p={lane:2,revertLane:TR(),action:p,hasEagerState:!1,eagerState:null,next:null},sw(c)){if(l)throw Error(r(479))}else l=uI(c,h,p,2),l!==null&&la(l,c,2)}function sw(c){var l=c.alternate;return c===Zt||l!==null&&l===Zt}function EM(c,l){Gf=Zy=!0;var h=c.pending;h===null?l.next=l:(l.next=h.next,h.next=l),c.pending=l}function vM(c,l,h){if((h&4194048)!==0){var p=l.lanes;p&=c.pendingLanes,h|=p,l.lanes=h,Kd(c,h)}}var ow={readContext:Ws,use:tw,useCallback:Ii,useContext:Ii,useEffect:Ii,useImperativeHandle:Ii,useLayoutEffect:Ii,useInsertionEffect:Ii,useMemo:Ii,useReducer:Ii,useRef:Ii,useState:Ii,useDebugValue:Ii,useDeferredValue:Ii,useTransition:Ii,useSyncExternalStore:Ii,useId:Ii,useHostTransitionStatus:Ii,useFormState:Ii,useActionState:Ii,useOptimistic:Ii,useMemoCache:Ii,useCacheRefresh:Ii},yM={readContext:Ws,use:tw,useCallback:function(c,l){return Oo().memoizedState=[c,l===void 0?null:l],c},useContext:Ws,useEffect:iM,useImperativeHandle:function(c,l,h){h=h!=null?h.concat([c]):null,iw(4194308,4,cM.bind(null,l,c),h)},useLayoutEffect:function(c,l){return iw(4194308,4,c,l)},useInsertionEffect:function(c,l){iw(4,2,c,l)},useMemo:function(c,l){var h=Oo();l=l===void 0?null:l;var p=c();if(dh){Rs(!0);try{c()}finally{Rs(!1)}}return h.memoizedState=[p,l],p},useReducer:function(c,l,h){var p=Oo();if(h!==void 0){var E=h(l);if(dh){Rs(!0);try{h(l)}finally{Rs(!1)}}}else E=l;return p.memoizedState=p.baseState=E,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:E},p.queue=c,c=c.dispatch=ine.bind(null,Zt,c),[p.memoizedState,c]},useRef:function(c){var l=Oo();return c={current:c},l.memoizedState=c},useState:function(c){c=VI(c);var l=c.queue,h=_M.bind(null,Zt,l);return l.dispatch=h,[c.memoizedState,h]},useDebugValue:HI,useDeferredValue:function(c,l){var h=Oo();return jI(h,c,l)},useTransition:function(){var c=VI(!1);return c=hM.bind(null,Zt,c.queue,!0,!1),Oo().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,l,h){var p=Zt,E=Oo();if(Wn){if(h===void 0)throw Error(r(407));h=h()}else{if(h=l(),Ir===null)throw Error(r(349));(Tn&124)!==0||Hx(p,l,h)}E.memoizedState=h;var T={value:h,getSnapshot:l};return E.queue=T,iM(Kx.bind(null,p,T,c),[c]),p.flags|=2048,zf(9,rw(),jx.bind(null,p,T,h,l),null),h},useId:function(){var c=Oo(),l=Ir.identifierPrefix;if(Wn){var h=al,p=ol;h=(p&~(1<<32-wi(p)-1)).toString(32)+h,l=""+l+"R"+h,h=ew++,0<h&&(l+="H"+h.toString(32)),l+=""}else h=$te++,l=""+l+"r"+h.toString(32)+"";return c.memoizedState=l},useHostTransitionStatus:GI,useFormState:Zx,useActionState:Zx,useOptimistic:function(c){var l=Oo();l.memoizedState=l.baseState=c;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=h,l=WI.bind(null,Zt,!0,h),h.dispatch=l,[c,l]},useMemoCache:xI,useCacheRefresh:function(){return Oo().memoizedState=rne.bind(null,Zt)}},wM={readContext:Ws,use:tw,useCallback:lM,useContext:Ws,useEffect:sM,useImperativeHandle:AM,useInsertionEffect:oM,useLayoutEffect:aM,useMemo:uM,useReducer:nw,useRef:rM,useState:function(){return nw(ll)},useDebugValue:HI,useDeferredValue:function(c,l){var h=Vi();return dM(h,lr.memoizedState,c,l)},useTransition:function(){var c=nw(ll)[0],l=Vi().memoizedState;return[typeof c=="boolean"?c:n_(c),l]},useSyncExternalStore:Qx,useId:mM,useHostTransitionStatus:GI,useFormState:eM,useActionState:eM,useOptimistic:function(c,l){var h=Vi();return zx(h,lr,c,l)},useMemoCache:xI,useCacheRefresh:gM},sne={readContext:Ws,use:tw,useCallback:lM,useContext:Ws,useEffect:sM,useImperativeHandle:AM,useInsertionEffect:oM,useLayoutEffect:aM,useMemo:uM,useReducer:FI,useRef:rM,useState:function(){return FI(ll)},useDebugValue:HI,useDeferredValue:function(c,l){var h=Vi();return lr===null?jI(h,c,l):dM(h,lr.memoizedState,c,l)},useTransition:function(){var c=FI(ll)[0],l=Vi().memoizedState;return[typeof c=="boolean"?c:n_(c),l]},useSyncExternalStore:Qx,useId:mM,useHostTransitionStatus:GI,useFormState:nM,useActionState:nM,useOptimistic:function(c,l){var h=Vi();return lr!==null?zx(h,lr,c,l):(h.baseState=c,[c,h.queue.dispatch])},useMemoCache:xI,useCacheRefresh:gM},qf=null,s_=0;function aw(c){var l=s_;return s_+=1,qf===null&&(qf=[]),Lx(qf,c,l)}function o_(c,l){l=l.props.ref,c.ref=l!==void 0?l:null}function cw(c,l){throw l.$$typeof===f?Error(r(525)):(c=Object.prototype.toString.call(l),Error(r(31,c==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":c)))}function CM(c){var l=c._init;return l(c._payload)}function TM(c){function l(ce,ae){if(c){var ue=ce.deletions;ue===null?(ce.deletions=[ae],ce.flags|=16):ue.push(ae)}}function h(ce,ae){if(!c)return null;for(;ae!==null;)l(ce,ae),ae=ae.sibling;return null}function p(ce){for(var ae=new Map;ce!==null;)ce.key!==null?ae.set(ce.key,ce):ae.set(ce.index,ce),ce=ce.sibling;return ae}function E(ce,ae){return ce=sl(ce,ae),ce.index=0,ce.sibling=null,ce}function T(ce,ae,ue){return ce.index=ue,c?(ue=ce.alternate,ue!==null?(ue=ue.index,ue<ae?(ce.flags|=67108866,ae):ue):(ce.flags|=67108866,ae)):(ce.flags|=1048576,ae)}function V(ce){return c&&ce.alternate===null&&(ce.flags|=67108866),ce}function W(ce,ae,ue,be){return ae===null||ae.tag!==6?(ae=hI(ue,ce.mode,be),ae.return=ce,ae):(ae=E(ae,ue),ae.return=ce,ae)}function re(ce,ae,ue,be){var nt=ue.type;return nt===v?we(ce,ae,ue.props.children,be,ue.key):ae!==null&&(ae.elementType===nt||typeof nt=="object"&&nt!==null&&nt.$$typeof===F&&CM(nt)===ae.type)?(ae=E(ae,ue.props),o_(ae,ue),ae.return=ce,ae):(ae=Ky(ue.type,ue.key,ue.props,null,ce.mode,be),o_(ae,ue),ae.return=ce,ae)}function fe(ce,ae,ue,be){return ae===null||ae.tag!==4||ae.stateNode.containerInfo!==ue.containerInfo||ae.stateNode.implementation!==ue.implementation?(ae=fI(ue,ce.mode,be),ae.return=ce,ae):(ae=E(ae,ue.children||[]),ae.return=ce,ae)}function we(ce,ae,ue,be,nt){return ae===null||ae.tag!==7?(ae=ih(ue,ce.mode,be,nt),ae.return=ce,ae):(ae=E(ae,ue),ae.return=ce,ae)}function Ne(ce,ae,ue){if(typeof ae=="string"&&ae!==""||typeof ae=="number"||typeof ae=="bigint")return ae=hI(""+ae,ce.mode,ue),ae.return=ce,ae;if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case m:return ue=Ky(ae.type,ae.key,ae.props,null,ce.mode,ue),o_(ue,ae),ue.return=ce,ue;case g:return ae=fI(ae,ce.mode,ue),ae.return=ce,ae;case F:var be=ae._init;return ae=be(ae._payload),Ne(ce,ae,ue)}if(je(ae)||ne(ae))return ae=ih(ae,ce.mode,ue,null),ae.return=ce,ae;if(typeof ae.then=="function")return Ne(ce,aw(ae),ue);if(ae.$$typeof===B)return Ne(ce,qy(ce,ae),ue);cw(ce,ae)}return null}function me(ce,ae,ue,be){var nt=ae!==null?ae.key:null;if(typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint")return nt!==null?null:W(ce,ae,""+ue,be);if(typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case m:return ue.key===nt?re(ce,ae,ue,be):null;case g:return ue.key===nt?fe(ce,ae,ue,be):null;case F:return nt=ue._init,ue=nt(ue._payload),me(ce,ae,ue,be)}if(je(ue)||ne(ue))return nt!==null?null:we(ce,ae,ue,be,null);if(typeof ue.then=="function")return me(ce,ae,aw(ue),be);if(ue.$$typeof===B)return me(ce,ae,qy(ce,ue),be);cw(ce,ue)}return null}function ge(ce,ae,ue,be,nt){if(typeof be=="string"&&be!==""||typeof be=="number"||typeof be=="bigint")return ce=ce.get(ue)||null,W(ae,ce,""+be,nt);if(typeof be=="object"&&be!==null){switch(be.$$typeof){case m:return ce=ce.get(be.key===null?ue:be.key)||null,re(ae,ce,be,nt);case g:return ce=ce.get(be.key===null?ue:be.key)||null,fe(ae,ce,be,nt);case F:var rn=be._init;return be=rn(be._payload),ge(ce,ae,ue,be,nt)}if(je(be)||ne(be))return ce=ce.get(ue)||null,we(ae,ce,be,nt,null);if(typeof be.then=="function")return ge(ce,ae,ue,aw(be),nt);if(be.$$typeof===B)return ge(ce,ae,ue,qy(ae,be),nt);cw(ae,be)}return null}function It(ce,ae,ue,be){for(var nt=null,rn=null,ut=ae,wt=ae=0,hs=null;ut!==null&&wt<ue.length;wt++){ut.index>wt?(hs=ut,ut=null):hs=ut.sibling;var kn=me(ce,ut,ue[wt],be);if(kn===null){ut===null&&(ut=hs);break}c&&ut&&kn.alternate===null&&l(ce,ut),ae=T(kn,ae,wt),rn===null?nt=kn:rn.sibling=kn,rn=kn,ut=hs}if(wt===ue.length)return h(ce,ut),Wn&&oh(ce,wt),nt;if(ut===null){for(;wt<ue.length;wt++)ut=Ne(ce,ue[wt],be),ut!==null&&(ae=T(ut,ae,wt),rn===null?nt=ut:rn.sibling=ut,rn=ut);return Wn&&oh(ce,wt),nt}for(ut=p(ut);wt<ue.length;wt++)hs=ge(ut,ce,wt,ue[wt],be),hs!==null&&(c&&hs.alternate!==null&&ut.delete(hs.key===null?wt:hs.key),ae=T(hs,ae,wt),rn===null?nt=hs:rn.sibling=hs,rn=hs);return c&&ut.forEach(function(Ru){return l(ce,Ru)}),Wn&&oh(ce,wt),nt}function vt(ce,ae,ue,be){if(ue==null)throw Error(r(151));for(var nt=null,rn=null,ut=ae,wt=ae=0,hs=null,kn=ue.next();ut!==null&&!kn.done;wt++,kn=ue.next()){ut.index>wt?(hs=ut,ut=null):hs=ut.sibling;var Ru=me(ce,ut,kn.value,be);if(Ru===null){ut===null&&(ut=hs);break}c&&ut&&Ru.alternate===null&&l(ce,ut),ae=T(Ru,ae,wt),rn===null?nt=Ru:rn.sibling=Ru,rn=Ru,ut=hs}if(kn.done)return h(ce,ut),Wn&&oh(ce,wt),nt;if(ut===null){for(;!kn.done;wt++,kn=ue.next())kn=Ne(ce,kn.value,be),kn!==null&&(ae=T(kn,ae,wt),rn===null?nt=kn:rn.sibling=kn,rn=kn);return Wn&&oh(ce,wt),nt}for(ut=p(ut);!kn.done;wt++,kn=ue.next())kn=ge(ut,ce,wt,kn.value,be),kn!==null&&(c&&kn.alternate!==null&&ut.delete(kn.key===null?wt:kn.key),ae=T(kn,ae,wt),rn===null?nt=kn:rn.sibling=kn,rn=kn);return c&&ut.forEach(function(ore){return l(ce,ore)}),Wn&&oh(ce,wt),nt}function dr(ce,ae,ue,be){if(typeof ue=="object"&&ue!==null&&ue.type===v&&ue.key===null&&(ue=ue.props.children),typeof ue=="object"&&ue!==null){switch(ue.$$typeof){case m:e:{for(var nt=ue.key;ae!==null;){if(ae.key===nt){if(nt=ue.type,nt===v){if(ae.tag===7){h(ce,ae.sibling),be=E(ae,ue.props.children),be.return=ce,ce=be;break e}}else if(ae.elementType===nt||typeof nt=="object"&&nt!==null&&nt.$$typeof===F&&CM(nt)===ae.type){h(ce,ae.sibling),be=E(ae,ue.props),o_(be,ue),be.return=ce,ce=be;break e}h(ce,ae);break}else l(ce,ae);ae=ae.sibling}ue.type===v?(be=ih(ue.props.children,ce.mode,be,ue.key),be.return=ce,ce=be):(be=Ky(ue.type,ue.key,ue.props,null,ce.mode,be),o_(be,ue),be.return=ce,ce=be)}return V(ce);case g:e:{for(nt=ue.key;ae!==null;){if(ae.key===nt)if(ae.tag===4&&ae.stateNode.containerInfo===ue.containerInfo&&ae.stateNode.implementation===ue.implementation){h(ce,ae.sibling),be=E(ae,ue.children||[]),be.return=ce,ce=be;break e}else{h(ce,ae);break}else l(ce,ae);ae=ae.sibling}be=fI(ue,ce.mode,be),be.return=ce,ce=be}return V(ce);case F:return nt=ue._init,ue=nt(ue._payload),dr(ce,ae,ue,be)}if(je(ue))return It(ce,ae,ue,be);if(ne(ue)){if(nt=ne(ue),typeof nt!="function")throw Error(r(150));return ue=nt.call(ue),vt(ce,ae,ue,be)}if(typeof ue.then=="function")return dr(ce,ae,aw(ue),be);if(ue.$$typeof===B)return dr(ce,ae,qy(ce,ue),be);cw(ce,ue)}return typeof ue=="string"&&ue!==""||typeof ue=="number"||typeof ue=="bigint"?(ue=""+ue,ae!==null&&ae.tag===6?(h(ce,ae.sibling),be=E(ae,ue),be.return=ce,ce=be):(h(ce,ae),be=hI(ue,ce.mode,be),be.return=ce,ce=be),V(ce)):h(ce,ae)}return function(ce,ae,ue,be){try{s_=0;var nt=dr(ce,ae,ue,be);return qf=null,nt}catch(ut){if(ut===Xg||ut===Xy)throw ut;var rn=sa(29,ut,null,ce.mode);return rn.lanes=be,rn.return=ce,rn}finally{}}}var Yf=TM(!0),SM=TM(!1),Pa=C(null),AA=null;function hu(c){var l=c.alternate;U($i,$i.current&1),U(Pa,c),AA===null&&(l===null||Kf.current!==null||l.memoizedState!==null)&&(AA=c)}function bM(c){if(c.tag===22){if(U($i,$i.current),U(Pa,c),AA===null){var l=c.alternate;l!==null&&l.memoizedState!==null&&(AA=c)}}else fu()}function fu(){U($i,$i.current),U(Pa,Pa.current)}function ul(c){D(Pa),AA===c&&(AA=null),D($i)}var $i=C(0);function Aw(c){for(var l=c;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||kR(h)))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===c)break;for(;l.sibling===null;){if(l.return===null||l.return===c)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}function zI(c,l,h,p){l=c.memoizedState,h=h(p,l),h=h==null?l:d({},l,h),c.memoizedState=h,c.lanes===0&&(c.updateQueue.baseState=h)}var qI={enqueueSetState:function(c,l,h){c=c._reactInternals;var p=Aa(),E=lu(p);E.payload=l,h!=null&&(E.callback=h),l=uu(c,E,p),l!==null&&(la(l,c,p),$g(l,c,p))},enqueueReplaceState:function(c,l,h){c=c._reactInternals;var p=Aa(),E=lu(p);E.tag=1,E.payload=l,h!=null&&(E.callback=h),l=uu(c,E,p),l!==null&&(la(l,c,p),$g(l,c,p))},enqueueForceUpdate:function(c,l){c=c._reactInternals;var h=Aa(),p=lu(h);p.tag=2,l!=null&&(p.callback=l),l=uu(c,p,h),l!==null&&(la(l,c,h),$g(l,c,h))}};function IM(c,l,h,p,E,T,V){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(p,T,V):l.prototype&&l.prototype.isPureReactComponent?!Hg(h,p)||!Hg(E,T):!0}function RM(c,l,h,p){c=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,p),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,p),l.state!==c&&qI.enqueueReplaceState(l,l.state,null)}function hh(c,l){var h=l;if("ref"in l){h={};for(var p in l)p!=="ref"&&(h[p]=l[p])}if(c=c.defaultProps){h===l&&(h=d({},h));for(var E in c)h[E]===void 0&&(h[E]=c[E])}return h}var lw=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)};function OM(c){lw(c)}function NM(c){console.error(c)}function DM(c){lw(c)}function uw(c,l){try{var h=c.onUncaughtError;h(l.value,{componentStack:l.stack})}catch(p){setTimeout(function(){throw p})}}function BM(c,l,h){try{var p=c.onCaughtError;p(h.value,{componentStack:h.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function YI(c,l,h){return h=lu(h),h.tag=3,h.payload={element:null},h.callback=function(){uw(c,l)},h}function LM(c){return c=lu(c),c.tag=3,c}function UM(c,l,h,p){var E=h.type.getDerivedStateFromError;if(typeof E=="function"){var T=p.value;c.payload=function(){return E(T)},c.callback=function(){BM(l,h,p)}}var V=h.stateNode;V!==null&&typeof V.componentDidCatch=="function"&&(c.callback=function(){BM(l,h,p),typeof E!="function"&&(vu===null?vu=new Set([this]):vu.add(this));var W=p.stack;this.componentDidCatch(p.value,{componentStack:W!==null?W:""})})}function one(c,l,h,p,E){if(h.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(l=h.alternate,l!==null&&zg(l,h,E,!0),h=Pa.current,h!==null){switch(h.tag){case 13:return AA===null?ER():h.alternate===null&&si===0&&(si=3),h.flags&=-257,h.flags|=65536,h.lanes=E,p===TI?h.flags|=16384:(l=h.updateQueue,l===null?h.updateQueue=new Set([p]):l.add(p),yR(c,p,E)),!1;case 22:return h.flags|=65536,p===TI?h.flags|=16384:(l=h.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([p])},h.updateQueue=l):(h=l.retryQueue,h===null?l.retryQueue=new Set([p]):h.add(p)),yR(c,p,E)),!1}throw Error(r(435,h.tag))}return yR(c,p,E),ER(),!1}if(Wn)return l=Pa.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=E,p!==gI&&(c=Error(r(422),{cause:p}),Wg(Da(c,h)))):(p!==gI&&(l=Error(r(423),{cause:p}),Wg(Da(l,h))),c=c.current.alternate,c.flags|=65536,E&=-E,c.lanes|=E,p=Da(p,h),E=YI(c.stateNode,p,E),II(c,E),si!==4&&(si=2)),!1;var T=Error(r(520),{cause:p});if(T=Da(T,h),h_===null?h_=[T]:h_.push(T),si!==4&&(si=2),l===null)return!0;p=Da(p,h),h=l;do{switch(h.tag){case 3:return h.flags|=65536,c=E&-E,h.lanes|=c,c=YI(h.stateNode,p,c),II(h,c),!1;case 1:if(l=h.type,T=h.stateNode,(h.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||T!==null&&typeof T.componentDidCatch=="function"&&(vu===null||!vu.has(T))))return h.flags|=65536,E&=-E,h.lanes|=E,E=LM(E),UM(E,c,h,p),II(h,E),!1}h=h.return}while(h!==null);return!1}var PM=Error(r(461)),us=!1;function Ds(c,l,h,p){l.child=c===null?SM(l,null,h,p):Yf(l,c.child,h,p)}function kM(c,l,h,p,E){h=h.render;var T=l.ref;if("ref"in p){var V={};for(var W in p)W!=="ref"&&(V[W]=p[W])}else V=p;return lh(l),p=BI(c,l,h,V,T,E),W=LI(),c!==null&&!us?(UI(c,l,E),dl(c,l,E)):(Wn&&W&&pI(l),l.flags|=1,Ds(c,l,p,E),l.child)}function xM(c,l,h,p,E){if(c===null){var T=h.type;return typeof T=="function"&&!dI(T)&&T.defaultProps===void 0&&h.compare===null?(l.tag=15,l.type=T,MM(c,l,T,p,E)):(c=Ky(h.type,null,p,l,l.mode,E),c.ref=l.ref,c.return=l,l.child=c)}if(T=c.child,!rR(c,E)){var V=T.memoizedProps;if(h=h.compare,h=h!==null?h:Hg,h(V,p)&&c.ref===l.ref)return dl(c,l,E)}return l.flags|=1,c=sl(T,p),c.ref=l.ref,c.return=l,l.child=c}function MM(c,l,h,p,E){if(c!==null){var T=c.memoizedProps;if(Hg(T,p)&&c.ref===l.ref)if(us=!1,l.pendingProps=p=T,rR(c,E))(c.flags&131072)!==0&&(us=!0);else return l.lanes=c.lanes,dl(c,l,E)}return XI(c,l,h,p,E)}function FM(c,l,h){var p=l.pendingProps,E=p.children,T=c!==null?c.memoizedState:null;if(p.mode==="hidden"){if((l.flags&128)!==0){if(p=T!==null?T.baseLanes|h:h,c!==null){for(E=l.child=c.child,T=0;E!==null;)T=T|E.lanes|E.childLanes,E=E.sibling;l.childLanes=T&~p}else l.childLanes=0,l.child=null;return VM(c,l,p,h)}if((h&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},c!==null&&Yy(l,T!==null?T.cachePool:null),T!==null?Mx(l,T):OI(),bM(l);else return l.lanes=l.childLanes=536870912,VM(c,l,T!==null?T.baseLanes|h:h,h)}else T!==null?(Yy(l,T.cachePool),Mx(l,T),fu(),l.memoizedState=null):(c!==null&&Yy(l,null),OI(),fu());return Ds(c,l,E,h),l.child}function VM(c,l,h,p){var E=CI();return E=E===null?null:{parent:Ji._currentValue,pool:E},l.memoizedState={baseLanes:h,cachePool:E},c!==null&&Yy(l,null),OI(),bM(l),c!==null&&zg(c,l,p,!0),null}function dw(c,l){var h=l.ref;if(h===null)c!==null&&c.ref!==null&&(l.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(r(284));(c===null||c.ref!==h)&&(l.flags|=4194816)}}function XI(c,l,h,p,E){return lh(l),h=BI(c,l,h,p,void 0,E),p=LI(),c!==null&&!us?(UI(c,l,E),dl(c,l,E)):(Wn&&p&&pI(l),l.flags|=1,Ds(c,l,h,E),l.child)}function QM(c,l,h,p,E,T){return lh(l),l.updateQueue=null,h=Vx(l,p,h,E),Fx(c),p=LI(),c!==null&&!us?(UI(c,l,T),dl(c,l,T)):(Wn&&p&&pI(l),l.flags|=1,Ds(c,l,h,T),l.child)}function HM(c,l,h,p,E){if(lh(l),l.stateNode===null){var T=Ff,V=h.contextType;typeof V=="object"&&V!==null&&(T=Ws(V)),T=new h(p,T),l.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,T.updater=qI,l.stateNode=T,T._reactInternals=l,T=l.stateNode,T.props=p,T.state=l.memoizedState,T.refs={},SI(l),V=h.contextType,T.context=typeof V=="object"&&V!==null?Ws(V):Ff,T.state=l.memoizedState,V=h.getDerivedStateFromProps,typeof V=="function"&&(zI(l,h,V,p),T.state=l.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(V=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),V!==T.state&&qI.enqueueReplaceState(T,T.state,null),e_(l,p,T,E),Zg(),T.state=l.memoizedState),typeof T.componentDidMount=="function"&&(l.flags|=4194308),p=!0}else if(c===null){T=l.stateNode;var W=l.memoizedProps,re=hh(h,W);T.props=re;var fe=T.context,we=h.contextType;V=Ff,typeof we=="object"&&we!==null&&(V=Ws(we));var Ne=h.getDerivedStateFromProps;we=typeof Ne=="function"||typeof T.getSnapshotBeforeUpdate=="function",W=l.pendingProps!==W,we||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(W||fe!==V)&&RM(l,T,p,V),Au=!1;var me=l.memoizedState;T.state=me,e_(l,p,T,E),Zg(),fe=l.memoizedState,W||me!==fe||Au?(typeof Ne=="function"&&(zI(l,h,Ne,p),fe=l.memoizedState),(re=Au||IM(l,h,re,p,me,fe,V))?(we||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(l.flags|=4194308)):(typeof T.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=p,l.memoizedState=fe),T.props=p,T.state=fe,T.context=V,p=re):(typeof T.componentDidMount=="function"&&(l.flags|=4194308),p=!1)}else{T=l.stateNode,bI(c,l),V=l.memoizedProps,we=hh(h,V),T.props=we,Ne=l.pendingProps,me=T.context,fe=h.contextType,re=Ff,typeof fe=="object"&&fe!==null&&(re=Ws(fe)),W=h.getDerivedStateFromProps,(fe=typeof W=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(V!==Ne||me!==re)&&RM(l,T,p,re),Au=!1,me=l.memoizedState,T.state=me,e_(l,p,T,E),Zg();var ge=l.memoizedState;V!==Ne||me!==ge||Au||c!==null&&c.dependencies!==null&&zy(c.dependencies)?(typeof W=="function"&&(zI(l,h,W,p),ge=l.memoizedState),(we=Au||IM(l,h,we,p,me,ge,re)||c!==null&&c.dependencies!==null&&zy(c.dependencies))?(fe||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(p,ge,re),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(p,ge,re)),typeof T.componentDidUpdate=="function"&&(l.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof T.componentDidUpdate!="function"||V===c.memoizedProps&&me===c.memoizedState||(l.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||V===c.memoizedProps&&me===c.memoizedState||(l.flags|=1024),l.memoizedProps=p,l.memoizedState=ge),T.props=p,T.state=ge,T.context=re,p=we):(typeof T.componentDidUpdate!="function"||V===c.memoizedProps&&me===c.memoizedState||(l.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||V===c.memoizedProps&&me===c.memoizedState||(l.flags|=1024),p=!1)}return T=p,dw(c,l),p=(l.flags&128)!==0,T||p?(T=l.stateNode,h=p&&typeof h.getDerivedStateFromError!="function"?null:T.render(),l.flags|=1,c!==null&&p?(l.child=Yf(l,c.child,null,E),l.child=Yf(l,null,h,E)):Ds(c,l,h,E),l.memoizedState=T.state,c=l.child):c=dl(c,l,E),c}function jM(c,l,h,p){return Gg(),l.flags|=256,Ds(c,l,h,p),l.child}var JI={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function $I(c){return{baseLanes:c,cachePool:Nx()}}function ZI(c,l,h){return c=c!==null?c.childLanes&~h:0,l&&(c|=ka),c}function KM(c,l,h){var p=l.pendingProps,E=!1,T=(l.flags&128)!==0,V;if((V=T)||(V=c!==null&&c.memoizedState===null?!1:($i.current&2)!==0),V&&(E=!0,l.flags&=-129),V=(l.flags&32)!==0,l.flags&=-33,c===null){if(Wn){if(E?hu(l):fu(),Wn){var W=ii,re;if(re=W){e:{for(re=W,W=cA;re.nodeType!==8;){if(!W){W=null;break e}if(re=Nc(re.nextSibling),re===null){W=null;break e}}W=re}W!==null?(l.memoizedState={dehydrated:W,treeContext:sh!==null?{id:ol,overflow:al}:null,retryLane:536870912,hydrationErrors:null},re=sa(18,null,null,0),re.stateNode=W,re.return=l,l.child=re,Ao=l,ii=null,re=!0):re=!1}re||ch(l)}if(W=l.memoizedState,W!==null&&(W=W.dehydrated,W!==null))return kR(W)?l.lanes=32:l.lanes=536870912,null;ul(l)}return W=p.children,p=p.fallback,E?(fu(),E=l.mode,W=hw({mode:"hidden",children:W},E),p=ih(p,E,h,null),W.return=l,p.return=l,W.sibling=p,l.child=W,E=l.child,E.memoizedState=$I(h),E.childLanes=ZI(c,V,h),l.memoizedState=JI,p):(hu(l),eR(l,W))}if(re=c.memoizedState,re!==null&&(W=re.dehydrated,W!==null)){if(T)l.flags&256?(hu(l),l.flags&=-257,l=tR(c,l,h)):l.memoizedState!==null?(fu(),l.child=c.child,l.flags|=128,l=null):(fu(),E=p.fallback,W=l.mode,p=hw({mode:"visible",children:p.children},W),E=ih(E,W,h,null),E.flags|=2,p.return=l,E.return=l,p.sibling=E,l.child=p,Yf(l,c.child,null,h),p=l.child,p.memoizedState=$I(h),p.childLanes=ZI(c,V,h),l.memoizedState=JI,l=E);else if(hu(l),kR(W)){if(V=W.nextSibling&&W.nextSibling.dataset,V)var fe=V.dgst;V=fe,p=Error(r(419)),p.stack="",p.digest=V,Wg({value:p,source:null,stack:null}),l=tR(c,l,h)}else if(us||zg(c,l,h,!1),V=(h&c.childLanes)!==0,us||V){if(V=Ir,V!==null&&(p=h&-h,p=(p&42)!==0?1:Gs(p),p=(p&(V.suspendedLanes|h))!==0?0:p,p!==0&&p!==re.retryLane))throw re.retryLane=p,Mf(c,p),la(V,c,p),PM;W.data==="$?"||ER(),l=tR(c,l,h)}else W.data==="$?"?(l.flags|=192,l.child=c.child,l=null):(c=re.treeContext,ii=Nc(W.nextSibling),Ao=l,Wn=!0,ah=null,cA=!1,c!==null&&(La[Ua++]=ol,La[Ua++]=al,La[Ua++]=sh,ol=c.id,al=c.overflow,sh=l),l=eR(l,p.children),l.flags|=4096);return l}return E?(fu(),E=p.fallback,W=l.mode,re=c.child,fe=re.sibling,p=sl(re,{mode:"hidden",children:p.children}),p.subtreeFlags=re.subtreeFlags&65011712,fe!==null?E=sl(fe,E):(E=ih(E,W,h,null),E.flags|=2),E.return=l,p.return=l,p.sibling=E,l.child=p,p=E,E=l.child,W=c.child.memoizedState,W===null?W=$I(h):(re=W.cachePool,re!==null?(fe=Ji._currentValue,re=re.parent!==fe?{parent:fe,pool:fe}:re):re=Nx(),W={baseLanes:W.baseLanes|h,cachePool:re}),E.memoizedState=W,E.childLanes=ZI(c,V,h),l.memoizedState=JI,p):(hu(l),h=c.child,c=h.sibling,h=sl(h,{mode:"visible",children:p.children}),h.return=l,h.sibling=null,c!==null&&(V=l.deletions,V===null?(l.deletions=[c],l.flags|=16):V.push(c)),l.child=h,l.memoizedState=null,h)}function eR(c,l){return l=hw({mode:"visible",children:l},c.mode),l.return=c,c.child=l}function hw(c,l){return c=sa(22,c,null,l),c.lanes=0,c.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},c}function tR(c,l,h){return Yf(l,c.child,null,h),c=eR(l,l.pendingProps.children),c.flags|=2,l.memoizedState=null,c}function GM(c,l,h){c.lanes|=l;var p=c.alternate;p!==null&&(p.lanes|=l),EI(c.return,l,h)}function nR(c,l,h,p,E){var T=c.memoizedState;T===null?c.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:p,tail:h,tailMode:E}:(T.isBackwards=l,T.rendering=null,T.renderingStartTime=0,T.last=p,T.tail=h,T.tailMode=E)}function WM(c,l,h){var p=l.pendingProps,E=p.revealOrder,T=p.tail;if(Ds(c,l,p.children,h),p=$i.current,(p&2)!==0)p=p&1|2,l.flags|=128;else{if(c!==null&&(c.flags&128)!==0)e:for(c=l.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&GM(c,h,l);else if(c.tag===19)GM(c,h,l);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===l)break e;for(;c.sibling===null;){if(c.return===null||c.return===l)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}p&=1}switch(U($i,p),E){case"forwards":for(h=l.child,E=null;h!==null;)c=h.alternate,c!==null&&Aw(c)===null&&(E=h),h=h.sibling;h=E,h===null?(E=l.child,l.child=null):(E=h.sibling,h.sibling=null),nR(l,!1,E,h,T);break;case"backwards":for(h=null,E=l.child,l.child=null;E!==null;){if(c=E.alternate,c!==null&&Aw(c)===null){l.child=E;break}c=E.sibling,E.sibling=h,h=E,E=c}nR(l,!0,h,null,T);break;case"together":nR(l,!1,null,null,void 0);break;default:l.memoizedState=null}return l.child}function dl(c,l,h){if(c!==null&&(l.dependencies=c.dependencies),Eu|=l.lanes,(h&l.childLanes)===0)if(c!==null){if(zg(c,l,h,!1),(h&l.childLanes)===0)return null}else return null;if(c!==null&&l.child!==c.child)throw Error(r(153));if(l.child!==null){for(c=l.child,h=sl(c,c.pendingProps),l.child=h,h.return=l;c.sibling!==null;)c=c.sibling,h=h.sibling=sl(c,c.pendingProps),h.return=l;h.sibling=null}return l.child}function rR(c,l){return(c.lanes&l)!==0?!0:(c=c.dependencies,!!(c!==null&&zy(c)))}function ane(c,l,h){switch(l.tag){case 3:St(l,l.stateNode.containerInfo),cu(l,Ji,c.memoizedState.cache),Gg();break;case 27:case 5:cs(l);break;case 4:St(l,l.stateNode.containerInfo);break;case 10:cu(l,l.type,l.memoizedProps.value);break;case 13:var p=l.memoizedState;if(p!==null)return p.dehydrated!==null?(hu(l),l.flags|=128,null):(h&l.child.childLanes)!==0?KM(c,l,h):(hu(l),c=dl(c,l,h),c!==null?c.sibling:null);hu(l);break;case 19:var E=(c.flags&128)!==0;if(p=(h&l.childLanes)!==0,p||(zg(c,l,h,!1),p=(h&l.childLanes)!==0),E){if(p)return WM(c,l,h);l.flags|=128}if(E=l.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),U($i,$i.current),p)break;return null;case 22:case 23:return l.lanes=0,FM(c,l,h);case 24:cu(l,Ji,c.memoizedState.cache)}return dl(c,l,h)}function zM(c,l,h){if(c!==null)if(c.memoizedProps!==l.pendingProps)us=!0;else{if(!rR(c,h)&&(l.flags&128)===0)return us=!1,ane(c,l,h);us=(c.flags&131072)!==0}else us=!1,Wn&&(l.flags&1048576)!==0&&Cx(l,Wy,l.index);switch(l.lanes=0,l.tag){case 16:e:{c=l.pendingProps;var p=l.elementType,E=p._init;if(p=E(p._payload),l.type=p,typeof p=="function")dI(p)?(c=hh(p,c),l.tag=1,l=HM(null,l,p,c,h)):(l.tag=0,l=XI(null,l,p,c,h));else{if(p!=null){if(E=p.$$typeof,E===M){l.tag=11,l=kM(null,l,p,c,h);break e}else if(E===Q){l.tag=14,l=xM(null,l,p,c,h);break e}}throw l=qe(p)||p,Error(r(306,l,""))}}return l;case 0:return XI(c,l,l.type,l.pendingProps,h);case 1:return p=l.type,E=hh(p,l.pendingProps),HM(c,l,p,E,h);case 3:e:{if(St(l,l.stateNode.containerInfo),c===null)throw Error(r(387));p=l.pendingProps;var T=l.memoizedState;E=T.element,bI(c,l),e_(l,p,null,h);var V=l.memoizedState;if(p=V.cache,cu(l,Ji,p),p!==T.cache&&vI(l,[Ji],h,!0),Zg(),p=V.element,T.isDehydrated)if(T={element:p,isDehydrated:!1,cache:V.cache},l.updateQueue.baseState=T,l.memoizedState=T,l.flags&256){l=jM(c,l,p,h);break e}else if(p!==E){E=Da(Error(r(424)),l),Wg(E),l=jM(c,l,p,h);break e}else{switch(c=l.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(ii=Nc(c.firstChild),Ao=l,Wn=!0,ah=null,cA=!0,h=SM(l,null,p,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling}else{if(Gg(),p===E){l=dl(c,l,h);break e}Ds(c,l,p,h)}l=l.child}return l;case 26:return dw(c,l),c===null?(h=J2(l.type,null,l.pendingProps,null))?l.memoizedState=h:Wn||(h=l.type,c=l.pendingProps,p=Iw(Re.current).createElement(h),p[jr]=l,p[Lr]=c,Ls(p,h,c),jn(p),l.stateNode=p):l.memoizedState=J2(l.type,c.memoizedProps,l.pendingProps,c.memoizedState),null;case 27:return cs(l),c===null&&Wn&&(p=l.stateNode=q2(l.type,l.pendingProps,Re.current),Ao=l,cA=!0,E=ii,Cu(l.type)?(xR=E,ii=Nc(p.firstChild)):ii=E),Ds(c,l,l.pendingProps.children,h),dw(c,l),c===null&&(l.flags|=4194304),l.child;case 5:return c===null&&Wn&&((E=p=ii)&&(p=Pne(p,l.type,l.pendingProps,cA),p!==null?(l.stateNode=p,Ao=l,ii=Nc(p.firstChild),cA=!1,E=!0):E=!1),E||ch(l)),cs(l),E=l.type,T=l.pendingProps,V=c!==null?c.memoizedProps:null,p=T.children,LR(E,T)?p=null:V!==null&&LR(E,V)&&(l.flags|=32),l.memoizedState!==null&&(E=BI(c,l,Zte,null,null,h),w_._currentValue=E),dw(c,l),Ds(c,l,p,h),l.child;case 6:return c===null&&Wn&&((c=h=ii)&&(h=kne(h,l.pendingProps,cA),h!==null?(l.stateNode=h,Ao=l,ii=null,c=!0):c=!1),c||ch(l)),null;case 13:return KM(c,l,h);case 4:return St(l,l.stateNode.containerInfo),p=l.pendingProps,c===null?l.child=Yf(l,null,p,h):Ds(c,l,p,h),l.child;case 11:return kM(c,l,l.type,l.pendingProps,h);case 7:return Ds(c,l,l.pendingProps,h),l.child;case 8:return Ds(c,l,l.pendingProps.children,h),l.child;case 12:return Ds(c,l,l.pendingProps.children,h),l.child;case 10:return p=l.pendingProps,cu(l,l.type,p.value),Ds(c,l,p.children,h),l.child;case 9:return E=l.type._context,p=l.pendingProps.children,lh(l),E=Ws(E),p=p(E),l.flags|=1,Ds(c,l,p,h),l.child;case 14:return xM(c,l,l.type,l.pendingProps,h);case 15:return MM(c,l,l.type,l.pendingProps,h);case 19:return WM(c,l,h);case 31:return p=l.pendingProps,h=l.mode,p={mode:p.mode,children:p.children},c===null?(h=hw(p,h),h.ref=l.ref,l.child=h,h.return=l,l=h):(h=sl(c.child,p),h.ref=l.ref,l.child=h,h.return=l,l=h),l;case 22:return FM(c,l,h);case 24:return lh(l),p=Ws(Ji),c===null?(E=CI(),E===null&&(E=Ir,T=yI(),E.pooledCache=T,T.refCount++,T!==null&&(E.pooledCacheLanes|=h),E=T),l.memoizedState={parent:p,cache:E},SI(l),cu(l,Ji,E)):((c.lanes&h)!==0&&(bI(c,l),e_(l,null,null,h),Zg()),E=c.memoizedState,T=l.memoizedState,E.parent!==p?(E={parent:p,cache:p},l.memoizedState=E,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=E),cu(l,Ji,p)):(p=T.cache,cu(l,Ji,p),p!==E.cache&&vI(l,[Ji],h,!0))),Ds(c,l,l.pendingProps.children,h),l.child;case 29:throw l.pendingProps}throw Error(r(156,l.tag))}function hl(c){c.flags|=4}function qM(c,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!nF(l)){if(l=Pa.current,l!==null&&((Tn&4194048)===Tn?AA!==null:(Tn&62914560)!==Tn&&(Tn&536870912)===0||l!==AA))throw Jg=TI,Dx;c.flags|=8192}}function fw(c,l){l!==null&&(c.flags|=4),c.flags&16384&&(l=c.tag!==22?Ci():536870912,c.lanes|=l,Zf|=l)}function a_(c,l){if(!Wn)switch(c.tailMode){case"hidden":l=c.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?c.tail=null:h.sibling=null;break;case"collapsed":h=c.tail;for(var p=null;h!==null;)h.alternate!==null&&(p=h),h=h.sibling;p===null?l||c.tail===null?c.tail=null:c.tail.sibling=null:p.sibling=null}}function Kr(c){var l=c.alternate!==null&&c.alternate.child===c.child,h=0,p=0;if(l)for(var E=c.child;E!==null;)h|=E.lanes|E.childLanes,p|=E.subtreeFlags&65011712,p|=E.flags&65011712,E.return=c,E=E.sibling;else for(E=c.child;E!==null;)h|=E.lanes|E.childLanes,p|=E.subtreeFlags,p|=E.flags,E.return=c,E=E.sibling;return c.subtreeFlags|=p,c.childLanes=h,l}function cne(c,l,h){var p=l.pendingProps;switch(mI(l),l.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Kr(l),null;case 1:return Kr(l),null;case 3:return h=l.stateNode,p=null,c!==null&&(p=c.memoizedState.cache),l.memoizedState.cache!==p&&(l.flags|=2048),Al(Ji),Tr(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(c===null||c.child===null)&&(Kg(l)?hl(l):c===null||c.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,bx())),Kr(l),null;case 26:return h=l.memoizedState,c===null?(hl(l),h!==null?(Kr(l),qM(l,h)):(Kr(l),l.flags&=-16777217)):h?h!==c.memoizedState?(hl(l),Kr(l),qM(l,h)):(Kr(l),l.flags&=-16777217):(c.memoizedProps!==p&&hl(l),Kr(l),l.flags&=-16777217),null;case 27:As(l),h=Re.current;var E=l.type;if(c!==null&&l.stateNode!=null)c.memoizedProps!==p&&hl(l);else{if(!p){if(l.stateNode===null)throw Error(r(166));return Kr(l),null}c=ee.current,Kg(l)?Tx(l):(c=q2(E,p,h),l.stateNode=c,hl(l))}return Kr(l),null;case 5:if(As(l),h=l.type,c!==null&&l.stateNode!=null)c.memoizedProps!==p&&hl(l);else{if(!p){if(l.stateNode===null)throw Error(r(166));return Kr(l),null}if(c=ee.current,Kg(l))Tx(l);else{switch(E=Iw(Re.current),c){case 1:c=E.createElementNS("http://www.w3.org/2000/svg",h);break;case 2:c=E.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;default:switch(h){case"svg":c=E.createElementNS("http://www.w3.org/2000/svg",h);break;case"math":c=E.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;case"script":c=E.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild);break;case"select":c=typeof p.is=="string"?E.createElement("select",{is:p.is}):E.createElement("select"),p.multiple?c.multiple=!0:p.size&&(c.size=p.size);break;default:c=typeof p.is=="string"?E.createElement(h,{is:p.is}):E.createElement(h)}}c[jr]=l,c[Lr]=p;e:for(E=l.child;E!==null;){if(E.tag===5||E.tag===6)c.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===l)break e;for(;E.sibling===null;){if(E.return===null||E.return===l)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}l.stateNode=c;e:switch(Ls(c,h,p),h){case"button":case"input":case"select":case"textarea":c=!!p.autoFocus;break e;case"img":c=!0;break e;default:c=!1}c&&hl(l)}}return Kr(l),l.flags&=-16777217,null;case 6:if(c&&l.stateNode!=null)c.memoizedProps!==p&&hl(l);else{if(typeof p!="string"&&l.stateNode===null)throw Error(r(166));if(c=Re.current,Kg(l)){if(c=l.stateNode,h=l.memoizedProps,p=null,E=Ao,E!==null)switch(E.tag){case 27:case 5:p=E.memoizedProps}c[jr]=l,c=!!(c.nodeValue===h||p!==null&&p.suppressHydrationWarning===!0||Q2(c.nodeValue,h)),c||ch(l)}else c=Iw(c).createTextNode(p),c[jr]=l,l.stateNode=c}return Kr(l),null;case 13:if(p=l.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(E=Kg(l),p!==null&&p.dehydrated!==null){if(c===null){if(!E)throw Error(r(318));if(E=l.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(r(317));E[jr]=l}else Gg(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Kr(l),E=!1}else E=bx(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=E),E=!0;if(!E)return l.flags&256?(ul(l),l):(ul(l),null)}if(ul(l),(l.flags&128)!==0)return l.lanes=h,l;if(h=p!==null,c=c!==null&&c.memoizedState!==null,h){p=l.child,E=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(E=p.alternate.memoizedState.cachePool.pool);var T=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(T=p.memoizedState.cachePool.pool),T!==E&&(p.flags|=2048)}return h!==c&&h&&(l.child.flags|=8192),fw(l,l.updateQueue),Kr(l),null;case 4:return Tr(),c===null&&RR(l.stateNode.containerInfo),Kr(l),null;case 10:return Al(l.type),Kr(l),null;case 19:if(D($i),E=l.memoizedState,E===null)return Kr(l),null;if(p=(l.flags&128)!==0,T=E.rendering,T===null)if(p)a_(E,!1);else{if(si!==0||c!==null&&(c.flags&128)!==0)for(c=l.child;c!==null;){if(T=Aw(c),T!==null){for(l.flags|=128,a_(E,!1),c=T.updateQueue,l.updateQueue=c,fw(l,c),l.subtreeFlags=0,c=h,h=l.child;h!==null;)wx(h,c),h=h.sibling;return U($i,$i.current&1|2),l.child}c=c.sibling}E.tail!==null&&dt()>gw&&(l.flags|=128,p=!0,a_(E,!1),l.lanes=4194304)}else{if(!p)if(c=Aw(T),c!==null){if(l.flags|=128,p=!0,c=c.updateQueue,l.updateQueue=c,fw(l,c),a_(E,!0),E.tail===null&&E.tailMode==="hidden"&&!T.alternate&&!Wn)return Kr(l),null}else 2*dt()-E.renderingStartTime>gw&&h!==536870912&&(l.flags|=128,p=!0,a_(E,!1),l.lanes=4194304);E.isBackwards?(T.sibling=l.child,l.child=T):(c=E.last,c!==null?c.sibling=T:l.child=T,E.last=T)}return E.tail!==null?(l=E.tail,E.rendering=l,E.tail=l.sibling,E.renderingStartTime=dt(),l.sibling=null,c=$i.current,U($i,p?c&1|2:c&1),l):(Kr(l),null);case 22:case 23:return ul(l),NI(),p=l.memoizedState!==null,c!==null?c.memoizedState!==null!==p&&(l.flags|=8192):p&&(l.flags|=8192),p?(h&536870912)!==0&&(l.flags&128)===0&&(Kr(l),l.subtreeFlags&6&&(l.flags|=8192)):Kr(l),h=l.updateQueue,h!==null&&fw(l,h.retryQueue),h=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(h=c.memoizedState.cachePool.pool),p=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),p!==h&&(l.flags|=2048),c!==null&&D(uh),null;case 24:return h=null,c!==null&&(h=c.memoizedState.cache),l.memoizedState.cache!==h&&(l.flags|=2048),Al(Ji),Kr(l),null;case 25:return null;case 30:return null}throw Error(r(156,l.tag))}function Ane(c,l){switch(mI(l),l.tag){case 1:return c=l.flags,c&65536?(l.flags=c&-65537|128,l):null;case 3:return Al(Ji),Tr(),c=l.flags,(c&65536)!==0&&(c&128)===0?(l.flags=c&-65537|128,l):null;case 26:case 27:case 5:return As(l),null;case 13:if(ul(l),c=l.memoizedState,c!==null&&c.dehydrated!==null){if(l.alternate===null)throw Error(r(340));Gg()}return c=l.flags,c&65536?(l.flags=c&-65537|128,l):null;case 19:return D($i),null;case 4:return Tr(),null;case 10:return Al(l.type),null;case 22:case 23:return ul(l),NI(),c!==null&&D(uh),c=l.flags,c&65536?(l.flags=c&-65537|128,l):null;case 24:return Al(Ji),null;case 25:return null;default:return null}}function YM(c,l){switch(mI(l),l.tag){case 3:Al(Ji),Tr();break;case 26:case 27:case 5:As(l);break;case 4:Tr();break;case 13:ul(l);break;case 19:D($i);break;case 10:Al(l.type);break;case 22:case 23:ul(l),NI(),c!==null&&D(uh);break;case 24:Al(Ji)}}function c_(c,l){try{var h=l.updateQueue,p=h!==null?h.lastEffect:null;if(p!==null){var E=p.next;h=E;do{if((h.tag&c)===c){p=void 0;var T=h.create,V=h.inst;p=T(),V.destroy=p}h=h.next}while(h!==E)}}catch(W){_r(l,l.return,W)}}function pu(c,l,h){try{var p=l.updateQueue,E=p!==null?p.lastEffect:null;if(E!==null){var T=E.next;p=T;do{if((p.tag&c)===c){var V=p.inst,W=V.destroy;if(W!==void 0){V.destroy=void 0,E=l;var re=h,fe=W;try{fe()}catch(we){_r(E,re,we)}}}p=p.next}while(p!==T)}}catch(we){_r(l,l.return,we)}}function XM(c){var l=c.updateQueue;if(l!==null){var h=c.stateNode;try{xx(l,h)}catch(p){_r(c,c.return,p)}}}function JM(c,l,h){h.props=hh(c.type,c.memoizedProps),h.state=c.memoizedState;try{h.componentWillUnmount()}catch(p){_r(c,l,p)}}function A_(c,l){try{var h=c.ref;if(h!==null){switch(c.tag){case 26:case 27:case 5:var p=c.stateNode;break;case 30:p=c.stateNode;break;default:p=c.stateNode}typeof h=="function"?c.refCleanup=h(p):h.current=p}}catch(E){_r(c,l,E)}}function lA(c,l){var h=c.ref,p=c.refCleanup;if(h!==null)if(typeof p=="function")try{p()}catch(E){_r(c,l,E)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(E){_r(c,l,E)}else h.current=null}function $M(c){var l=c.type,h=c.memoizedProps,p=c.stateNode;try{e:switch(l){case"button":case"input":case"select":case"textarea":h.autoFocus&&p.focus();break e;case"img":h.src?p.src=h.src:h.srcSet&&(p.srcset=h.srcSet)}}catch(E){_r(c,c.return,E)}}function iR(c,l,h){try{var p=c.stateNode;Nne(p,c.type,h,l),p[Lr]=l}catch(E){_r(c,c.return,E)}}function ZM(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&Cu(c.type)||c.tag===4}function sR(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||ZM(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&Cu(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function oR(c,l,h){var p=c.tag;if(p===5||p===6)c=c.stateNode,l?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(c,l):(l=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,l.appendChild(c),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=bw));else if(p!==4&&(p===27&&Cu(c.type)&&(h=c.stateNode,l=null),c=c.child,c!==null))for(oR(c,l,h),c=c.sibling;c!==null;)oR(c,l,h),c=c.sibling}function pw(c,l,h){var p=c.tag;if(p===5||p===6)c=c.stateNode,l?h.insertBefore(c,l):h.appendChild(c);else if(p!==4&&(p===27&&Cu(c.type)&&(h=c.stateNode),c=c.child,c!==null))for(pw(c,l,h),c=c.sibling;c!==null;)pw(c,l,h),c=c.sibling}function e2(c){var l=c.stateNode,h=c.memoizedProps;try{for(var p=c.type,E=l.attributes;E.length;)l.removeAttributeNode(E[0]);Ls(l,p,h),l[jr]=c,l[Lr]=h}catch(T){_r(c,c.return,T)}}var fl=!1,Ri=!1,aR=!1,t2=typeof WeakSet=="function"?WeakSet:Set,ds=null;function lne(c,l){if(c=c.containerInfo,DR=Lw,c=dx(c),sI(c)){if("selectionStart"in c)var h={start:c.selectionStart,end:c.selectionEnd};else e:{h=(h=c.ownerDocument)&&h.defaultView||window;var p=h.getSelection&&h.getSelection();if(p&&p.rangeCount!==0){h=p.anchorNode;var E=p.anchorOffset,T=p.focusNode;p=p.focusOffset;try{h.nodeType,T.nodeType}catch{h=null;break e}var V=0,W=-1,re=-1,fe=0,we=0,Ne=c,me=null;t:for(;;){for(var ge;Ne!==h||E!==0&&Ne.nodeType!==3||(W=V+E),Ne!==T||p!==0&&Ne.nodeType!==3||(re=V+p),Ne.nodeType===3&&(V+=Ne.nodeValue.length),(ge=Ne.firstChild)!==null;)me=Ne,Ne=ge;for(;;){if(Ne===c)break t;if(me===h&&++fe===E&&(W=V),me===T&&++we===p&&(re=V),(ge=Ne.nextSibling)!==null)break;Ne=me,me=Ne.parentNode}Ne=ge}h=W===-1||re===-1?null:{start:W,end:re}}else h=null}h=h||{start:0,end:0}}else h=null;for(BR={focusedElem:c,selectionRange:h},Lw=!1,ds=l;ds!==null;)if(l=ds,c=l.child,(l.subtreeFlags&1024)!==0&&c!==null)c.return=l,ds=c;else for(;ds!==null;){switch(l=ds,T=l.alternate,c=l.flags,l.tag){case 0:break;case 11:case 15:break;case 1:if((c&1024)!==0&&T!==null){c=void 0,h=l,E=T.memoizedProps,T=T.memoizedState,p=h.stateNode;try{var It=hh(h.type,E,h.elementType===h.type);c=p.getSnapshotBeforeUpdate(It,T),p.__reactInternalSnapshotBeforeUpdate=c}catch(vt){_r(h,h.return,vt)}}break;case 3:if((c&1024)!==0){if(c=l.stateNode.containerInfo,h=c.nodeType,h===9)PR(c);else if(h===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":PR(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(r(163))}if(c=l.sibling,c!==null){c.return=l.return,ds=c;break}ds=l.return}}function n2(c,l,h){var p=h.flags;switch(h.tag){case 0:case 11:case 15:mu(c,h),p&4&&c_(5,h);break;case 1:if(mu(c,h),p&4)if(c=h.stateNode,l===null)try{c.componentDidMount()}catch(V){_r(h,h.return,V)}else{var E=hh(h.type,l.memoizedProps);l=l.memoizedState;try{c.componentDidUpdate(E,l,c.__reactInternalSnapshotBeforeUpdate)}catch(V){_r(h,h.return,V)}}p&64&&XM(h),p&512&&A_(h,h.return);break;case 3:if(mu(c,h),p&64&&(c=h.updateQueue,c!==null)){if(l=null,h.child!==null)switch(h.child.tag){case 27:case 5:l=h.child.stateNode;break;case 1:l=h.child.stateNode}try{xx(c,l)}catch(V){_r(h,h.return,V)}}break;case 27:l===null&&p&4&&e2(h);case 26:case 5:mu(c,h),l===null&&p&4&&$M(h),p&512&&A_(h,h.return);break;case 12:mu(c,h);break;case 13:mu(c,h),p&4&&s2(c,h),p&64&&(c=h.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(h=Ene.bind(null,h),xne(c,h))));break;case 22:if(p=h.memoizedState!==null||fl,!p){l=l!==null&&l.memoizedState!==null||Ri,E=fl;var T=Ri;fl=p,(Ri=l)&&!T?gu(c,h,(h.subtreeFlags&8772)!==0):mu(c,h),fl=E,Ri=T}break;case 30:break;default:mu(c,h)}}function r2(c){var l=c.alternate;l!==null&&(c.alternate=null,r2(l)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(l=c.stateNode,l!==null&&Si(l)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var xr=null,No=!1;function pl(c,l,h){for(h=h.child;h!==null;)i2(c,l,h),h=h.sibling}function i2(c,l,h){if(yn&&typeof yn.onCommitFiberUnmount=="function")try{yn.onCommitFiberUnmount(qn,h)}catch{}switch(h.tag){case 26:Ri||lA(h,l),pl(c,l,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:Ri||lA(h,l);var p=xr,E=No;Cu(h.type)&&(xr=h.stateNode,No=!1),pl(c,l,h),__(h.stateNode),xr=p,No=E;break;case 5:Ri||lA(h,l);case 6:if(p=xr,E=No,xr=null,pl(c,l,h),xr=p,No=E,xr!==null)if(No)try{(xr.nodeType===9?xr.body:xr.nodeName==="HTML"?xr.ownerDocument.body:xr).removeChild(h.stateNode)}catch(T){_r(h,l,T)}else try{xr.removeChild(h.stateNode)}catch(T){_r(h,l,T)}break;case 18:xr!==null&&(No?(c=xr,W2(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,h.stateNode),b_(c)):W2(xr,h.stateNode));break;case 4:p=xr,E=No,xr=h.stateNode.containerInfo,No=!0,pl(c,l,h),xr=p,No=E;break;case 0:case 11:case 14:case 15:Ri||pu(2,h,l),Ri||pu(4,h,l),pl(c,l,h);break;case 1:Ri||(lA(h,l),p=h.stateNode,typeof p.componentWillUnmount=="function"&&JM(h,l,p)),pl(c,l,h);break;case 21:pl(c,l,h);break;case 22:Ri=(p=Ri)||h.memoizedState!==null,pl(c,l,h),Ri=p;break;default:pl(c,l,h)}}function s2(c,l){if(l.memoizedState===null&&(c=l.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{b_(c)}catch(h){_r(l,l.return,h)}}function une(c){switch(c.tag){case 13:case 19:var l=c.stateNode;return l===null&&(l=c.stateNode=new t2),l;case 22:return c=c.stateNode,l=c._retryCache,l===null&&(l=c._retryCache=new t2),l;default:throw Error(r(435,c.tag))}}function cR(c,l){var h=une(c);l.forEach(function(p){var E=vne.bind(null,c,p);h.has(p)||(h.add(p),p.then(E,E))})}function oa(c,l){var h=l.deletions;if(h!==null)for(var p=0;p<h.length;p++){var E=h[p],T=c,V=l,W=V;e:for(;W!==null;){switch(W.tag){case 27:if(Cu(W.type)){xr=W.stateNode,No=!1;break e}break;case 5:xr=W.stateNode,No=!1;break e;case 3:case 4:xr=W.stateNode.containerInfo,No=!0;break e}W=W.return}if(xr===null)throw Error(r(160));i2(T,V,E),xr=null,No=!1,T=E.alternate,T!==null&&(T.return=null),E.return=null}if(l.subtreeFlags&13878)for(l=l.child;l!==null;)o2(l,c),l=l.sibling}var Oc=null;function o2(c,l){var h=c.alternate,p=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:oa(l,c),aa(c),p&4&&(pu(3,c,c.return),c_(3,c),pu(5,c,c.return));break;case 1:oa(l,c),aa(c),p&512&&(Ri||h===null||lA(h,h.return)),p&64&&fl&&(c=c.updateQueue,c!==null&&(p=c.callbacks,p!==null&&(h=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=h===null?p:h.concat(p))));break;case 26:var E=Oc;if(oa(l,c),aa(c),p&512&&(Ri||h===null||lA(h,h.return)),p&4){var T=h!==null?h.memoizedState:null;if(p=c.memoizedState,h===null)if(p===null)if(c.stateNode===null){e:{p=c.type,h=c.memoizedProps,E=E.ownerDocument||E;t:switch(p){case"title":T=E.getElementsByTagName("title")[0],(!T||T[vc]||T[jr]||T.namespaceURI==="http://www.w3.org/2000/svg"||T.hasAttribute("itemprop"))&&(T=E.createElement(p),E.head.insertBefore(T,E.querySelector("head > title"))),Ls(T,p,h),T[jr]=c,jn(T),p=T;break e;case"link":var V=eF("link","href",E).get(p+(h.href||""));if(V){for(var W=0;W<V.length;W++)if(T=V[W],T.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&T.getAttribute("rel")===(h.rel==null?null:h.rel)&&T.getAttribute("title")===(h.title==null?null:h.title)&&T.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){V.splice(W,1);break t}}T=E.createElement(p),Ls(T,p,h),E.head.appendChild(T);break;case"meta":if(V=eF("meta","content",E).get(p+(h.content||""))){for(W=0;W<V.length;W++)if(T=V[W],T.getAttribute("content")===(h.content==null?null:""+h.content)&&T.getAttribute("name")===(h.name==null?null:h.name)&&T.getAttribute("property")===(h.property==null?null:h.property)&&T.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&T.getAttribute("charset")===(h.charSet==null?null:h.charSet)){V.splice(W,1);break t}}T=E.createElement(p),Ls(T,p,h),E.head.appendChild(T);break;default:throw Error(r(468,p))}T[jr]=c,jn(T),p=T}c.stateNode=p}else tF(E,c.type,c.stateNode);else c.stateNode=Z2(E,p,c.memoizedProps);else T!==p?(T===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):T.count--,p===null?tF(E,c.type,c.stateNode):Z2(E,p,c.memoizedProps)):p===null&&c.stateNode!==null&&iR(c,c.memoizedProps,h.memoizedProps)}break;case 27:oa(l,c),aa(c),p&512&&(Ri||h===null||lA(h,h.return)),h!==null&&p&4&&iR(c,c.memoizedProps,h.memoizedProps);break;case 5:if(oa(l,c),aa(c),p&512&&(Ri||h===null||lA(h,h.return)),c.flags&32){E=c.stateNode;try{ao(E,"")}catch(ge){_r(c,c.return,ge)}}p&4&&c.stateNode!=null&&(E=c.memoizedProps,iR(c,E,h!==null?h.memoizedProps:E)),p&1024&&(aR=!0);break;case 6:if(oa(l,c),aa(c),p&4){if(c.stateNode===null)throw Error(r(162));p=c.memoizedProps,h=c.stateNode;try{h.nodeValue=p}catch(ge){_r(c,c.return,ge)}}break;case 3:if(Nw=null,E=Oc,Oc=Rw(l.containerInfo),oa(l,c),Oc=E,aa(c),p&4&&h!==null&&h.memoizedState.isDehydrated)try{b_(l.containerInfo)}catch(ge){_r(c,c.return,ge)}aR&&(aR=!1,a2(c));break;case 4:p=Oc,Oc=Rw(c.stateNode.containerInfo),oa(l,c),aa(c),Oc=p;break;case 12:oa(l,c),aa(c);break;case 13:oa(l,c),aa(c),c.child.flags&8192&&c.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(fR=dt()),p&4&&(p=c.updateQueue,p!==null&&(c.updateQueue=null,cR(c,p)));break;case 22:E=c.memoizedState!==null;var re=h!==null&&h.memoizedState!==null,fe=fl,we=Ri;if(fl=fe||E,Ri=we||re,oa(l,c),Ri=we,fl=fe,aa(c),p&8192)e:for(l=c.stateNode,l._visibility=E?l._visibility&-2:l._visibility|1,E&&(h===null||re||fl||Ri||fh(c)),h=null,l=c;;){if(l.tag===5||l.tag===26){if(h===null){re=h=l;try{if(T=re.stateNode,E)V=T.style,typeof V.setProperty=="function"?V.setProperty("display","none","important"):V.display="none";else{W=re.stateNode;var Ne=re.memoizedProps.style,me=Ne!=null&&Ne.hasOwnProperty("display")?Ne.display:null;W.style.display=me==null||typeof me=="boolean"?"":(""+me).trim()}}catch(ge){_r(re,re.return,ge)}}}else if(l.tag===6){if(h===null){re=l;try{re.stateNode.nodeValue=E?"":re.memoizedProps}catch(ge){_r(re,re.return,ge)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===c)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===c)break e;for(;l.sibling===null;){if(l.return===null||l.return===c)break e;h===l&&(h=null),l=l.return}h===l&&(h=null),l.sibling.return=l.return,l=l.sibling}p&4&&(p=c.updateQueue,p!==null&&(h=p.retryQueue,h!==null&&(p.retryQueue=null,cR(c,h))));break;case 19:oa(l,c),aa(c),p&4&&(p=c.updateQueue,p!==null&&(c.updateQueue=null,cR(c,p)));break;case 30:break;case 21:break;default:oa(l,c),aa(c)}}function aa(c){var l=c.flags;if(l&2){try{for(var h,p=c.return;p!==null;){if(ZM(p)){h=p;break}p=p.return}if(h==null)throw Error(r(160));switch(h.tag){case 27:var E=h.stateNode,T=sR(c);pw(c,T,E);break;case 5:var V=h.stateNode;h.flags&32&&(ao(V,""),h.flags&=-33);var W=sR(c);pw(c,W,V);break;case 3:case 4:var re=h.stateNode.containerInfo,fe=sR(c);oR(c,fe,re);break;default:throw Error(r(161))}}catch(we){_r(c,c.return,we)}c.flags&=-3}l&4096&&(c.flags&=-4097)}function a2(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var l=c;a2(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),c=c.sibling}}function mu(c,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)n2(c,l.alternate,l),l=l.sibling}function fh(c){for(c=c.child;c!==null;){var l=c;switch(l.tag){case 0:case 11:case 14:case 15:pu(4,l,l.return),fh(l);break;case 1:lA(l,l.return);var h=l.stateNode;typeof h.componentWillUnmount=="function"&&JM(l,l.return,h),fh(l);break;case 27:__(l.stateNode);case 26:case 5:lA(l,l.return),fh(l);break;case 22:l.memoizedState===null&&fh(l);break;case 30:fh(l);break;default:fh(l)}c=c.sibling}}function gu(c,l,h){for(h=h&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var p=l.alternate,E=c,T=l,V=T.flags;switch(T.tag){case 0:case 11:case 15:gu(E,T,h),c_(4,T);break;case 1:if(gu(E,T,h),p=T,E=p.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(fe){_r(p,p.return,fe)}if(p=T,E=p.updateQueue,E!==null){var W=p.stateNode;try{var re=E.shared.hiddenCallbacks;if(re!==null)for(E.shared.hiddenCallbacks=null,E=0;E<re.length;E++)kx(re[E],W)}catch(fe){_r(p,p.return,fe)}}h&&V&64&&XM(T),A_(T,T.return);break;case 27:e2(T);case 26:case 5:gu(E,T,h),h&&p===null&&V&4&&$M(T),A_(T,T.return);break;case 12:gu(E,T,h);break;case 13:gu(E,T,h),h&&V&4&&s2(E,T);break;case 22:T.memoizedState===null&&gu(E,T,h),A_(T,T.return);break;case 30:break;default:gu(E,T,h)}l=l.sibling}}function AR(c,l){var h=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(h=c.memoizedState.cachePool.pool),c=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(c=l.memoizedState.cachePool.pool),c!==h&&(c!=null&&c.refCount++,h!=null&&qg(h))}function lR(c,l){c=null,l.alternate!==null&&(c=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==c&&(l.refCount++,c!=null&&qg(c))}function uA(c,l,h,p){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)c2(c,l,h,p),l=l.sibling}function c2(c,l,h,p){var E=l.flags;switch(l.tag){case 0:case 11:case 15:uA(c,l,h,p),E&2048&&c_(9,l);break;case 1:uA(c,l,h,p);break;case 3:uA(c,l,h,p),E&2048&&(c=null,l.alternate!==null&&(c=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==c&&(l.refCount++,c!=null&&qg(c)));break;case 12:if(E&2048){uA(c,l,h,p),c=l.stateNode;try{var T=l.memoizedProps,V=T.id,W=T.onPostCommit;typeof W=="function"&&W(V,l.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(re){_r(l,l.return,re)}}else uA(c,l,h,p);break;case 13:uA(c,l,h,p);break;case 23:break;case 22:T=l.stateNode,V=l.alternate,l.memoizedState!==null?T._visibility&2?uA(c,l,h,p):l_(c,l):T._visibility&2?uA(c,l,h,p):(T._visibility|=2,Xf(c,l,h,p,(l.subtreeFlags&10256)!==0)),E&2048&&AR(V,l);break;case 24:uA(c,l,h,p),E&2048&&lR(l.alternate,l);break;default:uA(c,l,h,p)}}function Xf(c,l,h,p,E){for(E=E&&(l.subtreeFlags&10256)!==0,l=l.child;l!==null;){var T=c,V=l,W=h,re=p,fe=V.flags;switch(V.tag){case 0:case 11:case 15:Xf(T,V,W,re,E),c_(8,V);break;case 23:break;case 22:var we=V.stateNode;V.memoizedState!==null?we._visibility&2?Xf(T,V,W,re,E):l_(T,V):(we._visibility|=2,Xf(T,V,W,re,E)),E&&fe&2048&&AR(V.alternate,V);break;case 24:Xf(T,V,W,re,E),E&&fe&2048&&lR(V.alternate,V);break;default:Xf(T,V,W,re,E)}l=l.sibling}}function l_(c,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var h=c,p=l,E=p.flags;switch(p.tag){case 22:l_(h,p),E&2048&&AR(p.alternate,p);break;case 24:l_(h,p),E&2048&&lR(p.alternate,p);break;default:l_(h,p)}l=l.sibling}}var u_=8192;function Jf(c){if(c.subtreeFlags&u_)for(c=c.child;c!==null;)A2(c),c=c.sibling}function A2(c){switch(c.tag){case 26:Jf(c),c.flags&u_&&c.memoizedState!==null&&Xne(Oc,c.memoizedState,c.memoizedProps);break;case 5:Jf(c);break;case 3:case 4:var l=Oc;Oc=Rw(c.stateNode.containerInfo),Jf(c),Oc=l;break;case 22:c.memoizedState===null&&(l=c.alternate,l!==null&&l.memoizedState!==null?(l=u_,u_=16777216,Jf(c),u_=l):Jf(c));break;default:Jf(c)}}function l2(c){var l=c.alternate;if(l!==null&&(c=l.child,c!==null)){l.child=null;do l=c.sibling,c.sibling=null,c=l;while(c!==null)}}function d_(c){var l=c.deletions;if((c.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var p=l[h];ds=p,d2(p,c)}l2(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)u2(c),c=c.sibling}function u2(c){switch(c.tag){case 0:case 11:case 15:d_(c),c.flags&2048&&pu(9,c,c.return);break;case 3:d_(c);break;case 12:d_(c);break;case 22:var l=c.stateNode;c.memoizedState!==null&&l._visibility&2&&(c.return===null||c.return.tag!==13)?(l._visibility&=-3,mw(c)):d_(c);break;default:d_(c)}}function mw(c){var l=c.deletions;if((c.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var p=l[h];ds=p,d2(p,c)}l2(c)}for(c=c.child;c!==null;){switch(l=c,l.tag){case 0:case 11:case 15:pu(8,l,l.return),mw(l);break;case 22:h=l.stateNode,h._visibility&2&&(h._visibility&=-3,mw(l));break;default:mw(l)}c=c.sibling}}function d2(c,l){for(;ds!==null;){var h=ds;switch(h.tag){case 0:case 11:case 15:pu(8,h,l);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var p=h.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:qg(h.memoizedState.cache)}if(p=h.child,p!==null)p.return=h,ds=p;else e:for(h=c;ds!==null;){p=ds;var E=p.sibling,T=p.return;if(r2(p),p===h){ds=null;break e}if(E!==null){E.return=T,ds=E;break e}ds=T}}}var dne={getCacheForType:function(c){var l=Ws(Ji),h=l.data.get(c);return h===void 0&&(h=c(),l.data.set(c,h)),h}},hne=typeof WeakMap=="function"?WeakMap:Map,nr=0,Ir=null,An=null,Tn=0,rr=0,ca=null,_u=!1,$f=!1,uR=!1,ml=0,si=0,Eu=0,ph=0,dR=0,ka=0,Zf=0,h_=null,Do=null,hR=!1,fR=0,gw=1/0,_w=null,vu=null,Bs=0,yu=null,ep=null,tp=0,pR=0,mR=null,h2=null,f_=0,gR=null;function Aa(){if((nr&2)!==0&&Tn!==0)return Tn&-Tn;if(de.T!==null){var c=Hf;return c!==0?c:TR()}return gc()}function f2(){ka===0&&(ka=(Tn&536870912)===0||Wn?Br():536870912);var c=Pa.current;return c!==null&&(c.flags|=32),ka}function la(c,l,h){(c===Ir&&(rr===2||rr===9)||c.cancelPendingCommit!==null)&&(np(c,0),wu(c,Tn,ka,!1)),Un(c,h),((nr&2)===0||c!==Ir)&&(c===Ir&&((nr&2)===0&&(ph|=h),si===4&&wu(c,Tn,ka,!1)),dA(c))}function p2(c,l,h){if((nr&6)!==0)throw Error(r(327));var p=!h&&(l&124)===0&&(l&c.expiredLanes)===0||Nt(c,l),E=p?mne(c,l):vR(c,l,!0),T=p;do{if(E===0){$f&&!p&&wu(c,l,0,!1);break}else{if(h=c.current.alternate,T&&!fne(h)){E=vR(c,l,!1),T=!1;continue}if(E===2){if(T=l,c.errorRecoveryDisabledLanes&T)var V=0;else V=c.pendingLanes&-536870913,V=V!==0?V:V&536870912?536870912:0;if(V!==0){l=V;e:{var W=c;E=h_;var re=W.current.memoizedState.isDehydrated;if(re&&(np(W,V).flags|=256),V=vR(W,V,!1),V!==2){if(uR&&!re){W.errorRecoveryDisabledLanes|=T,ph|=T,E=4;break e}T=Do,Do=E,T!==null&&(Do===null?Do=T:Do.push.apply(Do,T))}E=V}if(T=!1,E!==2)continue}}if(E===1){np(c,0),wu(c,l,0,!0);break}e:{switch(p=c,T=E,T){case 0:case 1:throw Error(r(345));case 4:if((l&4194048)!==l)break;case 6:wu(p,l,ka,!_u);break e;case 2:Do=null;break;case 3:case 5:break;default:throw Error(r(329))}if((l&62914560)===l&&(E=fR+300-dt(),10<E)){if(wu(p,l,ka,!_u),kt(p,0,!0)!==0)break e;p.timeoutHandle=K2(m2.bind(null,p,h,Do,_w,hR,l,ka,ph,Zf,_u,T,2,-0,0),E);break e}m2(p,h,Do,_w,hR,l,ka,ph,Zf,_u,T,0,-0,0)}}break}while(!0);dA(c)}function m2(c,l,h,p,E,T,V,W,re,fe,we,Ne,me,ge){if(c.timeoutHandle=-1,Ne=l.subtreeFlags,(Ne&8192||(Ne&16785408)===16785408)&&(y_={stylesheets:null,count:0,unsuspend:Yne},A2(l),Ne=Jne(),Ne!==null)){c.cancelPendingCommit=Ne(C2.bind(null,c,l,T,h,p,E,V,W,re,we,1,me,ge)),wu(c,T,V,!fe);return}C2(c,l,T,h,p,E,V,W,re)}function fne(c){for(var l=c;;){var h=l.tag;if((h===0||h===11||h===15)&&l.flags&16384&&(h=l.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var p=0;p<h.length;p++){var E=h[p],T=E.getSnapshot;E=E.value;try{if(!ia(T(),E))return!1}catch{return!1}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===c)break;for(;l.sibling===null;){if(l.return===null||l.return===c)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function wu(c,l,h,p){l&=~dR,l&=~ph,c.suspendedLanes|=l,c.pingedLanes&=~l,p&&(c.warmLanes|=l),p=c.expirationTimes;for(var E=l;0<E;){var T=31-wi(E),V=1<<T;p[T]=-1,E&=~V}h!==0&&Ti(c,h,l)}function Ew(){return(nr&6)===0?(p_(0),!1):!0}function _R(){if(An!==null){if(rr===0)var c=An.return;else c=An,cl=Ah=null,PI(c),qf=null,s_=0,c=An;for(;c!==null;)YM(c.alternate,c),c=c.return;An=null}}function np(c,l){var h=c.timeoutHandle;h!==-1&&(c.timeoutHandle=-1,Bne(h)),h=c.cancelPendingCommit,h!==null&&(c.cancelPendingCommit=null,h()),_R(),Ir=c,An=h=sl(c.current,null),Tn=l,rr=0,ca=null,_u=!1,$f=Nt(c,l),uR=!1,Zf=ka=dR=ph=Eu=si=0,Do=h_=null,hR=!1,(l&8)!==0&&(l|=l&32);var p=c.entangledLanes;if(p!==0)for(c=c.entanglements,p&=l;0<p;){var E=31-wi(p),T=1<<E;l|=c[E],p&=~T}return ml=l,Qy(),h}function g2(c,l){Zt=null,de.H=ow,l===Xg||l===Xy?(l=Ux(),rr=3):l===Dx?(l=Ux(),rr=4):rr=l===PM?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,ca=l,An===null&&(si=1,uw(c,Da(l,c.current)))}function _2(){var c=de.H;return de.H=ow,c===null?ow:c}function E2(){var c=de.A;return de.A=dne,c}function ER(){si=4,_u||(Tn&4194048)!==Tn&&Pa.current!==null||($f=!0),(Eu&134217727)===0&&(ph&134217727)===0||Ir===null||wu(Ir,Tn,ka,!1)}function vR(c,l,h){var p=nr;nr|=2;var E=_2(),T=E2();(Ir!==c||Tn!==l)&&(_w=null,np(c,l)),l=!1;var V=si;e:do try{if(rr!==0&&An!==null){var W=An,re=ca;switch(rr){case 8:_R(),V=6;break e;case 3:case 2:case 9:case 6:Pa.current===null&&(l=!0);var fe=rr;if(rr=0,ca=null,rp(c,W,re,fe),h&&$f){V=0;break e}break;default:fe=rr,rr=0,ca=null,rp(c,W,re,fe)}}pne(),V=si;break}catch(we){g2(c,we)}while(!0);return l&&c.shellSuspendCounter++,cl=Ah=null,nr=p,de.H=E,de.A=T,An===null&&(Ir=null,Tn=0,Qy()),V}function pne(){for(;An!==null;)v2(An)}function mne(c,l){var h=nr;nr|=2;var p=_2(),E=E2();Ir!==c||Tn!==l?(_w=null,gw=dt()+500,np(c,l)):$f=Nt(c,l);e:do try{if(rr!==0&&An!==null){l=An;var T=ca;t:switch(rr){case 1:rr=0,ca=null,rp(c,l,T,1);break;case 2:case 9:if(Bx(T)){rr=0,ca=null,y2(l);break}l=function(){rr!==2&&rr!==9||Ir!==c||(rr=7),dA(c)},T.then(l,l);break e;case 3:rr=7;break e;case 4:rr=5;break e;case 7:Bx(T)?(rr=0,ca=null,y2(l)):(rr=0,ca=null,rp(c,l,T,7));break;case 5:var V=null;switch(An.tag){case 26:V=An.memoizedState;case 5:case 27:var W=An;if(!V||nF(V)){rr=0,ca=null;var re=W.sibling;if(re!==null)An=re;else{var fe=W.return;fe!==null?(An=fe,vw(fe)):An=null}break t}}rr=0,ca=null,rp(c,l,T,5);break;case 6:rr=0,ca=null,rp(c,l,T,6);break;case 8:_R(),si=6;break e;default:throw Error(r(462))}}gne();break}catch(we){g2(c,we)}while(!0);return cl=Ah=null,de.H=p,de.A=E,nr=h,An!==null?0:(Ir=null,Tn=0,Qy(),si)}function gne(){for(;An!==null&&!Jt();)v2(An)}function v2(c){var l=zM(c.alternate,c,ml);c.memoizedProps=c.pendingProps,l===null?vw(c):An=l}function y2(c){var l=c,h=l.alternate;switch(l.tag){case 15:case 0:l=QM(h,l,l.pendingProps,l.type,void 0,Tn);break;case 11:l=QM(h,l,l.pendingProps,l.type.render,l.ref,Tn);break;case 5:PI(l);default:YM(h,l),l=An=wx(l,ml),l=zM(h,l,ml)}c.memoizedProps=c.pendingProps,l===null?vw(c):An=l}function rp(c,l,h,p){cl=Ah=null,PI(l),qf=null,s_=0;var E=l.return;try{if(one(c,E,l,h,Tn)){si=1,uw(c,Da(h,c.current)),An=null;return}}catch(T){if(E!==null)throw An=E,T;si=1,uw(c,Da(h,c.current)),An=null;return}l.flags&32768?(Wn||p===1?c=!0:$f||(Tn&536870912)!==0?c=!1:(_u=c=!0,(p===2||p===9||p===3||p===6)&&(p=Pa.current,p!==null&&p.tag===13&&(p.flags|=16384))),w2(l,c)):vw(l)}function vw(c){var l=c;do{if((l.flags&32768)!==0){w2(l,_u);return}c=l.return;var h=cne(l.alternate,l,ml);if(h!==null){An=h;return}if(l=l.sibling,l!==null){An=l;return}An=l=c}while(l!==null);si===0&&(si=5)}function w2(c,l){do{var h=Ane(c.alternate,c);if(h!==null){h.flags&=32767,An=h;return}if(h=c.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!l&&(c=c.sibling,c!==null)){An=c;return}An=c=h}while(c!==null);si=6,An=null}function C2(c,l,h,p,E,T,V,W,re){c.cancelPendingCommit=null;do yw();while(Bs!==0);if((nr&6)!==0)throw Error(r(327));if(l!==null){if(l===c.current)throw Error(r(177));if(T=l.lanes|l.childLanes,T|=lI,Mi(c,h,T,V,W,re),c===Ir&&(An=Ir=null,Tn=0),ep=l,yu=c,tp=h,pR=T,mR=E,h2=p,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,yne(st,function(){return R2(),null})):(c.callbackNode=null,c.callbackPriority=0),p=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||p){p=de.T,de.T=null,E=J.p,J.p=2,V=nr,nr|=4;try{lne(c,l,h)}finally{nr=V,J.p=E,de.T=p}}Bs=1,T2(),S2(),b2()}}function T2(){if(Bs===1){Bs=0;var c=yu,l=ep,h=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||h){h=de.T,de.T=null;var p=J.p;J.p=2;var E=nr;nr|=4;try{o2(l,c);var T=BR,V=dx(c.containerInfo),W=T.focusedElem,re=T.selectionRange;if(V!==W&&W&&W.ownerDocument&&ux(W.ownerDocument.documentElement,W)){if(re!==null&&sI(W)){var fe=re.start,we=re.end;if(we===void 0&&(we=fe),"selectionStart"in W)W.selectionStart=fe,W.selectionEnd=Math.min(we,W.value.length);else{var Ne=W.ownerDocument||document,me=Ne&&Ne.defaultView||window;if(me.getSelection){var ge=me.getSelection(),It=W.textContent.length,vt=Math.min(re.start,It),dr=re.end===void 0?vt:Math.min(re.end,It);!ge.extend&&vt>dr&&(V=dr,dr=vt,vt=V);var ce=lx(W,vt),ae=lx(W,dr);if(ce&&ae&&(ge.rangeCount!==1||ge.anchorNode!==ce.node||ge.anchorOffset!==ce.offset||ge.focusNode!==ae.node||ge.focusOffset!==ae.offset)){var ue=Ne.createRange();ue.setStart(ce.node,ce.offset),ge.removeAllRanges(),vt>dr?(ge.addRange(ue),ge.extend(ae.node,ae.offset)):(ue.setEnd(ae.node,ae.offset),ge.addRange(ue))}}}}for(Ne=[],ge=W;ge=ge.parentNode;)ge.nodeType===1&&Ne.push({element:ge,left:ge.scrollLeft,top:ge.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<Ne.length;W++){var be=Ne[W];be.element.scrollLeft=be.left,be.element.scrollTop=be.top}}Lw=!!DR,BR=DR=null}finally{nr=E,J.p=p,de.T=h}}c.current=l,Bs=2}}function S2(){if(Bs===2){Bs=0;var c=yu,l=ep,h=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||h){h=de.T,de.T=null;var p=J.p;J.p=2;var E=nr;nr|=4;try{n2(c,l.alternate,l)}finally{nr=E,J.p=p,de.T=h}}Bs=3}}function b2(){if(Bs===4||Bs===3){Bs=0,Xt();var c=yu,l=ep,h=tp,p=h2;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Bs=5:(Bs=0,ep=yu=null,I2(c,c.pendingLanes));var E=c.pendingLanes;if(E===0&&(vu=null),Yo(h),l=l.stateNode,yn&&typeof yn.onCommitFiberRoot=="function")try{yn.onCommitFiberRoot(qn,l,void 0,(l.current.flags&128)===128)}catch{}if(p!==null){l=de.T,E=J.p,J.p=2,de.T=null;try{for(var T=c.onRecoverableError,V=0;V<p.length;V++){var W=p[V];T(W.value,{componentStack:W.stack})}}finally{de.T=l,J.p=E}}(tp&3)!==0&&yw(),dA(c),E=c.pendingLanes,(h&4194090)!==0&&(E&42)!==0?c===gR?f_++:(f_=0,gR=c):f_=0,p_(0)}}function I2(c,l){(c.pooledCacheLanes&=l)===0&&(l=c.pooledCache,l!=null&&(c.pooledCache=null,qg(l)))}function yw(c){return T2(),S2(),b2(),R2()}function R2(){if(Bs!==5)return!1;var c=yu,l=pR;pR=0;var h=Yo(tp),p=de.T,E=J.p;try{J.p=32>h?32:h,de.T=null,h=mR,mR=null;var T=yu,V=tp;if(Bs=0,ep=yu=null,tp=0,(nr&6)!==0)throw Error(r(331));var W=nr;if(nr|=4,u2(T.current),c2(T,T.current,V,h),nr=W,p_(0,!1),yn&&typeof yn.onPostCommitFiberRoot=="function")try{yn.onPostCommitFiberRoot(qn,T)}catch{}return!0}finally{J.p=E,de.T=p,I2(c,l)}}function O2(c,l,h){l=Da(h,l),l=YI(c.stateNode,l,2),c=uu(c,l,2),c!==null&&(Un(c,2),dA(c))}function _r(c,l,h){if(c.tag===3)O2(c,c,h);else for(;l!==null;){if(l.tag===3){O2(l,c,h);break}else if(l.tag===1){var p=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(vu===null||!vu.has(p))){c=Da(h,c),h=LM(2),p=uu(l,h,2),p!==null&&(UM(h,p,l,c),Un(p,2),dA(p));break}}l=l.return}}function yR(c,l,h){var p=c.pingCache;if(p===null){p=c.pingCache=new hne;var E=new Set;p.set(l,E)}else E=p.get(l),E===void 0&&(E=new Set,p.set(l,E));E.has(h)||(uR=!0,E.add(h),c=_ne.bind(null,c,l,h),l.then(c,c))}function _ne(c,l,h){var p=c.pingCache;p!==null&&p.delete(l),c.pingedLanes|=c.suspendedLanes&h,c.warmLanes&=~h,Ir===c&&(Tn&h)===h&&(si===4||si===3&&(Tn&62914560)===Tn&&300>dt()-fR?(nr&2)===0&&np(c,0):dR|=h,Zf===Tn&&(Zf=0)),dA(c)}function N2(c,l){l===0&&(l=Ci()),c=Mf(c,l),c!==null&&(Un(c,l),dA(c))}function Ene(c){var l=c.memoizedState,h=0;l!==null&&(h=l.retryLane),N2(c,h)}function vne(c,l){var h=0;switch(c.tag){case 13:var p=c.stateNode,E=c.memoizedState;E!==null&&(h=E.retryLane);break;case 19:p=c.stateNode;break;case 22:p=c.stateNode._retryCache;break;default:throw Error(r(314))}p!==null&&p.delete(l),N2(c,h)}function yne(c,l){return xi(c,l)}var ww=null,ip=null,wR=!1,Cw=!1,CR=!1,mh=0;function dA(c){c!==ip&&c.next===null&&(ip===null?ww=ip=c:ip=ip.next=c),Cw=!0,wR||(wR=!0,Cne())}function p_(c,l){if(!CR&&Cw){CR=!0;do for(var h=!1,p=ww;p!==null;){if(c!==0){var E=p.pendingLanes;if(E===0)var T=0;else{var V=p.suspendedLanes,W=p.pingedLanes;T=(1<<31-wi(42|c)+1)-1,T&=E&~(V&~W),T=T&201326741?T&201326741|1:T?T|2:0}T!==0&&(h=!0,U2(p,T))}else T=Tn,T=kt(p,p===Ir?T:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(T&3)===0||Nt(p,T)||(h=!0,U2(p,T));p=p.next}while(h);CR=!1}}function wne(){D2()}function D2(){Cw=wR=!1;var c=0;mh!==0&&(Dne()&&(c=mh),mh=0);for(var l=dt(),h=null,p=ww;p!==null;){var E=p.next,T=B2(p,l);T===0?(p.next=null,h===null?ww=E:h.next=E,E===null&&(ip=h)):(h=p,(c!==0||(T&3)!==0)&&(Cw=!0)),p=E}p_(c)}function B2(c,l){for(var h=c.suspendedLanes,p=c.pingedLanes,E=c.expirationTimes,T=c.pendingLanes&-62914561;0<T;){var V=31-wi(T),W=1<<V,re=E[V];re===-1?((W&h)===0||(W&p)!==0)&&(E[V]=_n(W,l)):re<=l&&(c.expiredLanes|=W),T&=~W}if(l=Ir,h=Tn,h=kt(c,c===l?h:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),p=c.callbackNode,h===0||c===l&&(rr===2||rr===9)||c.cancelPendingCommit!==null)return p!==null&&p!==null&&vi(p),c.callbackNode=null,c.callbackPriority=0;if((h&3)===0||Nt(c,h)){if(l=h&-h,l===c.callbackPriority)return l;switch(p!==null&&vi(p),Yo(h)){case 2:case 8:h=Pt;break;case 32:h=st;break;case 268435456:h=br;break;default:h=st}return p=L2.bind(null,c),h=xi(h,p),c.callbackPriority=l,c.callbackNode=h,l}return p!==null&&p!==null&&vi(p),c.callbackPriority=2,c.callbackNode=null,2}function L2(c,l){if(Bs!==0&&Bs!==5)return c.callbackNode=null,c.callbackPriority=0,null;var h=c.callbackNode;if(yw()&&c.callbackNode!==h)return null;var p=Tn;return p=kt(c,c===Ir?p:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),p===0?null:(p2(c,p,l),B2(c,dt()),c.callbackNode!=null&&c.callbackNode===h?L2.bind(null,c):null)}function U2(c,l){if(yw())return null;p2(c,l,!0)}function Cne(){Lne(function(){(nr&6)!==0?xi(yi,wne):D2()})}function TR(){return mh===0&&(mh=Br()),mh}function P2(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:ou(""+c)}function k2(c,l){var h=l.ownerDocument.createElement("input");return h.name=l.name,h.value=l.value,c.id&&h.setAttribute("form",c.id),l.parentNode.insertBefore(h,l),c=new FormData(c),h.parentNode.removeChild(h),c}function Tne(c,l,h,p,E){if(l==="submit"&&h&&h.stateNode===E){var T=P2((E[Lr]||null).action),V=p.submitter;V&&(l=(l=V[Lr]||null)?P2(l.formAction):V.getAttribute("formAction"),l!==null&&(T=l,V=null));var W=new Gt("action","action",null,p,E);c.push({event:W,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(mh!==0){var re=V?k2(E,V):new FormData(E);KI(h,{pending:!0,data:re,method:E.method,action:T},null,re)}}else typeof T=="function"&&(W.preventDefault(),re=V?k2(E,V):new FormData(E),KI(h,{pending:!0,data:re,method:E.method,action:T},T,re))},currentTarget:E}]})}}for(var SR=0;SR<AI.length;SR++){var bR=AI[SR],Sne=bR.toLowerCase(),bne=bR[0].toUpperCase()+bR.slice(1);Rc(Sne,"on"+bne)}Rc(px,"onAnimationEnd"),Rc(mx,"onAnimationIteration"),Rc(gx,"onAnimationStart"),Rc("dblclick","onDoubleClick"),Rc("focusin","onFocus"),Rc("focusout","onBlur"),Rc(jte,"onTransitionRun"),Rc(Kte,"onTransitionStart"),Rc(Gte,"onTransitionCancel"),Rc(_x,"onTransitionEnd"),wc("onMouseEnter",["mouseout","mouseover"]),wc("onMouseLeave",["mouseout","mouseover"]),wc("onPointerEnter",["pointerout","pointerover"]),wc("onPointerLeave",["pointerout","pointerover"]),Jo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Jo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Jo("onBeforeInput",["compositionend","keypress","textInput","paste"]),Jo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Jo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Jo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var m_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ine=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(m_));function x2(c,l){l=(l&4)!==0;for(var h=0;h<c.length;h++){var p=c[h],E=p.event;p=p.listeners;e:{var T=void 0;if(l)for(var V=p.length-1;0<=V;V--){var W=p[V],re=W.instance,fe=W.currentTarget;if(W=W.listener,re!==T&&E.isPropagationStopped())break e;T=W,E.currentTarget=fe;try{T(E)}catch(we){lw(we)}E.currentTarget=null,T=re}else for(V=0;V<p.length;V++){if(W=p[V],re=W.instance,fe=W.currentTarget,W=W.listener,re!==T&&E.isPropagationStopped())break e;T=W,E.currentTarget=fe;try{T(E)}catch(we){lw(we)}E.currentTarget=null,T=re}}}}function ln(c,l){var h=l[ru];h===void 0&&(h=l[ru]=new Set);var p=c+"__bubble";h.has(p)||(M2(l,c,2,!1),h.add(p))}function IR(c,l,h){var p=0;l&&(p|=4),M2(h,c,p,l)}var Tw="_reactListening"+Math.random().toString(36).slice(2);function RR(c){if(!c[Tw]){c[Tw]=!0,yc.forEach(function(h){h!=="selectionchange"&&(Ine.has(h)||IR(h,!1,c),IR(h,!0,c))});var l=c.nodeType===9?c:c.ownerDocument;l===null||l[Tw]||(l[Tw]=!0,IR("selectionchange",!1,l))}}function M2(c,l,h,p){switch(cF(l)){case 2:var E=ere;break;case 8:E=tre;break;default:E=HR}h=E.bind(null,l,h,c),E=void 0,!Io||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(E=!0),p?E!==void 0?c.addEventListener(l,h,{capture:!0,passive:E}):c.addEventListener(l,h,!0):E!==void 0?c.addEventListener(l,h,{passive:E}):c.addEventListener(l,h,!1)}function OR(c,l,h,p,E){var T=p;if((l&1)===0&&(l&2)===0&&p!==null)e:for(;;){if(p===null)return;var V=p.tag;if(V===3||V===4){var W=p.stateNode.containerInfo;if(W===E)break;if(V===4)for(V=p.return;V!==null;){var re=V.tag;if((re===3||re===4)&&V.stateNode.containerInfo===E)return;V=V.return}for(;W!==null;){if(V=So(W),V===null)return;if(re=V.tag,re===5||re===6||re===26||re===27){p=T=V;continue e}W=W.parentNode}}p=p.return}au(function(){var fe=T,we=bo(h),Ne=[];e:{var me=Ex.get(c);if(me!==void 0){var ge=Gt,It=c;switch(c){case"keypress":if(pe(h)===0)break e;case"keydown":case"keyup":ge=Lf;break;case"focusin":It="focus",ge=Nf;break;case"focusout":It="blur",ge=Nf;break;case"beforeblur":case"afterblur":ge=Nf;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=bi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=Na;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=Uy;break;case px:case mx:case gx:ge=Df;break;case _x:ge=ky;break;case"scroll":case"scrollend":ge=Wt;break;case"wheel":ge=Uf;break;case"copy":case"cut":case"paste":ge=Bf;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=Vg;break;case"toggle":case"beforetoggle":ge=My}var vt=(l&4)!==0,dr=!vt&&(c==="scroll"||c==="scrollend"),ce=vt?me!==null?me+"Capture":null:me;vt=[];for(var ae=fe,ue;ae!==null;){var be=ae;if(ue=be.stateNode,be=be.tag,be!==5&&be!==26&&be!==27||ue===null||ce===null||(be=tl(ae,ce),be!=null&&vt.push(g_(ae,be,ue))),dr)break;ae=ae.return}0<vt.length&&(me=new ge(me,It,null,h,we),Ne.push({event:me,listeners:vt}))}}if((l&7)===0){e:{if(me=c==="mouseover"||c==="pointerover",ge=c==="mouseout"||c==="pointerout",me&&h!==Sc&&(It=h.relatedTarget||h.fromElement)&&(So(It)||It[To]))break e;if((ge||me)&&(me=we.window===we?we:(me=we.ownerDocument)?me.defaultView||me.parentWindow:window,ge?(It=h.relatedTarget||h.toElement,ge=fe,It=It?So(It):null,It!==null&&(dr=s(It),vt=It.tag,It!==dr||vt!==5&&vt!==27&&vt!==6)&&(It=null)):(ge=null,It=fe),ge!==It)){if(vt=bi,be="onMouseLeave",ce="onMouseEnter",ae="mouse",(c==="pointerout"||c==="pointerover")&&(vt=Vg,be="onPointerLeave",ce="onPointerEnter",ae="pointer"),dr=ge==null?me:Xo(ge),ue=It==null?me:Xo(It),me=new vt(be,ae+"leave",ge,h,we),me.target=dr,me.relatedTarget=ue,be=null,So(we)===fe&&(vt=new vt(ce,ae+"enter",It,h,we),vt.target=ue,vt.relatedTarget=dr,be=vt),dr=be,ge&&It)t:{for(vt=ge,ce=It,ae=0,ue=vt;ue;ue=sp(ue))ae++;for(ue=0,be=ce;be;be=sp(be))ue++;for(;0<ae-ue;)vt=sp(vt),ae--;for(;0<ue-ae;)ce=sp(ce),ue--;for(;ae--;){if(vt===ce||ce!==null&&vt===ce.alternate)break t;vt=sp(vt),ce=sp(ce)}vt=null}else vt=null;ge!==null&&F2(Ne,me,ge,vt,!1),It!==null&&dr!==null&&F2(Ne,dr,It,vt,!0)}}e:{if(me=fe?Xo(fe):window,ge=me.nodeName&&me.nodeName.toLowerCase(),ge==="select"||ge==="input"&&me.type==="file")var nt=ix;else if(Xi(me))if(sx)nt=Vte;else{nt=Mte;var rn=xte}else ge=me.nodeName,!ge||ge.toLowerCase()!=="input"||me.type!=="checkbox"&&me.type!=="radio"?fe&&Jd(fe.elementType)&&(nt=ix):nt=Fte;if(nt&&(nt=nt(c,fe))){il(Ne,nt,h,we);break e}rn&&rn(c,me,fe),c==="focusout"&&fe&&me.type==="number"&&fe.memoizedProps.value!=null&&sA(me,"number",me.value)}switch(rn=fe?Xo(fe):window,c){case"focusin":(Xi(rn)||rn.contentEditable==="true")&&(Pf=rn,oI=fe,jg=null);break;case"focusout":jg=oI=Pf=null;break;case"mousedown":aI=!0;break;case"contextmenu":case"mouseup":case"dragend":aI=!1,hx(Ne,h,we);break;case"selectionchange":if(Hte)break;case"keydown":case"keyup":hx(Ne,h,we)}var ut;if(oA)e:{switch(c){case"compositionstart":var wt="onCompositionStart";break e;case"compositionend":wt="onCompositionEnd";break e;case"compositionupdate":wt="onCompositionUpdate";break e}wt=void 0}else wn?_e(c,h)&&(wt="onCompositionEnd"):c==="keydown"&&h.keyCode===229&&(wt="onCompositionStart");wt&&(x&&h.locale!=="ko"&&(wn||wt!=="onCompositionStart"?wt==="onCompositionEnd"&&wn&&(ut=oe()):(ra=we,Ic="value"in ra?ra.value:ra.textContent,wn=!0)),rn=Sw(fe,wt),0<rn.length&&(wt=new Mg(wt,c,null,h,we),Ne.push({event:wt,listeners:rn}),ut?wt.data=ut:(ut=Fe(h),ut!==null&&(wt.data=ut)))),(ut=O?Yi(c,h):Cn(c,h))&&(wt=Sw(fe,"onBeforeInput"),0<wt.length&&(rn=new Mg("onBeforeInput","beforeinput",null,h,we),Ne.push({event:rn,listeners:wt}),rn.data=ut)),Tne(Ne,c,fe,h,we)}x2(Ne,l)})}function g_(c,l,h){return{instance:c,listener:l,currentTarget:h}}function Sw(c,l){for(var h=l+"Capture",p=[];c!==null;){var E=c,T=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||T===null||(E=tl(c,h),E!=null&&p.unshift(g_(c,E,T)),E=tl(c,l),E!=null&&p.push(g_(c,E,T))),c.tag===3)return p;c=c.return}return[]}function sp(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function F2(c,l,h,p,E){for(var T=l._reactName,V=[];h!==null&&h!==p;){var W=h,re=W.alternate,fe=W.stateNode;if(W=W.tag,re!==null&&re===p)break;W!==5&&W!==26&&W!==27||fe===null||(re=fe,E?(fe=tl(h,T),fe!=null&&V.unshift(g_(h,fe,re))):E||(fe=tl(h,T),fe!=null&&V.push(g_(h,fe,re)))),h=h.return}V.length!==0&&c.push({event:l,listeners:V})}var Rne=/\r\n?/g,One=/\u0000|\uFFFD/g;function V2(c){return(typeof c=="string"?c:""+c).replace(Rne,`
`).replace(One,"")}function Q2(c,l){return l=V2(l),V2(c)===l}function bw(){}function ur(c,l,h,p,E,T){switch(h){case"children":typeof p=="string"?l==="body"||l==="textarea"&&p===""||ao(c,p):(typeof p=="number"||typeof p=="bigint")&&l!=="body"&&ao(c,""+p);break;case"className":Zo(c,"class",p);break;case"tabIndex":Zo(c,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Zo(c,h,p);break;case"style":Xd(c,p,T);break;case"data":if(l!=="object"){Zo(c,"data",p);break}case"src":case"href":if(p===""&&(l!=="a"||h!=="href")){c.removeAttribute(h);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){c.removeAttribute(h);break}p=ou(""+p),c.setAttribute(h,p);break;case"action":case"formAction":if(typeof p=="function"){c.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof T=="function"&&(h==="formAction"?(l!=="input"&&ur(c,l,"name",E.name,E,null),ur(c,l,"formEncType",E.formEncType,E,null),ur(c,l,"formMethod",E.formMethod,E,null),ur(c,l,"formTarget",E.formTarget,E,null)):(ur(c,l,"encType",E.encType,E,null),ur(c,l,"method",E.method,E,null),ur(c,l,"target",E.target,E,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){c.removeAttribute(h);break}p=ou(""+p),c.setAttribute(h,p);break;case"onClick":p!=null&&(c.onclick=bw);break;case"onScroll":p!=null&&ln("scroll",c);break;case"onScrollEnd":p!=null&&ln("scrollend",c);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(h=p.__html,h!=null){if(E.children!=null)throw Error(r(60));c.innerHTML=h}}break;case"multiple":c.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":c.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){c.removeAttribute("xlink:href");break}h=ou(""+p),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?c.setAttribute(h,""+p):c.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?c.setAttribute(h,""):c.removeAttribute(h);break;case"capture":case"download":p===!0?c.setAttribute(h,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?c.setAttribute(h,p):c.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?c.setAttribute(h,p):c.removeAttribute(h);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?c.removeAttribute(h):c.setAttribute(h,p);break;case"popover":ln("beforetoggle",c),ln("toggle",c),Cc(c,"popover",p);break;case"xlinkActuate":ni(c,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":ni(c,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":ni(c,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":ni(c,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":ni(c,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":ni(c,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":ni(c,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":ni(c,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":ni(c,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Cc(c,"is",p);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=Pg.get(h)||h,Cc(c,h,p))}}function NR(c,l,h,p,E,T){switch(h){case"style":Xd(c,p,T);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(r(61));if(h=p.__html,h!=null){if(E.children!=null)throw Error(r(60));c.innerHTML=h}}break;case"children":typeof p=="string"?ao(c,p):(typeof p=="number"||typeof p=="bigint")&&ao(c,""+p);break;case"onScroll":p!=null&&ln("scroll",c);break;case"onScrollEnd":p!=null&&ln("scrollend",c);break;case"onClick":p!=null&&(c.onclick=bw);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Os.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(E=h.endsWith("Capture"),l=h.slice(2,E?h.length-7:void 0),T=c[Lr]||null,T=T!=null?T[h]:null,typeof T=="function"&&c.removeEventListener(l,T,E),typeof p=="function")){typeof T!="function"&&T!==null&&(h in c?c[h]=null:c.hasAttribute(h)&&c.removeAttribute(h)),c.addEventListener(l,p,E);break e}h in c?c[h]=p:p===!0?c.setAttribute(h,""):Cc(c,h,p)}}}function Ls(c,l,h){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ln("error",c),ln("load",c);var p=!1,E=!1,T;for(T in h)if(h.hasOwnProperty(T)){var V=h[T];if(V!=null)switch(T){case"src":p=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,l));default:ur(c,l,T,V,h,null)}}E&&ur(c,l,"srcSet",h.srcSet,h,null),p&&ur(c,l,"src",h.src,h,null);return;case"input":ln("invalid",c);var W=T=V=E=null,re=null,fe=null;for(p in h)if(h.hasOwnProperty(p)){var we=h[p];if(we!=null)switch(p){case"name":E=we;break;case"type":V=we;break;case"checked":re=we;break;case"defaultChecked":fe=we;break;case"value":T=we;break;case"defaultValue":W=we;break;case"children":case"dangerouslySetInnerHTML":if(we!=null)throw Error(r(137,l));break;default:ur(c,l,p,we,h,null)}}$A(c,T,W,re,fe,V,E,!1),su(c);return;case"select":ln("invalid",c),p=V=T=null;for(E in h)if(h.hasOwnProperty(E)&&(W=h[E],W!=null))switch(E){case"value":T=W;break;case"defaultValue":V=W;break;case"multiple":p=W;default:ur(c,l,E,W,h,null)}l=T,h=V,c.multiple=!!p,l!=null?Tc(c,!!p,l,!1):h!=null&&Tc(c,!!p,h,!0);return;case"textarea":ln("invalid",c),T=E=p=null;for(V in h)if(h.hasOwnProperty(V)&&(W=h[V],W!=null))switch(V){case"value":p=W;break;case"defaultValue":E=W;break;case"children":T=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(91));break;default:ur(c,l,V,W,h,null)}ZA(c,p,E,T),su(c);return;case"option":for(re in h)if(h.hasOwnProperty(re)&&(p=h[re],p!=null))switch(re){case"selected":c.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:ur(c,l,re,p,h,null)}return;case"dialog":ln("beforetoggle",c),ln("toggle",c),ln("cancel",c),ln("close",c);break;case"iframe":case"object":ln("load",c);break;case"video":case"audio":for(p=0;p<m_.length;p++)ln(m_[p],c);break;case"image":ln("error",c),ln("load",c);break;case"details":ln("toggle",c);break;case"embed":case"source":case"link":ln("error",c),ln("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(fe in h)if(h.hasOwnProperty(fe)&&(p=h[fe],p!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,l));default:ur(c,l,fe,p,h,null)}return;default:if(Jd(l)){for(we in h)h.hasOwnProperty(we)&&(p=h[we],p!==void 0&&NR(c,l,we,p,h,void 0));return}}for(W in h)h.hasOwnProperty(W)&&(p=h[W],p!=null&&ur(c,l,W,p,h,null))}function Nne(c,l,h,p){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,T=null,V=null,W=null,re=null,fe=null,we=null;for(ge in h){var Ne=h[ge];if(h.hasOwnProperty(ge)&&Ne!=null)switch(ge){case"checked":break;case"value":break;case"defaultValue":re=Ne;default:p.hasOwnProperty(ge)||ur(c,l,ge,null,p,Ne)}}for(var me in p){var ge=p[me];if(Ne=h[me],p.hasOwnProperty(me)&&(ge!=null||Ne!=null))switch(me){case"type":T=ge;break;case"name":E=ge;break;case"checked":fe=ge;break;case"defaultChecked":we=ge;break;case"value":V=ge;break;case"defaultValue":W=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(r(137,l));break;default:ge!==Ne&&ur(c,l,me,ge,p,Ne)}}oo(c,V,W,re,fe,we,T,E);return;case"select":ge=V=W=me=null;for(T in h)if(re=h[T],h.hasOwnProperty(T)&&re!=null)switch(T){case"value":break;case"multiple":ge=re;default:p.hasOwnProperty(T)||ur(c,l,T,null,p,re)}for(E in p)if(T=p[E],re=h[E],p.hasOwnProperty(E)&&(T!=null||re!=null))switch(E){case"value":me=T;break;case"defaultValue":W=T;break;case"multiple":V=T;default:T!==re&&ur(c,l,E,T,p,re)}l=W,h=V,p=ge,me!=null?Tc(c,!!h,me,!1):!!p!=!!h&&(l!=null?Tc(c,!!h,l,!0):Tc(c,!!h,h?[]:"",!1));return;case"textarea":ge=me=null;for(W in h)if(E=h[W],h.hasOwnProperty(W)&&E!=null&&!p.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:ur(c,l,W,null,p,E)}for(V in p)if(E=p[V],T=h[V],p.hasOwnProperty(V)&&(E!=null||T!=null))switch(V){case"value":me=E;break;case"defaultValue":ge=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(r(91));break;default:E!==T&&ur(c,l,V,E,p,T)}Yn(c,me,ge);return;case"option":for(var It in h)if(me=h[It],h.hasOwnProperty(It)&&me!=null&&!p.hasOwnProperty(It))switch(It){case"selected":c.selected=!1;break;default:ur(c,l,It,null,p,me)}for(re in p)if(me=p[re],ge=h[re],p.hasOwnProperty(re)&&me!==ge&&(me!=null||ge!=null))switch(re){case"selected":c.selected=me&&typeof me!="function"&&typeof me!="symbol";break;default:ur(c,l,re,me,p,ge)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vt in h)me=h[vt],h.hasOwnProperty(vt)&&me!=null&&!p.hasOwnProperty(vt)&&ur(c,l,vt,null,p,me);for(fe in p)if(me=p[fe],ge=h[fe],p.hasOwnProperty(fe)&&me!==ge&&(me!=null||ge!=null))switch(fe){case"children":case"dangerouslySetInnerHTML":if(me!=null)throw Error(r(137,l));break;default:ur(c,l,fe,me,p,ge)}return;default:if(Jd(l)){for(var dr in h)me=h[dr],h.hasOwnProperty(dr)&&me!==void 0&&!p.hasOwnProperty(dr)&&NR(c,l,dr,void 0,p,me);for(we in p)me=p[we],ge=h[we],!p.hasOwnProperty(we)||me===ge||me===void 0&&ge===void 0||NR(c,l,we,me,p,ge);return}}for(var ce in h)me=h[ce],h.hasOwnProperty(ce)&&me!=null&&!p.hasOwnProperty(ce)&&ur(c,l,ce,null,p,me);for(Ne in p)me=p[Ne],ge=h[Ne],!p.hasOwnProperty(Ne)||me===ge||me==null&&ge==null||ur(c,l,Ne,me,p,ge)}var DR=null,BR=null;function Iw(c){return c.nodeType===9?c:c.ownerDocument}function H2(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function j2(c,l){if(c===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&l==="foreignObject"?0:c}function LR(c,l){return c==="textarea"||c==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var UR=null;function Dne(){var c=window.event;return c&&c.type==="popstate"?c===UR?!1:(UR=c,!0):(UR=null,!1)}var K2=typeof setTimeout=="function"?setTimeout:void 0,Bne=typeof clearTimeout=="function"?clearTimeout:void 0,G2=typeof Promise=="function"?Promise:void 0,Lne=typeof queueMicrotask=="function"?queueMicrotask:typeof G2<"u"?function(c){return G2.resolve(null).then(c).catch(Une)}:K2;function Une(c){setTimeout(function(){throw c})}function Cu(c){return c==="head"}function W2(c,l){var h=l,p=0,E=0;do{var T=h.nextSibling;if(c.removeChild(h),T&&T.nodeType===8)if(h=T.data,h==="/$"){if(0<p&&8>p){h=p;var V=c.ownerDocument;if(h&1&&__(V.documentElement),h&2&&__(V.body),h&4)for(h=V.head,__(h),V=h.firstChild;V;){var W=V.nextSibling,re=V.nodeName;V[vc]||re==="SCRIPT"||re==="STYLE"||re==="LINK"&&V.rel.toLowerCase()==="stylesheet"||h.removeChild(V),V=W}}if(E===0){c.removeChild(T),b_(l);return}E--}else h==="$"||h==="$?"||h==="$!"?E++:p=h.charCodeAt(0)-48;else p=0;h=T}while(h);b_(l)}function PR(c){var l=c.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var h=l;switch(l=l.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":PR(h),Si(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}c.removeChild(h)}}function Pne(c,l,h,p){for(;c.nodeType===1;){var E=h;if(c.nodeName.toLowerCase()!==l.toLowerCase()){if(!p&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(p){if(!c[vc])switch(l){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(T=c.getAttribute("rel"),T==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(T!==E.rel||c.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||c.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||c.getAttribute("title")!==(E.title==null?null:E.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(T=c.getAttribute("src"),(T!==(E.src==null?null:E.src)||c.getAttribute("type")!==(E.type==null?null:E.type)||c.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&T&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(l==="input"&&c.type==="hidden"){var T=E.name==null?null:""+E.name;if(E.type==="hidden"&&c.getAttribute("name")===T)return c}else return c;if(c=Nc(c.nextSibling),c===null)break}return null}function kne(c,l,h){if(l==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!h||(c=Nc(c.nextSibling),c===null))return null;return c}function kR(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState==="complete"}function xne(c,l){var h=c.ownerDocument;if(c.data!=="$?"||h.readyState==="complete")l();else{var p=function(){l(),h.removeEventListener("DOMContentLoaded",p)};h.addEventListener("DOMContentLoaded",p),c._reactRetry=p}}function Nc(c){for(;c!=null;c=c.nextSibling){var l=c.nodeType;if(l===1||l===3)break;if(l===8){if(l=c.data,l==="$"||l==="$!"||l==="$?"||l==="F!"||l==="F")break;if(l==="/$")return null}}return c}var xR=null;function z2(c){c=c.previousSibling;for(var l=0;c;){if(c.nodeType===8){var h=c.data;if(h==="$"||h==="$!"||h==="$?"){if(l===0)return c;l--}else h==="/$"&&l++}c=c.previousSibling}return null}function q2(c,l,h){switch(l=Iw(h),c){case"html":if(c=l.documentElement,!c)throw Error(r(452));return c;case"head":if(c=l.head,!c)throw Error(r(453));return c;case"body":if(c=l.body,!c)throw Error(r(454));return c;default:throw Error(r(451))}}function __(c){for(var l=c.attributes;l.length;)c.removeAttributeNode(l[0]);Si(c)}var xa=new Map,Y2=new Set;function Rw(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var gl=J.d;J.d={f:Mne,r:Fne,D:Vne,C:Qne,L:Hne,m:jne,X:Gne,S:Kne,M:Wne};function Mne(){var c=gl.f(),l=Ew();return c||l}function Fne(c){var l=Wi(c);l!==null&&l.tag===5&&l.type==="form"?pM(l):gl.r(c)}var op=typeof document>"u"?null:document;function X2(c,l,h){var p=op;if(p&&typeof l=="string"&&l){var E=ri(l);E='link[rel="'+c+'"][href="'+E+'"]',typeof h=="string"&&(E+='[crossorigin="'+h+'"]'),Y2.has(E)||(Y2.add(E),c={rel:c,crossOrigin:h,href:l},p.querySelector(E)===null&&(l=p.createElement("link"),Ls(l,"link",c),jn(l),p.head.appendChild(l)))}}function Vne(c){gl.D(c),X2("dns-prefetch",c,null)}function Qne(c,l){gl.C(c,l),X2("preconnect",c,l)}function Hne(c,l,h){gl.L(c,l,h);var p=op;if(p&&c&&l){var E='link[rel="preload"][as="'+ri(l)+'"]';l==="image"&&h&&h.imageSrcSet?(E+='[imagesrcset="'+ri(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(E+='[imagesizes="'+ri(h.imageSizes)+'"]')):E+='[href="'+ri(c)+'"]';var T=E;switch(l){case"style":T=ap(c);break;case"script":T=cp(c)}xa.has(T)||(c=d({rel:"preload",href:l==="image"&&h&&h.imageSrcSet?void 0:c,as:l},h),xa.set(T,c),p.querySelector(E)!==null||l==="style"&&p.querySelector(E_(T))||l==="script"&&p.querySelector(v_(T))||(l=p.createElement("link"),Ls(l,"link",c),jn(l),p.head.appendChild(l)))}}function jne(c,l){gl.m(c,l);var h=op;if(h&&c){var p=l&&typeof l.as=="string"?l.as:"script",E='link[rel="modulepreload"][as="'+ri(p)+'"][href="'+ri(c)+'"]',T=E;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":T=cp(c)}if(!xa.has(T)&&(c=d({rel:"modulepreload",href:c},l),xa.set(T,c),h.querySelector(E)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(v_(T)))return}p=h.createElement("link"),Ls(p,"link",c),jn(p),h.head.appendChild(p)}}}function Kne(c,l,h){gl.S(c,l,h);var p=op;if(p&&c){var E=$t(p).hoistableStyles,T=ap(c);l=l||"default";var V=E.get(T);if(!V){var W={loading:0,preload:null};if(V=p.querySelector(E_(T)))W.loading=5;else{c=d({rel:"stylesheet",href:c,"data-precedence":l},h),(h=xa.get(T))&&MR(c,h);var re=V=p.createElement("link");jn(re),Ls(re,"link",c),re._p=new Promise(function(fe,we){re.onload=fe,re.onerror=we}),re.addEventListener("load",function(){W.loading|=1}),re.addEventListener("error",function(){W.loading|=2}),W.loading|=4,Ow(V,l,p)}V={type:"stylesheet",instance:V,count:1,state:W},E.set(T,V)}}}function Gne(c,l){gl.X(c,l);var h=op;if(h&&c){var p=$t(h).hoistableScripts,E=cp(c),T=p.get(E);T||(T=h.querySelector(v_(E)),T||(c=d({src:c,async:!0},l),(l=xa.get(E))&&FR(c,l),T=h.createElement("script"),jn(T),Ls(T,"link",c),h.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},p.set(E,T))}}function Wne(c,l){gl.M(c,l);var h=op;if(h&&c){var p=$t(h).hoistableScripts,E=cp(c),T=p.get(E);T||(T=h.querySelector(v_(E)),T||(c=d({src:c,async:!0,type:"module"},l),(l=xa.get(E))&&FR(c,l),T=h.createElement("script"),jn(T),Ls(T,"link",c),h.head.appendChild(T)),T={type:"script",instance:T,count:1,state:null},p.set(E,T))}}function J2(c,l,h,p){var E=(E=Re.current)?Rw(E):null;if(!E)throw Error(r(446));switch(c){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(l=ap(h.href),h=$t(E).hoistableStyles,p=h.get(l),p||(p={type:"style",instance:null,count:0,state:null},h.set(l,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){c=ap(h.href);var T=$t(E).hoistableStyles,V=T.get(c);if(V||(E=E.ownerDocument||E,V={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},T.set(c,V),(T=E.querySelector(E_(c)))&&!T._p&&(V.instance=T,V.state.loading=5),xa.has(c)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},xa.set(c,h),T||zne(E,c,h,V.state))),l&&p===null)throw Error(r(528,""));return V}if(l&&p!==null)throw Error(r(529,""));return null;case"script":return l=h.async,h=h.src,typeof h=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=cp(h),h=$t(E).hoistableScripts,p=h.get(l),p||(p={type:"script",instance:null,count:0,state:null},h.set(l,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,c))}}function ap(c){return'href="'+ri(c)+'"'}function E_(c){return'link[rel="stylesheet"]['+c+"]"}function $2(c){return d({},c,{"data-precedence":c.precedence,precedence:null})}function zne(c,l,h,p){c.querySelector('link[rel="preload"][as="style"]['+l+"]")?p.loading=1:(l=c.createElement("link"),p.preload=l,l.addEventListener("load",function(){return p.loading|=1}),l.addEventListener("error",function(){return p.loading|=2}),Ls(l,"link",h),jn(l),c.head.appendChild(l))}function cp(c){return'[src="'+ri(c)+'"]'}function v_(c){return"script[async]"+c}function Z2(c,l,h){if(l.count++,l.instance===null)switch(l.type){case"style":var p=c.querySelector('style[data-href~="'+ri(h.href)+'"]');if(p)return l.instance=p,jn(p),p;var E=d({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return p=(c.ownerDocument||c).createElement("style"),jn(p),Ls(p,"style",E),Ow(p,h.precedence,c),l.instance=p;case"stylesheet":E=ap(h.href);var T=c.querySelector(E_(E));if(T)return l.state.loading|=4,l.instance=T,jn(T),T;p=$2(h),(E=xa.get(E))&&MR(p,E),T=(c.ownerDocument||c).createElement("link"),jn(T);var V=T;return V._p=new Promise(function(W,re){V.onload=W,V.onerror=re}),Ls(T,"link",p),l.state.loading|=4,Ow(T,h.precedence,c),l.instance=T;case"script":return T=cp(h.src),(E=c.querySelector(v_(T)))?(l.instance=E,jn(E),E):(p=h,(E=xa.get(T))&&(p=d({},h),FR(p,E)),c=c.ownerDocument||c,E=c.createElement("script"),jn(E),Ls(E,"link",p),c.head.appendChild(E),l.instance=E);case"void":return null;default:throw Error(r(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(p=l.instance,l.state.loading|=4,Ow(p,h.precedence,c));return l.instance}function Ow(c,l,h){for(var p=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=p.length?p[p.length-1]:null,T=E,V=0;V<p.length;V++){var W=p[V];if(W.dataset.precedence===l)T=W;else if(T!==E)break}T?T.parentNode.insertBefore(c,T.nextSibling):(l=h.nodeType===9?h.head:h,l.insertBefore(c,l.firstChild))}function MR(c,l){c.crossOrigin==null&&(c.crossOrigin=l.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=l.referrerPolicy),c.title==null&&(c.title=l.title)}function FR(c,l){c.crossOrigin==null&&(c.crossOrigin=l.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=l.referrerPolicy),c.integrity==null&&(c.integrity=l.integrity)}var Nw=null;function eF(c,l,h){if(Nw===null){var p=new Map,E=Nw=new Map;E.set(h,p)}else E=Nw,p=E.get(h),p||(p=new Map,E.set(h,p));if(p.has(c))return p;for(p.set(c,null),h=h.getElementsByTagName(c),E=0;E<h.length;E++){var T=h[E];if(!(T[vc]||T[jr]||c==="link"&&T.getAttribute("rel")==="stylesheet")&&T.namespaceURI!=="http://www.w3.org/2000/svg"){var V=T.getAttribute(l)||"";V=c+V;var W=p.get(V);W?W.push(T):p.set(V,[T])}}return p}function tF(c,l,h){c=c.ownerDocument||c,c.head.insertBefore(h,l==="title"?c.querySelector("head > title"):null)}function qne(c,l,h){if(h===1||l.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;switch(l.rel){case"stylesheet":return c=l.disabled,typeof l.precedence=="string"&&c==null;default:return!0}case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function nF(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}var y_=null;function Yne(){}function Xne(c,l,h){if(y_===null)throw Error(r(475));var p=y_;if(l.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(l.state.loading&4)===0){if(l.instance===null){var E=ap(h.href),T=c.querySelector(E_(E));if(T){c=T._p,c!==null&&typeof c=="object"&&typeof c.then=="function"&&(p.count++,p=Dw.bind(p),c.then(p,p)),l.state.loading|=4,l.instance=T,jn(T);return}T=c.ownerDocument||c,h=$2(h),(E=xa.get(E))&&MR(h,E),T=T.createElement("link"),jn(T);var V=T;V._p=new Promise(function(W,re){V.onload=W,V.onerror=re}),Ls(T,"link",h),l.instance=T}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(l,c),(c=l.state.preload)&&(l.state.loading&3)===0&&(p.count++,l=Dw.bind(p),c.addEventListener("load",l),c.addEventListener("error",l))}}function Jne(){if(y_===null)throw Error(r(475));var c=y_;return c.stylesheets&&c.count===0&&VR(c,c.stylesheets),0<c.count?function(l){var h=setTimeout(function(){if(c.stylesheets&&VR(c,c.stylesheets),c.unsuspend){var p=c.unsuspend;c.unsuspend=null,p()}},6e4);return c.unsuspend=l,function(){c.unsuspend=null,clearTimeout(h)}}:null}function Dw(){if(this.count--,this.count===0){if(this.stylesheets)VR(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var Bw=null;function VR(c,l){c.stylesheets=null,c.unsuspend!==null&&(c.count++,Bw=new Map,l.forEach($ne,c),Bw=null,Dw.call(c))}function $ne(c,l){if(!(l.state.loading&4)){var h=Bw.get(c);if(h)var p=h.get(null);else{h=new Map,Bw.set(c,h);for(var E=c.querySelectorAll("link[data-precedence],style[data-precedence]"),T=0;T<E.length;T++){var V=E[T];(V.nodeName==="LINK"||V.getAttribute("media")!=="not all")&&(h.set(V.dataset.precedence,V),p=V)}p&&h.set(null,p)}E=l.instance,V=E.getAttribute("data-precedence"),T=h.get(V)||p,T===p&&h.set(null,E),h.set(V,E),this.count++,p=Dw.bind(this),E.addEventListener("load",p),E.addEventListener("error",p),T?T.parentNode.insertBefore(E,T.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(E,c.firstChild)),l.state.loading|=4}}var w_={$$typeof:B,Provider:null,Consumer:null,_currentValue:Y,_currentValue2:Y,_threadCount:0};function Zne(c,l,h,p,E,T,V,W){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=fn(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=fn(0),this.hiddenUpdates=fn(null),this.identifierPrefix=p,this.onUncaughtError=E,this.onCaughtError=T,this.onRecoverableError=V,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=W,this.incompleteTransitions=new Map}function rF(c,l,h,p,E,T,V,W,re,fe,we,Ne){return c=new Zne(c,l,h,V,W,re,fe,Ne),l=1,T===!0&&(l|=24),T=sa(3,null,null,l),c.current=T,T.stateNode=c,l=yI(),l.refCount++,c.pooledCache=l,l.refCount++,T.memoizedState={element:p,isDehydrated:h,cache:l},SI(T),c}function iF(c){return c?(c=Ff,c):Ff}function sF(c,l,h,p,E,T){E=iF(E),p.context===null?p.context=E:p.pendingContext=E,p=lu(l),p.payload={element:h},T=T===void 0?null:T,T!==null&&(p.callback=T),h=uu(c,p,l),h!==null&&(la(h,c,l),$g(h,c,l))}function oF(c,l){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var h=c.retryLane;c.retryLane=h!==0&&h<l?h:l}}function QR(c,l){oF(c,l),(c=c.alternate)&&oF(c,l)}function aF(c){if(c.tag===13){var l=Mf(c,67108864);l!==null&&la(l,c,67108864),QR(c,67108864)}}var Lw=!0;function ere(c,l,h,p){var E=de.T;de.T=null;var T=J.p;try{J.p=2,HR(c,l,h,p)}finally{J.p=T,de.T=E}}function tre(c,l,h,p){var E=de.T;de.T=null;var T=J.p;try{J.p=8,HR(c,l,h,p)}finally{J.p=T,de.T=E}}function HR(c,l,h,p){if(Lw){var E=jR(p);if(E===null)OR(c,l,p,Uw,h),AF(c,p);else if(rre(E,c,l,h,p))p.stopPropagation();else if(AF(c,p),l&4&&-1<nre.indexOf(c)){for(;E!==null;){var T=Wi(E);if(T!==null)switch(T.tag){case 3:if(T=T.stateNode,T.current.memoizedState.isDehydrated){var V=Xe(T.pendingLanes);if(V!==0){var W=T;for(W.pendingLanes|=2,W.entangledLanes|=2;V;){var re=1<<31-wi(V);W.entanglements[1]|=re,V&=~re}dA(T),(nr&6)===0&&(gw=dt()+500,p_(0))}}break;case 13:W=Mf(T,2),W!==null&&la(W,T,2),Ew(),QR(T,2)}if(T=jR(p),T===null&&OR(c,l,p,Uw,h),T===E)break;E=T}E!==null&&p.stopPropagation()}else OR(c,l,p,null,h)}}function jR(c){return c=bo(c),KR(c)}var Uw=null;function KR(c){if(Uw=null,c=So(c),c!==null){var l=s(c);if(l===null)c=null;else{var h=l.tag;if(h===13){if(c=o(l),c!==null)return c;c=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;c=null}else l!==c&&(c=null)}}return Uw=c,null}function cF(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ar()){case yi:return 2;case Pt:return 8;case st:case Sr:return 32;case br:return 268435456;default:return 32}default:return 32}}var GR=!1,Tu=null,Su=null,bu=null,C_=new Map,T_=new Map,Iu=[],nre="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function AF(c,l){switch(c){case"focusin":case"focusout":Tu=null;break;case"dragenter":case"dragleave":Su=null;break;case"mouseover":case"mouseout":bu=null;break;case"pointerover":case"pointerout":C_.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":T_.delete(l.pointerId)}}function S_(c,l,h,p,E,T){return c===null||c.nativeEvent!==T?(c={blockedOn:l,domEventName:h,eventSystemFlags:p,nativeEvent:T,targetContainers:[E]},l!==null&&(l=Wi(l),l!==null&&aF(l)),c):(c.eventSystemFlags|=p,l=c.targetContainers,E!==null&&l.indexOf(E)===-1&&l.push(E),c)}function rre(c,l,h,p,E){switch(l){case"focusin":return Tu=S_(Tu,c,l,h,p,E),!0;case"dragenter":return Su=S_(Su,c,l,h,p,E),!0;case"mouseover":return bu=S_(bu,c,l,h,p,E),!0;case"pointerover":var T=E.pointerId;return C_.set(T,S_(C_.get(T)||null,c,l,h,p,E)),!0;case"gotpointercapture":return T=E.pointerId,T_.set(T,S_(T_.get(T)||null,c,l,h,p,E)),!0}return!1}function lF(c){var l=So(c.target);if(l!==null){var h=s(l);if(h!==null){if(l=h.tag,l===13){if(l=o(h),l!==null){c.blockedOn=l,Co(c.priority,function(){if(h.tag===13){var p=Aa();p=Gs(p);var E=Mf(h,p);E!==null&&la(E,h,p),QR(h,p)}});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){c.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}c.blockedOn=null}function Pw(c){if(c.blockedOn!==null)return!1;for(var l=c.targetContainers;0<l.length;){var h=jR(c.nativeEvent);if(h===null){h=c.nativeEvent;var p=new h.constructor(h.type,h);Sc=p,h.target.dispatchEvent(p),Sc=null}else return l=Wi(h),l!==null&&aF(l),c.blockedOn=h,!1;l.shift()}return!0}function uF(c,l,h){Pw(c)&&h.delete(l)}function ire(){GR=!1,Tu!==null&&Pw(Tu)&&(Tu=null),Su!==null&&Pw(Su)&&(Su=null),bu!==null&&Pw(bu)&&(bu=null),C_.forEach(uF),T_.forEach(uF)}function kw(c,l){c.blockedOn===l&&(c.blockedOn=null,GR||(GR=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,ire)))}var xw=null;function dF(c){xw!==c&&(xw=c,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){xw===c&&(xw=null);for(var l=0;l<c.length;l+=3){var h=c[l],p=c[l+1],E=c[l+2];if(typeof p!="function"){if(KR(p||h)===null)continue;break}var T=Wi(h);T!==null&&(c.splice(l,3),l-=3,KI(T,{pending:!0,data:E,method:h.method,action:p},p,E))}}))}function b_(c){function l(re){return kw(re,c)}Tu!==null&&kw(Tu,c),Su!==null&&kw(Su,c),bu!==null&&kw(bu,c),C_.forEach(l),T_.forEach(l);for(var h=0;h<Iu.length;h++){var p=Iu[h];p.blockedOn===c&&(p.blockedOn=null)}for(;0<Iu.length&&(h=Iu[0],h.blockedOn===null);)lF(h),h.blockedOn===null&&Iu.shift();if(h=(c.ownerDocument||c).$$reactFormReplay,h!=null)for(p=0;p<h.length;p+=3){var E=h[p],T=h[p+1],V=E[Lr]||null;if(typeof T=="function")V||dF(h);else if(V){var W=null;if(T&&T.hasAttribute("formAction")){if(E=T,V=T[Lr]||null)W=V.formAction;else if(KR(E)!==null)continue}else W=V.action;typeof W=="function"?h[p+1]=W:(h.splice(p,3),p-=3),dF(h)}}}function WR(c){this._internalRoot=c}Mw.prototype.render=WR.prototype.render=function(c){var l=this._internalRoot;if(l===null)throw Error(r(409));var h=l.current,p=Aa();sF(h,p,c,l,null,null)},Mw.prototype.unmount=WR.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var l=c.containerInfo;sF(c.current,2,null,c,null,null),Ew(),l[To]=null}};function Mw(c){this._internalRoot=c}Mw.prototype.unstable_scheduleHydration=function(c){if(c){var l=gc();c={blockedOn:null,target:c,priority:l};for(var h=0;h<Iu.length&&l!==0&&l<Iu[h].priority;h++);Iu.splice(h,0,c),h===0&&lF(c)}};var hF=e.version;if(hF!=="19.1.0")throw Error(r(527,hF,"19.1.0"));J.findDOMNode=function(c){var l=c._reactInternals;if(l===void 0)throw typeof c.render=="function"?Error(r(188)):(c=Object.keys(c).join(","),Error(r(268,c)));return c=A(l),c=c!==null?u(c):null,c=c===null?null:c.stateNode,c};var sre={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:de,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Fw=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Fw.isDisabled&&Fw.supportsFiber)try{qn=Fw.inject(sre),yn=Fw}catch{}}return R_.createRoot=function(c,l){if(!i(c))throw Error(r(299));var h=!1,p="",E=OM,T=NM,V=DM,W=null;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(E=l.onUncaughtError),l.onCaughtError!==void 0&&(T=l.onCaughtError),l.onRecoverableError!==void 0&&(V=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(W=l.unstable_transitionCallbacks)),l=rF(c,1,!1,null,null,h,p,E,T,V,W,null),c[To]=l.current,RR(c),new WR(l)},R_.hydrateRoot=function(c,l,h){if(!i(c))throw Error(r(299));var p=!1,E="",T=OM,V=NM,W=DM,re=null,fe=null;return h!=null&&(h.unstable_strictMode===!0&&(p=!0),h.identifierPrefix!==void 0&&(E=h.identifierPrefix),h.onUncaughtError!==void 0&&(T=h.onUncaughtError),h.onCaughtError!==void 0&&(V=h.onCaughtError),h.onRecoverableError!==void 0&&(W=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&(re=h.unstable_transitionCallbacks),h.formState!==void 0&&(fe=h.formState)),l=rF(c,1,!0,l,h??null,p,E,T,V,W,re,fe),l.context=iF(null),h=l.current,p=Aa(),p=Gs(p),E=lu(p),E.callback=null,uu(h,E,p),h=p,l.current.lanes=h,Un(l,h),dA(l),c[To]=l.current,RR(c),new Mw(l)},R_.version="19.1.0",R_}var CF;function mre(){if(CF)return YR.exports;CF=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),YR.exports=pre(),YR.exports}var gre=mre(),O_={},TF;function _re(){if(TF)return O_;TF=1,Object.defineProperty(O_,"__esModule",{value:!0}),O_.parse=o,O_.serialize=u;const t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,n=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,i=Object.prototype.toString,s=(()=>{const m=function(){};return m.prototype=Object.create(null),m})();function o(m,g){const v=new s,y=m.length;if(y<2)return v;const w=(g==null?void 0:g.decode)||d;let b=0;do{const I=m.indexOf("=",b);if(I===-1)break;const B=m.indexOf(";",b),M=B===-1?y:B;if(I>M){b=m.lastIndexOf(";",I-1)+1;continue}const H=a(m,b,I),K=A(m,I,H),Q=m.slice(H,K);if(v[Q]===void 0){let F=a(m,I+1,M),k=A(m,M,F);const G=w(m.slice(F,k));v[Q]=G}b=M+1}while(b<y);return v}function a(m,g,v){do{const y=m.charCodeAt(g);if(y!==32&&y!==9)return g}while(++g<v);return v}function A(m,g,v){for(;g>v;){const y=m.charCodeAt(--g);if(y!==32&&y!==9)return g+1}return v}function u(m,g,v){const y=(v==null?void 0:v.encode)||encodeURIComponent;if(!t.test(m))throw new TypeError(`argument name is invalid: ${m}`);const w=y(g);if(!e.test(w))throw new TypeError(`argument val is invalid: ${g}`);let b=m+"="+w;if(!v)return b;if(v.maxAge!==void 0){if(!Number.isInteger(v.maxAge))throw new TypeError(`option maxAge is invalid: ${v.maxAge}`);b+="; Max-Age="+v.maxAge}if(v.domain){if(!n.test(v.domain))throw new TypeError(`option domain is invalid: ${v.domain}`);b+="; Domain="+v.domain}if(v.path){if(!r.test(v.path))throw new TypeError(`option path is invalid: ${v.path}`);b+="; Path="+v.path}if(v.expires){if(!f(v.expires)||!Number.isFinite(v.expires.valueOf()))throw new TypeError(`option expires is invalid: ${v.expires}`);b+="; Expires="+v.expires.toUTCString()}if(v.httpOnly&&(b+="; HttpOnly"),v.secure&&(b+="; Secure"),v.partitioned&&(b+="; Partitioned"),v.priority)switch(typeof v.priority=="string"?v.priority.toLowerCase():void 0){case"low":b+="; Priority=Low";break;case"medium":b+="; Priority=Medium";break;case"high":b+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${v.priority}`)}if(v.sameSite)switch(typeof v.sameSite=="string"?v.sameSite.toLowerCase():v.sameSite){case!0:case"strict":b+="; SameSite=Strict";break;case"lax":b+="; SameSite=Lax";break;case"none":b+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${v.sameSite}`)}return b}function d(m){if(m.indexOf("%")===-1)return m;try{return decodeURIComponent(m)}catch{return m}}function f(m){return i.call(m)==="[object Date]"}return O_}_re();var SF="popstate";function Ere(t={}){function e(i,s){let{pathname:o="/",search:a="",hash:A=""}=_f(i.location.hash.substring(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),mB("",{pathname:o,search:a,hash:A},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(i,s){let o=i.document.querySelector("base"),a="";if(o&&o.getAttribute("href")){let A=i.location.href,u=A.indexOf("#");a=u===-1?A:A.slice(0,u)}return a+"#"+(typeof s=="string"?s:ev(s))}function r(i,s){Ca(i.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(s)})`)}return yre(e,n,r,t)}function Qr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ca(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function vre(){return Math.random().toString(36).substring(2,10)}function bF(t,e){return{usr:t.state,key:t.key,idx:e}}function mB(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?_f(e):e,state:n,key:e&&e.key||r||vre()}}function ev({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function _f(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function yre(t,e,n,r={}){let{window:i=document.defaultView,v5Compat:s=!1}=r,o=i.history,a="POP",A=null,u=d();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function d(){return(o.state||{idx:null}).idx}function f(){a="POP";let w=d(),b=w==null?null:w-u;u=w,A&&A({action:a,location:y.location,delta:b})}function m(w,b){a="PUSH";let I=mB(y.location,w,b);n&&n(I,w),u=d()+1;let B=bF(I,u),M=y.createHref(I);try{o.pushState(B,"",M)}catch(H){if(H instanceof DOMException&&H.name==="DataCloneError")throw H;i.location.assign(M)}s&&A&&A({action:a,location:y.location,delta:1})}function g(w,b){a="REPLACE";let I=mB(y.location,w,b);n&&n(I,w),u=d();let B=bF(I,u),M=y.createHref(I);o.replaceState(B,"",M),s&&A&&A({action:a,location:y.location,delta:0})}function v(w){let b=i.location.origin!=="null"?i.location.origin:i.location.href,I=typeof w=="string"?w:ev(w);return I=I.replace(/ $/,"%20"),Qr(b,`No window.location.(origin|href) available to create URL for href: ${I}`),new URL(I,b)}let y={get action(){return a},get location(){return t(i,o)},listen(w){if(A)throw new Error("A history only accepts one active listener");return i.addEventListener(SF,f),A=w,()=>{i.removeEventListener(SF,f),A=null}},createHref(w){return e(i,w)},createURL:v,encodeLocation(w){let b=v(w);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:m,replace:g,go(w){return o.go(w)}};return y}function HW(t,e,n="/"){return wre(t,e,n,!1)}function wre(t,e,n,r){let i=typeof e=="string"?_f(e):e,s=Kl(i.pathname||"/",n);if(s==null)return null;let o=jW(t);Cre(o);let a=null;for(let A=0;a==null&&A<o.length;++A){let u=Ure(s);a=Bre(o[A],u,r)}return a}function jW(t,e=[],n=[],r=""){let i=(s,o,a)=>{let A={relativePath:a===void 0?s.path||"":a,caseSensitive:s.caseSensitive===!0,childrenIndex:o,route:s};A.relativePath.startsWith("/")&&(Qr(A.relativePath.startsWith(r),`Absolute route path "${A.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),A.relativePath=A.relativePath.slice(r.length));let u=Ml([r,A.relativePath]),d=n.concat(A);s.children&&s.children.length>0&&(Qr(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),jW(s.children,e,d,u)),!(s.path==null&&!s.index)&&e.push({path:u,score:Nre(u,s.index),routesMeta:d})};return t.forEach((s,o)=>{var a;if(s.path===""||!((a=s.path)!=null&&a.includes("?")))i(s,o);else for(let A of KW(s.path))i(s,o,A)}),e}function KW(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let o=KW(r.join("/")),a=[];return a.push(...o.map(A=>A===""?s:[s,A].join("/"))),i&&a.push(...o),a.map(A=>t.startsWith("/")&&A===""?"/":A)}function Cre(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:Dre(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var Tre=/^:[\w-]+$/,Sre=3,bre=2,Ire=1,Rre=10,Ore=-2,IF=t=>t==="*";function Nre(t,e){let n=t.split("/"),r=n.length;return n.some(IF)&&(r+=Ore),e&&(r+=bre),n.filter(i=>!IF(i)).reduce((i,s)=>i+(Tre.test(s)?Sre:s===""?Ire:Rre),r)}function Dre(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function Bre(t,e,n=!1){let{routesMeta:r}=t,i={},s="/",o=[];for(let a=0;a<r.length;++a){let A=r[a],u=a===r.length-1,d=s==="/"?e:e.slice(s.length)||"/",f=l0({path:A.relativePath,caseSensitive:A.caseSensitive,end:u},d),m=A.route;if(!f&&u&&n&&!r[r.length-1].route.index&&(f=l0({path:A.relativePath,caseSensitive:A.caseSensitive,end:!1},d)),!f)return null;Object.assign(i,f.params),o.push({params:i,pathname:Ml([s,f.pathname]),pathnameBase:Mre(Ml([s,f.pathnameBase])),route:m}),f.pathnameBase!=="/"&&(s=Ml([s,f.pathnameBase]))}return o}function l0(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=Lre(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((u,{paramName:d,isOptional:f},m)=>{if(d==="*"){let v=a[m]||"";o=s.slice(0,s.length-v.length).replace(/(.)\/+$/,"$1")}const g=a[m];return f&&!g?u[d]=void 0:u[d]=(g||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:o,pattern:t}}function Lre(t,e=!1,n=!0){Ca(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,A)=>(r.push({paramName:a,isOptional:A!=null}),A?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function Ure(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ca(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Kl(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function Pre(t,e="/"){let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?_f(t):t;return{pathname:n?n.startsWith("/")?n:kre(n,e):e,search:Fre(r),hash:Vre(i)}}function kre(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function ZR(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function xre(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function WU(t){let e=xre(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function zU(t,e,n,r=!1){let i;typeof t=="string"?i=_f(t):(i={...t},Qr(!i.pathname||!i.pathname.includes("?"),ZR("?","pathname","search",i)),Qr(!i.pathname||!i.pathname.includes("#"),ZR("#","pathname","hash",i)),Qr(!i.search||!i.search.includes("#"),ZR("#","search","hash",i)));let s=t===""||i.pathname==="",o=s?"/":i.pathname,a;if(o==null)a=n;else{let f=e.length-1;if(!r&&o.startsWith("..")){let m=o.split("/");for(;m[0]==="..";)m.shift(),f-=1;i.pathname=m.join("/")}a=f>=0?e[f]:"/"}let A=Pre(i,a),u=o&&o!=="/"&&o.endsWith("/"),d=(s||o===".")&&n.endsWith("/");return!A.pathname.endsWith("/")&&(u||d)&&(A.pathname+="/"),A}var Ml=t=>t.join("/").replace(/\/\/+/g,"/"),Mre=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),Fre=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,Vre=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function Qre(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}var GW=["POST","PUT","PATCH","DELETE"];new Set(GW);var Hre=["GET",...GW];new Set(Hre);var ig=X.createContext(null);ig.displayName="DataRouter";var BS=X.createContext(null);BS.displayName="DataRouterState";var WW=X.createContext({isTransitioning:!1});WW.displayName="ViewTransition";var jre=X.createContext(new Map);jre.displayName="Fetchers";var Kre=X.createContext(null);Kre.displayName="Await";var Yc=X.createContext(null);Yc.displayName="Navigation";var Wv=X.createContext(null);Wv.displayName="Location";var QA=X.createContext({outlet:null,matches:[],isDataRoute:!1});QA.displayName="Route";var qU=X.createContext(null);qU.displayName="RouteError";function Gre(t,{relative:e}={}){Qr(sg(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=X.useContext(Yc),{hash:i,pathname:s,search:o}=zv(t,{relative:e}),a=s;return n!=="/"&&(a=s==="/"?n:Ml([n,s])),r.createHref({pathname:a,search:o,hash:i})}function sg(){return X.useContext(Wv)!=null}function Zl(){return Qr(sg(),"useLocation() may be used only in the context of a <Router> component."),X.useContext(Wv).location}var zW="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function qW(t){X.useContext(Yc).static||X.useLayoutEffect(t)}function og(){let{isDataRoute:t}=X.useContext(QA);return t?iie():Wre()}function Wre(){Qr(sg(),"useNavigate() may be used only in the context of a <Router> component.");let t=X.useContext(ig),{basename:e,navigator:n}=X.useContext(Yc),{matches:r}=X.useContext(QA),{pathname:i}=Zl(),s=JSON.stringify(WU(r)),o=X.useRef(!1);return qW(()=>{o.current=!0}),X.useCallback((A,u={})=>{if(Ca(o.current,zW),!o.current)return;if(typeof A=="number"){n.go(A);return}let d=zU(A,JSON.parse(s),i,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Ml([e,d.pathname])),(u.replace?n.replace:n.push)(d,u.state,u)},[e,n,s,i,t])}X.createContext(null);function zv(t,{relative:e}={}){let{matches:n}=X.useContext(QA),{pathname:r}=Zl(),i=JSON.stringify(WU(n));return X.useMemo(()=>zU(t,JSON.parse(i),r,e==="path"),[t,i,r,e])}function zre(t,e){return YW(t,e)}function YW(t,e,n,r){var I;Qr(sg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i,static:s}=X.useContext(Yc),{matches:o}=X.useContext(QA),a=o[o.length-1],A=a?a.params:{},u=a?a.pathname:"/",d=a?a.pathnameBase:"/",f=a&&a.route;{let B=f&&f.path||"";XW(u,!f||B.endsWith("*")||B.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${B}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${B}"> to <Route path="${B==="/"?"*":`${B}/*`}">.`)}let m=Zl(),g;if(e){let B=typeof e=="string"?_f(e):e;Qr(d==="/"||((I=B.pathname)==null?void 0:I.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${B.pathname}" was given in the \`location\` prop.`),g=B}else g=m;let v=g.pathname||"/",y=v;if(d!=="/"){let B=d.replace(/^\//,"").split("/");y="/"+v.replace(/^\//,"").split("/").slice(B.length).join("/")}let w=!s&&n&&n.matches&&n.matches.length>0?n.matches:HW(t,{pathname:y});Ca(f||w!=null,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),Ca(w==null||w[w.length-1].route.element!==void 0||w[w.length-1].route.Component!==void 0||w[w.length-1].route.lazy!==void 0,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let b=$re(w&&w.map(B=>Object.assign({},B,{params:Object.assign({},A,B.params),pathname:Ml([d,i.encodeLocation?i.encodeLocation(B.pathname).pathname:B.pathname]),pathnameBase:B.pathnameBase==="/"?d:Ml([d,i.encodeLocation?i.encodeLocation(B.pathnameBase).pathname:B.pathnameBase])})),o,n,r);return e&&b?X.createElement(Wv.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},b):b}function qre(){let t=rie(),e=Qre(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},s={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=X.createElement(X.Fragment,null,X.createElement("p",null," Hey developer "),X.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",X.createElement("code",{style:s},"ErrorBoundary")," or"," ",X.createElement("code",{style:s},"errorElement")," prop on your route.")),X.createElement(X.Fragment,null,X.createElement("h2",null,"Unexpected Application Error!"),X.createElement("h3",{style:{fontStyle:"italic"}},e),n?X.createElement("pre",{style:i},n):null,o)}var Yre=X.createElement(qre,null),Xre=class extends X.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){console.error("React Router caught the following error during render",t,e)}render(){return this.state.error!==void 0?X.createElement(QA.Provider,{value:this.props.routeContext},X.createElement(qU.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Jre({routeContext:t,match:e,children:n}){let r=X.useContext(ig);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),X.createElement(QA.Provider,{value:t},n)}function $re(t,e=[],n=null,r=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,s=n==null?void 0:n.errors;if(s!=null){let A=i.findIndex(u=>u.route.id&&(s==null?void 0:s[u.route.id])!==void 0);Qr(A>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),i=i.slice(0,Math.min(i.length,A+1))}let o=!1,a=-1;if(n)for(let A=0;A<i.length;A++){let u=i[A];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(a=A),u.route.id){let{loaderData:d,errors:f}=n,m=u.route.loader&&!d.hasOwnProperty(u.route.id)&&(!f||f[u.route.id]===void 0);if(u.route.lazy||m){o=!0,a>=0?i=i.slice(0,a+1):i=[i[0]];break}}}return i.reduceRight((A,u,d)=>{let f,m=!1,g=null,v=null;n&&(f=s&&u.route.id?s[u.route.id]:void 0,g=u.route.errorElement||Yre,o&&(a<0&&d===0?(XW("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,v=null):a===d&&(m=!0,v=u.route.hydrateFallbackElement||null)));let y=e.concat(i.slice(0,d+1)),w=()=>{let b;return f?b=g:m?b=v:u.route.Component?b=X.createElement(u.route.Component,null):u.route.element?b=u.route.element:b=A,X.createElement(Jre,{match:u,routeContext:{outlet:A,matches:y,isDataRoute:n!=null},children:b})};return n&&(u.route.ErrorBoundary||u.route.errorElement||d===0)?X.createElement(Xre,{location:n.location,revalidation:n.revalidation,component:g,error:f,children:w(),routeContext:{outlet:null,matches:y,isDataRoute:!0}}):w()},null)}function YU(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Zre(t){let e=X.useContext(ig);return Qr(e,YU(t)),e}function eie(t){let e=X.useContext(BS);return Qr(e,YU(t)),e}function tie(t){let e=X.useContext(QA);return Qr(e,YU(t)),e}function XU(t){let e=tie(t),n=e.matches[e.matches.length-1];return Qr(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function nie(){return XU("useRouteId")}function rie(){var r;let t=X.useContext(qU),e=eie("useRouteError"),n=XU("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function iie(){let{router:t}=Zre("useNavigate"),e=XU("useNavigate"),n=X.useRef(!1);return qW(()=>{n.current=!0}),X.useCallback(async(i,s={})=>{Ca(n.current,zW),n.current&&(typeof i=="number"?t.navigate(i):await t.navigate(i,{fromRouteId:e,...s}))},[t,e])}var RF={};function XW(t,e,n){!e&&!RF[t]&&(RF[t]=!0,Ca(!1,n))}X.memo(sie);function sie({routes:t,future:e,state:n}){return YW(t,void 0,n,e)}function Vw({to:t,replace:e,state:n,relative:r}){Qr(sg(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=X.useContext(Yc);Ca(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:s}=X.useContext(QA),{pathname:o}=Zl(),a=og(),A=zU(t,WU(s),o,r==="path"),u=JSON.stringify(A);return X.useEffect(()=>{a(JSON.parse(u),{replace:e,state:n,relative:r})},[a,u,r,e,n]),null}function kp(t){Qr(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function oie({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:i,static:s=!1}){Qr(!sg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=t.replace(/^\/*/,"/"),a=X.useMemo(()=>({basename:o,navigator:i,static:s,future:{}}),[o,i,s]);typeof n=="string"&&(n=_f(n));let{pathname:A="/",search:u="",hash:d="",state:f=null,key:m="default"}=n,g=X.useMemo(()=>{let v=Kl(A,o);return v==null?null:{location:{pathname:v,search:u,hash:d,state:f,key:m},navigationType:r}},[o,A,u,d,f,m,r]);return Ca(g!=null,`<Router basename="${o}"> is not able to match the URL "${A}${u}${d}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:X.createElement(Yc.Provider,{value:a},X.createElement(Wv.Provider,{children:e,value:g}))}function aie({children:t,location:e}){return zre(gB(t),e)}function gB(t,e=[]){let n=[];return X.Children.forEach(t,(r,i)=>{if(!X.isValidElement(r))return;let s=[...e,i];if(r.type===X.Fragment){n.push.apply(n,gB(r.props.children,s));return}Qr(r.type===kp,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Qr(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=gB(r.props.children,s)),n.push(o)}),n}var _T="get",ET="application/x-www-form-urlencoded";function LS(t){return t!=null&&typeof t.tagName=="string"}function cie(t){return LS(t)&&t.tagName.toLowerCase()==="button"}function Aie(t){return LS(t)&&t.tagName.toLowerCase()==="form"}function lie(t){return LS(t)&&t.tagName.toLowerCase()==="input"}function uie(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function die(t,e){return t.button===0&&(!e||e==="_self")&&!uie(t)}function _B(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function hie(t,e){let n=_B(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(s=>{n.append(i,s)})}),n}var Qw=null;function fie(){if(Qw===null)try{new FormData(document.createElement("form"),0),Qw=!1}catch{Qw=!0}return Qw}var pie=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function eO(t){return t!=null&&!pie.has(t)?(Ca(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${ET}"`),null):t}function mie(t,e){let n,r,i,s,o;if(Aie(t)){let a=t.getAttribute("action");r=a?Kl(a,e):null,n=t.getAttribute("method")||_T,i=eO(t.getAttribute("enctype"))||ET,s=new FormData(t)}else if(cie(t)||lie(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let A=t.getAttribute("formaction")||a.getAttribute("action");if(r=A?Kl(A,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||_T,i=eO(t.getAttribute("formenctype"))||eO(a.getAttribute("enctype"))||ET,s=new FormData(a,t),!fie()){let{name:u,type:d,value:f}=t;if(d==="image"){let m=u?`${u}.`:"";s.append(`${m}x`,"0"),s.append(`${m}y`,"0")}else u&&s.append(u,f)}}else{if(LS(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=_T,r=null,i=ET,o=t}return s&&i==="text/plain"&&(o=s,s=void 0),{action:r,method:n.toLowerCase(),encType:i,formData:s,body:o}}function JU(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}async function gie(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function _ie(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function Eie(t,e,n){let r=await Promise.all(t.map(async i=>{let s=e.routes[i.route.id];if(s){let o=await gie(s,n);return o.links?o.links():[]}return[]}));return Cie(r.flat(1).filter(_ie).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function OF(t,e,n,r,i,s){let o=(A,u)=>n[u]?A.route.id!==n[u].route.id:!0,a=(A,u)=>{var d;return n[u].pathname!==A.pathname||((d=n[u].route.path)==null?void 0:d.endsWith("*"))&&n[u].params["*"]!==A.params["*"]};return s==="assets"?e.filter((A,u)=>o(A,u)||a(A,u)):s==="data"?e.filter((A,u)=>{var f;let d=r.routes[A.route.id];if(!d||!d.hasLoader)return!1;if(o(A,u)||a(A,u))return!0;if(A.route.shouldRevalidate){let m=A.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((f=n[0])==null?void 0:f.params)||{},nextUrl:new URL(t,window.origin),nextParams:A.params,defaultShouldRevalidate:!0});if(typeof m=="boolean")return m}return!0}):[]}function vie(t,e,{includeHydrateFallback:n}={}){return yie(t.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),n&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function yie(t){return[...new Set(t)]}function wie(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function Cie(t,e){let n=new Set;return new Set(e),t.reduce((r,i)=>{let s=JSON.stringify(wie(i));return n.has(s)||(n.add(s),r.push({key:s,link:i})),r},[])}var Tie=new Set([100,101,204,205]);function Sie(t,e){let n=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return n.pathname==="/"?n.pathname="_root.data":e&&Kl(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.data`:n.pathname=`${n.pathname.replace(/\/$/,"")}.data`,n}function JW(){let t=X.useContext(ig);return JU(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function bie(){let t=X.useContext(BS);return JU(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var $U=X.createContext(void 0);$U.displayName="FrameworkContext";function $W(){let t=X.useContext($U);return JU(t,"You must render this element inside a <HydratedRouter> element"),t}function Iie(t,e){let n=X.useContext($U),[r,i]=X.useState(!1),[s,o]=X.useState(!1),{onFocus:a,onBlur:A,onMouseEnter:u,onMouseLeave:d,onTouchStart:f}=e,m=X.useRef(null);X.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let y=b=>{b.forEach(I=>{o(I.isIntersecting)})},w=new IntersectionObserver(y,{threshold:.5});return m.current&&w.observe(m.current),()=>{w.disconnect()}}},[t]),X.useEffect(()=>{if(r){let y=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(y)}}},[r]);let g=()=>{i(!0)},v=()=>{i(!1),o(!1)};return n?t!=="intent"?[s,m,{}]:[s,m,{onFocus:N_(a,g),onBlur:N_(A,v),onMouseEnter:N_(u,g),onMouseLeave:N_(d,v),onTouchStart:N_(f,g)}]:[!1,m,{}]}function N_(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function Rie({page:t,...e}){let{router:n}=JW(),r=X.useMemo(()=>HW(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?X.createElement(Nie,{page:t,matches:r,...e}):null}function Oie(t){let{manifest:e,routeModules:n}=$W(),[r,i]=X.useState([]);return X.useEffect(()=>{let s=!1;return Eie(t,e,n).then(o=>{s||i(o)}),()=>{s=!0}},[t,e,n]),r}function Nie({page:t,matches:e,...n}){let r=Zl(),{manifest:i,routeModules:s}=$W(),{basename:o}=JW(),{loaderData:a,matches:A}=bie(),u=X.useMemo(()=>OF(t,e,A,i,r,"data"),[t,e,A,i,r]),d=X.useMemo(()=>OF(t,e,A,i,r,"assets"),[t,e,A,i,r]),f=X.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let v=new Set,y=!1;if(e.forEach(b=>{var B;let I=i.routes[b.route.id];!I||!I.hasLoader||(!u.some(M=>M.route.id===b.route.id)&&b.route.id in a&&((B=s[b.route.id])!=null&&B.shouldRevalidate)||I.hasClientLoader?y=!0:v.add(b.route.id))}),v.size===0)return[];let w=Sie(t,o);return y&&v.size>0&&w.searchParams.set("_routes",e.filter(b=>v.has(b.route.id)).map(b=>b.route.id).join(",")),[w.pathname+w.search]},[o,a,r,i,u,e,t,s]),m=X.useMemo(()=>vie(d,i),[d,i]),g=Oie(d);return X.createElement(X.Fragment,null,f.map(v=>X.createElement("link",{key:v,rel:"prefetch",as:"fetch",href:v,...n})),m.map(v=>X.createElement("link",{key:v,rel:"modulepreload",href:v,...n})),g.map(({key:v,link:y})=>X.createElement("link",{key:v,...y})))}function Die(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var ZW=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{ZW&&(window.__reactRouterVersion="7.5.3")}catch{}function Bie({basename:t,children:e,window:n}){let r=X.useRef();r.current==null&&(r.current=Ere({window:n,v5Compat:!0}));let i=r.current,[s,o]=X.useState({action:i.action,location:i.location}),a=X.useCallback(A=>{X.startTransition(()=>o(A))},[o]);return X.useLayoutEffect(()=>i.listen(a),[i,a]),X.createElement(oie,{basename:t,children:e,location:s.location,navigationType:s.action,navigator:i})}var e9=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ZU=X.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:i,reloadDocument:s,replace:o,state:a,target:A,to:u,preventScrollReset:d,viewTransition:f,...m},g){let{basename:v}=X.useContext(Yc),y=typeof u=="string"&&e9.test(u),w,b=!1;if(typeof u=="string"&&y&&(w=u,ZW))try{let k=new URL(window.location.href),G=u.startsWith("//")?new URL(k.protocol+u):new URL(u),$=Kl(G.pathname,v);G.origin===k.origin&&$!=null?u=$+G.search+G.hash:b=!0}catch{Ca(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let I=Gre(u,{relative:i}),[B,M,H]=Iie(r,m),K=kie(u,{replace:o,state:a,target:A,preventScrollReset:d,relative:i,viewTransition:f});function Q(k){e&&e(k),k.defaultPrevented||K(k)}let F=X.createElement("a",{...m,...H,href:w||I,onClick:b||s?e:Q,ref:Die(g,M),target:A,"data-discover":!y&&n==="render"?"true":void 0});return B&&!y?X.createElement(X.Fragment,null,F,X.createElement(Rie,{page:I})):F});ZU.displayName="Link";var Lie=X.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:i=!1,style:s,to:o,viewTransition:a,children:A,...u},d){let f=zv(o,{relative:u.relative}),m=Zl(),g=X.useContext(BS),{navigator:v,basename:y}=X.useContext(Yc),w=g!=null&&Hie(f)&&a===!0,b=v.encodeLocation?v.encodeLocation(f).pathname:f.pathname,I=m.pathname,B=g&&g.navigation&&g.navigation.location?g.navigation.location.pathname:null;n||(I=I.toLowerCase(),B=B?B.toLowerCase():null,b=b.toLowerCase()),B&&y&&(B=Kl(B,y)||B);const M=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let H=I===b||!i&&I.startsWith(b)&&I.charAt(M)==="/",K=B!=null&&(B===b||!i&&B.startsWith(b)&&B.charAt(b.length)==="/"),Q={isActive:H,isPending:K,isTransitioning:w},F=H?e:void 0,k;typeof r=="function"?k=r(Q):k=[r,H?"active":null,K?"pending":null,w?"transitioning":null].filter(Boolean).join(" ");let G=typeof s=="function"?s(Q):s;return X.createElement(ZU,{...u,"aria-current":F,className:k,ref:d,style:G,to:o,viewTransition:a},typeof A=="function"?A(Q):A)});Lie.displayName="NavLink";var Uie=X.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:i,state:s,method:o=_T,action:a,onSubmit:A,relative:u,preventScrollReset:d,viewTransition:f,...m},g)=>{let v=Vie(),y=Qie(a,{relative:u}),w=o.toLowerCase()==="get"?"get":"post",b=typeof a=="string"&&e9.test(a),I=B=>{if(A&&A(B),B.defaultPrevented)return;B.preventDefault();let M=B.nativeEvent.submitter,H=(M==null?void 0:M.getAttribute("formmethod"))||o;v(M||B.currentTarget,{fetcherKey:e,method:H,navigate:n,replace:i,state:s,relative:u,preventScrollReset:d,viewTransition:f})};return X.createElement("form",{ref:g,method:w,action:y,onSubmit:r?A:I,...m,"data-discover":!b&&t==="render"?"true":void 0})});Uie.displayName="Form";function Pie(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function t9(t){let e=X.useContext(ig);return Qr(e,Pie(t)),e}function kie(t,{target:e,replace:n,state:r,preventScrollReset:i,relative:s,viewTransition:o}={}){let a=og(),A=Zl(),u=zv(t,{relative:s});return X.useCallback(d=>{if(die(d,e)){d.preventDefault();let f=n!==void 0?n:ev(A)===ev(u);a(t,{replace:f,state:r,preventScrollReset:i,relative:s,viewTransition:o})}},[A,a,u,n,r,e,t,i,s,o])}function xie(t){Ca(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=X.useRef(_B(t)),n=X.useRef(!1),r=Zl(),i=X.useMemo(()=>hie(r.search,n.current?null:e.current),[r.search]),s=og(),o=X.useCallback((a,A)=>{const u=_B(typeof a=="function"?a(i):a);n.current=!0,s("?"+u,A)},[s,i]);return[i,o]}var Mie=0,Fie=()=>`__${String(++Mie)}__`;function Vie(){let{router:t}=t9("useSubmit"),{basename:e}=X.useContext(Yc),n=nie();return X.useCallback(async(r,i={})=>{let{action:s,method:o,encType:a,formData:A,body:u}=mie(r,e);if(i.navigate===!1){let d=i.fetcherKey||Fie();await t.fetch(d,n,i.action||s,{preventScrollReset:i.preventScrollReset,formData:A,body:u,formMethod:i.method||o,formEncType:i.encType||a,flushSync:i.flushSync})}else await t.navigate(i.action||s,{preventScrollReset:i.preventScrollReset,formData:A,body:u,formMethod:i.method||o,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:n,flushSync:i.flushSync,viewTransition:i.viewTransition})},[t,e,n])}function Qie(t,{relative:e}={}){let{basename:n}=X.useContext(Yc),r=X.useContext(QA);Qr(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),s={...zv(t||".",{relative:e})},o=Zl();if(t==null){s.search=o.search;let a=new URLSearchParams(s.search),A=a.getAll("index");if(A.some(d=>d==="")){a.delete("index"),A.filter(f=>f).forEach(f=>a.append("index",f));let d=a.toString();s.search=d?`?${d}`:""}}return(!t||t===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(s.pathname=s.pathname==="/"?n:Ml([n,s.pathname])),ev(s)}function Hie(t,e={}){let n=X.useContext(WW);Qr(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=t9("useViewTransitionState"),i=zv(t,{relative:e.relative});if(!n.isTransitioning)return!1;let s=Kl(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=Kl(n.nextLocation.pathname,r)||n.nextLocation.pathname;return l0(i.pathname,o)!=null||l0(i.pathname,s)!=null}new TextEncoder;[...Tie];const jie=()=>{};var NF={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n9={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ke=function(t,e){if(!t)throw ag(e)},ag=function(t){return new Error("Firebase Database ("+n9.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const r9=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},Kie=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],o=t[n++],a=t[n++],A=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(A>>10)),e[r++]=String.fromCharCode(56320+(A&1023))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},e1={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],o=i+1<t.length,a=o?t[i+1]:0,A=i+2<t.length,u=A?t[i+2]:0,d=s>>2,f=(s&3)<<4|a>>4;let m=(a&15)<<2|u>>6,g=u&63;A||(g=64,o||(m=64)),r.push(n[d],n[f],n[m],n[g])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(r9(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):Kie(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],a=i<t.length?n[t.charAt(i)]:0;++i;const u=i<t.length?n[t.charAt(i)]:64;++i;const f=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||a==null||u==null||f==null)throw new Gie;const m=s<<2|a>>4;if(r.push(m),u!==64){const g=a<<4&240|u>>2;if(r.push(g),f!==64){const v=u<<6&192|f;r.push(v)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Gie extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i9=function(t){const e=r9(t);return e1.encodeByteArray(e,!0)},u0=function(t){return i9(t).replace(/\./g,"")},d0=function(t){try{return e1.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wie(t){return s9(void 0,t)}function s9(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!zie(n)||(t[n]=s9(t[n],e[n]));return t}function zie(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qie(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yie=()=>qie().__FIREBASE_DEFAULTS__,Xie=()=>{if(typeof process>"u"||typeof NF>"u")return;const t=NF.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Jie=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&d0(t[1]);return e&&JSON.parse(e)},US=()=>{try{return jie()||Yie()||Xie()||Jie()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},o9=t=>{var e,n;return(n=(e=US())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},t1=t=>{const e=o9(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},a9=()=>{var t;return(t=US())===null||t===void 0?void 0:t.config},c9=t=>{var e;return(e=US())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qv{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n1(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[u0(JSON.stringify(n)),u0(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function io(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function r1(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(io())}function $ie(){var t;const e=(t=US())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Zie(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function A9(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function l9(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ese(){const t=io();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function tse(){return n9.NODE_ADMIN===!0}function nse(){return!$ie()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function u9(){try{return typeof indexedDB=="object"}catch{return!1}}function d9(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}function rse(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ise="FirebaseError";class dc extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=ise,Object.setPrototypeOf(this,dc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ef.prototype.create)}}class Ef{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?sse(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new dc(i,a,r)}}function sse(t,e){return t.replace(ose,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const ose=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tv(t){return JSON.parse(t)}function os(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h9=function(t){let e={},n={},r={},i="";try{const s=t.split(".");e=tv(d0(s[0])||""),n=tv(d0(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:r,signature:i}},ase=function(t){const e=h9(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},cse=function(t){const e=h9(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HA(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Rm(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function EB(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function h0(t,e,n){const r={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}function Gl(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],o=e[i];if(DF(s)&&DF(o)){if(!Gl(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function DF(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ase{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const r=this.W_;if(typeof e=="string")for(let f=0;f<16;f++)r[f]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let f=0;f<16;f++)r[f]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let f=16;f<80;f++){const m=r[f-3]^r[f-8]^r[f-14]^r[f-16];r[f]=(m<<1|m>>>31)&4294967295}let i=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],A=this.chain_[4],u,d;for(let f=0;f<80;f++){f<40?f<20?(u=a^s&(o^a),d=1518500249):(u=s^o^a,d=1859775393):f<60?(u=s&o|a&(s|o),d=2400959708):(u=s^o^a,d=3395469782);const m=(i<<5|i>>>27)+u+A+d+r[f]&4294967295;A=a,a=o,o=(s<<30|s>>>2)&4294967295,s=i,i=m}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+A&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const r=n-this.blockSize;let i=0;const s=this.buf_;let o=this.inbuf_;for(;i<n;){if(o===0)for(;i<=r;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<n;)if(s[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}else for(;i<n;)if(s[o]=e[i],++o,++i,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=n&255,n/=256;this.compress_(this.buf_);let r=0;for(let i=0;i<5;i++)for(let s=24;s>=0;s-=8)e[r]=this.chain_[i]>>s&255,++r;return e}}function lse(t,e){const n=new use(t,e);return n.subscribe.bind(n)}class use{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");dse(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=tO),i.error===void 0&&(i.error=tO),i.complete===void 0&&(i.complete=tO);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function dse(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function tO(){}function PS(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hse=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);if(i>=55296&&i<=56319){const s=i-55296;r++,ke(r<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(r)-56320;i=65536+(s<<10)+o}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},kS=function(t){let e=0;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fse=1e3,pse=2,mse=4*60*60*1e3,gse=.5;function BF(t,e=fse,n=pse){const r=e*Math.pow(n,t),i=Math.round(gse*r*(Math.random()-.5)*2);return Math.min(mse,r+i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pi(t){return t&&t._delegate?t._delegate:t}class Ta{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Th="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _se{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new qv;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(vse(e))try{this.getOrInitializeService({instanceIdentifier:Th})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=Th){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Th){return this.instances.has(e)}getOptions(e=Th){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,n){var r;const i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Ese(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Th){return this.component?this.component.multipleInstances?e:Th:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ese(t){return t===Th?void 0:t}function vse(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yse{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new _se(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var un;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(un||(un={}));const wse={debug:un.DEBUG,verbose:un.VERBOSE,info:un.INFO,warn:un.WARN,error:un.ERROR,silent:un.SILENT},Cse=un.INFO,Tse={[un.DEBUG]:"log",[un.VERBOSE]:"log",[un.INFO]:"info",[un.WARN]:"warn",[un.ERROR]:"error"},Sse=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=Tse[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};let Yv=class{constructor(e){this.name=e,this._logLevel=Cse,this._logHandler=Sse,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in un))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?wse[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,un.DEBUG,...e),this._logHandler(this,un.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,un.VERBOSE,...e),this._logHandler(this,un.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,un.INFO,...e),this._logHandler(this,un.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,un.WARN,...e),this._logHandler(this,un.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,un.ERROR,...e),this._logHandler(this,un.ERROR,...e)}};const bse=(t,e)=>e.some(n=>t instanceof n);let LF,UF;function Ise(){return LF||(LF=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Rse(){return UF||(UF=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const f9=new WeakMap,vB=new WeakMap,p9=new WeakMap,nO=new WeakMap,i1=new WeakMap;function Ose(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",o)},s=()=>{n(ld(t.result)),i()},o=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&f9.set(n,t)}).catch(()=>{}),i1.set(e,t),e}function Nse(t){if(vB.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",o),t.removeEventListener("abort",o)},s=()=>{n(),i()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",o),t.addEventListener("abort",o)});vB.set(t,e)}let yB={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return vB.get(t);if(e==="objectStoreNames")return t.objectStoreNames||p9.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ld(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Dse(t){yB=t(yB)}function Bse(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(rO(this),e,...n);return p9.set(r,e.sort?e.sort():[e]),ld(r)}:Rse().includes(t)?function(...e){return t.apply(rO(this),e),ld(f9.get(this))}:function(...e){return ld(t.apply(rO(this),e))}}function Lse(t){return typeof t=="function"?Bse(t):(t instanceof IDBTransaction&&Nse(t),bse(t,Ise())?new Proxy(t,yB):t)}function ld(t){if(t instanceof IDBRequest)return Ose(t);if(nO.has(t))return nO.get(t);const e=Lse(t);return e!==t&&(nO.set(t,e),i1.set(e,t)),e}const rO=t=>i1.get(t);function m9(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=ld(o);return r&&o.addEventListener("upgradeneeded",A=>{r(ld(o.result),A.oldVersion,A.newVersion,ld(o.transaction),A)}),n&&o.addEventListener("blocked",A=>n(A.oldVersion,A.newVersion,A)),a.then(A=>{s&&A.addEventListener("close",()=>s()),i&&A.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const Use=["get","getKey","getAll","getAllKeys","count"],Pse=["put","add","delete","clear"],iO=new Map;function PF(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(iO.get(e))return iO.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=Pse.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Use.includes(n)))return;const s=async function(o,...a){const A=this.transaction(o,i?"readwrite":"readonly");let u=A.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[n](...a),i&&A.done]))[0]};return iO.set(e,s),s}Dse(t=>({...t,get:(e,n,r)=>PF(e,n)||t.get(e,n,r),has:(e,n)=>!!PF(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kse{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(xse(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function xse(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const wB="@firebase/app",kF="0.11.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wl=new Yv("@firebase/app"),Mse="@firebase/app-compat",Fse="@firebase/analytics-compat",Vse="@firebase/analytics",Qse="@firebase/app-check-compat",Hse="@firebase/app-check",jse="@firebase/auth",Kse="@firebase/auth-compat",Gse="@firebase/database",Wse="@firebase/data-connect",zse="@firebase/database-compat",qse="@firebase/functions",Yse="@firebase/functions-compat",Xse="@firebase/installations",Jse="@firebase/installations-compat",$se="@firebase/messaging",Zse="@firebase/messaging-compat",eoe="@firebase/performance",toe="@firebase/performance-compat",noe="@firebase/remote-config",roe="@firebase/remote-config-compat",ioe="@firebase/storage",soe="@firebase/storage-compat",ooe="@firebase/firestore",aoe="@firebase/vertexai",coe="@firebase/firestore-compat",Aoe="firebase",loe="11.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CB="[DEFAULT]",uoe={[wB]:"fire-core",[Mse]:"fire-core-compat",[Vse]:"fire-analytics",[Fse]:"fire-analytics-compat",[Hse]:"fire-app-check",[Qse]:"fire-app-check-compat",[jse]:"fire-auth",[Kse]:"fire-auth-compat",[Gse]:"fire-rtdb",[Wse]:"fire-data-connect",[zse]:"fire-rtdb-compat",[qse]:"fire-fn",[Yse]:"fire-fn-compat",[Xse]:"fire-iid",[Jse]:"fire-iid-compat",[$se]:"fire-fcm",[Zse]:"fire-fcm-compat",[eoe]:"fire-perf",[toe]:"fire-perf-compat",[noe]:"fire-rc",[roe]:"fire-rc-compat",[ioe]:"fire-gcs",[soe]:"fire-gcs-compat",[ooe]:"fire-fst",[coe]:"fire-fst-compat",[aoe]:"fire-vertex","fire-js":"fire-js",[Aoe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f0=new Map,doe=new Map,TB=new Map;function xF(t,e){try{t.container.addComponent(e)}catch(n){Wl.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function lc(t){const e=t.name;if(TB.has(e))return Wl.debug(`There were multiple attempts to register component ${e}.`),!1;TB.set(e,t);for(const n of f0.values())xF(n,t);for(const n of doe.values())xF(n,t);return!0}function eu(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ec(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hoe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ud=new Ef("app","Firebase",hoe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class foe{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ta("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ud.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xd=loe;function g9(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:CB,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw ud.create("bad-app-name",{appName:String(i)});if(n||(n=a9()),!n)throw ud.create("no-options");const s=f0.get(i);if(s){if(Gl(n,s.options)&&Gl(r,s.config))return s;throw ud.create("duplicate-app",{appName:i})}const o=new yse(i);for(const A of TB.values())o.addComponent(A);const a=new foe(n,r,o);return f0.set(i,a),a}function Xv(t=CB){const e=f0.get(t);if(!e&&t===CB&&a9())return g9();if(!e)throw ud.create("no-app",{appName:t});return e}function ro(t,e,n){var r;let i=(r=uoe[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Wl.warn(a.join(" "));return}lc(new Ta(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const poe="firebase-heartbeat-database",moe=1,nv="firebase-heartbeat-store";let sO=null;function _9(){return sO||(sO=m9(poe,moe,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(nv)}catch(n){console.warn(n)}}}}).catch(t=>{throw ud.create("idb-open",{originalErrorMessage:t.message})})),sO}async function goe(t){try{const n=(await _9()).transaction(nv),r=await n.objectStore(nv).get(E9(t));return await n.done,r}catch(e){if(e instanceof dc)Wl.warn(e.message);else{const n=ud.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Wl.warn(n.message)}}}async function MF(t,e){try{const r=(await _9()).transaction(nv,"readwrite");await r.objectStore(nv).put(e,E9(t)),await r.done}catch(n){if(n instanceof dc)Wl.warn(n.message);else{const r=ud.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Wl.warn(r.message)}}}function E9(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _oe=1024,Eoe=30;class voe{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new woe(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=FF();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>Eoe){const o=Coe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Wl.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=FF(),{heartbeatsToSend:r,unsentEntries:i}=yoe(this._heartbeatsCache.heartbeats),s=u0(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(n){return Wl.warn(n),""}}}function FF(){return new Date().toISOString().substring(0,10)}function yoe(t,e=_oe){const n=[];let r=t.slice();for(const i of t){const s=n.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),VF(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),VF(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class woe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return u9()?d9().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await goe(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return MF(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return MF(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function VF(t){return u0(JSON.stringify({version:2,heartbeats:t})).length}function Coe(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Toe(t){lc(new Ta("platform-logger",e=>new kse(e),"PRIVATE")),lc(new Ta("heartbeat",e=>new voe(e),"PRIVATE")),ro(wB,kF,t),ro(wB,kF,"esm2017"),ro("fire-js","")}Toe("");var Soe="firebase",boe="11.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ro(Soe,boe,"app");const v9="@firebase/installations",s1="0.6.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y9=1e4,w9=`w:${s1}`,C9="FIS_v2",Ioe="https://firebaseinstallations.googleapis.com/v1",Roe=60*60*1e3,Ooe="installations",Noe="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Doe={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},of=new Ef(Ooe,Noe,Doe);function T9(t){return t instanceof dc&&t.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S9({projectId:t}){return`${Ioe}/projects/${t}/installations`}function b9(t){return{token:t.token,requestStatus:2,expiresIn:Loe(t.expiresIn),creationTime:Date.now()}}async function I9(t,e){const r=(await e.json()).error;return of.create("request-failed",{requestName:t,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function R9({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function Boe(t,{refreshToken:e}){const n=R9(t);return n.append("Authorization",Uoe(e)),n}async function O9(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Loe(t){return Number(t.replace("s","000"))}function Uoe(t){return`${C9} ${t}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Poe({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=S9(t),i=R9(t),s=e.getImmediate({optional:!0});if(s){const u=await s.getHeartbeatsHeader();u&&i.append("x-firebase-client",u)}const o={fid:n,authVersion:C9,appId:t.appId,sdkVersion:w9},a={method:"POST",headers:i,body:JSON.stringify(o)},A=await O9(()=>fetch(r,a));if(A.ok){const u=await A.json();return{fid:u.fid||n,registrationStatus:2,refreshToken:u.refreshToken,authToken:b9(u.authToken)}}else throw await I9("Create Installation",A)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N9(t){return new Promise(e=>{setTimeout(e,t)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function koe(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xoe=/^[cdef][\w-]{21}$/,SB="";function Moe(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=Foe(t);return xoe.test(n)?n:SB}catch{return SB}}function Foe(t){return koe(t).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xS(t){return`${t.appName}!${t.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D9=new Map;function B9(t,e){const n=xS(t);L9(n,e),Voe(n,e)}function L9(t,e){const n=D9.get(t);if(n)for(const r of n)r(e)}function Voe(t,e){const n=Qoe();n&&n.postMessage({key:t,fid:e}),Hoe()}let xh=null;function Qoe(){return!xh&&"BroadcastChannel"in self&&(xh=new BroadcastChannel("[Firebase] FID Change"),xh.onmessage=t=>{L9(t.data.key,t.data.fid)}),xh}function Hoe(){D9.size===0&&xh&&(xh.close(),xh=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const joe="firebase-installations-database",Koe=1,af="firebase-installations-store";let oO=null;function o1(){return oO||(oO=m9(joe,Koe,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(af)}}})),oO}async function p0(t,e){const n=xS(t),i=(await o1()).transaction(af,"readwrite"),s=i.objectStore(af),o=await s.get(n);return await s.put(e,n),await i.done,(!o||o.fid!==e.fid)&&B9(t,e.fid),e}async function U9(t){const e=xS(t),r=(await o1()).transaction(af,"readwrite");await r.objectStore(af).delete(e),await r.done}async function MS(t,e){const n=xS(t),i=(await o1()).transaction(af,"readwrite"),s=i.objectStore(af),o=await s.get(n),a=e(o);return a===void 0?await s.delete(n):await s.put(a,n),await i.done,a&&(!o||o.fid!==a.fid)&&B9(t,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a1(t){let e;const n=await MS(t.appConfig,r=>{const i=Goe(r),s=Woe(t,i);return e=s.registrationPromise,s.installationEntry});return n.fid===SB?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function Goe(t){const e=t||{fid:Moe(),registrationStatus:0};return P9(e)}function Woe(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const i=Promise.reject(of.create("app-offline"));return{installationEntry:e,registrationPromise:i}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=zoe(t,n);return{installationEntry:n,registrationPromise:r}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:qoe(t)}:{installationEntry:e}}async function zoe(t,e){try{const n=await Poe(t,e);return p0(t.appConfig,n)}catch(n){throw T9(n)&&n.customData.serverCode===409?await U9(t.appConfig):await p0(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function qoe(t){let e=await QF(t.appConfig);for(;e.registrationStatus===1;)await N9(100),e=await QF(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:r}=await a1(t);return r||n}return e}function QF(t){return MS(t,e=>{if(!e)throw of.create("installation-not-found");return P9(e)})}function P9(t){return Yoe(t)?{fid:t.fid,registrationStatus:0}:t}function Yoe(t){return t.registrationStatus===1&&t.registrationTime+y9<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xoe({appConfig:t,heartbeatServiceProvider:e},n){const r=Joe(t,n),i=Boe(t,n),s=e.getImmediate({optional:!0});if(s){const u=await s.getHeartbeatsHeader();u&&i.append("x-firebase-client",u)}const o={installation:{sdkVersion:w9,appId:t.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},A=await O9(()=>fetch(r,a));if(A.ok){const u=await A.json();return b9(u)}else throw await I9("Generate Auth Token",A)}function Joe(t,{fid:e}){return`${S9(t)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c1(t,e=!1){let n;const r=await MS(t.appConfig,s=>{if(!k9(s))throw of.create("not-registered");const o=s.authToken;if(!e&&eae(o))return s;if(o.requestStatus===1)return n=$oe(t,e),s;{if(!navigator.onLine)throw of.create("app-offline");const a=nae(s);return n=Zoe(t,a),a}});return n?await n:r.authToken}async function $oe(t,e){let n=await HF(t.appConfig);for(;n.authToken.requestStatus===1;)await N9(100),n=await HF(t.appConfig);const r=n.authToken;return r.requestStatus===0?c1(t,e):r}function HF(t){return MS(t,e=>{if(!k9(e))throw of.create("not-registered");const n=e.authToken;return rae(n)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function Zoe(t,e){try{const n=await Xoe(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await p0(t.appConfig,r),n}catch(n){if(T9(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await U9(t.appConfig);else{const r=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await p0(t.appConfig,r)}throw n}}function k9(t){return t!==void 0&&t.registrationStatus===2}function eae(t){return t.requestStatus===2&&!tae(t)}function tae(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+Roe}function nae(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}function rae(t){return t.requestStatus===1&&t.requestTime+y9<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iae(t){const e=t,{installationEntry:n,registrationPromise:r}=await a1(e);return r?r.catch(console.error):c1(e).catch(console.error),n.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sae(t,e=!1){const n=t;return await oae(n),(await c1(n,e)).token}async function oae(t){const{registrationPromise:e}=await a1(t);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aae(t){if(!t||!t.options)throw aO("App Configuration");if(!t.name)throw aO("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw aO(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function aO(t){return of.create("missing-app-config-values",{valueName:t})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x9="installations",cae="installations-internal",Aae=t=>{const e=t.getProvider("app").getImmediate(),n=aae(e),r=eu(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:r,_delete:()=>Promise.resolve()}},lae=t=>{const e=t.getProvider("app").getImmediate(),n=eu(e,x9).getImmediate();return{getId:()=>iae(n),getToken:i=>sae(n,i)}};function uae(){lc(new Ta(x9,Aae,"PUBLIC")),lc(new Ta(cae,lae,"PRIVATE"))}uae();ro(v9,s1);ro(v9,s1,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m0="analytics",dae="firebase_id",hae="origin",fae=60*1e3,pae="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",A1="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wo=new Yv("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mae={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},wa=new Ef("analytics","Analytics",mae);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gae(t){if(!t.startsWith(A1)){const e=wa.create("invalid-gtag-resource",{gtagURL:t});return Wo.warn(e.message),""}return t}function M9(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function _ae(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function Eae(t,e){const n=_ae("firebase-js-sdk-policy",{createScriptURL:gae}),r=document.createElement("script"),i=`${A1}?l=${t}&id=${e}`;r.src=n?n==null?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function vae(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function yae(t,e,n,r,i,s){const o=r[i];try{if(o)await e[o];else{const A=(await M9(n)).find(u=>u.measurementId===i);A&&await e[A.appId]}}catch(a){Wo.error(a)}t("config",i,s)}async function wae(t,e,n,r,i){try{let s=[];if(i&&i.send_to){let o=i.send_to;Array.isArray(o)||(o=[o]);const a=await M9(n);for(const A of o){const u=a.find(f=>f.measurementId===A),d=u&&e[u.appId];if(d)s.push(d);else{s=[];break}}}s.length===0&&(s=Object.values(e)),await Promise.all(s),t("event",r,i||{})}catch(s){Wo.error(s)}}function Cae(t,e,n,r){async function i(s,...o){try{if(s==="event"){const[a,A]=o;await wae(t,e,n,a,A)}else if(s==="config"){const[a,A]=o;await yae(t,e,n,r,a,A)}else if(s==="consent"){const[a,A]=o;t("consent",a,A)}else if(s==="get"){const[a,A,u]=o;t("get",a,A,u)}else if(s==="set"){const[a]=o;t("set",a)}else t(s,...o)}catch(a){Wo.error(a)}}return i}function Tae(t,e,n,r,i){let s=function(...o){window[r].push(arguments)};return window[i]&&typeof window[i]=="function"&&(s=window[i]),window[i]=Cae(s,t,e,n),{gtagCore:s,wrappedGtag:window[i]}}function Sae(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(A1)&&n.src.includes(t))return n;return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bae=30,Iae=1e3;class Rae{constructor(e={},n=Iae){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const F9=new Rae;function Oae(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Nae(t){var e;const{appId:n,apiKey:r}=t,i={method:"GET",headers:Oae(r)},s=pae.replace("{app-id}",n),o=await fetch(s,i);if(o.status!==200&&o.status!==304){let a="";try{const A=await o.json();!((e=A.error)===null||e===void 0)&&e.message&&(a=A.error.message)}catch{}throw wa.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function Dae(t,e=F9,n){const{appId:r,apiKey:i,measurementId:s}=t.options;if(!r)throw wa.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw wa.create("no-api-key")}const o=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Uae;return setTimeout(async()=>{a.abort()},fae),V9({appId:r,apiKey:i,measurementId:s},o,a,e)}async function V9(t,{throttleEndTimeMillis:e,backoffCount:n},r,i=F9){var s;const{appId:o,measurementId:a}=t;try{await Bae(r,e)}catch(A){if(a)return Wo.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${A==null?void 0:A.message}]`),{appId:o,measurementId:a};throw A}try{const A=await Nae(t);return i.deleteThrottleMetadata(o),A}catch(A){const u=A;if(!Lae(u)){if(i.deleteThrottleMetadata(o),a)return Wo.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:o,measurementId:a};throw A}const d=Number((s=u==null?void 0:u.customData)===null||s===void 0?void 0:s.httpStatus)===503?BF(n,i.intervalMillis,bae):BF(n,i.intervalMillis),f={throttleEndTimeMillis:Date.now()+d,backoffCount:n+1};return i.setThrottleMetadata(o,f),Wo.debug(`Calling attemptFetch again in ${d} millis`),V9(t,f,r,i)}}function Bae(t,e){return new Promise((n,r)=>{const i=Math.max(e-Date.now(),0),s=setTimeout(n,i);t.addEventListener(()=>{clearTimeout(s),r(wa.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function Lae(t){if(!(t instanceof dc)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class Uae{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Pae(t,e,n,r,i){if(i&&i.global){t("event",n,r);return}else{const s=await e,o=Object.assign(Object.assign({},r),{send_to:s});t("event",n,o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kae(){if(u9())try{await d9()}catch(t){return Wo.warn(wa.create("indexeddb-unavailable",{errorInfo:t==null?void 0:t.toString()}).message),!1}else return Wo.warn(wa.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function xae(t,e,n,r,i,s,o){var a;const A=Dae(t);A.then(g=>{n[g.measurementId]=g.appId,t.options.measurementId&&g.measurementId!==t.options.measurementId&&Wo.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${g.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(g=>Wo.error(g)),e.push(A);const u=kae().then(g=>{if(g)return r.getId()}),[d,f]=await Promise.all([A,u]);Sae(s)||Eae(s,d.measurementId),i("js",new Date);const m=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return m[hae]="firebase",m.update=!0,f!=null&&(m[dae]=f),i("config",d.measurementId,m),d.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mae{constructor(e){this.app=e}_delete(){return delete CE[this.app.options.appId],Promise.resolve()}}let CE={},jF=[];const KF={};let cO="dataLayer",Fae="gtag",GF,Q9,WF=!1;function Vae(){const t=[];if(A9()&&t.push("This is a browser extension environment."),rse()||t.push("Cookies are not available."),t.length>0){const e=t.map((r,i)=>`(${i+1}) ${r}`).join(" "),n=wa.create("invalid-analytics-context",{errorInfo:e});Wo.warn(n.message)}}function Qae(t,e,n){Vae();const r=t.options.appId;if(!r)throw wa.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)Wo.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw wa.create("no-api-key");if(CE[r]!=null)throw wa.create("already-exists",{id:r});if(!WF){vae(cO);const{wrappedGtag:s,gtagCore:o}=Tae(CE,jF,KF,cO,Fae);Q9=s,GF=o,WF=!0}return CE[r]=xae(t,jF,KF,e,GF,cO,n),new Mae(t)}function Hae(t=Xv()){t=pi(t);const e=eu(t,m0);return e.isInitialized()?e.getImmediate():jae(t)}function jae(t,e={}){const n=eu(t,m0);if(n.isInitialized()){const i=n.getImmediate();if(Gl(e,n.getOptions()))return i;throw wa.create("already-initialized")}return n.initialize({options:e})}function Kae(t,e,n,r){t=pi(t),Pae(Q9,CE[t.app.options.appId],e,n,r).catch(i=>Wo.error(i))}const zF="@firebase/analytics",qF="0.10.12";function Gae(){lc(new Ta(m0,(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("installations-internal").getImmediate();return Qae(r,i,n)},"PUBLIC")),lc(new Ta("analytics-internal",t,"PRIVATE")),ro(zF,qF),ro(zF,qF,"esm2017");function t(e){try{const n=e.getProvider(m0).getImmediate();return{logEvent:(r,i,s)=>Kae(n,r,i,s)}}catch(n){throw wa.create("interop-component-reg-failed",{reason:n})}}}Gae();function l1(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function H9(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Wae=H9,j9=new Ef("auth","Firebase",H9());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g0=new Yv("@firebase/auth");function zae(t,...e){g0.logLevel<=un.WARN&&g0.warn(`Auth (${xd}): ${t}`,...e)}function vT(t,...e){g0.logLevel<=un.ERROR&&g0.error(`Auth (${xd}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zl(t,...e){throw u1(t,...e)}function LA(t,...e){return u1(t,...e)}function K9(t,e,n){const r=Object.assign(Object.assign({},Wae()),{[e]:n});return new Ef("auth","Firebase",r).create(e,{appName:t.name})}function Yh(t){return K9(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function u1(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return j9.create(t,...e)}function Dt(t,e,...n){if(!t)throw u1(e,...n)}function Ul(t){const e="INTERNAL ASSERTION FAILED: "+t;throw vT(e),new Error(e)}function ql(t,e){t||Ul(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bB(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function qae(){return YF()==="http:"||YF()==="https:"}function YF(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yae(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(qae()||A9()||"connection"in navigator)?navigator.onLine:!0}function Xae(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(e,n){this.shortDelay=e,this.longDelay=n,ql(n>e,"Short delay should be less than long delay!"),this.isMobile=r1()||l9()}get(){return Yae()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d1(t,e){ql(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G9{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ul("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ul("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ul("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jae={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $ae=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Zae=new Jv(3e4,6e4);function h1(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Ag(t,e,n,r,i={}){return W9(t,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});const a=cg(Object.assign({key:t.config.apiKey},o)).slice(1),A=await t._getAdditionalHeaders();A["Content-Type"]="application/json",t.languageCode&&(A["X-Firebase-Locale"]=t.languageCode);const u=Object.assign({method:e,headers:A},s);return Zie()||(u.referrerPolicy="no-referrer"),G9.fetch()(await z9(t,t.config.apiHost,n,a),u)})}async function W9(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},Jae),e);try{const i=new tce(t),s=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw Hw(t,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[A,u]=a.split(" : ");if(A==="FEDERATED_USER_ID_ALREADY_LINKED")throw Hw(t,"credential-already-in-use",o);if(A==="EMAIL_EXISTS")throw Hw(t,"email-already-in-use",o);if(A==="USER_DISABLED")throw Hw(t,"user-disabled",o);const d=r[A]||A.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw K9(t,d,u);zl(t,d)}}catch(i){if(i instanceof dc)throw i;zl(t,"network-request-failed",{message:String(i)})}}async function ece(t,e,n,r,i={}){const s=await Ag(t,e,n,r,i);return"mfaPendingCredential"in s&&zl(t,"multi-factor-auth-required",{_serverResponse:s}),s}async function z9(t,e,n,r){const i=`${e}${n}?${r}`,s=t,o=s.config.emulator?d1(t.config,i):`${t.config.apiScheme}://${i}`;return $ae.includes(n)&&(await s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o}class tce{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(LA(this.auth,"network-request-failed")),Zae.get())})}}function Hw(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=LA(t,e,r);return i.customData._tokenResponse=n,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nce(t,e){return Ag(t,"POST","/v1/accounts:delete",e)}async function _0(t,e){return Ag(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TE(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function rce(t,e=!1){const n=pi(t),r=await n.getIdToken(e),i=f1(r);Dt(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:TE(AO(i.auth_time)),issuedAtTime:TE(AO(i.iat)),expirationTime:TE(AO(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function AO(t){return Number(t)*1e3}function f1(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return vT("JWT malformed, contained fewer than 3 sections"),null;try{const i=d0(n);return i?JSON.parse(i):(vT("Failed to decode base64 JWT payload"),null)}catch(i){return vT("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function XF(t){const e=f1(t);return Dt(e,"internal-error"),Dt(typeof e.exp<"u","internal-error"),Dt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rv(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof dc&&ice(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function ice({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sce{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IB{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=TE(this.lastLoginAt),this.creationTime=TE(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function E0(t){var e;const n=t.auth,r=await t.getIdToken(),i=await rv(t,_0(n,{idToken:r}));Dt(i==null?void 0:i.users.length,n,"internal-error");const s=i.users[0];t._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?q9(s.providerUserInfo):[],a=ace(t.providerData,o),A=t.isAnonymous,u=!(t.email&&s.passwordHash)&&!(a!=null&&a.length),d=A?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new IB(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,f)}async function oce(t){const e=pi(t);await E0(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function ace(t,e){return[...t.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function q9(t){return t.map(e=>{var{providerId:n}=e,r=l1(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cce(t,e){const n=await W9(t,{},async()=>{const r=cg({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=t.config,o=await z9(t,i,"/v1/token",`key=${s}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",G9.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function Ace(t,e){return Ag(t,"POST","/v2/accounts:revokeToken",h1(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Am{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Dt(e.idToken,"internal-error"),Dt(typeof e.idToken<"u","internal-error"),Dt(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):XF(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Dt(e.length!==0,"internal-error");const n=XF(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Dt(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:i,expiresIn:s}=await cce(e,n);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:i,expirationTime:s}=n,o=new Am;return r&&(Dt(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(Dt(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(Dt(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Am,this.toJSON())}_performRefresh(){return Ul("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ou(t,e){Dt(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Hc{constructor(e){var{uid:n,auth:r,stsTokenManager:i}=e,s=l1(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new sce(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new IB(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await rv(this,this.stsTokenManager.getToken(this.auth,e));return Dt(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return rce(this,e)}reload(){return oce(this)}_assign(e){this!==e&&(Dt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Hc(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){Dt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await E0(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ec(this.auth.app))return Promise.reject(Yh(this.auth));const e=await this.getIdToken();return await rv(this,nce(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,i,s,o,a,A,u,d;const f=(r=n.displayName)!==null&&r!==void 0?r:void 0,m=(i=n.email)!==null&&i!==void 0?i:void 0,g=(s=n.phoneNumber)!==null&&s!==void 0?s:void 0,v=(o=n.photoURL)!==null&&o!==void 0?o:void 0,y=(a=n.tenantId)!==null&&a!==void 0?a:void 0,w=(A=n._redirectEventId)!==null&&A!==void 0?A:void 0,b=(u=n.createdAt)!==null&&u!==void 0?u:void 0,I=(d=n.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:B,emailVerified:M,isAnonymous:H,providerData:K,stsTokenManager:Q}=n;Dt(B&&Q,e,"internal-error");const F=Am.fromJSON(this.name,Q);Dt(typeof B=="string",e,"internal-error"),Ou(f,e.name),Ou(m,e.name),Dt(typeof M=="boolean",e,"internal-error"),Dt(typeof H=="boolean",e,"internal-error"),Ou(g,e.name),Ou(v,e.name),Ou(y,e.name),Ou(w,e.name),Ou(b,e.name),Ou(I,e.name);const k=new Hc({uid:B,auth:e,email:m,emailVerified:M,displayName:f,isAnonymous:H,photoURL:v,phoneNumber:g,tenantId:y,stsTokenManager:F,createdAt:b,lastLoginAt:I});return K&&Array.isArray(K)&&(k.providerData=K.map(G=>Object.assign({},G))),w&&(k._redirectEventId=w),k}static async _fromIdTokenResponse(e,n,r=!1){const i=new Am;i.updateFromServerResponse(n);const s=new Hc({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await E0(s),s}static async _fromGetAccountInfoResponse(e,n,r){const i=n.users[0];Dt(i.localId!==void 0,"internal-error");const s=i.providerUserInfo!==void 0?q9(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(s!=null&&s.length),a=new Am;a.updateFromIdToken(r);const A=new Hc({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:o}),u={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new IB(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(s!=null&&s.length)};return Object.assign(A,u),A}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JF=new Map;function Pl(t){ql(t instanceof Function,"Expected a class definition");let e=JF.get(t);return e?(ql(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,JF.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y9{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}Y9.type="NONE";const $F=Y9;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yT(t,e,n){return`firebase:${t}:${e}:${n}`}class lm{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=yT(this.userKey,i.apiKey,s),this.fullPersistenceKey=yT("persistence",i.apiKey,s),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await _0(this.auth,{idToken:e}).catch(()=>{});return n?Hc._fromGetAccountInfoResponse(this.auth,n,e):null}return Hc._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new lm(Pl($F),e,r);const i=(await Promise.all(n.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let s=i[0]||Pl($F);const o=yT(r,e.config.apiKey,e.name);let a=null;for(const u of n)try{const d=await u._get(o);if(d){let f;if(typeof d=="string"){const m=await _0(e,{idToken:d}).catch(()=>{});if(!m)break;f=await Hc._fromGetAccountInfoResponse(e,m,d)}else f=Hc._fromJSON(e,d);u!==s&&(a=f),s=u;break}}catch{}const A=i.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!A.length?new lm(s,e,r):(s=A[0],a&&await s._set(o,a.toJSON()),await Promise.all(n.map(async u=>{if(u!==s)try{await u._remove(o)}catch{}})),new lm(s,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZF(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Z9(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(X9(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(tz(e))return"Blackberry";if(nz(e))return"Webos";if(J9(e))return"Safari";if((e.includes("chrome/")||$9(e))&&!e.includes("edge/"))return"Chrome";if(ez(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function X9(t=io()){return/firefox\//i.test(t)}function J9(t=io()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function $9(t=io()){return/crios\//i.test(t)}function Z9(t=io()){return/iemobile/i.test(t)}function ez(t=io()){return/android/i.test(t)}function tz(t=io()){return/blackberry/i.test(t)}function nz(t=io()){return/webos/i.test(t)}function p1(t=io()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function lce(t=io()){var e;return p1(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function uce(){return ese()&&document.documentMode===10}function rz(t=io()){return p1(t)||ez(t)||nz(t)||tz(t)||/windows phone/i.test(t)||Z9(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iz(t,e=[]){let n;switch(t){case"Browser":n=ZF(io());break;case"Worker":n=`${ZF(io())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${xd}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dce{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=s=>new Promise((o,a)=>{try{const A=e(s);o(A)}catch(A){a(A)}});r.onAbort=n,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hce(t,e={}){return Ag(t,"GET","/v2/passwordPolicy",h1(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fce=6;class pce{constructor(e){var n,r,i,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:fce,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,i,s,o,a;const A={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,A),this.validatePasswordCharacterOptions(e,A),A.isValid&&(A.isValid=(n=A.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),A.isValid&&(A.isValid=(r=A.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),A.isValid&&(A.isValid=(i=A.containsLowercaseLetter)!==null&&i!==void 0?i:!0),A.isValid&&(A.isValid=(s=A.containsUppercaseLetter)!==null&&s!==void 0?s:!0),A.isValid&&(A.isValid=(o=A.containsNumericCharacter)!==null&&o!==void 0?o:!0),A.isValid&&(A.isValid=(a=A.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),A}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mce{constructor(e,n,r,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eV(this),this.idTokenSubscription=new eV(this),this.beforeStateQueue=new dce(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=j9,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Pl(n)),this._initializationPromise=this.queue(async()=>{var r,i,s;if(!this._deleted&&(this.persistenceManager=await lm.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await _0(this,{idToken:e}),r=await Hc._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(ec(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=i==null?void 0:i._redirectEventId,A=await this.tryRedirectSignIn(e);(!o||o===a)&&(A!=null&&A.user)&&(i=A.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Dt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await E0(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Xae()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ec(this.app))return Promise.reject(Yh(this));const n=e?pi(e):null;return n&&Dt(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Dt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ec(this.app)?Promise.reject(Yh(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ec(this.app)?Promise.reject(Yh(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Pl(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await hce(this),n=new pce(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ef("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await Ace(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Pl(e)||this._popupRedirectResolver;Dt(n,this,"argument-error"),this.redirectPersistenceManager=await lm.create(this,[Pl(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,i){if(this._deleted)return()=>{};const s=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Dt(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof n=="function"){const A=e.addObserver(n,r,i);return()=>{o=!0,A()}}else{const A=e.addObserver(n);return()=>{o=!0,A()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Dt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=iz(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n}async _getAppCheckToken(){var e;if(ec(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&zae(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function m1(t){return pi(t)}class eV{constructor(e){this.auth=e,this.observer=null,this.addObserver=lse(n=>this.observer=n)}get next(){return Dt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let g1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function gce(t){g1=t}function _ce(t){return g1.loadJS(t)}function Ece(){return g1.gapiScript}function vce(t){return`__${t}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yce(t,e){const n=eu(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),s=n.getOptions();if(Gl(s,e??{}))return i;zl(i,"already-initialized")}return n.initialize({options:e})}function wce(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Pl);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function Cce(t,e,n){const r=m1(t);Dt(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!1,s=sz(e),{host:o,port:a}=Tce(e),A=a===null?"":`:${a}`,u={url:`${s}//${o}${A}/`},d=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Dt(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Dt(Gl(u,r.config.emulator)&&Gl(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=u,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,Sce()}function sz(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Tce(t){const e=sz(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:tV(r.substr(s.length+1))}}else{const[s,o]=r.split(":");return{host:s,port:tV(o)}}}function tV(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Sce(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oz{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Ul("not implemented")}_getIdTokenResponse(e){return Ul("not implemented")}_linkToIdToken(e,n){return Ul("not implemented")}_getReauthenticationResolver(e){return Ul("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function um(t,e){return ece(t,"POST","/v1/accounts:signInWithIdp",h1(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bce="http://localhost";class cf extends oz{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new cf(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):zl("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=n,s=l1(n,["providerId","signInMethod"]);if(!r||!i)return null;const o=new cf(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return um(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,um(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,um(e,n)}buildRequest(){const e={requestUri:bce,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=cg(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class az{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v extends az{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku extends $v{constructor(){super("facebook.com")}static credential(e){return cf._fromParams({providerId:Ku.PROVIDER_ID,signInMethod:Ku.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ku.credentialFromTaggedObject(e)}static credentialFromError(e){return Ku.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ku.credential(e.oauthAccessToken)}catch{return null}}}Ku.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ku.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gu extends $v{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return cf._fromParams({providerId:Gu.PROVIDER_ID,signInMethod:Gu.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Gu.credentialFromTaggedObject(e)}static credentialFromError(e){return Gu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Gu.credential(n,r)}catch{return null}}}Gu.GOOGLE_SIGN_IN_METHOD="google.com";Gu.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wu extends $v{constructor(){super("github.com")}static credential(e){return cf._fromParams({providerId:Wu.PROVIDER_ID,signInMethod:Wu.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Wu.credentialFromTaggedObject(e)}static credentialFromError(e){return Wu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Wu.credential(e.oauthAccessToken)}catch{return null}}}Wu.GITHUB_SIGN_IN_METHOD="github.com";Wu.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zu extends $v{constructor(){super("twitter.com")}static credential(e,n){return cf._fromParams({providerId:zu.PROVIDER_ID,signInMethod:zu.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return zu.credentialFromTaggedObject(e)}static credentialFromError(e){return zu.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return zu.credential(n,r)}catch{return null}}}zu.TWITTER_SIGN_IN_METHOD="twitter.com";zu.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,i=!1){const s=await Hc._fromIdTokenResponse(e,r,i),o=nV(r);return new Om({user:s,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const i=nV(r);return new Om({user:e,providerId:i,_tokenResponse:r,operationType:n})}}function nV(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v0 extends dc{constructor(e,n,r,i){var s;super(n.code,n.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,v0.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,i){return new v0(e,n,r,i)}}function cz(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?v0._fromErrorAndOperation(t,s,e,r):s})}async function Ice(t,e,n=!1){const r=await rv(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Om._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rce(t,e,n=!1){const{auth:r}=t;if(ec(r.app))return Promise.reject(Yh(r));const i="reauthenticate";try{const s=await rv(t,cz(r,i,e,t),n);Dt(s.idToken,r,"internal-error");const o=f1(s.idToken);Dt(o,r,"internal-error");const{sub:a}=o;return Dt(t.uid===a,r,"user-mismatch"),Om._forOperation(t,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&zl(r,"user-mismatch"),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oce(t,e,n=!1){if(ec(t.app))return Promise.reject(Yh(t));const r="signIn",i=await cz(t,r,e),s=await Om._fromIdTokenResponse(t,r,i);return n||await t._updateCurrentUser(s.user),s}function Nce(t,e,n,r){return pi(t).onIdTokenChanged(e,n,r)}function Dce(t,e,n){return pi(t).beforeAuthStateChanged(e,n)}const y0="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Az{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(y0,"1"),this.storage.removeItem(y0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bce=1e3,Lce=10;class lz extends Az{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=rz(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),i=this.localCache[n];r!==i&&e(n,i,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,A)=>{this.notifyListeners(o,A)});return}const r=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);uce()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Lce):i()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},Bce)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}lz.type="LOCAL";const Uce=lz;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uz extends Az{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}uz.type="SESSION";const dz=uz;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pce(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const r=new FS(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:i,data:s}=n.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(async u=>u(n.origin,s)),A=await Pce(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:A})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}FS.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _1(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kce{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,A)=>{const u=_1("",20);i.port1.start();const d=setTimeout(()=>{A(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(f){const m=f;if(m.data.eventId===u)switch(m.data.status){case"ack":clearTimeout(d),s=setTimeout(()=>{A(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(m.data.response);break;default:clearTimeout(d),clearTimeout(s),A(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UA(){return window}function xce(t){UA().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hz(){return typeof UA().WorkerGlobalScope<"u"&&typeof UA().importScripts=="function"}async function Mce(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Fce(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function Vce(){return hz()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fz="firebaseLocalStorageDb",Qce=1,w0="firebaseLocalStorage",pz="fbase_key";class Zv{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function VS(t,e){return t.transaction([w0],e?"readwrite":"readonly").objectStore(w0)}function Hce(){const t=indexedDB.deleteDatabase(fz);return new Zv(t).toPromise()}function RB(){const t=indexedDB.open(fz,Qce);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(w0,{keyPath:pz})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(w0)?e(r):(r.close(),await Hce(),e(await RB()))})})}async function rV(t,e,n){const r=VS(t,!0).put({[pz]:e,value:n});return new Zv(r).toPromise()}async function jce(t,e){const n=VS(t,!1).get(e),r=await new Zv(n).toPromise();return r===void 0?null:r.value}function iV(t,e){const n=VS(t,!0).delete(e);return new Zv(n).toPromise()}const Kce=800,Gce=3;class mz{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await RB(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>Gce)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return hz()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=FS._getInstance(Vce()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await Mce(),!this.activeServiceWorker)return;this.sender=new kce(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Fce()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await RB();return await rV(e,y0,"1"),await iV(e,y0),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>rV(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>jce(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>iV(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=VS(i,!1).getAll();return new Zv(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Kce)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}mz.type="LOCAL";const Wce=mz;new Jv(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zce(t,e){return e?Pl(e):(Dt(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E1 extends oz{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return um(e,this._buildIdpRequest())}_linkToIdToken(e,n){return um(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return um(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function qce(t){return Oce(t.auth,new E1(t),t.bypassAuthState)}function Yce(t){const{auth:e,user:n}=t;return Dt(n,e,"internal-error"),Rce(n,new E1(t),t.bypassAuthState)}async function Xce(t){const{auth:e,user:n}=t;return Dt(n,e,"internal-error"),Ice(n,new E1(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gz{constructor(e,n,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const A={auth:this.auth,requestUri:n,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(A))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return qce;case"linkViaPopup":case"linkViaRedirect":return Xce;case"reauthViaPopup":case"reauthViaRedirect":return Yce;default:zl(this.auth,"internal-error")}}resolve(e){ql(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ql(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jce=new Jv(2e3,1e4);class Yp extends gz{constructor(e,n,r,i,s){super(e,n,i,s),this.provider=r,this.authWindow=null,this.pollId=null,Yp.currentPopupAction&&Yp.currentPopupAction.cancel(),Yp.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Dt(e,this.auth,"internal-error"),e}async onExecution(){ql(this.filter.length===1,"Popup operations only handle one event");const e=_1();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(LA(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(LA(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Yp.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(LA(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Jce.get())};e()}}Yp.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $ce="pendingRedirect",wT=new Map;class Zce extends gz{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=wT.get(this.auth._key());if(!e){try{const r=await eAe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}wT.set(this.auth._key(),e)}return this.bypassAuthState||wT.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function eAe(t,e){const n=rAe(e),r=nAe(t);if(!await r._isAvailable())return!1;const i=await r._get(n)==="true";return await r._remove(n),i}function tAe(t,e){wT.set(t._key(),e)}function nAe(t){return Pl(t._redirectPersistence)}function rAe(t){return yT($ce,t.config.apiKey,t.name)}async function iAe(t,e,n=!1){if(ec(t.app))return Promise.reject(Yh(t));const r=m1(t),i=zce(r,e),o=await new Zce(r,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sAe=10*60*1e3;class oAe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!aAe(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!_z(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(LA(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=sAe&&this.cachedEventUids.clear(),this.cachedEventUids.has(sV(e))}saveEventToCache(e){this.cachedEventUids.add(sV(e)),this.lastProcessedEventTime=Date.now()}}function sV(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function _z({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function aAe(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _z(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cAe(t,e={}){return Ag(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AAe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,lAe=/^https?/;async function uAe(t){if(t.config.emulator)return;const{authorizedDomains:e}=await cAe(t);for(const n of e)try{if(dAe(n))return}catch{}zl(t,"unauthorized-domain")}function dAe(t){const e=bB(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!lAe.test(n))return!1;if(AAe.test(t))return r===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hAe=new Jv(3e4,6e4);function oV(){const t=UA().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function fAe(t){return new Promise((e,n)=>{var r,i,s;function o(){oV(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{oV(),n(LA(t,"network-request-failed"))},timeout:hAe.get()})}if(!((i=(r=UA().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=UA().gapi)===null||s===void 0)&&s.load)o();else{const a=vce("iframefcb");return UA()[a]=()=>{gapi.load?o():n(LA(t,"network-request-failed"))},_ce(`${Ece()}?onload=${a}`).catch(A=>n(A))}}).catch(e=>{throw CT=null,e})}let CT=null;function pAe(t){return CT=CT||fAe(t),CT}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mAe=new Jv(5e3,15e3),gAe="__/auth/iframe",_Ae="emulator/auth/iframe",EAe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vAe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function yAe(t){const e=t.config;Dt(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?d1(e,_Ae):`https://${t.config.authDomain}/${gAe}`,r={apiKey:e.apiKey,appName:t.name,v:xd},i=vAe.get(t.config.apiHost);i&&(r.eid=i);const s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${cg(r).slice(1)}`}async function wAe(t){const e=await pAe(t),n=UA().gapi;return Dt(n,t,"internal-error"),e.open({where:document.body,url:yAe(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:EAe,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const o=LA(t,"network-request-failed"),a=UA().setTimeout(()=>{s(o)},mAe.get());function A(){UA().clearTimeout(a),i(r)}r.ping(A).then(A,()=>{s(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CAe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},TAe=500,SAe=600,bAe="_blank",IAe="http://localhost";class aV{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function RAe(t,e,n,r=TAe,i=SAe){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const A=Object.assign(Object.assign({},CAe),{width:r.toString(),height:i.toString(),top:s,left:o}),u=io().toLowerCase();n&&(a=$9(u)?bAe:n),X9(u)&&(e=e||IAe,A.scrollbars="yes");const d=Object.entries(A).reduce((m,[g,v])=>`${m}${g}=${v},`,"");if(lce(u)&&a!=="_self")return OAe(e||"",a),new aV(null);const f=window.open(e||"",a,d);Dt(f,t,"popup-blocked");try{f.focus()}catch{}return new aV(f)}function OAe(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NAe="__/auth/handler",DAe="emulator/auth/handler",BAe=encodeURIComponent("fac");async function cV(t,e,n,r,i,s){Dt(t.config.authDomain,t,"auth-domain-config-required"),Dt(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:xd,eventId:i};if(e instanceof az){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",EB(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,f]of Object.entries({}))o[d]=f}if(e instanceof $v){const d=e.getScopes().filter(f=>f!=="");d.length>0&&(o.scopes=d.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const d of Object.keys(a))a[d]===void 0&&delete a[d];const A=await t._getAppCheckToken(),u=A?`#${BAe}=${encodeURIComponent(A)}`:"";return`${LAe(t)}?${cg(a).slice(1)}${u}`}function LAe({config:t}){return t.emulator?d1(t,DAe):`https://${t.authDomain}/${NAe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lO="webStorageSupport";class UAe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dz,this._completeRedirectFn=iAe,this._overrideRedirectResult=tAe}async _openPopup(e,n,r,i){var s;ql((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await cV(e,n,r,bB(),i);return RAe(e,o,_1())}async _openRedirect(e,n,r,i){await this._originValidation(e);const s=await cV(e,n,r,bB(),i);return xce(s),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:s}=this.eventManagers[n];return i?Promise.resolve(i):(ql(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await wAe(e),r=new oAe(e);return n.register("authEvent",i=>(Dt(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(lO,{type:lO},i=>{var s;const o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[lO];o!==void 0&&n(!!o),zl(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=uAe(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return rz()||J9()||p1()}}const PAe=UAe;var AV="@firebase/auth",lV="1.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kAe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Dt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xAe(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function MAe(t){lc(new Ta("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Dt(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const A={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:iz(t)},u=new mce(r,i,s,A);return wce(u,n),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),lc(new Ta("auth-internal",e=>{const n=m1(e.getProvider("auth").getImmediate());return(r=>new kAe(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ro(AV,lV,xAe(t)),ro(AV,lV,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FAe=5*60,VAe=c9("authIdTokenMaxAge")||FAe;let uV=null;const QAe=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>VAe)return;const i=n==null?void 0:n.token;uV!==i&&(uV=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function HAe(t=Xv()){const e=eu(t,"auth");if(e.isInitialized())return e.getImmediate();const n=yce(t,{popupRedirectResolver:PAe,persistence:[Wce,Uce,dz]}),r=c9("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const s=new URL(r,location.origin);if(location.origin===s.origin){const o=QAe(s.toString());Dce(n,o,()=>o(n.currentUser)),Nce(n,a=>o(a))}}const i=o9("auth");return i&&Cce(n,`http://${i}`),n}function jAe(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}gce({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=i=>{const s=LA("internal-error");s.customData=i,n(s)},r.type="text/javascript",r.charset="UTF-8",jAe().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});MAe("Browser");var dV=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var dd,Ez;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(Q,F){function k(){}k.prototype=F.prototype,Q.D=F.prototype,Q.prototype=new k,Q.prototype.constructor=Q,Q.C=function(G,$,ne){for(var q=Array(arguments.length-2),qe=2;qe<arguments.length;qe++)q[qe-2]=arguments[qe];return F.prototype[$].apply(G,q)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(Q,F,k){k||(k=0);var G=Array(16);if(typeof F=="string")for(var $=0;16>$;++$)G[$]=F.charCodeAt(k++)|F.charCodeAt(k++)<<8|F.charCodeAt(k++)<<16|F.charCodeAt(k++)<<24;else for($=0;16>$;++$)G[$]=F[k++]|F[k++]<<8|F[k++]<<16|F[k++]<<24;F=Q.g[0],k=Q.g[1],$=Q.g[2];var ne=Q.g[3],q=F+(ne^k&($^ne))+G[0]+3614090360&4294967295;F=k+(q<<7&4294967295|q>>>25),q=ne+($^F&(k^$))+G[1]+3905402710&4294967295,ne=F+(q<<12&4294967295|q>>>20),q=$+(k^ne&(F^k))+G[2]+606105819&4294967295,$=ne+(q<<17&4294967295|q>>>15),q=k+(F^$&(ne^F))+G[3]+3250441966&4294967295,k=$+(q<<22&4294967295|q>>>10),q=F+(ne^k&($^ne))+G[4]+4118548399&4294967295,F=k+(q<<7&4294967295|q>>>25),q=ne+($^F&(k^$))+G[5]+1200080426&4294967295,ne=F+(q<<12&4294967295|q>>>20),q=$+(k^ne&(F^k))+G[6]+2821735955&4294967295,$=ne+(q<<17&4294967295|q>>>15),q=k+(F^$&(ne^F))+G[7]+4249261313&4294967295,k=$+(q<<22&4294967295|q>>>10),q=F+(ne^k&($^ne))+G[8]+1770035416&4294967295,F=k+(q<<7&4294967295|q>>>25),q=ne+($^F&(k^$))+G[9]+2336552879&4294967295,ne=F+(q<<12&4294967295|q>>>20),q=$+(k^ne&(F^k))+G[10]+4294925233&4294967295,$=ne+(q<<17&4294967295|q>>>15),q=k+(F^$&(ne^F))+G[11]+2304563134&4294967295,k=$+(q<<22&4294967295|q>>>10),q=F+(ne^k&($^ne))+G[12]+1804603682&4294967295,F=k+(q<<7&4294967295|q>>>25),q=ne+($^F&(k^$))+G[13]+4254626195&4294967295,ne=F+(q<<12&4294967295|q>>>20),q=$+(k^ne&(F^k))+G[14]+2792965006&4294967295,$=ne+(q<<17&4294967295|q>>>15),q=k+(F^$&(ne^F))+G[15]+1236535329&4294967295,k=$+(q<<22&4294967295|q>>>10),q=F+($^ne&(k^$))+G[1]+4129170786&4294967295,F=k+(q<<5&4294967295|q>>>27),q=ne+(k^$&(F^k))+G[6]+3225465664&4294967295,ne=F+(q<<9&4294967295|q>>>23),q=$+(F^k&(ne^F))+G[11]+643717713&4294967295,$=ne+(q<<14&4294967295|q>>>18),q=k+(ne^F&($^ne))+G[0]+3921069994&4294967295,k=$+(q<<20&4294967295|q>>>12),q=F+($^ne&(k^$))+G[5]+3593408605&4294967295,F=k+(q<<5&4294967295|q>>>27),q=ne+(k^$&(F^k))+G[10]+38016083&4294967295,ne=F+(q<<9&4294967295|q>>>23),q=$+(F^k&(ne^F))+G[15]+3634488961&4294967295,$=ne+(q<<14&4294967295|q>>>18),q=k+(ne^F&($^ne))+G[4]+3889429448&4294967295,k=$+(q<<20&4294967295|q>>>12),q=F+($^ne&(k^$))+G[9]+568446438&4294967295,F=k+(q<<5&4294967295|q>>>27),q=ne+(k^$&(F^k))+G[14]+3275163606&4294967295,ne=F+(q<<9&4294967295|q>>>23),q=$+(F^k&(ne^F))+G[3]+4107603335&4294967295,$=ne+(q<<14&4294967295|q>>>18),q=k+(ne^F&($^ne))+G[8]+1163531501&4294967295,k=$+(q<<20&4294967295|q>>>12),q=F+($^ne&(k^$))+G[13]+2850285829&4294967295,F=k+(q<<5&4294967295|q>>>27),q=ne+(k^$&(F^k))+G[2]+4243563512&4294967295,ne=F+(q<<9&4294967295|q>>>23),q=$+(F^k&(ne^F))+G[7]+1735328473&4294967295,$=ne+(q<<14&4294967295|q>>>18),q=k+(ne^F&($^ne))+G[12]+2368359562&4294967295,k=$+(q<<20&4294967295|q>>>12),q=F+(k^$^ne)+G[5]+4294588738&4294967295,F=k+(q<<4&4294967295|q>>>28),q=ne+(F^k^$)+G[8]+2272392833&4294967295,ne=F+(q<<11&4294967295|q>>>21),q=$+(ne^F^k)+G[11]+1839030562&4294967295,$=ne+(q<<16&4294967295|q>>>16),q=k+($^ne^F)+G[14]+4259657740&4294967295,k=$+(q<<23&4294967295|q>>>9),q=F+(k^$^ne)+G[1]+2763975236&4294967295,F=k+(q<<4&4294967295|q>>>28),q=ne+(F^k^$)+G[4]+1272893353&4294967295,ne=F+(q<<11&4294967295|q>>>21),q=$+(ne^F^k)+G[7]+4139469664&4294967295,$=ne+(q<<16&4294967295|q>>>16),q=k+($^ne^F)+G[10]+3200236656&4294967295,k=$+(q<<23&4294967295|q>>>9),q=F+(k^$^ne)+G[13]+681279174&4294967295,F=k+(q<<4&4294967295|q>>>28),q=ne+(F^k^$)+G[0]+3936430074&4294967295,ne=F+(q<<11&4294967295|q>>>21),q=$+(ne^F^k)+G[3]+3572445317&4294967295,$=ne+(q<<16&4294967295|q>>>16),q=k+($^ne^F)+G[6]+76029189&4294967295,k=$+(q<<23&4294967295|q>>>9),q=F+(k^$^ne)+G[9]+3654602809&4294967295,F=k+(q<<4&4294967295|q>>>28),q=ne+(F^k^$)+G[12]+3873151461&4294967295,ne=F+(q<<11&4294967295|q>>>21),q=$+(ne^F^k)+G[15]+530742520&4294967295,$=ne+(q<<16&4294967295|q>>>16),q=k+($^ne^F)+G[2]+3299628645&4294967295,k=$+(q<<23&4294967295|q>>>9),q=F+($^(k|~ne))+G[0]+4096336452&4294967295,F=k+(q<<6&4294967295|q>>>26),q=ne+(k^(F|~$))+G[7]+1126891415&4294967295,ne=F+(q<<10&4294967295|q>>>22),q=$+(F^(ne|~k))+G[14]+2878612391&4294967295,$=ne+(q<<15&4294967295|q>>>17),q=k+(ne^($|~F))+G[5]+4237533241&4294967295,k=$+(q<<21&4294967295|q>>>11),q=F+($^(k|~ne))+G[12]+1700485571&4294967295,F=k+(q<<6&4294967295|q>>>26),q=ne+(k^(F|~$))+G[3]+2399980690&4294967295,ne=F+(q<<10&4294967295|q>>>22),q=$+(F^(ne|~k))+G[10]+4293915773&4294967295,$=ne+(q<<15&4294967295|q>>>17),q=k+(ne^($|~F))+G[1]+2240044497&4294967295,k=$+(q<<21&4294967295|q>>>11),q=F+($^(k|~ne))+G[8]+1873313359&4294967295,F=k+(q<<6&4294967295|q>>>26),q=ne+(k^(F|~$))+G[15]+4264355552&4294967295,ne=F+(q<<10&4294967295|q>>>22),q=$+(F^(ne|~k))+G[6]+2734768916&4294967295,$=ne+(q<<15&4294967295|q>>>17),q=k+(ne^($|~F))+G[13]+1309151649&4294967295,k=$+(q<<21&4294967295|q>>>11),q=F+($^(k|~ne))+G[4]+4149444226&4294967295,F=k+(q<<6&4294967295|q>>>26),q=ne+(k^(F|~$))+G[11]+3174756917&4294967295,ne=F+(q<<10&4294967295|q>>>22),q=$+(F^(ne|~k))+G[2]+718787259&4294967295,$=ne+(q<<15&4294967295|q>>>17),q=k+(ne^($|~F))+G[9]+3951481745&4294967295,Q.g[0]=Q.g[0]+F&4294967295,Q.g[1]=Q.g[1]+($+(q<<21&4294967295|q>>>11))&4294967295,Q.g[2]=Q.g[2]+$&4294967295,Q.g[3]=Q.g[3]+ne&4294967295}r.prototype.u=function(Q,F){F===void 0&&(F=Q.length);for(var k=F-this.blockSize,G=this.B,$=this.h,ne=0;ne<F;){if($==0)for(;ne<=k;)i(this,Q,ne),ne+=this.blockSize;if(typeof Q=="string"){for(;ne<F;)if(G[$++]=Q.charCodeAt(ne++),$==this.blockSize){i(this,G),$=0;break}}else for(;ne<F;)if(G[$++]=Q[ne++],$==this.blockSize){i(this,G),$=0;break}}this.h=$,this.o+=F},r.prototype.v=function(){var Q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Q[0]=128;for(var F=1;F<Q.length-8;++F)Q[F]=0;var k=8*this.o;for(F=Q.length-8;F<Q.length;++F)Q[F]=k&255,k/=256;for(this.u(Q),Q=Array(16),F=k=0;4>F;++F)for(var G=0;32>G;G+=8)Q[k++]=this.g[F]>>>G&255;return Q};function s(Q,F){var k=a;return Object.prototype.hasOwnProperty.call(k,Q)?k[Q]:k[Q]=F(Q)}function o(Q,F){this.h=F;for(var k=[],G=!0,$=Q.length-1;0<=$;$--){var ne=Q[$]|0;G&&ne==F||(k[$]=ne,G=!1)}this.g=k}var a={};function A(Q){return-128<=Q&&128>Q?s(Q,function(F){return new o([F|0],0>F?-1:0)}):new o([Q|0],0>Q?-1:0)}function u(Q){if(isNaN(Q)||!isFinite(Q))return f;if(0>Q)return w(u(-Q));for(var F=[],k=1,G=0;Q>=k;G++)F[G]=Q/k|0,k*=4294967296;return new o(F,0)}function d(Q,F){if(Q.length==0)throw Error("number format error: empty string");if(F=F||10,2>F||36<F)throw Error("radix out of range: "+F);if(Q.charAt(0)=="-")return w(d(Q.substring(1),F));if(0<=Q.indexOf("-"))throw Error('number format error: interior "-" character');for(var k=u(Math.pow(F,8)),G=f,$=0;$<Q.length;$+=8){var ne=Math.min(8,Q.length-$),q=parseInt(Q.substring($,$+ne),F);8>ne?(ne=u(Math.pow(F,ne)),G=G.j(ne).add(u(q))):(G=G.j(k),G=G.add(u(q)))}return G}var f=A(0),m=A(1),g=A(16777216);t=o.prototype,t.m=function(){if(y(this))return-w(this).m();for(var Q=0,F=1,k=0;k<this.g.length;k++){var G=this.i(k);Q+=(0<=G?G:4294967296+G)*F,F*=4294967296}return Q},t.toString=function(Q){if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(v(this))return"0";if(y(this))return"-"+w(this).toString(Q);for(var F=u(Math.pow(Q,6)),k=this,G="";;){var $=M(k,F).g;k=b(k,$.j(F));var ne=((0<k.g.length?k.g[0]:k.h)>>>0).toString(Q);if(k=$,v(k))return ne+G;for(;6>ne.length;)ne="0"+ne;G=ne+G}},t.i=function(Q){return 0>Q?0:Q<this.g.length?this.g[Q]:this.h};function v(Q){if(Q.h!=0)return!1;for(var F=0;F<Q.g.length;F++)if(Q.g[F]!=0)return!1;return!0}function y(Q){return Q.h==-1}t.l=function(Q){return Q=b(this,Q),y(Q)?-1:v(Q)?0:1};function w(Q){for(var F=Q.g.length,k=[],G=0;G<F;G++)k[G]=~Q.g[G];return new o(k,~Q.h).add(m)}t.abs=function(){return y(this)?w(this):this},t.add=function(Q){for(var F=Math.max(this.g.length,Q.g.length),k=[],G=0,$=0;$<=F;$++){var ne=G+(this.i($)&65535)+(Q.i($)&65535),q=(ne>>>16)+(this.i($)>>>16)+(Q.i($)>>>16);G=q>>>16,ne&=65535,q&=65535,k[$]=q<<16|ne}return new o(k,k[k.length-1]&-2147483648?-1:0)};function b(Q,F){return Q.add(w(F))}t.j=function(Q){if(v(this)||v(Q))return f;if(y(this))return y(Q)?w(this).j(w(Q)):w(w(this).j(Q));if(y(Q))return w(this.j(w(Q)));if(0>this.l(g)&&0>Q.l(g))return u(this.m()*Q.m());for(var F=this.g.length+Q.g.length,k=[],G=0;G<2*F;G++)k[G]=0;for(G=0;G<this.g.length;G++)for(var $=0;$<Q.g.length;$++){var ne=this.i(G)>>>16,q=this.i(G)&65535,qe=Q.i($)>>>16,je=Q.i($)&65535;k[2*G+2*$]+=q*je,I(k,2*G+2*$),k[2*G+2*$+1]+=ne*je,I(k,2*G+2*$+1),k[2*G+2*$+1]+=q*qe,I(k,2*G+2*$+1),k[2*G+2*$+2]+=ne*qe,I(k,2*G+2*$+2)}for(G=0;G<F;G++)k[G]=k[2*G+1]<<16|k[2*G];for(G=F;G<2*F;G++)k[G]=0;return new o(k,0)};function I(Q,F){for(;(Q[F]&65535)!=Q[F];)Q[F+1]+=Q[F]>>>16,Q[F]&=65535,F++}function B(Q,F){this.g=Q,this.h=F}function M(Q,F){if(v(F))throw Error("division by zero");if(v(Q))return new B(f,f);if(y(Q))return F=M(w(Q),F),new B(w(F.g),w(F.h));if(y(F))return F=M(Q,w(F)),new B(w(F.g),F.h);if(30<Q.g.length){if(y(Q)||y(F))throw Error("slowDivide_ only works with positive integers.");for(var k=m,G=F;0>=G.l(Q);)k=H(k),G=H(G);var $=K(k,1),ne=K(G,1);for(G=K(G,2),k=K(k,2);!v(G);){var q=ne.add(G);0>=q.l(Q)&&($=$.add(k),ne=q),G=K(G,1),k=K(k,1)}return F=b(Q,$.j(F)),new B($,F)}for($=f;0<=Q.l(F);){for(k=Math.max(1,Math.floor(Q.m()/F.m())),G=Math.ceil(Math.log(k)/Math.LN2),G=48>=G?1:Math.pow(2,G-48),ne=u(k),q=ne.j(F);y(q)||0<q.l(Q);)k-=G,ne=u(k),q=ne.j(F);v(ne)&&(ne=m),$=$.add(ne),Q=b(Q,q)}return new B($,Q)}t.A=function(Q){return M(this,Q).h},t.and=function(Q){for(var F=Math.max(this.g.length,Q.g.length),k=[],G=0;G<F;G++)k[G]=this.i(G)&Q.i(G);return new o(k,this.h&Q.h)},t.or=function(Q){for(var F=Math.max(this.g.length,Q.g.length),k=[],G=0;G<F;G++)k[G]=this.i(G)|Q.i(G);return new o(k,this.h|Q.h)},t.xor=function(Q){for(var F=Math.max(this.g.length,Q.g.length),k=[],G=0;G<F;G++)k[G]=this.i(G)^Q.i(G);return new o(k,this.h^Q.h)};function H(Q){for(var F=Q.g.length+1,k=[],G=0;G<F;G++)k[G]=Q.i(G)<<1|Q.i(G-1)>>>31;return new o(k,Q.h)}function K(Q,F){var k=F>>5;F%=32;for(var G=Q.g.length-k,$=[],ne=0;ne<G;ne++)$[ne]=0<F?Q.i(ne+k)>>>F|Q.i(ne+k+1)<<32-F:Q.i(ne+k);return new o($,Q.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Ez=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,dd=o}).apply(typeof dV<"u"?dV:typeof self<"u"?self:typeof window<"u"?window:{});var jw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var vz,eE,yz,TT,OB,wz,Cz,Tz;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(_,O,x){return _==Array.prototype||_==Object.prototype||(_[O]=x.value),_};function n(_){_=[typeof globalThis=="object"&&globalThis,_,typeof window=="object"&&window,typeof self=="object"&&self,typeof jw=="object"&&jw];for(var O=0;O<_.length;++O){var x=_[O];if(x&&x.Math==Math)return x}throw Error("Cannot find global object")}var r=n(this);function i(_,O){if(O)e:{var x=r;_=_.split(".");for(var z=0;z<_.length-1;z++){var le=_[z];if(!(le in x))break e;x=x[le]}_=_[_.length-1],z=x[_],O=O(z),O!=z&&O!=null&&e(x,_,{configurable:!0,writable:!0,value:O})}}function s(_,O){_ instanceof String&&(_+="");var x=0,z=!1,le={next:function(){if(!z&&x<_.length){var _e=x++;return{value:O(_e,_[_e]),done:!1}}return z=!0,{done:!0,value:void 0}}};return le[Symbol.iterator]=function(){return le},le}i("Array.prototype.values",function(_){return _||function(){return s(this,function(O,x){return x})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},a=this||self;function A(_){var O=typeof _;return O=O!="object"?O:_?Array.isArray(_)?"array":O:"null",O=="array"||O=="object"&&typeof _.length=="number"}function u(_){var O=typeof _;return O=="object"&&_!=null||O=="function"}function d(_,O,x){return _.call.apply(_.bind,arguments)}function f(_,O,x){if(!_)throw Error();if(2<arguments.length){var z=Array.prototype.slice.call(arguments,2);return function(){var le=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(le,z),_.apply(O,le)}}return function(){return _.apply(O,arguments)}}function m(_,O,x){return m=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:f,m.apply(null,arguments)}function g(_,O){var x=Array.prototype.slice.call(arguments,1);return function(){var z=x.slice();return z.push.apply(z,arguments),_.apply(this,z)}}function v(_,O){function x(){}x.prototype=O.prototype,_.aa=O.prototype,_.prototype=new x,_.prototype.constructor=_,_.Qb=function(z,le,_e){for(var Fe=Array(arguments.length-2),wn=2;wn<arguments.length;wn++)Fe[wn-2]=arguments[wn];return O.prototype[le].apply(z,Fe)}}function y(_){const O=_.length;if(0<O){const x=Array(O);for(let z=0;z<O;z++)x[z]=_[z];return x}return[]}function w(_,O){for(let x=1;x<arguments.length;x++){const z=arguments[x];if(A(z)){const le=_.length||0,_e=z.length||0;_.length=le+_e;for(let Fe=0;Fe<_e;Fe++)_[le+Fe]=z[Fe]}else _.push(z)}}class b{constructor(O,x){this.i=O,this.j=x,this.h=0,this.g=null}get(){let O;return 0<this.h?(this.h--,O=this.g,this.g=O.next,O.next=null):O=this.i(),O}}function I(_){return/^[\s\xa0]*$/.test(_)}function B(){var _=a.navigator;return _&&(_=_.userAgent)?_:""}function M(_){return M[" "](_),_}M[" "]=function(){};var H=B().indexOf("Gecko")!=-1&&!(B().toLowerCase().indexOf("webkit")!=-1&&B().indexOf("Edge")==-1)&&!(B().indexOf("Trident")!=-1||B().indexOf("MSIE")!=-1)&&B().indexOf("Edge")==-1;function K(_,O,x){for(const z in _)O.call(x,_[z],z,_)}function Q(_,O){for(const x in _)O.call(void 0,_[x],x,_)}function F(_){const O={};for(const x in _)O[x]=_[x];return O}const k="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function G(_,O){let x,z;for(let le=1;le<arguments.length;le++){z=arguments[le];for(x in z)_[x]=z[x];for(let _e=0;_e<k.length;_e++)x=k[_e],Object.prototype.hasOwnProperty.call(z,x)&&(_[x]=z[x])}}function $(_){var O=1;_=_.split(":");const x=[];for(;0<O&&_.length;)x.push(_.shift()),O--;return _.length&&x.push(_.join(":")),x}function ne(_){a.setTimeout(()=>{throw _},0)}function q(){var _=Z;let O=null;return _.g&&(O=_.g,_.g=_.g.next,_.g||(_.h=null),O.next=null),O}class qe{constructor(){this.h=this.g=null}add(O,x){const z=je.get();z.set(O,x),this.h?this.h.next=z:this.g=z,this.h=z}}var je=new b(()=>new de,_=>_.reset());class de{constructor(){this.next=this.g=this.h=null}set(O,x){this.h=O,this.g=x,this.next=null}reset(){this.next=this.g=this.h=null}}let J,Y=!1,Z=new qe,P=()=>{const _=a.Promise.resolve(void 0);J=()=>{_.then(C)}};var C=()=>{for(var _;_=q();){try{_.h.call(_.g)}catch(x){ne(x)}var O=je;O.j(_),100>O.h&&(O.h++,_.next=O.g,O.g=_)}Y=!1};function D(){this.s=this.s,this.C=this.C}D.prototype.s=!1,D.prototype.ma=function(){this.s||(this.s=!0,this.N())},D.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function U(_,O){this.type=_,this.g=this.target=O,this.defaultPrevented=!1}U.prototype.h=function(){this.defaultPrevented=!0};var ee=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var _=!1,O=Object.defineProperty({},"passive",{get:function(){_=!0}});try{const x=()=>{};a.addEventListener("test",x,O),a.removeEventListener("test",x,O)}catch{}return _}();function Ee(_,O){if(U.call(this,_?_.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,_){var x=this.type=_.type,z=_.changedTouches&&_.changedTouches.length?_.changedTouches[0]:null;if(this.target=_.target||_.srcElement,this.g=O,O=_.relatedTarget){if(H){e:{try{M(O.nodeName);var le=!0;break e}catch{}le=!1}le||(O=null)}}else x=="mouseover"?O=_.fromElement:x=="mouseout"&&(O=_.toElement);this.relatedTarget=O,z?(this.clientX=z.clientX!==void 0?z.clientX:z.pageX,this.clientY=z.clientY!==void 0?z.clientY:z.pageY,this.screenX=z.screenX||0,this.screenY=z.screenY||0):(this.clientX=_.clientX!==void 0?_.clientX:_.pageX,this.clientY=_.clientY!==void 0?_.clientY:_.pageY,this.screenX=_.screenX||0,this.screenY=_.screenY||0),this.button=_.button,this.key=_.key||"",this.ctrlKey=_.ctrlKey,this.altKey=_.altKey,this.shiftKey=_.shiftKey,this.metaKey=_.metaKey,this.pointerId=_.pointerId||0,this.pointerType=typeof _.pointerType=="string"?_.pointerType:Re[_.pointerType]||"",this.state=_.state,this.i=_,_.defaultPrevented&&Ee.aa.h.call(this)}}v(Ee,U);var Re={2:"touch",3:"pen",4:"mouse"};Ee.prototype.h=function(){Ee.aa.h.call(this);var _=this.i;_.preventDefault?_.preventDefault():_.returnValue=!1};var lt="closure_listenable_"+(1e6*Math.random()|0),St=0;function Tr(_,O,x,z,le){this.listener=_,this.proxy=null,this.src=O,this.type=x,this.capture=!!z,this.ha=le,this.key=++St,this.da=this.fa=!1}function cs(_){_.da=!0,_.listener=null,_.proxy=null,_.src=null,_.ha=null}function As(_){this.src=_,this.g={},this.h=0}As.prototype.add=function(_,O,x,z,le){var _e=_.toString();_=this.g[_e],_||(_=this.g[_e]=[],this.h++);var Fe=xi(_,O,z,le);return-1<Fe?(O=_[Fe],x||(O.fa=!1)):(O=new Tr(O,this.src,_e,!!z,le),O.fa=x,_.push(O)),O};function gr(_,O){var x=O.type;if(x in _.g){var z=_.g[x],le=Array.prototype.indexOf.call(z,O,void 0),_e;(_e=0<=le)&&Array.prototype.splice.call(z,le,1),_e&&(cs(O),_.g[x].length==0&&(delete _.g[x],_.h--))}}function xi(_,O,x,z){for(var le=0;le<_.length;++le){var _e=_[le];if(!_e.da&&_e.listener==O&&_e.capture==!!x&&_e.ha==z)return le}return-1}var vi="closure_lm_"+(1e6*Math.random()|0),Jt={};function Xt(_,O,x,z,le){if(Array.isArray(O)){for(var _e=0;_e<O.length;_e++)Xt(_,O[_e],x,z,le);return null}return x=Ks(x),_&&_[lt]?_.K(O,x,u(z)?!!z.capture:!1,le):dt(_,O,x,!1,z,le)}function dt(_,O,x,z,le,_e){if(!O)throw Error("Invalid event type");var Fe=u(le)?!!le.capture:!!le,wn=br(_);if(wn||(_[vi]=wn=new As(_)),x=wn.add(O,x,z,Fe,_e),x.proxy)return x;if(z=Ar(),x.proxy=z,z.src=_,z.listener=x,_.addEventListener)ee||(le=Fe),le===void 0&&(le=!1),_.addEventListener(O.toString(),z,le);else if(_.attachEvent)_.attachEvent(st(O.toString()),z);else if(_.addListener&&_.removeListener)_.addListener(z);else throw Error("addEventListener and attachEvent are unavailable.");return x}function Ar(){function _(x){return O.call(_.src,_.listener,x)}const O=Sr;return _}function yi(_,O,x,z,le){if(Array.isArray(O))for(var _e=0;_e<O.length;_e++)yi(_,O[_e],x,z,le);else z=u(z)?!!z.capture:!!z,x=Ks(x),_&&_[lt]?(_=_.i,O=String(O).toString(),O in _.g&&(_e=_.g[O],x=xi(_e,x,z,le),-1<x&&(cs(_e[x]),Array.prototype.splice.call(_e,x,1),_e.length==0&&(delete _.g[O],_.h--)))):_&&(_=br(_))&&(O=_.g[O.toString()],_=-1,O&&(_=xi(O,x,z,le)),(x=-1<_?O[_]:null)&&Pt(x))}function Pt(_){if(typeof _!="number"&&_&&!_.da){var O=_.src;if(O&&O[lt])gr(O.i,_);else{var x=_.type,z=_.proxy;O.removeEventListener?O.removeEventListener(x,z,_.capture):O.detachEvent?O.detachEvent(st(x),z):O.addListener&&O.removeListener&&O.removeListener(z),(x=br(O))?(gr(x,_),x.h==0&&(x.src=null,O[vi]=null)):cs(_)}}}function st(_){return _ in Jt?Jt[_]:Jt[_]="on"+_}function Sr(_,O){if(_.da)_=!0;else{O=new Ee(O,this);var x=_.listener,z=_.ha||_.src;_.fa&&Pt(_),_=x.call(z,O)}return _}function br(_){return _=_[vi],_ instanceof As?_:null}var ei="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ks(_){return typeof _=="function"?_:(_[ei]||(_[ei]=function(O){return _.handleEvent(O)}),_[ei])}function qn(){D.call(this),this.i=new As(this),this.M=this,this.F=null}v(qn,D),qn.prototype[lt]=!0,qn.prototype.removeEventListener=function(_,O,x,z){yi(this,_,O,x,z)};function yn(_,O){var x,z=_.F;if(z)for(x=[];z;z=z.F)x.push(z);if(_=_.M,z=O.type||O,typeof O=="string")O=new U(O,_);else if(O instanceof U)O.target=O.target||_;else{var le=O;O=new U(z,_),G(O,le)}if(le=!0,x)for(var _e=x.length-1;0<=_e;_e--){var Fe=O.g=x[_e];le=Rs(Fe,z,!0,O)&&le}if(Fe=O.g=_,le=Rs(Fe,z,!0,O)&&le,le=Rs(Fe,z,!1,O)&&le,x)for(_e=0;_e<x.length;_e++)Fe=O.g=x[_e],le=Rs(Fe,z,!1,O)&&le}qn.prototype.N=function(){if(qn.aa.N.call(this),this.i){var _=this.i,O;for(O in _.g){for(var x=_.g[O],z=0;z<x.length;z++)cs(x[z]);delete _.g[O],_.h--}}this.F=null},qn.prototype.K=function(_,O,x,z){return this.i.add(String(_),O,!1,x,z)},qn.prototype.L=function(_,O,x,z){return this.i.add(String(_),O,!0,x,z)};function Rs(_,O,x,z){if(O=_.i.g[String(O)],!O)return!0;O=O.concat();for(var le=!0,_e=0;_e<O.length;++_e){var Fe=O[_e];if(Fe&&!Fe.da&&Fe.capture==x){var wn=Fe.listener,Yi=Fe.ha||Fe.src;Fe.fa&&gr(_.i,Fe),le=wn.call(Yi,z)!==!1&&le}}return le&&!z.defaultPrevented}function wi(_,O,x){if(typeof _=="function")x&&(_=m(_,x));else if(_&&typeof _.handleEvent=="function")_=m(_.handleEvent,_);else throw Error("Invalid listener argument");return 2147483647<Number(O)?-1:a.setTimeout(_,O||0)}function Ia(_){_.g=wi(()=>{_.g=null,_.i&&(_.i=!1,Ia(_))},_.l);const O=_.h;_.h=null,_.m.apply(null,O)}class Rf extends D{constructor(O,x){super(),this.m=O,this.l=x,this.h=null,this.i=!1,this.g=null}j(O){this.h=arguments,this.g?this.i=!0:Ia(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eA(_){D.call(this),this.h=_,this.g={}}v(eA,D);var ti=[];function He(_){K(_.g,function(O,x){this.g.hasOwnProperty(x)&&Pt(O)},_),_.g={}}eA.prototype.N=function(){eA.aa.N.call(this),He(this)},eA.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xe=a.JSON.stringify,kt=a.JSON.parse,Nt=class{stringify(_){return a.JSON.stringify(_,void 0)}parse(_){return a.JSON.parse(_,void 0)}};function _n(){}_n.prototype.h=null;function Br(_){return _.h||(_.h=_.i())}function Ci(){}var fn={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Un(){U.call(this,"d")}v(Un,U);function Mi(){U.call(this,"c")}v(Mi,U);var Ti={},Kd=null;function Gs(){return Kd=Kd||new qn}Ti.La="serverreachability";function Yo(_){U.call(this,Ti.La,_)}v(Yo,U);function gc(_){const O=Gs();yn(O,new Yo(O))}Ti.STAT_EVENT="statevent";function Co(_,O){U.call(this,Ti.STAT_EVENT,_),this.stat=O}v(Co,U);function Hn(_){const O=Gs();yn(O,new Co(O,_))}Ti.Ma="timingevent";function jr(_,O){U.call(this,Ti.Ma,_),this.size=O}v(jr,U);function Lr(_,O){if(typeof _!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){_()},O)}function To(){this.g=!0}To.prototype.xa=function(){this.g=!1};function ru(_,O,x,z,le,_e){_.info(function(){if(_.g)if(_e)for(var Fe="",wn=_e.split("&"),Yi=0;Yi<wn.length;Yi++){var Cn=wn[Yi].split("=");if(1<Cn.length){var ls=Cn[0];Cn=Cn[1];var Xi=ls.split("_");Fe=2<=Xi.length&&Xi[1]=="type"?Fe+(ls+"="+Cn+"&"):Fe+(ls+"=redacted&")}}else Fe=null;else Fe=_e;return"XMLHTTP REQ ("+z+") [attempt "+le+"]: "+O+`
`+x+`
`+Fe})}function Gd(_,O,x,z,le,_e,Fe){_.info(function(){return"XMLHTTP RESP ("+z+") [ attempt "+le+"]: "+O+`
`+x+`
`+_e+" "+Fe})}function _c(_,O,x,z){_.info(function(){return"XMLHTTP TEXT ("+O+"): "+vc(_,x)+(z?" "+z:"")})}function Ec(_,O){_.info(function(){return"TIMEOUT: "+O})}To.prototype.info=function(){};function vc(_,O){if(!_.g)return O;if(!O)return null;try{var x=JSON.parse(O);if(x){for(_=0;_<x.length;_++)if(Array.isArray(x[_])){var z=x[_];if(!(2>z.length)){var le=z[1];if(Array.isArray(le)&&!(1>le.length)){var _e=le[0];if(_e!="noop"&&_e!="stop"&&_e!="close")for(var Fe=1;Fe<le.length;Fe++)le[Fe]=""}}}}return Xe(x)}catch{return O}}var Si={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},So={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Wi;function Xo(){}v(Xo,_n),Xo.prototype.g=function(){return new XMLHttpRequest},Xo.prototype.i=function(){return{}},Wi=new Xo;function $t(_,O,x,z){this.j=_,this.i=O,this.l=x,this.R=z||1,this.U=new eA(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new jn}function jn(){this.i=null,this.g="",this.h=!1}var yc={},Os={};function Jo(_,O,x){_.L=1,_.v=ZA(oo(O)),_.m=x,_.P=!0,wc(_,null)}function wc(_,O){_.F=Date.now(),$o(_),_.A=oo(_.v);var x=_.A,z=_.R;Array.isArray(z)||(z=[String(z)]),$d(x.i,"t",z),_.C=0,x=_.j.J,_.h=new jn,_.g=ky(_.j,x?O:null,!_.m),0<_.O&&(_.M=new Rf(m(_.Y,_,_.g),_.O)),O=_.U,x=_.g,z=_.ca;var le="readystatechange";Array.isArray(le)||(le&&(ti[0]=le.toString()),le=ti);for(var _e=0;_e<le.length;_e++){var Fe=Xt(x,le[_e],z||O.handleEvent,!1,O.h||O);if(!Fe)break;O.g[Fe.key]=Fe}O=_.H?F(_.H):{},_.m?(_.u||(_.u="POST"),O["Content-Type"]="application/x-www-form-urlencoded",_.g.ea(_.A,_.u,_.m,O)):(_.u="GET",_.g.ea(_.A,_.u,null,O)),gc(),ru(_.i,_.u,_.A,_.l,_.R,_.m)}$t.prototype.ca=function(_){_=_.target;const O=this.M;O&&bi(_)==3?O.j():this.Y(_)},$t.prototype.Y=function(_){try{if(_==this.g)e:{const Xi=bi(this.g);var O=this.g.Ba();const il=this.g.Z();if(!(3>Xi)&&(Xi!=3||this.g&&(this.h.h||this.g.oa()||Ro(this.g)))){this.J||Xi!=4||O==7||(O==8||0>=il?gc(3):gc(2)),Cc(this);var x=this.g.Z();this.X=x;t:if(zi(this)){var z=Ro(this.g);_="";var le=z.length,_e=bi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ni(this),Zo(this);var Fe="";break t}this.h.i=new a.TextDecoder}for(O=0;O<le;O++)this.h.h=!0,_+=this.h.i.decode(z[O],{stream:!(_e&&O==le-1)});z.length=0,this.h.g+=_,this.C=0,Fe=this.h.g}else Fe=this.g.oa();if(this.o=x==200,Gd(this.i,this.u,this.A,this.l,this.R,Xi,x),this.o){if(this.T&&!this.K){t:{if(this.g){var wn,Yi=this.g;if((wn=Yi.g?Yi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(wn)){var Cn=wn;break t}}Cn=null}if(x=Cn)_c(this.i,this.l,x,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ea(this,x);else{this.o=!1,this.s=3,Hn(12),ni(this),Zo(this);break e}}if(this.P){x=!0;let Ns;for(;!this.J&&this.C<Fe.length;)if(Ns=tA(this,Fe),Ns==Os){Xi==4&&(this.s=4,Hn(14),x=!1),_c(this.i,this.l,null,"[Incomplete Response]");break}else if(Ns==yc){this.s=4,Hn(15),_c(this.i,this.l,Fe,"[Invalid Chunk]"),x=!1;break}else _c(this.i,this.l,Ns,null),ea(this,Ns);if(zi(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Xi!=4||Fe.length!=0||this.h.h||(this.s=1,Hn(16),x=!1),this.o=this.o&&x,!x)_c(this.i,this.l,Fe,"[Invalid Chunked Response]"),ni(this),Zo(this);else if(0<Fe.length&&!this.W){this.W=!0;var ls=this.j;ls.g==this&&ls.ba&&!ls.M&&(ls.j.info("Great, no buffering proxy detected. Bytes received: "+Fe.length),th(ls),ls.M=!0,Hn(11))}}else _c(this.i,this.l,Fe,null),ea(this,Fe);Xi==4&&ni(this),this.o&&!this.J&&(Xi==4?Ly(this.j,this):(this.o=!1,$o(this)))}else Na(this.g),x==400&&0<Fe.indexOf("Unknown SID")?(this.s=3,Hn(12)):(this.s=0,Hn(13)),ni(this),Zo(this)}}}catch{}finally{}};function zi(_){return _.g?_.u=="GET"&&_.L!=2&&_.j.Ca:!1}function tA(_,O){var x=_.C,z=O.indexOf(`
`,x);return z==-1?Os:(x=Number(O.substring(x,z)),isNaN(x)?yc:(z+=1,z+x>O.length?Os:(O=O.slice(z,z+x),_.C=z+x,O)))}$t.prototype.cancel=function(){this.J=!0,ni(this)};function $o(_){_.S=Date.now()+_.I,Wd(_,_.I)}function Wd(_,O){if(_.B!=null)throw Error("WatchDog timer not null");_.B=Lr(m(_.ba,_),O)}function Cc(_){_.B&&(a.clearTimeout(_.B),_.B=null)}$t.prototype.ba=function(){this.B=null;const _=Date.now();0<=_-this.S?(Ec(this.i,this.A),this.L!=2&&(gc(),Hn(17)),ni(this),this.s=2,Zo(this)):Wd(this,this.S-_)};function Zo(_){_.j.G==0||_.J||Ly(_.j,_)}function ni(_){Cc(_);var O=_.M;O&&typeof O.ma=="function"&&O.ma(),_.M=null,He(_.U),_.g&&(O=_.g,_.g=null,O.abort(),O.ma())}function ea(_,O){try{var x=_.j;if(x.G!=0&&(x.g==_||zd(x.h,_))){if(!_.K&&zd(x.h,_)&&x.G==3){try{var z=x.Da.g.parse(O)}catch{z=null}if(Array.isArray(z)&&z.length==3){var le=z;if(le[0]==0){e:if(!x.u){if(x.g)if(x.g.F+3e3<_.F)Lf(x),Df(x);else break e;Fg(x),Hn(18)}}else x.za=le[1],0<x.za-x.T&&37500>le[2]&&x.F&&x.v==0&&!x.C&&(x.C=Lr(m(x.Za,x),6e3));if(1>=JA(x.h)&&x.ca){try{x.ca()}catch{}x.ca=void 0}}else rl(x,11)}else if((_.K||x.g==_)&&Lf(x),!I(O))for(le=x.Da.g.parse(O),O=0;O<le.length;O++){let Cn=le[O];if(x.T=Cn[0],Cn=Cn[1],x.G==2)if(Cn[0]=="c"){x.K=Cn[1],x.ia=Cn[2];const ls=Cn[3];ls!=null&&(x.la=ls,x.j.info("VER="+x.la));const Xi=Cn[4];Xi!=null&&(x.Aa=Xi,x.j.info("SVER="+x.Aa));const il=Cn[5];il!=null&&typeof il=="number"&&0<il&&(z=1.5*il,x.L=z,x.j.info("backChannelRequestTimeoutMs_="+z)),z=x;const Ns=_.g;if(Ns){const aA=Ns.g?Ns.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(aA){var _e=z.h;_e.g||aA.indexOf("spdy")==-1&&aA.indexOf("quic")==-1&&aA.indexOf("h2")==-1||(_e.j=_e.l,_e.g=new Set,_e.h&&(iu(_e,_e.h),_e.h=null))}if(z.D){const Qg=Ns.g?Ns.g.getResponseHeader("X-HTTP-Session-Id"):null;Qg&&(z.ya=Qg,Yn(z.I,z.D,Qg))}}x.G=3,x.l&&x.l.ua(),x.ba&&(x.R=Date.now()-_.F,x.j.info("Handshake RTT: "+x.R+"ms")),z=x;var Fe=_;if(z.qa=Py(z,z.J?z.ia:null,z.W),Fe.K){qi(z.h,Fe);var wn=Fe,Yi=z.L;Yi&&(wn.I=Yi),wn.B&&(Cc(wn),$o(wn)),z.g=Fe}else Dy(z);0<x.i.length&&Bf(x)}else Cn[0]!="stop"&&Cn[0]!="close"||rl(x,7);else x.G==3&&(Cn[0]=="stop"||Cn[0]=="close"?Cn[0]=="stop"?rl(x,7):xg(x):Cn[0]!="noop"&&x.l&&x.l.ta(Cn),x.v=0)}}gc(4)}catch{}}var Ge=class{constructor(_,O){this.g=_,this.map=O}};function Kt(_){this.l=_||10,a.PerformanceNavigationTiming?(_=a.performance.getEntriesByType("navigation"),_=0<_.length&&(_[0].nextHopProtocol=="hq"||_[0].nextHopProtocol=="h2")):_=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=_?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function nA(_){return _.h?!0:_.g?_.g.size>=_.j:!1}function JA(_){return _.h?1:_.g?_.g.size:0}function zd(_,O){return _.h?_.h==O:_.g?_.g.has(O):!1}function iu(_,O){_.g?_.g.add(O):_.h=O}function qi(_,O){_.h&&_.h==O?_.h=null:_.g&&_.g.has(O)&&_.g.delete(O)}Kt.prototype.cancel=function(){if(this.i=rA(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const _ of this.g.values())_.cancel();this.g.clear()}};function rA(_){if(_.h!=null)return _.i.concat(_.h.D);if(_.g!=null&&_.g.size!==0){let O=_.i;for(const x of _.g.values())O=O.concat(x.D);return O}return y(_.i)}function Ug(_){if(_.V&&typeof _.V=="function")return _.V();if(typeof Map<"u"&&_ instanceof Map||typeof Set<"u"&&_ instanceof Set)return Array.from(_.values());if(typeof _=="string")return _.split("");if(A(_)){for(var O=[],x=_.length,z=0;z<x;z++)O.push(_[z]);return O}O=[],x=0;for(z in _)O[x++]=_[z];return O}function su(_){if(_.na&&typeof _.na=="function")return _.na();if(!_.V||typeof _.V!="function"){if(typeof Map<"u"&&_ instanceof Map)return Array.from(_.keys());if(!(typeof Set<"u"&&_ instanceof Set)){if(A(_)||typeof _=="string"){var O=[];_=_.length;for(var x=0;x<_;x++)O.push(x);return O}O=[],x=0;for(const z in _)O[x++]=z;return O}}}function qd(_,O){if(_.forEach&&typeof _.forEach=="function")_.forEach(O,void 0);else if(A(_)||typeof _=="string")Array.prototype.forEach.call(_,O,void 0);else for(var x=su(_),z=Ug(_),le=z.length,_e=0;_e<le;_e++)O.call(void 0,z[_e],x&&x[_e],_)}var iA=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Of(_,O){if(_){_=_.split("&");for(var x=0;x<_.length;x++){var z=_[x].indexOf("="),le=null;if(0<=z){var _e=_[x].substring(0,z);le=_[x].substring(z+1)}else _e=_[x];O(_e,le?decodeURIComponent(le.replace(/\+/g," ")):"")}}}function ri(_){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,_ instanceof ri){this.h=_.h,$A(this,_.j),this.o=_.o,this.g=_.g,sA(this,_.s),this.l=_.l;var O=_.i,x=new Sc;x.i=O.i,O.g&&(x.g=new Map(O.g),x.h=O.h),Tc(this,x),this.m=_.m}else _&&(O=String(_).match(iA))?(this.h=!1,$A(this,O[1]||"",!0),this.o=ao(O[2]||""),this.g=ao(O[3]||"",!0),sA(this,O[4]),this.l=ao(O[5]||"",!0),Tc(this,O[6]||"",!0),this.m=ao(O[7]||"")):(this.h=!1,this.i=new Sc(null,this.h))}ri.prototype.toString=function(){var _=[],O=this.j;O&&_.push(el(O,Xd,!0),":");var x=this.g;return(x||O=="file")&&(_.push("//"),(O=this.o)&&_.push(el(O,Xd,!0),"@"),_.push(encodeURIComponent(String(x)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),x=this.s,x!=null&&_.push(":",String(x))),(x=this.l)&&(this.g&&x.charAt(0)!="/"&&_.push("/"),_.push(el(x,x.charAt(0)=="/"?Pg:Jd,!0))),(x=this.i.toString())&&_.push("?",x),(x=this.m)&&_.push("#",el(x,ou)),_.join("")};function oo(_){return new ri(_)}function $A(_,O,x){_.j=x?ao(O,!0):O,_.j&&(_.j=_.j.replace(/:$/,""))}function sA(_,O){if(O){if(O=Number(O),isNaN(O)||0>O)throw Error("Bad port number "+O);_.s=O}else _.s=null}function Tc(_,O,x){O instanceof Sc?(_.i=O,au(_.i,_.h)):(x||(O=el(O,kg)),_.i=new Sc(O,_.h))}function Yn(_,O,x){_.i.set(O,x)}function ZA(_){return Yn(_,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),_}function ao(_,O){return _?O?decodeURI(_.replace(/%25/g,"%2525")):decodeURIComponent(_):""}function el(_,O,x){return typeof _=="string"?(_=encodeURI(_).replace(O,Yd),x&&(_=_.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),_):null}function Yd(_){return _=_.charCodeAt(0),"%"+(_>>4&15).toString(16)+(_&15).toString(16)}var Xd=/[#\/\?@]/g,Jd=/[#\?:]/g,Pg=/[#\?]/g,kg=/[#\?@]/g,ou=/#/g;function Sc(_,O){this.h=this.g=null,this.i=_||null,this.j=!!O}function bo(_){_.g||(_.g=new Map,_.h=0,_.i&&Of(_.i,function(O,x){_.add(decodeURIComponent(O.replace(/\+/g," ")),x)}))}t=Sc.prototype,t.add=function(_,O){bo(this),this.i=null,_=Ra(this,_);var x=this.g.get(_);return x||this.g.set(_,x=[]),x.push(O),this.h+=1,this};function bc(_,O){bo(_),O=Ra(_,O),_.g.has(O)&&(_.i=null,_.h-=_.g.get(O).length,_.g.delete(O))}function ta(_,O){return bo(_),O=Ra(_,O),_.g.has(O)}t.forEach=function(_,O){bo(this),this.g.forEach(function(x,z){x.forEach(function(le){_.call(O,le,z,this)},this)},this)},t.na=function(){bo(this);const _=Array.from(this.g.values()),O=Array.from(this.g.keys()),x=[];for(let z=0;z<O.length;z++){const le=_[z];for(let _e=0;_e<le.length;_e++)x.push(O[z])}return x},t.V=function(_){bo(this);let O=[];if(typeof _=="string")ta(this,_)&&(O=O.concat(this.g.get(Ra(this,_))));else{_=Array.from(this.g.values());for(let x=0;x<_.length;x++)O=O.concat(_[x])}return O},t.set=function(_,O){return bo(this),this.i=null,_=Ra(this,_),ta(this,_)&&(this.h-=this.g.get(_).length),this.g.set(_,[O]),this.h+=1,this},t.get=function(_,O){return _?(_=this.V(_),0<_.length?String(_[0]):O):O};function $d(_,O,x){bc(_,O),0<x.length&&(_.i=null,_.g.set(Ra(_,O),y(x)),_.h+=x.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const _=[],O=Array.from(this.g.keys());for(var x=0;x<O.length;x++){var z=O[x];const _e=encodeURIComponent(String(z)),Fe=this.V(z);for(z=0;z<Fe.length;z++){var le=_e;Fe[z]!==""&&(le+="="+encodeURIComponent(String(Fe[z]))),_.push(le)}}return this.i=_.join("&")};function Ra(_,O){return O=String(O),_.j&&(O=O.toLowerCase()),O}function au(_,O){O&&!_.j&&(bo(_),_.i=null,_.g.forEach(function(x,z){var le=z.toLowerCase();z!=le&&(bc(this,z),$d(this,le,x))},_)),_.j=O}function tl(_,O){const x=new To;if(a.Image){const z=new Image;z.onload=g(Io,x,"TestLoadImage: loaded",!0,O,z),z.onerror=g(Io,x,"TestLoadImage: error",!1,O,z),z.onabort=g(Io,x,"TestLoadImage: abort",!1,O,z),z.ontimeout=g(Io,x,"TestLoadImage: timeout",!1,O,z),a.setTimeout(function(){z.ontimeout&&z.ontimeout()},1e4),z.src=_}else O(!1)}function na(_,O){const x=new To,z=new AbortController,le=setTimeout(()=>{z.abort(),Io(x,"TestPingServer: timeout",!1,O)},1e4);fetch(_,{signal:z.signal}).then(_e=>{clearTimeout(le),_e.ok?Io(x,"TestPingServer: ok",!0,O):Io(x,"TestPingServer: server error",!1,O)}).catch(()=>{clearTimeout(le),Io(x,"TestPingServer: error",!1,O)})}function Io(_,O,x,z,le){try{le&&(le.onload=null,le.onerror=null,le.onabort=null,le.ontimeout=null),z(x)}catch{}}function nl(){this.g=new Nt}function ra(_,O,x){const z=x||"";try{qd(_,function(le,_e){let Fe=le;u(le)&&(Fe=Xe(le)),O.push(z+_e+"="+encodeURIComponent(Fe))})}catch(le){throw O.push(z+"type="+encodeURIComponent("_badmap")),le}}function Ic(_){this.l=_.Ub||null,this.j=_.eb||!1}v(Ic,_n),Ic.prototype.g=function(){return new Oa(this.l,this.j)},Ic.prototype.i=function(_){return function(){return _}}({});function Oa(_,O){qn.call(this),this.D=_,this.o=O,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}v(Oa,qn),t=Oa.prototype,t.open=function(_,O){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=_,this.A=O,this.readyState=1,ve(this)},t.send=function(_){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const O={headers:this.u,method:this.B,credentials:this.m,cache:void 0};_&&(O.body=_),(this.D||a).fetch(new Request(this.A,O)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,pe(this)),this.readyState=0},t.Sa=function(_){if(this.g&&(this.l=_,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=_.headers,this.readyState=2,ve(this)),this.g&&(this.readyState=3,ve(this),this.g)))if(this.responseType==="arraybuffer")_.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in _){if(this.j=_.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;oe(this)}else _.text().then(this.Ra.bind(this),this.ga.bind(this))};function oe(_){_.j.read().then(_.Pa.bind(_)).catch(_.ga.bind(_))}t.Pa=function(_){if(this.g){if(this.o&&_.value)this.response.push(_.value);else if(!this.o){var O=_.value?_.value:new Uint8Array(0);(O=this.v.decode(O,{stream:!_.done}))&&(this.response=this.responseText+=O)}_.done?pe(this):ve(this),this.readyState==3&&oe(this)}},t.Ra=function(_){this.g&&(this.response=this.responseText=_,pe(this))},t.Qa=function(_){this.g&&(this.response=_,pe(this))},t.ga=function(){this.g&&pe(this)};function pe(_){_.readyState=4,_.l=null,_.j=null,_.v=null,ve(_)}t.setRequestHeader=function(_,O){this.u.append(_,O)},t.getResponseHeader=function(_){return this.h&&this.h.get(_.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const _=[],O=this.h.entries();for(var x=O.next();!x.done;)x=x.value,_.push(x[0]+": "+x[1]),x=O.next();return _.join(`\r
`)};function ve(_){_.onreadystatechange&&_.onreadystatechange.call(_)}Object.defineProperty(Oa.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(_){this.m=_?"include":"same-origin"}});function he(_){let O="";return K(_,function(x,z){O+=z,O+=":",O+=x,O+=`\r
`}),O}function Pe(_,O,x){e:{for(z in x){var z=!1;break e}z=!0}z||(x=he(x),typeof _=="string"?x!=null&&encodeURIComponent(String(x)):Yn(_,O,x))}function $e(_){qn.call(this),this.headers=new Map,this.o=_||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}v($e,qn);var Gt=/^https?$/i,ct=["POST","PUT"];t=$e.prototype,t.Ha=function(_){this.J=_},t.ea=function(_,O,x,z){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+_);O=O?O.toUpperCase():"GET",this.D=_,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Wi.g(),this.v=this.o?Br(this.o):Br(Wi),this.g.onreadystatechange=m(this.Ea,this);try{this.B=!0,this.g.open(O,String(_),!0),this.B=!1}catch(_e){Wt(this,_e);return}if(_=x||"",x=new Map(this.headers),z)if(Object.getPrototypeOf(z)===Object.prototype)for(var le in z)x.set(le,z[le]);else if(typeof z.keys=="function"&&typeof z.get=="function")for(const _e of z.keys())x.set(_e,z.get(_e));else throw Error("Unknown input type for opt_headers: "+String(z));z=Array.from(x.keys()).find(_e=>_e.toLowerCase()=="content-type"),le=a.FormData&&_ instanceof a.FormData,!(0<=Array.prototype.indexOf.call(ct,O,void 0))||z||le||x.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[_e,Fe]of x)this.g.setRequestHeader(_e,Fe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gn(this),this.u=!0,this.g.send(_),this.u=!1}catch(_e){Wt(this,_e)}};function Wt(_,O){_.h=!1,_.g&&(_.j=!0,_.g.abort(),_.j=!1),_.l=O,_.m=5,it(_),Pn(_)}function it(_){_.A||(_.A=!0,yn(_,"complete"),yn(_,"error"))}t.abort=function(_){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=_||7,yn(this,"complete"),yn(this,"abort"),Pn(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Pn(this,!0)),$e.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Kn(this):this.bb())},t.bb=function(){Kn(this)};function Kn(_){if(_.h&&typeof o<"u"&&(!_.v[1]||bi(_)!=4||_.Z()!=2)){if(_.u&&bi(_)==4)wi(_.Ea,0,_);else if(yn(_,"readystatechange"),bi(_)==4){_.h=!1;try{const Fe=_.Z();e:switch(Fe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var O=!0;break e;default:O=!1}var x;if(!(x=O)){var z;if(z=Fe===0){var le=String(_.D).match(iA)[1]||null;!le&&a.self&&a.self.location&&(le=a.self.location.protocol.slice(0,-1)),z=!Gt.test(le?le.toLowerCase():"")}x=z}if(x)yn(_,"complete"),yn(_,"success");else{_.m=6;try{var _e=2<bi(_)?_.g.statusText:""}catch{_e=""}_.l=_e+" ["+_.Z()+"]",it(_)}}finally{Pn(_)}}}}function Pn(_,O){if(_.g){Gn(_);const x=_.g,z=_.v[0]?()=>{}:null;_.g=null,_.v=null,O||yn(_,"ready");try{x.onreadystatechange=z}catch{}}}function Gn(_){_.I&&(a.clearTimeout(_.I),_.I=null)}t.isActive=function(){return!!this.g};function bi(_){return _.g?_.g.readyState:0}t.Z=function(){try{return 2<bi(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(_){if(this.g){var O=this.g.responseText;return _&&O.indexOf(_)==0&&(O=O.substring(_.length)),kt(O)}};function Ro(_){try{if(!_.g)return null;if("response"in _.g)return _.g.response;switch(_.H){case"":case"text":return _.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in _.g)return _.g.mozResponseArrayBuffer}return null}catch{return null}}function Na(_){const O={};_=(_.g&&2<=bi(_)&&_.g.getAllResponseHeaders()||"").split(`\r
`);for(let z=0;z<_.length;z++){if(I(_[z]))continue;var x=$(_[z]);const le=x[0];if(x=x[1],typeof x!="string")continue;x=x.trim();const _e=O[le]||[];O[le]=_e,_e.push(x)}Q(O,function(z){return z.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Zd(_,O,x){return x&&x.internalChannelParams&&x.internalChannelParams[_]||O}function Nf(_){this.Aa=0,this.i=[],this.j=new To,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Zd("failFast",!1,_),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Zd("baseRetryDelayMs",5e3,_),this.cb=Zd("retryDelaySeedMs",1e4,_),this.Wa=Zd("forwardChannelMaxRetries",2,_),this.wa=Zd("forwardChannelRequestTimeoutMs",2e4,_),this.pa=_&&_.xmlHttpFactory||void 0,this.Xa=_&&_.Tb||void 0,this.Ca=_&&_.useFetchStreams||!1,this.L=void 0,this.J=_&&_.supportsCrossDomainXhr||!1,this.K="",this.h=new Kt(_&&_.concurrentRequestLimit),this.Da=new nl,this.P=_&&_.fastHandshake||!1,this.O=_&&_.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=_&&_.Rb||!1,_&&_.xa&&this.j.xa(),_&&_.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&_&&_.detectBufferingProxy||!1,this.ja=void 0,_&&_.longPollingTimeout&&0<_.longPollingTimeout&&(this.ja=_.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Nf.prototype,t.la=8,t.G=1,t.connect=function(_,O,x,z){Hn(0),this.W=_,this.H=O||{},x&&z!==void 0&&(this.H.OSID=x,this.H.OAID=z),this.F=this.X,this.I=Py(this,null,this.W),Bf(this)};function xg(_){if(Oy(_),_.G==3){var O=_.U++,x=oo(_.I);if(Yn(x,"SID",_.K),Yn(x,"RID",O),Yn(x,"TYPE","terminate"),eh(_,x),O=new $t(_,_.j,O),O.L=2,O.v=ZA(oo(x)),x=!1,a.navigator&&a.navigator.sendBeacon)try{x=a.navigator.sendBeacon(O.v.toString(),"")}catch{}!x&&a.Image&&(new Image().src=O.v,x=!0),x||(O.g=ky(O.j,null),O.g.ea(O.v)),O.F=Date.now(),$o(O)}Uy(_)}function Df(_){_.g&&(th(_),_.g.cancel(),_.g=null)}function Oy(_){Df(_),_.u&&(a.clearTimeout(_.u),_.u=null),Lf(_),_.h.cancel(),_.s&&(typeof _.s=="number"&&a.clearTimeout(_.s),_.s=null)}function Bf(_){if(!nA(_.h)&&!_.s){_.s=!0;var O=_.Ga;J||P(),Y||(J(),Y=!0),Z.add(O,_),_.B=0}}function nI(_,O){return JA(_.h)>=_.h.j-(_.s?1:0)?!1:_.s?(_.i=O.D.concat(_.i),!0):_.G==1||_.G==2||_.B>=(_.Va?0:_.Wa)?!1:(_.s=Lr(m(_.Ga,_,O),Vg(_,_.B)),_.B++,!0)}t.Ga=function(_){if(this.s)if(this.s=null,this.G==1){if(!_){this.U=Math.floor(1e5*Math.random()),_=this.U++;const le=new $t(this,this.j,_);let _e=this.o;if(this.S&&(_e?(_e=F(_e),G(_e,this.S)):_e=this.S),this.m!==null||this.O||(le.H=_e,_e=null),this.P)e:{for(var O=0,x=0;x<this.i.length;x++){t:{var z=this.i[x];if("__data__"in z.map&&(z=z.map.__data__,typeof z=="string")){z=z.length;break t}z=void 0}if(z===void 0)break;if(O+=z,4096<O){O=x;break e}if(O===4096||x===this.i.length-1){O=x+1;break e}}O=1e3}else O=1e3;O=Ny(this,le,O),x=oo(this.I),Yn(x,"RID",_),Yn(x,"CVER",22),this.D&&Yn(x,"X-HTTP-Session-Id",this.D),eh(this,x),_e&&(this.O?O="headers="+encodeURIComponent(String(he(_e)))+"&"+O:this.m&&Pe(x,this.m,_e)),iu(this.h,le),this.Ua&&Yn(x,"TYPE","init"),this.P?(Yn(x,"$req",O),Yn(x,"SID","null"),le.T=!0,Jo(le,x,null)):Jo(le,x,O),this.G=2}}else this.G==3&&(_?Mg(this,_):this.i.length==0||nA(this.h)||Mg(this))};function Mg(_,O){var x;O?x=O.l:x=_.U++;const z=oo(_.I);Yn(z,"SID",_.K),Yn(z,"RID",x),Yn(z,"AID",_.T),eh(_,z),_.m&&_.o&&Pe(z,_.m,_.o),x=new $t(_,_.j,x,_.B+1),_.m===null&&(x.H=_.o),O&&(_.i=O.D.concat(_.i)),O=Ny(_,x,1e3),x.I=Math.round(.5*_.wa)+Math.round(.5*_.wa*Math.random()),iu(_.h,x),Jo(x,z,O)}function eh(_,O){_.H&&K(_.H,function(x,z){Yn(O,z,x)}),_.l&&qd({},function(x,z){Yn(O,z,x)})}function Ny(_,O,x){x=Math.min(_.i.length,x);var z=_.l?m(_.l.Na,_.l,_):null;e:{var le=_.i;let _e=-1;for(;;){const Fe=["count="+x];_e==-1?0<x?(_e=le[0].g,Fe.push("ofs="+_e)):_e=0:Fe.push("ofs="+_e);let wn=!0;for(let Yi=0;Yi<x;Yi++){let Cn=le[Yi].g;const ls=le[Yi].map;if(Cn-=_e,0>Cn)_e=Math.max(0,le[Yi].g-100),wn=!1;else try{ra(ls,Fe,"req"+Cn+"_")}catch{z&&z(ls)}}if(wn){z=Fe.join("&");break e}}}return _=_.i.splice(0,x),O.D=_,z}function Dy(_){if(!_.g&&!_.u){_.Y=1;var O=_.Fa;J||P(),Y||(J(),Y=!0),Z.add(O,_),_.v=0}}function Fg(_){return _.g||_.u||3<=_.v?!1:(_.Y++,_.u=Lr(m(_.Fa,_),Vg(_,_.v)),_.v++,!0)}t.Fa=function(){if(this.u=null,By(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var _=2*this.R;this.j.info("BP detection timer enabled: "+_),this.A=Lr(m(this.ab,this),_)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Hn(10),Df(this),By(this))};function th(_){_.A!=null&&(a.clearTimeout(_.A),_.A=null)}function By(_){_.g=new $t(_,_.j,"rpc",_.Y),_.m===null&&(_.g.H=_.o),_.g.O=0;var O=oo(_.qa);Yn(O,"RID","rpc"),Yn(O,"SID",_.K),Yn(O,"AID",_.T),Yn(O,"CI",_.F?"0":"1"),!_.F&&_.ja&&Yn(O,"TO",_.ja),Yn(O,"TYPE","xmlhttp"),eh(_,O),_.m&&_.o&&Pe(O,_.m,_.o),_.L&&(_.g.I=_.L);var x=_.g;_=_.ia,x.L=1,x.v=ZA(oo(O)),x.m=null,x.P=!0,wc(x,_)}t.Za=function(){this.C!=null&&(this.C=null,Df(this),Fg(this),Hn(19))};function Lf(_){_.C!=null&&(a.clearTimeout(_.C),_.C=null)}function Ly(_,O){var x=null;if(_.g==O){Lf(_),th(_),_.g=null;var z=2}else if(zd(_.h,O))x=O.D,qi(_.h,O),z=1;else return;if(_.G!=0){if(O.o)if(z==1){x=O.m?O.m.length:0,O=Date.now()-O.F;var le=_.B;z=Gs(),yn(z,new jr(z,x)),Bf(_)}else Dy(_);else if(le=O.s,le==3||le==0&&0<O.X||!(z==1&&nI(_,O)||z==2&&Fg(_)))switch(x&&0<x.length&&(O=_.h,O.i=O.i.concat(x)),le){case 1:rl(_,5);break;case 4:rl(_,10);break;case 3:rl(_,6);break;default:rl(_,2)}}}function Vg(_,O){let x=_.Ta+Math.floor(Math.random()*_.cb);return _.isActive()||(x*=2),x*O}function rl(_,O){if(_.j.info("Error code "+O),O==2){var x=m(_.fb,_),z=_.Xa;const le=!z;z=new ri(z||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||$A(z,"https"),ZA(z),le?tl(z.toString(),x):na(z.toString(),x)}else Hn(2);_.G=0,_.l&&_.l.sa(O),Uy(_),Oy(_)}t.fb=function(_){_?(this.j.info("Successfully pinged google.com"),Hn(2)):(this.j.info("Failed to ping google.com"),Hn(1))};function Uy(_){if(_.G=0,_.ka=[],_.l){const O=rA(_.h);(O.length!=0||_.i.length!=0)&&(w(_.ka,O),w(_.ka,_.i),_.h.i.length=0,y(_.i),_.i.length=0),_.l.ra()}}function Py(_,O,x){var z=x instanceof ri?oo(x):new ri(x);if(z.g!="")O&&(z.g=O+"."+z.g),sA(z,z.s);else{var le=a.location;z=le.protocol,O=O?O+"."+le.hostname:le.hostname,le=+le.port;var _e=new ri(null);z&&$A(_e,z),O&&(_e.g=O),le&&sA(_e,le),x&&(_e.l=x),z=_e}return x=_.D,O=_.ya,x&&O&&Yn(z,x,O),Yn(z,"VER",_.la),eh(_,z),z}function ky(_,O,x){if(O&&!_.J)throw Error("Can't create secondary domain capable XhrIo object.");return O=_.Ca&&!_.pa?new $e(new Ic({eb:x})):new $e(_.pa),O.Ha(_.J),O}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function xy(){}t=xy.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Uf(){}Uf.prototype.g=function(_,O){return new co(_,O)};function co(_,O){qn.call(this),this.g=new Nf(O),this.l=_,this.h=O&&O.messageUrlParams||null,_=O&&O.messageHeaders||null,O&&O.clientProtocolHeaderRequired&&(_?_["X-Client-Protocol"]="webchannel":_={"X-Client-Protocol":"webchannel"}),this.g.o=_,_=O&&O.initMessageHeaders||null,O&&O.messageContentType&&(_?_["X-WebChannel-Content-Type"]=O.messageContentType:_={"X-WebChannel-Content-Type":O.messageContentType}),O&&O.va&&(_?_["X-WebChannel-Client-Profile"]=O.va:_={"X-WebChannel-Client-Profile":O.va}),this.g.S=_,(_=O&&O.Sb)&&!I(_)&&(this.g.m=_),this.v=O&&O.supportsCrossDomainXhr||!1,this.u=O&&O.sendRawJson||!1,(O=O&&O.httpSessionIdParam)&&!I(O)&&(this.g.D=O,_=this.h,_!==null&&O in _&&(_=this.h,O in _&&delete _[O])),this.j=new oA(this)}v(co,qn),co.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},co.prototype.close=function(){xg(this.g)},co.prototype.o=function(_){var O=this.g;if(typeof _=="string"){var x={};x.__data__=_,_=x}else this.u&&(x={},x.__data__=Xe(_),_=x);O.i.push(new Ge(O.Ya++,_)),O.G==3&&Bf(O)},co.prototype.N=function(){this.g.l=null,delete this.j,xg(this.g),delete this.g,co.aa.N.call(this)};function My(_){Un.call(this),_.__headers__&&(this.headers=_.__headers__,this.statusCode=_.__status__,delete _.__headers__,delete _.__status__);var O=_.__sm__;if(O){e:{for(const x in O){_=x;break e}_=void 0}(this.i=_)&&(_=this.i,O=O!==null&&_ in O?O[_]:void 0),this.data=O}else this.data=_}v(My,Un);function Fy(){Mi.call(this),this.status=1}v(Fy,Mi);function oA(_){this.g=_}v(oA,xy),oA.prototype.ua=function(){yn(this.g,"a")},oA.prototype.ta=function(_){yn(this.g,new My(_))},oA.prototype.sa=function(_){yn(this.g,new Fy)},oA.prototype.ra=function(){yn(this.g,"b")},Uf.prototype.createWebChannel=Uf.prototype.g,co.prototype.send=co.prototype.o,co.prototype.open=co.prototype.m,co.prototype.close=co.prototype.close,Tz=function(){return new Uf},Cz=function(){return Gs()},wz=Ti,OB={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Si.NO_ERROR=0,Si.TIMEOUT=8,Si.HTTP_ERROR=6,TT=Si,So.COMPLETE="complete",yz=So,Ci.EventType=fn,fn.OPEN="a",fn.CLOSE="b",fn.ERROR="c",fn.MESSAGE="d",qn.prototype.listen=qn.prototype.K,eE=Ci,$e.prototype.listenOnce=$e.prototype.L,$e.prototype.getLastError=$e.prototype.Ka,$e.prototype.getLastErrorCode=$e.prototype.Ba,$e.prototype.getStatus=$e.prototype.Z,$e.prototype.getResponseJson=$e.prototype.Oa,$e.prototype.getResponseText=$e.prototype.oa,$e.prototype.send=$e.prototype.ea,$e.prototype.setWithCredentials=$e.prototype.Ha,vz=$e}).apply(typeof jw<"u"?jw:typeof self<"u"?self:typeof window<"u"?window:{});const hV="@firebase/firestore",fV="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}$s.UNAUTHENTICATED=new $s(null),$s.GOOGLE_CREDENTIALS=new $s("google-credentials-uid"),$s.FIRST_PARTY=new $s("first-party-uid"),$s.MOCK_USER=new $s("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let lg="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Af=new Yv("@firebase/firestore");function xp(){return Af.logLevel}function tt(t,...e){if(Af.logLevel<=un.DEBUG){const n=e.map(v1);Af.debug(`Firestore (${lg}): ${t}`,...n)}}function Yl(t,...e){if(Af.logLevel<=un.ERROR){const n=e.map(v1);Af.error(`Firestore (${lg}): ${t}`,...n)}}function Nm(t,...e){if(Af.logLevel<=un.WARN){const n=e.map(v1);Af.warn(`Firestore (${lg}): ${t}`,...n)}}function v1(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qt(t="Unexpected state"){const e=`FIRESTORE (${lg}) INTERNAL ASSERTION FAILED: `+t;throw Yl(e),new Error(e)}function $r(t,e){t||Qt()}function Rn(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Me={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class at extends dc{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xh{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sz{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class KAe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n($s.UNAUTHENTICATED))}shutdown(){}}class GAe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class WAe{constructor(e){this.t=e,this.currentUser=$s.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){$r(this.o===void 0);let r=this.i;const i=A=>this.i!==r?(r=this.i,n(A)):Promise.resolve();let s=new Xh;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Xh,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const A=s;e.enqueueRetryable(async()=>{await A.promise,await i(this.currentUser)})},a=A=>{tt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=A,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(A=>a(A)),setTimeout(()=>{if(!this.auth){const A=this.t.getImmediate({optional:!0});A?a(A):(tt("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Xh)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(tt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?($r(typeof r.accessToken=="string"),new Sz(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return $r(e===null||typeof e=="string"),new $s(e)}}class zAe{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=$s.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class qAe{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new zAe(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n($s.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class pV{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class YAe{constructor(e,n){this.A=n,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,ec(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,n){$r(this.o===void 0);const r=s=>{s.error!=null&&tt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,tt("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{tt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):tt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new pV(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?($r(typeof n.token=="string"),this.R=n.token,new pV(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XAe(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bz(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JAe{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const i=XAe(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%62))}return r}}function on(t,e){return t<e?-1:t>e?1:0}function NB(t,e){let n=0;for(;n<t.length&&n<e.length;){const r=t.codePointAt(n),i=e.codePointAt(n);if(r!==i){if(r<128&&i<128)return on(r,i);{const s=bz(),o=$Ae(s.encode(mV(t,n)),s.encode(mV(e,n)));return o!==0?o:on(r,i)}}n+=r>65535?2:1}return on(t.length,e.length)}function mV(t,e){return t.codePointAt(e)>65535?t.substring(e,e+2):t.substring(e,e+1)}function $Ae(t,e){for(let n=0;n<t.length&&n<e.length;++n)if(t[n]!==e[n])return on(t[n],e[n]);return on(t.length,e.length)}function Dm(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gV=-62135596800,_V=1e6;class Ss{static now(){return Ss.fromMillis(Date.now())}static fromDate(e){return Ss.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*_V);return new Ss(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new at(Me.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new at(Me.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<gV)throw new at(Me.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new at(Me.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/_V}_compareTo(e){return this.seconds===e.seconds?on(this.nanoseconds,e.nanoseconds):on(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-gV;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ft{static fromTimestamp(e){return new Ft(e)}static min(){return new Ft(new Ss(0,0))}static max(){return new Ft(new Ss(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EV="__name__";class TA{constructor(e,n,r){n===void 0?n=0:n>e.length&&Qt(),r===void 0?r=e.length-n:r>e.length-n&&Qt(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return TA.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof TA?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=TA.compareSegments(e.get(i),n.get(i));if(s!==0)return s}return on(e.length,n.length)}static compareSegments(e,n){const r=TA.isNumericId(e),i=TA.isNumericId(n);return r&&!i?-1:!r&&i?1:r&&i?TA.extractNumericId(e).compare(TA.extractNumericId(n)):NB(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return dd.fromString(e.substring(4,e.length-2))}}class Yr extends TA{construct(e,n,r){return new Yr(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new at(Me.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new Yr(n)}static emptyPath(){return new Yr([])}}const ZAe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class no extends TA{construct(e,n,r){return new no(e,n,r)}static isValidIdentifier(e){return ZAe.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),no.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===EV}static keyField(){return new no([EV])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new at(Me.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new at(Me.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const A=e[i+1];if(A!=="\\"&&A!=="."&&A!=="`")throw new at(Me.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=A,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new at(Me.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new no(n)}static emptyPath(){return new no([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e){this.path=e}static fromPath(e){return new Tt(Yr.fromString(e))}static fromName(e){return new Tt(Yr.fromString(e).popFirst(5))}static empty(){return new Tt(Yr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Yr.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Yr.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Tt(new Yr(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iv=-1;function ele(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Ft.fromTimestamp(r===1e9?new Ss(n+1,0):new Ss(n,r));return new Td(i,Tt.empty(),e)}function tle(t){return new Td(t.readTime,t.key,iv)}class Td{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Td(Ft.min(),Tt.empty(),iv)}static max(){return new Td(Ft.max(),Tt.empty(),iv)}}function nle(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Tt.comparator(t.documentKey,e.documentKey),n!==0?n:on(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rle="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ile{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QS(t){if(t.code!==Me.FAILED_PRECONDITION||t.message!==rle)throw t;tt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Qt(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new De((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof De?n:De.resolve(n)}catch(n){return De.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):De.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):De.reject(n)}static resolve(e){return new De((n,r)=>{n(e)})}static reject(e){return new De((n,r)=>{r(e)})}static waitFor(e){return new De((n,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&n()},A=>r(A))}),o=!0,s===i&&n()})}static or(e){let n=De.resolve(!1);for(const r of e)n=n.next(i=>i?De.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new De((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let A=0;A<s;A++){const u=A;n(e[u]).next(d=>{o[u]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,n){return new De((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}function sle(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function ug(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HS{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.oe(r),this._e=r=>n.writeSequenceNumber(r))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}HS.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ole=-1;function jS(t){return t==null}function C0(t){return t===0&&1/t==-1/0}function ale(t){return typeof t=="number"&&Number.isInteger(t)&&!C0(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Iz="";function cle(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=vV(e)),e=Ale(t.get(n),e);return vV(e)}function Ale(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const s=t.charAt(i);switch(s){case"\0":n+="";break;case Iz:n+="";break;default:n+=s}}return n}function vV(t){return t+Iz+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yV(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function dg(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Rz(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let bs=class DB{constructor(e,n){this.comparator=e,this.root=n||hd.EMPTY}insert(e,n){return new DB(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,hd.BLACK,null,null))}remove(e){return new DB(this.comparator,this.root.remove(e,this.comparator).copy(null,null,hd.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Kw(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Kw(this.root,e,this.comparator,!1)}getReverseIterator(){return new Kw(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Kw(this.root,e,this.comparator,!0)}},Kw=class{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},hd=class Sl{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??Sl.RED,this.left=i??Sl.EMPTY,this.right=s??Sl.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new Sl(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Sl.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Sl.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Sl.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Sl.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Qt();const e=this.left.check();if(e!==this.right.check())throw Qt();return e+(this.isRed()?0:1)}};hd.EMPTY=null,hd.RED=!0,hd.BLACK=!1;hd.EMPTY=new class{constructor(){this.size=0}get key(){throw Qt()}get value(){throw Qt()}get color(){throw Qt()}get left(){throw Qt()}get right(){throw Qt()}copy(e,n,r,i,s){return this}insert(e,n,r){return new hd(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e){this.comparator=e,this.data=new bs(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new wV(this.data.getIterator())}getIteratorFrom(e){return new wV(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof as)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new as(this.comparator);return n.data=e,n}}class wV{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zu{constructor(e){this.fields=e,e.sort(no.comparator)}static empty(){return new Zu([])}unionWith(e){let n=new as(no.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Zu(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Dm(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oz extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Oz("Invalid base64 string: "+s):s}}(e);return new Qs(n)}static fromUint8Array(e){const n=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new Qs(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return on(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Qs.EMPTY_BYTE_STRING=new Qs("");const lle=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sd(t){if($r(!!t),typeof t=="string"){let e=0;const n=lle.exec(t);if($r(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Li(t.seconds),nanos:Li(t.nanos)}}function Li(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function bd(t){return typeof t=="string"?Qs.fromBase64String(t):Qs.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nz="server_timestamp",Dz="__type__",Bz="__previous_value__",Lz="__local_write_time__";function y1(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[Dz])===null||n===void 0?void 0:n.stringValue)===Nz}function KS(t){const e=t.mapValue.fields[Bz];return y1(e)?KS(e):e}function sv(t){const e=Sd(t.mapValue.fields[Lz].timestampValue);return new Ss(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ule{constructor(e,n,r,i,s,o,a,A,u){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=A,this.useFetchStreams=u}}const T0="(default)";class ov{constructor(e,n){this.projectId=e,this.database=n||T0}static empty(){return new ov("","")}get isDefaultDatabase(){return this.database===T0}isEqual(e){return e instanceof ov&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uz="__type__",dle="__max__",Gw={mapValue:{}},Pz="__vector__",S0="value";function Id(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?y1(t)?4:fle(t)?9007199254740991:hle(t)?10:11:Qt()}function MA(t,e){if(t===e)return!0;const n=Id(t);if(n!==Id(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return sv(t).isEqual(sv(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Sd(i.timestampValue),a=Sd(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return bd(i.bytesValue).isEqual(bd(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return Li(i.geoPointValue.latitude)===Li(s.geoPointValue.latitude)&&Li(i.geoPointValue.longitude)===Li(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Li(i.integerValue)===Li(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=Li(i.doubleValue),a=Li(s.doubleValue);return o===a?C0(o)===C0(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return Dm(t.arrayValue.values||[],e.arrayValue.values||[],MA);case 10:case 11:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(yV(o)!==yV(a))return!1;for(const A in o)if(o.hasOwnProperty(A)&&(a[A]===void 0||!MA(o[A],a[A])))return!1;return!0}(t,e);default:return Qt()}}function av(t,e){return(t.values||[]).find(n=>MA(n,e))!==void 0}function Bm(t,e){if(t===e)return 0;const n=Id(t),r=Id(e);if(n!==r)return on(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return on(t.booleanValue,e.booleanValue);case 2:return function(s,o){const a=Li(s.integerValue||s.doubleValue),A=Li(o.integerValue||o.doubleValue);return a<A?-1:a>A?1:a===A?0:isNaN(a)?isNaN(A)?0:-1:1}(t,e);case 3:return CV(t.timestampValue,e.timestampValue);case 4:return CV(sv(t),sv(e));case 5:return NB(t.stringValue,e.stringValue);case 6:return function(s,o){const a=bd(s),A=bd(o);return a.compareTo(A)}(t.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),A=o.split("/");for(let u=0;u<a.length&&u<A.length;u++){const d=on(a[u],A[u]);if(d!==0)return d}return on(a.length,A.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,o){const a=on(Li(s.latitude),Li(o.latitude));return a!==0?a:on(Li(s.longitude),Li(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return TV(t.arrayValue,e.arrayValue);case 10:return function(s,o){var a,A,u,d;const f=s.fields||{},m=o.fields||{},g=(a=f[S0])===null||a===void 0?void 0:a.arrayValue,v=(A=m[S0])===null||A===void 0?void 0:A.arrayValue,y=on(((u=g==null?void 0:g.values)===null||u===void 0?void 0:u.length)||0,((d=v==null?void 0:v.values)===null||d===void 0?void 0:d.length)||0);return y!==0?y:TV(g,v)}(t.mapValue,e.mapValue);case 11:return function(s,o){if(s===Gw.mapValue&&o===Gw.mapValue)return 0;if(s===Gw.mapValue)return 1;if(o===Gw.mapValue)return-1;const a=s.fields||{},A=Object.keys(a),u=o.fields||{},d=Object.keys(u);A.sort(),d.sort();for(let f=0;f<A.length&&f<d.length;++f){const m=NB(A[f],d[f]);if(m!==0)return m;const g=Bm(a[A[f]],u[d[f]]);if(g!==0)return g}return on(A.length,d.length)}(t.mapValue,e.mapValue);default:throw Qt()}}function CV(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return on(t,e);const n=Sd(t),r=Sd(e),i=on(n.seconds,r.seconds);return i!==0?i:on(n.nanos,r.nanos)}function TV(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const s=Bm(n[i],r[i]);if(s)return s}return on(n.length,r.length)}function Lm(t){return BB(t)}function BB(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Sd(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return bd(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return Tt.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const s of n.values||[])i?i=!1:r+=",",r+=BB(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${BB(n.fields[o])}`;return i+"}"}(t.mapValue):Qt()}function ST(t){switch(Id(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=KS(t);return e?16+ST(e):16;case 5:return 2*t.stringValue.length;case 6:return bd(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+ST(s),0)}(t.arrayValue);case 10:case 11:return function(r){let i=0;return dg(r.fields,(s,o)=>{i+=s.length+ST(o)}),i}(t.mapValue);default:throw Qt()}}function SV(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function LB(t){return!!t&&"integerValue"in t}function w1(t){return!!t&&"arrayValue"in t}function bV(t){return!!t&&"nullValue"in t}function IV(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function uO(t){return!!t&&"mapValue"in t}function hle(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{})[Uz])===null||n===void 0?void 0:n.stringValue)===Pz}function SE(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return dg(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=SE(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=SE(t.arrayValue.values[n]);return e}return Object.assign({},t)}function fle(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===dle}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SA{constructor(e){this.value=e}static empty(){return new SA({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!uO(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=SE(n)}setAll(e){let n=no.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const A=this.getFieldsMap(n);this.applyChanges(A,r,i),r={},i=[],n=a.popLast()}o?r[a.lastSegment()]=SE(o):i.push(a.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());uO(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return MA(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];uO(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){dg(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new SA(SE(this.value))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class to{constructor(e,n,r,i,s,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new to(e,0,Ft.min(),Ft.min(),Ft.min(),SA.empty(),0)}static newFoundDocument(e,n,r,i){return new to(e,1,n,Ft.min(),r,i,0)}static newNoDocument(e,n){return new to(e,2,n,Ft.min(),Ft.min(),SA.empty(),0)}static newUnknownDocument(e,n){return new to(e,3,n,Ft.min(),Ft.min(),SA.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Ft.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=SA.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=SA.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ft.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof to&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new to(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b0{constructor(e,n){this.position=e,this.inclusive=n}}function RV(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(s.field.isKeyField()?r=Tt.comparator(Tt.fromName(o.referenceValue),n.key):r=Bm(o,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function OV(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!MA(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I0{constructor(e,n="asc"){this.field=e,this.dir=n}}function ple(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kz{}class Gi extends kz{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new gle(e,n,r):n==="array-contains"?new vle(e,r):n==="in"?new yle(e,r):n==="not-in"?new wle(e,r):n==="array-contains-any"?new Cle(e,r):new Gi(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new _le(e,r):new Ele(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Bm(n,this.value)):n!==null&&Id(this.value)===Id(n)&&this.matchesComparison(Bm(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Qt()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class zc extends kz{constructor(e,n){super(),this.filters=e,this.op=n,this.ce=null}static create(e,n){return new zc(e,n)}matches(e){return xz(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function xz(t){return t.op==="and"}function Mz(t){return mle(t)&&xz(t)}function mle(t){for(const e of t.filters)if(e instanceof zc)return!1;return!0}function UB(t){if(t instanceof Gi)return t.field.canonicalString()+t.op.toString()+Lm(t.value);if(Mz(t))return t.filters.map(e=>UB(e)).join(",");{const e=t.filters.map(n=>UB(n)).join(",");return`${t.op}(${e})`}}function Fz(t,e){return t instanceof Gi?function(r,i){return i instanceof Gi&&r.op===i.op&&r.field.isEqual(i.field)&&MA(r.value,i.value)}(t,e):t instanceof zc?function(r,i){return i instanceof zc&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&Fz(o,i.filters[a]),!0):!1}(t,e):void Qt()}function Vz(t){return t instanceof Gi?function(n){return`${n.field.canonicalString()} ${n.op} ${Lm(n.value)}`}(t):t instanceof zc?function(n){return n.op.toString()+" {"+n.getFilters().map(Vz).join(" ,")+"}"}(t):"Filter"}class gle extends Gi{constructor(e,n,r){super(e,n,r),this.key=Tt.fromName(r.referenceValue)}matches(e){const n=Tt.comparator(e.key,this.key);return this.matchesComparison(n)}}class _le extends Gi{constructor(e,n){super(e,"in",n),this.keys=Qz("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class Ele extends Gi{constructor(e,n){super(e,"not-in",n),this.keys=Qz("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function Qz(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>Tt.fromName(r.referenceValue))}class vle extends Gi{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return w1(n)&&av(n.arrayValue,this.value)}}class yle extends Gi{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&av(this.value.arrayValue,n)}}class wle extends Gi{constructor(e,n){super(e,"not-in",n)}matches(e){if(av(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!av(this.value.arrayValue,n)}}class Cle extends Gi{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!w1(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>av(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tle{constructor(e,n=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.le=null}}function NV(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Tle(t,e,n,r,i,s,o)}function C1(t){const e=Rn(t);if(e.le===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>UB(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),jS(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Lm(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Lm(r)).join(",")),e.le=n}return e.le}function T1(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ple(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Fz(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!OV(t.startAt,e.startAt)&&OV(t.endAt,e.endAt)}function PB(t){return Tt.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ey{constructor(e,n=null,r=[],i=[],s=null,o="F",a=null,A=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=A,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function Sle(t,e,n,r,i,s,o,a){return new ey(t,e,n,r,i,s,o,a)}function Hz(t){return new ey(t)}function DV(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function jz(t){return t.collectionGroup!==null}function bE(t){const e=Rn(t);if(e.he===null){e.he=[];const n=new Set;for(const s of e.explicitOrderBy)e.he.push(s),n.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new as(no.comparator);return o.filters.forEach(A=>{A.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.he.push(new I0(s,r))}),n.has(no.keyField().canonicalString())||e.he.push(new I0(no.keyField(),r))}return e.he}function PA(t){const e=Rn(t);return e.Pe||(e.Pe=ble(e,bE(t))),e.Pe}function ble(t,e){if(t.limitType==="F")return NV(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new I0(i.field,s)});const n=t.endAt?new b0(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new b0(t.startAt.position,t.startAt.inclusive):null;return NV(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function kB(t,e){const n=t.filters.concat([e]);return new ey(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function xB(t,e,n){return new ey(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function GS(t,e){return T1(PA(t),PA(e))&&t.limitType===e.limitType}function Kz(t){return`${C1(PA(t))}|lt:${t.limitType}`}function Mp(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>Vz(i)).join(", ")}]`),jS(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>Lm(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>Lm(i)).join(",")),`Target(${r})`}(PA(t))}; limitType=${t.limitType})`}function WS(t,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):Tt.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(const s of bE(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(o,a,A){const u=RV(o,a,A);return o.inclusive?u<=0:u<0}(r.startAt,bE(r),i)||r.endAt&&!function(o,a,A){const u=RV(o,a,A);return o.inclusive?u>=0:u>0}(r.endAt,bE(r),i))}(t,e)}function Ile(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Gz(t){return(e,n)=>{let r=!1;for(const i of bE(t)){const s=Rle(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Rle(t,e,n){const r=t.field.isKeyField()?Tt.comparator(e.key,n.key):function(s,o,a){const A=o.data.field(s),u=a.data.field(s);return A!==null&&u!==null?Bm(A,u):Qt()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Qt()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){dg(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Rz(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ole=new bs(Tt.comparator);function Rd(){return Ole}const Wz=new bs(Tt.comparator);function tE(...t){let e=Wz;for(const n of t)e=e.insert(n.key,n);return e}function Nle(t){let e=Wz;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Mh(){return IE()}function zz(){return IE()}function IE(){return new vf(t=>t.toString(),(t,e)=>t.isEqual(e))}const Dle=new as(Tt.comparator);function Bn(...t){let e=Dle;for(const n of t)e=e.add(n);return e}const Ble=new as(on);function Lle(){return Ble}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S1(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:C0(e)?"-0":e}}function qz(t){return{integerValue:""+t}}function Ule(t,e){return ale(e)?qz(e):S1(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zS{constructor(){this._=void 0}}function Ple(t,e,n){return t instanceof MB?function(i,s){const o={fields:{[Dz]:{stringValue:Nz},[Lz]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&y1(s)&&(s=KS(s)),s&&(o.fields[Bz]=s),{mapValue:o}}(n,e):t instanceof R0?Yz(t,e):t instanceof O0?Xz(t,e):function(i,s){const o=xle(i,s),a=BV(o)+BV(i.Ie);return LB(o)&&LB(i.Ie)?qz(a):S1(i.serializer,a)}(t,e)}function kle(t,e,n){return t instanceof R0?Yz(t,e):t instanceof O0?Xz(t,e):n}function xle(t,e){return t instanceof FB?function(r){return LB(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class MB extends zS{}class R0 extends zS{constructor(e){super(),this.elements=e}}function Yz(t,e){const n=Jz(e);for(const r of t.elements)n.some(i=>MA(i,r))||n.push(r);return{arrayValue:{values:n}}}class O0 extends zS{constructor(e){super(),this.elements=e}}function Xz(t,e){let n=Jz(e);for(const r of t.elements)n=n.filter(i=>!MA(i,r));return{arrayValue:{values:n}}}class FB extends zS{constructor(e,n){super(),this.serializer=e,this.Ie=n}}function BV(t){return Li(t.integerValue||t.doubleValue)}function Jz(t){return w1(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Mle(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof R0&&i instanceof R0||r instanceof O0&&i instanceof O0?Dm(r.elements,i.elements,MA):r instanceof FB&&i instanceof FB?MA(r.Ie,i.Ie):r instanceof MB&&i instanceof MB}(t.transform,e.transform)}class Jh{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Jh}static exists(e){return new Jh(void 0,e)}static updateTime(e){return new Jh(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function bT(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class b1{}function $z(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Vle(t.key,Jh.none()):new I1(t.key,t.data,Jh.none());{const n=t.data,r=SA.empty();let i=new as(no.comparator);for(let s of e.fields)if(!i.has(s)){let o=n.field(s);o===null&&s.length>1&&(s=s.popLast(),o=n.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new qS(t.key,r,new Zu(i.toArray()),Jh.none())}}function Fle(t,e,n){t instanceof I1?function(i,s,o){const a=i.value.clone(),A=UV(i.fieldTransforms,s,o.transformResults);a.setAll(A),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof qS?function(i,s,o){if(!bT(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=UV(i.fieldTransforms,s,o.transformResults),A=s.data;A.setAll(Zz(i)),A.setAll(a),s.convertToFoundDocument(o.version,A).setHasCommittedMutations()}(t,e,n):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function RE(t,e,n,r){return t instanceof I1?function(s,o,a,A){if(!bT(s.precondition,o))return a;const u=s.value.clone(),d=PV(s.fieldTransforms,A,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(t,e,n,r):t instanceof qS?function(s,o,a,A){if(!bT(s.precondition,o))return a;const u=PV(s.fieldTransforms,A,o),d=o.data;return d.setAll(Zz(s)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(f=>f.field))}(t,e,n,r):function(s,o,a){return bT(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function LV(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Dm(r,i,(s,o)=>Mle(s,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class I1 extends b1{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class qS extends b1{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Zz(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function UV(t,e,n){const r=new Map;$r(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,kle(o,a,n[i]))}return r}function PV(t,e,n){const r=new Map;for(const i of t){const s=i.transform,o=n.data.field(i.field);r.set(i.field,Ple(s,o,e))}return r}class Vle extends b1{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qle{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Fle(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=RE(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=RE(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=zz();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=n.has(i.key)?null:a;const A=$z(o,a);A!==null&&r.set(i.key,A),o.isValidDocument()||o.convertToNoDocument(Ft.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Bn())}isEqual(e){return this.batchId===e.batchId&&Dm(this.mutations,e.mutations,(n,r)=>LV(n,r))&&Dm(this.baseMutations,e.baseMutations,(n,r)=>LV(n,r))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hle{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jle{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ji,Sn;function eq(t){if(t===void 0)return Yl("GRPC error has no .code"),Me.UNKNOWN;switch(t){case ji.OK:return Me.OK;case ji.CANCELLED:return Me.CANCELLED;case ji.UNKNOWN:return Me.UNKNOWN;case ji.DEADLINE_EXCEEDED:return Me.DEADLINE_EXCEEDED;case ji.RESOURCE_EXHAUSTED:return Me.RESOURCE_EXHAUSTED;case ji.INTERNAL:return Me.INTERNAL;case ji.UNAVAILABLE:return Me.UNAVAILABLE;case ji.UNAUTHENTICATED:return Me.UNAUTHENTICATED;case ji.INVALID_ARGUMENT:return Me.INVALID_ARGUMENT;case ji.NOT_FOUND:return Me.NOT_FOUND;case ji.ALREADY_EXISTS:return Me.ALREADY_EXISTS;case ji.PERMISSION_DENIED:return Me.PERMISSION_DENIED;case ji.FAILED_PRECONDITION:return Me.FAILED_PRECONDITION;case ji.ABORTED:return Me.ABORTED;case ji.OUT_OF_RANGE:return Me.OUT_OF_RANGE;case ji.UNIMPLEMENTED:return Me.UNIMPLEMENTED;case ji.DATA_LOSS:return Me.DATA_LOSS;default:return Qt()}}(Sn=ji||(ji={}))[Sn.OK=0]="OK",Sn[Sn.CANCELLED=1]="CANCELLED",Sn[Sn.UNKNOWN=2]="UNKNOWN",Sn[Sn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Sn[Sn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Sn[Sn.NOT_FOUND=5]="NOT_FOUND",Sn[Sn.ALREADY_EXISTS=6]="ALREADY_EXISTS",Sn[Sn.PERMISSION_DENIED=7]="PERMISSION_DENIED",Sn[Sn.UNAUTHENTICATED=16]="UNAUTHENTICATED",Sn[Sn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Sn[Sn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Sn[Sn.ABORTED=10]="ABORTED",Sn[Sn.OUT_OF_RANGE=11]="OUT_OF_RANGE",Sn[Sn.UNIMPLEMENTED=12]="UNIMPLEMENTED",Sn[Sn.INTERNAL=13]="INTERNAL",Sn[Sn.UNAVAILABLE=14]="UNAVAILABLE",Sn[Sn.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kle=new dd([4294967295,4294967295],0);function kV(t){const e=bz().encode(t),n=new Ez;return n.update(e),new Uint8Array(n.digest())}function xV(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new dd([n,r],0),new dd([i,s],0)]}class R1{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new nE(`Invalid padding: ${n}`);if(r<0)throw new nE(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new nE(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new nE(`Invalid padding when bitmap length is 0: ${n}`);this.Ee=8*e.length-n,this.de=dd.fromNumber(this.Ee)}Ae(e,n,r){let i=e.add(n.multiply(dd.fromNumber(r)));return i.compare(Kle)===1&&(i=new dd([i.getBits(0),i.getBits(1)],0)),i.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const n=kV(e),[r,i]=xV(n);for(let s=0;s<this.hashCount;s++){const o=this.Ae(r,i,s);if(!this.Re(o))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new R1(s,i,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Ee===0)return;const n=kV(e),[r,i]=xV(n);for(let s=0;s<this.hashCount;s++){const o=this.Ae(r,i,s);this.Ve(o)}}Ve(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class nE extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YS{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,ty.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new YS(Ft.min(),i,new bs(on),Rd(),Bn())}}class ty{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new ty(r,n,Bn(),Bn(),Bn())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IT{constructor(e,n,r,i){this.me=e,this.removedTargetIds=n,this.key=r,this.fe=i}}class tq{constructor(e,n){this.targetId=e,this.ge=n}}class nq{constructor(e,n,r=Qs.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class MV{constructor(){this.pe=0,this.ye=FV(),this.we=Qs.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Bn(),n=Bn(),r=Bn();return this.ye.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:Qt()}}),new ty(this.we,this.Se,e,n,r)}Me(){this.be=!1,this.ye=FV()}xe(e,n){this.be=!0,this.ye=this.ye.insert(e,n)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,$r(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class Gle{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Rd(),this.$e=Ww(),this.Ue=Ww(),this.Ke=new bs(on)}We(e){for(const n of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(n,e.fe):this.ze(n,e.key,e.fe);for(const n of e.removedTargetIds)this.ze(n,e.key,e.fe)}je(e){this.forEachTarget(e,n=>{const r=this.He(n);switch(e.state){case 0:this.Je(n)&&r.Ce(e.resumeToken);break;case 1:r.Be(),r.De||r.Me(),r.Ce(e.resumeToken);break;case 2:r.Be(),r.De||this.removeTarget(n);break;case 3:this.Je(n)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.Je(n)&&(this.Ye(n),r.Ce(e.resumeToken));break;default:Qt()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.qe.forEach((r,i)=>{this.Je(i)&&n(i)})}Ze(e){const n=e.targetId,r=e.ge.count,i=this.Xe(n);if(i){const s=i.target;if(PB(s))if(r===0){const o=new Tt(s.path);this.ze(n,o,to.newNoDocument(o,Ft.min()))}else $r(r===1);else{const o=this.et(n);if(o!==r){const a=this.tt(e),A=a?this.nt(a,e,o):1;if(A!==0){this.Ye(n);const u=A===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(n,u)}}}}}tt(e){const n=e.ge.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n;let o,a;try{o=bd(r).toUint8Array()}catch(A){if(A instanceof Oz)return Nm("Decoding the base64 bloom filter in existence filter failed ("+A.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw A}try{a=new R1(o,i,s)}catch(A){return Nm(A instanceof nE?"BloomFilter error: ":"Applying bloom filter failed: ",A),null}return a.Ee===0?null:a}nt(e,n,r){return n.ge.count===r-this.st(e,n.targetId)?0:2}st(e,n){const r=this.ke.getRemoteKeysForTarget(n);let i=0;return r.forEach(s=>{const o=this.ke.it(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.ze(n,s,null),i++)}),i}ot(e){const n=new Map;this.qe.forEach((s,o)=>{const a=this.Xe(o);if(a){if(s.current&&PB(a.target)){const A=new Tt(a.target.path);this._t(A).has(o)||this.ut(o,A)||this.ze(o,A,to.newNoDocument(A,e))}s.ve&&(n.set(o,s.Fe()),s.Me())}});let r=Bn();this.Ue.forEach((s,o)=>{let a=!0;o.forEachWhile(A=>{const u=this.Xe(A);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.Qe.forEach((s,o)=>o.setReadTime(e));const i=new YS(e,n,this.Ke,this.Qe,r);return this.Qe=Rd(),this.$e=Ww(),this.Ue=Ww(),this.Ke=new bs(on),i}Ge(e,n){if(!this.Je(e))return;const r=this.ut(e,n.key)?2:0;this.He(e).xe(n.key,r),this.Qe=this.Qe.insert(n.key,n),this.$e=this.$e.insert(n.key,this._t(n.key).add(e)),this.Ue=this.Ue.insert(n.key,this.ct(n.key).add(e))}ze(e,n,r){if(!this.Je(e))return;const i=this.He(e);this.ut(e,n)?i.xe(n,1):i.Oe(n),this.Ue=this.Ue.insert(n,this.ct(n).delete(e)),this.Ue=this.Ue.insert(n,this.ct(n).add(e)),r&&(this.Qe=this.Qe.insert(n,r))}removeTarget(e){this.qe.delete(e)}et(e){const n=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let n=this.qe.get(e);return n||(n=new MV,this.qe.set(e,n)),n}ct(e){let n=this.Ue.get(e);return n||(n=new as(on),this.Ue=this.Ue.insert(e,n)),n}_t(e){let n=this.$e.get(e);return n||(n=new as(on),this.$e=this.$e.insert(e,n)),n}Je(e){const n=this.Xe(e)!==null;return n||tt("WatchChangeAggregator","Detected inactive target",e),n}Xe(e){const n=this.qe.get(e);return n&&n.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new MV),this.ke.getRemoteKeysForTarget(e).forEach(n=>{this.ze(e,n,null)})}ut(e,n){return this.ke.getRemoteKeysForTarget(e).has(n)}}function Ww(){return new bs(Tt.comparator)}function FV(){return new bs(Tt.comparator)}const Wle={asc:"ASCENDING",desc:"DESCENDING"},zle={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qle={and:"AND",or:"OR"};class Yle{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function VB(t,e){return t.useProto3Json||jS(e)?e:{value:e}}function QB(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function rq(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function dm(t){return $r(!!t),Ft.fromTimestamp(function(n){const r=Sd(n);return new Ss(r.seconds,r.nanos)}(t))}function iq(t,e){return HB(t,e).canonicalString()}function HB(t,e){const n=function(i){return new Yr(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function sq(t){const e=Yr.fromString(t);return $r(lq(e)),e}function dO(t,e){const n=sq(e);if(n.get(1)!==t.databaseId.projectId)throw new at(Me.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new at(Me.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Tt(aq(n))}function oq(t,e){return iq(t.databaseId,e)}function Xle(t){const e=sq(t);return e.length===4?Yr.emptyPath():aq(e)}function VV(t){return new Yr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function aq(t){return $r(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function Jle(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:Qt()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,d){return u.useProto3Json?($r(d===void 0||typeof d=="string"),Qs.fromBase64String(d||"")):($r(d===void 0||d instanceof Buffer||d instanceof Uint8Array),Qs.fromUint8Array(d||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const d=u.code===void 0?Me.UNKNOWN:eq(u.code);return new at(d,u.message||"")}(o);n=new nq(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=dO(t,r.document.name),s=dm(r.document.updateTime),o=r.document.createTime?dm(r.document.createTime):Ft.min(),a=new SA({mapValue:{fields:r.document.fields}}),A=to.newFoundDocument(i,s,o,a),u=r.targetIds||[],d=r.removedTargetIds||[];n=new IT(u,d,A.key,A)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=dO(t,r.document),s=r.readTime?dm(r.readTime):Ft.min(),o=to.newNoDocument(i,s),a=r.removedTargetIds||[];n=new IT([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=dO(t,r.document),s=r.removedTargetIds||[];n=new IT([],s,i,null)}else{if(!("filter"in e))return Qt();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new jle(i,s),a=r.targetId;n=new tq(a,o)}}return n}function $le(t,e){return{documents:[oq(t,e.path)]}}function Zle(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=oq(t,i);const s=function(u){if(u.length!==0)return Aq(zc.create(u,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(u){if(u.length!==0)return u.map(d=>function(m){return{field:Fp(m.field),direction:nue(m.dir)}}(d))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=VB(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(u){return{before:u.inclusive,values:u.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(u){return{before:!u.inclusive,values:u.position}}(e.endAt)),{ht:n,parent:i}}function eue(t){let e=Xle(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){$r(r===1);const d=n.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];n.where&&(s=function(f){const m=cq(f);return m instanceof zc&&Mz(m)?m.getFilters():[m]}(n.where));let o=[];n.orderBy&&(o=function(f){return f.map(m=>function(v){return new I0(Vp(v.field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(v.direction))}(m))}(n.orderBy));let a=null;n.limit&&(a=function(f){let m;return m=typeof f=="object"?f.value:f,jS(m)?null:m}(n.limit));let A=null;n.startAt&&(A=function(f){const m=!!f.before,g=f.values||[];return new b0(g,m)}(n.startAt));let u=null;return n.endAt&&(u=function(f){const m=!f.before,g=f.values||[];return new b0(g,m)}(n.endAt)),Sle(e,i,o,s,a,"F",A,u)}function tue(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Qt()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function cq(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Vp(n.unaryFilter.field);return Gi.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Vp(n.unaryFilter.field);return Gi.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Vp(n.unaryFilter.field);return Gi.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Vp(n.unaryFilter.field);return Gi.create(o,"!=",{nullValue:"NULL_VALUE"});default:return Qt()}}(t):t.fieldFilter!==void 0?function(n){return Gi.create(Vp(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Qt()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return zc.create(n.compositeFilter.filters.map(r=>cq(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return Qt()}}(n.compositeFilter.op))}(t):Qt()}function nue(t){return Wle[t]}function rue(t){return zle[t]}function iue(t){return qle[t]}function Fp(t){return{fieldPath:t.canonicalString()}}function Vp(t){return no.fromServerFormat(t.fieldPath)}function Aq(t){return t instanceof Gi?function(n){if(n.op==="=="){if(IV(n.value))return{unaryFilter:{field:Fp(n.field),op:"IS_NAN"}};if(bV(n.value))return{unaryFilter:{field:Fp(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(IV(n.value))return{unaryFilter:{field:Fp(n.field),op:"IS_NOT_NAN"}};if(bV(n.value))return{unaryFilter:{field:Fp(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fp(n.field),op:rue(n.op),value:n.value}}}(t):t instanceof zc?function(n){const r=n.getFilters().map(i=>Aq(i));return r.length===1?r[0]:{compositeFilter:{op:iue(n.op),filters:r}}}(t):Qt()}function lq(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{constructor(e,n,r,i,s=Ft.min(),o=Ft.min(),a=Qs.EMPTY_BYTE_STRING,A=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=A}withSequenceNumber(e){return new ed(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ed(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ed(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ed(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sue{constructor(e){this.Tt=e}}function oue(t){const e=eue({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?xB(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aue{constructor(){this.Tn=new cue}addToCollectionParentIndex(e,n){return this.Tn.add(n),De.resolve()}getCollectionParents(e,n){return De.resolve(this.Tn.getEntries(n))}addFieldIndex(e,n){return De.resolve()}deleteFieldIndex(e,n){return De.resolve()}deleteAllFieldIndexes(e){return De.resolve()}createTargetIndexes(e,n){return De.resolve()}getDocumentsMatchingTarget(e,n){return De.resolve(null)}getIndexType(e,n){return De.resolve(0)}getFieldIndexes(e,n){return De.resolve([])}getNextCollectionGroupToUpdate(e){return De.resolve(null)}getMinOffset(e,n){return De.resolve(Td.min())}getMinOffsetFromCollectionGroup(e,n){return De.resolve(Td.min())}updateCollectionGroup(e,n,r){return De.resolve()}updateIndexEntries(e,n){return De.resolve()}}class cue{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new as(Yr.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new as(Yr.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QV={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},uq=41943040;class Po{static withCacheSize(e){return new Po(e,Po.DEFAULT_COLLECTION_PERCENTILE,Po.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Po.DEFAULT_COLLECTION_PERCENTILE=10,Po.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Po.DEFAULT=new Po(uq,Po.DEFAULT_COLLECTION_PERCENTILE,Po.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Po.DISABLED=new Po(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new Um(0)}static Kn(){return new Um(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HV="LruGarbageCollector",Aue=1048576;function jV([t,e],[n,r]){const i=on(t,n);return i===0?on(e,r):i}class lue{constructor(e){this.Hn=e,this.buffer=new as(jV),this.Jn=0}Yn(){return++this.Jn}Zn(e){const n=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();jV(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class uue{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){tt(HV,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){ug(n)?tt(HV,"Ignoring IndexedDB error during garbage collection: ",n):await QS(n)}await this.er(3e5)})}}class due{constructor(e,n){this.tr=e,this.params=n}calculateTargetCount(e,n){return this.tr.nr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return De.resolve(HS.ae);const r=new lue(n);return this.tr.forEachTarget(e,i=>r.Zn(i.sequenceNumber)).next(()=>this.tr.rr(e,i=>r.Zn(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.tr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.tr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(tt("LruGarbageCollector","Garbage collection skipped; disabled"),De.resolve(QV)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(tt("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),QV):this.ir(e,n))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,n){let r,i,s,o,a,A,u;const d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(f=>(f>this.params.maximumSequenceNumbersToCollect?(tt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${f}`),i=this.params.maximumSequenceNumbersToCollect):i=f,o=Date.now(),this.nthSequenceNumber(e,i))).next(f=>(r=f,a=Date.now(),this.removeTargets(e,r,n))).next(f=>(s=f,A=Date.now(),this.removeOrphanedDocuments(e,r))).next(f=>(u=Date.now(),xp()<=un.DEBUG&&tt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(A-a)+`ms
	Removed ${f} documents in `+(u-A)+`ms
Total Duration: ${u-d}ms`),De.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:f})))}}function hue(t,e){return new due(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fue{constructor(){this.changes=new vf(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,to.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?De.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pue{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mue{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&RE(r.mutation,i,Zu.empty(),Ss.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Bn()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Bn()){const i=Mh();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let o=tE();return s.forEach((a,A)=>{o=o.insert(a,A.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=Mh();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Bn()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,i){let s=Rd();const o=IE(),a=function(){return IE()}();return n.forEach((A,u)=>{const d=r.get(u.key);i.has(u.key)&&(d===void 0||d.mutation instanceof qS)?s=s.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),RE(d.mutation,u,d.mutation.getFieldMask(),Ss.now())):o.set(u.key,Zu.empty())}),this.recalculateAndSaveOverlays(e,s).next(A=>(A.forEach((u,d)=>o.set(u,d)),n.forEach((u,d)=>{var f;return a.set(u,new pue(d,(f=o.get(u))!==null&&f!==void 0?f:null))}),a))}recalculateAndSaveOverlays(e,n){const r=IE();let i=new bs((o,a)=>o-a),s=Bn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(A=>{const u=n.get(A);if(u===null)return;let d=r.get(A)||Zu.empty();d=a.applyToLocalView(u,d),r.set(A,d);const f=(i.get(a.batchId)||Bn()).add(A);i=i.insert(a.batchId,f)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const A=a.getNext(),u=A.key,d=A.value,f=zz();d.forEach(m=>{if(!s.has(m)){const g=$z(n.get(m),r.get(m));g!==null&&f.set(m,g),s=s.add(m)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,f))}return De.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(o){return Tt.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):jz(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):De.resolve(Mh());let a=iv,A=s;return o.next(u=>De.forEach(u,(d,f)=>(a<f.largestBatchId&&(a=f.largestBatchId),s.get(d)?De.resolve():this.remoteDocumentCache.getEntry(e,d).next(m=>{A=A.insert(d,m)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,A,u,Bn())).next(d=>({batchId:a,changes:Nle(d)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Tt(n)).next(r=>{let i=tE();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const s=n.collectionGroup;let o=tE();return this.indexManager.getCollectionParents(e,s).next(a=>De.forEach(a,A=>{const u=function(f,m){return new ey(m,null,f.explicitOrderBy.slice(),f.filters.slice(),f.limit,f.limitType,f.startAt,f.endAt)}(n,A.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(d=>{d.forEach((f,m)=>{o=o.insert(f,m)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(o=>{s.forEach((A,u)=>{const d=u.getKey();o.get(d)===null&&(o=o.insert(d,to.newInvalidDocument(d)))});let a=tE();return o.forEach((A,u)=>{const d=s.get(A);d!==void 0&&RE(d.mutation,u,Zu.empty(),Ss.now()),WS(n,u)&&(a=a.insert(A,u))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gue{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,n){return De.resolve(this.dr.get(n))}saveBundleMetadata(e,n){return this.dr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:dm(i.createTime)}}(n)),De.resolve()}getNamedQuery(e,n){return De.resolve(this.Ar.get(n))}saveNamedQuery(e,n){return this.Ar.set(n.name,function(i){return{name:i.name,query:oue(i.bundledQuery),readTime:dm(i.readTime)}}(n)),De.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ue{constructor(){this.overlays=new bs(Tt.comparator),this.Rr=new Map}getOverlay(e,n){return De.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Mh();return De.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.Et(e,n,s)}),De.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.Rr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Rr.delete(r)),De.resolve()}getOverlaysForCollection(e,n,r){const i=Mh(),s=n.length+1,o=new Tt(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const A=a.getNext().value,u=A.getKey();if(!n.isPrefixOf(u.path))break;u.path.length===s&&A.largestBatchId>r&&i.set(A.getKey(),A)}return De.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new bs((u,d)=>u-d);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===n&&u.largestBatchId>r){let d=s.get(u.largestBatchId);d===null&&(d=Mh(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}const a=Mh(),A=s.getIterator();for(;A.hasNext()&&(A.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=i)););return De.resolve(a)}Et(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.Rr.get(i.largestBatchId).delete(r.key);this.Rr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Hle(n,r));let s=this.Rr.get(n);s===void 0&&(s=Bn(),this.Rr.set(n,s)),this.Rr.set(n,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eue{constructor(){this.sessionToken=Qs.EMPTY_BYTE_STRING}getSessionToken(e){return De.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,De.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O1{constructor(){this.Vr=new as(Es.mr),this.gr=new as(Es.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,n){const r=new Es(e,n);this.Vr=this.Vr.add(r),this.gr=this.gr.add(r)}yr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.wr(new Es(e,n))}Sr(e,n){e.forEach(r=>this.removeReference(r,n))}br(e){const n=new Tt(new Yr([])),r=new Es(n,e),i=new Es(n,e+1),s=[];return this.gr.forEachInRange([r,i],o=>{this.wr(o),s.push(o.key)}),s}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const n=new Tt(new Yr([])),r=new Es(n,e),i=new Es(n,e+1);let s=Bn();return this.gr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const n=new Es(e,0),r=this.Vr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Es{constructor(e,n){this.key=e,this.Cr=n}static mr(e,n){return Tt.comparator(e.key,n.key)||on(e.Cr,n.Cr)}static pr(e,n){return on(e.Cr,n.Cr)||Tt.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vue{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Fr=1,this.Mr=new as(Es.mr)}checkEmpty(e){return De.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Qle(s,n,r,i);this.mutationQueue.push(o);for(const a of i)this.Mr=this.Mr.add(new Es(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return De.resolve(o)}lookupMutationBatch(e,n){return De.resolve(this.Or(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.Nr(r),s=i<0?0:i;return De.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return De.resolve(this.mutationQueue.length===0?ole:this.Fr-1)}getAllMutationBatches(e){return De.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Es(n,0),i=new Es(n,Number.POSITIVE_INFINITY),s=[];return this.Mr.forEachInRange([r,i],o=>{const a=this.Or(o.Cr);s.push(a)}),De.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new as(on);return n.forEach(i=>{const s=new Es(i,0),o=new Es(i,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([s,o],a=>{r=r.add(a.Cr)})}),De.resolve(this.Br(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;Tt.isDocumentKey(s)||(s=s.child(""));const o=new Es(new Tt(s),0);let a=new as(on);return this.Mr.forEachWhile(A=>{const u=A.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(A.Cr)),!0)},o),De.resolve(this.Br(a))}Br(e){const n=[];return e.forEach(r=>{const i=this.Or(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){$r(this.Lr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Mr;return De.forEach(n.mutations,i=>{const s=new Es(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Mr=r})}qn(e){}containsKey(e,n){const r=new Es(n,0),i=this.Mr.firstAfterOrEqual(r);return De.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,De.resolve()}Lr(e,n){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const n=this.Nr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yue{constructor(e){this.kr=e,this.docs=function(){return new bs(Tt.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,o=this.kr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return De.resolve(r?r.document.mutableCopy():to.newInvalidDocument(n))}getEntries(e,n){let r=Rd();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():to.newInvalidDocument(i))}),De.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=Rd();const o=n.path,a=new Tt(o.child("__id-9223372036854775808__")),A=this.docs.getIteratorFrom(a);for(;A.hasNext();){const{key:u,value:{document:d}}=A.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||nle(tle(d),r)<=0||(i.has(d.key)||WS(n,d))&&(s=s.insert(d.key,d.mutableCopy()))}return De.resolve(s)}getAllFromCollectionGroup(e,n,r,i){Qt()}qr(e,n){return De.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new wue(this)}getSize(e){return De.resolve(this.size)}}class wue extends fue{constructor(e){super(),this.Ir=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.Ir.addEntry(e,i)):this.Ir.removeEntry(r)}),De.waitFor(n)}getFromCache(e,n){return this.Ir.getEntry(e,n)}getAllFromCache(e,n){return this.Ir.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cue{constructor(e){this.persistence=e,this.Qr=new vf(n=>C1(n),T1),this.lastRemoteSnapshotVersion=Ft.min(),this.highestTargetId=0,this.$r=0,this.Ur=new O1,this.targetCount=0,this.Kr=Um.Un()}forEachTarget(e,n){return this.Qr.forEach((r,i)=>n(i)),De.resolve()}getLastRemoteSnapshotVersion(e){return De.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return De.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),De.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.$r&&(this.$r=n),De.resolve()}zn(e){this.Qr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.Kr=new Um(n),this.highestTargetId=n),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,n){return this.zn(n),this.targetCount+=1,De.resolve()}updateTargetData(e,n){return this.zn(n),De.resolve()}removeTargetData(e,n){return this.Qr.delete(n.target),this.Ur.br(n.targetId),this.targetCount-=1,De.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.Qr.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.Qr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),De.waitFor(s).next(()=>i)}getTargetCount(e){return De.resolve(this.targetCount)}getTargetData(e,n){const r=this.Qr.get(n)||null;return De.resolve(r)}addMatchingKeys(e,n,r){return this.Ur.yr(n,r),De.resolve()}removeMatchingKeys(e,n,r){this.Ur.Sr(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),De.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.Ur.br(n),De.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Ur.vr(n);return De.resolve(r)}containsKey(e,n){return De.resolve(this.Ur.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dq{constructor(e,n){this.Wr={},this.overlays={},this.Gr=new HS(0),this.zr=!1,this.zr=!0,this.jr=new Eue,this.referenceDelegate=e(this),this.Hr=new Cue(this),this.indexManager=new aue,this.remoteDocumentCache=function(i){return new yue(i)}(r=>this.referenceDelegate.Jr(r)),this.serializer=new sue(n),this.Yr=new gue(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new _ue,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.Wr[e.toKey()];return r||(r=new vue(n,this.referenceDelegate),this.Wr[e.toKey()]=r),r}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,n,r){tt("MemoryPersistence","Starting transaction:",e);const i=new Tue(this.Gr.next());return this.referenceDelegate.Zr(),r(i).next(s=>this.referenceDelegate.Xr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}ei(e,n){return De.or(Object.values(this.Wr).map(r=>()=>r.containsKey(e,n)))}}class Tue extends ile{constructor(e){super(),this.currentSequenceNumber=e}}class N1{constructor(e){this.persistence=e,this.ti=new O1,this.ni=null}static ri(e){return new N1(e)}get ii(){if(this.ni)return this.ni;throw Qt()}addReference(e,n,r){return this.ti.addReference(r,n),this.ii.delete(r.toString()),De.resolve()}removeReference(e,n,r){return this.ti.removeReference(r,n),this.ii.add(r.toString()),De.resolve()}markPotentiallyOrphaned(e,n){return this.ii.add(n.toString()),De.resolve()}removeTarget(e,n){this.ti.br(n.targetId).forEach(i=>this.ii.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.ii.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}Zr(){this.ni=new Set}Xr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return De.forEach(this.ii,r=>{const i=Tt.fromPath(r);return this.si(e,i).next(s=>{s||n.removeEntry(i,Ft.min())})}).next(()=>(this.ni=null,n.apply(e)))}updateLimboDocument(e,n){return this.si(e,n).next(r=>{r?this.ii.delete(n.toString()):this.ii.add(n.toString())})}Jr(e){return 0}si(e,n){return De.or([()=>De.resolve(this.ti.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.ei(e,n)])}}class N0{constructor(e,n){this.persistence=e,this.oi=new vf(r=>cle(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=hue(this,n)}static ri(e,n){return new N0(e,n)}Zr(){}Xr(e){return De.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}nr(e){const n=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}sr(e){let n=0;return this.rr(e,r=>{n++}).next(()=>n)}rr(e,n){return De.forEach(this.oi,(r,i)=>this.ar(e,r,i).next(s=>s?De.resolve():n(i)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.qr(e,o=>this.ar(e,o,n).next(a=>{a||(r++,s.removeEntry(o,Ft.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.oi.set(n,e.currentSequenceNumber),De.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.oi.set(r,e.currentSequenceNumber),De.resolve()}removeReference(e,n,r){return this.oi.set(r,e.currentSequenceNumber),De.resolve()}updateLimboDocument(e,n){return this.oi.set(n,e.currentSequenceNumber),De.resolve()}Jr(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=ST(e.data.value)),n}ar(e,n,r){return De.or([()=>this.persistence.ei(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.oi.get(n);return De.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D1{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.Hi=r,this.Ji=i}static Yi(e,n){let r=Bn(),i=Bn();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new D1(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sue{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bue{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return nse()?8:sle(io())>0?6:4}()}initialize(e,n){this.ns=e,this.indexManager=n,this.Zi=!0}getDocumentsMatchingQuery(e,n,r,i){const s={result:null};return this.rs(e,n).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ss(e,n,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new Sue;return this._s(e,n,o).next(a=>{if(s.result=a,this.Xi)return this.us(e,n,o,a.size)})}).next(()=>s.result)}us(e,n,r,i){return r.documentReadCount<this.es?(xp()<=un.DEBUG&&tt("QueryEngine","SDK will not create cache indexes for query:",Mp(n),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),De.resolve()):(xp()<=un.DEBUG&&tt("QueryEngine","Query:",Mp(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.ts*i?(xp()<=un.DEBUG&&tt("QueryEngine","The SDK decides to create cache indexes for query:",Mp(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,PA(n))):De.resolve())}rs(e,n){if(DV(n))return De.resolve(null);let r=PA(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=xB(n,null,"F"),r=PA(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=Bn(...s);return this.ns.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(A=>{const u=this.cs(n,a);return this.ls(n,u,o,A.readTime)?this.rs(e,xB(n,null,"F")):this.hs(e,u,n,A)}))})))}ss(e,n,r,i){return DV(n)||i.isEqual(Ft.min())?De.resolve(null):this.ns.getDocuments(e,r).next(s=>{const o=this.cs(n,s);return this.ls(n,o,r,i)?De.resolve(null):(xp()<=un.DEBUG&&tt("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Mp(n)),this.hs(e,o,n,ele(i,iv)).next(a=>a))})}cs(e,n){let r=new as(Gz(e));return n.forEach((i,s)=>{WS(e,s)&&(r=r.add(s))}),r}ls(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}_s(e,n,r){return xp()<=un.DEBUG&&tt("QueryEngine","Using full collection scan to execute query:",Mp(n)),this.ns.getDocumentsMatchingQuery(e,n,Td.min(),r)}hs(e,n,r,i){return this.ns.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(o=>{s=s.insert(o.key,o)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B1="LocalStore",Iue=3e8;class Rue{constructor(e,n,r,i){this.persistence=e,this.Ps=n,this.serializer=i,this.Ts=new bs(on),this.Is=new vf(s=>C1(s),T1),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(r)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new mue(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ts))}}function Oue(t,e,n,r){return new Rue(t,e,n,r)}async function hq(t,e){const n=Rn(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.As(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let A=Bn();for(const u of i){o.push(u.batchId);for(const d of u.mutations)A=A.add(d.key)}for(const u of s){a.push(u.batchId);for(const d of u.mutations)A=A.add(d.key)}return n.localDocuments.getDocuments(r,A).next(u=>({Rs:u,removedBatchIds:o,addedBatchIds:a}))})})}function fq(t){const e=Rn(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Hr.getLastRemoteSnapshotVersion(n))}function Nue(t,e){const n=Rn(t),r=e.snapshotVersion;let i=n.Ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=n.ds.newChangeBuffer({trackRemovals:!0});i=n.Ts;const a=[];e.targetChanges.forEach((d,f)=>{const m=i.get(f);if(!m)return;a.push(n.Hr.removeMatchingKeys(s,d.removedDocuments,f).next(()=>n.Hr.addMatchingKeys(s,d.addedDocuments,f)));let g=m.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(f)!==null?g=g.withResumeToken(Qs.EMPTY_BYTE_STRING,Ft.min()).withLastLimboFreeSnapshotVersion(Ft.min()):d.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(d.resumeToken,r)),i=i.insert(f,g),function(y,w,b){return y.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=Iue?!0:b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size>0}(m,g,d)&&a.push(n.Hr.updateTargetData(s,g))});let A=Rd(),u=Bn();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(Due(s,o,e.documentUpdates).next(d=>{A=d.Vs,u=d.fs})),!r.isEqual(Ft.min())){const d=n.Hr.getLastRemoteSnapshotVersion(s).next(f=>n.Hr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return De.waitFor(a).next(()=>o.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,A,u)).next(()=>A)}).then(s=>(n.Ts=i,s))}function Due(t,e,n){let r=Bn(),i=Bn();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let o=Rd();return n.forEach((a,A)=>{const u=s.get(a);A.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),A.isNoDocument()&&A.version.isEqual(Ft.min())?(e.removeEntry(a,A.readTime),o=o.insert(a,A)):!u.isValidDocument()||A.version.compareTo(u.version)>0||A.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(A),o=o.insert(a,A)):tt(B1,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",A.version)}),{Vs:o,fs:i}})}function Bue(t,e){const n=Rn(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Hr.getTargetData(r,e).next(s=>s?(i=s,De.resolve(i)):n.Hr.allocateTargetId(r).next(o=>(i=new ed(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Hr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.Ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ts=n.Ts.insert(r.targetId,r),n.Is.set(e,r.targetId)),r})}async function jB(t,e,n){const r=Rn(t),i=r.Ts.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!ug(o))throw o;tt(B1,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ts=r.Ts.remove(e),r.Is.delete(i.target)}function KV(t,e,n){const r=Rn(t);let i=Ft.min(),s=Bn();return r.persistence.runTransaction("Execute query","readwrite",o=>function(A,u,d){const f=Rn(A),m=f.Is.get(d);return m!==void 0?De.resolve(f.Ts.get(m)):f.Hr.getTargetData(u,d)}(r,o,PA(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(o,a.targetId).next(A=>{s=A})}).next(()=>r.Ps.getDocumentsMatchingQuery(o,e,n?i:Ft.min(),n?s:Bn())).next(a=>(Lue(r,Ile(e),a),{documents:a,gs:s})))}function Lue(t,e,n){let r=t.Es.get(e)||Ft.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.Es.set(e,r)}class GV{constructor(){this.activeTargetIds=Lle()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Uue{constructor(){this.ho=new GV,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,n,r){this.Po[e]=n}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new GV,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pue{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WV="ConnectivityMonitor";class zV{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){tt(WV,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){tt(WV,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zw=null;function KB(){return zw===null?zw=function(){return 268435456+Math.round(2147483648*Math.random())}():zw++,"0x"+zw.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hO="RestConnection",kue={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xue{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.po=n+"://"+e.host,this.yo=`projects/${r}/databases/${i}`,this.wo=this.databaseId.database===T0?`project_id=${r}`:`project_id=${r}&database_id=${i}`}So(e,n,r,i,s){const o=KB(),a=this.bo(e,n.toUriEncodedString());tt(hO,`Sending RPC '${e}' ${o}:`,a,r);const A={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(A,i,s),this.vo(e,a,A,r).then(u=>(tt(hO,`Received RPC '${e}' ${o}: `,u),u),u=>{throw Nm(hO,`RPC '${e}' ${o} failed with error: `,u,"url: ",a,"request:",r),u})}Co(e,n,r,i,s,o){return this.So(e,n,r,i,s)}Do(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+lg}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}bo(e,n){const r=kue[e];return`${this.po}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mue{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qs="WebChannelConnection";class Fue extends xue{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,n,r,i){const s=KB();return new Promise((o,a)=>{const A=new vz;A.setWithCredentials(!0),A.listenOnce(yz.COMPLETE,()=>{try{switch(A.getLastErrorCode()){case TT.NO_ERROR:const d=A.getResponseJson();tt(qs,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(d)),o(d);break;case TT.TIMEOUT:tt(qs,`RPC '${e}' ${s} timed out`),a(new at(Me.DEADLINE_EXCEEDED,"Request time out"));break;case TT.HTTP_ERROR:const f=A.getStatus();if(tt(qs,`RPC '${e}' ${s} failed with status:`,f,"response text:",A.getResponseText()),f>0){let m=A.getResponseJson();Array.isArray(m)&&(m=m[0]);const g=m==null?void 0:m.error;if(g&&g.status&&g.message){const v=function(w){const b=w.toLowerCase().replace(/_/g,"-");return Object.values(Me).indexOf(b)>=0?b:Me.UNKNOWN}(g.status);a(new at(v,g.message))}else a(new at(Me.UNKNOWN,"Server responded with status "+A.getStatus()))}else a(new at(Me.UNAVAILABLE,"Connection failed."));break;default:Qt()}}finally{tt(qs,`RPC '${e}' ${s} completed.`)}});const u=JSON.stringify(i);tt(qs,`RPC '${e}' ${s} sending request:`,i),A.send(n,"POST",u,r,15)})}Wo(e,n,r){const i=KB(),s=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Tz(),a=Cz(),A={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(A.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(A.useFetchStreams=!0),this.Do(A.initMessageHeaders,n,r),A.encodeInitMessageHeaders=!0;const d=s.join("");tt(qs,`Creating RPC '${e}' stream ${i}: ${d}`,A);const f=o.createWebChannel(d,A);let m=!1,g=!1;const v=new Mue({Fo:w=>{g?tt(qs,`Not sending because RPC '${e}' stream ${i} is closed:`,w):(m||(tt(qs,`Opening RPC '${e}' stream ${i} transport.`),f.open(),m=!0),tt(qs,`RPC '${e}' stream ${i} sending:`,w),f.send(w))},Mo:()=>f.close()}),y=(w,b,I)=>{w.listen(b,B=>{try{I(B)}catch(M){setTimeout(()=>{throw M},0)}})};return y(f,eE.EventType.OPEN,()=>{g||(tt(qs,`RPC '${e}' stream ${i} transport opened.`),v.Qo())}),y(f,eE.EventType.CLOSE,()=>{g||(g=!0,tt(qs,`RPC '${e}' stream ${i} transport closed`),v.Uo())}),y(f,eE.EventType.ERROR,w=>{g||(g=!0,Nm(qs,`RPC '${e}' stream ${i} transport errored:`,w),v.Uo(new at(Me.UNAVAILABLE,"The operation could not be completed")))}),y(f,eE.EventType.MESSAGE,w=>{var b;if(!g){const I=w.data[0];$r(!!I);const B=I,M=(B==null?void 0:B.error)||((b=B[0])===null||b===void 0?void 0:b.error);if(M){tt(qs,`RPC '${e}' stream ${i} received error:`,M);const H=M.status;let K=function(k){const G=ji[k];if(G!==void 0)return eq(G)}(H),Q=M.message;K===void 0&&(K=Me.INTERNAL,Q="Unknown error status: "+H+" with message "+M.message),g=!0,v.Uo(new at(K,Q)),f.close()}else tt(qs,`RPC '${e}' stream ${i} received:`,I),v.Ko(I)}}),y(a,wz.STAT_EVENT,w=>{w.stat===OB.PROXY?tt(qs,`RPC '${e}' stream ${i} detected buffering proxy`):w.stat===OB.NOPROXY&&tt(qs,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{v.$o()},0),v}}function fO(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XS(t){return new Yle(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pq{constructor(e,n,r=1e3,i=1.5,s=6e4){this.Ti=e,this.timerId=n,this.Go=r,this.zo=i,this.jo=s,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const n=Math.floor(this.Ho+this.e_()),r=Math.max(0,Date.now()-this.Yo),i=Math.max(0,n-r);i>0&&tt("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ho} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,i,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qV="PersistentStream";class Vue{constructor(e,n,r,i,s,o,a,A){this.Ti=e,this.n_=r,this.r_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=A,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new pq(e,n)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,n){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():n&&n.code===Me.RESOURCE_EXHAUSTED?(Yl(n.toString()),Yl("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):n&&n.code===Me.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(n)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),n=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.i_===n&&this.V_(r,i)},r=>{e(()=>{const i=new at(Me.UNKNOWN,"Fetching auth token failed: "+r.message);return this.m_(i)})})}V_(e,n){const r=this.R_(this.i_);this.stream=this.f_(e,n),this.stream.xo(()=>{r(()=>this.listener.xo())}),this.stream.No(()=>{r(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(i=>{r(()=>this.m_(i))}),this.stream.onMessage(i=>{r(()=>++this.__==1?this.g_(i):this.onNext(i))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return tt(qV,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return n=>{this.Ti.enqueueAndForget(()=>this.i_===e?n():(tt(qV,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Que extends Vue{constructor(e,n,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,o),this.serializer=s}f_(e,n){return this.connection.Wo("Listen",e,n)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const n=Jle(this.serializer,e),r=function(s){if(!("targetChange"in s))return Ft.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?Ft.min():o.readTime?dm(o.readTime):Ft.min()}(e);return this.listener.p_(n,r)}y_(e){const n={};n.database=VV(this.serializer),n.addTarget=function(s,o){let a;const A=o.target;if(a=PB(A)?{documents:$le(s,A)}:{query:Zle(s,A).ht},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=rq(s,o.resumeToken);const u=VB(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(Ft.min())>0){a.readTime=QB(s,o.snapshotVersion.toTimestamp());const u=VB(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=tue(this.serializer,e);r&&(n.labels=r),this.I_(n)}w_(e){const n={};n.database=VV(this.serializer),n.removeTarget=e,this.I_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hue{}class jue extends Hue{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.F_=!1}M_(){if(this.F_)throw new at(Me.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,n,r,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,HB(n,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===Me.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new at(Me.UNKNOWN,s.toString())})}Co(e,n,r,i,s){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Co(e,HB(n,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Me.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new at(Me.UNKNOWN,o.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class Kue{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Yl(n),this.N_=!1):tt("OnlineStateTracker",n)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pm="RemoteStore";class Gue{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=s,this.z_.To(o=>{r.enqueueAndForget(async()=>{ry(this)&&(tt(Pm,"Restarting streams for network reachability change."),await async function(A){const u=Rn(A);u.W_.add(4),await ny(u),u.j_.set("Unknown"),u.W_.delete(4),await JS(u)}(this))})}),this.j_=new Kue(r,i)}}async function JS(t){if(ry(t))for(const e of t.G_)await e(!0)}async function ny(t){for(const e of t.G_)await e(!1)}function mq(t,e){const n=Rn(t);n.K_.has(e.targetId)||(n.K_.set(e.targetId,e),k1(n)?P1(n):hg(n).c_()&&U1(n,e))}function L1(t,e){const n=Rn(t),r=hg(n);n.K_.delete(e),r.c_()&&gq(n,e),n.K_.size===0&&(r.c_()?r.P_():ry(n)&&n.j_.set("Unknown"))}function U1(t,e){if(t.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Ft.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}hg(t).y_(e)}function gq(t,e){t.H_.Ne(e),hg(t).w_(e)}function P1(t){t.H_=new Gle({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>t.K_.get(e)||null,it:()=>t.datastore.serializer.databaseId}),hg(t).start(),t.j_.B_()}function k1(t){return ry(t)&&!hg(t).u_()&&t.K_.size>0}function ry(t){return Rn(t).W_.size===0}function _q(t){t.H_=void 0}async function Wue(t){t.j_.set("Online")}async function zue(t){t.K_.forEach((e,n)=>{U1(t,e)})}async function que(t,e){_q(t),k1(t)?(t.j_.q_(e),P1(t)):t.j_.set("Unknown")}async function Yue(t,e,n){if(t.j_.set("Online"),e instanceof nq&&e.state===2&&e.cause)try{await async function(i,s){const o=s.cause;for(const a of s.targetIds)i.K_.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.K_.delete(a),i.H_.removeTarget(a))}(t,e)}catch(r){tt(Pm,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await YV(t,r)}else if(e instanceof IT?t.H_.We(e):e instanceof tq?t.H_.Ze(e):t.H_.je(e),!n.isEqual(Ft.min()))try{const r=await fq(t.localStore);n.compareTo(r)>=0&&await function(s,o){const a=s.H_.ot(o);return a.targetChanges.forEach((A,u)=>{if(A.resumeToken.approximateByteSize()>0){const d=s.K_.get(u);d&&s.K_.set(u,d.withResumeToken(A.resumeToken,o))}}),a.targetMismatches.forEach((A,u)=>{const d=s.K_.get(A);if(!d)return;s.K_.set(A,d.withResumeToken(Qs.EMPTY_BYTE_STRING,d.snapshotVersion)),gq(s,A);const f=new ed(d.target,A,u,d.sequenceNumber);U1(s,f)}),s.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(r){tt(Pm,"Failed to raise snapshot:",r),await YV(t,r)}}async function YV(t,e,n){if(!ug(e))throw e;t.W_.add(1),await ny(t),t.j_.set("Offline"),n||(n=()=>fq(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{tt(Pm,"Retrying IndexedDB access"),await n(),t.W_.delete(1),await JS(t)})}async function XV(t,e){const n=Rn(t);n.asyncQueue.verifyOperationInProgress(),tt(Pm,"RemoteStore received new credentials");const r=ry(n);n.W_.add(3),await ny(n),r&&n.j_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.W_.delete(3),await JS(n)}async function Xue(t,e){const n=Rn(t);e?(n.W_.delete(2),await JS(n)):e||(n.W_.add(2),await ny(n),n.j_.set("Unknown"))}function hg(t){return t.J_||(t.J_=function(n,r,i){const s=Rn(n);return s.M_(),new Que(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{xo:Wue.bind(null,t),No:zue.bind(null,t),Lo:que.bind(null,t),p_:Yue.bind(null,t)}),t.G_.push(async e=>{e?(t.J_.h_(),k1(t)?P1(t):t.j_.set("Unknown")):(await t.J_.stop(),_q(t))})),t.J_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x1{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Xh,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){const o=Date.now()+r,a=new x1(e,n,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new at(Me.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Eq(t,e){if(Yl("AsyncQueue",`${e}: ${t}`),ug(t))return new at(Me.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hm{static emptySet(e){return new hm(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||Tt.comparator(n.key,r.key):(n,r)=>Tt.comparator(n.key,r.key),this.keyedMap=tE(),this.sortedSet=new bs(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof hm)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new hm;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JV{constructor(){this.Z_=new bs(Tt.comparator)}track(e){const n=e.doc.key,r=this.Z_.get(n);r?e.type!==0&&r.type===3?this.Z_=this.Z_.insert(n,e):e.type===3&&r.type!==1?this.Z_=this.Z_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Z_=this.Z_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Z_=this.Z_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Z_=this.Z_.remove(n):e.type===1&&r.type===2?this.Z_=this.Z_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Z_=this.Z_.insert(n,{type:2,doc:e.doc}):Qt():this.Z_=this.Z_.insert(n,e)}X_(){const e=[];return this.Z_.inorderTraversal((n,r)=>{e.push(r)}),e}}class km{constructor(e,n,r,i,s,o,a,A,u){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=A,this.hasCachedResults=u}static fromInitialDocuments(e,n,r,i,s){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new km(e,n,hm.emptySet(n),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&GS(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jue{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class $ue{constructor(){this.queries=$V(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(n,r){const i=Rn(n),s=i.queries;i.queries=$V(),s.forEach((o,a)=>{for(const A of a.ta)A.onError(r)})})(this,new at(Me.ABORTED,"Firestore shutting down"))}}function $V(){return new vf(t=>Kz(t),GS)}async function Zue(t,e){const n=Rn(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.na()&&e.ra()&&(r=2):(s=new Jue,r=e.ra()?0:1);try{switch(r){case 0:s.ea=await n.onListen(i,!0);break;case 1:s.ea=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(o){const a=Eq(o,`Initialization of query '${Mp(e.query)}' failed`);return void e.onError(a)}n.queries.set(i,s),s.ta.push(e),e.sa(n.onlineState),s.ea&&e.oa(s.ea)&&M1(n)}async function ede(t,e){const n=Rn(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const o=s.ta.indexOf(e);o>=0&&(s.ta.splice(o,1),s.ta.length===0?i=e.ra()?0:1:!s.na()&&e.ra()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function tde(t,e){const n=Rn(t);let r=!1;for(const i of e){const s=i.query,o=n.queries.get(s);if(o){for(const a of o.ta)a.oa(i)&&(r=!0);o.ea=i}}r&&M1(n)}function nde(t,e,n){const r=Rn(t),i=r.queries.get(e);if(i)for(const s of i.ta)s.onError(n);r.queries.delete(e)}function M1(t){t.ia.forEach(e=>{e.next()})}var GB,ZV;(ZV=GB||(GB={}))._a="default",ZV.Cache="cache";class rde{constructor(e,n,r){this.query=e,this.aa=n,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=r||{}}oa(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new km(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.ua?this.la(e)&&(this.aa.next(e),n=!0):this.ha(e,this.onlineState)&&(this.Pa(e),n=!0),this.ca=e,n}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let n=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),n=!0),n}ha(e,n){if(!e.fromCache||!this.ra())return!0;const r=n!=="Offline";return(!this.options.Ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}la(e){if(e.docChanges.length>0)return!0;const n=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}Pa(e){e=km.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==GB.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vq{constructor(e){this.key=e}}class yq{constructor(e){this.key=e}}class ide{constructor(e,n){this.query=e,this.fa=n,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Bn(),this.mutatedKeys=Bn(),this.ya=Gz(e),this.wa=new hm(this.ya)}get Sa(){return this.fa}ba(e,n){const r=n?n.Da:new JV,i=n?n.wa:this.wa;let s=n?n.mutatedKeys:this.mutatedKeys,o=i,a=!1;const A=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,f)=>{const m=i.get(d),g=WS(this.query,f)?f:null,v=!!m&&this.mutatedKeys.has(m.key),y=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let w=!1;m&&g?m.data.isEqual(g.data)?v!==y&&(r.track({type:3,doc:g}),w=!0):this.va(m,g)||(r.track({type:2,doc:g}),w=!0,(A&&this.ya(g,A)>0||u&&this.ya(g,u)<0)&&(a=!0)):!m&&g?(r.track({type:0,doc:g}),w=!0):m&&!g&&(r.track({type:1,doc:m}),w=!0,(A||u)&&(a=!0)),w&&(g?(o=o.add(g),s=y?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{wa:o,Da:r,ls:a,mutatedKeys:s}}va(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const s=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const o=e.Da.X_();o.sort((d,f)=>function(g,v){const y=w=>{switch(w){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Qt()}};return y(g)-y(v)}(d.type,f.type)||this.ya(d.doc,f.doc)),this.Ca(r),i=i!=null&&i;const a=n&&!i?this.Fa():[],A=this.pa.size===0&&this.current&&!i?1:0,u=A!==this.ga;return this.ga=A,o.length!==0||u?{snapshot:new km(this.query,e.wa,s,o,e.mutatedKeys,A===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ma:a}:{Ma:a}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new JV,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(n=>this.fa=this.fa.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.fa=this.fa.delete(n)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Bn(),this.wa.forEach(r=>{this.xa(r.key)&&(this.pa=this.pa.add(r.key))});const n=[];return e.forEach(r=>{this.pa.has(r)||n.push(new yq(r))}),this.pa.forEach(r=>{e.has(r)||n.push(new vq(r))}),n}Oa(e){this.fa=e.gs,this.pa=Bn();const n=this.ba(e.documents);return this.applyChanges(n,!0)}Na(){return km.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const F1="SyncEngine";class sde{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class ode{constructor(e){this.key=e,this.Ba=!1}}class ade{constructor(e,n,r,i,s,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.La={},this.ka=new vf(a=>Kz(a),GS),this.qa=new Map,this.Qa=new Set,this.$a=new bs(Tt.comparator),this.Ua=new Map,this.Ka=new O1,this.Wa={},this.Ga=new Map,this.za=Um.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function cde(t,e,n=!0){const r=bq(t);let i;const s=r.ka.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Na()):i=await wq(r,e,n,!0),i}async function Ade(t,e){const n=bq(t);await wq(n,e,!0,!1)}async function wq(t,e,n,r){const i=await Bue(t.localStore,PA(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await lde(t,e,s,o==="current",i.resumeToken)),t.isPrimaryClient&&n&&mq(t.remoteStore,i),a}async function lde(t,e,n,r,i){t.Ha=(f,m,g)=>async function(y,w,b,I){let B=w.view.ba(b);B.ls&&(B=await KV(y.localStore,w.query,!1).then(({documents:Q})=>w.view.ba(Q,B)));const M=I&&I.targetChanges.get(w.targetId),H=I&&I.targetMismatches.get(w.targetId)!=null,K=w.view.applyChanges(B,y.isPrimaryClient,M,H);return tQ(y,w.targetId,K.Ma),K.snapshot}(t,f,m,g);const s=await KV(t.localStore,e,!0),o=new ide(e,s.gs),a=o.ba(s.documents),A=ty.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),u=o.applyChanges(a,t.isPrimaryClient,A);tQ(t,n,u.Ma);const d=new sde(e,n,o);return t.ka.set(e,d),t.qa.has(n)?t.qa.get(n).push(e):t.qa.set(n,[e]),u.snapshot}async function ude(t,e,n){const r=Rn(t),i=r.ka.get(e),s=r.qa.get(i.targetId);if(s.length>1)return r.qa.set(i.targetId,s.filter(o=>!GS(o,e))),void r.ka.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await jB(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&L1(r.remoteStore,i.targetId),WB(r,i.targetId)}).catch(QS)):(WB(r,i.targetId),await jB(r.localStore,i.targetId,!0))}async function dde(t,e){const n=Rn(t),r=n.ka.get(e),i=n.qa.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),L1(n.remoteStore,r.targetId))}async function Cq(t,e){const n=Rn(t);try{const r=await Nue(n.localStore,e);e.targetChanges.forEach((i,s)=>{const o=n.Ua.get(s);o&&($r(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Ba=!0:i.modifiedDocuments.size>0?$r(o.Ba):i.removedDocuments.size>0&&($r(o.Ba),o.Ba=!1))}),await Sq(n,r,e)}catch(r){await QS(r)}}function eQ(t,e,n){const r=Rn(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.ka.forEach((s,o)=>{const a=o.view.sa(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const A=Rn(o);A.onlineState=a;let u=!1;A.queries.forEach((d,f)=>{for(const m of f.ta)m.sa(a)&&(u=!0)}),u&&M1(A)}(r.eventManager,e),i.length&&r.La.p_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function hde(t,e,n){const r=Rn(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Ua.get(e),s=i&&i.key;if(s){let o=new bs(Tt.comparator);o=o.insert(s,to.newNoDocument(s,Ft.min()));const a=Bn().add(s),A=new YS(Ft.min(),new Map,new bs(on),o,a);await Cq(r,A),r.$a=r.$a.remove(s),r.Ua.delete(e),V1(r)}else await jB(r.localStore,e,!1).then(()=>WB(r,e,n)).catch(QS)}function WB(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.qa.get(e))t.ka.delete(r),n&&t.La.Ja(r,n);t.qa.delete(e),t.isPrimaryClient&&t.Ka.br(e).forEach(r=>{t.Ka.containsKey(r)||Tq(t,r)})}function Tq(t,e){t.Qa.delete(e.path.canonicalString());const n=t.$a.get(e);n!==null&&(L1(t.remoteStore,n),t.$a=t.$a.remove(e),t.Ua.delete(n),V1(t))}function tQ(t,e,n){for(const r of n)r instanceof vq?(t.Ka.addReference(r.key,e),fde(t,r)):r instanceof yq?(tt(F1,"Document no longer in limbo: "+r.key),t.Ka.removeReference(r.key,e),t.Ka.containsKey(r.key)||Tq(t,r.key)):Qt()}function fde(t,e){const n=e.key,r=n.path.canonicalString();t.$a.get(n)||t.Qa.has(r)||(tt(F1,"New document in limbo: "+n),t.Qa.add(r),V1(t))}function V1(t){for(;t.Qa.size>0&&t.$a.size<t.maxConcurrentLimboResolutions;){const e=t.Qa.values().next().value;t.Qa.delete(e);const n=new Tt(Yr.fromString(e)),r=t.za.next();t.Ua.set(r,new ode(n)),t.$a=t.$a.insert(n,r),mq(t.remoteStore,new ed(PA(Hz(n.path)),r,"TargetPurposeLimboResolution",HS.ae))}}async function Sq(t,e,n){const r=Rn(t),i=[],s=[],o=[];r.ka.isEmpty()||(r.ka.forEach((a,A)=>{o.push(r.Ha(A,e,n).then(u=>{var d;if((u||n)&&r.isPrimaryClient){const f=u?!u.fromCache:(d=n==null?void 0:n.targetChanges.get(A.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(A.targetId,f?"current":"not-current")}if(u){i.push(u);const f=D1.Yi(A.targetId,u);s.push(f)}}))}),await Promise.all(o),r.La.p_(i),await async function(A,u){const d=Rn(A);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",f=>De.forEach(u,m=>De.forEach(m.Hi,g=>d.persistence.referenceDelegate.addReference(f,m.targetId,g)).next(()=>De.forEach(m.Ji,g=>d.persistence.referenceDelegate.removeReference(f,m.targetId,g)))))}catch(f){if(!ug(f))throw f;tt(B1,"Failed to update sequence numbers: "+f)}for(const f of u){const m=f.targetId;if(!f.fromCache){const g=d.Ts.get(m),v=g.snapshotVersion,y=g.withLastLimboFreeSnapshotVersion(v);d.Ts=d.Ts.insert(m,y)}}}(r.localStore,s))}async function pde(t,e){const n=Rn(t);if(!n.currentUser.isEqual(e)){tt(F1,"User change. New user:",e.toKey());const r=await hq(n.localStore,e);n.currentUser=e,function(s,o){s.Ga.forEach(a=>{a.forEach(A=>{A.reject(new at(Me.CANCELLED,o))})}),s.Ga.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Sq(n,r.Rs)}}function mde(t,e){const n=Rn(t),r=n.Ua.get(e);if(r&&r.Ba)return Bn().add(r.key);{let i=Bn();const s=n.qa.get(e);if(!s)return i;for(const o of s){const a=n.ka.get(o);i=i.unionWith(a.view.Sa)}return i}}function bq(t){const e=Rn(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Cq.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=mde.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=hde.bind(null,e),e.La.p_=tde.bind(null,e.eventManager),e.La.Ja=nde.bind(null,e.eventManager),e}class D0{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=XS(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,n){return null}nu(e,n){return null}eu(e){return Oue(this.persistence,new bue,e.initialUser,this.serializer)}Xa(e){return new dq(N1.ri,this.serializer)}Za(e){return new Uue}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}D0.provider={build:()=>new D0};class gde extends D0{constructor(e){super(),this.cacheSizeBytes=e}tu(e,n){$r(this.persistence.referenceDelegate instanceof N0);const r=this.persistence.referenceDelegate.garbageCollector;return new uue(r,e.asyncQueue,n)}Xa(e){const n=this.cacheSizeBytes!==void 0?Po.withCacheSize(this.cacheSizeBytes):Po.DEFAULT;return new dq(r=>N0.ri(r,n),this.serializer)}}class zB{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>eQ(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=pde.bind(null,this.syncEngine),await Xue(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new $ue}()}createDatastore(e){const n=XS(e.databaseInfo.databaseId),r=function(s){return new Fue(s)}(e.databaseInfo);return function(s,o,a,A){return new jue(s,o,a,A)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,o,a){return new Gue(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>eQ(this.syncEngine,n,0),function(){return zV.D()?new zV:new Pue}())}createSyncEngine(e,n){return function(i,s,o,a,A,u,d){const f=new ade(i,s,o,a,A,u);return d&&(f.ja=!0),f}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const s=Rn(i);tt(Pm,"RemoteStore shutting down."),s.W_.add(5),await ny(s),s.z_.shutdown(),s.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}zB.provider={build:()=>new zB};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _de{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Yl("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Od="FirestoreClient";class Ede{constructor(e,n,r,i,s){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=$s.UNAUTHENTICATED,this.clientId=JAe.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async o=>{tt(Od,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(tt(Od,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Xh;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Eq(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function pO(t,e){t.asyncQueue.verifyOperationInProgress(),tt(Od,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await hq(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function nQ(t,e){t.asyncQueue.verifyOperationInProgress();const n=await vde(t);tt(Od,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>XV(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>XV(e.remoteStore,i)),t._onlineComponents=e}async function vde(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){tt(Od,"Using user provided OfflineComponentProvider");try{await pO(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===Me.FAILED_PRECONDITION||i.code===Me.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;Nm("Error using user provided cache. Falling back to memory cache: "+n),await pO(t,new D0)}}else tt(Od,"Using default OfflineComponentProvider"),await pO(t,new gde(void 0));return t._offlineComponents}async function yde(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(tt(Od,"Using user provided OnlineComponentProvider"),await nQ(t,t._uninitializedComponentsProvider._online)):(tt(Od,"Using default OnlineComponentProvider"),await nQ(t,new zB))),t._onlineComponents}async function wde(t){const e=await yde(t),n=e.eventManager;return n.onListen=cde.bind(null,e.syncEngine),n.onUnlisten=ude.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Ade.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=dde.bind(null,e.syncEngine),n}function Cde(t,e,n={}){const r=new Xh;return t.asyncQueue.enqueueAndForget(async()=>function(s,o,a,A,u){const d=new _de({next:m=>{d.su(),o.enqueueAndForget(()=>ede(s,f)),m.fromCache&&A.source==="server"?u.reject(new at(Me.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(m)},error:m=>u.reject(m)}),f=new rde(a,d,{includeMetadataChanges:!0,Ta:!0});return Zue(s,f)}(await wde(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iq(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rQ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tde(t,e,n){if(!n)throw new at(Me.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Sde(t,e,n,r){if(e===!0&&r===!0)throw new at(Me.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function iQ(t){if(Tt.isDocumentKey(t))throw new at(Me.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function $S(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Qt()}function qB(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new at(Me.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=$S(t);throw new at(Me.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rq="firestore.googleapis.com",sQ=!0;class oQ{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new at(Me.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Rq,this.ssl=sQ}else this.host=e.host,this.ssl=(n=e.ssl)!==null&&n!==void 0?n:sQ;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=uq;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Aue)throw new at(Me.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Sde("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Iq((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new at(Me.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new at(Me.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new at(Me.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Q1{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new oQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new at(Me.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new at(Me.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new oQ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new KAe;switch(r.type){case"firstParty":return new qAe(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new at(Me.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=rQ.get(n);r&&(tt("ComponentProvider","Removing Datastore"),rQ.delete(n),r.terminate())}(this),Promise.resolve()}}function bde(t,e,n,r={}){var i;const s=(t=qB(t,Q1))._getSettings(),o=Object.assign(Object.assign({},s),{emulatorOptions:t._getEmulatorOptions()}),a=`${e}:${n}`;s.host!==Rq&&s.host!==a&&Nm("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const A=Object.assign(Object.assign({},s),{host:a,ssl:!1,emulatorOptions:r});if(!Gl(A,o)&&(t._setSettings(A),r.mockUserToken)){let u,d;if(typeof r.mockUserToken=="string")u=r.mockUserToken,d=$s.MOCK_USER;else{u=n1(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new at(Me.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new $s(f)}t._authCredentials=new GAe(new Sz(u,d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new fg(this.firestore,e,this._query)}}class tu{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new tu(this.firestore,e,this._key)}}class fm extends fg{constructor(e,n,r){super(e,n,Hz(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new tu(this.firestore,null,new Tt(e))}withConverter(e){return new fm(this.firestore,e,this._path)}}function Oq(t,e,...n){if(t=pi(t),Tde("collection","path",e),t instanceof Q1){const r=Yr.fromString(e,...n);return iQ(r),new fm(t,null,r)}{if(!(t instanceof tu||t instanceof fm))throw new at(Me.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Yr.fromString(e,...n));return iQ(r),new fm(t.firestore,null,r)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aQ="AsyncQueue";class cQ{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new pq(this,"async_queue_retry"),this.Su=()=>{const r=fO();r&&tt(aQ,"Visibility state changed to "+r.visibilityState),this.a_.t_()},this.bu=e;const n=fO();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const n=fO();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const n=new Xh;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!ug(e))throw e;tt(aQ,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const n=this.bu.then(()=>(this.pu=!0,e().catch(r=>{this.gu=r,this.pu=!1;const i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw Yl("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.pu=!1,r))));return this.bu=n,n}enqueueAfterDelay(e,n,r){this.Du(),this.wu.indexOf(e)>-1&&(n=0);const i=x1.createAndSchedule(this,e,n,r,s=>this.Fu(s));return this.fu.push(i),i}Du(){this.gu&&Qt()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const n of this.fu)if(n.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.fu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const n=this.fu.indexOf(e);this.fu.splice(n,1)}}class Nq extends Q1{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new cQ,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new cQ(e),this._firestoreClient=void 0,await e}}}function Ide(t,e){const n=typeof t=="object"?t:Xv(),r=typeof t=="string"?t:T0,i=eu(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=t1("firestore");s&&bde(i,...s)}return i}function Rde(t){if(t._terminated)throw new at(Me.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||Ode(t),t._firestoreClient}function Ode(t){var e,n,r;const i=t._freezeSettings(),s=function(a,A,u,d){return new ule(a,A,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,Iq(d.experimentalLongPollingOptions),d.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new Ede(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(a){const A=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(A),_online:A}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xm{constructor(e){this._byteString=e}static fromBase64String(e){try{return new xm(Qs.fromBase64String(e))}catch(n){throw new at(Me.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new xm(Qs.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dq{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new at(Me.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new no(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bq{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H1{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new at(Me.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new at(Me.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return on(this._lat,e._lat)||on(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j1{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nde=/^__.*__$/;function Lq(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Qt()}}class K1{constructor(e,n,r,i,s,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Bu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new K1(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.ku({path:r,Qu:!1});return i.$u(e),i}Uu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.ku({path:r,Qu:!1});return i.Bu(),i}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return YB(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(Lq(this.Lu)&&Nde.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class Dde{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||XS(e)}ju(e,n,r,i=!1){return new K1({Lu:e,methodName:n,zu:r,path:no.emptyPath(),Qu:!1,Gu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Bde(t){const e=t._freezeSettings(),n=XS(t._databaseId);return new Dde(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Lde(t,e,n,r=!1){return G1(n,t.ju(r?4:3,e))}function G1(t,e){if(Uq(t=pi(t)))return Pde("Unsupported field value:",e,t),Ude(t,e);if(t instanceof Bq)return function(r,i){if(!Lq(i.Lu))throw i.Wu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Wu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let A=G1(a,i.Ku(o));A==null&&(A={nullValue:"NULL_VALUE"}),s.push(A),o++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=pi(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Ule(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=Ss.fromDate(r);return{timestampValue:QB(i.serializer,s)}}if(r instanceof Ss){const s=new Ss(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:QB(i.serializer,s)}}if(r instanceof H1)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof xm)return{bytesValue:rq(i.serializer,r._byteString)};if(r instanceof tu){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Wu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:iq(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof j1)return function(o,a){return{mapValue:{fields:{[Uz]:{stringValue:Pz},[S0]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.Wu("VectorValues must only contain numeric values.");return S1(a.serializer,u)})}}}}}}(r,i);throw i.Wu(`Unsupported field value: ${$S(r)}`)}(t,e)}function Ude(t,e){const n={};return Rz(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):dg(t,(r,i)=>{const s=G1(i,e.qu(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function Uq(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Ss||t instanceof H1||t instanceof xm||t instanceof tu||t instanceof Bq||t instanceof j1)}function Pde(t,e,n){if(!Uq(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){const r=$S(n);throw r==="an object"?e.Wu(t+" a custom object"):e.Wu(t+" "+r)}}const kde=new RegExp("[~\\*/\\[\\]]");function xde(t,e,n){if(e.search(kde)>=0)throw YB(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Dq(...e.split("."))._internalPath}catch{throw YB(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function YB(t,e,n,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let A="";return(s||o)&&(A+=" (found",s&&(A+=` in field ${r}`),o&&(A+=` in document ${i}`),A+=")"),new at(Me.INVALID_ARGUMENT,a+t+A)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pq{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new tu(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Mde(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(W1("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class Mde extends Pq{data(){return super.data()}}function W1(t,e){return typeof e=="string"?xde(t,e):e instanceof Dq?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fde(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new at(Me.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class z1{}class Vde extends z1{}function kq(t,e,...n){let r=[];e instanceof z1&&r.push(e),r=r.concat(n),function(s){const o=s.filter(A=>A instanceof q1).length,a=s.filter(A=>A instanceof ZS).length;if(o>1||o>0&&a>0)throw new at(Me.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class ZS extends Vde{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new ZS(e,n,r)}_apply(e){const n=this._parse(e);return xq(e._query,n),new fg(e.firestore,e.converter,kB(e._query,n))}_parse(e){const n=Bde(e.firestore);return function(s,o,a,A,u,d,f){let m;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new at(Me.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){lQ(f,d);const v=[];for(const y of f)v.push(AQ(A,s,y));m={arrayValue:{values:v}}}else m=AQ(A,s,f)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||lQ(f,d),m=Lde(a,o,f,d==="in"||d==="not-in");return Gi.create(u,d,m)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function XB(t,e,n){const r=e,i=W1("where",t);return ZS._create(i,r,n)}class q1 extends z1{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new q1(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:zc.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const A of a)xq(o,A),o=kB(o,A)}(e._query,n),new fg(e.firestore,e.converter,kB(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function AQ(t,e,n){if(typeof(n=pi(n))=="string"){if(n==="")throw new at(Me.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!jz(e)&&n.indexOf("/")!==-1)throw new at(Me.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Yr.fromString(n));if(!Tt.isDocumentKey(r))throw new at(Me.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return SV(t,new Tt(r))}if(n instanceof tu)return SV(t,n._key);throw new at(Me.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${$S(n)}.`)}function lQ(t,e){if(!Array.isArray(t)||t.length===0)throw new at(Me.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function xq(t,e){const n=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new at(Me.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new at(Me.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class Qde{convertValue(e,n="none"){switch(Id(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Li(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(bd(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Qt()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return dg(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertVectorValue(e){var n,r,i;const s=(i=(r=(n=e.fields)===null||n===void 0?void 0:n[S0].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>Li(o.doubleValue));return new j1(s)}convertGeoPoint(e){return new H1(Li(e.latitude),Li(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=KS(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(sv(e));default:return null}}convertTimestamp(e){const n=Sd(e);return new Ss(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Yr.fromString(e);$r(lq(r));const i=new ov(r.get(1),r.get(3)),s=new Tt(r.popFirst(5));return i.isEqual(n)||Yl(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Hde extends Pq{constructor(e,n,r,i,s,o){super(e,n,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new RT(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(W1("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class RT extends Hde{data(e={}){return super.data(e)}}class jde{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new qw(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new RT(this._firestore,this._userDataWriter,r.key,r,new qw(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new at(Me.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const A=new RT(i._firestore,i._userDataWriter,a.doc.key,a.doc,new qw(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:A,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const A=new RT(i._firestore,i._userDataWriter,a.doc.key,a.doc,new qw(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:Kde(a.type),doc:A,oldIndex:u,newIndex:d}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function Kde(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Qt()}}class Gde extends Qde{constructor(e){super(),this.firestore=e}convertBytes(e){return new xm(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new tu(this.firestore,null,n)}}function Mq(t){t=qB(t,fg);const e=qB(t.firestore,Nq),n=Rde(e),r=new Gde(e);return Fde(t._query),Cde(n,t._query).then(i=>new jde(e,r,t,i))}(function(e,n=!0){(function(i){lg=i})(xd),lc(new Ta("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new Nq(new WAe(r.getProvider("auth-internal")),new YAe(o,r.getProvider("app-check-internal")),function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new at(Me.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ov(u.options.projectId,d)}(o,i),o);return s=Object.assign({useFetchStreams:n},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),ro(hV,fV,e),ro(hV,fV,"esm2017")})();var uQ={};const dQ="@firebase/database",hQ="1.0.14";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fq="";function Wde(t){Fq=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zde{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),os(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:tv(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qde{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return HA(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vq=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new zde(e)}}catch{}return new qde},Fh=Vq("localStorage"),Yde=Vq("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pm=new Yv("@firebase/database"),Xde=function(){let t=1;return function(){return t++}}(),Qq=function(t){const e=hse(t),n=new Ase;n.update(e);const r=n.digest();return e1.encodeByteArray(r)},iy=function(...t){let e="";for(let n=0;n<t.length;n++){const r=t[n];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=iy.apply(null,r):typeof r=="object"?e+=os(r):e+=r,e+=" "}return e};let OE=null,fQ=!0;const Jde=function(t,e){ke(!0,"Can't turn on custom loggers persistently."),pm.logLevel=un.VERBOSE,OE=pm.log.bind(pm)},Fs=function(...t){if(fQ===!0&&(fQ=!1,OE===null&&Yde.get("logging_enabled")===!0&&Jde()),OE){const e=iy.apply(null,t);OE(e)}},sy=function(t){return function(...e){Fs(t,...e)}},JB=function(...t){const e="FIREBASE INTERNAL ERROR: "+iy(...t);pm.error(e)},Xl=function(...t){const e=`FIREBASE FATAL ERROR: ${iy(...t)}`;throw pm.error(e),new Error(e)},yo=function(...t){const e="FIREBASE WARNING: "+iy(...t);pm.warn(e)},$de=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&yo("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Y1=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Zde=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Mm="[MIN_NAME]",lf="[MAX_NAME]",yf=function(t,e){if(t===e)return 0;if(t===Mm||e===lf)return-1;if(e===Mm||t===lf)return 1;{const n=pQ(t),r=pQ(e);return n!==null?r!==null?n-r===0?t.length-e.length:n-r:-1:r!==null?1:t<e?-1:1}},ehe=function(t,e){return t===e?0:t<e?-1:1},D_=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+os(e))},X1=function(t){if(typeof t!="object"||t===null)return os(t);const e=[];for(const r in t)e.push(r);e.sort();let n="{";for(let r=0;r<e.length;r++)r!==0&&(n+=","),n+=os(e[r]),n+=":",n+=X1(t[e[r]]);return n+="}",n},Hq=function(t,e){const n=t.length;if(n<=e)return[t];const r=[];for(let i=0;i<n;i+=e)i+e>n?r.push(t.substring(i,n)):r.push(t.substring(i,i+e));return r};function Hs(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const jq=function(t){ke(!Y1(t),"Invalid JSON number");const e=11,n=52,r=(1<<e-1)-1;let i,s,o,a,A;t===0?(s=0,o=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),r),s=a+r,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(s=0,o=Math.round(t/Math.pow(2,1-r-n))));const u=[];for(A=n;A;A-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(A=e;A;A-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(i?1:0),u.reverse();const d=u.join("");let f="";for(A=0;A<64;A+=8){let m=parseInt(d.substr(A,8),2).toString(16);m.length===1&&(m="0"+m),f=f+m}return f.toLowerCase()},the=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},nhe=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function rhe(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}const ihe=new RegExp("^-?(0*)\\d{1,10}$"),she=-2147483648,ohe=2147483647,pQ=function(t){if(ihe.test(t)){const e=Number(t);if(e>=she&&e<=ohe)return e}return null},pg=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw yo("Exception was thrown by user callback.",n),e},Math.floor(0))}},ahe=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},NE=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class che{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,ec(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){yo(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ahe{constructor(e,n,r){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(Fs("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,r):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',yo(e)}}class OT{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}OT.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J1="5",Kq="v",Gq="s",Wq="r",zq="f",qq=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Yq="ls",Xq="p",$B="ac",Jq="websocket",$q="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zq{constructor(e,n,r,i,s=!1,o="",a=!1,A=!1,u=null){this.secure=n,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=A,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Fh.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Fh.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function lhe(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function eY(t,e,n){ke(typeof e=="string","typeof type must == string"),ke(typeof n=="object","typeof params must == object");let r;if(e===Jq)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===$q)r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);lhe(t)&&(n.ns=t.namespace);const i=[];return Hs(n,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uhe{constructor(){this.counters_={}}incrementCounter(e,n=1){HA(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return Wie(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mO={},gO={};function $1(t){const e=t.toString();return mO[e]||(mO[e]=new uhe),mO[e]}function dhe(t,e){const n=t.toString();return gO[n]||(gO[n]=e()),gO[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hhe{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&pg(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mQ="start",fhe="close",phe="pLPCommand",mhe="pRTLPCB",tY="id",nY="pw",rY="ser",ghe="cb",_he="seg",Ehe="ts",vhe="d",yhe="dframe",iY=1870,sY=30,whe=iY-sY,Che=25e3,The=3e4;class Xp{constructor(e,n,r,i,s,o,a){this.connId=e,this.repoInfo=n,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=sy(e),this.stats_=$1(n),this.urlFn=A=>(this.appCheckToken&&(A[$B]=this.appCheckToken),eY(n,$q,A))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new hhe(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(The)),Zde(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Z1((...s)=>{const[o,a,A,u,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===mQ)this.id=a,this.password=A;else if(o===fhe)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{const[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const r={};r[mQ]="t",r[rY]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[ghe]=this.scriptTagHolder.uniqueCallbackIdentifier),r[Kq]=J1,this.transportSessionId&&(r[Gq]=this.transportSessionId),this.lastSessionId&&(r[Yq]=this.lastSessionId),this.applicationId&&(r[Xq]=this.applicationId),this.appCheckToken&&(r[$B]=this.appCheckToken),typeof location<"u"&&location.hostname&&qq.test(location.hostname)&&(r[Wq]=zq);const i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Xp.forceAllow_=!0}static forceDisallow(){Xp.forceDisallow_=!0}static isAvailable(){return Xp.forceAllow_?!0:!Xp.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!the()&&!nhe()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=os(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=i9(n),i=Hq(r,whe);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const r={};r[yhe]="t",r[tY]=e,r[nY]=n,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=os(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Z1{constructor(e,n,r,i){this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Xde(),window[phe+this.uniqueCallbackIdentifier]=e,window[mhe+this.uniqueCallbackIdentifier]=n,this.myIFrame=Z1.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){Fs("frame writing exception"),a.stack&&Fs(a.stack),Fs(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Fs("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[tY]=this.myID,e[nY]=this.myPW,e[rY]=this.currentSerial;let n=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+sY+r.length<=iY;){const o=this.pendingSegs.shift();r=r+"&"+_he+i+"="+o.seg+"&"+Ehe+i+"="+o.ts+"&"+vhe+i+"="+o.d,i++}return n=n+r,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,r){this.pendingSegs.push({seg:e,ts:n,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const r=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(r,Math.floor(Che)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),n())},r.onerror=()=>{Fs("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const She=16384,bhe=45e3;let B0=null;typeof MozWebSocket<"u"?B0=MozWebSocket:typeof WebSocket<"u"&&(B0=WebSocket);class Qc{constructor(e,n,r,i,s,o,a){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=sy(this.connId),this.stats_=$1(n),this.connURL=Qc.connectionURL_(n,o,a,i,r),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,r,i,s){const o={};return o[Kq]=J1,typeof location<"u"&&location.hostname&&qq.test(location.hostname)&&(o[Wq]=zq),n&&(o[Gq]=n),r&&(o[Yq]=r),i&&(o[$B]=i),s&&(o[Xq]=s),eY(e,Jq,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Fh.set("previous_websocket_failure",!0);try{let r;tse(),this.mySock=new B0(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const i=r.message||r.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Qc.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(n);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&B0!==null&&!Qc.forceDisallow_}static previouslyFailed(){return Fh.isInMemoryStorage||Fh.get("previous_websocket_failure")===!0}markConnectionHealthy(){Fh.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const r=tv(n);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ke(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const r=this.extractFrameCount_(n);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const n=os(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const r=Hq(n,She);r.length>1&&this.sendString_(String(r.length));for(let i=0;i<r.length;i++)this.sendString_(r[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(bhe))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Qc.responsesRequiredToBeHealthy=2;Qc.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{static get ALL_TRANSPORTS(){return[Xp,Qc]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=Qc&&Qc.isAvailable();let r=n&&!Qc.previouslyFailed();if(e.webSocketOnly&&(n||yo("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Qc];else{const i=this.transports_=[];for(const s of cv.ALL_TRANSPORTS)s&&s.isAvailable()&&i.push(s);cv.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}cv.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ihe=6e4,Rhe=5e3,Ohe=10*1024,Nhe=100*1024,_O="t",gQ="d",Dhe="s",_Q="r",Bhe="e",EQ="o",vQ="a",yQ="n",wQ="p",Lhe="h";class Uhe{constructor(e,n,r,i,s,o,a,A,u,d){this.id=e,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=A,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=sy("c:"+this.id+":"),this.transportManager_=new cv(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,r)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=NE(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Nhe?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Ohe?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(_O in e){const n=e[_O];n===vQ?this.upgradeIfSecondaryHealthy_():n===_Q?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===EQ&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=D_("t",e),r=D_("d",e);if(n==="c")this.onSecondaryControl_(r);else if(n==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:wQ,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:vQ,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:yQ,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=D_("t",e),r=D_("d",e);n==="c"?this.onControl_(r):n==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=D_(_O,e);if(gQ in e){const r=e[gQ];if(n===Lhe){const i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===yQ){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===Dhe?this.onConnectionShutdown_(r):n===_Q?this.onReset_(r):n===Bhe?JB("Server Error: "+r):n===EQ?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):JB("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),J1!==r&&yo("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),NE(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ihe))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):NE(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Rhe))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:wQ,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Fh.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oY{put(e,n,r,i){}merge(e,n,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,r){}onDisconnectMerge(e,n,r){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aY{constructor(e){this.allowedEvents_=e,this.listeners_={},ke(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,n)}}on(e,n,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:r});const i=this.getInitialEvent(e);i&&n.apply(r,i)}off(e,n,r){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===n&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){ke(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0 extends aY{static getInstance(){return new L0}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!r1()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ke(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CQ=32,TQ=768;class pr{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Fn(){return new pr("")}function an(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Nd(t){return t.pieces_.length-t.pieceNum_}function Nr(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new pr(t.pieces_,e)}function eP(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function Phe(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function Av(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function cY(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new pr(e,0)}function ui(t,e){const n=[];for(let r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof pr)for(let r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{const r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&n.push(r[i])}return new pr(n,0)}function hn(t){return t.pieceNum_>=t.pieces_.length}function Eo(t,e){const n=an(t),r=an(e);if(n===null)return e;if(n===r)return Eo(Nr(t),Nr(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function khe(t,e){const n=Av(t,0),r=Av(e,0);for(let i=0;i<n.length&&i<r.length;i++){const s=yf(n[i],r[i]);if(s!==0)return s}return n.length===r.length?0:n.length<r.length?-1:1}function tP(t,e){if(Nd(t)!==Nd(e))return!1;for(let n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function ic(t,e){let n=t.pieceNum_,r=e.pieceNum_;if(Nd(t)>Nd(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}class xhe{constructor(e,n){this.errorPrefix_=n,this.parts_=Av(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=kS(this.parts_[r]);AY(this)}}function Mhe(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=kS(e),AY(t)}function Fhe(t){const e=t.parts_.pop();t.byteLength_-=kS(e),t.parts_.length>0&&(t.byteLength_-=1)}function AY(t){if(t.byteLength_>TQ)throw new Error(t.errorPrefix_+"has a key path longer than "+TQ+" bytes ("+t.byteLength_+").");if(t.parts_.length>CQ)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+CQ+") or object contains a cycle "+Sh(t))}function Sh(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nP extends aY{static getInstance(){return new nP}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return ke(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B_=1e3,Vhe=60*5*1e3,SQ=30*1e3,Qhe=1.3,Hhe=3e4,jhe="server_kill",bQ=3;class Fl extends oY{constructor(e,n,r,i,s,o,a,A){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=r,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=A,this.id=Fl.nextPersistentConnectionId_++,this.log_=sy("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=B_,this.maxReconnectDelay_=Vhe,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,A)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");nP.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&L0.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,r){const i=++this.requestNumber_,s={r:i,a:e,b:n};this.log_(os(s)),ke(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const n=new qv,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const s=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(s),n.promise}listen(e,n,r,i){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),ke(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ke(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:n,query:e,tag:r};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})}sendListen_(e){const n=e.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);const s={p:r},o="q";e.tag&&(s.q=n._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest(o,s,a=>{const A=a.d,u=a.s;Fl.warnOnListenWarnings_(A,n),(this.listens.get(r)&&this.listens.get(r).get(i))===e&&(this.log_("listen response",a),u!=="ok"&&this.removeListen_(r,i),e.onComplete&&e.onComplete(u,A))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&HA(e,"w")){const r=Rm(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const i='".indexOn": "'+n._queryParams.getIndex().toString()+'"',s=n._path.toString();yo(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${s} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||cse(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=SQ)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=ase(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(n,r,i=>{const s=i.s,o=i.d||"error";this.authToken_===e&&(s==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(s,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,r=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,r)})}unlisten(e,n){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),ke(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,n)}sendUnlisten_(e,n,r,i){this.log_("Unlisten on "+e+" for "+n);const s={p:e},o="n";i&&(s.q=r,s.t=i),this.sendRequest(o,s)}onDisconnectPut(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:r})}onDisconnectMerge(e,n,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:r})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,r,i){const s={p:n,d:r};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,n,r,i){this.putInternal("p",e,n,r,i)}merge(e,n,r,i){this.putInternal("m",e,n,r,i)}putInternal(e,n,r,i,s){this.initConnection_();const o={p:n,d:r};s!==void 0&&(o.h=s),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,s=>{this.log_(n+" response",s),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(s.s,s.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,r=>{if(r.s!=="ok"){const s=r.d;this.log_("reportStats","Error sending stats: "+s)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+os(e));const n=e.r,r=this.requestCBHash_[n];r&&(delete this.requestCBHash_[n],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):JB("Unrecognized action received from server: "+os(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ke(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=B_,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=B_,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Hhe&&(this.reconnectDelay_=B_),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Qhe)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Fl.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const A=function(){a?a.close():(o=!0,r())},u=function(f){ke(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(f)};this.realtime_={close:A,sendRequest:u};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[f,m]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?Fs("getToken() completed but was canceled"):(Fs("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=m&&m.token,a=new Uhe(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,g=>{yo(g+" ("+this.repoInfo_.toString()+")"),this.interrupt(jhe)},s))}catch(f){this.log_("Failed to get token: "+f),o||(this.repoInfo_.nodeAdmin&&yo(f),A())}}}interrupt(e){Fs("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Fs("Resuming connection for reason: "+e),delete this.interruptReasons_[e],EB(this.interruptReasons_)&&(this.reconnectDelay_=B_,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let r;n?r=n.map(s=>X1(s)).join("$"):r="default";const i=this.removeListen_(e,r);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,n){const r=new pr(e).toString();let i;if(this.listens.has(r)){const s=this.listens.get(r);i=s.get(n),s.delete(n),s.size===0&&this.listens.delete(r)}else i=void 0;return i}onAuthRevoked_(e,n){Fs("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=bQ&&(this.reconnectDelay_=SQ,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){Fs("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=bQ&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+Fq.replace(/\./g,"-")]=1,r1()?e["framework.cordova"]=1:l9()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=L0.getInstance().currentlyOnline();return EB(this.interruptReasons_)&&e}}Fl.nextPersistentConnectionId_=0;Fl.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cn{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new cn(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const r=new cn(Mm,e),i=new cn(Mm,n);return this.compare(r,i)!==0}minPost(){return cn.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yw;class lY extends eb{static get __EMPTY_NODE(){return Yw}static set __EMPTY_NODE(e){Yw=e}compare(e,n){return yf(e.name,n.name)}isDefinedOn(e){throw ag("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return cn.MIN}maxPost(){return new cn(lf,Yw)}makePost(e,n){return ke(typeof e=="string","KeyIndex indexValue must always be a string."),new cn(e,Yw)}toString(){return".key"}}const mm=new lY;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{constructor(e,n,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?r(e.key,n):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class vs{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??vs.RED,this.left=i??Ko.EMPTY_NODE,this.right=s??Ko.EMPTY_NODE}copy(e,n,r,i,s){return new vs(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return s<0?i=i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i=i.copy(null,n,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ko.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let r,i;if(r=this,n(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,n),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),n(e,r.key)===0){if(r.right.isEmpty())return Ko.EMPTY_NODE;i=r.right.min_(),r=r.copy(i.key,i.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,n))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,vs.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,vs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}vs.RED=!0;vs.BLACK=!1;class Khe{copy(e,n,r,i,s){return this}insert(e,n,r){return new vs(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ko{constructor(e,n=Ko.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Ko(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,vs.BLACK,null,null))}remove(e){return new Ko(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,vs.BLACK,null,null))}get(e){let n,r=this.root_;for(;!r.isEmpty();){if(n=this.comparator_(e,r.key),n===0)return r.value;n<0?r=r.left:n>0&&(r=r.right)}return null}getPredecessorKey(e){let n,r=this.root_,i=null;for(;!r.isEmpty();)if(n=this.comparator_(e,r.key),n===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else n<0?r=r.left:n>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Xw(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Xw(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Xw(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Xw(this.root_,null,this.comparator_,!0,e)}}Ko.EMPTY_NODE=new Khe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ghe(t,e){return yf(t.name,e.name)}function rP(t,e){return yf(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ZB;function Whe(t){ZB=t}const uY=function(t){return typeof t=="number"?"number:"+jq(t):"string:"+t},dY=function(t){if(t.isLeafNode()){const e=t.val();ke(typeof e=="string"||typeof e=="number"||typeof e=="object"&&HA(e,".sv"),"Priority must be a string or number.")}else ke(t===ZB||t.isEmpty(),"priority of unexpected type.");ke(t===ZB||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IQ;class gs{static set __childrenNodeConstructor(e){IQ=e}static get __childrenNodeConstructor(){return IQ}constructor(e,n=gs.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,ke(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),dY(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new gs(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:gs.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return hn(e)?this:an(e)===".priority"?this.priorityNode_:gs.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:gs.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const r=an(e);return r===null?n:n.isEmpty()&&r!==".priority"?this:(ke(r!==".priority"||Nd(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,gs.__childrenNodeConstructor.EMPTY_NODE.updateChild(Nr(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+uY(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=jq(this.value_):e+=this.value_,this.lazyHash_=Qq(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===gs.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof gs.__childrenNodeConstructor?-1:(ke(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,r=typeof this.value_,i=gs.VALUE_TYPE_ORDER.indexOf(n),s=gs.VALUE_TYPE_ORDER.indexOf(r);return ke(i>=0,"Unknown leaf type: "+n),ke(s>=0,"Unknown leaf type: "+r),i===s?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}gs.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let hY,fY;function zhe(t){hY=t}function qhe(t){fY=t}class Yhe extends eb{compare(e,n){const r=e.node.getPriority(),i=n.node.getPriority(),s=r.compareTo(i);return s===0?yf(e.name,n.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return cn.MIN}maxPost(){return new cn(lf,new gs("[PRIORITY-POST]",fY))}makePost(e,n){const r=hY(e);return new cn(n,new gs("[PRIORITY-POST]",r))}toString(){return".priority"}}const di=new Yhe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xhe=Math.log(2);class Jhe{constructor(e){const n=s=>parseInt(Math.log(s)/Xhe,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const U0=function(t,e,n,r){t.sort(e);const i=function(A,u){const d=u-A;let f,m;if(d===0)return null;if(d===1)return f=t[A],m=n?n(f):f,new vs(m,f.node,vs.BLACK,null,null);{const g=parseInt(d/2,10)+A,v=i(A,g),y=i(g+1,u);return f=t[g],m=n?n(f):f,new vs(m,f.node,vs.BLACK,v,y)}},s=function(A){let u=null,d=null,f=t.length;const m=function(v,y){const w=f-v,b=f;f-=v;const I=i(w+1,b),B=t[w],M=n?n(B):B;g(new vs(M,B.node,y,null,I))},g=function(v){u?(u.left=v,u=v):(d=v,u=v)};for(let v=0;v<A.count;++v){const y=A.nextBitIsOne(),w=Math.pow(2,A.count-(v+1));y?m(w,vs.BLACK):(m(w,vs.BLACK),m(w,vs.RED))}return d},o=new Jhe(t.length),a=s(o);return new Ko(r||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EO;const Ap={};class kl{static get Default(){return ke(Ap&&di,"ChildrenNode.ts has not been loaded"),EO=EO||new kl({".priority":Ap},{".priority":di}),EO}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Rm(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Ko?n:null}hasIndex(e){return HA(this.indexSet_,e.toString())}addIndex(e,n){ke(e!==mm,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const s=n.getIterator(cn.Wrap);let o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=U0(r,e.getCompare()):a=Ap;const A=e.toString(),u=Object.assign({},this.indexSet_);u[A]=e;const d=Object.assign({},this.indexes_);return d[A]=a,new kl(d,u)}addToIndexes(e,n){const r=h0(this.indexes_,(i,s)=>{const o=Rm(this.indexSet_,s);if(ke(o,"Missing index implementation for "+s),i===Ap)if(o.isDefinedOn(e.node)){const a=[],A=n.getIterator(cn.Wrap);let u=A.getNext();for(;u;)u.name!==e.name&&a.push(u),u=A.getNext();return a.push(e),U0(a,o.getCompare())}else return Ap;else{const a=n.get(e.name);let A=i;return a&&(A=A.remove(new cn(e.name,a))),A.insert(e,e.node)}});return new kl(r,this.indexSet_)}removeFromIndexes(e,n){const r=h0(this.indexes_,i=>{if(i===Ap)return i;{const s=n.get(e.name);return s?i.remove(new cn(e.name,s)):i}});return new kl(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let L_;class bt{static get EMPTY_NODE(){return L_||(L_=new bt(new Ko(rP),null,kl.Default))}constructor(e,n,r){this.children_=e,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&dY(this.priorityNode_),this.children_.isEmpty()&&ke(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||L_}updatePriority(e){return this.children_.isEmpty()?this:new bt(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?L_:n}}getChild(e){const n=an(e);return n===null?this:this.getImmediateChild(n).getChild(Nr(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(ke(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const r=new cn(e,n);let i,s;n.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(r,this.children_));const o=i.isEmpty()?L_:this.priorityNode_;return new bt(i,o,s)}}updateChild(e,n){const r=an(e);if(r===null)return n;{ke(an(e)!==".priority"||Nd(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(Nr(e),n);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let r=0,i=0,s=!0;if(this.forEachChild(di,(o,a)=>{n[o]=a.val(e),r++,s&&bt.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):s=!1}),!e&&s&&i<2*r){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+uY(this.getPriority().val())+":"),this.forEachChild(di,(n,r)=>{const i=r.hash();i!==""&&(e+=":"+n+":"+i)}),this.lazyHash_=e===""?"":Qq(e)}return this.lazyHash_}getPredecessorChildName(e,n,r){const i=this.resolveIndex_(r);if(i){const s=i.getPredecessorKey(new cn(e,n));return s?s.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new cn(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const r=n.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new cn(n,this.children_.get(n)):null}forEachChild(e,n){const r=this.resolveIndex_(e);return r?r.inorderTraversal(i=>n(i.name,i.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,cn.Wrap);let s=i.peek();for(;s!=null&&n.compare(s,e)<0;)i.getNext(),s=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const r=this.resolveIndex_(n);if(r)return r.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,cn.Wrap);let s=i.peek();for(;s!=null&&n.compare(s,e)>0;)i.getNext(),s=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===oy?-1:0}withIndex(e){if(e===mm||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new bt(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===mm||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const r=this.getIterator(di),i=n.getIterator(di);let s=r.getNext(),o=i.getNext();for(;s&&o;){if(s.name!==o.name||!s.node.equals(o.node))return!1;s=r.getNext(),o=i.getNext()}return s===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===mm?null:this.indexMap_.get(e.toString())}}bt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class $he extends bt{constructor(){super(new Ko(rP),bt.EMPTY_NODE,kl.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return bt.EMPTY_NODE}isEmpty(){return!1}}const oy=new $he;Object.defineProperties(cn,{MIN:{value:new cn(Mm,bt.EMPTY_NODE)},MAX:{value:new cn(lf,oy)}});lY.__EMPTY_NODE=bt.EMPTY_NODE;gs.__childrenNodeConstructor=bt;Whe(oy);qhe(oy);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zhe=!0;function rs(t,e=null){if(t===null)return bt.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),ke(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new gs(n,rs(e))}if(!(t instanceof Array)&&Zhe){const n=[];let r=!1;if(Hs(t,(o,a)=>{if(o.substring(0,1)!=="."){const A=rs(a);A.isEmpty()||(r=r||!A.getPriority().isEmpty(),n.push(new cn(o,A)))}}),n.length===0)return bt.EMPTY_NODE;const s=U0(n,Ghe,o=>o.name,rP);if(r){const o=U0(n,di.getCompare());return new bt(s,rs(e),new kl({".priority":o},{".priority":di}))}else return new bt(s,rs(e),kl.Default)}else{let n=bt.EMPTY_NODE;return Hs(t,(r,i)=>{if(HA(t,r)&&r.substring(0,1)!=="."){const s=rs(i);(s.isLeafNode()||!s.isEmpty())&&(n=n.updateImmediateChild(r,s))}}),n.updatePriority(rs(e))}}zhe(rs);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class efe extends eb{constructor(e){super(),this.indexPath_=e,ke(!hn(e)&&an(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const r=this.extractChild(e.node),i=this.extractChild(n.node),s=r.compareTo(i);return s===0?yf(e.name,n.name):s}makePost(e,n){const r=rs(e),i=bt.EMPTY_NODE.updateChild(this.indexPath_,r);return new cn(n,i)}maxPost(){const e=bt.EMPTY_NODE.updateChild(this.indexPath_,oy);return new cn(lf,e)}toString(){return Av(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tfe extends eb{compare(e,n){const r=e.node.compareTo(n.node);return r===0?yf(e.name,n.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return cn.MIN}maxPost(){return cn.MAX}makePost(e,n){const r=rs(e);return new cn(n,r)}toString(){return".value"}}const nfe=new tfe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pY(t){return{type:"value",snapshotNode:t}}function Fm(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function lv(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function uv(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function rfe(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP{constructor(e){this.index_=e}updateChild(e,n,r,i,s,o){ke(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(n)?o.trackChildChange(lv(n,a)):ke(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Fm(n,r)):o.trackChildChange(uv(n,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(n,r).withIndex(this.index_)}updateFullNode(e,n,r){return r!=null&&(e.isLeafNode()||e.forEachChild(di,(i,s)=>{n.hasChild(i)||r.trackChildChange(lv(i,s))}),n.isLeafNode()||n.forEachChild(di,(i,s)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(uv(i,s,o))}else r.trackChildChange(Fm(i,s))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?bt.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e){this.indexedFilter_=new iP(e.getIndex()),this.index_=e.getIndex(),this.startPost_=dv.getStartPost_(e),this.endPost_=dv.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&r}updateChild(e,n,r,i,s,o){return this.matches(new cn(n,r))||(r=bt.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,r,i,s,o)}updateFullNode(e,n,r){n.isLeafNode()&&(n=bt.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(bt.EMPTY_NODE);const s=this;return n.forEachChild(di,(o,a)=>{s.matches(new cn(o,a))||(i=i.updateImmediateChild(o,bt.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ife{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const r=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=n=>{const r=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new dv(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,r,i,s,o){return this.rangedFilter_.matches(new cn(n,r))||(r=bt.EMPTY_NODE),e.getImmediateChild(n).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,r,i,s,o):this.fullLimitUpdateChild_(e,n,r,s,o)}updateFullNode(e,n,r){let i;if(n.isLeafNode()||n.isEmpty())i=bt.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=bt.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){const a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=n.withIndex(this.index_),i=i.updatePriority(bt.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){const a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,bt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,r,i,s){let o;if(this.reverse_){const f=this.index_.getCompare();o=(m,g)=>f(g,m)}else o=this.index_.getCompare();const a=e;ke(a.numChildren()===this.limit_,"");const A=new cn(n,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(A);if(a.hasChild(n)){const f=a.getImmediateChild(n);let m=i.getChildAfterChild(this.index_,u,this.reverse_);for(;m!=null&&(m.name===n||a.hasChild(m.name));)m=i.getChildAfterChild(this.index_,m,this.reverse_);const g=m==null?1:o(m,A);if(d&&!r.isEmpty()&&g>=0)return s!=null&&s.trackChildChange(uv(n,r,f)),a.updateImmediateChild(n,r);{s!=null&&s.trackChildChange(lv(n,f));const y=a.updateImmediateChild(n,bt.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(s!=null&&s.trackChildChange(Fm(m.name,m.node)),y.updateImmediateChild(m.name,m.node)):y}}else return r.isEmpty()?e:d&&o(u,A)>=0?(s!=null&&(s.trackChildChange(lv(u.name,u.node)),s.trackChildChange(Fm(n,r))),a.updateImmediateChild(n,r).updateImmediateChild(u.name,bt.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sP{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=di}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return ke(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return ke(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Mm}hasEnd(){return this.endSet_}getIndexEndValue(){return ke(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return ke(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:lf}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return ke(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===di}copy(){const e=new sP;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function sfe(t){return t.loadsAllData()?new iP(t.getIndex()):t.hasLimit()?new ife(t):new dv(t)}function RQ(t){const e={};if(t.isDefault())return e;let n;if(t.index_===di?n="$priority":t.index_===nfe?n="$value":t.index_===mm?n="$key":(ke(t.index_ instanceof efe,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=os(n),t.startSet_){const r=t.startAfterSet_?"startAfter":"startAt";e[r]=os(t.indexStartValue_),t.startNameSet_&&(e[r]+=","+os(t.indexStartName_))}if(t.endSet_){const r=t.endBeforeSet_?"endBefore":"endAt";e[r]=os(t.indexEndValue_),t.endNameSet_&&(e[r]+=","+os(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function OQ(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==di&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P0 extends oY{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(ke(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=sy("p:rest:"),this.listens_={}}listen(e,n,r,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const o=P0.getListenId_(e,r),a={};this.listens_[o]=a;const A=RQ(e._queryParams);this.restRequest_(s+".json",A,(u,d)=>{let f=d;if(u===404&&(f=null,u=null),u===null&&this.onDataUpdate_(s,f,!1,r),Rm(this.listens_,o)===a){let m;u?u===401?m="permission_denied":m="rest_error:"+u:m="ok",i(m,null)}})}unlisten(e,n){const r=P0.getListenId_(e,n);delete this.listens_[r]}get(e){const n=RQ(e._queryParams),r=e._path.toString(),i=new qv;return this.restRequest_(r+".json",n,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},r){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(n.auth=i.accessToken),s&&s.token&&(n.ac=s.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+cg(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let A=null;if(a.status>=200&&a.status<300){try{A=tv(a.responseText)}catch{yo("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,A)}else a.status!==401&&a.status!==404&&yo("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ofe{constructor(){this.rootNode_=bt.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k0(){return{value:null,children:new Map}}function mY(t,e,n){if(hn(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const r=an(e);t.children.has(r)||t.children.set(r,k0());const i=t.children.get(r);e=Nr(e),mY(i,e,n)}}function eL(t,e,n){t.value!==null?n(e,t.value):afe(t,(r,i)=>{const s=new pr(e.toString()+"/"+r);eL(i,s,n)})}function afe(t,e){t.children.forEach((n,r)=>{e(r,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cfe{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n=Object.assign({},e);return this.last_&&Hs(this.last_,(r,i)=>{n[r]=n[r]-i}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NQ=10*1e3,Afe=30*1e3,lfe=5*60*1e3;class ufe{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new cfe(e);const r=NQ+(Afe-NQ)*Math.random();NE(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),n={};let r=!1;Hs(e,(i,s)=>{s>0&&HA(this.statsToReport_,i)&&(n[i]=s,r=!0)}),r&&this.server_.reportStats(n),NE(this.reportStats_.bind(this),Math.floor(Math.random()*2*lfe))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var jc;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(jc||(jc={}));function oP(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function aP(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function cP(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x0{constructor(e,n,r){this.path=e,this.affectedTree=n,this.revert=r,this.type=jc.ACK_USER_WRITE,this.source=oP()}operationForChild(e){if(hn(this.path)){if(this.affectedTree.value!=null)return ke(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new pr(e));return new x0(Fn(),n,this.revert)}}else return ke(an(this.path)===e,"operationForChild called for unrelated child."),new x0(Nr(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv{constructor(e,n){this.source=e,this.path=n,this.type=jc.LISTEN_COMPLETE}operationForChild(e){return hn(this.path)?new hv(this.source,Fn()):new hv(this.source,Nr(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(e,n,r){this.source=e,this.path=n,this.snap=r,this.type=jc.OVERWRITE}operationForChild(e){return hn(this.path)?new uf(this.source,Fn(),this.snap.getImmediateChild(e)):new uf(this.source,Nr(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e,n,r){this.source=e,this.path=n,this.children=r,this.type=jc.MERGE}operationForChild(e){if(hn(this.path)){const n=this.children.subtree(new pr(e));return n.isEmpty()?null:n.value?new uf(this.source,Fn(),n.value):new Vm(this.source,Fn(),n)}else return ke(an(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Vm(this.source,Nr(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dd{constructor(e,n,r){this.node_=e,this.fullyInitialized_=n,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(hn(e))return this.isFullyInitialized()&&!this.filtered_;const n=an(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dfe{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function hfe(t,e,n,r){const i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(rfe(o.childName,o.snapshotNode))}),U_(t,i,"child_removed",e,r,n),U_(t,i,"child_added",e,r,n),U_(t,i,"child_moved",s,r,n),U_(t,i,"child_changed",e,r,n),U_(t,i,"value",e,r,n),i}function U_(t,e,n,r,i,s){const o=r.filter(a=>a.type===n);o.sort((a,A)=>pfe(t,a,A)),o.forEach(a=>{const A=ffe(t,a,s);i.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(A,t.query_))})})}function ffe(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function pfe(t,e,n){if(e.childName==null||n.childName==null)throw ag("Should only compare child_ events.");const r=new cn(e.childName,e.snapshotNode),i=new cn(n.childName,n.snapshotNode);return t.index_.compare(r,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tb(t,e){return{eventCache:t,serverCache:e}}function DE(t,e,n,r){return tb(new Dd(e,n,r),t.serverCache)}function gY(t,e,n,r){return tb(t.eventCache,new Dd(e,n,r))}function M0(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function df(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vO;const mfe=()=>(vO||(vO=new Ko(ehe)),vO);class Or{static fromObject(e){let n=new Or(null);return Hs(e,(r,i)=>{n=n.set(new pr(r),i)}),n}constructor(e,n=mfe()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Fn(),value:this.value};if(hn(e))return null;{const r=an(e),i=this.children.get(r);if(i!==null){const s=i.findRootMostMatchingPathAndValue(Nr(e),n);return s!=null?{path:ui(new pr(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(hn(e))return this;{const n=an(e),r=this.children.get(n);return r!==null?r.subtree(Nr(e)):new Or(null)}}set(e,n){if(hn(e))return new Or(n,this.children);{const r=an(e),s=(this.children.get(r)||new Or(null)).set(Nr(e),n),o=this.children.insert(r,s);return new Or(this.value,o)}}remove(e){if(hn(e))return this.children.isEmpty()?new Or(null):new Or(null,this.children);{const n=an(e),r=this.children.get(n);if(r){const i=r.remove(Nr(e));let s;return i.isEmpty()?s=this.children.remove(n):s=this.children.insert(n,i),this.value===null&&s.isEmpty()?new Or(null):new Or(this.value,s)}else return this}}get(e){if(hn(e))return this.value;{const n=an(e),r=this.children.get(n);return r?r.get(Nr(e)):null}}setTree(e,n){if(hn(e))return n;{const r=an(e),s=(this.children.get(r)||new Or(null)).setTree(Nr(e),n);let o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new Or(this.value,o)}}fold(e){return this.fold_(Fn(),e)}fold_(e,n){const r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(ui(e,i),n)}),n(e,this.value,r)}findOnPath(e,n){return this.findOnPath_(e,Fn(),n)}findOnPath_(e,n,r){const i=this.value?r(n,this.value):!1;if(i)return i;if(hn(e))return null;{const s=an(e),o=this.children.get(s);return o?o.findOnPath_(Nr(e),ui(n,s),r):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Fn(),n)}foreachOnPath_(e,n,r){if(hn(e))return this;{this.value&&r(n,this.value);const i=an(e),s=this.children.get(i);return s?s.foreachOnPath_(Nr(e),ui(n,i),r):new Or(null)}}foreach(e){this.foreach_(Fn(),e)}foreach_(e,n){this.children.inorderTraversal((r,i)=>{i.foreach_(ui(e,r),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,r)=>{r.value&&e(n,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(e){this.writeTree_=e}static empty(){return new Wc(new Or(null))}}function BE(t,e,n){if(hn(e))return new Wc(new Or(n));{const r=t.writeTree_.findRootMostValueAndPath(e);if(r!=null){const i=r.path;let s=r.value;const o=Eo(i,e);return s=s.updateChild(o,n),new Wc(t.writeTree_.set(i,s))}else{const i=new Or(n),s=t.writeTree_.setTree(e,i);return new Wc(s)}}}function tL(t,e,n){let r=t;return Hs(n,(i,s)=>{r=BE(r,ui(e,i),s)}),r}function DQ(t,e){if(hn(e))return Wc.empty();{const n=t.writeTree_.setTree(e,new Or(null));return new Wc(n)}}function nL(t,e){return wf(t,e)!=null}function wf(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(Eo(n.path,e)):null}function BQ(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(di,(r,i)=>{e.push(new cn(r,i))}):t.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new cn(r,i.value))}),e}function fd(t,e){if(hn(e))return t;{const n=wf(t,e);return n!=null?new Wc(new Or(n)):new Wc(t.writeTree_.subtree(e))}}function rL(t){return t.writeTree_.isEmpty()}function Qm(t,e){return _Y(Fn(),t.writeTree_,e)}function _Y(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(ke(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):n=_Y(ui(t,i),s,n)}),!n.getChild(t).isEmpty()&&r!==null&&(n=n.updateChild(ui(t,".priority"),r)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nb(t,e){return wY(e,t)}function gfe(t,e,n,r,i){ke(r>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:i}),i&&(t.visibleWrites=BE(t.visibleWrites,e,n)),t.lastWriteId=r}function _fe(t,e,n,r){ke(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=tL(t.visibleWrites,e,n),t.lastWriteId=r}function Efe(t,e){for(let n=0;n<t.allWrites.length;n++){const r=t.allWrites[n];if(r.writeId===e)return r}return null}function vfe(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);ke(n>=0,"removeWrite called with nonexistent writeId.");const r=t.allWrites[n];t.allWrites.splice(n,1);let i=r.visible,s=!1,o=t.allWrites.length-1;for(;i&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&yfe(a,r.path)?i=!1:ic(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return wfe(t),!0;if(r.snap)t.visibleWrites=DQ(t.visibleWrites,r.path);else{const a=r.children;Hs(a,A=>{t.visibleWrites=DQ(t.visibleWrites,ui(r.path,A))})}return!0}else return!1}function yfe(t,e){if(t.snap)return ic(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&ic(ui(t.path,n),e))return!0;return!1}function wfe(t){t.visibleWrites=EY(t.allWrites,Cfe,Fn()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function Cfe(t){return t.visible}function EY(t,e,n){let r=Wc.empty();for(let i=0;i<t.length;++i){const s=t[i];if(e(s)){const o=s.path;let a;if(s.snap)ic(n,o)?(a=Eo(n,o),r=BE(r,a,s.snap)):ic(o,n)&&(a=Eo(o,n),r=BE(r,Fn(),s.snap.getChild(a)));else if(s.children){if(ic(n,o))a=Eo(n,o),r=tL(r,a,s.children);else if(ic(o,n))if(a=Eo(o,n),hn(a))r=tL(r,Fn(),s.children);else{const A=Rm(s.children,an(a));if(A){const u=A.getChild(Nr(a));r=BE(r,Fn(),u)}}}else throw ag("WriteRecord should have .snap or .children")}}return r}function vY(t,e,n,r,i){if(!r&&!i){const s=wf(t.visibleWrites,e);if(s!=null)return s;{const o=fd(t.visibleWrites,e);if(rL(o))return n;if(n==null&&!nL(o,Fn()))return null;{const a=n||bt.EMPTY_NODE;return Qm(o,a)}}}else{const s=fd(t.visibleWrites,e);if(!i&&rL(s))return n;if(!i&&n==null&&!nL(s,Fn()))return null;{const o=function(u){return(u.visible||i)&&(!r||!~r.indexOf(u.writeId))&&(ic(u.path,e)||ic(e,u.path))},a=EY(t.allWrites,o,e),A=n||bt.EMPTY_NODE;return Qm(a,A)}}}function Tfe(t,e,n){let r=bt.EMPTY_NODE;const i=wf(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(di,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(n){const s=fd(t.visibleWrites,e);return n.forEachChild(di,(o,a)=>{const A=Qm(fd(s,new pr(o)),a);r=r.updateImmediateChild(o,A)}),BQ(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{const s=fd(t.visibleWrites,e);return BQ(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function Sfe(t,e,n,r,i){ke(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=ui(e,n);if(nL(t.visibleWrites,s))return null;{const o=fd(t.visibleWrites,s);return rL(o)?i.getChild(n):Qm(o,i.getChild(n))}}function bfe(t,e,n,r){const i=ui(e,n),s=wf(t.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(n)){const o=fd(t.visibleWrites,i);return Qm(o,r.getNode().getImmediateChild(n))}else return null}function Ife(t,e){return wf(t.visibleWrites,e)}function Rfe(t,e,n,r,i,s,o){let a;const A=fd(t.visibleWrites,e),u=wf(A,Fn());if(u!=null)a=u;else if(n!=null)a=Qm(A,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const d=[],f=o.getCompare(),m=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let g=m.getNext();for(;g&&d.length<i;)f(g,r)!==0&&d.push(g),g=m.getNext();return d}else return[]}function Ofe(){return{visibleWrites:Wc.empty(),allWrites:[],lastWriteId:-1}}function F0(t,e,n,r){return vY(t.writeTree,t.treePath,e,n,r)}function AP(t,e){return Tfe(t.writeTree,t.treePath,e)}function LQ(t,e,n,r){return Sfe(t.writeTree,t.treePath,e,n,r)}function V0(t,e){return Ife(t.writeTree,ui(t.treePath,e))}function Nfe(t,e,n,r,i,s){return Rfe(t.writeTree,t.treePath,e,n,r,i,s)}function lP(t,e,n){return bfe(t.writeTree,t.treePath,e,n)}function yY(t,e){return wY(ui(t.treePath,e),t.writeTree)}function wY(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dfe{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,r=e.childName;ke(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),ke(r!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(r);if(i){const s=i.type;if(n==="child_added"&&s==="child_removed")this.changeMap.set(r,uv(r,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(n==="child_removed"&&s==="child_changed")this.changeMap.set(r,lv(r,i.oldSnap));else if(n==="child_changed"&&s==="child_added")this.changeMap.set(r,Fm(r,e.snapshotNode));else if(n==="child_changed"&&s==="child_changed")this.changeMap.set(r,uv(r,e.snapshotNode,i.oldSnap));else throw ag("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bfe{getCompleteChild(e){return null}getChildAfterChild(e,n,r){return null}}const CY=new Bfe;class uP{constructor(e,n,r=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=r}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new Dd(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return lP(this.writes_,e,r)}}getChildAfterChild(e,n,r){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:df(this.viewCache_),s=Nfe(this.writes_,i,n,1,r,e);return s.length===0?null:s[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lfe(t){return{filter:t}}function Ufe(t,e){ke(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),ke(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function Pfe(t,e,n,r,i){const s=new Dfe;let o,a;if(n.type===jc.OVERWRITE){const u=n;u.source.fromUser?o=iL(t,e,u.path,u.snap,r,i,s):(ke(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!hn(u.path),o=Q0(t,e,u.path,u.snap,r,i,a,s))}else if(n.type===jc.MERGE){const u=n;u.source.fromUser?o=xfe(t,e,u.path,u.children,r,i,s):(ke(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=sL(t,e,u.path,u.children,r,i,a,s))}else if(n.type===jc.ACK_USER_WRITE){const u=n;u.revert?o=Vfe(t,e,u.path,r,i,s):o=Mfe(t,e,u.path,u.affectedTree,r,i,s)}else if(n.type===jc.LISTEN_COMPLETE)o=Ffe(t,e,n.path,r,s);else throw ag("Unknown operation type: "+n.type);const A=s.getChanges();return kfe(e,o,A),{viewCache:o,changes:A}}function kfe(t,e,n){const r=e.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=M0(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(pY(M0(e)))}}function TY(t,e,n,r,i,s){const o=e.eventCache;if(V0(r,n)!=null)return e;{let a,A;if(hn(n))if(ke(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=df(e),d=u instanceof bt?u:bt.EMPTY_NODE,f=AP(r,d);a=t.filter.updateFullNode(e.eventCache.getNode(),f,s)}else{const u=F0(r,df(e));a=t.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{const u=an(n);if(u===".priority"){ke(Nd(n)===1,"Can't have a priority with additional path components");const d=o.getNode();A=e.serverCache.getNode();const f=LQ(r,n,d,A);f!=null?a=t.filter.updatePriority(d,f):a=o.getNode()}else{const d=Nr(n);let f;if(o.isCompleteForChild(u)){A=e.serverCache.getNode();const m=LQ(r,n,o.getNode(),A);m!=null?f=o.getNode().getImmediateChild(u).updateChild(d,m):f=o.getNode().getImmediateChild(u)}else f=lP(r,u,e.serverCache);f!=null?a=t.filter.updateChild(o.getNode(),u,f,d,i,s):a=o.getNode()}}return DE(e,a,o.isFullyInitialized()||hn(n),t.filter.filtersNodes())}}function Q0(t,e,n,r,i,s,o,a){const A=e.serverCache;let u;const d=o?t.filter:t.filter.getIndexedFilter();if(hn(n))u=d.updateFullNode(A.getNode(),r,null);else if(d.filtersNodes()&&!A.isFiltered()){const g=A.getNode().updateChild(n,r);u=d.updateFullNode(A.getNode(),g,null)}else{const g=an(n);if(!A.isCompleteForPath(n)&&Nd(n)>1)return e;const v=Nr(n),w=A.getNode().getImmediateChild(g).updateChild(v,r);g===".priority"?u=d.updatePriority(A.getNode(),w):u=d.updateChild(A.getNode(),g,w,v,CY,null)}const f=gY(e,u,A.isFullyInitialized()||hn(n),d.filtersNodes()),m=new uP(i,f,s);return TY(t,f,n,i,m,a)}function iL(t,e,n,r,i,s,o){const a=e.eventCache;let A,u;const d=new uP(i,e,s);if(hn(n))u=t.filter.updateFullNode(e.eventCache.getNode(),r,o),A=DE(e,u,!0,t.filter.filtersNodes());else{const f=an(n);if(f===".priority")u=t.filter.updatePriority(e.eventCache.getNode(),r),A=DE(e,u,a.isFullyInitialized(),a.isFiltered());else{const m=Nr(n),g=a.getNode().getImmediateChild(f);let v;if(hn(m))v=r;else{const y=d.getCompleteChild(f);y!=null?eP(m)===".priority"&&y.getChild(cY(m)).isEmpty()?v=y:v=y.updateChild(m,r):v=bt.EMPTY_NODE}if(g.equals(v))A=e;else{const y=t.filter.updateChild(a.getNode(),f,v,m,d,o);A=DE(e,y,a.isFullyInitialized(),t.filter.filtersNodes())}}}return A}function UQ(t,e){return t.eventCache.isCompleteForChild(e)}function xfe(t,e,n,r,i,s,o){let a=e;return r.foreach((A,u)=>{const d=ui(n,A);UQ(e,an(d))&&(a=iL(t,a,d,u,i,s,o))}),r.foreach((A,u)=>{const d=ui(n,A);UQ(e,an(d))||(a=iL(t,a,d,u,i,s,o))}),a}function PQ(t,e,n){return n.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function sL(t,e,n,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let A=e,u;hn(n)?u=r:u=new Or(null).setTree(n,r);const d=e.serverCache.getNode();return u.children.inorderTraversal((f,m)=>{if(d.hasChild(f)){const g=e.serverCache.getNode().getImmediateChild(f),v=PQ(t,g,m);A=Q0(t,A,new pr(f),v,i,s,o,a)}}),u.children.inorderTraversal((f,m)=>{const g=!e.serverCache.isCompleteForChild(f)&&m.value===null;if(!d.hasChild(f)&&!g){const v=e.serverCache.getNode().getImmediateChild(f),y=PQ(t,v,m);A=Q0(t,A,new pr(f),y,i,s,o,a)}}),A}function Mfe(t,e,n,r,i,s,o){if(V0(i,n)!=null)return e;const a=e.serverCache.isFiltered(),A=e.serverCache;if(r.value!=null){if(hn(n)&&A.isFullyInitialized()||A.isCompleteForPath(n))return Q0(t,e,n,A.getNode().getChild(n),i,s,a,o);if(hn(n)){let u=new Or(null);return A.getNode().forEachChild(mm,(d,f)=>{u=u.set(new pr(d),f)}),sL(t,e,n,u,i,s,a,o)}else return e}else{let u=new Or(null);return r.foreach((d,f)=>{const m=ui(n,d);A.isCompleteForPath(m)&&(u=u.set(d,A.getNode().getChild(m)))}),sL(t,e,n,u,i,s,a,o)}}function Ffe(t,e,n,r,i){const s=e.serverCache,o=gY(e,s.getNode(),s.isFullyInitialized()||hn(n),s.isFiltered());return TY(t,o,n,r,CY,i)}function Vfe(t,e,n,r,i,s){let o;if(V0(r,n)!=null)return e;{const a=new uP(r,e,i),A=e.eventCache.getNode();let u;if(hn(n)||an(n)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=F0(r,df(e));else{const f=e.serverCache.getNode();ke(f instanceof bt,"serverChildren would be complete if leaf node"),d=AP(r,f)}d=d,u=t.filter.updateFullNode(A,d,s)}else{const d=an(n);let f=lP(r,d,e.serverCache);f==null&&e.serverCache.isCompleteForChild(d)&&(f=A.getImmediateChild(d)),f!=null?u=t.filter.updateChild(A,d,f,Nr(n),a,s):e.eventCache.getNode().hasChild(d)?u=t.filter.updateChild(A,d,bt.EMPTY_NODE,Nr(n),a,s):u=A,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=F0(r,df(e)),o.isLeafNode()&&(u=t.filter.updateFullNode(u,o,s)))}return o=e.serverCache.isFullyInitialized()||V0(r,Fn())!=null,DE(e,u,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qfe{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const r=this.query_._queryParams,i=new iP(r.getIndex()),s=sfe(r);this.processor_=Lfe(s);const o=n.serverCache,a=n.eventCache,A=i.updateFullNode(bt.EMPTY_NODE,o.getNode(),null),u=s.updateFullNode(bt.EMPTY_NODE,a.getNode(),null),d=new Dd(A,o.isFullyInitialized(),i.filtersNodes()),f=new Dd(u,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=tb(f,d),this.eventGenerator_=new dfe(this.query_)}get query(){return this.query_}}function Hfe(t){return t.viewCache_.serverCache.getNode()}function jfe(t){return M0(t.viewCache_)}function Kfe(t,e){const n=df(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!hn(e)&&!n.getImmediateChild(an(e)).isEmpty())?n.getChild(e):null}function kQ(t){return t.eventRegistrations_.length===0}function Gfe(t,e){t.eventRegistrations_.push(e)}function xQ(t,e,n){const r=[];if(n){ke(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(s=>{const o=s.createCancelEvent(n,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<t.eventRegistrations_.length;++s){const o=t.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(s+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return r}function MQ(t,e,n,r){e.type===jc.MERGE&&e.source.queryId!==null&&(ke(df(t.viewCache_),"We should always have a full cache before handling merges"),ke(M0(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,s=Pfe(t.processor_,i,e,n,r);return Ufe(t.processor_,s.viewCache),ke(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=s.viewCache,SY(t,s.changes,s.viewCache.eventCache.getNode(),null)}function Wfe(t,e){const n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(di,(s,o)=>{r.push(Fm(s,o))}),n.isFullyInitialized()&&r.push(pY(n.getNode())),SY(t,r,n.getNode(),e)}function SY(t,e,n,r){const i=r?[r]:t.eventRegistrations_;return hfe(t.eventGenerator_,e,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let H0;class bY{constructor(){this.views=new Map}}function zfe(t){ke(!H0,"__referenceConstructor has already been defined"),H0=t}function qfe(){return ke(H0,"Reference.ts has not been loaded"),H0}function Yfe(t){return t.views.size===0}function dP(t,e,n,r){const i=e.source.queryId;if(i!==null){const s=t.views.get(i);return ke(s!=null,"SyncTree gave us an op for an invalid query."),MQ(s,e,n,r)}else{let s=[];for(const o of t.views.values())s=s.concat(MQ(o,e,n,r));return s}}function IY(t,e,n,r,i){const s=e._queryIdentifier,o=t.views.get(s);if(!o){let a=F0(n,i?r:null),A=!1;a?A=!0:r instanceof bt?(a=AP(n,r),A=!1):(a=bt.EMPTY_NODE,A=!1);const u=tb(new Dd(a,A,!1),new Dd(r,i,!1));return new Qfe(e,u)}return o}function Xfe(t,e,n,r,i,s){const o=IY(t,e,r,i,s);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),Gfe(o,n),Wfe(o,n)}function Jfe(t,e,n,r){const i=e._queryIdentifier,s=[];let o=[];const a=Bd(t);if(i==="default")for(const[A,u]of t.views.entries())o=o.concat(xQ(u,n,r)),kQ(u)&&(t.views.delete(A),u.query._queryParams.loadsAllData()||s.push(u.query));else{const A=t.views.get(i);A&&(o=o.concat(xQ(A,n,r)),kQ(A)&&(t.views.delete(i),A.query._queryParams.loadsAllData()||s.push(A.query)))}return a&&!Bd(t)&&s.push(new(qfe())(e._repo,e._path)),{removed:s,events:o}}function RY(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function pd(t,e){let n=null;for(const r of t.views.values())n=n||Kfe(r,e);return n}function OY(t,e){if(e._queryParams.loadsAllData())return rb(t);{const r=e._queryIdentifier;return t.views.get(r)}}function NY(t,e){return OY(t,e)!=null}function Bd(t){return rb(t)!=null}function rb(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let j0;function $fe(t){ke(!j0,"__referenceConstructor has already been defined"),j0=t}function Zfe(){return ke(j0,"Reference.ts has not been loaded"),j0}let epe=1;class FQ{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Or(null),this.pendingWriteTree_=Ofe(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function DY(t,e,n,r,i){return gfe(t.pendingWriteTree_,e,n,r,i),i?mg(t,new uf(oP(),e,n)):[]}function tpe(t,e,n,r){_fe(t.pendingWriteTree_,e,n,r);const i=Or.fromObject(n);return mg(t,new Vm(oP(),e,i))}function td(t,e,n=!1){const r=Efe(t.pendingWriteTree_,e);if(vfe(t.pendingWriteTree_,e)){let s=new Or(null);return r.snap!=null?s=s.set(Fn(),!0):Hs(r.children,o=>{s=s.set(new pr(o),!0)}),mg(t,new x0(r.path,s,n))}else return[]}function ay(t,e,n){return mg(t,new uf(aP(),e,n))}function npe(t,e,n){const r=Or.fromObject(n);return mg(t,new Vm(aP(),e,r))}function rpe(t,e){return mg(t,new hv(aP(),e))}function ipe(t,e,n){const r=fP(t,n);if(r){const i=pP(r),s=i.path,o=i.queryId,a=Eo(s,e),A=new hv(cP(o),a);return mP(t,s,A)}else return[]}function K0(t,e,n,r,i=!1){const s=e._path,o=t.syncPointTree_.get(s);let a=[];if(o&&(e._queryIdentifier==="default"||NY(o,e))){const A=Jfe(o,e,n,r);Yfe(o)&&(t.syncPointTree_=t.syncPointTree_.remove(s));const u=A.removed;if(a=A.events,!i){const d=u.findIndex(m=>m._queryParams.loadsAllData())!==-1,f=t.syncPointTree_.findOnPath(s,(m,g)=>Bd(g));if(d&&!f){const m=t.syncPointTree_.subtree(s);if(!m.isEmpty()){const g=ape(m);for(let v=0;v<g.length;++v){const y=g[v],w=y.query,b=PY(t,y);t.listenProvider_.startListening(LE(w),fv(t,w),b.hashFn,b.onComplete)}}}!f&&u.length>0&&!r&&(d?t.listenProvider_.stopListening(LE(e),null):u.forEach(m=>{const g=t.queryToTagMap.get(ib(m));t.listenProvider_.stopListening(LE(m),g)}))}cpe(t,u)}return a}function BY(t,e,n,r){const i=fP(t,r);if(i!=null){const s=pP(i),o=s.path,a=s.queryId,A=Eo(o,e),u=new uf(cP(a),A,n);return mP(t,o,u)}else return[]}function spe(t,e,n,r){const i=fP(t,r);if(i){const s=pP(i),o=s.path,a=s.queryId,A=Eo(o,e),u=Or.fromObject(n),d=new Vm(cP(a),A,u);return mP(t,o,d)}else return[]}function oL(t,e,n,r=!1){const i=e._path;let s=null,o=!1;t.syncPointTree_.foreachOnPath(i,(m,g)=>{const v=Eo(m,i);s=s||pd(g,v),o=o||Bd(g)});let a=t.syncPointTree_.get(i);a?(o=o||Bd(a),s=s||pd(a,Fn())):(a=new bY,t.syncPointTree_=t.syncPointTree_.set(i,a));let A;s!=null?A=!0:(A=!1,s=bt.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((g,v)=>{const y=pd(v,Fn());y&&(s=s.updateImmediateChild(g,y))}));const u=NY(a,e);if(!u&&!e._queryParams.loadsAllData()){const m=ib(e);ke(!t.queryToTagMap.has(m),"View does not exist, but we have a tag");const g=Ape();t.queryToTagMap.set(m,g),t.tagToQueryMap.set(g,m)}const d=nb(t.pendingWriteTree_,i);let f=Xfe(a,e,n,d,s,A);if(!u&&!o&&!r){const m=OY(a,e);f=f.concat(lpe(t,e,m))}return f}function hP(t,e,n){const i=t.pendingWriteTree_,s=t.syncPointTree_.findOnPath(e,(o,a)=>{const A=Eo(o,e),u=pd(a,A);if(u)return u});return vY(i,e,s,n,!0)}function ope(t,e){const n=e._path;let r=null;t.syncPointTree_.foreachOnPath(n,(u,d)=>{const f=Eo(u,n);r=r||pd(d,f)});let i=t.syncPointTree_.get(n);i?r=r||pd(i,Fn()):(i=new bY,t.syncPointTree_=t.syncPointTree_.set(n,i));const s=r!=null,o=s?new Dd(r,!0,!1):null,a=nb(t.pendingWriteTree_,e._path),A=IY(i,e,a,s?o.getNode():bt.EMPTY_NODE,s);return jfe(A)}function mg(t,e){return LY(e,t.syncPointTree_,null,nb(t.pendingWriteTree_,Fn()))}function LY(t,e,n,r){if(hn(t.path))return UY(t,e,n,r);{const i=e.get(Fn());n==null&&i!=null&&(n=pd(i,Fn()));let s=[];const o=an(t.path),a=t.operationForChild(o),A=e.children.get(o);if(A&&a){const u=n?n.getImmediateChild(o):null,d=yY(r,o);s=s.concat(LY(a,A,u,d))}return i&&(s=s.concat(dP(i,t,r,n))),s}}function UY(t,e,n,r){const i=e.get(Fn());n==null&&i!=null&&(n=pd(i,Fn()));let s=[];return e.children.inorderTraversal((o,a)=>{const A=n?n.getImmediateChild(o):null,u=yY(r,o),d=t.operationForChild(o);d&&(s=s.concat(UY(d,a,A,u)))}),i&&(s=s.concat(dP(i,t,r,n))),s}function PY(t,e){const n=e.query,r=fv(t,n);return{hashFn:()=>(Hfe(e)||bt.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?ipe(t,n._path,r):rpe(t,n._path);{const s=rhe(i,n);return K0(t,n,null,s)}}}}function fv(t,e){const n=ib(e);return t.queryToTagMap.get(n)}function ib(t){return t._path.toString()+"$"+t._queryIdentifier}function fP(t,e){return t.tagToQueryMap.get(e)}function pP(t){const e=t.indexOf("$");return ke(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new pr(t.substr(0,e))}}function mP(t,e,n){const r=t.syncPointTree_.get(e);ke(r,"Missing sync point for query tag that we're tracking");const i=nb(t.pendingWriteTree_,e);return dP(r,n,i,null)}function ape(t){return t.fold((e,n,r)=>{if(n&&Bd(n))return[rb(n)];{let i=[];return n&&(i=RY(n)),Hs(r,(s,o)=>{i=i.concat(o)}),i}})}function LE(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(Zfe())(t._repo,t._path):t}function cpe(t,e){for(let n=0;n<e.length;++n){const r=e[n];if(!r._queryParams.loadsAllData()){const i=ib(r),s=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(s)}}}function Ape(){return epe++}function lpe(t,e,n){const r=e._path,i=fv(t,e),s=PY(t,n),o=t.listenProvider_.startListening(LE(e),i,s.hashFn,s.onComplete),a=t.syncPointTree_.subtree(r);if(i)ke(!Bd(a.value),"If we're adding a query, it shouldn't be shadowed");else{const A=a.fold((u,d,f)=>{if(!hn(u)&&d&&Bd(d))return[rb(d).query];{let m=[];return d&&(m=m.concat(RY(d).map(g=>g.query))),Hs(f,(g,v)=>{m=m.concat(v)}),m}});for(let u=0;u<A.length;++u){const d=A[u];t.listenProvider_.stopListening(LE(d),fv(t,d))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gP{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new gP(n)}node(){return this.node_}}class _P{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=ui(this.path_,e);return new _P(this.syncTree_,n)}node(){return hP(this.syncTree_,this.path_)}}const upe=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},VQ=function(t,e,n){if(!t||typeof t!="object")return t;if(ke(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return dpe(t[".sv"],e,n);if(typeof t[".sv"]=="object")return hpe(t[".sv"],e);ke(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},dpe=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:ke(!1,"Unexpected server value: "+t)}},hpe=function(t,e,n){t.hasOwnProperty("increment")||ke(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const r=t.increment;typeof r!="number"&&ke(!1,"Unexpected increment value: "+r);const i=e.node();if(ke(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const o=i.getValue();return typeof o!="number"?r:o+r},kY=function(t,e,n,r){return EP(e,new _P(n,t),r)},xY=function(t,e,n){return EP(t,new gP(e),n)};function EP(t,e,n){const r=t.getPriority().val(),i=VQ(r,e.getImmediateChild(".priority"),n);let s;if(t.isLeafNode()){const o=t,a=VQ(o.getValue(),e,n);return a!==o.getValue()||i!==o.getPriority().val()?new gs(a,rs(i)):t}else{const o=t;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new gs(i))),o.forEachChild(di,(a,A)=>{const u=EP(A,e.getImmediateChild(a),n);u!==A&&(s=s.updateImmediateChild(a,u))}),s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vP{constructor(e="",n=null,r={children:{},childCount:0}){this.name=e,this.parent=n,this.node=r}}function yP(t,e){let n=e instanceof pr?e:new pr(e),r=t,i=an(n);for(;i!==null;){const s=Rm(r.node.children,i)||{children:{},childCount:0};r=new vP(i,r,s),n=Nr(n),i=an(n)}return r}function gg(t){return t.node.value}function MY(t,e){t.node.value=e,aL(t)}function FY(t){return t.node.childCount>0}function fpe(t){return gg(t)===void 0&&!FY(t)}function sb(t,e){Hs(t.node.children,(n,r)=>{e(new vP(n,t,r))})}function VY(t,e,n,r){n&&e(t),sb(t,i=>{VY(i,e,!0)})}function ppe(t,e,n){let r=t.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function cy(t){return new pr(t.parent===null?t.name:cy(t.parent)+"/"+t.name)}function aL(t){t.parent!==null&&mpe(t.parent,t.name,t)}function mpe(t,e,n){const r=fpe(n),i=HA(t.node.children,e);r&&i?(delete t.node.children[e],t.node.childCount--,aL(t)):!r&&!i&&(t.node.children[e]=n.node,t.node.childCount++,aL(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gpe=/[\[\].#$\/\u0000-\u001F\u007F]/,_pe=/[\[\].#$\u0000-\u001F\u007F]/,yO=10*1024*1024,wP=function(t){return typeof t=="string"&&t.length!==0&&!gpe.test(t)},QY=function(t){return typeof t=="string"&&t.length!==0&&!_pe.test(t)},Epe=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),QY(t)},vpe=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!Y1(t)||t&&typeof t=="object"&&HA(t,".sv")},HY=function(t,e,n,r){r&&e===void 0||ob(PS(t,"value"),e,n)},ob=function(t,e,n){const r=n instanceof pr?new xhe(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Sh(r));if(typeof e=="function")throw new Error(t+"contains a function "+Sh(r)+" with contents = "+e.toString());if(Y1(e))throw new Error(t+"contains "+e.toString()+" "+Sh(r));if(typeof e=="string"&&e.length>yO/3&&kS(e)>yO)throw new Error(t+"contains a string greater than "+yO+" utf8 bytes "+Sh(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(Hs(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!wP(o)))throw new Error(t+" contains an invalid key ("+o+") "+Sh(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Mhe(r,o),ob(t,a,r),Fhe(r)}),i&&s)throw new Error(t+' contains ".value" child '+Sh(r)+" in addition to actual children.")}},ype=function(t,e){let n,r;for(n=0;n<e.length;n++){r=e[n];const s=Av(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!wP(s[o]))throw new Error(t+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(khe);let i=null;for(n=0;n<e.length;n++){if(r=e[n],i!==null&&ic(i,r))throw new Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},wpe=function(t,e,n,r){const i=PS(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const s=[];Hs(e,(o,a)=>{const A=new pr(o);if(ob(i,a,ui(n,A)),eP(A)===".priority"&&!vpe(a))throw new Error(i+"contains an invalid value for '"+A.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(A)}),ype(i,s)},jY=function(t,e,n,r){if(!QY(n))throw new Error(PS(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Cpe=function(t,e,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),jY(t,e,n)},CP=function(t,e){if(an(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},Tpe=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!wP(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!Epe(n))throw new Error(PS(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Spe{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ab(t,e){let n=null;for(let r=0;r<e.length;r++){const i=e[r],s=i.getPath();n!==null&&!tP(s,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:s}),n.events.push(i)}n&&t.eventLists_.push(n)}function KY(t,e,n){ab(t,n),GY(t,r=>tP(r,e))}function uc(t,e,n){ab(t,n),GY(t,r=>ic(r,e)||ic(e,r))}function GY(t,e){t.recursionDepth_++;let n=!0;for(let r=0;r<t.eventLists_.length;r++){const i=t.eventLists_[r];if(i){const s=i.path;e(s)?(bpe(t.eventLists_[r]),t.eventLists_[r]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function bpe(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const r=n.getEventRunner();OE&&Fs("event: "+n.toString()),pg(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ipe="repo_interrupt",Rpe=25;class Ope{constructor(e,n,r,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Spe,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=k0(),this.transactionQueueTree_=new vP,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Npe(t,e,n){if(t.stats_=$1(t.repoInfo_),t.forceRestClient_||ahe())t.server_=new P0(t.repoInfo_,(r,i,s,o)=>{QQ(t,r,i,s,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>HQ(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{os(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}t.persistentConnection_=new Fl(t.repoInfo_,e,(r,i,s,o)=>{QQ(t,r,i,s,o)},r=>{HQ(t,r)},r=>{Dpe(t,r)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(r=>{t.server_.refreshAuthToken(r)}),t.appCheckProvider_.addTokenChangeListener(r=>{t.server_.refreshAppCheckToken(r.token)}),t.statsReporter_=dhe(t.repoInfo_,()=>new ufe(t.stats_,t.server_)),t.infoData_=new ofe,t.infoSyncTree_=new FQ({startListening:(r,i,s,o)=>{let a=[];const A=t.infoData_.getNode(r._path);return A.isEmpty()||(a=ay(t.infoSyncTree_,r._path,A),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),TP(t,"connected",!1),t.serverSyncTree_=new FQ({startListening:(r,i,s,o)=>(t.server_.listen(r,s,i,(a,A)=>{const u=o(a,A);uc(t.eventQueue_,r._path,u)}),[]),stopListening:(r,i)=>{t.server_.unlisten(r,i)}})}function WY(t){const n=t.infoData_.getNode(new pr(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function cb(t){return upe({timestamp:WY(t)})}function QQ(t,e,n,r,i){t.dataUpdateCount++;const s=new pr(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(i)if(r){const A=h0(n,u=>rs(u));o=spe(t.serverSyncTree_,s,A,i)}else{const A=rs(n);o=BY(t.serverSyncTree_,s,A,i)}else if(r){const A=h0(n,u=>rs(u));o=npe(t.serverSyncTree_,s,A)}else{const A=rs(n);o=ay(t.serverSyncTree_,s,A)}let a=s;o.length>0&&(a=Hm(t,s)),uc(t.eventQueue_,a,o)}function HQ(t,e){TP(t,"connected",e),e===!1&&Ppe(t)}function Dpe(t,e){Hs(e,(n,r)=>{TP(t,n,r)})}function TP(t,e,n){const r=new pr("/.info/"+e),i=rs(n);t.infoData_.updateSnapshot(r,i);const s=ay(t.infoSyncTree_,r,i);uc(t.eventQueue_,r,s)}function SP(t){return t.nextWriteId_++}function Bpe(t,e,n){const r=ope(t.serverSyncTree_,e);return r!=null?Promise.resolve(r):t.server_.get(e).then(i=>{const s=rs(i).withIndex(e._queryParams.getIndex());oL(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=ay(t.serverSyncTree_,e._path,s);else{const a=fv(t.serverSyncTree_,e);o=BY(t.serverSyncTree_,e._path,s,a)}return uc(t.eventQueue_,e._path,o),K0(t.serverSyncTree_,e,n,null,!0),s},i=>(Ay(t,"get for query "+os(e)+" failed: "+i),Promise.reject(new Error(i))))}function Lpe(t,e,n,r,i){Ay(t,"set",{path:e.toString(),value:n,priority:r});const s=cb(t),o=rs(n,r),a=hP(t.serverSyncTree_,e),A=xY(o,a,s),u=SP(t),d=DY(t.serverSyncTree_,e,A,u,!0);ab(t.eventQueue_,d),t.server_.put(e.toString(),o.val(!0),(m,g)=>{const v=m==="ok";v||yo("set at "+e+" failed: "+m);const y=td(t.serverSyncTree_,u,!v);uc(t.eventQueue_,e,y),cL(t,i,m,g)});const f=IP(t,e);Hm(t,f),uc(t.eventQueue_,f,[])}function Upe(t,e,n,r){Ay(t,"update",{path:e.toString(),value:n});let i=!0;const s=cb(t),o={};if(Hs(n,(a,A)=>{i=!1,o[a]=kY(ui(e,a),rs(A),t.serverSyncTree_,s)}),i)Fs("update() called with empty data.  Don't do anything."),cL(t,r,"ok",void 0);else{const a=SP(t),A=tpe(t.serverSyncTree_,e,o,a);ab(t.eventQueue_,A),t.server_.merge(e.toString(),n,(u,d)=>{const f=u==="ok";f||yo("update at "+e+" failed: "+u);const m=td(t.serverSyncTree_,a,!f),g=m.length>0?Hm(t,e):e;uc(t.eventQueue_,g,m),cL(t,r,u,d)}),Hs(n,u=>{const d=IP(t,ui(e,u));Hm(t,d)}),uc(t.eventQueue_,e,[])}}function Ppe(t){Ay(t,"onDisconnectEvents");const e=cb(t),n=k0();eL(t.onDisconnect_,Fn(),(i,s)=>{const o=kY(i,s,t.serverSyncTree_,e);mY(n,i,o)});let r=[];eL(n,Fn(),(i,s)=>{r=r.concat(ay(t.serverSyncTree_,i,s));const o=IP(t,i);Hm(t,o)}),t.onDisconnect_=k0(),uc(t.eventQueue_,Fn(),r)}function kpe(t,e,n){let r;an(e._path)===".info"?r=oL(t.infoSyncTree_,e,n):r=oL(t.serverSyncTree_,e,n),KY(t.eventQueue_,e._path,r)}function xpe(t,e,n){let r;an(e._path)===".info"?r=K0(t.infoSyncTree_,e,n):r=K0(t.serverSyncTree_,e,n),KY(t.eventQueue_,e._path,r)}function Mpe(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Ipe)}function Ay(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),Fs(n,...e)}function cL(t,e,n,r){e&&pg(()=>{if(n==="ok")e(null);else{const i=(n||"error").toUpperCase();let s=i;r&&(s+=": "+r);const o=new Error(s);o.code=i,e(o)}})}function zY(t,e,n){return hP(t.serverSyncTree_,e,n)||bt.EMPTY_NODE}function bP(t,e=t.transactionQueueTree_){if(e||Ab(t,e),gg(e)){const n=YY(t,e);ke(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&Fpe(t,cy(e),n)}else FY(e)&&sb(e,n=>{bP(t,n)})}function Fpe(t,e,n){const r=n.map(u=>u.currentWriteId),i=zY(t,e,r);let s=i;const o=i.hash();for(let u=0;u<n.length;u++){const d=n[u];ke(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const f=Eo(e,d.path);s=s.updateChild(f,d.currentOutputSnapshotRaw)}const a=s.val(!0),A=e;t.server_.put(A.toString(),a,u=>{Ay(t,"transaction put response",{path:A.toString(),status:u});let d=[];if(u==="ok"){const f=[];for(let m=0;m<n.length;m++)n[m].status=2,d=d.concat(td(t.serverSyncTree_,n[m].currentWriteId)),n[m].onComplete&&f.push(()=>n[m].onComplete(null,!0,n[m].currentOutputSnapshotResolved)),n[m].unwatcher();Ab(t,yP(t.transactionQueueTree_,e)),bP(t,t.transactionQueueTree_),uc(t.eventQueue_,e,d);for(let m=0;m<f.length;m++)pg(f[m])}else{if(u==="datastale")for(let f=0;f<n.length;f++)n[f].status===3?n[f].status=4:n[f].status=0;else{yo("transaction at "+A.toString()+" failed: "+u);for(let f=0;f<n.length;f++)n[f].status=4,n[f].abortReason=u}Hm(t,e)}},o)}function Hm(t,e){const n=qY(t,e),r=cy(n),i=YY(t,n);return Vpe(t,i,r),r}function Vpe(t,e,n){if(e.length===0)return;const r=[];let i=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const A=e[a],u=Eo(n,A.path);let d=!1,f;if(ke(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),A.status===4)d=!0,f=A.abortReason,i=i.concat(td(t.serverSyncTree_,A.currentWriteId,!0));else if(A.status===0)if(A.retryCount>=Rpe)d=!0,f="maxretry",i=i.concat(td(t.serverSyncTree_,A.currentWriteId,!0));else{const m=zY(t,A.path,o);A.currentInputSnapshot=m;const g=e[a].update(m.val());if(g!==void 0){ob("transaction failed: Data returned ",g,A.path);let v=rs(g);typeof g=="object"&&g!=null&&HA(g,".priority")||(v=v.updatePriority(m.getPriority()));const w=A.currentWriteId,b=cb(t),I=xY(v,m,b);A.currentOutputSnapshotRaw=v,A.currentOutputSnapshotResolved=I,A.currentWriteId=SP(t),o.splice(o.indexOf(w),1),i=i.concat(DY(t.serverSyncTree_,A.path,I,A.currentWriteId,A.applyLocally)),i=i.concat(td(t.serverSyncTree_,w,!0))}else d=!0,f="nodata",i=i.concat(td(t.serverSyncTree_,A.currentWriteId,!0))}uc(t.eventQueue_,n,i),i=[],d&&(e[a].status=2,function(m){setTimeout(m,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(f==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(f),!1,null))))}Ab(t,t.transactionQueueTree_);for(let a=0;a<r.length;a++)pg(r[a]);bP(t,t.transactionQueueTree_)}function qY(t,e){let n,r=t.transactionQueueTree_;for(n=an(e);n!==null&&gg(r)===void 0;)r=yP(r,n),e=Nr(e),n=an(e);return r}function YY(t,e){const n=[];return XY(t,e,n),n.sort((r,i)=>r.order-i.order),n}function XY(t,e,n){const r=gg(e);if(r)for(let i=0;i<r.length;i++)n.push(r[i]);sb(e,i=>{XY(t,i,n)})}function Ab(t,e){const n=gg(e);if(n){let r=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[r]=n[i],r++);n.length=r,MY(e,n.length>0?n:void 0)}sb(e,r=>{Ab(t,r)})}function IP(t,e){const n=cy(qY(t,e)),r=yP(t.transactionQueueTree_,e);return ppe(r,i=>{wO(t,i)}),wO(t,r),VY(r,i=>{wO(t,i)}),n}function wO(t,e){const n=gg(e);if(n){const r=[];let i=[],s=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(ke(s===o-1,"All SENT items should be at beginning of queue."),s=o,n[o].status=3,n[o].abortReason="set"):(ke(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat(td(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?MY(e,void 0):n.length=s+1,uc(t.eventQueue_,cy(e),i);for(let o=0;o<r.length;o++)pg(r[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qpe(t){let e="";const n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].length>0){let i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function Hpe(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const r=n.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):yo(`Invalid query segment '${n}' in query '${t}'`)}return e}const jQ=function(t,e){const n=jpe(t),r=n.namespace;n.domain==="firebase.com"&&Xl(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&n.domain!=="localhost"&&Xl("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||$de();const i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new Zq(n.host,n.secure,r,i,e,"",r!==n.subdomain),path:new pr(n.pathString)}},jpe=function(t){let e="",n="",r="",i="",s="",o=!0,a="https",A=443;if(typeof t=="string"){let u=t.indexOf("//");u>=0&&(a=t.substring(0,u-1),t=t.substring(u+2));let d=t.indexOf("/");d===-1&&(d=t.length);let f=t.indexOf("?");f===-1&&(f=t.length),e=t.substring(0,Math.min(d,f)),d<f&&(i=Qpe(t.substring(d,f)));const m=Hpe(t.substring(Math.min(t.length,f)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",A=parseInt(e.substring(u+1),10)):u=e.length;const g=e.slice(0,u);if(g.toLowerCase()==="localhost")n="localhost";else if(g.split(".").length<=2)n=g;else{const v=e.indexOf(".");r=e.substring(0,v).toLowerCase(),n=e.substring(v+1),s=r}"ns"in m&&(s=m.ns)}return{host:e,port:A,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KQ="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Kpe=function(){let t=0;const e=[];return function(n){const r=n===t;t=n;let i;const s=new Array(8);for(i=7;i>=0;i--)s[i]=KQ.charAt(n%64),n=Math.floor(n/64);ke(n===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=KQ.charAt(e[i]);return ke(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JY{constructor(e,n,r,i){this.eventType=e,this.eventRegistration=n,this.snapshot=r,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+os(this.snapshot.exportVal())}}class $Y{constructor(e,n,r){this.eventRegistration=e,this.error=n,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZY{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return ke(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(e,n,r,i){this._repo=e,this._path=n,this._queryParams=r,this._orderByCalled=i}get key(){return hn(this._path)?null:eP(this._path)}get ref(){return new jA(this._repo,this._path)}get _queryIdentifier(){const e=OQ(this._queryParams),n=X1(e);return n==="{}"?"default":n}get _queryObject(){return OQ(this._queryParams)}isEqual(e){if(e=pi(e),!(e instanceof RP))return!1;const n=this._repo===e._repo,r=tP(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Phe(this._path)}}class jA extends RP{constructor(e,n){super(e,n,new sP,!1)}get parent(){const e=cY(this._path);return e===null?null:new jA(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class jm{constructor(e,n,r){this._node=e,this.ref=n,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new pr(e),r=Km(this.ref,e);return new jm(this._node.getChild(n),r,di)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new jm(i,Km(this.ref,r),di)))}hasChild(e){const n=new pr(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ke(t,e){return t=pi(t),t._checkNotDeleted("ref"),e!==void 0?Km(t._root,e):t._root}function Km(t,e){return t=pi(t),an(t._path)===null?Cpe("child","path",e):jY("child","path",e),new jA(t._repo,ui(t._path,e))}function bh(t,e){t=pi(t),CP("push",t._path),HY("push",e,t._path,!0);const n=WY(t._repo),r=Kpe(n),i=Km(t,r),s=Km(t,r);let o;return o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function Ih(t){return CP("remove",t._path),qr(t,null)}function qr(t,e){t=pi(t),CP("set",t._path),HY("set",e,t._path,!1);const n=new qv;return Lpe(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function vr(t,e){wpe("update",e,t._path);const n=new qv;return Upe(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function Ni(t){t=pi(t);const e=new ZY(()=>{}),n=new lb(e);return Bpe(t._repo,t,n).then(r=>new jm(r,new jA(t._repo,t._path),t._queryParams.getIndex()))}class lb{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const r=n._queryParams.getIndex();return new JY("value",this,new jm(e.snapshotNode,new jA(n._repo,n._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new $Y(this,e,n):null}matches(e){return e instanceof lb?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class OP{constructor(e,n){this.eventType=e,this.callbackContext=n}respondsTo(e){let n=e==="children_added"?"child_added":e;return n=n==="children_removed"?"child_removed":n,this.eventType===n}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new $Y(this,e,n):null}createEvent(e,n){ke(e.childName!=null,"Child events should have a childName.");const r=Km(new jA(n._repo,n._path),e.childName),i=n._queryParams.getIndex();return new JY(e.type,this,new jm(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof OP?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function e7(t,e,n,r,i){const s=new ZY(n,void 0),o=e==="value"?new lb(s):new OP(e,s);return kpe(t._repo,t,o),()=>xpe(t._repo,t,o)}function mo(t,e,n,r){return e7(t,"value",e)}function Gpe(t,e,n,r){return e7(t,"child_added",e)}zfe(jA);$fe(jA);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wpe="FIREBASE_DATABASE_EMULATOR_HOST",AL={};let zpe=!1;function qpe(t,e,n,r){t.repoInfo_=new Zq(e,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),r&&(t.authTokenProvider_=r)}function Ype(t,e,n,r,i){let s=r||t.options.databaseURL;s===void 0&&(t.options.projectId||Xl("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Fs("Using default host for project ",t.options.projectId),s=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=jQ(s,i),a=o.repoInfo,A;typeof process<"u"&&uQ&&(A=uQ[Wpe]),A?(s=`http://${A}?ns=${a.namespace}`,o=jQ(s,i),a=o.repoInfo):o.repoInfo.secure;const u=new Ahe(t.name,t.options,e);Tpe("Invalid Firebase Database URL",o),hn(o.path)||Xl("Database URL must point to the root of a Firebase Database (not including a child path).");const d=Jpe(a,t,u,new che(t,n));return new $pe(d,t)}function Xpe(t,e){const n=AL[e];(!n||n[t.key]!==t)&&Xl(`Database ${e}(${t.repoInfo_}) has already been deleted.`),Mpe(t),delete n[t.key]}function Jpe(t,e,n,r){let i=AL[e.name];i||(i={},AL[e.name]=i);let s=i[t.toURLString()];return s&&Xl("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Ope(t,zpe,n,r),i[t.toURLString()]=s,s}class $pe{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Npe(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new jA(this._repo,Fn())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Xpe(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Xl("Cannot call "+e+" on a deleted database.")}}function t7(t=Xv(),e){const n=eu(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const r=t1("database");r&&Zpe(n,...r)}return n}function Zpe(t,e,n,r={}){t=pi(t),t._checkNotDeleted("useEmulator");const i=`${e}:${n}`,s=t._repoInternal;if(t._instanceStarted){if(i===t._repoInternal.repoInfo_.host&&Gl(r,s.repoInfo_.emulatorOptions))return;Xl("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)r.mockUserToken&&Xl('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new OT(OT.OWNER);else if(r.mockUserToken){const a=typeof r.mockUserToken=="string"?r.mockUserToken:n1(r.mockUserToken,t.app.options.projectId);o=new OT(a)}qpe(s,i,r,o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eme(t){Wde(xd),lc(new Ta("database",(e,{instanceIdentifier:n})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Ype(r,i,s,n)},"PUBLIC").setMultipleInstances(!0)),ro(dQ,hQ,t),ro(dQ,hQ,"esm2017")}Fl.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Fl.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};eme();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n7="firebasestorage.googleapis.com",tme="storageBucket",nme=2*60*1e3,rme=10*60*1e3,ime=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi extends dc{constructor(e,n,r=0){super(CO(e),`Firebase Storage: ${n} (${CO(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,mi.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return CO(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Hr;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Hr||(Hr={}));function CO(t){return"storage/"+t}function NP(){const t="An unknown error occurred, please check the error payload for server response.";return new mi(Hr.UNKNOWN,t)}function sme(t){return new mi(Hr.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function ome(t){return new mi(Hr.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function ame(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new mi(Hr.UNAUTHENTICATED,t)}function cme(){return new mi(Hr.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Ame(t){return new mi(Hr.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function r7(){return new mi(Hr.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function i7(){return new mi(Hr.CANCELED,"User canceled the upload/download.")}function lme(t){return new mi(Hr.INVALID_URL,"Invalid URL '"+t+"'.")}function ume(t){return new mi(Hr.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function s7(){return new mi(Hr.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function dme(){return new mi(Hr.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function hme(){return new mi(Hr.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function fme(t){return new mi(Hr.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function GQ(t){return new mi(Hr.INVALID_ARGUMENT,t)}function o7(){return new mi(Hr.APP_DELETED,"The Firebase app was deleted.")}function pme(t){return new mi(Hr.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function UE(t,e){return new mi(Hr.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function P_(t){throw new mi(Hr.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=sc.makeFromUrl(e,n)}catch{return new sc(e,"")}if(r.path==="")return r;throw ume(e)}static makeFromUrl(e,n){let r=null;const i="([A-Za-z0-9.\\-_]+)";function s(M){M.path.charAt(M.path.length-1)==="/"&&(M.path_=M.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+i+o,"i"),A={bucket:1,path:3};function u(M){M.path_=decodeURIComponent(M.path)}const d="v[A-Za-z0-9_]+",f=n.replace(/[.]/g,"\\."),m="(/([^?#]*).*)?$",g=new RegExp(`^https?://${f}/${d}/b/${i}/o${m}`,"i"),v={bucket:1,path:3},y=n===n7?"(?:storage.googleapis.com|storage.cloud.google.com)":n,w="([^?#]*)",b=new RegExp(`^https?://${y}/${i}/${w}`,"i"),B=[{regex:a,indices:A,postModify:s},{regex:g,indices:v,postModify:u},{regex:b,indices:{bucket:1,path:2},postModify:u}];for(let M=0;M<B.length;M++){const H=B[M],K=H.regex.exec(e);if(K){const Q=K[H.indices.bucket];let F=K[H.indices.path];F||(F=""),r=new sc(Q,F),H.postModify(r);break}}if(r==null)throw lme(e);return r}}class mme{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gme(t,e,n){let r=1,i=null,s=null,o=!1,a=0;function A(){return a===2}let u=!1;function d(...w){u||(u=!0,e.apply(null,w))}function f(w){i=setTimeout(()=>{i=null,t(g,A())},w)}function m(){s&&clearTimeout(s)}function g(w,...b){if(u){m();return}if(w){m(),d.call(null,w,...b);return}if(A()||o){m(),d.call(null,w,...b);return}r<64&&(r*=2);let B;a===1?(a=2,B=0):B=(r+Math.random())*1e3,f(B)}let v=!1;function y(w){v||(v=!0,m(),!u&&(i!==null?(w||(a=2),clearTimeout(i),f(0)):w||(a=1)))}return f(0),s=setTimeout(()=>{o=!0,y(!0)},n),y}function _me(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eme(t){return t!==void 0}function vme(t){return typeof t=="function"}function yme(t){return typeof t=="object"&&!Array.isArray(t)}function ub(t){return typeof t=="string"||t instanceof String}function WQ(t){return DP()&&t instanceof Blob}function DP(){return typeof Blob<"u"}function zQ(t,e,n,r){if(r<e)throw GQ(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw GQ(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ly(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function a7(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const i=e(r)+"="+e(t[r]);n=n+i+"&"}return n=n.slice(0,-1),n}var $h;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})($h||($h={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c7(t,e){const n=t>=500&&t<600,i=[408,429].indexOf(t)!==-1,s=e.indexOf(t)!==-1;return n||i||s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wme{constructor(e,n,r,i,s,o,a,A,u,d,f,m=!0){this.url_=e,this.method_=n,this.headers_=r,this.body_=i,this.successCodes_=s,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=A,this.timeout_=u,this.progressCallback_=d,this.connectionFactory_=f,this.retry=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((g,v)=>{this.resolve_=g,this.reject_=v,this.start_()})}start_(){const e=(r,i)=>{if(i){r(!1,new Jw(!1,null,!0));return}const s=this.connectionFactory_();this.pendingConnection_=s;const o=a=>{const A=a.loaded,u=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(A,u)};this.progressCallback_!==null&&s.addUploadProgressListener(o),s.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&s.removeUploadProgressListener(o),this.pendingConnection_=null;const a=s.getErrorCode()===$h.NO_ERROR,A=s.getStatus();if(!a||c7(A,this.additionalRetryCodes_)&&this.retry){const d=s.getErrorCode()===$h.ABORT;r(!1,new Jw(!1,null,d));return}const u=this.successCodes_.indexOf(A)!==-1;r(!0,new Jw(u,s))})},n=(r,i)=>{const s=this.resolve_,o=this.reject_,a=i.connection;if(i.wasSuccessCode)try{const A=this.callback_(a,a.getResponse());Eme(A)?s(A):s()}catch(A){o(A)}else if(a!==null){const A=NP();A.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,A)):o(A)}else if(i.canceled){const A=this.appDelete_?o7():i7();o(A)}else{const A=r7();o(A)}};this.canceled_?n(!1,new Jw(!1,null,!0)):this.backoffId_=gme(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&_me(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Jw{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function Cme(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function Tme(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function Sme(t,e){e&&(t["X-Firebase-GMPID"]=e)}function bme(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function Ime(t,e,n,r,i,s,o=!0){const a=a7(t.urlParams),A=t.url+a,u=Object.assign({},t.headers);return Sme(u,e),Cme(u,n),Tme(u,s),bme(u,r),new wme(A,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rme(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function Ome(...t){const e=Rme();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(DP())return new Blob(t);throw new mi(Hr.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function Nme(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dme(t){if(typeof atob>"u")throw fme("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OA={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class TO{constructor(e,n){this.data=e,this.contentType=n||null}}function Bme(t,e){switch(t){case OA.RAW:return new TO(A7(e));case OA.BASE64:case OA.BASE64URL:return new TO(l7(t,e));case OA.DATA_URL:return new TO(Ume(e),Pme(e))}throw NP()}function A7(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const s=r,o=t.charCodeAt(++n);r=65536|(s&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function Lme(t){let e;try{e=decodeURIComponent(t)}catch{throw UE(OA.DATA_URL,"Malformed data URL.")}return A7(e)}function l7(t,e){switch(t){case OA.BASE64:{const i=e.indexOf("-")!==-1,s=e.indexOf("_")!==-1;if(i||s)throw UE(t,"Invalid character '"+(i?"-":"_")+"' found: is it base64url encoded?");break}case OA.BASE64URL:{const i=e.indexOf("+")!==-1,s=e.indexOf("/")!==-1;if(i||s)throw UE(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=Dme(e)}catch(i){throw i.message.includes("polyfill")?i:UE(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}class u7{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw UE(OA.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=kme(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function Ume(t){const e=new u7(t);return e.base64?l7(OA.BASE64,e.rest):Lme(e.rest)}function Pme(t){return new u7(t).contentType}function kme(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qu{constructor(e,n){let r=0,i="";WQ(e)?(this.data_=e,r=e.size,i=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=i}size(){return this.size_}type(){return this.type_}slice(e,n){if(WQ(this.data_)){const r=this.data_,i=Nme(r,e,n);return i===null?null:new qu(i)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new qu(r,!0)}}static getBlob(...e){if(DP()){const n=e.map(r=>r instanceof qu?r.data_:r);return new qu(Ome.apply(null,n))}else{const n=e.map(o=>ub(o)?Bme(OA.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const i=new Uint8Array(r);let s=0;return n.forEach(o=>{for(let a=0;a<o.length;a++)i[s++]=o[a]}),new qu(i,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function d7(t){let e;try{e=JSON.parse(t)}catch{return null}return yme(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xme(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function h7(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mme(t,e){return e}class lo{constructor(e,n,r,i){this.server=e,this.local=n||e,this.writable=!!r,this.xform=i||Mme}}let $w=null;function Fme(t){return!ub(t)||t.length<2?t:h7(t)}function f7(){if($w)return $w;const t=[];t.push(new lo("bucket")),t.push(new lo("generation")),t.push(new lo("metageneration")),t.push(new lo("name","fullPath",!0));function e(s,o){return Fme(o)}const n=new lo("name");n.xform=e,t.push(n);function r(s,o){return o!==void 0?Number(o):o}const i=new lo("size");return i.xform=r,t.push(i),t.push(new lo("timeCreated")),t.push(new lo("updated")),t.push(new lo("md5Hash",null,!0)),t.push(new lo("cacheControl",null,!0)),t.push(new lo("contentDisposition",null,!0)),t.push(new lo("contentEncoding",null,!0)),t.push(new lo("contentLanguage",null,!0)),t.push(new lo("contentType",null,!0)),t.push(new lo("metadata","customMetadata",!0)),$w=t,$w}function Vme(t,e){function n(){const r=t.bucket,i=t.fullPath,s=new sc(r,i);return e._makeStorageReference(s)}Object.defineProperty(t,"ref",{get:n})}function Qme(t,e,n){const r={};r.type="file";const i=n.length;for(let s=0;s<i;s++){const o=n[s];r[o.local]=o.xform(r,e[o.server])}return Vme(r,t),r}function p7(t,e,n){const r=d7(e);return r===null?null:Qme(t,r,n)}function Hme(t,e,n,r){const i=d7(e);if(i===null||!ub(i.downloadTokens))return null;const s=i.downloadTokens;if(s.length===0)return null;const o=encodeURIComponent;return s.split(",").map(u=>{const d=t.bucket,f=t.fullPath,m="/b/"+o(d)+"/o/"+o(f),g=ly(m,n,r),v=a7({alt:"media",token:u});return g+v})[0]}function m7(t,e){const n={},r=e.length;for(let i=0;i<r;i++){const s=e[i];s.writable&&(n[s.server]=t[s.local])}return JSON.stringify(n)}class _g{constructor(e,n,r,i){this.url=e,this.method=n,this.handler=r,this.timeout=i,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vl(t){if(!t)throw NP()}function BP(t,e){function n(r,i){const s=p7(t,i,e);return Vl(s!==null),s}return n}function jme(t,e){function n(r,i){const s=p7(t,i,e);return Vl(s!==null),Hme(s,i,t.host,t._protocol)}return n}function uy(t){function e(n,r){let i;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?i=cme():i=ame():n.getStatus()===402?i=ome(t.bucket):n.getStatus()===403?i=Ame(t.path):i=r,i.status=n.getStatus(),i.serverResponse=r.serverResponse,i}return e}function g7(t){const e=uy(t);function n(r,i){let s=e(r,i);return r.getStatus()===404&&(s=sme(t.path)),s.serverResponse=i.serverResponse,s}return n}function Kme(t,e,n){const r=e.fullServerUrl(),i=ly(r,t.host,t._protocol),s="GET",o=t.maxOperationRetryTime,a=new _g(i,s,BP(t,n),o);return a.errorHandler=g7(e),a}function Gme(t,e,n){const r=e.fullServerUrl(),i=ly(r,t.host,t._protocol),s="GET",o=t.maxOperationRetryTime,a=new _g(i,s,jme(t,n),o);return a.errorHandler=g7(e),a}function Wme(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function _7(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=Wme(null,e)),r}function zme(t,e,n,r,i){const s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let B="";for(let M=0;M<2;M++)B=B+Math.random().toString().slice(2);return B}const A=a();o["Content-Type"]="multipart/related; boundary="+A;const u=_7(e,r,i),d=m7(u,n),f="--"+A+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+d+`\r
--`+A+`\r
Content-Type: `+u.contentType+`\r
\r
`,m=`\r
--`+A+"--",g=qu.getBlob(f,r,m);if(g===null)throw s7();const v={name:u.fullPath},y=ly(s,t.host,t._protocol),w="POST",b=t.maxUploadRetryTime,I=new _g(y,w,BP(t,n),b);return I.urlParams=v,I.headers=o,I.body=g.uploadData(),I.errorHandler=uy(e),I}class G0{constructor(e,n,r,i){this.current=e,this.total=n,this.finalized=!!r,this.metadata=i||null}}function LP(t,e){let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch{Vl(!1)}return Vl(!!n&&(e||["active"]).indexOf(n)!==-1),n}function qme(t,e,n,r,i){const s=e.bucketOnlyServerUrl(),o=_7(e,r,i),a={name:o.fullPath},A=ly(s,t.host,t._protocol),u="POST",d={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},f=m7(o,n),m=t.maxUploadRetryTime;function g(y){LP(y);let w;try{w=y.getResponseHeader("X-Goog-Upload-URL")}catch{Vl(!1)}return Vl(ub(w)),w}const v=new _g(A,u,g,m);return v.urlParams=a,v.headers=d,v.body=f,v.errorHandler=uy(e),v}function Yme(t,e,n,r){const i={"X-Goog-Upload-Command":"query"};function s(u){const d=LP(u,["active","final"]);let f=null;try{f=u.getResponseHeader("X-Goog-Upload-Size-Received")}catch{Vl(!1)}f||Vl(!1);const m=Number(f);return Vl(!isNaN(m)),new G0(m,r.size(),d==="final")}const o="POST",a=t.maxUploadRetryTime,A=new _g(n,o,s,a);return A.headers=i,A.errorHandler=uy(e),A}const qQ=256*1024;function Xme(t,e,n,r,i,s,o,a){const A=new G0(0,0);if(o?(A.current=o.current,A.total=o.total):(A.current=0,A.total=r.size()),r.size()!==A.total)throw dme();const u=A.total-A.current;let d=u;i>0&&(d=Math.min(d,i));const f=A.current,m=f+d;let g="";d===0?g="finalize":u===d?g="upload, finalize":g="upload";const v={"X-Goog-Upload-Command":g,"X-Goog-Upload-Offset":`${A.current}`},y=r.slice(f,m);if(y===null)throw s7();function w(M,H){const K=LP(M,["active","final"]),Q=A.current+d,F=r.size();let k;return K==="final"?k=BP(e,s)(M,H):k=null,new G0(Q,F,K==="final",k)}const b="POST",I=e.maxUploadRetryTime,B=new _g(n,b,w,I);return B.headers=v,B.body=y.uploadData(),B.progressCallback=a||null,B.errorHandler=uy(t),B}const ko={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function SO(t){switch(t){case"running":case"pausing":case"canceling":return ko.RUNNING;case"paused":return ko.PAUSED;case"success":return ko.SUCCESS;case"canceled":return ko.CANCELED;case"error":return ko.ERROR;default:return ko.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jme{constructor(e,n,r){if(vme(e)||n!=null||r!=null)this.next=e,this.error=n??void 0,this.complete=r??void 0;else{const s=e;this.next=s.next,this.error=s.error,this.complete=s.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lp(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class $me{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=$h.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=$h.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=$h.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,i){if(this.sent_)throw P_("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return r!==void 0?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw P_("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw P_("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw P_("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw P_("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class Zme extends $me{initXhr(){this.xhr_.responseType="text"}}function Qp(){return new Zme}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ege{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(e,n,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=n,this._metadata=r,this._mappings=f7(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=i=>{if(this._request=void 0,this._chunkMultiplier=1,i._codeEquals(Hr.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const s=this.isExponentialBackoffExpired();if(c7(i.status,[]))if(s)i=r7();else{this.sleepTime=Math.max(this.sleepTime*2,ime),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=i,this._transition("error")}},this._metadataErrorHandler=i=>{this._request=void 0,i._codeEquals(Hr.CANCELED)?this.completeTransitions_():(this._error=i,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((i,s)=>{this._resolve=i,this._reject=s,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return n=>this._updateProgress(e+n)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,r])=>{switch(this._state){case"running":e(n,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,n)=>{const r=qme(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,Qp,e,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._uploadUrl=s,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((n,r)=>{const i=Yme(this._ref.storage,this._ref._location,e,this._blob),s=this._ref.storage._makeRequest(i,Qp,n,r);this._request=s,s.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=qQ*this._chunkMultiplier,n=new G0(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((i,s)=>{let o;try{o=Xme(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,n,this._makeProgressCallback())}catch(A){this._error=A,this._transition("error");return}const a=this._ref.storage._makeRequest(o,Qp,i,s,!1);this._request=a,a.getPromise().then(A=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(A.current),A.finalized?(this._metadata=A.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){qQ*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,n)=>{const r=Kme(this._ref.storage,this._ref._location,this._mappings),i=this._ref.storage._makeRequest(r,Qp,e,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,n)=>{const r=zme(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),i=this._ref.storage._makeRequest(r,Qp,e,n);this._request=i,i.getPromise().then(s=>{this._request=void 0,this._metadata=s,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const n=this._transferred;this._transferred=e,this._transferred!==n&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const n=this._state==="paused";this._state=e,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=i7(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=SO(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,n,r,i){const s=new Jme(n||void 0,r||void 0,i||void 0);return this._addObserver(s),()=>{this._removeObserver(s)}}then(e,n){return this._promise.then(e,n)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const n=this._observers.indexOf(e);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(SO(this._state)){case ko.SUCCESS:lp(this._resolve.bind(null,this.snapshot))();break;case ko.CANCELED:case ko.ERROR:const n=this._reject;lp(n.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(SO(this._state)){case ko.RUNNING:case ko.PAUSED:e.next&&lp(e.next.bind(e,this.snapshot))();break;case ko.SUCCESS:e.complete&&lp(e.complete.bind(e))();break;case ko.CANCELED:case ko.ERROR:e.error&&lp(e.error.bind(e,this._error))();break;default:e.error&&lp(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0{constructor(e,n){this._service=e,n instanceof sc?this._location=n:this._location=sc.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new W0(e,n)}get root(){const e=new sc(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return h7(this._location.path)}get storage(){return this._service}get parent(){const e=xme(this._location.path);if(e===null)return null;const n=new sc(this._location.bucket,e);return new W0(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw pme(e)}}function tge(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new ege(t,new qu(e),n)}function nge(t){t._throwIfRoot("getDownloadURL");const e=Gme(t.storage,t._location,f7());return t.storage.makeRequestWithTokens(e,Qp).then(n=>{if(n===null)throw hme();return n})}function YQ(t,e){const n=e==null?void 0:e[tme];return n==null?null:sc.makeFromBucketSpec(n,t)}function rge(t,e,n,r={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:n1(i,t.app.options.projectId))}class ige{constructor(e,n,r,i,s){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=i,this._firebaseVersion=s,this._bucket=null,this._host=n7,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=nme,this._maxUploadRetryTime=rme,this._requests=new Set,i!=null?this._bucket=sc.makeFromBucketSpec(i,this._host):this._bucket=YQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=sc.makeFromBucketSpec(this._url,e):this._bucket=YQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){zQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){zQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(ec(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new W0(this,e)}_makeRequest(e,n,r,i,s=!0){if(this._deleted)return new mme(o7());{const o=Ime(e,this._appId,r,i,n,this._firebaseVersion,s);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,i]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,i).getPromise()}}const XQ="@firebase/storage",JQ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E7="storage";function sge(t,e,n){return t=pi(t),tge(t,e,n)}function oge(t){return t=pi(t),nge(t)}function age(t=Xv(),e){t=pi(t);const r=eu(t,E7).getImmediate({identifier:e}),i=t1("storage");return i&&cge(r,...i),r}function cge(t,e,n,r={}){rge(t,e,n,r)}function Age(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),i=t.getProvider("app-check-internal");return new ige(n,r,i,e,xd)}function lge(){lc(new Ta(E7,Age,"PUBLIC").setMultipleInstances(!0)),ro(XQ,JQ,""),ro(XQ,JQ,"esm2017")}lge();const uge={apiKey:"AIzaSyAhnSrmFmORLNNn0m5FRlnCVFsdz9e1Ye0",authDomain:"xraivision-2fc49.firebaseapp.com",databaseURL:"https://xraivision-2fc49-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"xraivision-2fc49",storageBucket:"xraivision-2fc49.firebasestorage.app",messagingSenderId:"469449360476",appId:"1:469449360476:web:ea9c235659619ea8941299",measurementId:"G-WGEKRGPYEC"},Eg=g9(uge);Hae(Eg);const _l=HAe(Eg),v7=Ide(Eg),et=t7(Eg),dge=age(Eg);console.log("Firebase initialized:",Eg);const UP="/assets/xrai-CIw320yl.png",hge=({onSignIn:t})=>{const[e,n]=X.useState(""),[r,i]=X.useState(""),[s,o]=X.useState(""),[a,A]=X.useState(!1),u=og(),d=async f=>{f.preventDefault(),A(!0),o("");try{console.log("Attempting to sign in with license credentials...");const m=Oq(v7,"licenses"),g=kq(m,XB("licenseId","==",e),XB("password","==",r)),v=await Mq(g);if(v.empty){o("Invalid License ID or Password"),A(!1);return}const w=v.docs[0].data(),b={uid:e,companyName:w.companyName};console.log("License authenticated. Constructed user:",b);const I=Ke(et,`active_users/${b.uid}`),B=await Ni(I),M=B.exists()?B.val():null,H=M||{status:"available",incoming_calls:[],chats:[]};console.log("Data being written to Realtime Database:",H),await qr(I,H),t(b),u("/dashboard",{state:{userId:b.uid,companyName:b.companyName}})}catch(m){console.error("Error during sign-in with license:",m),o("An error occurred during sign-in."),A(!1)}};return R.jsx("div",{className:"flex justify-center items-center min-h-screen bg-gray-900",children:R.jsxs("div",{className:"signin-card bg-blue-900 w-full sm:w-96 p-8 rounded-lg border-4 border-white shadow-xl",style:{boxShadow:"0 0 2px 1px rgba(255, 255, 255, 0.6)"},children:[R.jsx("div",{className:"signin-logo-container flex justify-center mb-6",children:R.jsx("div",{className:"signin-logo w-16 h-16 bg-gradient-to-r from-purple-500 to-blue-600 rounded-lg flex justify-center items-center mb-4",children:R.jsx("img",{src:UP,alt:"XRAI Vision Logo",className:"w-12 h-12 object-contain"})})}),R.jsx("h2",{className:"text-2xl font-bold text-center text-white mb-4",children:"Provider Sign In"}),R.jsxs("form",{onSubmit:d,children:[R.jsxs("div",{className:"signin-input-group mb-4",children:[R.jsx("label",{htmlFor:"licenseId",className:"block text-sm font-semibold text-gray-300",children:"License ID"}),R.jsxs("div",{className:"signin-input-container relative",children:[R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[R.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),R.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),R.jsx("input",{id:"licenseId",type:"text",placeholder:"Enter License ID",value:e,onChange:f=>n(f.target.value),className:"w-full pl-10 py-3 bg-gray-800 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),R.jsxs("div",{className:"signin-input-group mb-4",children:[R.jsx("label",{htmlFor:"licensePassword",className:"block text-sm font-semibold text-gray-300",children:"License Password"}),R.jsxs("div",{className:"signin-input-container relative",children:[R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[R.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),R.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]}),R.jsx("input",{id:"licensePassword",type:"password",placeholder:"Enter License Password",value:r,onChange:f=>i(f.target.value),className:"w-full pl-10 py-3 bg-gray-800 text-white rounded-md border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),s&&R.jsx("div",{className:"text-sm text-red-500 mb-4",children:s}),R.jsx("button",{type:"submit",className:`w-full py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-md font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 ${a?"opacity-50 cursor-not-allowed":""}`,disabled:a,children:a?R.jsx("span",{className:"flex justify-center items-center space-x-2",children:R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5 animate-spin",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[R.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),R.jsx("path",{d:"M4 12a8 8 0 1 1 16 0 8 8 0 0 1-16 0",stroke:"currentColor",strokeWidth:"4",fill:"none"})]})}):"Sign In"})]}),R.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-500 mt-4",children:[R.jsx("a",{href:"#forgot-password",className:"hover:text-blue-500",children:"Forgot Password?"}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("span",{children:"Powered by"}),R.jsx("img",{src:"https://via.placeholder.com/60",alt:"Agili8",className:"w-12 h-12"})]})]})]})})},Ps=[];for(let t=0;t<256;++t)Ps.push((t+256).toString(16).slice(1));function fge(t,e=0){return(Ps[t[e+0]]+Ps[t[e+1]]+Ps[t[e+2]]+Ps[t[e+3]]+"-"+Ps[t[e+4]]+Ps[t[e+5]]+"-"+Ps[t[e+6]]+Ps[t[e+7]]+"-"+Ps[t[e+8]]+Ps[t[e+9]]+"-"+Ps[t[e+10]]+Ps[t[e+11]]+Ps[t[e+12]]+Ps[t[e+13]]+Ps[t[e+14]]+Ps[t[e+15]]).toLowerCase()}let bO;const pge=new Uint8Array(16);function mge(){if(!bO){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");bO=crypto.getRandomValues.bind(crypto)}return bO(pge)}const gge=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$Q={randomUUID:gge};function Zw(t,e,n){var i;if($Q.randomUUID&&!t)return $Q.randomUUID();t=t||{};const r=t.random??((i=t.rng)==null?void 0:i.call(t))??mge();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,fge(r)}const _ge="/assets/iphone-ringtone-47958%20(1)-1i19vDYu.mp3";var y7={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},ZQ=qh.createContext&&qh.createContext(y7),Ege=["attr","size","title"];function vge(t,e){if(t==null)return{};var n=yge(t,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function yge(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function z0(){return z0=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},z0.apply(this,arguments)}function e4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function q0(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?e4(Object(n),!0).forEach(function(r){wge(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function wge(t,e,n){return e=Cge(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Cge(t){var e=Tge(t,"string");return typeof e=="symbol"?e:e+""}function Tge(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function w7(t){return t&&t.map((e,n)=>qh.createElement(e.tag,q0({key:n},e.attr),w7(e.child)))}function Sge(t){return e=>qh.createElement(bge,z0({attr:q0({},t.attr)},e),w7(t.child))}function bge(t){var e=n=>{var{attr:r,size:i,title:s}=t,o=vge(t,Ege),a=i||n.size||"1em",A;return n.className&&(A=n.className),t.className&&(A=(A?A+" ":"")+t.className),qh.createElement("svg",z0({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,o,{className:A,style:q0(q0({color:t.color||n.color},n.style),t.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),s&&qh.createElement("title",null,s),t.children)};return ZQ!==void 0?qh.createElement(ZQ.Consumer,null,n=>e(n)):e(y7)}function t4(t){return Sge({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"},child:[]}]})(t)}const C7=({callId:t,userId:e,userName:n,onCloseChat:r,dashboardMode:i=!1,dashboardChatUser:s=null})=>{const[o,a]=X.useState([]),[A,u]=X.useState(""),d=X.useRef(),f=t7();X.useEffect(()=>{let v;if(i&&s)v=Ke(f,`dashboardChats/${e}/${s}/messages`);else if(t)v=Ke(f,`videoCalls/${t}/chatMessages`);else return;const y=Gpe(v,w=>{if(w.exists()){const b=w.val();a(I=>[...I,b])}});return()=>{y()}},[t,f,i,s,e]);const m=async v=>{if(v.trim())try{let y;if(i&&s){const I=Ke(f,`dashboardChats/${e}/${s}/messages`),B=Ke(f,`dashboardChats/${s}/${e}/messages`),M={senderId:e,senderName:n,timestamp:Date.now(),type:"text",content:v.trim()};await Promise.all([qr(bh(I),M),qr(bh(B),M)]),u("");return}else if(t)y=Ke(f,`videoCalls/${t}/chatMessages`);else return;const w=bh(y),b={senderId:e,senderName:n,timestamp:Date.now(),type:"text",content:v.trim()};await qr(w,b),u("")}catch(y){alert("Send failed: "+y.message)}},g=async v=>{const y=v.target.files[0];if(!y)return;if(!y.type.startsWith("image/")){alert("Only image files are supported without Firebase Storage.");return}const w=new FileReader;w.onload=async b=>{const I=b.target.result;if(i&&s){const K=Ke(f,`dashboardChats/${e}/${s}/messages`),Q=Ke(f,`dashboardChats/${s}/${e}/messages`),F={senderId:e,senderName:n,timestamp:Date.now(),type:"image",content:I,fileName:y.name,fileMimeType:y.type};await Promise.all([qr(bh(K),F),qr(bh(Q),F)]),d.current&&(d.current.value="");return}let B;if(t)B=Ke(f,`videoCalls/${t}/chatMessages`);else return;const M=bh(B),H={senderId:e,senderName:n,timestamp:Date.now(),type:"image",content:I,fileName:y.name,fileMimeType:y.type};await qr(M,H),d.current&&(d.current.value="")},w.readAsDataURL(y)};return i?R.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50",children:R.jsxs("div",{className:"w-[40rem] h-[40rem] bg-gray-700 p-4 flex flex-col shadow-2xl rounded-2xl border border-gray-600",children:[R.jsxs("div",{className:"flex justify-between items-center mb-4",children:[R.jsx("h2",{className:"text-lg font-bold text-white",children:"Chat"}),R.jsx("button",{onClick:r,className:"p-1 rounded-full hover:bg-gray-600","aria-label":"Close Chat",children:R.jsx("svg",{className:"w-5 h-5 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:R.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),R.jsx("div",{className:"flex-1 overflow-y-auto mb-2",children:o.map((v,y)=>R.jsxs("div",{className:`mb-2 p-3 rounded-xl max-w-xs ${v.senderId===e?"ml-auto bg-blue-600 text-white":"mr-auto bg-gray-600 text-white"}`,children:[R.jsx("div",{className:"text-sm font-semibold",children:v.senderName}),v.type==="text"&&R.jsx("div",{children:v.content}),v.type==="image"&&R.jsx("a",{href:v.content.startsWith("data:image")?v.content:`data:image/jpeg;base64,${v.content}`,download:v.fileName||"chat_image.jpg",target:"_blank",rel:"noopener noreferrer",children:R.jsx("img",{src:v.content.startsWith("data:image")?v.content:`data:image/jpeg;base64,${v.content}`,alt:v.fileName||"Image",className:"max-w-full rounded mt-1",onError:w=>{w.target.src="/fallback-image.png"}})}),v.type==="file"&&R.jsx("a",{href:v.content,target:"_blank",rel:"noopener noreferrer",className:"underline text-white",children:v.fileName||"Download file"}),R.jsx("div",{className:"text-xs text-gray-300 mt-1",children:new Date(v.timestamp).toLocaleString()})]},y))}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("input",{type:"text",value:A,onChange:v=>u(v.target.value),onKeyDown:v=>v.key==="Enter"&&m(A),placeholder:"Type a message...",className:"flex-1 p-2 border border-gray-500 rounded-l bg-gray-800 text-white","aria-label":"Message input"}),R.jsx("button",{onClick:()=>m(A),className:"p-2 bg-blue-500 text-white rounded-r","aria-label":"Send message",children:"Send"})]}),R.jsxs("div",{className:"mt-2",children:[R.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer text-white",children:R.jsx(t4,{size:24})}),R.jsx("input",{id:"file-upload",type:"file",ref:d,onChange:g,className:"hidden","aria-label":"Choose file to send"})]})]})}):R.jsxs("div",{className:"absolute top-0 right-0 w-80 h-full bg-gray-700 p-4 flex flex-col shadow-lg z-30",children:[R.jsxs("div",{className:"flex justify-between items-center mb-4",children:[R.jsx("h2",{className:"text-lg font-bold text-white",children:"Chat"}),R.jsx("button",{onClick:r,className:"p-1 rounded-full hover:bg-gray-600","aria-label":"Close Chat",children:R.jsx("svg",{className:"w-5 h-5 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:R.jsx("path",{d:"M6 18L18 6M6 6l12 12"})})})]}),R.jsx("div",{className:"flex-1 overflow-y-auto mb-2",children:o.map((v,y)=>R.jsxs("div",{className:`mb-2 p-3 rounded-xl max-w-xs ${v.senderId===e?"ml-auto bg-blue-600 text-white":"mr-auto bg-gray-600 text-white"}`,children:[R.jsx("div",{className:"text-sm font-semibold",children:v.senderName}),v.type==="text"&&R.jsx("div",{children:v.content}),v.type==="image"&&R.jsx("a",{href:v.content.startsWith("data:image")?v.content:`data:image/jpeg;base64,${v.content}`,download:v.fileName||"chat_image.jpg",target:"_blank",rel:"noopener noreferrer",children:R.jsx("img",{src:v.content.startsWith("data:image")?v.content:`data:image/jpeg;base64,${v.content}`,alt:v.fileName||"Image",className:"max-w-full rounded mt-1",onError:w=>{w.target.src="/fallback-image.png"}})}),v.type==="file"&&R.jsx("a",{href:v.content,target:"_blank",rel:"noopener noreferrer",className:"underline text-white",children:v.fileName||"Download file"}),R.jsx("div",{className:"text-xs text-gray-300 mt-1",children:new Date(v.timestamp).toLocaleString()})]},y))}),R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("input",{type:"text",value:A,onChange:v=>u(v.target.value),onKeyDown:v=>v.key==="Enter"&&m(A),placeholder:"Type a message...",className:"flex-1 p-2 border border-gray-500 rounded-l bg-gray-800 text-white","aria-label":"Message input"}),R.jsx("button",{onClick:()=>m(A),className:"p-2 bg-blue-500 text-white rounded-r","aria-label":"Send message",children:"Send"})]}),R.jsxs("div",{className:"mt-2",children:[R.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer text-white",children:R.jsx(t4,{size:24})}),R.jsx("input",{id:"file-upload",type:"file",ref:d,onChange:g,className:"hidden","aria-label":"Choose file to send"})]})]})},Ige=({message:t,onConfirm:e,onCancel:n})=>R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:R.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg max-w-md",children:[R.jsx("h2",{className:"text-xl font-bold mb-4",children:"Confirm Action"}),R.jsx("p",{className:"mb-6",children:t}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsx("button",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:e,children:"Confirm"}),R.jsx("button",{className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded",onClick:n,children:"Cancel"})]})]})}),Rge=({caller:t,onAccept:e,onReject:n,onClose:r})=>{var i,s,o;return R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:R.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg max-w-md w-full mx-4",children:[R.jsxs("div",{className:"caller-info text-center",children:[R.jsx("div",{className:"caller-avatar bg-blue-500 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4",children:R.jsx("span",{className:"text-2xl font-bold text-white",children:((i=t==null?void 0:t.name)==null?void 0:i.charAt(0))||((s=t==null?void 0:t.callerName)==null?void 0:s.charAt(0))||((o=t==null?void 0:t.caller)==null?void 0:o.charAt(0))||"U"})}),R.jsx("h2",{className:"text-xl font-bold mb-2",children:(t==null?void 0:t.name)||(t==null?void 0:t.callerName)||(t==null?void 0:t.caller)||"Unknown"}),R.jsx("p",{className:"text-gray-300 mb-1",children:(t==null?void 0:t.title)||"Group Call"}),R.jsx("p",{className:"text-sm text-gray-400",children:"is calling you..."})]}),R.jsxs("div",{className:"flex justify-center space-x-4 mt-6",children:[R.jsxs("button",{className:"bg-green-500 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full transition-colors flex items-center gap-2",onClick:e,children:[R.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:R.jsx("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})}),"Accept"]}),R.jsxs("button",{className:"bg-red-500 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full transition-colors flex items-center gap-2",onClick:n,children:[R.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:R.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),"Reject"]})]}),R.jsx("button",{className:"absolute top-4 right-4 text-gray-400 hover:text-white transition-colors",onClick:r,children:R.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})})},Oge=({onClose:t})=>R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:R.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[R.jsx("h2",{className:"text-xl font-bold mb-2",children:"Agili8 Support"}),R.jsxs("p",{children:["For support, please call"," ",R.jsx("a",{href:"tel:+611800841989",className:"text-blue-400",children:"+61 1800 841 989"})," ","or email"," ",R.jsx("a",{href:"mailto:help@agili8.com",className:"text-blue-400",children:"help@agili8.com"})]}),R.jsx("button",{onClick:t,className:"mt-4 p-2 bg-blue-500 text-white rounded",children:"Close"})]})}),Nge=({user:t,fetchCalls:e,calls:n,loadingCalls:r,selectedCapture:i,setSelectedCapture:s,isLibraryOpen:o,setIsLibraryOpen:a,showCallHistory:A,setShowCallHistory:u,deleteCapture:d,downloadCapture:f,actionDialog:m,setActionDialog:g,clearCallHistory:v})=>{const y=()=>R.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mt-4",children:r?R.jsx("div",{className:"col-span-full flex justify-center py-8",children:R.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):n.length>0?n.filter(I=>I.captures&&Object.keys(I.captures).length>0).sort((I,B)=>new Date(B.createdAt)-new Date(I.createdAt)).map(I=>R.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg cursor-pointer hover:bg-gray-700 transition-all border border-gray-700",onClick:()=>{s({callId:I.id,captures:I.captures,title:I.title})},children:[R.jsx("h3",{className:"text-lg font-medium mb-2",children:I.title||"Untitled Call"}),R.jsxs("div",{className:"flex justify-between text-sm text-gray-400",children:[R.jsx("span",{children:new Date(I.createdAt instanceof Date?I.createdAt:new Date(I.createdAt)).toLocaleDateString()}),R.jsxs("span",{className:"flex items-center",children:[R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),I.captures?Object.keys(I.captures).length:0," ","captures"]})]})]},I.id)):R.jsx("div",{className:"col-span-full text-center py-8 text-gray-400",children:"No captures available"})}),w=()=>R.jsx("div",{className:"grid grid-cols-1 gap-4 mt-4",children:r?R.jsx("div",{className:"flex justify-center py-8",children:R.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):n.length>0?n.sort((I,B)=>new Date(B.createdAt)-new Date(I.createdAt)).map(I=>{let B="Unknown";return I.users&&(Array.isArray(I.users)?B=I.users.join(", "):typeof I.users=="object"?B=Object.keys(I.users).join(", "):typeof I.users=="string"&&(B=I.users)),R.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg border border-gray-700",children:[R.jsx("h3",{className:"text-lg font-medium mb-2",children:I.title||"Untitled Call"}),R.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-gray-400",children:[R.jsxs("span",{className:"flex items-center",children:[R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),new Date(I.createdAt instanceof Date?I.createdAt:new Date(I.createdAt)).toLocaleDateString()]}),R.jsxs("span",{className:"flex items-center",children:[R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),new Date(I.createdAt instanceof Date?I.createdAt:new Date(I.createdAt)).toLocaleTimeString()]}),R.jsxs("span",{className:"flex items-center",children:[R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),B]}),R.jsxs("span",{className:"flex items-center",children:[R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),I.captures?Object.keys(I.captures).length:0," ","captures"]})]}),R.jsx("div",{className:"mt-3",children:R.jsxs("span",{className:"text-sm text-gray-400",children:["Duration:"," ",I.duration?`${Math.round(I.duration/60)} mins`:"N/A"]})})]},I.id)}):R.jsx("div",{className:"text-center py-8 text-gray-400",children:"No call history available"})}),b=()=>{if(!i||!i.captures)return null;const I=Object.entries(i.captures).map(([B,M])=>({captureId:B,...M}));return R.jsxs("div",{className:"mt-4",children:[R.jsxs("div",{className:"flex items-center mb-4",children:[R.jsx("button",{className:"mr-2 bg-gray-700 hover:bg-gray-600 p-1 rounded",onClick:()=>s(null),children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),R.jsx("h2",{className:"text-xl font-bold",children:i.title||"Call Captures"})]}),R.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:I.length>0?I.map((B,M)=>{const H=B.imageUrl?`capture_${M}.jpg`:B.videoUrl?`capture_${M}.mp4`:`capture_${M}`;return R.jsxs("div",{className:"bg-gray-800 p-2 rounded-lg border border-gray-700 flex flex-col",children:[R.jsx("div",{className:"relative flex-grow",children:B.imageUrl?R.jsx("img",{src:B.imageUrl,alt:`Capture ${M}`,className:"w-full h-48 object-cover rounded"}):B.videoUrl?R.jsxs("video",{controls:!0,className:"w-full h-48 object-cover rounded",children:[R.jsx("source",{src:B.videoUrl,type:"video/mp4"}),"Your browser does not support video playback."]}):R.jsx("div",{className:"w-full h-48 flex items-center justify-center bg-gray-700 rounded",children:R.jsx("span",{className:"text-gray-400",children:"No preview available"})})}),R.jsx("div",{className:"mt-2 text-sm text-gray-400",children:R.jsxs("p",{children:["Timestamp: ",new Date(B.timestamp).toLocaleString()]})}),R.jsxs("div",{className:"mt-2 flex space-x-2",children:[R.jsxs("button",{onClick:()=>g({message:"Are you sure you want to download this capture?",onConfirm:()=>f(B.imageUrl||B.videoUrl,H),onCancel:()=>g(null)}),className:"flex-1 flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white py-1 px-2 rounded text-sm",children:[R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),R.jsx("button",{onClick:()=>g({message:"Are you sure you want to delete this capture? This action cannot be undone.",onConfirm:()=>d(i.callId,B.captureId),onCancel:()=>g(null)}),className:"flex items-center justify-center bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded text-sm",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},B.captureId)}):R.jsx("div",{className:"col-span-full text-center py-8 text-gray-400",children:"No captures available for this call"})})]})};return R.jsxs("div",{className:"bg-gray-800 p-4 rounded-lg",children:[o&&!A&&R.jsxs("div",{children:[R.jsxs("div",{className:"flex justify-between items-center mb-4",children:[R.jsx("h2",{className:"text-xl font-bold",children:"Library"}),R.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded flex items-center gap-1 text-sm",onClick:e,children:[R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]}),i?b():y()]}),A&&!o&&R.jsxs("div",{children:[R.jsxs("div",{className:"flex justify-between items-center mb-4",children:[R.jsx("h2",{className:"text-xl font-bold",children:"Call History"}),R.jsxs("div",{className:"flex space-x-2",children:[R.jsxs("button",{className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded flex items-center gap-1 text-sm",onClick:e,children:[R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]}),R.jsxs("button",{className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded flex items-center gap-1 text-sm",onClick:()=>g({message:"Are you sure you want to clear your entire call history? This action cannot be undone.",onConfirm:()=>v(t.uid),onCancel:()=>g(null)}),children:[R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Clear"]})]})]}),w()]})]})},Dge=({isOpen:t,onClose:e,users:n,selectedContacts:r,onContactToggle:i,onStartCall:s,loading:o})=>{const[a,A]=X.useState(""),u=n.filter(d=>d.toLowerCase().includes(a.toLowerCase()));return t?R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:R.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg w-full max-w-md max-h-[80vh] overflow-hidden",children:[R.jsxs("div",{className:"flex justify-between items-center mb-4",children:[R.jsx("h2",{className:"text-xl font-bold",children:"Start New Call"}),R.jsx("button",{onClick:e,className:"text-gray-400 hover:text-white",children:R.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),R.jsx("div",{className:"mb-4",children:R.jsx("input",{type:"text",placeholder:"Search contacts...",value:a,onChange:d=>A(d.target.value),className:"w-full p-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-400"})}),R.jsx("div",{className:"max-h-60 overflow-y-auto mb-4",children:o?R.jsxs("div",{className:"text-center py-4",children:[R.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"}),R.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"Loading contacts..."})]}):u.length>0?u.map((d,f)=>R.jsxs("div",{className:`flex items-center p-3 rounded cursor-pointer transition-colors ${r.includes(d)?"bg-blue-600 border border-blue-400":"bg-gray-700 hover:bg-gray-600"}`,onClick:()=>i(d),children:[R.jsx("div",{className:"w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center mr-3",children:d.charAt(0).toUpperCase()}),R.jsx("div",{className:"flex-1",children:R.jsx("div",{className:"font-medium",children:d})}),r.includes(d)&&R.jsx("div",{className:"text-blue-400",children:R.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:R.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},f)):R.jsx("div",{className:"text-center py-4 text-gray-400",children:a?"No contacts found":"No contacts available"})}),R.jsxs("div",{className:"flex justify-between items-center",children:[R.jsxs("div",{className:"text-sm text-gray-400",children:[r.length," contact",r.length!==1?"s":""," selected"]}),R.jsxs("div",{className:"flex space-x-2",children:[R.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded transition-colors",children:"Cancel"}),R.jsx("button",{onClick:s,disabled:r.length===0||o,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded transition-colors flex items-center",children:o?R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Starting..."]}):R.jsxs(R.Fragment,{children:[R.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:R.jsx("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})}),"Start Call"]})})]})]})]})}):null},Bge=({user:t,onLogout:e})=>{var ti;const n=X.useRef(null),[r,i]=X.useState([]),[s,o]=X.useState(!1),[a,A]=X.useState(!0),[u,d]=X.useState(null),[f,m]=X.useState(null),[g,v]=X.useState([]),[y,w]=X.useState(""),[b,I]=X.useState(!1),[B,M]=X.useState([]),[H,K]=X.useState(!1),[Q,F]=X.useState([]),[k,G]=X.useState([]),[$,ne]=X.useState(!1),[q,qe]=X.useState(!1),[je,de]=X.useState(!1),[J,Y]=X.useState(null),[Z,P]=X.useState(null),[C,D]=X.useState(!1),[U,ee]=X.useState(null),[Ee,Re]=X.useState(!1),[lt,St]=X.useState(!1),[Tr,cs]=X.useState([]),[As,gr]=X.useState(!1),xi=og();X.useEffect(()=>{var He,Xe;u?(He=n.current)==null||He.play():(Xe=n.current)==null||Xe.pause()},[u]);const vi=()=>qe(!q),Jt=()=>qe(!1),Xt=()=>D(!C);X.useEffect(()=>{if(!(t!=null&&t.uid))return;const He=async()=>{o(!0);try{const Ci=Oq(v7,"companies"),fn=kq(Ci,XB("companyName","==",t.companyName)),Un=await Mq(fn);if(Un.empty)i([]);else{const Gs=Un.docs[0].data().licenses.map(Yo=>Yo.licenseId).filter(Yo=>Yo!==t.uid);i(Gs)}}catch{}finally{o(!1)}},Xe=async()=>{const Ci=Ke(et,`active_users/${t.uid}/favorites`);mo(Ci,fn=>{const Un=fn.val();G(Un?Object.keys(Un):[])})};He(),Xe();const kt=Ke(et,`incoming_calls/${t.uid}`);let Nt=!0,_n=null;const Br=mo(kt,Ci=>{const fn=Ci.val();if(Nt){Nt=!1;return}if(!fn||Array.isArray(fn)&&fn.length===0||typeof fn=="object"&&Object.keys(fn).length===0){d(null);return}const Un=Object.entries(fn).map(([Mi,Ti])=>({key:Mi,...Ti})).filter(Mi=>Mi.status==="pending"&&Mi.key!==_n).sort((Mi,Ti)=>new Date(Ti.timestamp)-new Date(Mi.timestamp))[0];Un?(_n=Un.key,d({...Un,name:Un.callerName||Un.caller||"Unknown",roomId:Un.callId})):d(null)});return()=>Br()},[t==null?void 0:t.uid]),X.useEffect(()=>{const He=Ke(et,"videoCalls");Ni(He).then(Xe=>{if(Xe.exists()){const kt=Xe.val(),Nt=Object.entries(kt).flatMap(([_n,Br])=>Object.entries(Br.captures||{}).map(([Ci,fn])=>({callId:_n,captureId:Ci,...fn})));F(Nt)}})},[]);const dt=async He=>{const Xe=Ke(et,`active_users/${t.uid}/favorites/${He}`);try{k.includes(He)?(await Ih(Xe),G(k.filter(kt=>kt!==He))):(await qr(Xe,{addedAt:Date.now()}),G([...k,He]))}catch{}},Ar=async He=>{const Xe=Zw(),kt=Ke(et,`videoCalls/${Xe}`),Nt=t==null?void 0:t.uid,_n="Video Call";if(!Nt||!He)return;await qr(kt,{title:_n,createdAt:Date.now(),createdBy:Nt,active:!0,users:[Nt,He],status:"pending"});const Br=Ke(et,`active_users/${He}/incoming_calls/${Xe}`);await qr(Br,{roomId:Xe,userId:Nt,status:"pending",timestamp:Date.now(),title:_n,isNew:!0,type:"invitation"}),yi({uid:Nt,companyName:t.companyName},Xe,_n)},yi=(He,Xe,kt)=>{xi(`/video-call?callId=${Xe}&uid=${He.uid}&title=${encodeURIComponent(kt)}`)},Pt=async()=>{try{if(!u||!u.callId){console.error("No valid incoming call to accept"),d(null);return}console.log(`Accepting call with callId: ${u.callId}`);const He=Ke(et,`videoCalls/${u.callId}`),Xe=await Ni(He);if(!Xe.exists()){console.error("Call room does not exist. The caller may have canceled the call.");const Ci=Ke(et,`incoming_calls/${t.uid}/${u.key}`);await Ih(Ci),alert("This call is no longer available. The caller may have ended the call."),d(null);return}const kt=Xe.val(),Nt={...kt.users,[t.uid]:{name:t.uid,role:"participant",joinedAt:new Date().toISOString(),status:"active"}};await vr(He,{users:Nt,status:"active",lastUpdated:new Date().toISOString()});const _n=Ke(et,`incoming_calls/${t.uid}/${u.key}`);await Ih(_n);const Br=kt.title||"Group Call";yi({uid:t.uid,companyName:t.companyName},u.callId,Br),d(null)}catch(He){console.error("Error accepting call:",He),d(null)}},st=async()=>{if(u){try{const He=Ke(et,`incoming_calls/${t.uid}/${u.key}`);if(await Ih(He),u.caller){const Xe=Ke(et,`call_responses/${u.caller}/${u.callId}`);await qr(Xe,{status:"rejected",rejectedBy:t.uid,timestamp:new Date().toISOString()})}}catch(He){console.error("Error rejecting call:",He)}d(null)}},Sr=()=>d(null),br=async()=>{if(!(!t||!f||!y.trim()))try{const He=Zw(),Xe=Ke(et,`active_users/${t.uid}/chats/${f}/chatRoomId`);mo(Xe,async kt=>{const Nt=kt.val();if(!Nt)return;const _n=`chatRooms/${Nt}/${t.uid}_messages`;await vr(Ke(et,_n),{[He]:{userId:t.uid,content:y,timestamp:Date.now()}}),w("")})}catch{}},ei=async He=>{const Xe=He.target.files[0];if(Xe)try{const kt=Ke(dge,`chat_files/${Xe.name}`),Nt=sge(kt,Xe);Nt.on("state_changed",_n=>console.log(`Upload is ${_n.bytesTransferred/_n.totalBytes*100}% done`),_n=>console.error("Error uploading file:",_n),async()=>{const _n=await oge(Nt.snapshot.ref),Br=Zw(),Ci=Ke(et,`active_users/${t.uid}/chats/${f}/chatRoomId`);mo(Ci,async fn=>{const Un=fn.val();if(!Un)return;const Mi=`chatRooms/${Un}/${t.uid}_messages`;await vr(Ke(et,Mi),{[Br]:{userId:t.uid,content:_n,timestamp:Date.now(),type:"file",fileName:Xe.name}})})})}catch{}},Ks=async()=>{I(!0);try{const Xe=(await Ni(Ke(et,"videoCalls"))).val();if(Xe){const kt=Object.keys(Xe).map(Nt=>({id:Nt,...Xe[Nt]}));M(kt)}else M([])}catch{}finally{I(!1)}},qn=async(He,Xe)=>{try{const kt=Ke(et,`videoCalls/${He}/captures/${Xe}`);await Ih(kt),console.log("Capture deleted successfully"),F(Q.filter(Nt=>Nt.captureId!==Xe)),M(B.map(Nt=>{if(Nt.id===He){const _n={...Nt.captures};return delete _n[Xe],{...Nt,captures:_n}}return Nt})),P(null)}catch{}},yn=(He,Xe)=>{const kt=document.createElement("a");kt.href=He,kt.download=Xe||"capture",document.body.appendChild(kt),kt.click(),document.body.removeChild(kt),P(null)},Rs=async He=>{try{if(!He){console.error("User ID not available");return}const Xe=await Ni(Ke(et,"videoCalls"));if(!Xe.exists()){console.log("No calls to clear"),P(null);return}const kt=[],Nt=Xe.val();Object.entries(Nt).forEach(([_n,Br])=>{Br.users&&(Array.isArray(Br.users)&&Br.users.includes(He)||typeof Br.users=="object"&&Object.keys(Br.users).includes(He)||Br.createdBy===He)&&kt.push(Ih(Ke(et,`videoCalls/${_n}`)))}),await Promise.all(kt),M([]),console.log("Call history cleared successfully"),P(null)}catch{}},wi=()=>{St(!0),cs([])},Ia=()=>{St(!1),cs([])},Rf=He=>{cs(Xe=>Xe.includes(He)?Xe.filter(kt=>kt!==He):[...Xe,He])},eA=async()=>{if(Tr.length!==0){gr(!0);try{const He=Zw(),Xe=`Group Call - ${new Date().toLocaleString()}`,kt={id:He,title:Xe,createdBy:t.uid,createdAt:new Date().toISOString(),status:"waiting",participants:Tr,users:{[t.uid]:{name:t.uid,role:"host",joinedAt:new Date().toISOString(),status:"active"}}};await qr(Ke(et,`videoCalls/${He}`),kt);for(const Nt of Tr){const _n={callId:He,title:Xe,caller:t.uid,callerName:t.uid,timestamp:new Date().toISOString(),status:"pending"};await qr(Ke(et,`incoming_calls/${Nt}/${He}`),_n)}Ia(),xi(`/video-call?callId=${He}&uid=${t.uid}&title=${encodeURIComponent(Xe)}`)}catch(He){console.error("Error starting new call:",He)}finally{gr(!1)}}};return R.jsxs("div",{className:"flex flex-col h-screen bg-gray-900 text-white",children:[R.jsxs("header",{className:"py-2 px-4 flex justify-between items-center",style:{background:"linear-gradient(135deg, #404AD9 25%, #2C82FF 50%, #9B51EB 75%, #F74FFC 100%)",height:"80px",width:"100%"},children:[R.jsxs("div",{className:"flex items-center justify-start space-x-4",children:[R.jsx("div",{className:"h-16 w-16 sm:h-32 sm:w-32",children:R.jsx("img",{src:UP,alt:"SurgeView Logo",className:"w-full h-full object-contain"})}),R.jsxs("div",{className:"flex items-center bg-blue-600/70 backdrop-blur-md px-3 py-1.5 rounded-full border border-blue-400/50 shadow-lg",children:[R.jsx("div",{className:"bg-blue-800 rounded-full p-1.5 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:R.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1zM12 7a5 5 0 1 0 5 5 5.006 5.006 0 0 0-5-5zm0 8a3 3 0 1 1-3-3 3.003 3.003 0 0 1 3 3z"})})}),R.jsx("span",{className:"ml-2 text-sm sm:text-base font-medium text-white",children:((ti=t==null?void 0:t.uid)==null?void 0:ti.substring(0,16))||"User"})]})]}),R.jsxs("div",{className:"hidden md:flex flex-wrap gap-1.5 sm:gap-2 mt-1 sm:mt-0",children:[R.jsxs("button",{onClick:()=>{K(!H),de(!1),Y(null),m(null),H||Ks()},className:"bg-blue-600/80 hover:bg-blue-700 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2.5 sm:px-3 border-white/30 rounded-lg transition-colors flex items-center gap-1.5 border border-white shadow",children:[R.jsx("div",{className:"bg-blue-900  hover:bg-blue-700 rounded-full p-1 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),R.jsx("span",{children:"Library"})]}),R.jsxs("button",{className:"bg-blue-600/80 hover:bg-blue-700 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2.5 sm:px-3 border-white/30 rounded-lg transition-colors flex items-center gap-1.5 border border-white shadow",onClick:()=>{de(!je),K(!1),Y(null),m(null),je||Ks()},children:[R.jsx("div",{className:"bg-blue-900  rounded-full p-1 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),R.jsx("span",{children:"Call History"})]}),R.jsxs("button",{className:"bg-blue-600/80  hover:bg-purple-700/80 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2.5 sm:px-3  border-white/30 rounded-lg transition-colors flex items-center gap-1.5 border border-white shadow",onClick:vi,children:[R.jsx("div",{className:"bg-blue-900  rounded-full p-1 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),R.jsx("span",{children:"Help"})]}),R.jsxs("button",{className:"bg-red-600/70 hover:bg-red-700/80 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2.5 sm:px-3  border-white/30 rounded-lg transition-colors flex items-center gap-1.5 border border-white shadow",onClick:e,children:[R.jsx("div",{className:"bg-red-800 rounded-full p-1 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),R.jsx("span",{children:"Logout"})]})]}),R.jsx("div",{className:"md:hidden",children:R.jsx("button",{onClick:Xt,className:"p-2 bg-gray-800 rounded-full",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]}),C&&R.jsx("div",{className:"fixed inset-0 bg-blue-600 bg-opacity-50 z-50 md:hidden",children:R.jsx("div",{className:"absolute top-0 right-0 mt-16 mr-4 bg-white rounded-lg shadow-lg p-4 w-64",children:R.jsxs("div",{className:"flex flex-col space-y-3",children:[R.jsxs("button",{onClick:()=>{K(!H),de(!1),Y(null),m(null),H||Ks(),Xt()},className:"flex items-center  bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-3 rounded-lg transition-colors",children:[R.jsx("div",{className:"bg-blue-950 rounded-full p-1 mr-2 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),R.jsx("span",{children:"Library"})]}),R.jsxs("button",{onClick:()=>{de(!je),K(!1),Y(null),m(null),je||Ks(),Xt()},className:"flex items-center  bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-3 rounded-lg transition-colors",children:[R.jsx("div",{className:"bg-blue-950 rounded-full p-1 mr-2 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),R.jsx("span",{children:"Call History"})]}),R.jsxs("button",{onClick:()=>{vi(),Xt()},className:"flex items-center bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium py-2 px-3 rounded-lg transition-colors",children:[R.jsx("div",{className:"bg-blue-950 rounded-full p-1 mr-2 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),R.jsx("span",{children:"Help"})]}),R.jsxs("button",{onClick:()=>{e(),Xt()},className:"flex items-center bg-red-600/80 hover:bg-red-700 text-white text-sm font-medium py-2 px-3 rounded-lg transition-colors",children:[R.jsx("div",{className:"bg-blue-950 rounded-full p-1 mr-2 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),R.jsx("span",{children:"Logout"})]})]})})}),R.jsxs("div",{className:"flex flex-col sm:flex-row flex-1 overflow-hidden",children:[R.jsxs("aside",{className:"bg-gray-800 w-full sm:w-80 space-y-4 py-3 sm:py-7 px-2 overflow-y-auto",children:[R.jsxs("div",{className:"flex justify-between items-center px-2 sm:px-4",children:[R.jsx("h3",{className:"text-sm sm:text-base font-medium",children:"Contacts"}),R.jsx("button",{className:"text-yellow-400 text-xs sm:text-sm",onClick:()=>ne(!$),children:$?"Show All":"Favourites"})]}),R.jsxs("div",{className:"space-y-2",children:[s&&R.jsx("div",{className:"text-center text-sm",children:"Loading..."}),a&&r.length>0?($?k:r).map((He,Xe)=>R.jsxs("div",{className:`flex items-center p-2 bg-gray-700 rounded mx-1 sm:mx-2 ${k.includes(He)?"border-l-4 border-yellow-400":""}`,children:[R.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-blue-500 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:He.charAt(0)}),R.jsx("div",{className:"flex-1 min-w-0",children:R.jsx("div",{className:"font-bold text-sm sm:text-base truncate",children:He})}),R.jsxs("div",{className:"flex space-x-1 sm:space-x-2 ml-1",children:[R.jsx("button",{className:"text-white p-1",onClick:()=>Ar(He),children:R.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:[R.jsx("path",{d:"M23 7l-7 5 7 5V7z"}),R.jsx("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})]})}),R.jsx("button",{className:"text-white p-1",onClick:()=>{ee(He),Re(!0)},children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",children:R.jsx("path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v8a2 2 0 0 1-1.998 2M14 2H4a1 1 0 0 0-1 1h9.002a2 2 0 0 1 2 2v7A1 1 0 0 0 15 11V3a1 1 0 0 0-1-1M2.002 4a1 1 0 0 0-1 1v8l2.646-2.354a.5.5 0 0 1 .63-.062l2.66 1.773 3.71-3.71a.5.5 0 0 1 .577-.094l1.777 1.947V5a1 1 0 0 0-1-1z"})})}),R.jsx("button",{className:"text-white p-1",onClick:()=>dt(He),children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:k.includes(He)?"yellow":"none",stroke:"currentColor",children:R.jsx("path",{d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 7.05 2.02 9.24l7.19 7.03L12 17.27z"})})})]})]},Xe)):R.jsx("div",{className:"text-center text-sm",children:$?"No favorite contacts":"No contacts available"})]})]}),R.jsxs("main",{className:"flex-1 overflow-x-hidden overflow-y-auto p-2 sm:p-4",children:[f&&R.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4",children:R.jsxs("div",{className:"bg-gray-800 p-3 sm:p-4 rounded-lg w-full max-w-md",children:[R.jsxs("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:[R.jsx("h2",{className:"text-lg sm:text-xl font-bold truncate",children:f}),R.jsx("button",{onClick:()=>m(null),className:"text-gray-400 hover:text-white","aria-label":"Close chat",children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),R.jsx("div",{className:"space-y-2 mb-3 sm:mb-4 max-h-[50vh] overflow-y-auto p-1",children:g.length>0?g.map((He,Xe)=>R.jsxs("div",{className:`p-2 rounded max-w-[80%] ${He.userId===t.uid?"bg-blue-500 ml-auto text-white":"bg-gray-700 mr-auto"}`,children:[R.jsx("p",{className:"text-sm break-words",children:He.type==="file"?R.jsxs("a",{href:He.content,target:"_blank",rel:"noopener noreferrer",className:"text-blue-300 hover:underline flex items-center",children:[R.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),He.fileName||"File"]}):He.content}),R.jsx("span",{className:"text-xs text-gray-400 block text-right mt-1",children:new Date(He.timestamp).toLocaleString()})]},Xe)):R.jsx("div",{className:"text-center text-sm text-gray-400 py-4",children:"No messages yet"})}),R.jsxs("div",{className:"flex",children:[R.jsx("label",{htmlFor:"file-input",className:"p-2 bg-gray-700 text-gray-300 hover:text-white rounded-l cursor-pointer",children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})}),R.jsx("input",{id:"file-input",type:"file",className:"hidden",onChange:ei}),R.jsx("input",{type:"text",placeholder:"Type a message...",value:y,onChange:He=>w(He.target.value),onKeyDown:He=>He.key==="Enter"&&br(),className:"flex-1 p-2 bg-gray-700 text-sm border-x-0 focus:outline-none focus:ring-1 focus:ring-blue-500"}),R.jsx("button",{onClick:br,className:"p-2 bg-blue-500 hover:bg-blue-600 text-white rounded-r transition-colors","aria-label":"Send message",children:R.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:R.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})]})}),(H||je)&&!f&&R.jsx(Nge,{user:t,fetchCalls:Ks,calls:B,loadingCalls:b,selectedCapture:J,setSelectedCapture:Y,isLibraryOpen:H,setIsLibraryOpen:K,showCallHistory:je,setShowCallHistory:de,deleteCapture:qn,downloadCapture:yn,actionDialog:Z,setActionDialog:P,clearCallHistory:Rs}),!f&&!H&&!je&&R.jsx("div",{className:"text-center py-8",children:R.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg max-w-lg mx-auto",children:[R.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Welcome to Xrai Dashboard"}),R.jsx("p",{className:"mb-6",children:"Choose a contact from the sidebar to start a video call or chat, or click the buttons in the header to view your call history or library."}),R.jsxs("div",{className:"flex justify-center space-x-4",children:[R.jsxs("button",{onClick:wi,className:"bg-blue-600/80 hover:bg-purple-700/80 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2 sm:px-3 border-white/30 rounded-lg transition-colors flex items-center justify-center gap-2 border border-white shadow w-full sm:w-auto",children:[R.jsx("div",{className:"bg-blue-900 hover:bg-blue-800 rounded-full p-2 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:R.jsx("path",{d:"M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"})})}),R.jsx("span",{children:"Start New Call"})]}),R.jsxs("button",{onClick:()=>{K(!0),Ks()},className:"bg-purple-600/80 hover:bg-blue-700/80 backdrop-blur-md text-white text-xs font-medium py-1.5 px-2 sm:px-3 border-white/30 rounded-lg transition-colors flex items-center justify-center gap-2 border border-white shadow w-full sm:w-auto",children:[R.jsx("div",{className:"bg-blue-900/80 hover:bg-blue-800 rounded-full p-2 flex items-center justify-center",children:R.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",viewBox:"0 0 16 16",children:R.jsx("path",{d:"M4 0h5.293A1 1 0 0 1 10 .293L13.707 4a1 1 0 0 1 .293.707V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm5.5 1.5v2a1 1 0 0 0 1 1h2l-3-3zM2 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1H2zm9 0a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1zm-9 7a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1H2zm9 0a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1z"})})}),R.jsx("span",{children:"View Library"})]})]})]})})]})]}),R.jsx("audio",{ref:n,src:_ge,loop:!0}),u&&R.jsx(Rge,{caller:u,onAccept:Pt,onReject:st,onClose:Sr}),q&&R.jsx(Oge,{onClose:Jt}),Z&&R.jsx(Ige,{message:Z.message,onConfirm:Z.onConfirm,onCancel:Z.onCancel}),Ee&&U&&R.jsx(C7,{callId:null,userId:t.uid,userName:t.uid,onCloseChat:()=>Re(!1),dashboardChatUser:U,dashboardMode:!0}),R.jsx(Dge,{isOpen:lt,onClose:Ia,users:r,selectedContacts:Tr,onContactToggle:Rf,onStartCall:eA,loading:As})]})};function Lge(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}var gm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Cr=function(t){try{return!!t()}catch{return!0}},db=!Cr(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),T7=db,S7=Function.prototype,lL=S7.call,Uge=T7&&S7.bind.bind(lL,lL),mr=T7?Uge:function(t){return function(){return lL.apply(t,arguments)}},Is=mr({}.isPrototypeOf),eC=function(t){return t&&t.Math==Math&&t},gi=eC(typeof globalThis=="object"&&globalThis)||eC(typeof window=="object"&&window)||eC(typeof self=="object"&&self)||eC(typeof gm=="object"&&gm)||function(){return this}()||gm||Function("return this")(),Pge=db,b7=Function.prototype,n4=b7.apply,r4=b7.call,PP=typeof Reflect=="object"&&Reflect.apply||(Pge?r4.bind(n4):function(){return r4.apply(n4,arguments)}),I7=mr,kge=I7({}.toString),xge=I7("".slice),KA=function(t){return xge(kge(t),8,-1)},Mge=KA,Fge=mr,pv=function(t){if(Mge(t)==="Function")return Fge(t)},IO=typeof document=="object"&&document.all,hb={all:IO,IS_HTMLDDA:IO===void 0&&IO!==void 0},Vge=hb.all,_i=hb.IS_HTMLDDA?function(t){return typeof t=="function"||t===Vge}:function(t){return typeof t=="function"},dy={},Sa=!Cr(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Qge=db,tC=Function.prototype.call,Ei=Qge?tC.bind(tC):function(){return tC.apply(tC,arguments)},fb={},R7={}.propertyIsEnumerable,O7=Object.getOwnPropertyDescriptor,Hge=O7&&!R7.call({1:2},1);fb.f=Hge?function(t){var e=O7(this,t);return!!e&&e.enumerable}:R7;var Nu,NT,Md=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},jge=Cr,Kge=KA,RO=Object,Gge=mr("".split),pb=jge(function(){return!RO("z").propertyIsEnumerable(0)})?function(t){return Kge(t)=="String"?Gge(t,""):RO(t)}:RO,vg=function(t){return t==null},Wge=vg,zge=TypeError,yg=function(t){if(Wge(t))throw zge("Can't call method on "+t);return t},qge=pb,Yge=yg,Fd=function(t){return qge(Yge(t))},i4=_i,Xge=hb.all,qo=hb.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:i4(t)||t===Xge}:function(t){return typeof t=="object"?t!==null:i4(t)},Xc={},OO=Xc,NO=gi,Jge=_i,s4=function(t){return Jge(t)?t:void 0},wo=function(t,e){return arguments.length<2?s4(OO[t])||s4(NO[t]):OO[t]&&OO[t][e]||NO[t]&&NO[t][e]},Cf=typeof navigator<"u"&&String(navigator.userAgent)||"",N7=gi,DO=Cf,o4=N7.process,a4=N7.Deno,c4=o4&&o4.versions||a4&&a4.version,A4=c4&&c4.v8;A4&&(NT=(Nu=A4.split("."))[0]>0&&Nu[0]<4?1:+(Nu[0]+Nu[1])),!NT&&DO&&(!(Nu=DO.match(/Edge\/(\d+)/))||Nu[1]>=74)&&(Nu=DO.match(/Chrome\/(\d+)/))&&(NT=+Nu[1]);var hf=NT,l4=hf,$ge=Cr,Zge=gi.String,wg=!!Object.getOwnPropertySymbols&&!$ge(function(){var t=Symbol();return!Zge(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&l4&&l4<41}),D7=wg&&!Symbol.sham&&typeof Symbol.iterator=="symbol",e_e=wo,t_e=_i,n_e=Is,r_e=Object,hy=D7?function(t){return typeof t=="symbol"}:function(t){var e=e_e("Symbol");return t_e(e)&&n_e(e.prototype,r_e(t))},i_e=String,Cg=function(t){try{return i_e(t)}catch{return"Object"}},s_e=_i,o_e=Cg,a_e=TypeError,hc=function(t){if(s_e(t))return t;throw a_e(o_e(t)+" is not a function")},c_e=hc,A_e=vg,mb=function(t,e){var n=t[e];return A_e(n)?void 0:c_e(n)},u4=Ei,d4=_i,h4=qo,l_e=TypeError,B7={exports:{}},f4=gi,u_e=Object.defineProperty,d_e=function(t,e){try{u_e(f4,t,{value:e,configurable:!0,writable:!0})}catch{f4[t]=e}return e},p4="__core-js_shared__",kP=gi[p4]||d_e(p4,{}),m4=kP;(B7.exports=function(t,e){return m4[t]||(m4[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Tg=B7.exports,h_e=yg,f_e=Object,GA=function(t){return f_e(h_e(t))},p_e=GA,m_e=mr({}.hasOwnProperty),ki=Object.hasOwn||function(t,e){return m_e(p_e(t),e)},g_e=mr,__e=0,E_e=Math.random(),v_e=g_e(1 .toString),xP=function(t){return"Symbol("+(t===void 0?"":t)+")_"+v_e(++__e+E_e,36)},y_e=Tg,g4=ki,w_e=xP,C_e=wg,T_e=D7,Jp=gi.Symbol,BO=y_e("wks"),S_e=T_e?Jp.for||Jp:Jp&&Jp.withoutSetter||w_e,cr=function(t){return g4(BO,t)||(BO[t]=C_e&&g4(Jp,t)?Jp[t]:S_e("Symbol."+t)),BO[t]},b_e=Ei,_4=qo,E4=hy,I_e=mb,R_e=function(t,e){var n,r;if(d4(n=t.toString)&&!h4(r=u4(n,t))||d4(n=t.valueOf)&&!h4(r=u4(n,t)))return r;throw l_e("Can't convert object to primitive value")},O_e=TypeError,N_e=cr("toPrimitive"),D_e=function(t,e){if(!_4(t)||E4(t))return t;var n,r=I_e(t,N_e);if(r){if(n=b_e(r,t,e),!_4(n)||E4(n))return n;throw O_e("Can't convert object to primitive value")}return R_e(t)},B_e=hy,gb=function(t){var e=D_e(t,"string");return B_e(e)?e:e+""},v4=qo,uL=gi.document,L_e=v4(uL)&&v4(uL.createElement),MP=function(t){return L_e?uL.createElement(t):{}},U_e=MP,L7=!Sa&&!Cr(function(){return Object.defineProperty(U_e("div"),"a",{get:function(){return 7}}).a!=7}),P_e=Sa,k_e=Ei,x_e=fb,M_e=Md,F_e=Fd,V_e=gb,Q_e=ki,H_e=L7,y4=Object.getOwnPropertyDescriptor;dy.f=P_e?y4:function(t,e){if(t=F_e(t),e=V_e(e),H_e)try{return y4(t,e)}catch{}if(Q_e(t,e))return M_e(!k_e(x_e.f,t,e),t[e])};var j_e=Cr,K_e=_i,G_e=/#|\.prototype\./,fy=function(t,e){var n=z_e[W_e(t)];return n==Y_e||n!=q_e&&(K_e(e)?j_e(e):!!e)},W_e=fy.normalize=function(t){return String(t).replace(G_e,".").toLowerCase()},z_e=fy.data={},q_e=fy.NATIVE="N",Y_e=fy.POLYFILL="P",U7=fy,X_e=hc,J_e=db,$_e=pv(pv.bind),Vd=function(t,e){return X_e(t),e===void 0?t:J_e?$_e(t,e):function(){return t.apply(e,arguments)}},fc={},P7=Sa&&Cr(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Z_e=qo,eEe=String,tEe=TypeError,so=function(t){if(Z_e(t))return t;throw tEe(eEe(t)+" is not an object")},nEe=Sa,rEe=L7,iEe=P7,nC=so,w4=gb,sEe=TypeError,LO=Object.defineProperty,oEe=Object.getOwnPropertyDescriptor,UO="enumerable",PO="configurable",kO="writable";fc.f=nEe?iEe?function(t,e,n){if(nC(t),e=w4(e),nC(n),typeof t=="function"&&e==="prototype"&&"value"in n&&kO in n&&!n[kO]){var r=oEe(t,e);r&&r[kO]&&(t[e]=n.value,n={configurable:PO in n?n[PO]:r[PO],enumerable:UO in n?n[UO]:r[UO],writable:!1})}return LO(t,e,n)}:LO:function(t,e,n){if(nC(t),e=w4(e),nC(n),rEe)try{return LO(t,e,n)}catch{}if("get"in n||"set"in n)throw sEe("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var aEe=fc,cEe=Md,Qd=Sa?function(t,e,n){return aEe.f(t,e,cEe(1,n))}:function(t,e,n){return t[e]=n,t},rC=gi,AEe=PP,lEe=pv,uEe=_i,dEe=dy.f,hEe=U7,up=Xc,fEe=Vd,dp=Qd,C4=ki,pEe=function(t){var e=function(n,r,i){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,i)}return AEe(t,this,arguments)};return e.prototype=t.prototype,e},nn=function(t,e){var n,r,i,s,o,a,A,u,d,f=t.target,m=t.global,g=t.stat,v=t.proto,y=m?rC:g?rC[f]:(rC[f]||{}).prototype,w=m?up:up[f]||dp(up,f,{})[f],b=w.prototype;for(s in e)r=!(n=hEe(m?s:f+(g?".":"#")+s,t.forced))&&y&&C4(y,s),a=w[s],r&&(A=t.dontCallGetSet?(d=dEe(y,s))&&d.value:y[s]),o=r&&A?A:e[s],r&&typeof a==typeof o||(u=t.bind&&r?fEe(o,rC):t.wrap&&r?pEe(o):v&&uEe(o)?lEe(o):o,(t.sham||o&&o.sham||a&&a.sham)&&dp(u,"sham",!0),dp(w,s,u),v&&(C4(up,i=f+"Prototype")||dp(up,i,{}),dp(up[i],s,o),t.real&&b&&(n||!b[s])&&dp(b,s,o)))},mEe=Math.ceil,gEe=Math.floor,_Ee=Math.trunc||function(t){var e=+t;return(e>0?gEe:mEe)(e)},EEe=_Ee,FP=function(t){var e=+t;return e!=e||e===0?0:EEe(e)},vEe=FP,yEe=Math.max,wEe=Math.min,VP=function(t,e){var n=vEe(t);return n<0?yEe(n+e,0):wEe(n,e)},CEe=FP,TEe=Math.min,k7=function(t){return t>0?TEe(CEe(t),9007199254740991):0},SEe=k7,nu=function(t){return SEe(t.length)},bEe=Fd,IEe=VP,REe=nu,T4=function(t){return function(e,n,r){var i,s=bEe(e),o=REe(s),a=IEe(r,o);if(t&&n!=n){for(;o>a;)if((i=s[a++])!=i)return!0}else for(;o>a;a++)if((t||a in s)&&s[a]===n)return t||a||0;return!t&&-1}},QP={includes:T4(!0),indexOf:T4(!1)},OEe=QP.includes;nn({target:"Array",proto:!0,forced:Cr(function(){return!Array(1).includes()})},{includes:function(t){return OEe(this,t,arguments.length>1?arguments[1]:void 0)}});var NEe=Xc,pc=function(t){return NEe[t+"Prototype"]},DEe=pc("Array").includes,BEe=qo,LEe=KA,UEe=cr("match"),x7=function(t){var e;return BEe(t)&&((e=t[UEe])!==void 0?!!e:LEe(t)=="RegExp")},PEe=x7,kEe=TypeError,M7={};M7[cr("toStringTag")]="z";var HP=String(M7)==="[object z]",xEe=HP,MEe=_i,DT=KA,FEe=cr("toStringTag"),VEe=Object,QEe=DT(function(){return arguments}())=="Arguments",WA=xEe?DT:function(t){var e,n,r;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(i,s){try{return i[s]}catch{}}(e=VEe(t),FEe))=="string"?n:QEe?DT(e):(r=DT(e))=="Object"&&MEe(e.callee)?"Arguments":r},HEe=WA,jEe=String,ba=function(t){if(HEe(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return jEe(t)},KEe=cr("match"),GEe=nn,WEe=function(t){if(PEe(t))throw kEe("The method doesn't accept regular expressions");return t},zEe=yg,S4=ba,qEe=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[KEe]=!1,"/./"[t](e)}catch{}}return!1},YEe=mr("".indexOf);GEe({target:"String",proto:!0,forced:!qEe("includes")},{includes:function(t){return!!~YEe(S4(zEe(this)),S4(WEe(t)),arguments.length>1?arguments[1]:void 0)}});var XEe=pc("String").includes,b4=Is,JEe=DEe,$Ee=XEe,xO=Array.prototype,MO=String.prototype,ZEe=function(t){var e=t.includes;return t===xO||b4(xO,t)&&e===xO.includes?JEe:typeof t=="string"||t===MO||b4(MO,t)&&e===MO.includes?$Ee:e},Te=tr(ZEe),eve=hc,tve=GA,nve=pb,rve=nu,ive=TypeError,sve=function(t){return function(e,n,r,i){eve(n);var s=tve(e),o=nve(s),a=rve(s),A=t?a-1:0,u=t?-1:1;if(r<2)for(;;){if(A in o){i=o[A],A+=u;break}if(A+=u,t?A<0:a<=A)throw ive("Reduce of empty array with no initial value")}for(;t?A>=0:a>A;A+=u)A in o&&(i=n(i,o[A],A,s));return i}},ove={left:sve(!1)},ave=Cr,_b=function(t,e){var n=[][t];return!!n&&ave(function(){n.call(null,e||function(){return 1},1)})},py=typeof process<"u"&&KA(process)=="process",cve=ove.left;nn({target:"Array",proto:!0,forced:!py&&hf>79&&hf<83||!_b("reduce")},{reduce:function(t){var e=arguments.length;return cve(this,t,e,e>1?arguments[1]:void 0)}});var Ave=pc("Array").reduce,lve=Is,uve=Ave,FO=Array.prototype,dve=function(t){var e=t.reduce;return t===FO||lve(FO,t)&&e===FO.reduce?uve:e},F7=dve,qc=tr(F7);let V7=!0,Q7=!0;function iC(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function Tf(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(o,a){if(o!==e)return i.apply(this,arguments);const A=u=>{const d=n(u);d&&(a.handleEvent?a.handleEvent(d):a(d))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,A),i.apply(this,[o,A])};const s=r.removeEventListener;r.removeEventListener=function(o,a){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(a))return s.apply(this,arguments);const A=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,A])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function hve(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(V7=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function fve(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(Q7=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function H7(){if(typeof window=="object"){if(V7)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function jP(t,e){Q7&&console.warn(t+" is deprecated, please use "+e+" instead.")}function I4(t){return Object.prototype.toString.call(t)==="[object Object]"}function j7(t){var e;return I4(t)?qc(e=Object.keys(t)).call(e,function(n,r){const i=I4(t[r]),s=i?j7(t[r]):t[r],o=i&&!Object.keys(s).length;return s===void 0||o?n:Object.assign(n,{[r]:s})},{}):t}function dL(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?dL(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{dL(t,t.get(i),n)})}))}function R4(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const s=[];return t.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{t.forEach(a=>{a.type===r&&a.trackId===o.id&&dL(t,a,i)})}),i}var pve=xP,O4=Tg("keys"),Eb=function(t){return O4[t]||(O4[t]=pve(t))},mve=!Cr(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),gve=ki,_ve=_i,Eve=GA,vve=mve,N4=Eb("IE_PROTO"),hL=Object,yve=hL.prototype,KP=vve?hL.getPrototypeOf:function(t){var e=Eve(t);if(gve(e,N4))return e[N4];var n=e.constructor;return _ve(n)&&e instanceof n?n.prototype:e instanceof hL?yve:null},wve=mr,Cve=hc,Tve=_i,Sve=String,bve=TypeError,Ive=function(t,e,n){try{return wve(Cve(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},Rve=so,Ove=function(t){if(typeof t=="object"||Tve(t))return t;throw bve("Can't set "+Sve(t)+" as a prototype")},Nve=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Ive(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(r,i){return Rve(r),Ove(i),e?t(r,i):r.__proto__=i,r}}():void 0),vb={},yb={},VO=ki,Dve=Fd,Bve=QP.indexOf,Lve=yb,D4=mr([].push),K7=function(t,e){var n,r=Dve(t),i=0,s=[];for(n in r)!VO(Lve,n)&&VO(r,n)&&D4(s,n);for(;e.length>i;)VO(r,n=e[i++])&&(~Bve(s,n)||D4(s,n));return s},GP=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Uve=K7,Pve=GP.concat("length","prototype");vb.f=Object.getOwnPropertyNames||function(t){return Uve(t,Pve)};var my={};my.f=Object.getOwnPropertySymbols;var kve=wo,xve=vb,Mve=my,Fve=so,Vve=mr([].concat),Qve=kve("Reflect","ownKeys")||function(t){var e=xve.f(Fve(t)),n=Mve.f;return n?Vve(e,n(t)):e},B4=ki,Hve=Qve,jve=dy,Kve=fc,WP={},Gve=K7,Wve=GP,wb=Object.keys||function(t){return Gve(t,Wve)},zve=Sa,qve=P7,Yve=fc,Xve=so,Jve=Fd,$ve=wb;WP.f=zve&&!qve?Object.defineProperties:function(t,e){Xve(t);for(var n,r=Jve(e),i=$ve(e),s=i.length,o=0;s>o;)Yve.f(t,n=i[o++],r[n]);return t};var sC,G7=wo("document","documentElement"),Zve=so,eye=WP,L4=GP,tye=yb,nye=G7,rye=MP,fL="prototype",pL="script",W7=Eb("IE_PROTO"),QO=function(){},z7=function(t){return"<"+pL+">"+t+"</"+pL+">"},U4=function(t){t.write(z7("")),t.close();var e=t.parentWindow.Object;return t=null,e},BT=function(){try{sC=new ActiveXObject("htmlfile")}catch{}var t,e,n;BT=typeof document<"u"?document.domain&&sC?U4(sC):(e=rye("iframe"),n="java"+pL+":",e.style.display="none",nye.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(z7("document.F=Object")),t.close(),t.F):U4(sC);for(var r=L4.length;r--;)delete BT[fL][L4[r]];return BT()};tye[W7]=!0;var gy=Object.create||function(t,e){var n;return t!==null?(QO[fL]=Zve(t),n=new QO,QO[fL]=null,n[W7]=t):n=BT(),e===void 0?n:eye.f(n,e)},iye=qo,sye=Qd,q7=Error,oye=mr("".replace),aye=String(q7("zxcasd").stack),Y7=/\n\s*at [^:]*:[^\n]*/,cye=Y7.test(aye),Aye=Md,lye=!Cr(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",Aye(1,7)),t.stack!==7)}),uye=Qd,dye=function(t,e){if(cye&&typeof t=="string"&&!q7.prepareStackTrace)for(;e--;)t=oye(t,Y7,"");return t},hye=lye,P4=Error.captureStackTrace,Sf={},fye=Sf,pye=cr("iterator"),mye=Array.prototype,X7=function(t){return t!==void 0&&(fye.Array===t||mye[pye]===t)},gye=WA,k4=mb,_ye=vg,Eye=Sf,vye=cr("iterator"),Cb=function(t){if(!_ye(t))return k4(t,vye)||k4(t,"@@iterator")||Eye[gye(t)]},yye=Ei,wye=hc,Cye=so,Tye=Cg,Sye=Cb,bye=TypeError,zP=function(t,e){var n=arguments.length<2?Sye(t):e;if(wye(n))return Cye(yye(n,t));throw bye(Tye(t)+" is not iterable")},Iye=Ei,x4=so,Rye=mb,J7=function(t,e,n){var r,i;x4(t);try{if(!(r=Rye(t,"return"))){if(e==="throw")throw n;return n}r=Iye(r,t)}catch(s){i=!0,r=s}if(e==="throw")throw n;if(i)throw r;return x4(r),n},Oye=Vd,Nye=Ei,Dye=so,Bye=Cg,Lye=X7,Uye=nu,M4=Is,Pye=zP,kye=Cb,F4=J7,xye=TypeError,LT=function(t,e){this.stopped=t,this.result=e},V4=LT.prototype,_y=function(t,e,n){var r,i,s,o,a,A,u,d=n&&n.that,f=!(!n||!n.AS_ENTRIES),m=!(!n||!n.IS_RECORD),g=!(!n||!n.IS_ITERATOR),v=!(!n||!n.INTERRUPTED),y=Oye(e,d),w=function(I){return r&&F4(r,"normal",I),new LT(!0,I)},b=function(I){return f?(Dye(I),v?y(I[0],I[1],w):y(I[0],I[1])):v?y(I,w):y(I)};if(m)r=t.iterator;else if(g)r=t;else{if(!(i=kye(t)))throw xye(Bye(t)+" is not iterable");if(Lye(i)){for(s=0,o=Uye(t);o>s;s++)if((a=b(t[s]))&&M4(V4,a))return a;return new LT(!1)}r=Pye(t,i)}for(A=m?t.next:r.next;!(u=Nye(A,r)).done;){try{a=b(u.value)}catch(I){F4(r,"throw",I)}if(typeof a=="object"&&a&&M4(V4,a))return a}return new LT(!1)},Mye=ba,Fye=nn,Vye=Is,Qye=KP,Y0=Nve,Hye=function(t,e,n){for(var r=Hve(e),i=Kve.f,s=jve.f,o=0;o<r.length;o++){var a=r[o];B4(t,a)||n&&B4(n,a)||i(t,a,s(e,a))}},$7=gy,HO=Qd,jO=Md,jye=function(t,e){iye(e)&&"cause"in e&&sye(t,"cause",e.cause)},Kye=function(t,e,n,r){hye&&(P4?P4(t,e):uye(t,"stack",dye(n,r)))},Gye=_y,Wye=function(t,e){return t===void 0?arguments.length<2?"":e:Mye(t)},zye=cr("toStringTag"),X0=Error,qye=[].push,Gm=function(t,e){var n,r=Vye(KO,this);Y0?n=Y0(X0(),r?Qye(this):KO):(n=r?this:$7(KO),HO(n,zye,"Error")),e!==void 0&&HO(n,"message",Wye(e)),Kye(n,Gm,n.stack,1),arguments.length>2&&jye(n,arguments[2]);var i=[];return Gye(t,qye,{that:i}),HO(n,"errors",i),n};Y0?Y0(Gm,X0):Hye(Gm,X0,{name:!0});var KO=Gm.prototype=$7(X0.prototype,{constructor:jO(1,Gm),message:jO(1,""),name:jO(1,"AggregateError")});Fye({global:!0},{AggregateError:Gm});var J0,PE,$0,Yye=_i,Q4=gi.WeakMap,Xye=Yye(Q4)&&/native code/.test(String(Q4)),Z7=gi,Jye=qo,$ye=Qd,GO=ki,WO=kP,Zye=Eb,ewe=yb,H4="Object already initialized",mL=Z7.TypeError,twe=Z7.WeakMap;if(Xye||WO.state){var hA=WO.state||(WO.state=new twe);hA.get=hA.get,hA.has=hA.has,hA.set=hA.set,J0=function(t,e){if(hA.has(t))throw mL(H4);return e.facade=t,hA.set(t,e),e},PE=function(t){return hA.get(t)||{}},$0=function(t){return hA.has(t)}}else{var hp=Zye("state");ewe[hp]=!0,J0=function(t,e){if(GO(t,hp))throw mL(H4);return e.facade=t,$ye(t,hp,e),e},PE=function(t){return GO(t,hp)?t[hp]:{}},$0=function(t){return GO(t,hp)}}var Zh,j4,K4,bf={set:J0,get:PE,has:$0,enforce:function(t){return $0(t)?PE(t):J0(t,{})},getterFor:function(t){return function(e){var n;if(!Jye(e)||(n=PE(e)).type!==t)throw mL("Incompatible receiver, "+t+" required");return n}}},gL=Sa,nwe=ki,eX=Function.prototype,rwe=gL&&Object.getOwnPropertyDescriptor,G4=nwe(eX,"name"),tX={PROPER:G4&&(function(){}).name==="something",CONFIGURABLE:G4&&(!gL||gL&&rwe(eX,"name").configurable)},iwe=Qd,Hd=function(t,e,n,r){return r&&r.enumerable?t[e]=n:iwe(t,e,n),t},swe=Cr,owe=_i,awe=qo,cwe=gy,W4=KP,Awe=Hd,_L=cr("iterator"),nX=!1;[].keys&&("next"in(K4=[].keys())?(j4=W4(W4(K4)))!==Object.prototype&&(Zh=j4):nX=!0);var lwe=!awe(Zh)||swe(function(){var t={};return Zh[_L].call(t)!==t});owe((Zh=lwe?{}:cwe(Zh))[_L])||Awe(Zh,_L,function(){return this});var rX={IteratorPrototype:Zh,BUGGY_SAFARI_ITERATORS:nX},uwe=WA,dwe=HP?{}.toString:function(){return"[object "+uwe(this)+"]"},hwe=HP,fwe=fc.f,pwe=Qd,mwe=ki,gwe=dwe,z4=cr("toStringTag"),jd=function(t,e,n,r){if(t){var i=n?t:t.prototype;mwe(i,z4)||fwe(i,z4,{configurable:!0,value:e}),r&&!hwe&&pwe(i,"toString",gwe)}},_we=rX.IteratorPrototype,Ewe=gy,vwe=Md,ywe=jd,wwe=Sf,Cwe=function(){return this},qP=function(t,e,n,r){var i=e+" Iterator";return t.prototype=Ewe(_we,{next:vwe(+!r,n)}),ywe(t,i,!1,!0),wwe[i]=Cwe,t},Twe=nn,Swe=Ei,bwe=tX,Iwe=qP,Rwe=KP,Owe=jd,q4=Hd,Y4=Sf,Nwe=rX,Dwe=bwe.PROPER,oC=Nwe.BUGGY_SAFARI_ITERATORS,zO=cr("iterator"),X4="keys",aC="values",J4="entries",Bwe=function(){return this},iX=function(t,e,n,r,i,s,o){Iwe(n,e,r);var a,A,u,d=function(b){if(b===i&&y)return y;if(!oC&&b in g)return g[b];switch(b){case X4:case aC:case J4:return function(){return new n(this,b)}}return function(){return new n(this)}},f=e+" Iterator",m=!1,g=t.prototype,v=g[zO]||g["@@iterator"]||i&&g[i],y=!oC&&v||d(i),w=e=="Array"&&g.entries||v;if(w&&(a=Rwe(w.call(new t)))!==Object.prototype&&a.next&&(Owe(a,f,!0,!0),Y4[f]=Bwe),Dwe&&i==aC&&v&&v.name!==aC&&(m=!0,y=function(){return Swe(v,this)}),i)if(A={values:d(aC),keys:s?y:d(X4),entries:d(J4)},o)for(u in A)(oC||m||!(u in g))&&q4(g,u,A[u]);else Twe({target:e,proto:!0,forced:oC||m},A);return o&&g[zO]!==y&&q4(g,zO,y,{}),Y4[e]=y,A},YP=function(t,e){return{value:t,done:e}},Lwe=Fd,$4=Sf,sX=bf;fc.f;var Uwe=iX,Z4=YP,oX="Array Iterator",Pwe=sX.set,kwe=sX.getterFor(oX);Uwe(Array,"Array",function(t,e){Pwe(this,{type:oX,target:Lwe(t),index:0,kind:e})},function(){var t=kwe(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,Z4(void 0,!0)):Z4(n=="keys"?r:n=="values"?e[r]:[r,e[r]],!1)},"values"),$4.Arguments=$4.Array;var xwe=fc,Tb=function(t,e,n){return xwe.f(t,e,n)},Mwe=wo,Fwe=Tb,Vwe=Sa,eH=cr("species"),Qwe=Is,Hwe=TypeError,XP=function(t,e){if(Qwe(e,t))return t;throw Hwe("Incorrect invocation")},jwe=_i,EL=kP,Kwe=mr(Function.toString);jwe(EL.inspectSource)||(EL.inspectSource=function(t){return Kwe(t)});var aX=EL.inspectSource,Gwe=mr,Wwe=Cr,cX=_i,zwe=WA,qwe=aX,AX=function(){},Ywe=[],lX=wo("Reflect","construct"),JP=/^\s*(?:class|function)\b/,Xwe=Gwe(JP.exec),Jwe=!JP.exec(AX),k_=function(t){if(!cX(t))return!1;try{return lX(AX,Ywe,t),!0}catch{return!1}},uX=function(t){if(!cX(t))return!1;switch(zwe(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Jwe||!!Xwe(JP,qwe(t))}catch{return!0}};uX.sham=!0;var mv,fp,tH,qO,Sb=!lX||Wwe(function(){var t;return k_(k_.call)||!k_(Object)||!k_(function(){t=!0})||t})?uX:k_,$we=Sb,Zwe=Cg,eCe=TypeError,nH=so,tCe=function(t){if($we(t))return t;throw eCe(Zwe(t)+" is not a constructor")},nCe=vg,rCe=cr("species"),$P=function(t,e){var n,r=nH(t).constructor;return r===void 0||nCe(n=nH(r)[rCe])?e:tCe(n)},ZP=mr([].slice),iCe=TypeError,bb=function(t,e){if(t<e)throw iCe("Not enough arguments");return t},dX=/(?:ipad|iphone|ipod).*applewebkit/i.test(Cf),Ea=gi,sCe=PP,oCe=Vd,rH=_i,aCe=ki,hX=Cr,iH=G7,cCe=ZP,sH=MP,ACe=bb,lCe=dX,uCe=py,vL=Ea.setImmediate,oH=Ea.clearImmediate,dCe=Ea.process,YO=Ea.Dispatch,hCe=Ea.Function,aH=Ea.MessageChannel,fCe=Ea.String,XO=0,kE={},cH="onreadystatechange";hX(function(){mv=Ea.location});var ek=function(t){if(aCe(kE,t)){var e=kE[t];delete kE[t],e()}},JO=function(t){return function(){ek(t)}},AH=function(t){ek(t.data)},lH=function(t){Ea.postMessage(fCe(t),mv.protocol+"//"+mv.host)};vL&&oH||(vL=function(t){ACe(arguments.length,1);var e=rH(t)?t:hCe(t),n=cCe(arguments,1);return kE[++XO]=function(){sCe(e,void 0,n)},fp(XO),XO},oH=function(t){delete kE[t]},uCe?fp=function(t){dCe.nextTick(JO(t))}:YO&&YO.now?fp=function(t){YO.now(JO(t))}:aH&&!lCe?(qO=(tH=new aH).port2,tH.port1.onmessage=AH,fp=oCe(qO.postMessage,qO)):Ea.addEventListener&&rH(Ea.postMessage)&&!Ea.importScripts&&mv&&mv.protocol!=="file:"&&!hX(lH)?(fp=lH,Ea.addEventListener("message",AH,!1)):fp=cH in sH("script")?function(t){iH.appendChild(sH("script"))[cH]=function(){iH.removeChild(this),ek(t)}}:function(t){setTimeout(JO(t),0)});var fX={set:vL},pX=function(){this.head=null,this.tail=null};pX.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var pp,$O,ZO,eN,uH,mX=pX,pCe=/ipad|iphone|ipod/i.test(Cf)&&typeof Pebble<"u",mCe=/web0s(?!.*chrome)/i.test(Cf),ff=gi,dH=Vd,gCe=dy.f,tN=fX.set,_Ce=mX,ECe=dX,vCe=pCe,yCe=mCe,nN=py,hH=ff.MutationObserver||ff.WebKitMutationObserver,fH=ff.document,pH=ff.process,cC=ff.Promise,mH=gCe(ff,"queueMicrotask"),yL=mH&&mH.value;if(!yL){var AC=new _Ce,lC=function(){var t,e;for(nN&&(t=pH.domain)&&t.exit();e=AC.get();)try{e()}catch(n){throw AC.head&&pp(),n}t&&t.enter()};ECe||nN||yCe||!hH||!fH?!vCe&&cC&&cC.resolve?((eN=cC.resolve(void 0)).constructor=cC,uH=dH(eN.then,eN),pp=function(){uH(lC)}):nN?pp=function(){pH.nextTick(lC)}:(tN=dH(tN,ff),pp=function(){tN(lC)}):($O=!0,ZO=fH.createTextNode(""),new hH(lC).observe(ZO,{characterData:!0}),pp=function(){ZO.data=$O=!$O}),yL=function(t){AC.head||pp(),AC.add(t)}}var wCe=yL,Sg=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},pf=gi.Promise,gX=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",CCe=!gX&&!py&&typeof window=="object"&&typeof document=="object",TCe=gi,xE=pf,SCe=_i,bCe=U7,ICe=aX,RCe=cr,OCe=CCe,NCe=gX,rN=hf,gH=xE&&xE.prototype,DCe=RCe("species"),_X=SCe(TCe.PromiseRejectionEvent),BCe=bCe("Promise",function(){var t=ICe(xE),e=t!==String(xE);if(!e&&rN===66||!gH.catch||!gH.finally)return!0;if(!rN||rN<51||!/native code/.test(t)){var n=new xE(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[DCe]=r,!(n.then(function(){})instanceof r))return!0}return!e&&(OCe||NCe)&&!_X}),Ey={CONSTRUCTOR:BCe,REJECTION_EVENT:_X},zA={},_H=hc,LCe=TypeError,UCe=function(t){var e,n;this.promise=new t(function(r,i){if(e!==void 0||n!==void 0)throw LCe("Bad Promise constructor");e=r,n=i}),this.resolve=_H(e),this.reject=_H(n)};zA.f=function(t){return new UCe(t)};var iN,EH,PCe=nn,Z0=py,Ld=gi,vy=Ei,kCe=Hd,xCe=jd,MCe=function(t){var e=Mwe(t);Vwe&&e&&!e[eH]&&Fwe(e,eH,{configurable:!0,get:function(){return this}})},FCe=hc,wL=_i,VCe=qo,QCe=XP,HCe=$P,EX=fX.set,tk=wCe,jCe=function(t,e){try{arguments.length==1?console.error(t):console.error(t,e)}catch{}},KCe=Sg,GCe=mX,vX=bf,CL=pf,yX=Ey,wX=zA,UT="Promise",vH=yX.CONSTRUCTOR,WCe=yX.REJECTION_EVENT,sN=vX.getterFor(UT),zCe=vX.set,qCe=CL&&CL.prototype,x_=CL,oN=qCe,CX=Ld.TypeError,TL=Ld.document,nk=Ld.process,SL=wX.f,YCe=SL,XCe=!!(TL&&TL.createEvent&&Ld.dispatchEvent),TX="unhandledrejection",SX=function(t){var e;return!(!VCe(t)||!wL(e=t.then))&&e},bX=function(t,e){var n,r,i,s=e.value,o=e.state==1,a=o?t.ok:t.fail,A=t.resolve,u=t.reject,d=t.domain;try{a?(o||(e.rejection===2&&$Ce(e),e.rejection=1),a===!0?n=s:(d&&d.enter(),n=a(s),d&&(d.exit(),i=!0)),n===t.promise?u(CX("Promise-chain cycle")):(r=SX(n))?vy(r,n,A,u):A(n)):u(s)}catch(f){d&&!i&&d.exit(),u(f)}},IX=function(t,e){t.notified||(t.notified=!0,tk(function(){for(var n,r=t.reactions;n=r.get();)bX(n,t);t.notified=!1,e&&!t.rejection&&JCe(t)}))},RX=function(t,e,n){var r,i;XCe?((r=TL.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),Ld.dispatchEvent(r)):r={promise:e,reason:n},!WCe&&(i=Ld["on"+t])?i(r):t===TX&&jCe("Unhandled promise rejection",n)},JCe=function(t){vy(EX,Ld,function(){var e,n=t.facade,r=t.value;if(yH(t)&&(e=KCe(function(){Z0?nk.emit("unhandledRejection",r,n):RX(TX,n,r)}),t.rejection=Z0||yH(t)?2:1,e.error))throw e.value})},yH=function(t){return t.rejection!==1&&!t.parent},$Ce=function(t){vy(EX,Ld,function(){var e=t.facade;Z0?nk.emit("rejectionHandled",e):RX("rejectionhandled",e,t.value)})},$p=function(t,e,n){return function(r){t(e,r,n)}},_m=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,IX(t,!0))},bL=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw CX("Promise can't be resolved itself");var r=SX(e);r?tk(function(){var i={done:!1};try{vy(r,e,$p(bL,i,t),$p(_m,i,t))}catch(s){_m(i,s,t)}}):(t.value=e,t.state=1,IX(t,!1))}catch(i){_m({done:!1},i,t)}}};vH&&(oN=(x_=function(t){QCe(this,oN),FCe(t),vy(iN,this);var e=sN(this);try{t($p(bL,e),$p(_m,e))}catch(n){_m(e,n)}}).prototype,(iN=function(t){zCe(this,{type:UT,done:!1,notified:!1,parent:!1,reactions:new GCe,rejection:!1,state:0,value:void 0})}).prototype=kCe(oN,"then",function(t,e){var n=sN(this),r=SL(HCe(this,x_));return n.parent=!0,r.ok=!wL(t)||t,r.fail=wL(e)&&e,r.domain=Z0?nk.domain:void 0,n.state==0?n.reactions.add(r):tk(function(){bX(r,n)}),r.promise}),EH=function(){var t=new iN,e=sN(t);this.promise=t,this.resolve=$p(bL,e),this.reject=$p(_m,e)},wX.f=SL=function(t){return t===x_||t===void 0?new EH(t):YCe(t)}),PCe({global:!0,wrap:!0,forced:vH},{Promise:x_}),xCe(x_,UT,!1,!0),MCe(UT);var OX=cr("iterator"),NX=!1;try{var ZCe=0,wH={next:function(){return{done:!!ZCe++}},return:function(){NX=!0}};wH[OX]=function(){return this},Array.from(wH,function(){throw 2})}catch{}var eTe=pf,tTe=function(t,e){if(!NX)return!1;var n=!1;try{var r={};r[OX]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch{}return n},Ib=Ey.CONSTRUCTOR||!tTe(function(t){eTe.all(t).then(void 0,function(){})}),nTe=Ei,rTe=hc,iTe=zA,sTe=Sg,oTe=_y;nn({target:"Promise",stat:!0,forced:Ib},{all:function(t){var e=this,n=iTe.f(e),r=n.resolve,i=n.reject,s=sTe(function(){var o=rTe(e.resolve),a=[],A=0,u=1;oTe(t,function(d){var f=A++,m=!1;u++,nTe(o,e,d).then(function(g){m||(m=!0,a[f]=g,--u||r(a))},i)}),--u||r(a)});return s.error&&i(s.value),n.promise}});var aTe=nn,cTe=Ey.CONSTRUCTOR;pf&&pf.prototype,aTe({target:"Promise",proto:!0,forced:cTe,real:!0},{catch:function(t){return this.then(void 0,t)}});var ATe=Ei,lTe=hc,uTe=zA,dTe=Sg,hTe=_y;nn({target:"Promise",stat:!0,forced:Ib},{race:function(t){var e=this,n=uTe.f(e),r=n.reject,i=dTe(function(){var s=lTe(e.resolve);hTe(t,function(o){ATe(s,e,o).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var fTe=Ei,pTe=zA;nn({target:"Promise",stat:!0,forced:Ey.CONSTRUCTOR},{reject:function(t){var e=pTe.f(this);return fTe(e.reject,void 0,t),e.promise}});var mTe=so,gTe=qo,_Te=zA,DX=function(t,e){if(mTe(t),gTe(e)&&e.constructor===t)return e;var n=_Te.f(t);return(0,n.resolve)(e),n.promise},ETe=nn,vTe=pf,yTe=Ey.CONSTRUCTOR,wTe=DX,CTe=wo("Promise"),TTe=!yTe;ETe({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return wTe(TTe&&this===CTe?vTe:this,t)}});var STe=Ei,bTe=hc,ITe=zA,RTe=Sg,OTe=_y;nn({target:"Promise",stat:!0,forced:Ib},{allSettled:function(t){var e=this,n=ITe.f(e),r=n.resolve,i=n.reject,s=RTe(function(){var o=bTe(e.resolve),a=[],A=0,u=1;OTe(t,function(d){var f=A++,m=!1;u++,STe(o,e,d).then(function(g){m||(m=!0,a[f]={status:"fulfilled",value:g},--u||r(a))},function(g){m||(m=!0,a[f]={status:"rejected",reason:g},--u||r(a))})}),--u||r(a)});return s.error&&i(s.value),n.promise}});var NTe=Ei,DTe=hc,BTe=wo,LTe=zA,UTe=Sg,PTe=_y,CH="No one promise resolved";nn({target:"Promise",stat:!0,forced:Ib},{any:function(t){var e=this,n=BTe("AggregateError"),r=LTe.f(e),i=r.resolve,s=r.reject,o=UTe(function(){var a=DTe(e.resolve),A=[],u=0,d=1,f=!1;PTe(t,function(m){var g=u++,v=!1;d++,NTe(a,e,m).then(function(y){v||f||(f=!0,i(y))},function(y){v||f||(v=!0,A[g]=y,--d||s(new n(A,CH)))})}),--d||s(new n(A,CH))});return o.error&&s(o.value),r.promise}});var kTe=nn,IL=pf,xTe=Cr,MTe=wo,FTe=_i,VTe=$P,TH=DX,QTe=IL&&IL.prototype;kTe({target:"Promise",proto:!0,real:!0,forced:!!IL&&xTe(function(){QTe.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=VTe(this,MTe("Promise")),n=FTe(t);return this.then(n?function(r){return TH(e,t()).then(function(){return r})}:t,n?function(r){return TH(e,t()).then(function(){throw r})}:t)}});var rk=mr,HTe=FP,jTe=ba,KTe=yg,GTe=rk("".charAt),SH=rk("".charCodeAt),WTe=rk("".slice),bH=function(t){return function(e,n){var r,i,s=jTe(KTe(e)),o=HTe(n),a=s.length;return o<0||o>=a?t?"":void 0:(r=SH(s,o))<55296||r>56319||o+1===a||(i=SH(s,o+1))<56320||i>57343?t?GTe(s,o):r:t?WTe(s,o,o+2):i-56320+(r-55296<<10)+65536}},ik={codeAt:bH(!1),charAt:bH(!0)},zTe=ik.charAt,qTe=ba,BX=bf,YTe=iX,IH=YP,LX="String Iterator",XTe=BX.set,JTe=BX.getterFor(LX);YTe(String,"String",function(t){XTe(this,{type:LX,string:qTe(t),index:0})},function(){var t,e=JTe(this),n=e.string,r=e.index;return r>=n.length?IH(void 0,!0):(t=zTe(n,r),e.index+=t.length,IH(t,!1))});var $Te=Xc.Promise,ZTe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},e0e=gi,t0e=WA,n0e=Qd,RH=Sf,OH=cr("toStringTag");for(var aN in ZTe){var NH=e0e[aN],cN=NH&&NH.prototype;cN&&t0e(cN)!==OH&&n0e(cN,OH,aN),RH[aN]=RH.Array}var UX=$Te,ye=tr(UX);const DH=H7;function PX(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;const a={};return Object.keys(o).forEach(A=>{if(A==="require"||A==="advanced"||A==="mediaSource")return;const u=typeof o[A]=="object"?o[A]:{ideal:o[A]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const d=function(f,m){return f?f+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){a.optional=a.optional||[];let f={};typeof u.ideal=="number"?(f[d("min",A)]=u.ideal,a.optional.push(f),f={},f[d("max",A)]=u.ideal,a.optional.push(f)):(f[d("",A)]=u.ideal,a.optional.push(f))}u.exact!==void 0&&typeof u.exact!="number"?(a.mandatory=a.mandatory||{},a.mandatory[d("",A)]=u.exact):["min","max"].forEach(f=>{u[f]!==void 0&&(a.mandatory=a.mandatory||{},a.mandatory[d(f,A)]=u[f])})}),o.advanced&&(a.optional=(a.optional||[]).concat(o.advanced)),a},i=function(o,a){if(e.version>=61)return a(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){const A=function(u,d,f){d in u&&!(f in u)&&(u[f]=u[d],delete u[d])};A((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),A(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=r(o.audio)}if(o&&typeof o.video=="object"){let A=o.video.facingMode;A=A&&(typeof A=="object"?A:{ideal:A});const u=e.version<66;if(A&&(A.exact==="user"||A.exact==="environment"||A.ideal==="user"||A.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||u)){let d;if(delete o.video.facingMode,A.exact==="environment"||A.ideal==="environment"?d=["back","rear"]:A.exact!=="user"&&A.ideal!=="user"||(d=["front"]),d)return n.mediaDevices.enumerateDevices().then(f=>{let m=(f=f.filter(g=>g.kind==="videoinput")).find(g=>d.some(v=>{var y;return Te(y=g.label.toLowerCase()).call(y,v)}));return!m&&f.length&&Te(d).call(d,"back")&&(m=f[f.length-1]),m&&(o.video.deviceId=A.exact?{exact:m.deviceId}:{ideal:m.deviceId}),o.video=r(o.video),DH("chrome: "+JSON.stringify(o)),a(o)})}o.video=r(o.video)}return DH("chrome: "+JSON.stringify(o)),a(o)},s=function(o){return e.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(o,a,A){i(o,u=>{n.webkitGetUserMedia(u,a,d=>{A&&A(s(d))})})}).bind(n),n.mediaDevices.getUserMedia){const o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(a){return i(a,A=>o(A).then(u=>{if(A.audio&&!u.getAudioTracks().length||A.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(d=>{d.stop()}),new DOMException("","NotFoundError");return u},u=>ye.reject(s(u))))}}}function kX(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function xX(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===r.track.id):{track:r.track};const s=new Event("track");s.track=r.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)}),n.stream.getTracks().forEach(r=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===r.id):{track:r};const s=new Event("track");s.track=r,s.receiver=i,s.transceiver={receiver:i},s.streams=[n.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Tf(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function MX(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,a){let A=i.apply(this,arguments);return A||(A=e(this,o),this._senders.push(A)),A};const s=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);const a=this._senders.indexOf(o);a!==-1&&this._senders.splice(a,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(s=>{this._senders.push(e(this,s))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(s=>{const o=this._senders.find(a=>a.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function FX(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const s=function(a){const A={};return a.result().forEach(u=>{const d={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(f=>{d[f]=u.stat(f)}),A[d.id]=d}),A},o=function(a){return new Map(Object.keys(a).map(A=>[A,a[A]]))};if(arguments.length>=2){const a=function(A){r(o(s(A)))};return e.apply(this,[a,n])}return new ye((a,A)=>{e.apply(this,[function(u){a(o(s(u)))},A])}).then(r,i)}}function VX(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(s=>s._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(s=>R4(s,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),Tf(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>R4(i,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let r,i,s;return this.getSenders().forEach(o=>{o.track===n&&(r?s=!0:r=o)}),this.getReceivers().forEach(o=>(o.track===n&&(i?s=!0:i=o),o.track===n)),s||r&&i?ye.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():ye.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function QX(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const a=e.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(a)===-1&&this._shimmedLocalStreams[o.id].push(a):this._shimmedLocalStreams[o.id]=[o,a],a};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(A=>{if(this.getSenders().find(d=>d.track===A))throw new DOMException("Track already exists.","InvalidAccessError")});const o=this.getSenders();n.apply(this,arguments);const a=this.getSenders().filter(A=>o.indexOf(A)===-1);this._shimmedLocalStreams[s.id]=[s].concat(a)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{const a=this._shimmedLocalStreams[o].indexOf(s);a!==-1&&this._shimmedLocalStreams[o].splice(a,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function HX(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return QX(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const A=n.apply(this);return this._reverseStreams=this._reverseStreams||{},A.map(u=>this._reverseStreams[u.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(A){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},A.getTracks().forEach(u=>{if(this.getSenders().find(f=>f.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[A.id]){const u=new t.MediaStream(A.getTracks());this._streams[A.id]=u,this._reverseStreams[u.id]=A,A=u}r.apply(this,[A])};const i=t.RTCPeerConnection.prototype.removeStream;function s(A,u){let d=u.sdp;return Object.keys(A._reverseStreams||[]).forEach(f=>{const m=A._reverseStreams[f],g=A._streams[m.id];d=d.replace(new RegExp(g.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:d})}t.RTCPeerConnection.prototype.removeStream=function(A){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[A.id]||A]),delete this._reverseStreams[this._streams[A.id]?this._streams[A.id].id:A.id],delete this._streams[A.id]},t.RTCPeerConnection.prototype.addTrack=function(A,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const d=[].slice.call(arguments,1);if(d.length!==1||!d[0].getTracks().find(g=>g===A))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===A))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const m=this._streams[u.id];if(m)m.addTrack(A),ye.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const g=new t.MediaStream([A]);this._streams[u.id]=g,this._reverseStreams[g.id]=u,this.addStream(g)}return this.getSenders().find(g=>g.track===A)},["createOffer","createAnswer"].forEach(function(A){const u=t.RTCPeerConnection.prototype[A],d={[A](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[m=>{const g=s(this,m);f[0].apply(null,[g])},m=>{f[1]&&f[1].apply(null,m)},arguments[2]]):u.apply(this,arguments).then(m=>s(this,m))}};t.RTCPeerConnection.prototype[A]=d[A]});const o=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(A,u){let d=u.sdp;return Object.keys(A._reverseStreams||[]).forEach(f=>{const m=A._reverseStreams[f],g=A._streams[m.id];d=d.replace(new RegExp(m.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:d})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const A=a.get.apply(this);return A.type===""?A:s(this,A)}}),t.RTCPeerConnection.prototype.removeTrack=function(A){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!A._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(A._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let u;this._streams=this._streams||{},Object.keys(this._streams).forEach(d=>{this._streams[d].getTracks().find(f=>A.track===f)&&(u=this._streams[d])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(A.track),this.dispatchEvent(new Event("negotiationneeded")))}}function RL(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function jX(t,e){Tf(t,"negotiationneeded",n=>{const r=n.target;if(!(e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var BH=Object.freeze({__proto__:null,fixNegotiationNeeded:jX,shimAddTrackRemoveTrack:HX,shimAddTrackRemoveTrackWithNative:QX,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(r=>{const i=n.video&&n.video.width,s=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:o||3}},i&&(n.video.mandatory.maxWidth=i),s&&(n.video.mandatory.maxHeight=s),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:MX,shimGetStats:FX,shimGetUserMedia:PX,shimMediaStream:kX,shimOnTrack:xX,shimPeerConnection:RL,shimSenderReceiverGetStats:VX});function KX(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,s,o){jP("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(o,a,A){a in o&&!(A in o)&&(o[A]=o[a],delete o[a])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},r&&r.prototype.getSettings){const o=r.prototype.getSettings;r.prototype.getSettings=function(){const a=o.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const o=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function GX(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function OL(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const s=t.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=o[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,s,o]=arguments;return r.apply(this,[i||null]).then(a=>{if(e.version<53&&!s)try{a.forEach(A=>{A.type=n[A.type]||A.type})}catch(A){if(A.name!=="TypeError")throw A;a.forEach((u,d)=>{a.set(d,Object.assign({},u,{type:n[u.type]||u.type}))})}return a}).then(s,o)}}function WX(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ye.resolve(new Map)}}function zX(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Tf(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function qX(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){jP("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&Te(r=e.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function YX(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function XX(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(r){const{sender:s}=i,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=n,s.sendEncodings=n,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return i})}function JX(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function $X(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ye.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function ZX(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ye.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var LH=Object.freeze({__proto__:null,shimAddTransceiver:XX,shimCreateAnswer:ZX,shimCreateOffer:$X,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,ye.reject(r)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:JX,shimGetUserMedia:KX,shimOnTrack:GX,shimPeerConnection:OL,shimRTCDataChannel:YX,shimReceiverGetStats:zX,shimRemoveStream:qX,shimSenderGetStats:WX});function eJ(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),Te(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>e.call(this,i,n)),n.getVideoTracks().forEach(i=>e.call(this,i,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i&&i.forEach(o=>{var a;this._localStreams?Te(a=this._localStreams).call(a,o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const r=e.getTracks();this.getSenders().forEach(i=>{Te(r).call(r,i.track)&&this.removeTrack(i)})})}}function tJ(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),Te(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,n.dispatchEvent(s)})}),e.apply(n,arguments)}}}function nJ(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(A,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[d]);return u?(f.then(A,u),ye.resolve()):f},e.createAnswer=function(A,u){const d=arguments.length>=2?arguments[2]:arguments[0],f=r.apply(this,[d]);return u?(f.then(A,u),ye.resolve()):f};let a=function(A,u,d){const f=i.apply(this,[A]);return d?(f.then(u,d),ye.resolve()):f};e.setLocalDescription=a,a=function(A,u,d){const f=s.apply(this,[A]);return d?(f.then(u,d),ye.resolve()):f},e.setRemoteDescription=a,a=function(A,u,d){const f=o.apply(this,[A]);return d?(f.then(u,d),ye.resolve()):f},e.addIceCandidate=a}function rJ(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(iJ(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,r,i){e.mediaDevices.getUserMedia(n).then(r,i)}).bind(e))}function iJ(t){return t&&t.video!==void 0?Object.assign({},t,{video:j7(t.video)}):t}function sJ(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let s=0;s<n.iceServers.length;s++){let o=n.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(jP("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(n.iceServers[s])}n.iceServers=i}return new e(n,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function oJ(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function aJ(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(s=>s.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function cJ(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var UH=Object.freeze({__proto__:null,shimAudioContext:cJ,shimCallbacksAPI:nJ,shimConstraints:iJ,shimCreateOfferLegacy:aJ,shimGetUserMedia:rJ,shimLocalStreamsAPI:eJ,shimRTCIceServerUrls:sJ,shimRemoteStreamsAPI:tJ,shimTrackEventTransceiver:oJ}),AJ=`	
\v\f\r \u2028\u2029\uFEFF`,r0e=yg,i0e=ba,NL=AJ,PH=mr("".replace),s0e=RegExp("^["+NL+"]+"),o0e=RegExp("(^|[^"+NL+"])["+NL+"]+$"),a0e=function(t){return function(e){var n=i0e(r0e(e));return 1&t&&(n=PH(n,s0e,"")),2&t&&(n=PH(n,o0e,"$1")),n}},c0e={trim:a0e(3)},A0e=tX.PROPER,l0e=Cr,kH=AJ,u0e=c0e.trim;nn({target:"String",proto:!0,forced:function(t){return l0e(function(){return!!kH[t]()||""[t]()!==""||A0e&&kH[t].name!==t})}("trim")},{trim:function(){return u0e(this)}});var d0e=pc("String").trim,h0e=Is,f0e=d0e,AN=String.prototype,p0e=function(t){var e=t.trim;return typeof t=="string"||t===AN||h0e(AN,t)&&e===AN.trim?f0e:e},is=tr(p0e),lJ={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let s=8;s<r.length;s+=2)switch(r[s]){case"raddr":i.relatedAddress=r[s+1];break;case"rport":i.relatedPort=parseInt(r[s+1],10);break;case"tcptype":i.tcpType=r[s+1];break;case"ufrag":i.ufrag=r[s+1],i.usernameFragment=r[s+1];break;default:i[r[s]]===void 0&&(i[r[s]]=r[s+1])}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const s=n.type;return r.push("typ"),r.push(s),s!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const s=n.substring(n.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const s=[];Object.keys(n.parameters).forEach(o=>{n.parameters[o]!==void 0?s.push(o+"="+n.parameters[o]):s.push(o)}),r+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(s=>{r+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},s=n.indexOf(":",r);return s>-1?(i.attribute=n.substring(r+1,s),i.value=n.substring(s+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],s=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let o=3;o<i.length;o++){const a=i[o],A=e.matchPrefix(n,"a=rtpmap:"+a+" ")[0];if(A){const u=e.parseRtpMap(A),d=e.matchPrefix(n,"a=fmtp:"+a+" ");switch(u.parameters=d.length?e.parseFmtp(d[0]):{},u.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+a+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(o=>{r.headerExtensions.push(e.parseExtmap(o))});const s=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(o=>{s.forEach(a=>{o.rtcpFeedback.find(A=>A.type===a.type&&A.parameter===a.parameter)||o.rtcpFeedback.push(a)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return r.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(m=>e.parseSsrcMedia(m)).filter(m=>m.attribute==="cname"),A=a.length>0&&a[0].ssrc;let u;const d=e.matchPrefix(n,"a=ssrc-group:FID").map(m=>m.substring(17).split(" ").map(g=>parseInt(g,10)));d.length>0&&d[0].length>1&&d[0][0]===A&&(u=d[0][1]),i.codecs.forEach(m=>{if(m.name.toUpperCase()==="RTX"&&m.parameters.apt){let g={ssrc:A,codecPayloadType:parseInt(m.parameters.apt,10)};A&&u&&(g.rtx={ssrc:u}),r.push(g),s&&(g=JSON.parse(JSON.stringify(g)),g.fec={ssrc:A,mechanism:o?"red+ulpfec":"red"},r.push(g))}}),r.length===0&&A&&r.push({ssrc:A});let f=e.matchPrefix(n,"b=");return f.length&&(f=f[0].indexOf("b=TIAS:")===0?parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?1e3*parseInt(f[0].substring(5),10)*.95-16e3:void 0,r.forEach(m=>{m.maxBitrate=f})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const s=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=s.length>0,r.compound=s.length===0;const o=e.matchPrefix(n,"a=rtcp-mux");return r.mux=o.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const s=e.matchPrefix(n,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");return s.length>0?(r=s[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);const o=e.matchPrefix(n,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:r.fmt,maxMessageSize:s};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const A=a[0].substring(10).split(" ");return{port:parseInt(A[0],10),protocol:A[1],maxMessageSize:s}}},e.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let s;const o=r!==void 0?r:2;return s=n||e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(lJ);var uJ=lJ.exports,Em=tr(uJ),m0e=Lge({__proto__:null,default:Em},[uJ]);function PT(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new e(n),i=Em.parseCandidate(n.candidate),s=Object.assign(r,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,Tf(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function DL(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||Tf(t,"icecandidate",e=>{if(e.candidate){const n=Em.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function kT(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const A=Em.splitSections(a.sdp);return A.shift(),A.some(u=>{const d=Em.parseMLine(u);return d&&d.kind==="application"&&d.protocol.indexOf("SCTP")!==-1})},r=function(a){const A=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(A===null||A.length<2)return-1;const u=parseInt(A[1],10);return u!=u?-1:u},i=function(a){let A=65536;return e.browser==="firefox"&&(A=e.version<57?a===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),A},s=function(a,A){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);const d=Em.matchPrefix(a.sdp,"a=max-message-size:");return d.length>0?u=parseInt(d[0].substr(19),10):e.browser==="firefox"&&A!==-1&&(u=2147483637),u},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:a}=this.getConfiguration();a==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const a=r(arguments[0]),A=i(a),u=s(arguments[0],a);let d;d=A===0&&u===0?Number.POSITIVE_INFINITY:A===0||u===0?Math.max(A,u):Math.min(A,u);const f={};Object.defineProperty(f,"maxMessageSize",{get:()=>d}),this._sctp=f}return o.apply(this,arguments)}}function xT(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const s=r.send;r.send=function(){const o=arguments[0],a=o.length||o.size||o.byteLength;if(r.readyState==="open"&&i.sctp&&a>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},Tf(t,"datachannel",r=>(e(r.channel,r.target),r))}function BL(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;const o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function LL(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(s=>is(s).call(s)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function MT(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ye.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ye.resolve())})}function FT(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var g0e=Object.freeze({__proto__:null,removeExtmapAllowMixed:LL,shimAddIceCandidateNullOrEmpty:MT,shimConnectionState:BL,shimMaxMessageSize:kT,shimParameterlessSetLocalDescription:FT,shimRTCIceCandidate:PT,shimRTCIceCandidateRelayProtocol:DL,shimSendThrowTypeError:xT});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=H7,r=function(s){const o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;const{navigator:a}=s;if(a.mozGetUserMedia)o.browser="firefox",o.version=iC(a.userAgent,/Firefox\/(\d+)\./,1);else if(a.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=iC(a.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!a.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=iC(a.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o}(t),i={browserDetails:r,commonShim:g0e,extractVersion:iC,disableLog:hve,disableWarnings:fve,sdp:m0e};switch(r.browser){case"chrome":if(!BH||!RL||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=BH,MT(t,r),FT(t),PX(t,r),kX(t),RL(t,r),xX(t),HX(t,r),MX(t),FX(t),VX(t),jX(t,r),PT(t),DL(t),BL(t),kT(t,r),xT(t),LL(t,r);break;case"firefox":if(!LH||!OL||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=LH,MT(t,r),FT(t),KX(t,r),OL(t,r),GX(t),qX(t),WX(t),zX(t),YX(t),XX(t),JX(t),$X(t),ZX(t),PT(t),BL(t),kT(t,r),xT(t);break;case"safari":if(!UH||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=UH,MT(t,r),FT(t),sJ(t),aJ(t),nJ(t),eJ(t),tJ(t),oJ(t),rJ(t),cJ(t),PT(t),DL(t),kT(t,r),xT(t),LL(t,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var _0e=pc("Array").keys,E0e=WA,v0e=ki,y0e=Is,w0e=_0e,lN=Array.prototype,C0e={DOMTokenList:!0,NodeList:!0},T0e=function(t){var e=t.keys;return t===lN||y0e(lN,t)&&e===lN.keys||v0e(C0e,E0e(t))?w0e:e},Mo=tr(T0e),xH=Cg,S0e=TypeError,b0e=gb,I0e=fc,R0e=Md,Rb=function(t,e,n){var r=b0e(e);r in t?I0e.f(t,r,R0e(0,n)):t[r]=n},MH=VP,O0e=nu,N0e=Rb,D0e=Array,B0e=Math.max,sk=function(t,e,n){for(var r=O0e(t),i=MH(e,r),s=MH(n===void 0?r:n,r),o=D0e(B0e(s-i,0)),a=0;i<s;i++,a++)N0e(o,a,t[i]);return o.length=a,o},FH=sk,L0e=Math.floor,UL=function(t,e){var n=t.length,r=L0e(n/2);return n<8?U0e(t,e):P0e(t,UL(FH(t,0,r),e),UL(FH(t,r),e),e)},U0e=function(t,e){for(var n,r,i=t.length,s=1;s<i;){for(r=s,n=t[s];r&&e(t[r-1],n)>0;)t[r]=t[--r];r!==s++&&(t[r]=n)}return t},P0e=function(t,e,n,r){for(var i=e.length,s=n.length,o=0,a=0;o<i||a<s;)t[o+a]=o<i&&a<s?r(e[o],n[a])<=0?e[o++]:n[a++]:o<i?e[o++]:n[a++];return t},dJ=UL,VH=Cf.match(/firefox\/(\d+)/i),k0e=!!VH&&+VH[1],x0e=/MSIE|Trident/.test(Cf),QH=Cf.match(/AppleWebKit\/(\d+)\./),M0e=!!QH&&+QH[1],F0e=nn,hJ=mr,V0e=hc,Q0e=GA,HH=nu,H0e=function(t,e){if(!delete t[e])throw S0e("Cannot delete property "+xH(e)+" of "+xH(t))},jH=ba,ok=Cr,j0e=dJ,K0e=_b,KH=k0e,G0e=x0e,GH=hf,WH=M0e,nd=[],zH=hJ(nd.sort),W0e=hJ(nd.push),z0e=ok(function(){nd.sort(void 0)}),q0e=ok(function(){nd.sort(null)}),Y0e=K0e("sort"),qH=!ok(function(){if(GH)return GH<70;if(!(KH&&KH>3)){if(G0e)return!0;if(WH)return WH<603;var t,e,n,r,i="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)nd.push({k:e+r,v:n})}for(nd.sort(function(s,o){return o.v-s.v}),r=0;r<nd.length;r++)e=nd[r].k.charAt(0),i.charAt(i.length-1)!==e&&(i+=e);return i!=="DGBEFHACIJK"}});F0e({target:"Array",proto:!0,forced:z0e||!q0e||!Y0e||!qH},{sort:function(t){t!==void 0&&V0e(t);var e=Q0e(this);if(qH)return t===void 0?zH(e):zH(e,t);var n,r,i=[],s=HH(e);for(r=0;r<s;r++)r in e&&W0e(i,e[r]);for(j0e(i,function(o){return function(a,A){return A===void 0?-1:a===void 0?1:o!==void 0?+o(a,A)||0:jH(a)>jH(A)?1:-1}}(t)),n=HH(i),r=0;r<n;)e[r]=i[r++];for(;r<s;)H0e(e,r++);return e}});var uN,dN,X0e=pc("Array").sort,J0e=Is,$0e=X0e,hN=Array.prototype,Z0e=function(t){var e=t.sort;return t===hN||J0e(hN,t)&&e===hN.sort?$0e:e},yy=tr(Z0e),PL={exports:{}};uN=PL,dN=PL.exports,function(t,e){var n="function",r="undefined",i="object",s="string",o="major",a="model",A="name",u="type",d="vendor",f="version",m="architecture",g="console",v="mobile",y="tablet",w="smarttv",b="wearable",I="embedded",B="Amazon",M="Apple",H="ASUS",K="BlackBerry",Q="Browser",F="Chrome",k="Firefox",G="Google",$="Huawei",ne="LG",q="Microsoft",qe="Motorola",je="Opera",de="Samsung",J="Sharp",Y="Sony",Z="Xiaomi",P="Zebra",C="Facebook",D="Chromium OS",U="Mac OS",ee=function(Jt){for(var Xt={},dt=0;dt<Jt.length;dt++)Xt[Jt[dt].toUpperCase()]=Jt[dt];return Xt},Ee=function(Jt,Xt){return typeof Jt===s&&Re(Xt).indexOf(Re(Jt))!==-1},Re=function(Jt){return Jt.toLowerCase()},lt=function(Jt,Xt){if(typeof Jt===s)return Jt=Jt.replace(/^\s\s*/,""),typeof Xt===r?Jt:Jt.substring(0,350)},St=function(Jt,Xt){for(var dt,Ar,yi,Pt,st,Sr,br=0;br<Xt.length&&!st;){var ei=Xt[br],Ks=Xt[br+1];for(dt=Ar=0;dt<ei.length&&!st&&ei[dt];)if(st=ei[dt++].exec(Jt))for(yi=0;yi<Ks.length;yi++)Sr=st[++Ar],typeof(Pt=Ks[yi])===i&&Pt.length>0?Pt.length===2?typeof Pt[1]==n?this[Pt[0]]=Pt[1].call(this,Sr):this[Pt[0]]=Pt[1]:Pt.length===3?typeof Pt[1]!==n||Pt[1].exec&&Pt[1].test?this[Pt[0]]=Sr?Sr.replace(Pt[1],Pt[2]):e:this[Pt[0]]=Sr?Pt[1].call(this,Sr,Pt[2]):e:Pt.length===4&&(this[Pt[0]]=Sr?Pt[3].call(this,Sr.replace(Pt[1],Pt[2])):e):this[Pt]=Sr||e;br+=2}},Tr=function(Jt,Xt){for(var dt in Xt)if(typeof Xt[dt]===i&&Xt[dt].length>0){for(var Ar=0;Ar<Xt[dt].length;Ar++)if(Ee(Xt[dt][Ar],Jt))return dt==="?"?e:dt}else if(Ee(Xt[dt],Jt))return dt==="?"?e:dt;return Jt},cs={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},As={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[A,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[A,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[A,f],[/opios[\/ ]+([\w\.]+)/i],[f,[A,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[f,[A,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[A,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[A,"UC"+Q]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[f,[A,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[f,[A,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[A,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[A,"IE"]],[/yabrowser\/([\w\.]+)/i],[f,[A,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[A,/(.+)/,"$1 Secure "+Q],f],[/\bfocus\/([\w\.]+)/i],[f,[A,k+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[A,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[A,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[A,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[A,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[A,"MIUI "+Q]],[/fxios\/([-\w\.]+)/i],[f,[A,k]],[/\bqihu|(qi?ho?o?|360)browser/i],[[A,"360 "+Q]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[A,/(.+)/,"$1 "+Q],f],[/(comodo_dragon)\/([\w\.]+)/i],[[A,/_/g," "],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[A,f],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[A],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[A,C],f],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[A,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[A,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[A,F+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[A,F+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[A,"Android "+Q]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[A,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[A,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,A],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[A,[f,Tr,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[A,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[A,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[A,k+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[A,f],[/(cobalt)\/([\w\.]+)/i],[A,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,Re]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",Re]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,Re]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a,[d,de],[u,y]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[a,[d,de],[u,v]],[/\((ip(?:hone|od)[\w ]*);/i],[a,[d,M],[u,v]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a,[d,M],[u,y]],[/(macintosh);/i],[a,[d,M]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a,[d,J],[u,v]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a,[d,$],[u,y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a,[d,$],[u,v]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[a,/_/g," "],[d,Z],[u,v]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a,/_/g," "],[d,Z],[u,y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a,[d,"OPPO"],[u,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a,[d,"Vivo"],[u,v]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[a,[d,"Realme"],[u,v]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a,[d,qe],[u,v]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a,[d,qe],[u,y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a,[d,ne],[u,y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a,[d,ne],[u,v]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a,[d,"Lenovo"],[u,y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a,/_/g," "],[d,"Nokia"],[u,v]],[/(pixel c)\b/i],[a,[d,G],[u,y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a,[d,G],[u,v]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a,[d,Y],[u,v]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a,"Xperia Tablet"],[d,Y],[u,y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a,[d,"OnePlus"],[u,v]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a,[d,B],[u,y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a,/(.+)/g,"Fire Phone $1"],[d,B],[u,v]],[/(playbook);[-\w\),; ]+(rim)/i],[a,d,[u,y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a,[d,K],[u,v]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a,[d,H],[u,y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a,[d,H],[u,v]],[/(nexus 9)/i],[a,[d,"HTC"],[u,y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[a,/_/g," "],[u,v]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a,[d,"Acer"],[u,y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a,[d,"Meizu"],[u,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,a,[u,v]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,a,[u,y]],[/(surface duo)/i],[a,[d,q],[u,y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a,[d,"Fairphone"],[u,v]],[/(u304aa)/i],[a,[d,"AT&T"],[u,v]],[/\bsie-(\w*)/i],[a,[d,"Siemens"],[u,v]],[/\b(rct\w+) b/i],[a,[d,"RCA"],[u,y]],[/\b(venue[\d ]{2,7}) b/i],[a,[d,"Dell"],[u,y]],[/\b(q(?:mv|ta)\w+) b/i],[a,[d,"Verizon"],[u,y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a,[d,"Barnes & Noble"],[u,y]],[/\b(tm\d{3}\w+) b/i],[a,[d,"NuVision"],[u,y]],[/\b(k88) b/i],[a,[d,"ZTE"],[u,y]],[/\b(nx\d{3}j) b/i],[a,[d,"ZTE"],[u,v]],[/\b(gen\d{3}) b.+49h/i],[a,[d,"Swiss"],[u,v]],[/\b(zur\d{3}) b/i],[a,[d,"Swiss"],[u,y]],[/\b((zeki)?tb.*\b) b/i],[a,[d,"Zeki"],[u,y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],a,[u,y]],[/\b(ns-?\w{0,9}) b/i],[a,[d,"Insignia"],[u,y]],[/\b((nxa|next)-?\w{0,9}) b/i],[a,[d,"NextBook"],[u,y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],a,[u,v]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],a,[u,v]],[/\b(ph-1) /i],[a,[d,"Essential"],[u,v]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a,[d,"Envizen"],[u,y]],[/\b(trio[-\w\. ]+) b/i],[a,[d,"MachSpeed"],[u,y]],[/\btu_(1491) b/i],[a,[d,"Rotor"],[u,y]],[/(shield[\w ]+) b/i],[a,[d,"Nvidia"],[u,y]],[/(sprint) (\w+)/i],[d,a,[u,v]],[/(kin\.[onetw]{3})/i],[[a,/\./g," "],[d,q],[u,v]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a,[d,P],[u,y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a,[d,P],[u,v]],[/smart-tv.+(samsung)/i],[d,[u,w]],[/hbbtv.+maple;(\d+)/i],[[a,/^/,"SmartTV"],[d,de],[u,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,ne],[u,w]],[/(apple) ?tv/i],[d,[a,M+" TV"],[u,w]],[/crkey/i],[[a,F+"cast"],[d,G],[u,w]],[/droid.+aft(\w)( bui|\))/i],[a,[d,B],[u,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a,[d,J],[u,w]],[/(bravia[\w ]+)( bui|\))/i],[a,[d,Y],[u,w]],[/(mitv-\w{5}) bui/i],[a,[d,Z],[u,w]],[/Hbbtv.*(technisat) (.*);/i],[d,a,[u,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[d,lt],[a,lt],[u,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,a,[u,g]],[/droid.+; (shield) bui/i],[a,[d,"Nvidia"],[u,g]],[/(playstation [345portablevi]+)/i],[a,[d,Y],[u,g]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a,[d,q],[u,g]],[/((pebble))app/i],[d,a,[u,b]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a,[d,M],[u,b]],[/droid.+; (glass) \d/i],[a,[d,G],[u,b]],[/droid.+; (wt63?0{2,3})\)/i],[a,[d,P],[u,b]],[/(quest( 2| pro)?)/i],[a,[d,C],[u,b]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[u,I]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[a,[u,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a,[u,y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,v]],[/(android[-\w\. ]{0,9});.+buil/i],[a,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[A,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[A,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[A,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,A]],os:[[/microsoft (windows) (vista|xp)/i],[A,f],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[A,[f,Tr,cs]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[A,"Windows"],[f,Tr,cs]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[A,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[A,U],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,A],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[A,f],[/\(bb(10);/i],[f,[A,K]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[A,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[A,k+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[A,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[A,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[A,F+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[A,D],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[A,f],[/(sunos) ?([\w\.\d]*)/i],[[A,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[A,f]]},gr=function(Jt,Xt){if(typeof Jt===i&&(Xt=Jt,Jt=e),!(this instanceof gr))return new gr(Jt,Xt).getResult();var dt=typeof t!==r&&t.navigator?t.navigator:e,Ar=Jt||(dt&&dt.userAgent?dt.userAgent:""),yi=dt&&dt.userAgentData?dt.userAgentData:e,Pt=Xt?function(st,Sr){var br={};for(var ei in st)Sr[ei]&&Sr[ei].length%2==0?br[ei]=Sr[ei].concat(st[ei]):br[ei]=st[ei];return br}(As,Xt):As;return this.getBrowser=function(){var st={};return st[A]=e,st[f]=e,St.call(st,Ar,Pt.browser),st[o]=function(Sr){return typeof Sr===s?Sr.replace(/[^\d\.]/g,"").split(".")[0]:e}(st[f]),dt&&dt.brave&&typeof dt.brave.isBrave==n&&(st[A]="Brave"),st},this.getCPU=function(){var st={};return st[m]=e,St.call(st,Ar,Pt.cpu),st},this.getDevice=function(){var st={};return st[d]=e,st[a]=e,st[u]=e,St.call(st,Ar,Pt.device),!st[u]&&yi&&yi.mobile&&(st[u]=v),st[a]=="Macintosh"&&dt&&typeof dt.standalone!==r&&dt.maxTouchPoints&&dt.maxTouchPoints>2&&(st[a]="iPad",st[u]=y),st},this.getEngine=function(){var st={};return st[A]=e,st[f]=e,St.call(st,Ar,Pt.engine),st},this.getOS=function(){var st={};return st[A]=e,st[f]=e,St.call(st,Ar,Pt.os),!st[A]&&yi&&yi.platform!="Unknown"&&(st[A]=yi.platform.replace(/chrome os/i,D).replace(/macos/i,U)),st},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ar},this.setUA=function(st){return Ar=typeof st===s&&st.length>350?lt(st,350):st,this},this.setUA(Ar),this};gr.VERSION="0.7.34",gr.BROWSER=ee([A,f,o]),gr.CPU=ee([m]),gr.DEVICE=ee([a,d,u,g,v,w,y,b,I]),gr.ENGINE=gr.OS=ee([A,f]),uN.exports&&(dN=uN.exports=gr),dN.UAParser=gr;var xi=typeof t!==r&&(t.jQuery||t.Zepto);if(xi&&!xi.ua){var vi=new gr;xi.ua=vi.getResult(),xi.ua.get=function(){return vi.getUA()},xi.ua.set=function(Jt){vi.setUA(Jt);var Xt=vi.getResult();for(var dt in Xt)xi.ua[dt]=Xt[dt]}}}(typeof window=="object"?window:gm);var eSe=tr(PL.exports),tSe=WA,nSe=ki,rSe=vg,iSe=Sf,sSe=cr("iterator"),oSe=Object,aSe=function(t){if(rSe(t))return!1;var e=oSe(t);return e[sSe]!==void 0||"@@iterator"in e||nSe(iSe,tSe(e))},cSe=tr(aSe),fN=gi;nn({global:!0,forced:fN.globalThis!==fN},{globalThis:fN});var YH=tr(gi);function fJ(t,e){return function(){return t.apply(e,arguments)}}const{toString:ASe}=Object.prototype,{getPrototypeOf:ak}=Object,eS=(pN=Object.create(null),t=>{const e=ASe.call(t);return pN[e]||(pN[e]=e.slice(8,-1).toLowerCase())});var pN;const qA=t=>(t=t.toLowerCase(),e=>eS(e)===t),Ob=t=>e=>typeof e===t,{isArray:Hp}=Array,rE=Ob("undefined"),XH=qA("ArrayBuffer"),lSe=Ob("string"),Ma=Ob("function"),JH=Ob("number"),uC=t=>t!==null&&typeof t=="object",dC=t=>{if(eS(t)!=="object")return!1;const e=ak(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||cSe(t))},uSe=qA("Date"),dSe=qA("File"),hSe=qA("Blob"),fSe=qA("FileList"),pSe=qA("URLSearchParams");function iE(t,e){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Hp(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const s=i?Object.getOwnPropertyNames(t):Object.keys(t),o=s.length;let a;for(n=0;n<o;n++)a=s[n],e.call(null,t[a],a,t)}}function $H(t,e){e=e.toLowerCase();const n=Object.keys(t);let r,i=n.length;for(;i-- >0;)if(r=n[i],e===r.toLowerCase())return r;return null}const pJ=YH!==void 0?YH:typeof self<"u"?self:typeof window<"u"?window:global,ZH=t=>!rE(t)&&t!==pJ,mSe=(mN=typeof Uint8Array<"u"&&ak(Uint8Array),t=>mN&&t instanceof mN);var mN;const gSe=qA("HTMLFormElement"),ej=(t=>{let{hasOwnProperty:e}=t;return(n,r)=>e.call(n,r)})(Object.prototype),_Se=qA("RegExp"),tj=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};iE(n,(i,s)=>{let o;(o=e(i,s,t))!==!1&&(r[s]=o||i)}),Object.defineProperties(t,r)},gN="abcdefghijklmnopqrstuvwxyz",nj="0123456789",rj={DIGIT:nj,ALPHA:gN,ALPHA_DIGIT:gN+gN.toUpperCase()+nj},ESe=qA("AsyncFunction");var Ie={isArray:Hp,isArrayBuffer:XH,isBuffer:function(t){return t!==null&&!rE(t)&&t.constructor!==null&&!rE(t.constructor)&&Ma(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Ma(t.append)&&((e=eS(t))==="formdata"||e==="object"&&Ma(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&XH(t.buffer),e},isString:lSe,isNumber:JH,isBoolean:t=>t===!0||t===!1,isObject:uC,isPlainObject:dC,isUndefined:rE,isDate:uSe,isFile:dSe,isBlob:hSe,isRegExp:_Se,isFunction:Ma,isStream:t=>uC(t)&&Ma(t.pipe),isURLSearchParams:pSe,isTypedArray:mSe,isFileList:fSe,forEach:iE,merge:function t(){const{caseless:e}=ZH(this)&&this||{},n={},r=(i,s)=>{const o=e&&$H(n,s)||s;dC(n[o])&&dC(i)?n[o]=t(n[o],i):dC(i)?n[o]=t({},i):Hp(i)?n[o]=i.slice():n[o]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&iE(arguments[i],r);return n},extend:function(t,e,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return iE(e,(i,s)=>{n&&Ma(i)?t[s]=fJ(i,n):t[s]=i},{allOwnKeys:r}),t},trim:t=>is(t)?is(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,r)=>{let i,s,o;const a={};if(e=e||{},t==null)return e;do{for(i=Object.getOwnPropertyNames(t),s=i.length;s-- >0;)o=i[s],r&&!r(o,t,e)||a[o]||(e[o]=t[o],a[o]=!0);t=n!==!1&&ak(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:eS,kindOfTest:qA,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},toArray:t=>{if(!t)return null;if(Hp(t))return t;let e=t.length;if(!JH(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const i=r.value;e.call(t,i[0],i[1])}},matchAll:(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},isHTMLForm:gSe,hasOwnProperty:ej,hasOwnProp:ej,reduceDescriptors:tj,freezeMethods:t=>{tj(t,(e,n)=>{if(Ma(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];Ma(r)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},r=i=>{i.forEach(s=>{n[s]=!0})};return Hp(t)?r(t):r(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(t,e)=>(t=+t,Number.isFinite(t)?t:e),findKey:$H,global:pJ,isContextDefined:ZH,ALPHABET:rj,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:rj.ALPHA_DIGIT,n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n},isSpecCompliantForm:function(t){return!!(t&&Ma(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(r,i)=>{if(uC(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const s=Hp(r)?[]:{};return iE(r,(o,a)=>{const A=n(o,i+1);!rE(A)&&(s[a]=A)}),e[i]=void 0,s}}return r};return n(t,0)},isAsyncFn:ESe,isThenable:t=>t&&(uC(t)||Ma(t))&&Ma(t.then)&&Ma(t.catch)};function In(t,e,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}Ie.inherits(In,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ie.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const ij=In.prototype,sj={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{sj[t]={value:t}}),Object.defineProperties(In,sj),Object.defineProperty(ij,"isAxiosError",{value:!0}),In.from=(t,e,n,r,i,s)=>{const o=Object.create(ij);return Ie.toFlatObject(t,o,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),In.call(o,t.message,e,n,r,i),o.cause=t,o.name=t.name,s&&Object.assign(o,s),o};function _N(t){return Ie.isPlainObject(t)||Ie.isArray(t)}function mJ(t){return Ie.endsWith(t,"[]")?t.slice(0,-2):t}function oj(t,e,n){return t?t.concat(e).map(function(r,i){return r=mJ(r),!n&&i?"["+r+"]":r}).join(n?".":""):e}const vSe=Ie.toFlatObject(Ie,{},null,function(t){return/^is[A-Z]/.test(t)});function tS(t,e,n){if(!Ie.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const r=(n=Ie.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!Ie.isUndefined(g[m])})).metaTokens,i=n.visitor||u,s=n.dots,o=n.indexes,a=(n.Blob||typeof Blob<"u"&&Blob)&&Ie.isSpecCompliantForm(e);if(!Ie.isFunction(i))throw new TypeError("visitor must be a function");function A(m){if(m===null)return"";if(Ie.isDate(m))return m.toISOString();if(!a&&Ie.isBlob(m))throw new In("Blob is not supported. Use a Buffer instead.");return Ie.isArrayBuffer(m)||Ie.isTypedArray(m)?a&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function u(m,g,v){let y=m;if(m&&!v&&typeof m=="object"){if(Ie.endsWith(g,"{}"))g=r?g:g.slice(0,-2),m=JSON.stringify(m);else if(Ie.isArray(m)&&function(w){return Ie.isArray(w)&&!w.some(_N)}(m)||(Ie.isFileList(m)||Ie.endsWith(g,"[]"))&&(y=Ie.toArray(m)))return g=mJ(g),y.forEach(function(w,b){!Ie.isUndefined(w)&&w!==null&&e.append(o===!0?oj([g],b,s):o===null?g:g+"[]",A(w))}),!1}return!!_N(m)||(e.append(oj(v,g,s),A(m)),!1)}const d=[],f=Object.assign(vSe,{defaultVisitor:u,convertValue:A,isVisitable:_N});if(!Ie.isObject(t))throw new TypeError("data must be an object");return function m(g,v){if(!Ie.isUndefined(g)){if(d.indexOf(g)!==-1)throw Error("Circular reference detected in "+v.join("."));d.push(g),Ie.forEach(g,function(y,w){(!(Ie.isUndefined(y)||y===null)&&i.call(e,y,Ie.isString(w)?is(w).call(w):w,v,f))===!0&&m(y,v?v.concat(w):[w])}),d.pop()}}(t),e}function aj(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function ck(t,e){this._pairs=[],t&&tS(t,this,e)}const cj=ck.prototype;function ySe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function gJ(t,e,n){if(!e)return t;const r=n&&n.encode||ySe,i=n&&n.serialize;let s;if(s=i?i(e,n):Ie.isURLSearchParams(e)?e.toString():new ck(e,n).toString(r),s){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}cj.append=function(t,e){this._pairs.push([t,e])},cj.toString=function(t){const e=t?function(n){return t.call(this,n,aj)}:aj;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var Aj=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){Ie.forEach(this.handlers,function(e){e!==null&&t(e)})}},_J={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},EJ={exports:{}},wSe=nn,CSe=Sa,lj=fc.f;wSe({target:"Object",stat:!0,forced:Object.defineProperty!==lj,sham:!CSe},{defineProperty:lj});var vJ=Xc.Object,TSe=EJ.exports=function(t,e,n){return vJ.defineProperty(t,e,n)};vJ.defineProperty.sham&&(TSe.sham=!0);var yJ=tr(EJ.exports),SSe=KA,wy=Array.isArray||function(t){return SSe(t)=="Array"},bSe=TypeError,uj=wy,ISe=Sb,RSe=qo,OSe=cr("species"),dj=Array,NSe=function(t){var e;return uj(t)&&(e=t.constructor,(ISe(e)&&(e===dj||uj(e.prototype))||RSe(e)&&(e=e[OSe])===null)&&(e=void 0)),e===void 0?dj:e},wJ=function(t,e){return new(NSe(t))(e===0?0:e)},DSe=Cr,BSe=hf,LSe=cr("species"),CJ=function(t){return BSe>=51||!DSe(function(){var e=[];return(e.constructor={})[LSe]=function(){return{foo:1}},e[t](Boolean).foo!==1})},USe=nn,PSe=Cr,kSe=wy,xSe=qo,MSe=GA,FSe=nu,hj=function(t){if(t>9007199254740991)throw bSe("Maximum allowed index exceeded");return t},fj=Rb,VSe=wJ,QSe=CJ,HSe=hf,TJ=cr("isConcatSpreadable"),jSe=HSe>=51||!PSe(function(){var t=[];return t[TJ]=!1,t.concat()[0]!==t}),KSe=function(t){if(!xSe(t))return!1;var e=t[TJ];return e!==void 0?!!e:kSe(t)};USe({target:"Array",proto:!0,forced:!jSe||!QSe("concat")},{concat:function(t){var e,n,r,i,s,o=MSe(this),a=VSe(o,0),A=0;for(e=-1,r=arguments.length;e<r;e++)if(KSe(s=e===-1?o:arguments[e]))for(i=FSe(s),hj(A+i),n=0;n<i;n++,A++)n in s&&fj(a,A,s[n]);else hj(A+1),fj(a,A++,s);return a.length=A,a}});var SJ={},GSe=KA,WSe=Fd,pj=vb.f,zSe=sk,mj=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];SJ.f=function(t){return mj&&GSe(t)=="Window"?function(e){try{return pj(e)}catch{return zSe(mj)}}(t):pj(WSe(t))};var bg={},qSe=cr;bg.f=qSe;var gj=Xc,YSe=ki,XSe=bg,JSe=fc.f,Ai=function(t){var e=gj.Symbol||(gj.Symbol={});YSe(e,t)||JSe(e,t,{value:XSe.f(t)})},$Se=Ei,ZSe=wo,ebe=cr,tbe=Hd,bJ=function(){var t=ZSe("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,r=ebe("toPrimitive");e&&!e[r]&&tbe(e,r,function(i){return $Se(n,this)},{})},nbe=Vd,rbe=pb,ibe=GA,sbe=nu,obe=wJ,_j=mr([].push),abe=function(t){var e=t==1,n=t==2,r=t==3,i=t==4,s=t==6,o=t==7,a=t==5||s;return function(A,u,d,f){for(var m,g,v=ibe(A),y=rbe(v),w=nbe(u,d),b=sbe(y),I=0,B=f||obe,M=e?B(A,b):n||o?B(A,0):void 0;b>I;I++)if((a||I in y)&&(g=w(m=y[I],I,v),t))if(e)M[I]=g;else if(g)switch(t){case 3:return!0;case 5:return m;case 6:return I;case 2:_j(M,m)}else switch(t){case 4:return!1;case 7:_j(M,m)}return s?-1:r||i?i:M}},IJ={forEach:abe(0)},hC=nn,Ak=gi,lk=Ei,cbe=mr,vm=Sa,mp=wg,Abe=Cr,ws=ki,lbe=Is,kL=so,Nb=Fd,uk=gb,ube=ba,xL=Md,gv=gy,RJ=wb,dbe=vb,OJ=SJ,hbe=my,NJ=dy,DJ=fc,fbe=WP,BJ=fb,Ej=Hd,pbe=Tb,dk=Tg,LJ=yb,vj=xP,mbe=cr,gbe=bg,_be=Ai,Ebe=bJ,vbe=jd,UJ=bf,Db=IJ.forEach,Vo=Eb("hidden"),nS="Symbol",_v="prototype",ybe=UJ.set,yj=UJ.getterFor(nS),Kc=Object[_v],Zp=Ak.Symbol,VT=Zp&&Zp[_v],wbe=Ak.TypeError,EN=Ak.QObject,PJ=NJ.f,Bh=DJ.f,kJ=OJ.f,Cbe=BJ.f,xJ=cbe([].push),Jl=dk("symbols"),Cy=dk("op-symbols"),Tbe=dk("wks"),vN=!EN||!EN[_v]||!EN[_v].findChild,ML=vm&&Abe(function(){return gv(Bh({},"a",{get:function(){return Bh(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var r=PJ(Kc,e);r&&delete Kc[e],Bh(t,e,n),r&&t!==Kc&&Bh(Kc,e,r)}:Bh,yN=function(t,e){var n=Jl[t]=gv(VT);return ybe(n,{type:nS,tag:t,description:e}),vm||(n.description=e),n},rS=function(t,e,n){t===Kc&&rS(Cy,e,n),kL(t);var r=uk(e);return kL(n),ws(Jl,r)?(n.enumerable?(ws(t,Vo)&&t[Vo][r]&&(t[Vo][r]=!1),n=gv(n,{enumerable:xL(0,!1)})):(ws(t,Vo)||Bh(t,Vo,xL(1,{})),t[Vo][r]=!0),ML(t,r,n)):Bh(t,r,n)},wN=function(t,e){kL(t);var n=Nb(e),r=RJ(n).concat(FJ(n));return Db(r,function(i){vm&&!lk(MJ,n,i)||rS(t,i,n[i])}),t},MJ=function(t){var e=uk(t),n=lk(Cbe,this,e);return!(this===Kc&&ws(Jl,e)&&!ws(Cy,e))&&(!(n||!ws(this,e)||!ws(Jl,e)||ws(this,Vo)&&this[Vo][e])||n)},wj=function(t,e){var n=Nb(t),r=uk(e);if(n!==Kc||!ws(Jl,r)||ws(Cy,r)){var i=PJ(n,r);return!i||!ws(Jl,r)||ws(n,Vo)&&n[Vo][r]||(i.enumerable=!0),i}},Cj=function(t){var e=kJ(Nb(t)),n=[];return Db(e,function(r){ws(Jl,r)||ws(LJ,r)||xJ(n,r)}),n},FJ=function(t){var e=t===Kc,n=kJ(e?Cy:Nb(t)),r=[];return Db(n,function(i){!ws(Jl,i)||e&&!ws(Kc,i)||xJ(r,Jl[i])}),r};mp||(Ej(VT=(Zp=function(){if(lbe(VT,this))throw wbe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?ube(arguments[0]):void 0,e=vj(t),n=function(r){this===Kc&&lk(n,Cy,r),ws(this,Vo)&&ws(this[Vo],e)&&(this[Vo][e]=!1),ML(this,e,xL(1,r))};return vm&&vN&&ML(Kc,e,{configurable:!0,set:n}),yN(e,t)})[_v],"toString",function(){return yj(this).tag}),Ej(Zp,"withoutSetter",function(t){return yN(vj(t),t)}),BJ.f=MJ,DJ.f=rS,fbe.f=wN,NJ.f=wj,dbe.f=OJ.f=Cj,hbe.f=FJ,gbe.f=function(t){return yN(mbe(t),t)},vm&&pbe(VT,"description",{configurable:!0,get:function(){return yj(this).description}})),hC({global:!0,wrap:!0,forced:!mp,sham:!mp},{Symbol:Zp}),Db(RJ(Tbe),function(t){_be(t)}),hC({target:nS,stat:!0,forced:!mp},{useSetter:function(){vN=!0},useSimple:function(){vN=!1}}),hC({target:"Object",stat:!0,forced:!mp,sham:!vm},{create:function(t,e){return e===void 0?gv(t):wN(gv(t),e)},defineProperty:rS,defineProperties:wN,getOwnPropertyDescriptor:wj}),hC({target:"Object",stat:!0,forced:!mp},{getOwnPropertyNames:Cj}),Ebe(),vbe(Zp,nS),LJ[Vo]=!0;var VJ=wg&&!!Symbol.for&&!!Symbol.keyFor,Sbe=nn,bbe=wo,Ibe=ki,Rbe=ba,QJ=Tg,Obe=VJ,CN=QJ("string-to-symbol-registry"),Nbe=QJ("symbol-to-string-registry");Sbe({target:"Symbol",stat:!0,forced:!Obe},{for:function(t){var e=Rbe(t);if(Ibe(CN,e))return CN[e];var n=bbe("Symbol")(e);return CN[e]=n,Nbe[n]=e,n}});var Dbe=nn,Bbe=ki,Lbe=hy,Ube=Cg,Pbe=VJ,Tj=Tg("symbol-to-string-registry");Dbe({target:"Symbol",stat:!0,forced:!Pbe},{keyFor:function(t){if(!Lbe(t))throw TypeError(Ube(t)+" is not a symbol");if(Bbe(Tj,t))return Tj[t]}});var Sj=wy,kbe=_i,bj=KA,xbe=ba,Ij=mr([].push),Mbe=nn,HJ=wo,jJ=PP,Fbe=Ei,Ty=mr,KJ=Cr,Rj=_i,Oj=hy,GJ=ZP,Vbe=function(t){if(kbe(t))return t;if(Sj(t)){for(var e=t.length,n=[],r=0;r<e;r++){var i=t[r];typeof i=="string"?Ij(n,i):typeof i!="number"&&bj(i)!="Number"&&bj(i)!="String"||Ij(n,xbe(i))}var s=n.length,o=!0;return function(a,A){if(o)return o=!1,A;if(Sj(this))return A;for(var u=0;u<s;u++)if(n[u]===a)return A}}},Qbe=wg,Hbe=String,md=HJ("JSON","stringify"),fC=Ty(/./.exec),Nj=Ty("".charAt),jbe=Ty("".charCodeAt),Kbe=Ty("".replace),Gbe=Ty(1 .toString),Wbe=/[\uD800-\uDFFF]/g,Dj=/^[\uD800-\uDBFF]$/,Bj=/^[\uDC00-\uDFFF]$/,Lj=!Qbe||KJ(function(){var t=HJ("Symbol")();return md([t])!="[null]"||md({a:t})!="{}"||md(Object(t))!="{}"}),Uj=KJ(function(){return md("\uDF06\uD834")!=='"\\udf06\\ud834"'||md("\uDEAD")!=='"\\udead"'}),zbe=function(t,e){var n=GJ(arguments),r=Vbe(e);if(Rj(r)||t!==void 0&&!Oj(t))return n[1]=function(i,s){if(Rj(r)&&(s=Fbe(r,this,Hbe(i),s)),!Oj(s))return s},jJ(md,null,n)},qbe=function(t,e,n){var r=Nj(n,e-1),i=Nj(n,e+1);return fC(Dj,t)&&!fC(Bj,i)||fC(Bj,t)&&!fC(Dj,r)?"\\u"+Gbe(jbe(t,0),16):t};md&&Mbe({target:"JSON",stat:!0,forced:Lj||Uj},{stringify:function(t,e,n){var r=GJ(arguments),i=jJ(Lj?zbe:md,null,r);return Uj&&typeof i=="string"?Kbe(i,Wbe,qbe):i}});var Pj=my,Ybe=GA;nn({target:"Object",stat:!0,forced:!wg||Cr(function(){Pj.f(1)})},{getOwnPropertySymbols:function(t){var e=Pj.f;return e?e(Ybe(t)):[]}}),Ai("asyncIterator"),Ai("hasInstance"),Ai("isConcatSpreadable"),Ai("iterator"),Ai("match"),Ai("matchAll"),Ai("replace"),Ai("search"),Ai("species"),Ai("split");var Xbe=bJ;Ai("toPrimitive"),Xbe();var Jbe=wo,$be=jd;Ai("toStringTag"),$be(Jbe("Symbol"),"Symbol"),Ai("unscopables"),jd(gi.JSON,"JSON",!0);var Zbe=Xc.Symbol,eIe=cr,tIe=fc.f,kj=eIe("metadata"),xj=Function.prototype;xj[kj]===void 0&&tIe(xj,kj,{value:null}),Ai("dispose"),Ai("metadata");var nIe=Zbe;Ai("asyncDispose");var rIe=mr,hk=wo("Symbol"),iIe=hk.keyFor,sIe=rIe(hk.prototype.valueOf),WJ=hk.isRegisteredSymbol||function(t){try{return iIe(sIe(t))!==void 0}catch{return!1}};nn({target:"Symbol",stat:!0},{isRegisteredSymbol:WJ});for(var oIe=Tg,Mj=wo,aIe=mr,cIe=hy,AIe=cr,pC=Mj("Symbol"),Fj=pC.isWellKnownSymbol,zJ=Mj("Object","getOwnPropertyNames"),lIe=aIe(pC.prototype.valueOf),Vj=oIe("wks"),TN=0,Qj=zJ(pC),uIe=Qj.length;TN<uIe;TN++)try{var Hj=Qj[TN];cIe(pC[Hj])&&AIe(Hj)}catch{}var jj=function(t){if(Fj&&Fj(t))return!0;try{for(var e=lIe(t),n=0,r=zJ(Vj),i=r.length;n<i;n++)if(Vj[r[n]]==e)return!0}catch{}return!1};nn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:jj}),Ai("matcher"),Ai("observable"),nn({target:"Symbol",stat:!0},{isRegistered:WJ}),nn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:jj}),Ai("metadataKey"),Ai("patternMatch"),Ai("replaceAll");var em=tr(nIe),qJ=tr(bg.f("iterator"));function ME(t){return ME=typeof em=="function"&&typeof qJ=="symbol"?function(e){return typeof e}:function(e){return e&&typeof em=="function"&&e.constructor===em&&e!==em.prototype?"symbol":typeof e},ME(t)}var dIe=tr(bg.f("toPrimitive"));function hIe(t){var e=function(n,r){if(ME(n)!=="object"||n===null)return n;var i=n[dIe];if(i!==void 0){var s=i.call(n,r);if(ME(s)!=="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(t,"string");return ME(e)==="symbol"?e:String(e)}function N(t,e,n){return(e=hIe(e))in t?yJ(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var fIe=Cr,pIe=cr("iterator"),fk=!fIe(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return t.pathname="c%20d",e.forEach(function(i,s){e.delete("b"),r+=s+i}),n.delete("a",2),!t.toJSON||!n.has("a",1)||n.has("a",2)||!e.size&&!0||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[pIe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("http://x",void 0).host!=="x"}),mIe=Hd,SN=nn,Wm=gi,mC=Ei,FA=mr,tm=Sa,Kj=fk,Gj=Hd,gIe=Tb,_Ie=function(t,e,n){for(var r in e)n&&n.unsafe&&t[r]?t[r]=e[r]:mIe(t,r,e[r],n);return t},EIe=jd,vIe=qP,pk=bf,YJ=XP,bN=_i,yIe=ki,wIe=Vd,CIe=WA,TIe=so,XJ=qo,fo=ba,SIe=gy,Wj=Md,FL=zP,bIe=Cb,gp=bb,IIe=dJ,RIe=cr("iterator"),Ev="URLSearchParams",JJ=Ev+"Iterator",$J=pk.set,Ya=pk.getterFor(Ev),OIe=pk.getterFor(JJ),NIe=Object.getOwnPropertyDescriptor,mk=function(t){if(!tm)return Wm[t];var e=NIe(Wm,t);return e&&e.value},zj=mk("fetch"),iS=mk("Request"),FE=mk("Headers"),IN=iS&&iS.prototype,qj=FE&&FE.prototype,DIe=Wm.RegExp,BIe=Wm.TypeError,ZJ=Wm.decodeURIComponent,LIe=Wm.encodeURIComponent,UIe=FA("".charAt),Yj=FA([].join),Vh=FA([].push),VL=FA("".replace),PIe=FA([].shift),Xj=FA([].splice),Jj=FA("".split),kIe=FA("".slice),xIe=/\+/g,$j=Array(4),MIe=function(t){return $j[t-1]||($j[t-1]=DIe("((?:%[\\da-f]{2}){"+t+"})","gi"))},FIe=function(t){try{return ZJ(t)}catch{return t}},Zj=function(t){var e=VL(t,xIe," "),n=4;try{return ZJ(e)}catch{for(;n;)e=VL(e,MIe(n--),FIe);return e}},VIe=/[!'()~]|%20/g,QIe={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},HIe=function(t){return QIe[t]},e3=function(t){return VL(LIe(t),VIe,HIe)},RN=vIe(function(t,e){$J(this,{type:JJ,iterator:FL(Ya(t).entries),kind:e})},"Iterator",function(){var t=OIe(this),e=t.kind,n=t.iterator.next(),r=n.value;return n.done||(n.value=e==="keys"?r.key:e==="values"?r.value:[r.key,r.value]),n},!0),e$=function(t){this.entries=[],this.url=null,t!==void 0&&(XJ(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?UIe(t,0)==="?"?kIe(t,1):t:fo(t)))};e$.prototype={type:Ev,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,r,i,s,o,a,A=bIe(t);if(A)for(n=(e=FL(t,A)).next;!(r=mC(n,e)).done;){if(s=(i=FL(TIe(r.value))).next,(o=mC(s,i)).done||(a=mC(s,i)).done||!mC(s,i).done)throw BIe("Expected sequence with length 2");Vh(this.entries,{key:fo(o.value),value:fo(a.value)})}else for(var u in t)yIe(t,u)&&Vh(this.entries,{key:u,value:fo(t[u])})},parseQuery:function(t){if(t)for(var e,n,r=Jj(t,"&"),i=0;i<r.length;)(e=r[i++]).length&&(n=Jj(e,"="),Vh(this.entries,{key:Zj(PIe(n)),value:Zj(Yj(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],r=0;r<e.length;)t=e[r++],Vh(n,e3(t.key)+"="+e3(t.value));return Yj(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var sS=function(){YJ(this,jp);var t=$J(this,new e$(arguments.length>0?arguments[0]:void 0));tm||(this.size=t.entries.length)},jp=sS.prototype;if(_Ie(jp,{append:function(t,e){var n=Ya(this);gp(arguments.length,2),Vh(n.entries,{key:fo(t),value:fo(e)}),tm||this.length++,n.updateURL()},delete:function(t){for(var e=Ya(this),n=gp(arguments.length,1),r=e.entries,i=fo(t),s=n<2?void 0:arguments[1],o=s===void 0?s:fo(s),a=0;a<r.length;){var A=r[a];if(A.key!==i||o!==void 0&&A.value!==o)a++;else if(Xj(r,a,1),o!==void 0)break}tm||(this.size=r.length),e.updateURL()},get:function(t){var e=Ya(this).entries;gp(arguments.length,1);for(var n=fo(t),r=0;r<e.length;r++)if(e[r].key===n)return e[r].value;return null},getAll:function(t){var e=Ya(this).entries;gp(arguments.length,1);for(var n=fo(t),r=[],i=0;i<e.length;i++)e[i].key===n&&Vh(r,e[i].value);return r},has:function(t){for(var e=Ya(this).entries,n=gp(arguments.length,1),r=fo(t),i=n<2?void 0:arguments[1],s=i===void 0?i:fo(i),o=0;o<e.length;){var a=e[o++];if(a.key===r&&(s===void 0||a.value===s))return!0}return!1},set:function(t,e){var n=Ya(this);gp(arguments.length,1);for(var r,i=n.entries,s=!1,o=fo(t),a=fo(e),A=0;A<i.length;A++)(r=i[A]).key===o&&(s?Xj(i,A--,1):(s=!0,r.value=a));s||Vh(i,{key:o,value:a}),tm||(this.size=i.length),n.updateURL()},sort:function(){var t=Ya(this);IIe(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=Ya(this).entries,r=wIe(t,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((e=n[i++]).value,e.key,this)},keys:function(){return new RN(this,"keys")},values:function(){return new RN(this,"values")},entries:function(){return new RN(this,"entries")}},{enumerable:!0}),Gj(jp,RIe,jp.entries,{}),Gj(jp,"toString",function(){return Ya(this).serialize()},{enumerable:!0}),tm&&gIe(jp,"size",{get:function(){return Ya(this).entries.length},configurable:!0,enumerable:!0}),EIe(sS,Ev),SN({global:!0,forced:!Kj},{URLSearchParams:sS}),!Kj&&bN(FE)){var jIe=FA(qj.has),KIe=FA(qj.set),t3=function(t){if(XJ(t)){var e,n=t.body;if(CIe(n)===Ev)return e=t.headers?new FE(t.headers):new FE,jIe(e,"content-type")||KIe(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),SIe(t,{body:Wj(0,fo(n)),headers:Wj(0,e)})}return t};if(bN(zj)&&SN({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return zj(t,arguments.length>1?t3(arguments[1]):{})}}),bN(iS)){var ON=function(t){return YJ(this,IN),new iS(t,arguments.length>1?t3(arguments[1]):{})};IN.constructor=ON,ON.prototype=IN,SN({global:!0,dontCallGetSet:!0,forced:!0},{Request:ON})}}var GIe={URLSearchParams:sS,getState:Ya},n3=tr(Xc.URLSearchParams),WIe={isBrowser:!0,classes:{URLSearchParams:n3!==void 0?n3:ck,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const t$=typeof window<"u"&&typeof document<"u",zIe=(r3=typeof navigator<"u"&&navigator.product,t$&&["ReactNative","NativeScript","NS"].indexOf(r3)<0);var r3;const qIe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function i3(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function s3(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?i3(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i3(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var NA=s3(s3({},Object.freeze({__proto__:null,hasBrowserEnv:t$,hasStandardBrowserEnv:zIe,hasStandardBrowserWebWorkerEnv:qIe})),WIe),YIe=so,XIe=Ei,JIe=ki,$Ie=Is,ZIe=function(){var t=YIe(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},o3=RegExp.prototype,n$=function(t){var e=t.flags;return e!==void 0||"flags"in o3||JIe(t,"flags")||!$Ie(o3,t)?e:XIe(ZIe,t)},eRe=ik.charAt,a3=Ei,tRe=so,nRe=_i,rRe=KA,iRe=/./.exec,sRe=TypeError,oRe=nn,c3=Ei,r$=pv,aRe=qP,gC=YP,A3=yg,i$=k7,vv=ba,cRe=so,ARe=vg,lRe=KA,uRe=x7,s$=n$,dRe=mb,hRe=Cr,fRe=$P,pRe=function(t,e,n){return e+(n?eRe(t,e).length:1)},mRe=function(t,e){var n=t.exec;if(nRe(n)){var r=a3(n,t,e);return r!==null&&tRe(r),r}if(rRe(t)==="RegExp")return a3(iRe,t,e);throw sRe("RegExp#exec called on incompatible receiver")},o$=bf,gRe=cr("matchAll"),a$="RegExp String",c$=a$+" Iterator",_Re=o$.set,ERe=o$.getterFor(c$),vRe=TypeError,QL=r$("".indexOf),oS=r$("".matchAll),NN=!!oS&&!hRe(function(){oS("a",/./)}),yRe=aRe(function(t,e,n,r){_Re(this,{type:c$,regexp:t,string:e,global:n,unicode:r,done:!1})},a$,function(){var t=ERe(this);if(t.done)return gC(void 0,!0);var e=t.regexp,n=t.string,r=mRe(e,n);return r===null?(t.done=!0,gC(void 0,!0)):t.global?(vv(r[0])===""&&(e.lastIndex=pRe(n,i$(e.lastIndex),t.unicode)),gC(r,!1)):(t.done=!0,gC(r,!1))}),l3=function(t){var e,n,r,i=cRe(this),s=vv(t),o=fRe(i,RegExp),a=vv(s$(i));return e=new o(o===RegExp?i.source:i,a),n=!!~QL(a,"g"),r=!!~QL(a,"u"),e.lastIndex=i$(i.lastIndex),new yRe(e,s,n,r)};oRe({target:"String",proto:!0,forced:NN},{matchAll:function(t){var e,n,r,i,s=A3(this);if(ARe(t)){if(NN)return oS(s,t)}else{if(uRe(t)&&(e=vv(A3(s$(t))),!~QL(e,"g")))throw vRe("`.matchAll` does not allow non-global regexes");if(NN)return oS(s,t);if((r=dRe(t,gRe))===void 0&&lRe(t)=="RegExp"&&(r=l3),r)return c3(r,t,s)}return n=vv(s),i=new RegExp(t,"g"),c3(l3,i,n)}});var wRe=pc("String").matchAll,CRe=Is,TRe=wRe,DN=String.prototype,SRe=function(t){var e=t.matchAll;return typeof t=="string"||t===DN||CRe(DN,t)&&e===DN.matchAll?TRe:e},bRe=tr(SRe);function A$(t){function e(n,r,i,s){let o=n[s++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),A=s>=n.length;return o=!o&&Ie.isArray(i)?i.length:o,A?(Ie.hasOwnProp(i,o)?i[o]=[i[o],r]:i[o]=r,!a):(i[o]&&Ie.isObject(i[o])||(i[o]=[]),e(n,r,i[o],s)&&Ie.isArray(i[o])&&(i[o]=function(u){const d={},f=Object.keys(u);let m;const g=f.length;let v;for(m=0;m<g;m++)v=f[m],d[v]=u[v];return d}(i[o])),!a)}if(Ie.isFormData(t)&&Ie.isFunction(t.entries)){const n={};return Ie.forEachEntry(t,(r,i)=>{e(function(s){return bRe(Ie).call(Ie,/\w+|\[(\w*)]/g,s).map(o=>o[0]==="[]"?"":o[1]||o[0])}(r),i,n,0)}),n}return null}const gk={transitional:_J,adapter:["xhr","http"],transformRequest:[function(t,e){const n=e.getContentType()||"",r=n.indexOf("application/json")>-1,i=Ie.isObject(t);if(i&&Ie.isHTMLForm(t)&&(t=new FormData(t)),Ie.isFormData(t))return r?JSON.stringify(A$(t)):t;if(Ie.isArrayBuffer(t)||Ie.isBuffer(t)||Ie.isStream(t)||Ie.isFile(t)||Ie.isBlob(t))return t;if(Ie.isArrayBufferView(t))return t.buffer;if(Ie.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let s;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(o,a){return tS(o,new NA.classes.URLSearchParams,Object.assign({visitor:function(A,u,d,f){return NA.isNode&&Ie.isBuffer(A)?(this.append(u,A.toString("base64")),!1):f.defaultVisitor.apply(this,arguments)}},a))}(t,this.formSerializer).toString();if((s=Ie.isFileList(t))||n.indexOf("multipart/form-data")>-1){const o=this.env&&this.env.FormData;return tS(s?{"files[]":t}:t,o&&new o,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),function(o,a,A){if(Ie.isString(o))try{return(a||JSON.parse)(o),is(Ie).call(Ie,o)}catch(u){if(u.name!=="SyntaxError")throw u}return(A||JSON.stringify)(o)}(t)):t}],transformResponse:[function(t){const e=this.transitional||gk.transitional,n=e&&e.forcedJSONParsing,r=this.responseType==="json";if(t&&Ie.isString(t)&&(n&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(s){if(i)throw s.name==="SyntaxError"?In.from(s,In.ERR_BAD_RESPONSE,this,null,this.response):s}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:NA.classes.FormData,Blob:NA.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ie.forEach(["delete","get","head","post","put","patch"],t=>{gk.headers[t]={}});var _k=gk;const IRe=Ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),u3=Symbol("internals");function M_(t){var e;return t&&is(e=String(t)).call(e).toLowerCase()}function QT(t){return t===!1||t==null?t:Ie.isArray(t)?t.map(QT):String(t)}function BN(t,e,n,r,i){return Ie.isFunction(r)?r.call(this,e,n):(i&&(e=n),Ie.isString(e)?Ie.isString(r)?e.indexOf(r)!==-1:Ie.isRegExp(r)?r.test(e):void 0:void 0)}class HT{constructor(e){e&&this.set(e)}set(e,n,r){const i=this;function s(A,u,d){const f=M_(u);if(!f)throw new Error("header name must be a non-empty string");const m=Ie.findKey(i,f);(!m||i[m]===void 0||d===!0||d===void 0&&i[m]!==!1)&&(i[m||u]=QT(A))}const o=(A,u)=>Ie.forEach(A,(d,f)=>s(d,f,u));var a;return Ie.isPlainObject(e)||e instanceof this.constructor?o(e,n):Ie.isString(e)&&(e=is(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(is(a=e).call(a))?o((A=>{const u={};let d,f,m;return A&&A.split(`
`).forEach(function(g){var v,y;m=g.indexOf(":"),d=is(v=g.substring(0,m)).call(v).toLowerCase(),f=is(y=g.substring(m+1)).call(y),!d||u[d]&&IRe[d]||(d==="set-cookie"?u[d]?u[d].push(f):u[d]=[f]:u[d]=u[d]?u[d]+", "+f:f)}),u})(e),n):e!=null&&s(n,e,r),this}get(e,n){if(e=M_(e)){const r=Ie.findKey(this,e);if(r){const i=this[r];if(!n)return i;if(n===!0)return function(s){const o=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let A;for(;A=a.exec(s);)o[A[1]]=A[2];return o}(i);if(Ie.isFunction(n))return n.call(this,i,r);if(Ie.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=M_(e)){const r=Ie.findKey(this,e);return!(!r||this[r]===void 0||n&&!BN(0,this[r],r,n))}return!1}delete(e,n){const r=this;let i=!1;function s(o){if(o=M_(o)){const a=Ie.findKey(r,o);!a||n&&!BN(0,r[a],a,n)||(delete r[a],i=!0)}}return Ie.isArray(e)?e.forEach(s):s(e),i}clear(e){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const s=n[r];e&&!BN(0,this[s],s,e,!0)||(delete this[s],i=!0)}return i}normalize(e){const n=this,r={};return Ie.forEach(this,(i,s)=>{var o;const a=Ie.findKey(r,s);if(a)return n[a]=QT(i),void delete n[s];const A=e?function(u){return is(u).call(u).toLowerCase().replace(/([a-z\d])(\w*)/g,(d,f,m)=>f.toUpperCase()+m)}(s):is(o=String(s)).call(o);A!==s&&delete n[s],n[A]=QT(i),r[A]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return Ie.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=e&&Ie.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,r]=e;return n+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return i.forEach(o=>n.set(o)),n}static accessor(e){const n=(this[u3]=this[u3]={accessors:{}}).accessors,r=this.prototype;function i(s){const o=M_(s);n[o]||(function(a,A){const u=Ie.toCamelCase(" "+A);["get","set","has"].forEach(d=>{Object.defineProperty(a,d+u,{value:function(f,m,g){return this[d].call(this,A,f,m,g)},configurable:!0})})}(r,s),n[o]=!0)}return Ie.isArray(e)?e.forEach(i):i(e),this}}HT.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Ie.reduceDescriptors(HT.prototype,(t,e)=>{let{value:n}=t,r=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(i){this[r]=i}}}),Ie.freezeMethods(HT);var Ql=HT;function LN(t,e){const n=this||_k,r=e||n,i=Ql.from(r.headers);let s=r.data;return Ie.forEach(t,function(o){s=o.call(n,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function l$(t){return!(!t||!t.__CANCEL__)}function Sy(t,e,n){In.call(this,t??"canceled",In.ERR_CANCELED,e,n),this.name="CanceledError"}Ie.inherits(Sy,In,{__CANCEL__:!0});var RRe=NA.hasStandardBrowserEnv?{write(t,e,n,r,i,s){const o=[t+"="+encodeURIComponent(e)];Ie.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Ie.isString(r)&&o.push("path="+r),Ie.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function u$(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,r){return r?n.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):n}(t,e):e}var ORe=NA.hasStandardBrowserEnv?function(){const t=/(msie|trident)/i.test(navigator.userAgent),e=document.createElement("a");let n;function r(i){let s=i;return t&&(e.setAttribute("href",s),s=e.href),e.setAttribute("href",s),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return n=r(window.location.href),function(i){const s=Ie.isString(i)?r(i):i;return s.protocol===n.protocol&&s.host===n.host}}():function(){return!0};function d3(t,e){let n=0;const r=function(i,s){i=i||10;const o=new Array(i),a=new Array(i);let A,u=0,d=0;return s=s!==void 0?s:1e3,function(f){const m=Date.now(),g=a[d];A||(A=m),o[u]=f,a[u]=m;let v=d,y=0;for(;v!==u;)y+=o[v++],v%=i;if(u=(u+1)%i,u===d&&(d=(d+1)%i),m-A<s)return;const w=g&&m-g;return w?Math.round(1e3*y/w):void 0}}(50,250);return i=>{const s=i.loaded,o=i.lengthComputable?i.total:void 0,a=s-n,A=r(a);n=s;const u={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:A||void 0,estimated:A&&o&&s<=o?(o-s)/A:void 0,event:i};u[e?"download":"upload"]=!0,t(u)}}var NRe=typeof XMLHttpRequest<"u"&&function(t){return new ye(function(e,n){let r=t.data;const i=Ql.from(t.headers).normalize();let s,o,{responseType:a,withXSRFToken:A}=t;function u(){t.cancelToken&&t.cancelToken.unsubscribe(s),t.signal&&t.signal.removeEventListener("abort",s)}if(Ie.isFormData(r)){if(NA.hasStandardBrowserEnv||NA.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if((o=i.getContentType())!==!1){const[v,...y]=o?o.split(";").map(w=>is(w).call(w)).filter(Boolean):[];i.setContentType([v||"multipart/form-data",...y].join("; "))}}let d=new XMLHttpRequest;if(t.auth){const v=t.auth.username||"",y=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";i.set("Authorization","Basic "+btoa(v+":"+y))}const f=u$(t.baseURL,t.url);function m(){if(!d)return;const v=Ql.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders());(function(y,w,b){const I=b.config.validateStatus;b.status&&I&&!I(b.status)?w(new In("Request failed with status code "+b.status,[In.ERR_BAD_REQUEST,In.ERR_BAD_RESPONSE][Math.floor(b.status/100)-4],b.config,b.request,b)):y(b)})(function(y){e(y),u()},function(y){n(y),u()},{data:a&&a!=="text"&&a!=="json"?d.response:d.responseText,status:d.status,statusText:d.statusText,headers:v,config:t,request:d}),d=null}if(d.open(t.method.toUpperCase(),gJ(f,t.params,t.paramsSerializer),!0),d.timeout=t.timeout,"onloadend"in d?d.onloadend=m:d.onreadystatechange=function(){d&&d.readyState===4&&(d.status!==0||d.responseURL&&d.responseURL.indexOf("file:")===0)&&setTimeout(m)},d.onabort=function(){d&&(n(new In("Request aborted",In.ECONNABORTED,t,d)),d=null)},d.onerror=function(){n(new In("Network Error",In.ERR_NETWORK,t,d)),d=null},d.ontimeout=function(){let v=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const y=t.transitional||_J;t.timeoutErrorMessage&&(v=t.timeoutErrorMessage),n(new In(v,y.clarifyTimeoutError?In.ETIMEDOUT:In.ECONNABORTED,t,d)),d=null},NA.hasStandardBrowserEnv&&(A&&Ie.isFunction(A)&&(A=A(t)),A||A!==!1&&ORe(f))){const v=t.xsrfHeaderName&&t.xsrfCookieName&&RRe.read(t.xsrfCookieName);v&&i.set(t.xsrfHeaderName,v)}r===void 0&&i.setContentType(null),"setRequestHeader"in d&&Ie.forEach(i.toJSON(),function(v,y){d.setRequestHeader(y,v)}),Ie.isUndefined(t.withCredentials)||(d.withCredentials=!!t.withCredentials),a&&a!=="json"&&(d.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&d.addEventListener("progress",d3(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",d3(t.onUploadProgress)),(t.cancelToken||t.signal)&&(s=v=>{d&&(n(!v||v.type?new Sy(null,t,d):v),d.abort(),d=null)},t.cancelToken&&t.cancelToken.subscribe(s),t.signal&&(t.signal.aborted?s():t.signal.addEventListener("abort",s)));const g=function(v){const y=/^([-+\w]{1,25})(:?\/\/|:)/.exec(v);return y&&y[1]||""}(f);g&&NA.protocols.indexOf(g)===-1?n(new In("Unsupported protocol "+g+":",In.ERR_BAD_REQUEST,t)):d.send(r||null)})};const HL={http:null,xhr:NRe};Ie.forEach(HL,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const h3=t=>"- ".concat(t),DRe=t=>Ie.isFunction(t)||t===null||t===!1;var d$={getAdapter:t=>{t=Ie.isArray(t)?t:[t];const{length:e}=t;let n,r;const i={};for(let s=0;s<e;s++){let o;if(n=t[s],r=n,!DRe(n)&&(r=HL[(o=String(n)).toLowerCase()],r===void 0))throw new In("Unknown adapter '".concat(o,"'"));if(r)break;i[o||"#"+s]=r}if(!r){const s=Object.entries(i).map(o=>{let[a,A]=o;return"adapter ".concat(a," ")+(A===!1?"is not supported by the environment":"is not available in the build")});throw new In("There is no suitable adapter to dispatch the request "+(e?s.length>1?`since :
`+s.map(h3).join(`
`):" "+h3(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:HL};function UN(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Sy(null,t)}function f3(t){return UN(t),t.headers=Ql.from(t.headers),t.data=LN.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),d$.getAdapter(t.adapter||_k.adapter)(t).then(function(e){return UN(t),e.data=LN.call(t,t.transformResponse,e),e.headers=Ql.from(e.headers),e},function(e){return l$(e)||(UN(t),e&&e.response&&(e.response.data=LN.call(t,t.transformResponse,e.response),e.response.headers=Ql.from(e.response.headers))),ye.reject(e)})}function p3(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}const m3=t=>t instanceof Ql?function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?p3(Object(r),!0).forEach(function(i){N(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):p3(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}({},t):t;function zm(t,e){e=e||{};const n={};function r(u,d,f){return Ie.isPlainObject(u)&&Ie.isPlainObject(d)?Ie.merge.call({caseless:f},u,d):Ie.isPlainObject(d)?Ie.merge({},d):Ie.isArray(d)?d.slice():d}function i(u,d,f){return Ie.isUndefined(d)?Ie.isUndefined(u)?void 0:r(void 0,u,f):r(u,d,f)}function s(u,d){if(!Ie.isUndefined(d))return r(void 0,d)}function o(u,d){return Ie.isUndefined(d)?Ie.isUndefined(u)?void 0:r(void 0,u):r(void 0,d)}function a(u,d,f){return f in e?r(u,d):f in t?r(void 0,u):void 0}const A={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(u,d)=>i(m3(u),m3(d),!0)};return Ie.forEach(Object.keys(Object.assign({},t,e)),function(u){const d=A[u]||i,f=d(t[u],e[u],u);Ie.isUndefined(f)&&d!==a||(n[u]=f)}),n}const h$="1.6.8",Ek={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Ek[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const g3={};Ek.transitional=function(t,e,n){function r(i,s){return"[Axios v"+h$+"] Transitional option '"+i+"'"+s+(n?". "+n:"")}return(i,s,o)=>{if(t===!1)throw new In(r(s," has been removed"+(e?" in "+e:"")),In.ERR_DEPRECATED);return e&&!g3[s]&&(g3[s]=!0,console.warn(r(s," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(i,s,o)}};var jL={assertOptions:function(t,e,n){if(typeof t!="object")throw new In("options must be an object",In.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let i=r.length;for(;i-- >0;){const s=r[i],o=e[s];if(o){const a=t[s],A=a===void 0||o(a,s,t);if(A!==!0)throw new In("option "+s+" must be "+A,In.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new In("Unknown option "+s,In.ERR_BAD_OPTION)}},validators:Ek};const Du=jL.validators;let jT=class{constructor(t){this.defaults=t,this.interceptors={request:new Aj,response:new Aj}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=zm(this.defaults,e);const{transitional:n,paramsSerializer:r,headers:i}=e;n!==void 0&&jL.assertOptions(n,{silentJSONParsing:Du.transitional(Du.boolean),forcedJSONParsing:Du.transitional(Du.boolean),clarifyTimeoutError:Du.transitional(Du.boolean)},!1),r!=null&&(Ie.isFunction(r)?e.paramsSerializer={serialize:r}:jL.assertOptions(r,{encode:Du.function,serialize:Du.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=i&&Ie.merge(i.common,i[e.method]);i&&Ie.forEach(["delete","get","head","post","put","patch","common"],g=>{delete i[g]}),e.headers=Ql.concat(s,i);const o=[];let a=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(e)===!1||(a=a&&g.synchronous,o.unshift(g.fulfilled,g.rejected))});const A=[];let u;this.interceptors.response.forEach(function(g){A.push(g.fulfilled,g.rejected)});let d,f=0;if(!a){const g=[f3.bind(this),void 0];for(g.unshift.apply(g,o),g.push.apply(g,A),d=g.length,u=ye.resolve(e);f<d;)u=u.then(g[f++],g[f++]);return u}d=o.length;let m=e;for(f=0;f<d;){const g=o[f++],v=o[f++];try{m=g(m)}catch(y){v.call(this,y);break}}try{u=f3.call(this,m)}catch(g){return ye.reject(g)}for(f=0,d=A.length;f<d;)u=u.then(A[f++],A[f++]);return u}getUri(t){return gJ(u$((t=zm(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};Ie.forEach(["delete","get","head","options"],function(t){jT.prototype[t]=function(e,n){return this.request(zm(n||{},{method:t,url:e,data:(n||{}).data}))}}),Ie.forEach(["post","put","patch"],function(t){function e(n){return function(r,i,s){return this.request(zm(s||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}jT.prototype[t]=e(),jT.prototype[t+"Form"]=e(!0)});var KT=jT;class vk{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new ye(function(i){n=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let s=r._listeners.length;for(;s-- >0;)r._listeners[s](i);r._listeners=null}),this.promise.then=i=>{let s;const o=new ye(a=>{r.subscribe(a),s=a}).then(i);return o.cancel=function(){r.unsubscribe(s)},o},e(function(i,s,o){r.reason||(r.reason=new Sy(i,s,o),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}static source(){let e;return{token:new vk(function(n){e=n}),cancel:e}}}var BRe=vk;const KL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(KL).forEach(t=>{let[e,n]=t;KL[n]=e});var LRe=KL;const Qi=function t(e){const n=new KT(e),r=fJ(KT.prototype.request,n);return Ie.extend(r,KT.prototype,n,{allOwnKeys:!0}),Ie.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return t(zm(e,i))},r}(_k);Qi.Axios=KT,Qi.CanceledError=Sy,Qi.CancelToken=BRe,Qi.isCancel=l$,Qi.VERSION=h$,Qi.toFormData=tS,Qi.AxiosError=In,Qi.Cancel=Qi.CanceledError,Qi.all=function(t){return ye.all(t)},Qi.spread=function(t){return function(e){return t.apply(null,e)}},Qi.isAxiosError=function(t){return Ie.isObject(t)&&t.isAxiosError===!0},Qi.mergeConfig=zm,Qi.AxiosHeaders=Ql,Qi.formToJSON=t=>A$(Ie.isHTMLForm(t)?new FormData(t):t),Qi.getAdapter=d$.getAdapter,Qi.HttpStatusCode=LRe,Qi.default=Qi;var js=Qi;const URe=()=>{};function yv(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:URe};return t.promise=new ye((e,n)=>{t.resolve=r=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(r),t.value=r)},t.reject=r=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(r))}}),t}const _C=new Map,EC=new Map,fA=new Map;let kr=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Ut=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const f$=new eSe;let Fc=f$.getResult(),PN=null;function yt(t){if(!PN){Fc=f$.getResult();const e=function(a){if(a.engine.name==="Blink"&&a.browser.name!=="WeChat")return Ut.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ut.CHROME;case"Safari":case"Mobile Safari":return Ut.SAFARI;case"Edge":return Ut.EDGE;case"Firefox":return Ut.FIREFOX;case"QQ":case"QQBrowser":return Ut.QQ;case"Opera":return Ut.OPERA;case"WeChat":return Ut.WECHAT;default:return a.browser.name||""}}(Fc),n=_3(Fc),r=function(a){return a.os.name==="Windows"?a.os.version?a.os.name+" "+a.os.version:a.os.name:a.os.name||""}(Fc),i=Fc.os.version,s=_3(Fc,!1),o=Fc.device.type;if(!(e&&n&&r&&i))return{name:e,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o};PN={name:e,version:n,os:r,osVersion:i,browserVersion:s,deviceType:o}}return PN}function _3(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function Bb(){return yt().os}function E3(){const t=yt();return"".concat(t.os," ").concat(t.osVersion)}function aS(){const t=yt();return!!(Fc.engine.name==="WebKit"&&t.os===kr.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Ut.SAFARI||Cs()&&t.name!==Ut.SAFARI)}function gd(){return yt().name===Ut.CHROME}function hi(){return yt().name===Ut.SAFARI}function p$(){return yt().name===Ut.EDGE}function Vn(){return yt().name===Ut.FIREFOX}function Cs(){return yt().os===kr.IOS}function GL(t){const e=yt();return!(e.name!==Ut.CHROME||!e.osVersion)&&Number(e.version)>=t}function m$(t){const e=yt();return!(e.name!==Ut.CHROME||!e.osVersion)&&Number(e.version)<t}function v3(t){const e=yt();return!(e.name!==Ut.EDGE||!e.osVersion)&&Number(e.version)>=t}function g$(t){const e=yt();return!(e.name!==Ut.SAFARI||!e.osVersion)&&Number(e.version)>=t}function _$(t,e,n){const r=yt();if(r.os!==kr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return e&&Number(i[0])===t&&Number(i[1])<e||Number(i[0])<t}function E$(t,e,n){const r=yt();if(r.name!==Ut.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return n?e&&Number(i[0])===t&&Number(i[1])<e||Number(i[0])<t:e?Number(i[0])===t&&Number(i[1])<=e||Number(i[0])<t:Number(i[0])<=t}function y3(t){const e=yt();return!(e.name!==Ut.OPERA||!e.osVersion)&&Number(e.version)>=t}function w3(){const t=yt();if(t.os!==kr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function qm(){const t=yt();if(t.os!==kr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function WL(){const t=yt();if(t.os!==kr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function C3(){const t=yt();if(t.os!==kr.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function Ac(){return hi()&&navigator.maxTouchPoints>0}function v$(){return yt().name===Ut.WECHAT}function y$(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function yk(){const t=Bb();return function(){const{deviceType:e}=yt();return e==="mobile"||e==="tablet"}()||t===kr.ANDROID||t===kr.IOS||t===kr.HARMONY_OS}function Ud(){const t=yt();return t.name!==Ut.EDGE&&t.name!==Ut.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Lb(){return Bb()===kr.ANDROID}function wv(){const t=yt();return Lb()&&(t.name===Ut.CHROME||t.name===Ut.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function mn(t,e,n){return(e=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var A=a.call(s,"string");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function T3(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Be(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?T3(Object(n),!0).forEach(function(r){mn(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):T3(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let L=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),ie=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),mn(this,"code",void 0),mn(this,"message",void 0),mn(this,"data",void 0),mn(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Ll(t,e){if(typeof t!="boolean")throw new ie(L.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Rr(t,e,n){if(!Te(n).call(n,t))throw new ie(L.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function jt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(t))throw new ie(L.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function kN(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new ie(L.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&jt(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&jt(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&jt(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&jt(t.ideal,"".concat(e,".ideal"),1,1/0)}else jt(t,e,1,1/0)}function zr(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new ie(L.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!w$(t,n,r,i))throw new ie(L.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function Nl(t,e){if(!Array.isArray(t))throw new ie(L.INVALID_PARAMS,"".concat(e," should be an array"))}function On(t){return t==null}function w$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!r||function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){const o=i.charCodeAt(s);if(o<0||o>255)return!1}return!0}(t))}var sE=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(sE||{}),zL=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(zL||{});const C$=new class{constructor(){mn(this,"_clientSize",null),mn(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),mn(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),mn(this,"getStyle",t=>window.getComputedStyle(t,null)),mn(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const r=this.getStyle(t),{display:i,visibility:s,opacity:o,filter:a}=r;return(i==="none"||Te(e=["hidden","collapse"]).call(e,s)||Number(o)<.1)&&(n=!1),!!n&&(a&&a.split(" ").filter(A=>{var u;const d=A.split("(")[0];return Te(u=["brightness","blur","opacity"]).call(u,d)}).map(A=>{const[u,d]=A.split(/\(|\)/);return[u,Number(d.match(/^[0-9\.]+/))]}).forEach(A=>{const[u,d]=A;switch(u){case"brightness":(d<.1||d>3)&&(n=!1);break;case"blur":d>3&&(n=!1);break;case"opacity":d<.1&&(n=!1)}}),n)}),mn(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,r=!0;const i=o=>e(o);let s=t;for(;s&&r;)i(s)||(n=!1,r=!1),s=s.parentElement,s||(r=!1);return n}),mn(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),mn(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:r,right:i,top:s,bottom:o}=t.getBoundingClientRect(),a=this.getClientWidth(),A=this.getClientHeight();return{width:e,height:n,left:r,right:i,top:s,bottom:o,clientWidth:a,clientHeight:A,clientMin:Math.min(a,A)}}),mn(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),mn(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),mn(this,"checkCoverForAPoint",(t,e,n)=>{const r=this.elementFromPoint(t,e);return r!==null&&r!==n}),mn(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:r}=this._clientSize,i=t/6,s=e/6,o=[],a=10**6;for(let A=0;A<5;A++)for(let u=0;u<5;u++){const d=(n*a+(A===0?.1:A===4?(i*A*a-1e5)/a:i*A)*a)/a,f=(r*a+(u===0?.1:u===4?(s*u*a-1e5)/a:s*u)*a)/a;o.push({x:d,y:f})}return[...o]}),mn(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),mn(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),mn(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:r,clientHeight:i,clientWidth:s,clientMin:o}=this._clientSize;let a,A,u,d;if(t<0)a=0;else{if(!(t<s))return!1;a=t}if(e<0)return!1;if(A=e<s?e:s,n<0)u=0;else{if(!(n<i))return!1;u=n}if(r<0)return!1;d=r<i?r:i;const f=A-a,m=d-u;return this.checkSizeIsVisible(f,m,o)}),mn(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),mn(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(sE.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(sE.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(sE.SIZE)}}return this.returnHiddenResult(sE.STYLE)}return this.returnHiddenResult(zL.UNMOUNTED)}return this.returnHiddenResult(zL.INVALID_HTML_ELEMENT)}),mn(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function wk(t){return new TextEncoder().encode(t)}const S3=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},qL=async t=>function(e,n){let r="";return new Uint8Array(e).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",wk(t)),16);let Ln=class{constructor(){mn(this,"_events",{}),mn(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(e=>e.listener):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];this._indexOfListener(n,e)===-1&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],r=this._indexOfListener(n,e);r!==-1&&n.splice(r,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map(s=>s);for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let s=0;s<e.length;s+=1){const o=e[s];o.once&&this.off(t,o.listener),o.listener.apply(this,r||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];[...this._events[t]||[]].forEach(i=>{i.once&&this.off(t,i.listener);try{i.listener.apply(this,n)}catch(s){console.error("safeEmit event:".concat(t," error ").concat(s==null?void 0:s.toString()))}})}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}},F_=null;function T$(){if(F_)return F_;if(window.electron)return F_=window.electron;if(!window.require)return null;try{return F_=window.require("electron"),F_}catch{return null}}let wr=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t}({}),Mn=function(t){return t.TRACER="tracer",t}({});function b3(t){return jt(t.timeout,"config.timeout",0,1e5),jt(t.timeoutFactor,"config.timeoutFactor",0,100,!1),jt(t.maxRetryCount,"config.maxRetryConfig",0,1/0),jt(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let PRe=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),Mt=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function Ub(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function S$(t){return zr(t.turnServerURL,"turnServerURL"),zr(t.username,"username"),zr(t.password,"password"),t.udpport&&jt(t.udpport,"udpport",1,99999,!0),t.forceturn&&Ll(t.forceturn,"forceturn"),t.security&&Ll(t.security,"security"),t.tcpport&&jt(t.tcpport,"tcpport",1,99999,!0),!0}function I3(t){return t.level!==void 0&&Rr(t.level,"level",[1,2,3]),t.delay!==void 0&&jt(t.delay,"delay",0,3e3,!0),!0}let pt=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),li=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t}({}),go=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),nm=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function fi(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return t.getListeners(e).length===0?ye.reject(new ie(L.UNEXPECTED_ERROR,"can not emit promise")):new ye((s,o)=>{t.emit(e,...r,s,o)})}function Yt(t,e){if(t.getListeners(e).length===0)return ye.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return fi(t,e,...r)}function va(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Cv(t,e,...r)}function Cv(t,e){let n=null,r=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];if(t.emit(e,...s,a=>{n=a},a=>{r=a}),r!==null)throw r;if(n===null)throw new ie(L.UNEXPECTED_ERROR,"handler is not sync");return n}const ar=new class extends Ln{set networkState(t){this.emit(nm.NETWORK_STATE_CHANGE,t,this._networkState),t===go.ONLINE?this.emit(nm.ONLINE):t===go.OFFLINE&&(this.onlineWaiter=new ye(e=>{this.once(nm.ONLINE,()=>{this.onlineWaiter=void 0,e(go.ONLINE)})}),this.emit(nm.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===go.ONLINE}constructor(){super(),mn(this,"_moduleName","network-indicator"),mn(this,"_networkState",go.ONLINE),mn(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=go.ONLINE}),window.addEventListener("offline",()=>{this.networkState=go.OFFLINE})}};function cS(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function rm(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function Pb(t){ye!==void 0?ye.resolve().then(t):setTimeout(t,0)}function sr(t){return JSON.parse(JSON.stringify(t))}function Qh(t){try{return sr(t)}catch{return t}}const R3={};function Pd(t,e){R3[e]||(R3[e]=!0,t())}function Hh(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let r=0;r<e.length;r+=1)n[r]=e.charCodeAt(r);return n}function _d(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function b$(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const r=new Uint8Array(e);r.set(n),n=r}return n}function O3(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=qc(e).call(e,(o,a)=>o+a.length,0),i=new Uint8Array(new ArrayBuffer(r));let s=0;return e.forEach(o=>{i.set(o,s),s+=o.length}),i}function DA(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function I$(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?DA(n):n.size}),e+138}function kRe(t){const e=new ie(L.TIMEOUT,"timeout");return new ye((n,r)=>{window.setTimeout(()=>r(e),t)})}function Zr(t){return new ye(e=>{window.setTimeout(e,t)})}function tn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+tn(t-n.length,"")}function im(){return tn(32,"").toUpperCase()}const kb=()=>{},N3=new class{constructor(){mn(this,"fnMap",new Map)}throttleByKey(t,e,n,r){for(var i=arguments.length,s=new Array(i>4?i-4:0),o=4;o<i;o++)s[o-4]=arguments[o];if(this.fnMap.has(e)){const a=this.fnMap.get(e);if(a.threshold!==n){a.fn(...a.args),clearTimeout(a.timer);const A=window.setTimeout(()=>{const u=this.fnMap.get(e);u&&u.fn(...u.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:A,args:s,skipFn:r})}else a.skipFn&&a.skipFn(...a.args),this.fnMap.set(e,Be(Be({},a),{},{fn:t,args:s,skipFn:r}))}else{const a=window.setTimeout(()=>{const A=this.fnMap.get(e);A&&A.fn(...A.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:a,args:s,skipFn:r})}}},D3=N3.throttleByKey.bind(N3);function B3(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function YL(t,e){if(!B3(t)||!B3(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let r=0;r<e.length;r++)n[r]=YL(t[r],e[r]);return n}{const n=Be({},t);for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)?n[r]=YL(t[r],e[r]):n[r]=e[r]);return n}}function L3(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let r=0;for(;t>0&&(n[r]=255&t,t>>=8,r++,r!==e););return n}function xN(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function R$(t){const e="0123456789abcdef";function n(B){let M,H="";for(M=0;M<=3;M++)H+=e.charAt(B>>8*M+4&15)+e.charAt(B>>8*M&15);return H}function r(B,M){const H=(65535&B)+(65535&M);return(B>>16)+(M>>16)+(H>>16)<<16|65535&H}function i(B,M,H,K,Q,F){return r(function(k,G){return k<<G|k>>>32-G}(r(r(M,B),r(K,F)),Q),H)}function s(B,M,H,K,Q,F,k){return i(M&H|~M&K,B,M,Q,F,k)}function o(B,M,H,K,Q,F,k){return i(M&K|H&~K,B,M,Q,F,k)}function a(B,M,H,K,Q,F,k){return i(M^H^K,B,M,Q,F,k)}function A(B,M,H,K,Q,F,k){return i(H^(M|~K),B,M,Q,F,k)}const u=function(B){let M;const H=1+(B.length+8>>6),K=new Array(16*H);for(M=0;M<16*H;M++)K[M]=0;for(M=0;M<B.length;M++)K[M>>2]|=B.charCodeAt(M)<<M%4*8;return K[M>>2]|=128<<M%4*8,K[16*H-2]=8*B.length,K}(t);let d,f,m,g,v,y=1732584193,w=-271733879,b=-1732584194,I=271733878;for(d=0;d<u.length;d+=16)f=y,m=w,g=b,v=I,y=s(y,w,b,I,u[d+0],7,-680876936),I=s(I,y,w,b,u[d+1],12,-389564586),b=s(b,I,y,w,u[d+2],17,606105819),w=s(w,b,I,y,u[d+3],22,-1044525330),y=s(y,w,b,I,u[d+4],7,-176418897),I=s(I,y,w,b,u[d+5],12,1200080426),b=s(b,I,y,w,u[d+6],17,-1473231341),w=s(w,b,I,y,u[d+7],22,-45705983),y=s(y,w,b,I,u[d+8],7,1770035416),I=s(I,y,w,b,u[d+9],12,-1958414417),b=s(b,I,y,w,u[d+10],17,-42063),w=s(w,b,I,y,u[d+11],22,-1990404162),y=s(y,w,b,I,u[d+12],7,1804603682),I=s(I,y,w,b,u[d+13],12,-40341101),b=s(b,I,y,w,u[d+14],17,-1502002290),w=s(w,b,I,y,u[d+15],22,1236535329),y=o(y,w,b,I,u[d+1],5,-165796510),I=o(I,y,w,b,u[d+6],9,-1069501632),b=o(b,I,y,w,u[d+11],14,643717713),w=o(w,b,I,y,u[d+0],20,-373897302),y=o(y,w,b,I,u[d+5],5,-701558691),I=o(I,y,w,b,u[d+10],9,38016083),b=o(b,I,y,w,u[d+15],14,-660478335),w=o(w,b,I,y,u[d+4],20,-405537848),y=o(y,w,b,I,u[d+9],5,568446438),I=o(I,y,w,b,u[d+14],9,-1019803690),b=o(b,I,y,w,u[d+3],14,-187363961),w=o(w,b,I,y,u[d+8],20,1163531501),y=o(y,w,b,I,u[d+13],5,-1444681467),I=o(I,y,w,b,u[d+2],9,-51403784),b=o(b,I,y,w,u[d+7],14,1735328473),w=o(w,b,I,y,u[d+12],20,-1926607734),y=a(y,w,b,I,u[d+5],4,-378558),I=a(I,y,w,b,u[d+8],11,-2022574463),b=a(b,I,y,w,u[d+11],16,1839030562),w=a(w,b,I,y,u[d+14],23,-35309556),y=a(y,w,b,I,u[d+1],4,-1530992060),I=a(I,y,w,b,u[d+4],11,1272893353),b=a(b,I,y,w,u[d+7],16,-155497632),w=a(w,b,I,y,u[d+10],23,-1094730640),y=a(y,w,b,I,u[d+13],4,681279174),I=a(I,y,w,b,u[d+0],11,-358537222),b=a(b,I,y,w,u[d+3],16,-722521979),w=a(w,b,I,y,u[d+6],23,76029189),y=a(y,w,b,I,u[d+9],4,-640364487),I=a(I,y,w,b,u[d+12],11,-421815835),b=a(b,I,y,w,u[d+15],16,530742520),w=a(w,b,I,y,u[d+2],23,-995338651),y=A(y,w,b,I,u[d+0],6,-198630844),I=A(I,y,w,b,u[d+7],10,1126891415),b=A(b,I,y,w,u[d+14],15,-1416354905),w=A(w,b,I,y,u[d+5],21,-57434055),y=A(y,w,b,I,u[d+12],6,1700485571),I=A(I,y,w,b,u[d+3],10,-1894986606),b=A(b,I,y,w,u[d+10],15,-1051523),w=A(w,b,I,y,u[d+1],21,-2054922799),y=A(y,w,b,I,u[d+8],6,1873313359),I=A(I,y,w,b,u[d+15],10,-30611744),b=A(b,I,y,w,u[d+6],15,-1560198380),w=A(w,b,I,y,u[d+13],21,1309151649),y=A(y,w,b,I,u[d+4],6,-145523070),I=A(I,y,w,b,u[d+11],10,-1120210379),b=A(b,I,y,w,u[d+2],15,718787259),w=A(w,b,I,y,u[d+9],21,-343485551),y=r(y,f),w=r(w,m),b=r(b,g),I=r(I,v);return n(y)+n(w)+n(b)+n(I)}let xRe=1,vC=console,Pi=class{static setLogger(t){vC=t}constructor(t){mn(this,"lockingPromise",ye.resolve()),mn(this,"locks",0),mn(this,"name",""),mn(this,"lockId",void 0),this.lockId=xRe++,t&&(this.name=t),vC.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,vC.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const n=new ye(i=>{e=()=>{this.locks-=1,vC.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),i()}}),r=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function Ym(t,e){return function(n,r,i){const s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const o=this[e];if(!o)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const a=await o.lock("From ".concat(t,".").concat(r));try{for(var A=arguments.length,u=new Array(A),d=0;d<A;d++)u[d]=arguments[d];return await s.apply(this,u)}finally{a()}},i}}const hr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Ck(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function Jc(t,e,n,r){const i=Object.assign({},hr,r);let s=i.timeout;const o=async()=>{await function(u){return new ye(d=>{window.setTimeout(d,u)})}(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)};let a=!1;const A=new ye(async(u,d)=>{e=e||(()=>!1),n=n||(()=>!0);for(let f=0;f<i.maxRetryCount;f+=1){if(a)return d(new ie(L.OPERATION_ABORTED));try{const m=await t();if(!e(m,f)||f+1===i.maxRetryCount)return u(m);await o()}catch(m){if(!n(m,f)||f+1===i.maxRetryCount)return d(m);await o()}}});return A.cancel=()=>a=!0,A}class O${constructor(e){mn(this,"input",[]),mn(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:qc(e=this.input).call(e,(n,r)=>n+r)/this.input.length}}let yC,wC=0,MN=0;function XL(t,e,n,r){return new ye((i,s)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),wC+=DA(e.data)):n&&(e.data.size?wC+=e.data.size:e.data instanceof FormData?wC+=I$(e.data):wC+=DA(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,js.request(e).then(o=>{typeof o.data=="string"?MN+=DA(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?MN+=o.data.byteLength:MN+=DA(JSON.stringify(o.data)),i(o.data)}).catch(o=>{js.isCancel(o)?s(new ie(L.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new ie(L.NETWORK_TIMEOUT,o.message)):o.response?s(new ie(L.NETWORK_RESPONSE_ERROR,o.response.status)):s(new ie(L.NETWORK_ERROR,o.message))})})}async function MRe(t,e){const n=new Blob([e.data],{type:"buffer"});return await XL(t,Be(Be({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const U3=()=>window.isSecureContext!==void 0,ya=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(e&&e[1]&&e[2]){const r=e[1],i=e[2];return"".concat(r,".").concat(i)}const n=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const r=n[1],i=n[2];return"".concat(r,".").concat(100*(Number(i)+1))}return"4.0.0.999"}("4.22.0"),Tk=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let Rh=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const Sk={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},bk="v4.22.0-0-g8569241d-dirty(8/15/2024, 7:04:06 PM)",Zn=Be(Be({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Sk,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1});function Ht(t,e,n){var r,i,s;Te(r=Object.keys(Zn)).call(r,t)&&(!n&&Te(i=Object.keys(rd)).call(i,t)||(Zn[t]=e,t==="ENABLE_VIDEO_SEI"&&e===!0&&(Zn.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&e&&(s=!!e,Zn.USE_NEW_NETWORK_CONFIG=s,s&&(Zn.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Zn.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Zn.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Zn.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Zn.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Zn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Zn.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(Zn.ENABLE_INSTANT_VIDEO=!0,Zn.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(Zn.ENABLE_AUT_CC=!0)))}function j(t){return Zn[t]}const rd={};var ht=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(ht||{});class FRe{constructor(e,n,r,i){mn(this,"state",void 0),this.state={codec:e,audioCodec:n,mode:r,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Rh.Default}}dispatch(e){this.state=function(n,r){switch(r.type){case ht.SET_SESSION_ID:return Be(Be({},n),{},{sessionId:r.sessionId});case ht.SET_P2P_ID:return Be(Be({},n),{},{p2pId:r.p2pId});case ht.SET_UID:return Be(Be({},n),{},{uid:r.uid});case ht.SET_INT_UID:return Be(Be({},n),{},{intUid:r.intUid});case ht.SET_PUB_ID:return Be(Be({},n),{},{pubId:r.pubId});case ht.KEY_METRIC_CLIENT_CREATED:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{clientCreated:r.metric})});case ht.KEY_METRIC_JOIN_START:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{joinStart:r.metric})});case ht.AVOID_JOIN_START:return Be(Be({},n),{},{avoidJoinStart:r.avoidJoinStart});case ht.KEY_METRIC_JOIN_END:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{joinEnd:r.metric})});case ht.KEY_METRIC_REQUEST_AP_START:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{requestAPStart:r.metric})});case ht.KEY_METRIC_REQUEST_AP_END:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{requestAPEnd:r.metric})});case ht.KEY_METRIC_JOIN_GATEWAY_START:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{joinGatewayStart:r.metric})});case ht.KEY_METRIC_JOIN_GATEWAY_END:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{joinGatewayEnd:r.metric})});case ht.KEY_METRIC_PEER_CONNECTION_START:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{peerConnectionStart:r.metric})});case ht.KEY_METRIC_PEER_CONNECTION_END:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{peerConnectionEnd:r.metric})});case ht.KEY_METRIC_DESCRIPTION_START:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{descriptionStart:r.metric})});case ht.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{signalChannelOpen:r.metric})});case ht.KEY_METRIC_ICE_CONNECTION_END:return Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{iceConnectionEnd:r.metric})});case ht.KEY_METRIC_PUBLISH:{const i=n.keyMetrics.publish,s=i.findIndex(o=>o.trackId===r.metric.trackId);return s!==-1?(i[s]=Be(Be({},i[s]),r.metric),Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{publish:[...i]})})):Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,r.metric]})})}case ht.KEY_METRIC_SUBSCRIBE:{const i=n.keyMetrics.subscribe,s=i.findIndex(o=>o.userId===r.metric.userId&&o.type===r.metric.type);return s!==-1?(i[s]=Be(Be({},i[s]),r.metric),Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{subscribe:[...i]})})):Be(Be({},n),{},{keyMetrics:Be(Be({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,r.metric]})})}case ht.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=r.mode,n;case ht.RECORD_JOIN_CHANNEL_SERVICE:return typeof r.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,r.record]:(n.joinChannelServiceRecords[r.index]=Be(Be({},n.joinChannelServiceRecords[r.index]),r.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case ht.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case ht.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case ht.SET_USE_P2P:return Be(Be({},n),{},{useP2P:r.val});case ht.SET_TRANSPORT_TYPE:return Be(Be({},n),{},{p2pTransport:r.val});default:return n}}(this.state,e)}set sessionId(e){this.dispatch({type:ht.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:ht.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:ht.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:ht.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:ht.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:ht.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:ht.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:ht.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:ht.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:ht.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ht.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ht.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ht.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ht.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ht.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ht.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ht.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ht.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ht.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ht.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ht.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,n,r,i){this.dispatch({type:ht.KEY_METRIC_PUBLISH,metric:Be(Be({trackId:e,type:n},r&&{publishStart:r}),i&&{publishEnd:i})})}subscribe(e,n,r,i,s,o,a){this.dispatch({type:ht.KEY_METRIC_SUBSCRIBE,metric:Be(Be(Be(Be(Be({userId:e,type:n},r&&{subscribeStart:r}),i&&{subscribeEnd:i}),s&&{firstFrame:s}),o&&{streamAdded:o}),a&&{firstDecoded:a})})}massSubscribe(e,n,r,i){e.forEach(s=>{this.dispatch({type:ht.KEY_METRIC_SUBSCRIBE,metric:Be(Be(Be({userId:s.userId,type:s.type},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,n){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(r=>r.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:ht.RECORD_JOIN_CHANNEL_SERVICE,record:Be(Be({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ht.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ht.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ht.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:ht.AVOID_JOIN_START,avoidJoinStart:e})}}let xb=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const P3=128,VRe=96,k3=1e3,_p=10;let QRe=0;function $n(t,e,n){return(e=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var A=a.call(s,"string");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function x3(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function rt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?x3(Object(n),!0).forEach(function(r){$n(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x3(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const N$=new class extends Ln{constructor(){super(...arguments),$n(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class HRe{constructor(e){$n(this,"logger",void 0),$n(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function FN(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function M3(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const pa={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},CC=Date.now(),V_=t=>{for(const e in pa)if(Object.prototype.hasOwnProperty.call(pa,e)&&pa[e]===t)return e;return"DEFAULT"},S=new class{constructor(){$n(this,"proxyServerURL",void 0),$n(this,"logLevel",pa.DEBUG),$n(this,"uploadState","collecting"),$n(this,"uploadLogWaitingList",[]),$n(this,"uploadLogUploadingList",[]),$n(this,"uploadErrorCount",0),$n(this,"currentLogID",0),$n(this,"url",void 0),$n(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[pa.DEBUG].concat(e);this.log.apply(this,r)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[pa.INFO].concat(e);this.log.apply(this,r)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[pa.WARNING].concat(e);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[pa.ERROR].concat(e);this.log.apply(this,r)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[pa.DEBUG].concat(e);this.uploadLog.apply(this,r)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){Ht("UPLOAD_LOG",!0)}disableLogUpload(){Ht("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new HRe(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-CC<100)return void setTimeout(()=>{this.log(...e)},Date.now()-CC);const r=Math.max(0,Math.min(4,e[0]));if(e[0]=FN()+" Agora-SDK [".concat(V_(r),"]:"),this.appendLogToWaitingList(r,...e),r<this.logLevel)return;const i=FN()+" %cAgora-SDK [".concat(V_(r),"]:");let s=[];if(!j("USE_NEW_LOG"))switch(r){case pa.DEBUG:s=[i,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,s);break;case pa.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,s);break;case pa.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,s);break;case pa.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-CC<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-CC);const r=Math.max(0,Math.min(4,e[0]));e[0]=FN()+" Agora-SDK [".concat(V_(r),"]:"),this.appendLogToWaitingList(r,...e)}appendLogToWaitingList(t){if(!j("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=M3()+" Agora-SDK [".concat(V_(t),"]:"):n[0]=M3()+" Agora-SDK [".concat(V_(t),"]:");let i="";n.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:ya,process_id:j("PROCESS_ID"),payload:JSON.stringify(t)};return Jc(async()=>{const n=await js.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(j("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(j("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:t.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),N$.reportLogUploadError(r),!0},{timeout:j("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:j("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,j("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),j("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var F3;function jRe(t){return zr(t.reportId,"params.reportId",0,100,!1),zr(t.category,"params.category",0,100,!1),zr(t.event,"params.event",0,100,!1),zr(t.label,"params.label",0,100,!1),jt(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(F3={}).FREE="free",F3.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const KRe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Wr=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t}({}),Nn=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let GRe=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});class by{constructor(){$n(this,"baseInfoMap",new Map),$n(this,"proxyServer",void 0),$n(this,"eventUploadTimer",void 0),$n(this,"setSessionIdTimer",void 0),$n(this,"url",void 0),$n(this,"backupUrl",void 0),$n(this,"_appId",void 0),$n(this,"keyEventUploadPendingItems",[]),$n(this,"normalEventUploadPendingItems",[]),$n(this,"apiInvokeUploadPendingItems",[]),$n(this,"apiInvokeCount",0),$n(this,"ltsList",[]),$n(this,"lastSendNormalEventTime",Date.now()),$n(this,"customReportCounterTimer",void 0),$n(this,"customReportCount",0),$n(this,"extApiInvoke",async e=>{for(const n of e){const r=rt(rt({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Mn.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),j("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),j("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void S.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const n=this.baseInfoMap.get(e),r=Date.now(),i=n.startTime;n.startTime=r,S.debug("rewrite session ".concat(e," startTime: ").concat(r," , ").concat(r-i,"ms")),this.baseInfoMap.set(e,n)}setAppId(e){this._appId=e}reportApiInvoke(e,n,r){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const i=Date.now();this.apiInvokeCount+=1;const s=this.apiInvokeCount,o=()=>({tag:n.tag,invokeId:s,sid:e,name:n.name,apiInvokeTime:i,options:n.options,states:n.states||null}),a=!!j("SHOW_REPORT_INVOKER_LOG");a&&S.info("".concat(n.name," start"),n.options);let A=!1;Zr(n.timeout).then(()=>{A||(this.sendApiInvoke(rt(rt({},o()),{},{error:L.API_INVOKE_TIMEOUT,success:!1})),S.debug("".concat(n.name," timeout")))});const u=new ie(L.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:d=>{const f=()=>{if(A)throw u;return A=!0,this.sendApiInvoke(rt(rt({},o()),{},{success:!0},n.reportResult&&{result:d})),a&&S.info("".concat(n.name," onSuccess")),d};return r?D3(f,n.name+"Success",r,()=>A=!0):f()},onError:d=>{const f=()=>{if(A)throw d;A=!0,this.sendApiInvoke(rt(rt({},o()),{},{success:!1,error:d})),a&&S.info("".concat(n.name," onFailure"),d.toString())};return r?D3(f,n.name+"Error",r,()=>A=!0):f()}}}sessionInit(e,n){if(this.baseInfoMap.has(e))return;const r=Date.now(),i=this.createBaseInfo(e,r);i.cname=n.cname;const s=Object.assign({},{willUploadConsoleLog:j("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Tk?"global":"oversea",areas:j("AREAS")&&j("AREAS").join(",")},n.extend),{stringUid:o,channelProfile:a,channelMode:A,isABTestSuccess:u,lsid:d,clientRole:f}=n,m=Date.now(),g=rt(rt({},i),{},{eventType:Wr.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:bk,lts:m,elapse:m-r,extend:JSON.stringify(s),mode:n.mode,process:j("PROCESS_ID"),appType:j("APP_TYPE"),success:!0,version:ya,stringUid:o,channelProfile:a,channelMode:A,isABTestSuccess:u,lsid:d,clientType:Te(v=window.navigator.userAgent).call(v,"AgoraWebView")?42:20,clientRole:f,serviceId:j("PROCESS_ID"),extensionID:j("PLUGIN_INFO").join(",")||""});var v;this.send({type:Nn.SESSION,data:g},!0)}joinChooseServer(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt({},i),{},{eventType:Wr.JOIN_CHOOSE_SERVER,lts:s,eventElapse:n.elapse||s-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:s-r.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3});this.send({type:Nn.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt({},i),{},{eventType:Wr.REQ_USER_ACCOUNT,lts:s,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||s-r.startTime,eventElapse:s-n.lts,extend:JSON.stringify(n.extend)});this.send({type:Nn.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info;n.vid&&(i.vid=n.vid),i.uid=n.uid,i.cid=n.cid;const s=Date.now(),{firstSuccess:o,avoidJoinStartTime:a}=n,A=s-(o&&a?a:r.startTime),u=rt(rt({},i),{},{eventType:Wr.JOIN_GATEWAY,lts:s,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,errorMsg:n.errorMsg||"",elapse:A,eventElapse:s-n.lts,firstSuccess:o,signalChannel:n.signalChannel,preload:n.preload?1:0});n.succ&&(r.lastJoinSuccessTime=s),this.send({type:Nn.JOIN_GATEWAY,data:u},!0)}joinChannelTimeout(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=Date.now(),s=rt(rt({},r.info),{},{lts:i,timeout:n,elapse:i-r.startTime});this.send({type:Nn.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt({},i),{},{eventType:Wr.PUBLISH,lts:s,eventElapse:n.eventElapse,elapse:s-r.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:Nn.PUBLISH,data:o},!0)}subscribe(e,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),a=rt(rt({},s),{},{eventType:Wr.SUBSCRIBE,lts:o,eventElapse:n.eventElapse,elapse:o-i.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid,preSsrc:n.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?a.peerSuid=n.peerid:a.peer=n.peerid,this.send({type:Nn.SUBSCRIBE,data:a},!0)}wsCompressorInit(e){var n;const r=[...Mo(n=this.baseInfoMap).call(n)],i=r.length?r[0]:"UnableToGetSid",s=this.baseInfoMap.get(i);if(!s)return;const o=s.info,a=Date.now(),A=rt(rt({},o),{},{eventType:Wr.WS_COMPRESSOR_INIT,lts:a,eventElapse:e.eventElapse,elapse:a-s.startTime,status:e.status?1:2});this.send({type:Nn.WS_COMPRESSOR_INIT,data:A},!0)}firstRemoteVideoDecode(e,n,r,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,a=Date.now(),A=rt(rt(rt({},o),i),{},{elapse:a-s.startTime,eventType:n,lts:a,firstDecodeFrame:Math.max((i.firstFrame||a)-s.startTime,0),apEnd:Math.max(i.apEnd-s.startTime,0),apStart:Math.max(i.apStart-s.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-s.startTime,0),joinGwStart:Math.max(i.joinGwStart-s.startTime,0),pcEnd:Math.max(i.pcEnd-s.startTime,0),pcStart:Math.max(i.pcStart-s.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-s.startTime,0),subscriberStart:Math.max(i.subscriberStart-s.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-s.startTime,0)});this.send({type:r,data:A},!0)}firstRemoteFrame(e,n,r,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,a=Date.now(),A=rt(rt(rt({},o),i),{},{elapse:a-s.startTime,eventType:n,lts:a});this.send({type:r,data:A},!0)}pcStats(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt(rt({},i),n),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:s-r.startTime,eventType:Wr.PC_STATS,lts:s,preallocation:n.preallocation?1:0});this.send({type:Nn.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,n){if(e){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt(rt({},i),n),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Wr.UPDATE_REMOTE_RTPCAPABILITIES,lts:s});this.send({type:Nn.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,n,r,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,a=Date.now(),A=rt(rt(rt({},o),i),{},{eventType:n,lts:a});this.send({type:r,data:A},!0)}streamSwitch(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt({},i),{},{eventType:Wr.STREAM_SWITCH,lts:s,isDual:n.isdual,elapse:s-r.startTime,success:n.succ});this.send({type:Nn.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt({},i),{},{eventType:Wr.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-n.lts,elapse:s-r.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Nn.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt({},i),{},{eventType:Wr.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-n.lts,elapse:s-r.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:Nn.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?S.debug("reportProxyServerurl: ".concat(e)):S.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt({},i),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:s,elapse:s-r.startTime,joinChannelSuccessElapse:s-(r.lastJoinSuccessTime||s),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:Nn.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now();(function(o,a,A){const u=o[a];if(!u||typeof u!="string")return[o];o[a]="";const d=DA(JSON.stringify(o));let f=0;const m=[];let g=0;for(let v=0;v<u.length;v++)g+=u.charCodeAt(v)<=127?1:3,g<=A-d||(m[m.length]=Be(Be({},o),{},{[a]:u.substring(f,v)}),f=v,g=u.charCodeAt(v)<=127?1:3);return f!==u.length-1&&(m[m.length]=Be(Be({},o),{},{[a]:u.substring(f)})),m})(rt(rt(rt({},i),n),{},{elapse:s-r.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach(o=>this.send({type:Nn.WORKER_EVENT,data:o},!0))}apworkerEvent(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt(rt({},i),n),{},{elapse:s-r.startTime,lts:s});this.send({type:Nn.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt(rt({},i),n),{},{elapse:s-r.startTime,lts:s,extend:n.extend||void 0});this.send({type:Nn.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,s=Date.now(),o=rt(rt(rt({},i),n),{},{elapse:s-r.startTime,lts:s});this.send({type:Nn.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,n){if(this.customReportCount+=n.length,this.customReportCount>j("CUSTOM_REPORT_LIMIT"))throw new ie(L.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const r=Date.now(),i=n.map(s=>({type:Nn.USER_ANALYTICS,data:rt(rt({sid:e},s),{},{lts:r})}));try{j("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(s){throw S.error("send custom report message failed",s.toString()),new ie(L.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(e){const n=j("NOT_REPORT_EVENT");if(e.tag&&Te(n)&&Te(n).call(n,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:s,cid:o}=r.info;let a;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof ie){const{code:u,message:d}=e.error;a=u||d||e.error.toString()}else a=e.error.toString();const A={invokeId:e.invokeId,sid:e.sid,cname:i,cid:o,uid:s,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?a:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Nn.API_INVOKE,data:A},!1),!0}appendSessionId(){by.__CLIENT_LIST__.forEach(e=>{if(e._sessionId){const n=this.apiInvokeUploadPendingItems.length;for(let r=0;r<n;r++){const i=this.apiInvokeUploadPendingItems.shift();i&&(i.sid=e._sessionId,this.sendApiInvoke(Object.assign({},i)))}}})}send(e,n){if(n)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,n){const r=[],i=[];for(;e.length;){const o=e.shift();r.length<20?r.push(o):i.push(o)}e.push(...i);for(const o of[...r]){var s;this.ltsList.indexOf(o.data.lts)!==-1?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),yy(s=this.ltsList).call(s,(a,A)=>a-A))}return n||(this.lastSendNormalEventTime=Date.now()),j("ENABLE_EVENT_REPORT")&&r.length&&(j("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((o=>a=>{j("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o),this.normalEventUploadPendingItems.length>j("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-j("NORMAL_EVENT_QUEUE_CAPACITY")),S.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){ar.networkState===go.OFFLINE&&await ye.race([ar.onlineWaiter,Zr(2*hr.maxRetryTimeout)]);const n=s=>{let o=new Uint8Array;return s.forEach(a=>{const A=wk(JSON.stringify(a.data)),u=new ArrayBuffer(5),d=(m=>{let g=0;return Object.entries(Nn).forEach(v=>{let[y,w]=v;w===m.type&&(g=GRe[y])}),g})(a),f=new DataView(u);f.setUint16(0,A.byteLength,!0),f.setUint8(2,255&d),f.setUint8(3,d>>>8&255),f.setUint8(4,d>>>16&255),o=S3(o,new Uint8Array(u)),o=S3(o,A)}),o},r="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let s=0;s<2;s+=1){s===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(j("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await XL(i,{timeout:1e4,data:n(e),headers:rt(rt({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o){if(s===1)throw o;continue}return}}async postDataToStatsCollector(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(o=>JSON.stringify(o)),vid:(o=>{const a=o&&o.data.sid&&this.baseInfoMap.get(o.data.sid);return a&&a.info.vid&&+a.info.vid||0})(e[0])};ar.networkState===go.OFFLINE&&await ye.race([ar.onlineWaiter,Zr(2*hr.maxRetryTimeout)]);const i=n?"/events/proto-raws":"/events/messages";let s=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(j("EVENT_REPORT_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(i));for(let o=0;o<2;o+=1){o===1&&(s=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(j("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(j("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(j("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(j("STATS_COLLECTOR_PORT")).concat(i)));try{n?await MRe(s,{timeout:1e4,data:r}):await XL(s,{timeout:1e4,data:r})}catch(a){if(o===1)throw a;continue}return}}createBaseInfo(e,n){const r=Object.assign({},KRe);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:n}),r}reportResourceTiming(e,n){const r=performance.getEntriesByName(e),i=r[r.length-1];i&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:i,tag:Mn.TRACER}).onSuccess()}}function Ve(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,r){const i=r.value;if(typeof i=="function"){const s=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);r.value=function(){for(var o=arguments.length,a=new Array(o),A=0;A<o;A++)a[A]=arguments[A];let u=a;if(t.argsMap)try{u=t.argsMap(this,...a)}catch(f){S.warning(f),u=[]}try{JSON.stringify(u)}catch{S.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),u=[]}const d=(t.report||Le).reportApiInvoke(this._sessionId||null,{name:"".concat(s,".").concat(String(n)),options:u,tag:Mn.TRACER,reportResult:t.reportResult},t.throttleTime);try{const f=i.apply(this,a);return f instanceof ye?f.then(m=>(d.onSuccess(t.reportResult&&m),m)).catch(m=>{throw d.onError(m),m}):(d.onSuccess(t.reportResult&&f),f)}catch(f){throw d.onError(f),f}}}return r}}$n(by,"__CLIENT_LIST__",[]);const Le=new by;N$.on("REPORT_LOG_UPLOAD",t=>{t.networkState=ar.networkState,Le.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Mn.TRACER}).onSuccess("logUploadError")});const WRe=["CHINA","GLOBAL"],ci=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let a=0;a<6;a++)i.push("1");const s=i.join(""),o={};return o[t]=r,o[e]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ci,Tk||(Zn.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Zn.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Zn.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Zn.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Zn.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Zn.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Zn.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Zn.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Zn.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Zn.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Zn.AREAS=["NORTH_AMERICA","OVERSEA"]);const D$=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Yu=[];function gh(t,e){return!!e&&Yu.some(n=>n.uid===t&&n.channelName===e)}by.__CLIENT_LIST__=Yu;var zRe=IJ.forEach,V3=_b("forEach")?[].forEach:function(t){return zRe(this,t,arguments.length>1?arguments[1]:void 0)};nn({target:"Array",proto:!0,forced:[].forEach!=V3},{forEach:V3});var qRe=pc("Array").forEach,YRe=WA,XRe=ki,JRe=Is,$Re=qRe,VN=Array.prototype,ZRe={DOMTokenList:!0,NodeList:!0},eOe=function(t){var e=t.forEach;return t===VN||JRe(VN,t)&&e===VN.forEach||XRe(ZRe,YRe(t))?$Re:e},tOe=tr(eOe),nOe=GA,Q3=wb;nn({target:"Object",stat:!0,forced:Cr(function(){Q3(1)})},{keys:function(t){return Q3(nOe(t))}});var B$=tr(Xc.Object.keys),rOe=tr(F7),iOe=nn,sOe=wy,oOe=mr([].reverse),H3=[1,2];iOe({target:"Array",proto:!0,forced:String(H3)===String(H3.reverse())},{reverse:function(){return sOe(this)&&(this.length=this.length),oOe(this)}});var aOe=pc("Array").reverse,cOe=Is,AOe=aOe,QN=Array.prototype,lOe=function(t){var e=t.reverse;return t===QN||cOe(QN,t)&&e===QN.reverse?AOe:e},L$=lOe,uOe=tr(L$),dOe=nn,j3=wy,hOe=Sb,fOe=qo,K3=VP,pOe=nu,mOe=Fd,gOe=Rb,_Oe=cr,EOe=ZP,vOe=CJ("slice"),yOe=_Oe("species"),HN=Array,wOe=Math.max;dOe({target:"Array",proto:!0,forced:!vOe},{slice:function(t,e){var n,r,i,s=mOe(this),o=pOe(s),a=K3(t,o),A=K3(e===void 0?o:e,o);if(j3(s)&&(n=s.constructor,(hOe(n)&&(n===HN||j3(n.prototype))||fOe(n)&&(n=n[yOe])===null)&&(n=void 0),n===HN||n===void 0))return EOe(s,a,A);for(r=new(n===void 0?HN:n)(wOe(A-a,0)),i=0;a<A;a++,i++)a in s&&gOe(r,i,s[a]);return r.length=i,r}});var COe=pc("Array").slice,TOe=Is,SOe=COe,jN=Array.prototype,bOe=function(t){var e=t.slice;return t===jN||TOe(jN,t)&&e===jN.slice?SOe:e},IOe=tr(bOe);function Oe(t,e,n,r,i){var s,o,a,A={};return tOe(s=B$(r)).call(s,function(u){A[u]=r[u]}),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=rOe(o=uOe(a=IOe(n).call(n)).call(a)).call(o,function(u,d){return d(t,e,u)||u},A),i&&A.initializer!==void 0&&(A.value=A.initializer?A.initializer.call(i):void 0,A.initializer=void 0),A.initializer===void 0&&(yJ(t,e,A),A=null),A}let JL=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),Bo=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({}),GT=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),KN=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),Fa=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),fs=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),xe=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),en=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),ze=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t}({}),We=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),Tv=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),ft=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),ys=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),Ye=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});class te extends ie{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),N(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,S)}throw(){super.throw(S)}}function Mb(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw S.error("Invalid Channel Name ".concat(t)),new te(L.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Fb(t){if(!function(e){return typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295}(t)&&!w$(t,1,255))throw new te(L.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof t=="string"&&S.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let xl=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const ROe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},GN={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function WN(t,e){zr(t.url,"".concat(e,".url"),1,1e3,!1),On(t.x)||jt(t.x,"".concat(e,".x"),0,1e4),On(t.y)||jt(t.y,"".concat(e,".y"),0,1e4),On(t.width)||jt(t.width,"".concat(e,".width"),0,1e4),On(t.height)||jt(t.height,"".concat(e,".height"),0,1e4),On(t.zOrder)||jt(t.zOrder,"".concat(e,".zOrder"),0,255),On(t.alpha)||jt(t.alpha,"".concat(e,".alpha"),0,1,!1)}const OOe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Xu=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),$L=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Er=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function G3(t){if(!t.channelName)throw new te(L.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new te(L.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&zr(t.token,"info.token",1,2047),Fb(t.uid),Mb(t.channelName),!0}let ps=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),bl=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),Xs=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Kp=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Lt=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),ai=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t}({}),WT=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),Pr=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Ot=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const W3=[Ot.AFRICA,Ot.ASIA,Ot.CHINA,Ot.EUROPE,Ot.GLOBAL,Ot.INDIA,Ot.JAPAN,Ot.NORTH_AMERICA,Ot.OCEANIA,Ot.OVERSEA,Ot.SOUTH_AMERICA];let Di=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const Vb={CHINA:{},ASIA:{CODE:Di.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Di.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Di.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Di.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Di.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Di.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Di.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Di.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Di.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Di.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Di.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Di.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Di.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Tk&&(Vb.CHINA={CODE:Di.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let ZL=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t}({});class U$ extends Ln{constructor(e,n){super(),N(this,"onICEConnectionStateChange",void 0),N(this,"onConnectionStateChange",void 0),N(this,"onDTLSTransportStateChange",void 0),N(this,"onDTLSTransportError",void 0),N(this,"onICETransportStateChange",void 0),N(this,"onFirstAudioReceived",void 0),N(this,"onFirstVideoReceived",void 0),N(this,"onFirstAudioDecoded",void 0),N(this,"onFirstVideoDecoded",void 0),N(this,"onFirstVideoDecodedTimeout",void 0),N(this,"onSelectedLocalCandidateChanged",void 0),N(this,"onSelectedRemoteCandidateChanged",void 0),N(this,"getLocalVideoStats",void 0)}}class P$ extends U${constructor(e,n){super(e,n),N(this,"establishPromise",void 0)}}let Ue=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),_o=function(t){return t[t.UDP=0]="UDP",t[t.TCP=1]="TCP",t[t.RELAY=2]="RELAY",t}({}),El=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.TCP_RESTART=1]="TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({}),Ae=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),Bt=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),Qe=function(t){return t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),za=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Va=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Vr=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),k$=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),bA=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),ha=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),kc=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Ep=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Jn=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),vp=function(t){return t.ABORT="abort",t}({}),id=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),NOe=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const DOe={[GT.ACCESS_POINT]:{[fs.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[fs.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[fs.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[fs.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[fs.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[fs.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[fs.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[GT.UNILBS]:{[Fa.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Fa.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Fa.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Fa.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Fa.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Fa.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Fa.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Fa.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Fa.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Fa.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Fa.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Fa.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[GT.STRING_UID_ALLOCATOR]:{[KN.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[KN.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[KN.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Xm(t){const e=DOe[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===GT.ACCESS_POINT){const r=t%1e4;if(r.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const BOe={[xe.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[xe.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[xe.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[xe.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[xe.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[xe.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[xe.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[xe.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[xe.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[xe.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[xe.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[xe.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[xe.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[xe.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[xe.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[xe.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[xe.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[xe.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[xe.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[xe.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[xe.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[xe.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[xe.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[xe.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[xe.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[xe.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[xe.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[xe.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[xe.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[xe.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[xe.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[xe.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[xe.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[xe.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[xe.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[xe.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[xe.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[xe.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[xe.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[xe.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[xe.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[xe.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[xe.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[xe.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[xe.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[xe.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[xe.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[xe.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[xe.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[xe.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[xe.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[xe.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[xe.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[xe.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[xe.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[xe.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[xe.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[xe.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[xe.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[xe.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[xe.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[xe.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Sv(t){return BOe[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function z3(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function zN(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?z3(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):z3(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function q3(t){return t.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)}function Y3(t,e){if(typeof t=="string")return t;const{proxy:n,host:r,port:i}=t;if(e){const s=j("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const LOe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,UOe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,POe=/wss:\/\/(.+):([0-9]+)\/?/,kOe=/wss:\/\/(.[^\/]+)\/?/;let xOe=0;class MOe{constructor(e,n){N(this,"id",0),N(this,"store",void 0),N(this,"recordIndex",void 0),N(this,"websockets",[]),N(this,"try443PortDuration",2e3),N(this,"forceCloseWSDuration",5e3),N(this,"try443PortTimeout",null),N(this,"forceCloseTimeout",null),N(this,"isTry443PortFailed",!1),N(this,"isNormalPortFailed",!1),N(this,"useDoubleDomain",!1),N(this,"useProxy",!1),N(this,"startTime",Date.now()),this.id=++xOe,this.try443PortDuration=j("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),s=0;s<r;s++)i[s]=arguments[s];S.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(e,n,r){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:r});const i=j("GATEWAY_DOMAINS"),s=Date.now(),o=[],a=i.find(d=>{var f;return Te(f=e.host).call(f,d)});a||(this.useDoubleDomain=!1);const A=[];if(this.useDoubleDomain)i.forEach(d=>{A.push(Y3(zN(zN({},e),{},{host:e.host.replace(a,d)}),n))});else{const d=zN({},e);if(n&&a){const f=i.find(m=>m!==a);f&&(d.host=d.host.replace(a,f))}A.push(Y3(d,n))}try{A.forEach(d=>{const f=new WebSocket(d);f.binaryType="arraybuffer",o.push(f),this.logger("ws is connecting:",f.url)})}catch(d){if(this.logger("ws create failed"),o.forEach(f=>f.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,r);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,r);throw new te(L.WS_ERR,"init websocket failed! Error: ".concat(d.toString()))}const u=yv();return this.store&&this.store.recordJoinChannelService({urls:o.map(d=>d.url),service:"gateway"},this.recordIndex),o.forEach(d=>{d.onopen=()=>{this.logger("onopen: ws ".concat(d.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(f=>{f!==d&&(f.onopen=null,f.onclose=null,f.onmessage=null,f.close(),this.logger("close backup websocket: ".concat(f.url)))}),this.websockets.length=0,u.resolve(d)},d.onclose=f=>{this.logger("onclose: ws ".concat(d.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(d.readyState)),n?this.isTry443PortFailed=q3(o):this.isNormalPortFailed=q3(o),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(n&&this.isTry443PortFailed||!n&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(f.reason)),u.reject({code:f.code,reason:WT.A_ROUND_WS_FAILED}))},d.onmessage=f=>this.logger("".concat(d.url," onmessage: ").concat(f.data))}),this.websockets.push(...o),r||(()=>{const d=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",u.isResolved),this.websockets.forEach(f=>f.readyState!==WebSocket.OPEN&&f.close())};if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(d,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",u.isResolved),u.isResolved)return d();yt().os===kr.MAC_OS&&Vn()&&d(),this.createWebSocket(e,!0,!0).then(f=>u.resolve(f)).catch(f=>{this.isNormalPortFailed&&u.reject(f),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(d,this.forceCloseWSDuration)},this.try443PortDuration)})(),u.promise}chooseBestWebsocket(e,n,r,i){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(s){let o,a,A;return[,o,a,A]=s.match(LOe)||[],o||([,a,A]=s.match(UOe)||[]),a&&A||([,a,A]=s.match(POe)||[]),a&&A||([,a]=s.match(kOe)||[]),a||S.warning("un-destructible url: ",s),{proxy:o,host:a,port:A||"443"}}(e)),this.recordIndex=i,this.useProxy=!!e.proxy,r&&this.useProxy&&(S.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(e,!!r,!1).finally(()=>this.clearTimeout())}}function X3(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}class x$ extends Ln{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;Te(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(Ye.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ye.CONNECTED):this._state==="closed"?this.emit(Ye.CLOSED):this._state==="failed"&&this.emit(Ye.FAILED))}resetReconnectCount(e){S.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),N(this,"connectionID",0),N(this,"currentURLIndex",0),N(this,"urls",[]),N(this,"_reconnectMode","tryNext"),N(this,"reconnectReason",void 0),N(this,"_initMutex",new Pi("websocket")),N(this,"name",void 0),N(this,"_state","closed"),N(this,"reconnectInterrupter",void 0),N(this,"websocket",void 0),N(this,"retryConfig",void 0),N(this,"reconnectCount",0),N(this,"forceCloseTimeout",5e3),N(this,"onlineReconnectListener",void 0),N(this,"useCompress",void 0),N(this,"tryDoubleDomain",!1),N(this,"use443PortOnly",!1),N(this,"wsInflateLength",0),N(this,"wsDeflateLength",0),N(this,"closeEstablishingWs",()=>{}),N(this,"store",void 0),N(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=function(f){for(var m=1;m<arguments.length;m++){var g=arguments[m]!=null?arguments[m]:{};m%2?X3(Object(g),!0).forEach(function(v){N(f,v,g[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(g)):X3(Object(g)).forEach(function(v){Object.defineProperty(f,v,Object.getOwnPropertyDescriptor(g,v))})}return f}({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=s;const{timeout:a,timeoutFactor:A}=n,u=Math.max(300,Math.floor(3*a/5)),d=Math.max(1.2,Math.floor(8*A)/10);go.ONLINE&&(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=d),ar.on(nm.NETWORK_STATE_CHANGE,(f,m)=>{f!==m&&(this.resetReconnectCount("network state change: ".concat(m," -> ").concat(f)),f===go.ONLINE?(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=d):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=A))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const i=yv(),s=this.urls[this.currentURLIndex];j("ENABLE_PREALLOC_PC")&&this.emit(k$.PRE_CONNECT_PC),this.createWebSocketConnection(s).then(i.resolve).catch(i.reject),this.once(Ye.CLOSED,()=>{i.reject(new ie(L.WS_DISCONNECT))}),this.once(Ye.CONNECTED,i.resolve),await i.promise}catch{}finally{r()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void S.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),S.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new ie(L.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(r){throw new ie(L.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const r=yv();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=d=>{var f;(f=this.store)===null||f===void 0||f.signalChannelOpen(),S.debug("[".concat(this.name,"] websocket opened:"),d),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},s=async d=>{var f;if(S.debug("[".concat(this.name,"] websocket close ").concat((f=this.websocket)===null||f===void 0?void 0:f.url,", code: ").concat(d.code,", reason: ").concat(d.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new ie(L.WS_DISCONNECT,"websocket close: ".concat(d.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=d.reason,this.state="reconnecting");const m=va(this,Ye.WILL_RECONNECT,this.reconnectMode,d.reason)||this.reconnectMode,g=await this.reconnectWithAction(m);if(this.state==="closed")return void S.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!g)return r.reject(new ie(L.WS_DISCONNECT,"websocket reconnect failed: ".concat(d.code))),this.close(!0);r.resolve()}},o=d=>{this.emit(Ye.ON_MESSAGE,d)},a=d=>{S.warn("[".concat(this.connectionID,"] ws open error ").concat(d))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),j("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=j("GATEWAY_WSS_ADDRESS")),S.debug("[".concat(this.name,"] start connect, url:"),e);const A=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var u;const d=await this.chooseBestWebsocketConnection(e);this.websocket=d,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=a,(u=this.store)===null||u===void 0||u.recordJoinChannelService({endTs:Date.now(),status:"success"},A),this.joinGatewayRecordIndex=A}catch(d){const f=this.state==="closed",m=d instanceof ie,g=m&&d.code===L.WS_ABORT,v=m&&d.code===L.WS_ERR,y=m?d.message:d&&(d.reason||d.toString());S.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(y)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:g?"aborted":"error",errors:[d]},A),f||v?(r.reject(f?new ie(L.WS_DISCONNECT,"websocket is closed: ".concat(y)):new ie(L.WS_ERR,"init websocket failed: ".concat(y))),v&&S.error("[".concat(this.name,"] init websocket failed: ").concat(y))):s&&s(d)}return r.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;S.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||ar.isOnline||!ar.onlineWaiter||(this.onlineReconnectListener=ar.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const o=Ck(this.reconnectCount,this.retryConfig);S.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(e)),await ye.race([Zr(o),this.onlineReconnectListener||new ye(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(o,a)=>{this.emit(Ye.RECONNECT_CREATE_CONNECTION,a),await this.createWebSocketConnection(o)};try{if(e==="retry")this.emit(Ye.RECONNECT_WAITTING_FINISH,e),await i(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);S.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Ye.RECONNECT_WAITTING_FINISH,e),await i(this.urls[this.currentURLIndex],e)}else e==="recover"&&(S.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Ye.RECONNECT_WAITTING_FINISH,e),this.urls=await fi(this,Ye.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],e))}catch(o){var s;S.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));const a=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(a)&&Te(a).call(a,"dynamic key expired")?(this.emit(Ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class Ik extends x${constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const r=yv(),i=function(o,a){return new MOe(o,a)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new ie(L.WS_ABORT,"choose best websocket aborted"))};const s=j("GATEWAY_DOMAINS");return S.debug("[choose-best-ws] currentDomain: ",e,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class bv extends x${constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new ye((r,i)=>{let s=!1;const o=[];this.closeEstablishingWs=()=>{S.debug("[choose-best-ws] close establishing websockets"),o.forEach(v=>{v.onclose=null,v.onopen=null,v.onmessage=null,v.close()}),i(new ie(L.WS_ABORT,"choose best websocket aborted"))};const a=j("GATEWAY_DOMAINS");let A;const u=e.indexOf("?h="),d=a.find(v=>u!==-1?Te(e).call(e,v,u):Te(e).call(e,v));S.debug("[choose-best-ws] currentDomain: ",d,", domains: ",a);let f=!this.tryDoubleDomain||!d;if(!f&&d){var m;const v=Date.now();try{a.forEach(y=>{const w=u===-1?e.replace(d,y):e.substr(0,u)+e.substr(u).replace(d,y),b=new WebSocket(w);b.binaryType="arraybuffer",o.push(b),S.debug("[choose-best-ws] ws is connecting:",b.url)})}catch{for(S.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(w=>w.close());o.length;)o.pop();f=!0}(m=this.store)===null||m===void 0||m.recordJoinChannelService({urls:o.map(y=>y.url),service:"gateway"},n),o.forEach(y=>{y.onopen=()=>{if(s)return;const w=Date.now()-v;S.debug("[choose-best-ws] ws open cost ".concat(w,"ms")),o.filter(b=>b!==y).forEach(b=>{S.debug("[choose-best-ws]close backup websocket: ".concat(b.url)),b.close()}),s=!0,r(y)},y.onclose=w=>{A=w,!s&&(o.find(b=>!(b.readyState===WebSocket.CLOSED||b.readyState===WebSocket.CLOSING))||(S.debug("[choose-best-ws] all websocket is closed"),s=!0,i(A)))},y.onmessage=w=>{S.debug("[choose-best-ws]".concat(y.url," onmessage: ").concat(w.data))}}),Zr(this.forceCloseTimeout).then(()=>{o.forEach(y=>{y.readyState!==WebSocket.OPEN&&y.close()})})}if(f){var g;let v;S.debug("[choose-best-ws] use single url: ",e),(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:[e],service:"gateway"},n);try{v=new WebSocket(e),o.push(v),v.binaryType="arraybuffer"}catch(y){const w=new ie(L.WS_ERR,"init websocket failed! Error: ".concat(y.toString()));return S.error("[".concat(this.name,"]").concat(w)),void i(w)}v.onopen=()=>{r(v)},v.onclose=y=>{i(y)},v.onmessage=y=>{S.debug("[choose-best-ws]".concat(v.url," onmessage: ").concat(y.data))},Zr(this.forceCloseTimeout).then(()=>{v&&v.readyState!==WebSocket.OPEN&&v.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class FOe extends Ln{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===en.CONNECTED?this.emit(ze.WS_CONNECTED):e===en.RECONNECTING?this.emit(ze.WS_RECONNECTING,this._websocketReconnectReason):e===en.CLOSED&&this.emit(ze.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",en.CLOSED),N(this,"reconnectToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new O$(5)),N(this,"pingpongTimer",void 0),N(this,"wsInflateDataTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ze.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===ft.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===ft.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Mt.UID_BANNED);break;case 15:this.close(Mt.IP_BANNED);break;case 16:this.close(Mt.CHANNEL_BANNED)}if(i._type===ft.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case xe.ERR_LICENSE_MISSING:this.close(Mt.LICENSE_MISSING);break;case xe.ERR_LICENSE_EXPIRED:this.close(Mt.LICENSE_EXPIRED);break;case xe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Mt.LICENSE_MINUTES_EXCEEDED);break;case xe.ERR_LICENSE_PERIOD_INVALID:this.close(Mt.LICENSE_PERIOD_INVALID);break;case xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Mt.LICENSE_MULTIPLE_SDK_SERVICE);break;case xe.ERR_LICENSE_ILLEGAL:this.close(Mt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new Ik("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===en.CONNECTED&&this.reconnect("retry",li.OFFLINE)})}async request(e,n,r,i){const s=tn(6,""),o={_id:s,_type:e,_message:n},a=this.websocket.connectionID,A=()=>new ye((v,y)=>{if(this.connectionState===en.CONNECTED)return v();const w=()=>{this.off(ze.WS_CLOSED,b),v()},b=()=>{this.off(ze.WS_CONNECTED,w),y(new te(L.WS_ABORT))};this.once(ze.WS_CONNECTED,w),this.once(ze.WS_CLOSED,b),e!==We.PUBLISH&&e!==We.PUBLISH_DATASTREAM&&e!==We.SUBSCRIBE&&e!==We.SUBSCRIBE_DATASTREAM&&e!==We.UNSUBSCRIBE&&e!==We.UNSUBSCRIBE_DATASTREAM&&e!==We.UNPUBLISH&&e!==We.UNPUBLISH_DATASTREAM&&e!==We.CONTROL&&e!==We.RESTART_ICE||this.once(ze.DISCONNECT_P2P,()=>{y(new te(L.DISCONNECT_P2P))}),e!==We.PUBLISH&&e!==We.RESTART_ICE||this.once(ze.ABORT_P2P_EXECUTION,()=>{y(new te(L.DISCONNECT_P2P))})});if(this.connectionState!==en.CONNECTING&&this.connectionState!==en.RECONNECTING||e===We.JOIN||e===We.REJOIN||await A(),this.websocket.sendMessage(o,!0),i)return;const u=new ye((v,y)=>{let w=!1;const b=(B,M)=>{w=!0,v({isSuccess:B==="success",message:M||{}}),this.off(ze.WS_CLOSED,I),this.off(ze.WS_RECONNECTING,I),this.emit(ze.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),b);const I=()=>{y(new te(L.WS_ABORT,"type: ".concat(e))),this.off(ze.WS_CLOSED,I),this.off(ze.WS_RECONNECTING,I),this.off("res-@".concat(s),b)};this.once(ze.WS_CLOSED,I),this.once(ze.WS_RECONNECTING,I),Zr(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||w||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(ze.REQUEST_TIMEOUT,e,n))})});let d=null;try{d=await u}catch(v){if(this.connectionState===en.CLOSED||e===We.LEAVE)throw new te(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?v.throw():e===We.JOIN||e===We.REJOIN?null:(await A(),await this.request(e,n))}if(d.isSuccess)return d.message;const f=Number(d.message.error_code||d.message.code),m=Sv(f),g=new te(L.UNEXPECTED_RESPONSE,"".concat(m.desc,": ").concat(d.message.error_str),{code:f,data:d.message,desc:m.desc});return m.action==="success"?d.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(f,", message: ").concat(m.desc,", action: ").concat(m.action)),f===xe.ERR_TOO_MANY_BROADCASTERS?((e===We.JOIN||e===We.REJOIN)&&(this.initError=g,this.close()),g.throw()):m.action==="failed"?g.throw():m.action==="quit"?(this.initError=g,this.close(),g.throw()):(f===xe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=d.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",li.MULTI_IP)):this.reconnect(m.action,li.SERVER_ERROR),e===We.JOIN||e===We.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new ye(r=>{const i=s=>{(!n||n(s))&&(this.off(e,i),r(s))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Tv.WRTC_STATS,n)}upload(e,n){const r={_type:e,_message:n};try{this.websocket.sendMessage(r)}catch{const s=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==en.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const r={_type:e,_message:n};this.websocket.sendMessage(r)}init(e,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ye((r,i)=>{this.once(ze.WS_CONNECTED,()=>r(this.joinResponse)),this.once(ze.WS_CLOSED,()=>i(this.initError||new te(L.WS_ABORT))),this.connectionState=en.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Mt.LEAVE,this.connectionState=en.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(ze.ABORT_P2P_EXECUTION);const e=await fi(this,ze.REQUEST_JOIN_INFO),n=await this.request(We.JOIN,e);if(!n)return this.emit(ze.REPORT_JOIN_GATEWAY,WT.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ze.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=en.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new te(L.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Cv(this,ze.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(We.REJOIN,e);return!!n&&(this.connectionState=en.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(ft.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(ft.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(ft.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(ft.MUTE_AUDIO,{uid:r.uid}):this.emit(ft.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(ft.MUTE_VIDEO,{uid:r.uid}):this.emit(ft.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(ft.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(ft.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(ft.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(ft.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(ft.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){S.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Sv(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Mt.UID_BANNED),void this.close()):void this.reconnect(n.action,li.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=j("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(S.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",li.TIMEOUT):this.request(We.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),j("REPORT_STATS")&&this.send(We.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(Tv.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Ye.RECONNECT_WAITTING_FINISH,e=>{this.emit(ze.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(Ye.RECONNECT_CREATE_CONNECTION,e=>{this.emit(ze.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Ye.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ye.CLOSED,()=>{this.connectionState=en.CLOSED}),this.websocket.on(Ye.FAILED,()=>{this._disconnectedReason=Mt.NETWORK_ERROR,this.connectionState=en.CLOSED}),this.websocket.on(Ye.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===en.CONNECTED?this.connectionState=en.RECONNECTING:this.connectionState=en.CONNECTING}),this.websocket.on(Ye.WILL_RECONNECT,(e,n,r)=>{const i=Cv(this,ze.IS_P2P_DISCONNECTED),s=i||e!=="retry";i&&e==="retry"&&(S.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=WT.P2P_DISCONNECTED),s&&(S.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(ze.REPORT_JOIN_GATEWAY,n||WT.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(ze.DISCONNECT_P2P)),r(e)}),this.websocket.on(Ye.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{S.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",li.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(ze.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof te){if(e.code===L.UNEXPECTED_RESPONSE&&e.data.code===xe.ERR_NO_AUTHORIZED)return this.initError=new te(L.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",li.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",li.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Ye.REQUEST_NEW_URLS,(e,n)=>{fi(this,ze.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(Ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(k$.PRE_CONNECT_PC,()=>{this.emit(ze.PRE_CONNECT_PC)})}}let or=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function J3(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function TC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?J3(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):J3(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function sm(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(j("TURN_DOMAIN")):(S.info("Unidentified as ip: ".concat(t,", use as host")),t)}function Rk(t,e){t.addresses||(t.addresses=[]);const n=function(a,A){if(j("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a.map(f=>{let{ip:m,port:g}=f;return{address:"".concat(m,":").concat(g)}});const u=j("GATEWAY_DOMAINS");let d=u[1]&&Te(A).call(A,u[1])?1:0;return a.map(f=>{let{domain_prefix:m,port:g,ip:v}=f;if(m)return{address:"".concat(m,".").concat(u[d++%u.length],":").concat(g)};const y=/^[\.\:\d]+$/.test(v),w=y?"".concat(v.replace(/[^\d]/g,"-"),".").concat(u[d++%u.length],":").concat(g):"".concat(v,":").concat(g);return y||S.info("Unidentified as ip: ".concat(v,", use as host")),{ip:v,port:g,address:w}})}(t.addresses,e),r=Array.isArray(t.detail)&&t.detail[18];if(r&&typeof r=="string"){const a=r.split(";");for(let A=0;A<a.length;A++){var i;const u=is(i=a[A]).call(i);n[A]&&u&&(n[A].ip6=u)}}const s=t.detail&&t.detail.candidate;let o;if(s){const[a,A]=s.split(":");a&&A&&(o={port:Number(A),ip:a,address:"".concat(a,":").concat(A)})}return{gatewayAddrs:n,apGatewayAddress:o,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function vo(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function $3(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(vo(e.width),"x").concat(vo(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function Z3(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function Iv(t,e){let n,r,i;switch(e){case or.CHOOSE_SERVER:r=4096,i="choose server";break;case or.CLOUD_PROXY:r=1048576,i="proxy";break;case or.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case or.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new te(L.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(s=>{s.buffer&&s.buffer.flag===r&&(n={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(o=>TC(TC({},o),{},{ticket:s.buffer.cert})),server_ts:t.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:TC(TC({},s.buffer.detail),t.detail),flag:s.buffer.flag,opid:t.opid,cert:s.buffer.cert})}),!n)throw new te(L.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function M$(t,e){return await ye.all(t.addresses.map(async n=>({address:sm(n.ip),tcpport:n.port,udpport:n.port,username:e&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():ci.username,password:e&&j("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await qL(e.toString()):ci.password})))}function eU(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),r=e.videoHeight||n.height,i=e.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(vo(t.height),vo(t.width)),1):(S.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function sd(t){let{candidateType:e,relayProtocol:n,type:r,address:i,port:s,protocol:o}=t;return r==="local-candidate"?{candidateType:e,relayProtocol:n,protocol:o}:{candidateType:e,relayProtocol:n,address:i,port:s,protocol:o}}var Qa,VOe=tr(L$),QOe=pc("Array").values,HOe=WA,jOe=ki,KOe=Is,GOe=QOe,qN=Array.prototype,WOe={DOMTokenList:!0,NodeList:!0},zOe=function(t){var e=t.values;return t===qN||KOe(qN,t)&&e===qN.values||jOe(WOe,HOe(t))?GOe:e},Hl=tr(zOe),eK=Sa,qOe=mr,YOe=Ei,XOe=Cr,YN=wb,JOe=my,$Oe=fb,ZOe=GA,eNe=pb,yp=Object.assign,tK=Object.defineProperty,tNe=qOe([].concat),nNe=!yp||XOe(function(){if(eK&&yp({b:1},yp(tK({},"a",{enumerable:!0,get:function(){tK(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(i){e[i]=i}),yp({},t)[n]!=7||YN(yp({},e)).join("")!=r})?function(t,e){for(var n=ZOe(t),r=arguments.length,i=1,s=JOe.f,o=$Oe.f;r>i;)for(var a,A=eNe(arguments[i++]),u=s?tNe(YN(A),s(A)):YN(A),d=u.length,f=0;d>f;)a=u[f++],eK&&!YOe(o,A,a)||(n[a]=A[a]);return n}:yp,rNe=so,iNe=J7,sNe=Vd,oNe=Ei,aNe=GA,cNe=function(t,e,n,r){try{return r?e(rNe(n)[0],n[1]):e(n)}catch(i){iNe(t,"throw",i)}},ANe=X7,lNe=Sb,uNe=nu,nK=Rb,dNe=zP,hNe=Cb,rK=Array,If=mr,XN=2147483647,fNe=/[^\0-\u007E]/,F$=/[.\u3002\uFF0E\uFF61]/g,iK="Overflow: input needs wider integers to process",sK=RangeError,pNe=If(F$.exec),om=Math.floor,JN=String.fromCharCode,oK=If("".charCodeAt),V$=If([].join),Fu=If([].push),mNe=If("".replace),gNe=If("".split),_Ne=If("".toLowerCase),aK=function(t){return t+22+75*(t<26)},ENe=function(t,e,n){var r=0;for(t=n?om(t/700):t>>1,t+=om(t/e);t>455;)t=om(t/35),r+=36;return om(r+36*t/(t+38))},vNe=function(t){var e=[];t=function(b){for(var I=[],B=0,M=b.length;B<M;){var H=oK(b,B++);if(H>=55296&&H<=56319&&B<M){var K=oK(b,B++);(64512&K)==56320?Fu(I,((1023&H)<<10)+(1023&K)+65536):(Fu(I,H),B--)}else Fu(I,H)}return I}(t);var n,r,i=t.length,s=128,o=0,a=72;for(n=0;n<t.length;n++)(r=t[n])<128&&Fu(e,JN(r));var A=e.length,u=A;for(A&&Fu(e,"-");u<i;){var d=XN;for(n=0;n<t.length;n++)(r=t[n])>=s&&r<d&&(d=r);var f=u+1;if(d-s>om((XN-o)/f))throw sK(iK);for(o+=(d-s)*f,s=d,n=0;n<t.length;n++){if((r=t[n])<s&&++o>XN)throw sK(iK);if(r==s){for(var m=o,g=36;;){var v=g<=a?1:g>=a+26?26:g-a;if(m<v)break;var y=m-v,w=36-v;Fu(e,JN(aK(v+y%w))),m=om(y/w),g+=36}Fu(e,JN(aK(m))),a=ENe(o,f,u==A),o=0,u++}}o++,s++}return V$(e,"")},yNe=nn,Ok=Sa,wNe=fk,Nk=gi,cK=Vd,mc=mr,SC=Hd,Ha=Tb,CNe=XP,tU=ki,Dk=nNe,wp=function(t){var e=aNe(t),n=lNe(this),r=arguments.length,i=r>1?arguments[1]:void 0,s=i!==void 0;s&&(i=sNe(i,r>2?arguments[2]:void 0));var o,a,A,u,d,f,m=hNe(e),g=0;if(!m||this===rK&&ANe(m))for(o=uNe(e),a=n?new this(o):rK(o);o>g;g++)f=s?i(e[g],g):e[g],nK(a,g,f);else for(d=(u=dNe(e,m)).next,a=n?new this:[];!(A=oNe(d,u)).done;g++)f=s?cNe(u,i,[A.value,g],!0):A.value,nK(a,g,f);return a.length=g,a},Dc=sk,TNe=ik.codeAt,SNe=function(t){var e,n,r=[],i=gNe(mNe(_Ne(t),F$,"."),".");for(e=0;e<i.length;e++)n=i[e],Fu(r,pNe(fNe,n)?"xn--"+vNe(n):n);return V$(r,".")},Il=ba,bNe=jd,INe=bb,Q$=GIe,H$=bf,RNe=H$.set,AS=H$.getterFor("URL"),ONe=Q$.URLSearchParams,NNe=Q$.getState,Q_=Nk.URL,nU=Nk.TypeError,bC=Nk.parseInt,DNe=Math.floor,AK=Math.pow,Ja=mc("".charAt),Uc=mc(/./.exec),oE=mc([].join),BNe=mc(1 .toString),LNe=mc([].pop),Cp=mc([].push),$N=mc("".replace),UNe=mc([].shift),PNe=mc("".split),aE=mc("".slice),zT=mc("".toLowerCase),kNe=mc([].unshift),ZN="Invalid scheme",_h="Invalid host",lK="Invalid port",j$=/[a-z]/i,xNe=/[\d+-.a-z]/i,eD=/\d/,MNe=/^0x/i,FNe=/^[0-7]+$/,VNe=/^\d+$/,uK=/^[\da-f]+$/i,QNe=/[\0\t\n\r #%/:<>?@[\\\]^|]/,HNe=/[\0\t\n\r #/:<>?@[\\\]^|]/,jNe=/^[\u0000-\u0020]+/,KNe=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,GNe=/[\t\n\r]/g,H_=function(t){var e,n,r,i;if(typeof t=="number"){for(e=[],n=0;n<4;n++)kNe(e,t%256),t=DNe(t/256);return oE(e,".")}if(typeof t=="object"){for(e="",r=function(s){for(var o=null,a=1,A=null,u=0,d=0;d<8;d++)s[d]!==0?(u>a&&(o=A,a=u),A=null,u=0):(A===null&&(A=d),++u);return u>a&&(o=A,a=u),o}(t),n=0;n<8;n++)i&&t[n]===0||(i&&(i=!1),r===n?(e+=n?":":"::",i=!0):(e+=BNe(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},qT={},K$=Dk({},qT,{" ":1,'"':1,"<":1,">":1,"`":1}),G$=Dk({},K$,{"#":1,"?":1,"{":1,"}":1}),tD=Dk({},G$,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Bu=function(t,e){var n=TNe(t,0);return n>32&&n<127&&!tU(e,t)?t:encodeURIComponent(t)},IC={ftp:21,file:null,http:80,https:443,ws:80,wss:443},cE=function(t,e){var n;return t.length==2&&Uc(j$,Ja(t,0))&&((n=Ja(t,1))==":"||!e&&n=="|")},dK=function(t){var e;return t.length>1&&cE(aE(t,0,2))&&(t.length==2||(e=Ja(t,2))==="/"||e==="\\"||e==="?"||e==="#")},WNe=function(t){return t==="."||zT(t)==="%2e"},nD={},hK={},rD={},fK={},pK={},iD={},mK={},gK={},RC={},OC={},sD={},oD={},aD={},cD={},_K={},AD={},Tp={},pA={},EK={},Eh={},vl={},Bk=function(t,e,n){var r,i,s,o=Il(t);if(e){if(i=this.parse(o))throw nU(i);this.searchParams=null}else{if(n!==void 0&&(r=new Bk(n,!0)),i=this.parse(o,null,r))throw nU(i);(s=NNe(new ONe)).bindURL(this),this.searchParams=s}};Bk.prototype={type:"URL",parse:function(t,e,n){var r,i,s,o,a,A=this,u=e||nD,d=0,f="",m=!1,g=!1,v=!1;for(t=Il(t),e||(A.scheme="",A.username="",A.password="",A.host=null,A.port=null,A.path=[],A.query=null,A.fragment=null,A.cannotBeABaseURL=!1,t=$N(t,jNe,""),t=$N(t,KNe,"$1")),t=$N(t,GNe,""),r=wp(t);d<=r.length;){switch(i=r[d],u){case nD:if(!i||!Uc(j$,i)){if(e)return ZN;u=rD;continue}f+=zT(i),u=hK;break;case hK:if(i&&(Uc(xNe,i)||i=="+"||i=="-"||i=="."))f+=zT(i);else{if(i!=":"){if(e)return ZN;f="",u=rD,d=0;continue}if(e&&(A.isSpecial()!=tU(IC,f)||f=="file"&&(A.includesCredentials()||A.port!==null)||A.scheme=="file"&&!A.host))return;if(A.scheme=f,e)return void(A.isSpecial()&&IC[A.scheme]==A.port&&(A.port=null));f="",A.scheme=="file"?u=cD:A.isSpecial()&&n&&n.scheme==A.scheme?u=fK:A.isSpecial()?u=gK:r[d+1]=="/"?(u=pK,d++):(A.cannotBeABaseURL=!0,Cp(A.path,""),u=EK)}break;case rD:if(!n||n.cannotBeABaseURL&&i!="#")return ZN;if(n.cannotBeABaseURL&&i=="#"){A.scheme=n.scheme,A.path=Dc(n.path),A.query=n.query,A.fragment="",A.cannotBeABaseURL=!0,u=vl;break}u=n.scheme=="file"?cD:iD;continue;case fK:if(i!="/"||r[d+1]!="/"){u=iD;continue}u=RC,d++;break;case pK:if(i=="/"){u=OC;break}u=pA;continue;case iD:if(A.scheme=n.scheme,i==Qa)A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=Dc(n.path),A.query=n.query;else if(i=="/"||i=="\\"&&A.isSpecial())u=mK;else if(i=="?")A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=Dc(n.path),A.query="",u=Eh;else{if(i!="#"){A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=Dc(n.path),A.path.length--,u=pA;continue}A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,A.path=Dc(n.path),A.query=n.query,A.fragment="",u=vl}break;case mK:if(!A.isSpecial()||i!="/"&&i!="\\"){if(i!="/"){A.username=n.username,A.password=n.password,A.host=n.host,A.port=n.port,u=pA;continue}u=OC}else u=RC;break;case gK:if(u=RC,i!="/"||Ja(f,d+1)!="/")continue;d++;break;case RC:if(i!="/"&&i!="\\"){u=OC;continue}break;case OC:if(i=="@"){m&&(f="%40"+f),m=!0,s=wp(f);for(var y=0;y<s.length;y++){var w=s[y];if(w!=":"||v){var b=Bu(w,tD);v?A.password+=b:A.username+=b}else v=!0}f=""}else if(i==Qa||i=="/"||i=="?"||i=="#"||i=="\\"&&A.isSpecial()){if(m&&f=="")return"Invalid authority";d-=wp(f).length+1,f="",u=sD}else f+=i;break;case sD:case oD:if(e&&A.scheme=="file"){u=AD;continue}if(i!=":"||g){if(i==Qa||i=="/"||i=="?"||i=="#"||i=="\\"&&A.isSpecial()){if(A.isSpecial()&&f=="")return _h;if(e&&f==""&&(A.includesCredentials()||A.port!==null))return;if(o=A.parseHost(f))return o;if(f="",u=Tp,e)return;continue}i=="["?g=!0:i=="]"&&(g=!1),f+=i}else{if(f=="")return _h;if(o=A.parseHost(f))return o;if(f="",u=aD,e==oD)return}break;case aD:if(!Uc(eD,i)){if(i==Qa||i=="/"||i=="?"||i=="#"||i=="\\"&&A.isSpecial()||e){if(f!=""){var I=bC(f,10);if(I>65535)return lK;A.port=A.isSpecial()&&I===IC[A.scheme]?null:I,f=""}if(e)return;u=Tp;continue}return lK}f+=i;break;case cD:if(A.scheme="file",i=="/"||i=="\\")u=_K;else{if(!n||n.scheme!="file"){u=pA;continue}if(i==Qa)A.host=n.host,A.path=Dc(n.path),A.query=n.query;else if(i=="?")A.host=n.host,A.path=Dc(n.path),A.query="",u=Eh;else{if(i!="#"){dK(oE(Dc(r,d),""))||(A.host=n.host,A.path=Dc(n.path),A.shortenPath()),u=pA;continue}A.host=n.host,A.path=Dc(n.path),A.query=n.query,A.fragment="",u=vl}}break;case _K:if(i=="/"||i=="\\"){u=AD;break}n&&n.scheme=="file"&&!dK(oE(Dc(r,d),""))&&(cE(n.path[0],!0)?Cp(A.path,n.path[0]):A.host=n.host),u=pA;continue;case AD:if(i==Qa||i=="/"||i=="\\"||i=="?"||i=="#"){if(!e&&cE(f))u=pA;else if(f==""){if(A.host="",e)return;u=Tp}else{if(o=A.parseHost(f))return o;if(A.host=="localhost"&&(A.host=""),e)return;f="",u=Tp}continue}f+=i;break;case Tp:if(A.isSpecial()){if(u=pA,i!="/"&&i!="\\")continue}else if(e||i!="?")if(e||i!="#"){if(i!=Qa&&(u=pA,i!="/"))continue}else A.fragment="",u=vl;else A.query="",u=Eh;break;case pA:if(i==Qa||i=="/"||i=="\\"&&A.isSpecial()||!e&&(i=="?"||i=="#")){if((a=zT(a=f))===".."||a==="%2e."||a===".%2e"||a==="%2e%2e"?(A.shortenPath(),i=="/"||i=="\\"&&A.isSpecial()||Cp(A.path,"")):WNe(f)?i=="/"||i=="\\"&&A.isSpecial()||Cp(A.path,""):(A.scheme=="file"&&!A.path.length&&cE(f)&&(A.host&&(A.host=""),f=Ja(f,0)+":"),Cp(A.path,f)),f="",A.scheme=="file"&&(i==Qa||i=="?"||i=="#"))for(;A.path.length>1&&A.path[0]==="";)UNe(A.path);i=="?"?(A.query="",u=Eh):i=="#"&&(A.fragment="",u=vl)}else f+=Bu(i,G$);break;case EK:i=="?"?(A.query="",u=Eh):i=="#"?(A.fragment="",u=vl):i!=Qa&&(A.path[0]+=Bu(i,qT));break;case Eh:e||i!="#"?i!=Qa&&(i=="'"&&A.isSpecial()?A.query+="%27":A.query+=i=="#"?"%23":Bu(i,qT)):(A.fragment="",u=vl);break;case vl:i!=Qa&&(A.fragment+=Bu(i,K$))}d++}},parseHost:function(t){var e,n,r;if(Ja(t,0)=="["){if(Ja(t,t.length-1)!="]"||(e=function(i){var s,o,a,A,u,d,f,m=[0,0,0,0,0,0,0,0],g=0,v=null,y=0,w=function(){return Ja(i,y)};if(w()==":"){if(Ja(i,1)!=":")return;y+=2,v=++g}for(;w();){if(g==8)return;if(w()!=":"){for(s=o=0;o<4&&Uc(uK,w());)s=16*s+bC(w(),16),y++,o++;if(w()=="."){if(o==0||(y-=o,g>6))return;for(a=0;w();){if(A=null,a>0){if(!(w()=="."&&a<4))return;y++}if(!Uc(eD,w()))return;for(;Uc(eD,w());){if(u=bC(w(),10),A===null)A=u;else{if(A==0)return;A=10*A+u}if(A>255)return;y++}m[g]=256*m[g]+A,++a!=2&&a!=4||g++}if(a!=4)return;break}if(w()==":"){if(y++,!w())return}else if(w())return;m[g++]=s}else{if(v!==null)return;y++,v=++g}}if(v!==null)for(d=g-v,g=7;g!=0&&d>0;)f=m[g],m[g--]=m[v+d-1],m[v+--d]=f;else if(g!=8)return;return m}(aE(t,1,-1)),!e))return _h;this.host=e}else if(this.isSpecial()){if(t=SNe(t),Uc(QNe,t)||(e=function(i){var s,o,a,A,u,d,f,m=PNe(i,".");if(m.length&&m[m.length-1]==""&&m.length--,(s=m.length)>4)return i;for(o=[],a=0;a<s;a++){if((A=m[a])=="")return i;if(u=10,A.length>1&&Ja(A,0)=="0"&&(u=Uc(MNe,A)?16:8,A=aE(A,u==8?1:2)),A==="")d=0;else{if(!Uc(u==10?VNe:u==8?FNe:uK,A))return i;d=bC(A,u)}Cp(o,d)}for(a=0;a<s;a++)if(d=o[a],a==s-1){if(d>=AK(256,5-s))return null}else if(d>255)return null;for(f=LNe(o),a=0;a<o.length;a++)f+=o[a]*AK(256,3-a);return f}(t),e===null))return _h;this.host=e}else{if(Uc(HNe,t))return _h;for(e="",n=wp(t),r=0;r<n.length;r++)e+=Bu(n[r],qT);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return tU(IC,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme=="file"&&e==1&&cE(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,r=t.password,i=t.host,s=t.port,o=t.path,a=t.query,A=t.fragment,u=e+":";return i!==null?(u+="//",t.includesCredentials()&&(u+=n+(r?":"+r:"")+"@"),u+=H_(i),s!==null&&(u+=":"+s)):e=="file"&&(u+="//"),u+=t.cannotBeABaseURL?o[0]:o.length?"/"+oE(o,"/"):"",a!==null&&(u+="?"+a),A!==null&&(u+="#"+A),u},setHref:function(t){var e=this.parse(t);if(e)throw nU(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t=="blob")try{return new Jm(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+H_(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Il(t)+":",nD)},getUsername:function(){return this.username},setUsername:function(t){var e=wp(Il(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=Bu(e[n],tD)}},getPassword:function(){return this.password},setPassword:function(t){var e=wp(Il(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=Bu(e[n],tD)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?H_(t):H_(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,sD)},getHostname:function(){var t=this.host;return t===null?"":H_(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,oD)},getPort:function(){var t=this.port;return t===null?"":Il(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Il(t))==""?this.port=null:this.parse(t,aD))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+oE(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Tp))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Il(t))==""?this.query=null:(Ja(t,0)=="?"&&(t=aE(t,1)),this.query="",this.parse(t,Eh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Il(t))!=""?(Ja(t,0)=="#"&&(t=aE(t,1)),this.fragment="",this.parse(t,vl)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Jm=function(t){var e=CNe(this,uo),n=INe(arguments.length,1)>1?arguments[1]:void 0,r=RNe(e,new Bk(t,!1,n));Ok||(e.href=r.serialize(),e.origin=r.getOrigin(),e.protocol=r.getProtocol(),e.username=r.getUsername(),e.password=r.getPassword(),e.host=r.getHost(),e.hostname=r.getHostname(),e.port=r.getPort(),e.pathname=r.getPathname(),e.search=r.getSearch(),e.searchParams=r.getSearchParams(),e.hash=r.getHash())},uo=Jm.prototype,ja=function(t,e){return{get:function(){return AS(this)[t]()},set:e&&function(n){return AS(this)[e](n)},configurable:!0,enumerable:!0}};if(Ok&&(Ha(uo,"href",ja("serialize","setHref")),Ha(uo,"origin",ja("getOrigin")),Ha(uo,"protocol",ja("getProtocol","setProtocol")),Ha(uo,"username",ja("getUsername","setUsername")),Ha(uo,"password",ja("getPassword","setPassword")),Ha(uo,"host",ja("getHost","setHost")),Ha(uo,"hostname",ja("getHostname","setHostname")),Ha(uo,"port",ja("getPort","setPort")),Ha(uo,"pathname",ja("getPathname","setPathname")),Ha(uo,"search",ja("getSearch","setSearch")),Ha(uo,"searchParams",ja("getSearchParams")),Ha(uo,"hash",ja("getHash","setHash"))),SC(uo,"toJSON",function(){return AS(this).serialize()},{enumerable:!0}),SC(uo,"toString",function(){return AS(this).serialize()},{enumerable:!0}),Q_){var vK=Q_.createObjectURL,yK=Q_.revokeObjectURL;vK&&SC(Jm,"createObjectURL",cK(vK,Q_)),yK&&SC(Jm,"revokeObjectURL",cK(yK,Q_))}bNe(Jm,"URL"),yNe({global:!0,forced:!wNe,sham:!Ok},{URL:Jm});var zNe=nn,qNe=Cr,YNe=bb,wK=ba,XNe=fk,CK=wo("URL");zNe({target:"URL",stat:!0,forced:!(XNe&&qNe(function(){CK.canParse()}))},{canParse:function(t){var e=YNe(arguments.length,1),n=wK(t),r=e<2||arguments[1]===void 0?void 0:wK(arguments[1]);try{return!!new CK(n,r)}catch{return!1}}});var TK=tr(Xc.URL);const Gr={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Ct(){return Gr}function W$(){return"setSinkId"in HTMLAudioElement.prototype&&(!j("RESTRICTION_SET_PLAYBACK_DEVICE")||(gd()||p$())&&!yk())}function SK(){return!Gr.supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&Ud()}let Xr=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function Sp(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function _t(t,e,n,r,i){return{width:t,height:e,frameRate:n,bitrateMin:r,bitrateMax:i}}function Ka(t,e,n,r,i){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:r,bitrateMax:i}}function lD(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const JNe={"90p":_t(160,90),"90p_1":_t(160,90),"120p":_t(160,120,15,30,65),"120p_1":_t(160,120,15,30,65),"120p_3":_t(120,120,15,30,50),"120p_4":_t(212,120),"180p":_t(320,180,15,30,140),"180p_1":_t(320,180,15,30,140),"180p_3":_t(180,180,15,30,100),"180p_4":_t(240,180,15,30,120),"240p":_t(320,240,15,40,200),"240p_1":_t(320,240,15,40,200),"240p_3":_t(240,240,15,40,140),"240p_4":_t(424,240,15,40,220),"360p":_t(640,360,15,80,400),"360p_1":_t(640,360,15,80,400),"360p_3":_t(360,360,15,80,260),"360p_4":_t(640,360,30,80,600),"360p_6":_t(360,360,30,80,400),"360p_7":_t(480,360,15,80,320),"360p_8":_t(480,360,30,80,490),"360p_9":_t(640,360,15,80,800),"360p_10":_t(640,360,24,80,800),"360p_11":_t(640,360,24,80,1e3),"480p":_t(640,480,15,100,500),"480p_1":_t(640,480,15,100,500),"480p_2":_t(640,480,30,100,1e3),"480p_3":_t(480,480,15,100,400),"480p_4":_t(640,480,30,100,750),"480p_6":_t(480,480,30,100,600),"480p_8":_t(848,480,15,100,610),"480p_9":_t(848,480,30,100,930),"480p_10":_t(640,480,10,100,400),"720p":_t(1280,720,15,120,1130),"720p_auto":_t(1280,720,30,900,3e3),"720p_1":_t(1280,720,15,120,1130),"720p_2":_t(1280,720,30,120,2e3),"720p_3":_t(1280,720,30,120,1710),"720p_5":_t(960,720,15,120,910),"720p_6":_t(960,720,30,120,1380),"1080p":_t(1920,1080,15,120,2080),"1080p_1":_t(1920,1080,15,120,2080),"1080p_2":_t(1920,1080,30,120,3e3),"1080p_3":_t(1920,1080,30,120,3150),"1080p_5":_t(1920,1080,60,120,4780),"1440p":_t(2560,1440,30,120,4850),"1440p_1":_t(2560,1440,30,120,4850),"1440p_2":_t(2560,1440,60,120,7350),"4k":_t(3840,2160,30,120,8910),"4k_1":_t(3840,2160,30,120,8910),"4k_3":_t(3840,2160,60,120,13500)},$Ne={"480p":Ka(640,480,5),"480p_1":Ka(640,480,5),"480p_2":Ka(640,480,30),"480p_3":Ka(640,480,15),"720p":Ka(1280,720,5),"720p_auto":_t(1280,720,30,900,3e3),"720p_1":Ka(1280,720,5),"720p_2":Ka(1280,720,30),"720p_3":Ka(1280,720,15),"1080p":Ka(1920,1080,5),"1080p_1":Ka(1920,1080,5),"1080p_2":Ka(1920,1080,30),"1080p_3":Ka(1920,1080,15)},ZNe={"1SL1TL":lD(1,1),"3SL3TL":lD(3,3),"2SL3TL":lD(2,3)};function BA(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},JNe[t]):t}function uD(t){return typeof t=="string"?Object.assign({},$Ne[t]):t}function NC(t){return typeof t=="string"?Object.assign({},ZNe[t]):t}const eDe={speech_low_quality:Sp(16e3,!1),speech_standard:Sp(32e3,!1,18),music_standard:Sp(48e3,!1),standard_stereo:Sp(48e3,!0,56),high_quality:Sp(48e3,!1,128),high_quality_stereo:Sp(48e3,!0,192)};function lS(t){return typeof t=="string"?Object.assign({},eDe[t]):t}const Gp=[];function bK(t){return Rr(t,"mediaSource",["screen","window","application"]),!0}let Se=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),gn=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t}({}),$m=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),tDe=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),nDe=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t}({}),ef=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),Ig=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),ym=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),Rg=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),jo=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const rU={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},iU={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},z$={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},rDe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},q$={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ts=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),zo=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),j_=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),jh=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),ns=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),mA=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const dD={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let YT=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Et(t,e,n,r,i){var s,o,a={};return Object.keys(r).forEach(function(A){a[A]=r[A]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=qc(s=VOe(o=n.slice()).call(o)).call(s,function(A,u){return u(t,e,A)||A},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(t,e,a),a=null),a}function se(t,e,n){return(e=function(r){var i=function(s,o){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var A=a.call(s,"string");if(typeof A!="object")return A;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}(r);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function IK(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function vn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?IK(Object(n),!0).forEach(function(r){se(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):IK(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class Y$ extends Ln{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(ef.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),se(this,"trackMediaType",void 0),se(this,"_ID",void 0),se(this,"_rtpTransceiver",void 0),se(this,"_lowRtpTransceiver",void 0),se(this,"_hints",[]),se(this,"_isClosed",!1),se(this,"_originMediaStreamTrack",void 0),se(this,"mediaStreamTrack",void 0),se(this,"_external",{}),this._ID=n||tn(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(r){Te(Gp).call(Gp,r)||Gp.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Pd(()=>{var n;Le.reportApiInvoke(null,{name:wr.GET_MEDIA_STREAM_TRACK,options:[],tag:Mn.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===$m.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=Gp.indexOf(e);n!==-1&&Gp.splice(n,1)}(this),this.emit(Ig.CLOSED),this.removeAllListeners(ef.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===$m.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(ef.TRANSCEIVER_UPDATED,e,n)}}class am extends Y${get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),se(this,"_enabled",!0),se(this,"_muted",!1),se(this,"_isExternalTrack",!1),se(this,"_isClosed",!1),se(this,"_enabledMutex",void 0),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Pi("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,S.debug("[".concat(this.getTrackId(),"] close")),this.emit(Se.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Yt(this,Se.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ig.TRACK_ENDED)}stateCheck(e,n){if(S.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),Ll(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new ie(L.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",S);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new ie(L.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",S)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ye.resolve([])}}const RK=window.AudioContext||window.webkitAudioContext;let Uo=null;const Vt=new class extends Ln{constructor(){super(...arguments),se(this,"prevState",void 0),se(this,"curState",void 0),se(this,"currentTime",void 0),se(this,"currentTimeStuckAt",void 0),se(this,"interruptDetectorTrack",void 0),se(this,"onLocalAudioTrackMute",()=>{S.info("ios15-interruption-start"),this.emit(Xr.IOS_15_16_INTERRUPTION_START)}),se(this,"onLocalAudioTrackUnmute",async()=>{S.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?S.info("ios15-interruption-end-canceled"):(Uo&&await Uo.suspend(),this.emit(Xr.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){S.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){S.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Og(){if(!Uo){if(function(){if(!RK)return void S.error("your browser is not support web audio");S.info("create audio context");const t=vn({},j("WEBAUDIO_INIT_OPTIONS"));S.debug("audio context init option:",JSON.stringify(t)),Uo=new RK(t),Vt.curState=Uo.state,Uo.onstatechange=()=>{Vt.prevState=Vt.curState,Vt.curState=Uo?Uo.state:void 0;const{prevState:e,curState:n}=Vt,r=n==="running",i=n==="interrupted",s=e==="running",o=e==="suspended",a=e==="interrupted",A=yt().osVersion;(Cs()||Ac())&&s&&i&&(S.info("ios".concat(A,"-interruption-start")),Vt.emit(Xr.IOS_INTERRUPTION_START)),(Cs()||Ac())&&(o||a)&&r&&(S.info("ios".concat(A,"-interruption-end")),Vt.emit(Xr.IOS_INTERRUPTION_END)),e!==n&&Vt.emit(Xr.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=Uo)===null||e===void 0?void 0:e.currentTime;Vt.currentTime!==n?(Vt.currentTimeStuckAt&&(S.debug("AudioContext current time resume at ".concat(n)),Vt.currentTimeStuckAt=void 0),Vt.currentTime=n):(n!==Vt.currentTimeStuckAt&&(Le.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Mn.TRACER}).onSuccess(),S.warning("AudioContext current time stuck at ".concat(n))),Vt.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,s=!1,o=!1;function a(y){e.state==="running"?A(!1):Cs()||Ac()?e.state==="suspended"&&(A(!0),y&&e.resume().then(u,u)):e.state!=="closed"&&(A(!0),y&&e.resume().then(u,u))}function A(y){if(i!==y){i=y;for(let w=0,b=n;w<b.length;w+=1){const I=b[w];y?window.addEventListener(I,d,{capture:!0,passive:!0}):window.removeEventListener(I,d,{capture:!0,passive:!0})}}}function u(){a(!1)}function d(){a(!0)}function f(y){if(!o)if(r.paused)if(y){let w;m(!1),o=!0;try{w=r.play(),w?w.then(g,g):(r.addEventListener("playing",g),r.addEventListener("abort",g),r.addEventListener("error",g))}catch{g()}}else m(!0);else m(!1)}function m(y){if(s!==y){s=y;for(let w=0,b=n;w<b.length;w++){const I=b[w];y?window.addEventListener(I,v,{capture:!0,passive:!0}):window.removeEventListener(I,v,{capture:!0,passive:!0})}}}function g(){r.removeEventListener("playing",g),r.removeEventListener("abort",g),r.removeEventListener("error",g),o=!1,f(!1)}function v(){f(!0)}if(Cs()){const y=e.createMediaStreamDestination(),w=document.createElement("div");w.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=w.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=y.stream,f(!0)}Vt.on(Xr.STATE_CHANGE,function(){a(!0)}),a(!1)}(Uo)}(),!Uo)throw new ie(L.NOT_SUPPORTED,"can not create audio context");return Uo}return Uo}function Oh(t){if(function(){if(hD!==null)return hD;const r=Og(),i=r.createBufferSource(),s=r.createGain(),o=r.createGain();i.connect(s),i.connect(o),i.disconnect(s);let a=!1;try{i.disconnect(s)}catch{a=!0}return i.disconnect(),hD=a,a}())return;const e=t.connect,n=t.disconnect;t.connect=(r,i,s)=>{var o;return t._inputNodes||(t._inputNodes=[]),Te(o=t._inputNodes).call(o,r)||(r instanceof AudioNode?(t._inputNodes.push(r),e.call(t,r,i,s)):e.call(t,r,i)),t},t.disconnect=(r,i,s)=>{n.call(t),r?cS(t._inputNodes,r):t._inputNodes=[];for(const o of t._inputNodes)e.call(t,o)}}let hD=null;function Lk(t,e){let n=!1;const r=1/e;if(j("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{n?window.clearInterval(i):t(performance.now()/1e3)},1e3*r)}else{const i=Og();let s=i.createGain();s.gain.value=0,s.connect(i.destination);const o=()=>{if(n)return void(s=null);const a=i.createOscillator();a.onended=o,a.connect(s),a.start(0),a.stop(i.currentTime+r),t(i.currentTime)};o()}return()=>{n=!0}}class X${constructor(){se(this,"context",void 0),se(this,"analyserNode",void 0),se(this,"sourceNode",void 0),this.context=Og(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Cs()||Ac()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<e.length;++i)e[i]=r[i]/128-1}const n=qc(e).call(e,(r,i)=>r+i*i,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{S.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class J$ extends Ln{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),se(this,"outputNode",void 0),se(this,"outputTrack",void 0),se(this,"isPlayed",!1),se(this,"sourceNode",void 0),se(this,"context",void 0),se(this,"audioBufferNode",void 0),se(this,"destNode",void 0),se(this,"audioOutputLevel",0),se(this,"volumeLevelAnalyser",void 0),se(this,"_processedNode",void 0),se(this,"playNode",void 0),se(this,"isDestroyed",!1),se(this,"onNoAudioInput",void 0),se(this,"isNoAudioInput",!1),se(this,"_noAudioInputCount",0),this.context=Og(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Oh(this.outputNode),this.volumeLevelAnalyser=new X$}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(jo.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const s=r.outputBuffer.getChannelData(i);for(let o=0;o<s.length;o+=1)s[o]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ct().webAudioMediaStreamDest)throw new ie(L.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&Pb(()=>{Vt.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Cs()||Ac()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let s=0;s<r.length;s++)r[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Zr(200),await this.checkHasAudioInput(e?e+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class $$ extends J${get isFreeze(){return!1}constructor(e,n,r){var i;if(super(),se(this,"sourceNode",void 0),se(this,"track",void 0),se(this,"clonedTrack",void 0),se(this,"audioElement",void 0),se(this,"isCurrentTrackCloned",!1),se(this,"isRemoteTrack",!1),se(this,"originVolumeLevelAnalyser",void 0),se(this,"rebuildWebAudio",async()=>{if(S.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void S.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>S.info("resume success")),S.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const a=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?a.stop():this.isCurrentTrackCloned=!0;const A=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(A),Oh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),Oh(this.outputNode),this.emit(jo.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=A,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new ie(L.UNEXPECTED_ERROR);this.track=e;const s=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(s),Oh(this.sourceNode),r){const a=r.clone();a.enabled=!0,this.clonedTrack=a,S.debug("create an unmuted track ".concat(a.id," from the original track ").concat(r.id," to get the volume"));const A=this.context.createMediaStreamSource(new MediaStream([a]));Oh(A),this.originVolumeLevelAnalyser=new X$,this.originVolumeLevelAnalyser.updateSource(A)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;const o=yt();n&&o.os===kr.IOS&&Number((i=o.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(Vt.on(Xr.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(a=>{a||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),Oh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(jo.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Vt.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),S.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));Oh(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function Z$(t,e,n){const r=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:r(e.height,1080),maxWidth:r(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(i.video.mandatory.maxFrameRate=e.frameRate.max,i.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(i.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function iDe(t,e){const n=await eZ(t.mediaSource),{sourceId:r,audio:i}=await function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ye((a,A)=>{const u=document.createElement("div");u.innerText="share screen",u.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const d=document.createElement("div");d.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const f=document.createElement("div");f.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",f.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const g=document.createElement("div");g.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const v=document.createElement("button");v.innerHTML="cancel",v.setAttribute("style","width: 85px;"),v.onclick=()=>{document.body.removeChild(b);const I=new Error("NotAllowedError");I.name="NotAllowedError",A(I)};let y=o;const w=document.createElement("div");if(o){const I=document.createElement("input");I.setAttribute("type","checkbox");const B=document.createElement("span");I.setAttribute("style","margin-right: 6px;"),B.innerText="Share audio",I.checked=y,I.onchange=()=>{y=I.checked},w.appendChild(I),w.appendChild(B)}g.appendChild(w),g.appendChild(v),d.appendChild(f),d.appendChild(m),d.appendChild(g);const b=document.createElement("div");b.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),b.appendChild(u),b.appendChild(d),document.body.appendChild(b),s.map(I=>{if(I.id){const B=document.createElement("div");B.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let M=I.thumbnail;try{const{width:H}=M.getSize();H>1920&&(M=M.resize({width:1920}))}catch(H){throw H&&H.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),H}B.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+M.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+I.name.replace(/[\u00A0-\u9999<>\&]/g,function(H){return"&#"+H.charCodeAt(0)+";"})+"</span>",B.onclick=()=>{document.body.removeChild(b),a({sourceId:I.id,audio:y})},m.appendChild(B)}})})}(n,e);return await Z$(r,t,i)}async function eZ(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=T$();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new ie(L.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{r=null}r&&r.then||(r=new ye((s,o)=>{n.desktopCapturer.getSources({types:e},(a,A)=>{a?o(a):s(A)})}));try{return await r}catch(s){throw new ie(L.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}const sU=new Pi("safari");let tZ=!1,nZ=!1;async function Qo(t,e){let n=0,r=null;for(;n<2;)try{r=await sDe(t,e,n>0);break}catch(i){if(i instanceof ie)throw S.error("[".concat(e,"] ").concat(i.toString())),i;const s=XT(i.name||i.code||i,i.message);if(s.code===L.MEDIA_OPTION_INVALID){S.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await Zr(500);continue}throw S.error("[".concat(e,"] ").concat(s.toString())),s}if(!r)throw new ie(L.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function sDe(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new ie(L.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const r=Ct(),i=new MediaStream;if(t.audioSource&&i.addTrack(t.audioSource),t.videoSource&&i.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return S.debug("Using Video Source/ Audio Source"),i;if(t.screen)if(T$())t.screen.sourceId?bp(i,await Z$(t.screen.sourceId,t.screen,t.screenAudio)):bp(i,await iDe(t.screen,t.screenAudio));else if(gd()&&t.screen.extensionId&&t.screen.mandatory){if(!r.getStreamFromExtension)throw new ie(L.NOT_SUPPORTED,"This browser does not support screen sharing");S.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const m=await(o=t.screen.extensionId,a=e,new ye((g,v)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},y=>{if(!y||!y.streamId)return S.error("[".concat(a,"] No response from Chrome Plugin. Plugin not installed properly"),y),void v(new ie(L.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));g(y.streamId)})}catch(y){S.error("[".concat(a,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),y.toString()),v(new ie(L.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=m,bp(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(r.getDisplayMedia){var s;t.screen.mediaSource&&bK(t.screen.mediaSource);const m={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(s=t.screen.displaySurface)!==null&&s!==void 0?s:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:g,surfaceSwitching:v,systemAudio:y}=t.screen,w={selfBrowserSurface:g,surfaceSwitching:v,systemAudio:y};!g&&delete w.selfBrowserSurface,!v&&delete w.surfaceSwitching,!y&&delete w.systemAudio,S.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:m,audio:!!t.screenAudio,controls:w})),bp(i,await navigator.mediaDevices.getDisplayMedia(vn({video:m,audio:!!t.screenAudio},w)))}else{if(!Vn())throw S.error("[".concat(e,"] This browser does not support screenSharing")),new ie(L.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&bK(t.screen.mediaSource);const m={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};S.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(m))),bp(i,await navigator.mediaDevices.getUserMedia(m))}}var o,a;if(!t.video&&!t.audio)return i;let A={video:t.video,audio:t.audio},u=j("MEDIA_DEVICE_CONSTRAINTS");if(u)try{typeof u=="string"&&(u=JSON.parse(u)),A=YL(A,u)}catch{}S.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(A)),yt();let d,f=null;(hi()||Cs()||aS())&&(f=await sU.lock());try{d=await navigator.mediaDevices.getUserMedia(A)}catch(m){throw f&&f(),m}return A.audio&&(tZ=!0),A.video&&(nZ=!0),bp(i,d),f&&f(),i}function XT(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new ie(L.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new ie(L.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new ie(L.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new ie(L.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new ie(L.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new ie(L.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return S.error("getUserMedia unexpected error",t),new ie(L.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function bp(t,e){const n=t.getVideoTracks()[0],r=t.getAudioTracks()[0],i=e.getVideoTracks()[0],s=e.getAudioTracks()[0];s&&(r&&t.removeTrack(r),t.addTrack(s)),i&&(n&&t.removeTrack(n),t.addTrack(i))}const Go=new class extends Ln{get state(){return this._state}set state(t){t!==this._state&&(this.emit(jh.STATE_CHANGE,t),this._state=t)}constructor(){super(),se(this,"_state",j_.IDLE),se(this,"isAccessMicrophonePermission",!1),se(this,"isAccessCameraPermission",!1),se(this,"lastAccessMicrophonePermission",!1),se(this,"lastAccessCameraPermission",!1),se(this,"checkdeviceMatched",!1),se(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(j("ENUMERATE_DEVICES_INTERVAL")||(Lb()||Bb()===kr.HARMONY_OS)&&Ud())&&this.updateDevicesInfo()},j("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>S.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new ie(L.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let s=!this.isAccessMicrophonePermission&&t,o=!this.isAccessCameraPermission&&e;i.audio&&(s=!1),i.video&&(o=!1);let a=null,A=null,u=null;if(!n&&(s||o)){if(sU.isLocked&&(S.debug("[device manager] wait GUM lock"),(await sU.lock())(),S.debug("[device manager] GUM unlock")),tZ&&(s=!1,this.isAccessMicrophonePermission=!0),nZ&&(o=!1,this.isAccessCameraPermission=!0),S.debug("[device manager] check media device permissions",t,e,s,o),s&&o){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(d){const f=XT(d.name||d.code||d,d.message);if(f.code===L.PERMISSION_DENIED)throw f;S.warning("getUserMedia failed in getDevices",f)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{a=await navigator.mediaDevices.getUserMedia({audio:t})}catch(d){const f=XT(d.name||d.code||d,d.message);if(f.code===L.PERMISSION_DENIED)throw f;S.warning("getUserMedia failed in getDevices",f)}this.isAccessMicrophonePermission=!0}else if(o){try{A=await navigator.mediaDevices.getUserMedia({video:e})}catch(d){const f=XT(d.name||d.code||d,d.message);if(f.code===L.PERMISSION_DENIED)throw f;S.warning("getUserMedia failed in getDevices",f)}this.isAccessCameraPermission=!0}S.debug("[device manager] mic permission",t,"cam permission",e)}try{const d=await navigator.mediaDevices.enumerateDevices();return a&&a.getTracks().forEach(f=>f.stop()),A&&A.getTracks().forEach(f=>f.stop()),u&&u.getTracks().forEach(f=>f.stop()),a=null,A=null,u=null,d}catch(d){return a&&a.getTracks().forEach(f=>f.stop()),A&&A.getTracks().forEach(f=>f.stop()),u&&u.getTracks().forEach(f=>f.stop()),a=null,A=null,u=null,new ie(L.ENUMERATE_DEVICES_FAILED,d.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new ie(L.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=j_.INITING;try{await this.updateDevicesInfo(),this.state=j_.INITEND}catch(t){throw S.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=j_.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new ie(L.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=t.find(o=>o.kind==="audioinput"&&o.deviceId==="default"),s=t.find(o=>o.kind==="audiooutput"&&o.deviceId==="default");i&&s?s.groupId===i.groupId?S.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):S.warning("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):S.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(i=>{if(!i.deviceId)return;const s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){const o={initAt:e,updateAt:e,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),o),n.push(o)}s&&(s.updateAt=e)}),this.deviceInfoMap.forEach((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==e&&(i.state="INACTIVE",n.push(i))}),this.state!==j_.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(jh.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(jh.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(jh.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(i=>i.kind==="audioinput"),n=t.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of e)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let fD=!1;const xo=new class extends Ln{constructor(){super(...arguments),se(this,"onAutoplayFailed",void 0),se(this,"onAudioAutoplayFailed",void 0)}};function rZ(){if(yt(),!fD){const t=e=>{e.preventDefault(),fD=!1,wv()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};fD=!0,wv()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),S.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),xo.onAutoplayFailed?xo.onAutoplayFailed():xo.onAudioAutoplayFailed?S.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):S.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),xo.emit("autoplay-failed")}}function iZ(t,e,n,r){if(!t)return;const i=Le.getBaseInfoBySessionId(t);if(!i)return;const s=i.info,o=Date.now(),a=vn(vn({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-i.startTime,cbRegistered:xo.onAutoplayFailed||xo.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:r,extend:void 0});Le.send({type:Nn.AUTOPLAY_FAILED,data:a},!0)}const oDe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Ms=new class{constructor(){se(this,"onAutoplayFailed",void 0),se(this,"elementMap",new Map),se(this,"elementStateMap",new Map),se(this,"elementsNeedToResume",[]),se(this,"sinkIdMap",new Map),se(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,r]=e;const i=this.elementStateMap.get(n),s=r.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(S.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(t)),o==="live"){if(t)return r.pause(),void r.play();if(Vt.curState==="running")return qm()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}})}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(S.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Vt.on(Xr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Vt.on(Xr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Vt.on(Xr.STATE_CHANGE,()=>{Cs()&&Vt.prevState==="suspended"&&Vt.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(r){throw new ie(L.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(t,e,n,r){if(this.elementMap.has(e))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,i),this.elementMap.set(e,i),this.elementStateMap.set(e,ns.INIT),this.setVolume(e,n);const s=this.sinkIdMap.get(e);if(s)try{i.setSinkId(s).catch(a=>{S.warning("[".concat(e,"] set sink id failed"),a.toString())})}catch(a){S.warning("[".concat(e,"] set sink id failed"),a.toString())}const o=i.play();o&&o.then&&o.catch(a=>{r&&iZ(r,"audio",a.message,e),S.warning("audio element play warning",a.toString()),this.elementMap.has(e)&&a.name==="NotAllowedError"&&(S.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),Pb(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),rZ()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){oDe.forEach(n=>{e.addEventListener(n,r=>{const i=this.elementStateMap.get(t),s=r.type==="pause"?"paused":r.type;if(S.debug("[".concat(t,"] audio-element-status change ").concat(i," => ").concat(s)),r.type==="error"){const o=e==null?void 0:e.error;o&&S.error("[".concat(t,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(t,s)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{S.debug("Auto resume audio element success")}).catch(n=>{S.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new ye(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{wv()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function er(){return function(t,e,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new ie(L.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",S);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];const a=r.apply(this,s);return a instanceof ye?new ye((A,u)=>{a.then(A).catch(u)}):a}),n}}class sZ extends Ln{constructor(e){super(),se(this,"name","VideoProcessorDestination"),se(this,"ID","0"),se(this,"_source",void 0),se(this,"videoContext",void 0),se(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new ie(L.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new ie(L.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(Ts.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(Ts.ON_TRACK,void 0)}}class oZ extends Ln{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"usageRegistry",[]),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await fi(this,zo.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var r;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Yt(this,zo.REQUEST_UPDATE_CONSTRAINTS,Array.from(Hl(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return S.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Yt(this,zo.REQUEST_UPDATE_CONSTRAINTS,Array.from(Hl(n=this.constraintsMap).call(n)))}registerStats(e,n,r){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:r})}unregisterStats(e,n){const r=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();e.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){S.error(new ie(L.UNEXPECTED_ERROR,o.message))}return e}registerUsage(e,n){this.usageRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof ye&&(r=await r),e.push(vn(vn({},r),{},{direction:this.direction}))}catch(r){S.error("gather extension usage error",r)}return e}getDirection(){return this.direction}}class aZ extends Ln{constructor(e){super(),se(this,"name","AudioProcessorDestination"),se(this,"ID","0"),se(this,"inputTrack",void 0),se(this,"inputNode",void 0),se(this,"audioProcessorContext",void 0),se(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new ie(L.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new ie(L.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(Ts.ON_TRACK,void 0),this.emit(Ts.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(Ts.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(Ts.ON_NODE,this.inputNode))}}class cZ extends Ln{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,r){super(),se(this,"constraintsMap",new Map),se(this,"statsRegistry",[]),se(this,"audioContext",void 0),se(this,"trackId",void 0),se(this,"direction",void 0),se(this,"usageRegistry",[]),se(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=r}async getConstraints(){return fi(this,zo.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var r;return S.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Yt(this,zo.REQUEST_UPDATE_CONSTRAINTS,Array.from(Hl(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Yt(this,zo.REQUEST_UPDATE_CONSTRAINTS,Array.from(Hl(n=this.constraintsMap).call(n)))}registerStats(e,n,r){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:r})}unregisterStats(e,n){const r=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:r,type:i,cb:s}of this.statsRegistry)try{const o=s();e.push({processorID:n,processorName:r,type:i,stats:o})}catch(o){S.error(new ie(L.UNEXPECTED_ERROR,o.message))}return e}registerUsage(e,n){this.usageRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof ye&&(r=await r),e.push(vn(vn({},r),{},{direction:this.direction}))}catch(r){S.error("gather extension usage error",r)}return e}getDirection(){return this.direction}}class oU extends Ln{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),se(this,"context",void 0),se(this,"processSourceNode",void 0),se(this,"outputTrack",void 0),se(this,"processedNode",void 0),se(this,"clonedTrack",void 0),se(this,"outputNode",void 0),this.outputNode=new aDe}setVolume(){}createOutputTrack(){throw new ie(L.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class aDe{disconnect(){}connect(){}}function AZ(t){return new ye((e,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const s=Cs()?"canplay":"playing";i.addEventListener(s,()=>{const o=i.videoWidth,a=i.videoHeight;!o&&Vn()||(r=!0,i.srcObject=null,i.remove(),e([o,a]))}),i.srcObject=new MediaStream([t]),i.play().catch(kb),setTimeout(()=>{r||(i.srcObject=null,i.remove(),e([i.videoWidth,i.videoHeight]))},4e3)})}function uS(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=BA(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!y$()&&n.frameRate&&(e.frameRate=n.frameRate),p$()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),Vn()&&(e.frameRate={ideal:30,max:30}),e}function OK(t){const e={};if(y$()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,gd()&&t.ANS&&(e.googHighpassFilter=t.ANS))),t.encoderConfig){const n=lS(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),Lb()&&(e.sampleRate=void 0),e}const cDe=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:r,height:i}=t.getMediaStreamTrackSettings();let{frameRate:s=n,width:o=r,height:a=i}=e;if(!s||!o||!a)return;o=xN(o),a=xN(a),s=xN(s);const{max:A,min:u}=function(g,v,y){const w=200*Math.pow(y/15,.6)*Math.pow(g*v/640/360,.75);return{min:Math.floor(w),max:Math.floor(4*w)}}(o,a,s),{bitrateMax:d,bitrateMin:f}=e||{};d||S.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(a,", fps: ").concat(s,"] => [brMax: ").concat(d,", brMin: ").concat(f,"]"));const{maxFramerate:m}=j("ENCODER_CONFIG_LIMIT");return m&&typeof m=="number"&&(s=Math.min(s,m)),{frameRate:s,bitrateMax:d||A,bitrateMin:f||u,scaleResolutionDownBy:1,scale:0}},lZ=async(t,e,n)=>await(async(r,i,s)=>{const o=function(u){const d=[];for(let f=0;f<u.length;f+=2)d.push(parseInt(u.slice(f,f+2),16));return Uint8Array.from(d)}(R$(""+i+s)).slice(0,16),a=o.slice(0,12),A=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},A,r))})(t.buffer,e,n),Uk=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new ye((n,r)=>{e.toBlob(async i=>{if(e.remove(),i){const s=await uZ(i);n({buffer:s,width:e.width,height:e.height})}else r(new ie(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},uZ=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var NK,DK,BK,LK,UK,PK,kK,xK,MK,FK,VK,QK,HK,jK,KK,GK,WK,zK,bn,qK,YK,XK,JK,$K,ZK,gA,e5,t5,n5,r5,i5,s5,o5,a5,c5,A5,l5,u5,d5,oi;let xn=(NK=Ve({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),DK=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),BK=er(),LK=Ym("LocalAudioTrack","_enabledMutex"),UK=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),PK=er(),kK=Ym("LocalAudioTrack","_enabledMutex"),xK=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),MK=er(),FK=er(),VK=er(),QK=Ve({argsMap:t=>[t.getTrackId()]}),HK=er(),jK=Ve({argsMap:t=>[t.getTrackId()]}),KK=er(),GK=Ve({argsMap:t=>[t.getTrackId()]}),WK=Ve({argsMap:(t,e)=>[t.getTrackId(),e.name]}),zK=Ve({argsMap:t=>[t.getTrackId()]}),Et((bn=class extends am{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Ms.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,r){super(t,n),se(this,"trackMediaType",Rg.AUDIO),se(this,"_encoderConfig",void 0),se(this,"_trackSource",void 0),se(this,"_enabled",!0),se(this,"_volume",100),se(this,"_useAudioElement",!0),se(this,"_bypassWebAudio",!1),se(this,"processor",void 0),se(this,"_processorContext",void 0),se(this,"_processorDestination",void 0),se(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!r,this._trackSource=new oU,j("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),j("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),hi()&&!Uo?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){jt(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Ms.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void S.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Yt(this,Se.NEED_REPLACE_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!W$())throw new ie(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ms.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Yt(this,Se.NEED_ENABLE_TRACK,this),S.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(r){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Yt(this,Se.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Yt(this,Se.NEED_MUTE_TRACK,this):await Yt(this,Se.NEED_UNMUTE_TRACK,this))}getStats(){return Pd(()=>{S.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),va(this,Se.GET_STATS)||vn({},rU)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(jo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(jo.ON_AUDIO_BUFFER),this._source.on(jo.ON_AUDIO_BUFFER,n=>t(n))}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ms.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ms.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ms.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Yt(this,Se.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return ye.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new ie(L.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new ie(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(Ts.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Yt(this,Se.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Yt(this,Se.NEED_REPLACE_TRACK,this))}),t.on(Ts.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(Ts.ON_TRACK),t.removeAllListeners(Ts.ON_NODE)}bindProcessorContextEvents(t){t.on(zo.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(zo.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof oU&&(this._trackSource=new $$(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new cZ(this._source.context,this.getTrackId(),"local"),e=new aZ(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(jo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Ms.stop(this.getTrackId()),this._source.play()),Yt(this,Se.NEED_REPLACE_MIXING_TRACK,this).then(()=>{S.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{S.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[NK],Object.getOwnPropertyDescriptor(bn.prototype,"setVolume"),bn.prototype),Et(bn.prototype,"setPlaybackDevice",[DK,BK],Object.getOwnPropertyDescriptor(bn.prototype,"setPlaybackDevice"),bn.prototype),Et(bn.prototype,"setEnabled",[LK,UK,PK],Object.getOwnPropertyDescriptor(bn.prototype,"setEnabled"),bn.prototype),Et(bn.prototype,"setMuted",[kK,xK,MK],Object.getOwnPropertyDescriptor(bn.prototype,"setMuted"),bn.prototype),Et(bn.prototype,"getStats",[FK],Object.getOwnPropertyDescriptor(bn.prototype,"getStats"),bn.prototype),Et(bn.prototype,"setAudioFrameCallback",[VK],Object.getOwnPropertyDescriptor(bn.prototype,"setAudioFrameCallback"),bn.prototype),Et(bn.prototype,"play",[QK,HK],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),Et(bn.prototype,"stop",[jK,KK],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),Et(bn.prototype,"close",[GK],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),Et(bn.prototype,"pipe",[WK],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),Et(bn.prototype,"unpipe",[zK],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),bn),dS=(qK=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),YK=er(),XK=Ym("MicrophoneAudioTrack","_enabledMutex"),JK=Ve({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),$K=er(),ZK=Ve({argsMap:t=>[t.getTrackId()]}),Et((gA=class extends xn{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,r){super(t,e.encoderConfig?lS(e.encoderConfig):{},r,j("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),se(this,"_config",void 0),se(this,"_deviceName","default"),se(this,"_constraints",void 0),se(this,"_originalConstraints",void 0),se(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(qm()||WL())&&Vt.bindInterruptDetectorTrack(this)}async setDevice(t){if(S.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await Go.getDeviceById(t),n={};n.audio=vn({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let r=null;try{r=await Qo(n,this.getTrackId())}catch(i){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await Qo({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await Go.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}S.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return S.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),t),j("AUTO_RESET_AUDIO_ROUTE")&&(Cs()||Ac())){const o=navigator.audioSession;o&&(t||(o.type="playback"),o.type="auto")}if(!t){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await Yt(this,Se.NEED_DISABLE_TRACK,this)}catch(o){throw S.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}const i=vn({},this._constraints),s=Go.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{n||(this._enabled=!0);const o=await Qo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await Yt(this,Se.NEED_ENABLE_TRACK,this)}catch(o){throw n||(this._enabled=!1),S.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}S.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(qm()||WL())&&Vt.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Cs()||Ac())&&this._enabled&&!this._isClosed&&Vt.duringInterruption){const t=async()=>{Vt.off(Xr.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Vt.on(Xr.IOS_INTERRUPTION_END,t)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ig.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=Go.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const r=await Qo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(zo.REQUEST_UPDATE_CONSTRAINTS,async(e,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(zo.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[qK,YK],Object.getOwnPropertyDescriptor(gA.prototype,"setDevice"),gA.prototype),Et(gA.prototype,"setEnabled",[XK,JK,$K],Object.getOwnPropertyDescriptor(gA.prototype,"setEnabled"),gA.prototype),Et(gA.prototype,"close",[ZK],Object.getOwnPropertyDescriptor(gA.prototype,"close"),gA.prototype),gA),ADe=(e5=Ve({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),t5=er(),n5=Ve({argsMap:t=>[t.getTrackId()]}),r5=er(),i5=Ve({argsMap:t=>[t.getTrackId()]}),s5=er(),o5=Ve({argsMap:t=>[t.getTrackId()]}),a5=er(),c5=Ve({argsMap:t=>[t.getTrackId()]}),A5=er(),l5=Ve({argsMap:t=>[t.getTrackId()]}),u5=Ve({argsMap:t=>[t.getTrackId()]}),d5=er(),Et((oi=class extends xn{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,r){super(e.createOutputTrack(),n,r),se(this,"source",void 0),se(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(jo.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(Ig.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){jt(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[e5,t5],Object.getOwnPropertyDescriptor(oi.prototype,"startProcessAudioBuffer"),oi.prototype),Et(oi.prototype,"pauseProcessAudioBuffer",[n5,r5],Object.getOwnPropertyDescriptor(oi.prototype,"pauseProcessAudioBuffer"),oi.prototype),Et(oi.prototype,"seekAudioBuffer",[i5,s5],Object.getOwnPropertyDescriptor(oi.prototype,"seekAudioBuffer"),oi.prototype),Et(oi.prototype,"resumeProcessAudioBuffer",[o5,a5],Object.getOwnPropertyDescriptor(oi.prototype,"resumeProcessAudioBuffer"),oi.prototype),Et(oi.prototype,"stopProcessAudioBuffer",[c5,A5],Object.getOwnPropertyDescriptor(oi.prototype,"stopProcessAudioBuffer"),oi.prototype),Et(oi.prototype,"close",[l5],Object.getOwnPropertyDescriptor(oi.prototype,"close"),oi.prototype),Et(oi.prototype,"setAudioBufferPlaybackSpeed",[u5,d5],Object.getOwnPropertyDescriptor(oi.prototype,"setAudioBufferPlaybackSpeed"),oi.prototype),oi);class yr extends xn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=Og().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,tn(8,"track-mix-")),se(this,"trackList",void 0),se(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(S.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):S.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){S.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}cS(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof yr?n.emit(ef.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class lDe extends J${set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(jo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),se(this,"audioBuffer",void 0),se(this,"sourceNode",void 0),se(this,"startPlayTime",0),se(this,"startPlayOffset",0),se(this,"pausePlayTime",0),se(this,"options",void 0),se(this,"currentLoopCount",0),se(this,"currentPlaybackSpeed",100),se(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):S.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const h5=new Map;class Pk{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(S.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){se(this,"trackId",void 0),se(this,"config",void 0),se(this,"onFirstVideoFrameDecoded",void 0),se(this,"onVideoStateChanged",void 0),se(this,"freezeTimeCounterList",[]),se(this,"renderFreezeAccTime",0),se(this,"isKeepLastFrame",!1),se(this,"timeUpdatedCount",0),se(this,"freezeTime",0),se(this,"playbackTime",0),se(this,"lastTimeUpdatedTime",0),se(this,"autoplayFailed",!1),se(this,"videoTrack",void 0),se(this,"videoElement",void 0),se(this,"cacheVideoElement",void 0),se(this,"renderStats",void 0),se(this,"_videoState",mA.VideoStateStopped),se(this,"videoElementCheckInterval",void 0),se(this,"videoElementFreezeTimeout",void 0),se(this,"_videoElementStatus",ns.NONE),se(this,"isGettingVideoDimensions",!1),se(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return S.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),se(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Vt.curState==="running"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(E3())),C3()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),se(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=ns.PLAYING;break;case"loadeddata":if(this.videoState=mA.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=ns.CANPLAY;break;case"stalled":this.videoElementStatus=ns.STALLED;break;case"suspend":this.videoElementStatus=ns.SUSPEND;break;case"pause":this.videoElementStatus=ns.PAUSED,Cs()||Ac()||hi()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=ns.WAITING;break;case"abort":this.videoElementStatus=ns.ABORT;break;case"ended":this.videoElementStatus=ns.ENDED;break;case"emptied":this.videoElementStatus=ns.EMPTIED;break;case"error":{const r=this.videoElement.error;r?(this.videoElementStatus=ns.ERROR,S.error("[".concat(this.trackId,"] media error: ").concat(r.message," (").concat(r.code,")"))):S.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Rl.lastVisibleTime<Rl.lastHiddenTime||s<Rl.lastHiddenTime||s<Rl.lastVisibleTime)return;for(i>j("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),se(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(S.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(E3())),C3()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Vt.on(Xr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Vt.on(Xr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(i=>{e&&iZ(e,"video",i.message,this.trackId),i.name==="NotAllowedError"?(S.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):S.warning("[".concat(this.trackId,"] play warning: "),i)});const r=yt();if((r.name==="Safari"&&Number(r.version)===15||qm())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return S.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height);return e.remove(),r}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new ye((s,o)=>{r.toBlob(async a=>{if(r.remove(),a){const A=await uZ(a);s({buffer:A,width:r.width,height:r.height})}else o(new ie(L.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await Uk(e)}destroy(){this.renderStats=void 0,Vt.off(Xr.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Vt.off(Xr.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=mA.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=ns.INIT,!this.videoElementCheckInterval&&(f5.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)||(this.videoElementStatus=ns.DESTROYED)},1e3),j("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let s;const o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(a,j("VIDEO_FREEZE_DURATION")))},a=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===mA.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=mA.VideoStateFrozen:document.addEventListener("visibilitychange",o))},A=(u,d)=>{if(this.videoElementStatus===ns.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=d.mediaTime):this.renderStats={lastTs:d.mediaTime,curTs:d.mediaTime,lastRenderNum:0,renderNum:0},s){const g=d.presentationTime-s.presentationTime;this.videoState===mA.VideoStateStarting&&(this.videoState=mA.VideoStateDecoding),this.videoState===mA.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(a,j("VIDEO_FREEZE_DURATION"))),g<j("VIDEO_FREEZE_DURATION")&&this.videoState===mA.VideoStateFrozen&&(this.videoState=mA.VideoStateDecoding),g>j("VIDEO_FREEZE_DURATION")&&Rl.lastVisibleTime>=Rl.lastHiddenTime&&s.timestamp>Rl.lastVisibleTime&&s.timestamp>Rl.lastHiddenTime&&(this.renderFreezeAccTime+=g)}s=vn(vn({},d),{},{timestamp:u})}var f,m;j("ENABLE_VIDEO_FRAME_CALLBACK")&&((f=(m=this.videoElement).requestVideoFrameCallback)===null||f===void 0||f.call(m,A))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,A)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Lb()&&!j("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=yt();r.name==="Safari"&&Number(r.version)===15||qm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Vn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Vn()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(s=>{S.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){f5.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=ns.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{S.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{S.error(r)}),this.autoplayFailed=!1,wv()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};wv()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),rZ()}}const f5=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class dZ extends Pk{constructor(e){super(e),se(this,"container",void 0),se(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,r):await Uk(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",j("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var p5,m5,g5,_5,E5,v5,y5,w5,C5,T5,S5,b5,I5,R5,O5,N5,D5,B5,L5,U5,P5,k5,x5,M5,mt,F5,V5,Q5,H5,j5,K5,G5,W5,Lo;let dn=(p5=Ve({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),m5=er(),g5=Ve({argsMap:t=>[t.getTrackId()]}),_5=Ym("LocalVideoTrack","_enabledMutex"),E5=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),v5=er(),y5=Ym("LocalVideoTrack","_enabledMutex"),w5=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),C5=er(),T5=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),S5=er(),b5=er(),I5=Ve({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),R5=er(),O5=er(),N5=er(),D5=er(),B5=er(),L5=er(),U5=er(),P5=Ve({argsMap:(t,e)=>[t.getTrackId(),e.name]}),k5=Ve({argsMap:t=>[t.getTrackId()]}),x5=Ve({argsMap:t=>[t.getTrackId()]}),M5=Ve({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),mt=class hZ extends am{get videoHeight(){if(hi()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(hi()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ns.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,r,i,s,o){if(super(e,s),se(this,"trackMediaType",Rg.VIDEO),se(this,"_player",void 0),se(this,"isUseScaleResolutionDownBy",!1),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"_encoderConfig",void 0),se(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),se(this,"_optimizationMode",void 0),se(this,"_videoHeight",void 0),se(this,"_videoWidth",void 0),se(this,"_forceBitrateLimit",void 0),se(this,"_enabled",!0),se(this,"_processorDestination",void 0),se(this,"_processorContext",void 0),hi()){const{width:a,height:A}=e.getSettings();this._videoWidth=a,this._videoHeight=A}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=r,this._optimizationMode=i,this._hints=o||[],this._hints.indexOf(gn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(a,A,u){const d=yt();return!(d.name!==a||!d.osVersion)&&Number(d.version)===A}(Ut.CHROME,115)&&Bb().indexOf("Windows")!==-1){const a=function(A,u){if("VideoFrame"in window&&"TransformStream"in window&&Ct().supportWebRTCInsertableStream){const d=new MediaStreamTrackProcessor(A),f=new MediaStreamTrackGenerator({kind:"video"});let m,g,v=Date.now();const y=()=>{w&&(clearInterval(w),w=void 0),m&&(m.close(),m=void 0),A.stop(),g=void 0,f.removeEventListener("ended",y)};let w=window.setInterval(()=>{if(g&&m&&Date.now()-v>1e3)try{f.readyState==="live"?g.enqueue(m.clone()):y()}catch{y()}},1e3);const b=new TransformStream({transform:(I,B)=>{f.readyState==="live"?(g=B,v=Date.now(),m===void 0?(m=I,B.enqueue(I.clone())):(B.enqueue(m),m=I)):I.close()}});return f.addEventListener("ended",y),d.readable.pipeThrough(b).pipeTo(f.writable),f}}(e);a&&(S.info("local screen video track begin to inject frame"),this._mediaStreamTrack=a)}n&&this._hints.indexOf(gn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new oZ(this.getTrackId(),"local"),this._processorDestination=new sZ(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const i=document.getElementById(e);i?e=i:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=vn(vn(vn({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new Pk(r):this._player=new dZ(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(Ig.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Yt(this,Se.NEED_DISABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Yt(this,Se.NEED_ENABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,S.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Yt(this,Se.NEED_MUTE_TRACK,this):await Yt(this,Se.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new ie(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=BA(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const r=uS({encoderConfig:e});(hi()||Cs()||Ac())&&(r.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const s=new ie(L.UNEXPECTED_ERROR,i.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=e,this._hints.indexOf(gn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Yt(this,Se.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(S)}}getStats(){return Pd(()=>{S.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),va(this,Se.GET_STATS)||vn({},iU)}async setBeautyEffect(e){S.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await Uk(e)}async setBitrateLimit(e){if(S.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await Yt(this,Se.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void S.error(L.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await Yt(this,Se.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,S.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return S.error(L.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,S.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){AZ(this._originMediaStreamTrack).then(e=>{let[n,r]=e;this._videoHeight=r,this._videoWidth=n}).catch(kb)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new ie(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");S.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=BA(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(gn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Yt(this,Se.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(S)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!e||!n||!r)return;const{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){const{max:o,min:a}=function(A,u,d,f,m){const g=j("BITRATE_ADAPTER_TYPE");if(g==="DEFAULT_BITRATE")return{min:f,max:m};if(m===void 0){var v;const w=Math.floor(200*Math.pow(d/15,.6)*Math.pow(A*u/640/360,.75));m=g==="STANDARD_BITRATE"?4*w:2*w,f=(v=f)!==null&&v!==void 0?v:w}else{var y;f=(y=f)!==null&&y!==void 0?y:Math.floor(m/10)}return{min:f,max:m}}(e,n,r,s,i);this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,S.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const a=C$.checkOneElementVisible(s),A=Object.assign({},a);if(A.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=A.visible;const u=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});A.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(A.reason))}return A}return}catch(r){throw new ie(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new ie(L.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;e&&(r=vn(vn({},r),BA(e))),r=Qh(r);const i=tn(8,"track-video-cloned-"),s=new hZ(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,Qh(this._scalabilityMode),this._optimizationMode,i,Qh(this._hints));return e&&r&&s.setEncoderConfiguration(r),S.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new ie(L.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new ie(L.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(Pd(()=>{Le.reportApiInvoke(null,{name:wr.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Mn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!j("ENABLE_VIDEO_SEI")||!j("ENABLE_ENCODED_TRANSFORM"))return void S.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new ie(L.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void S.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"?this.safeEmit("sei-to-send",e):S.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(Ts.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Yt(this,Se.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Yt(this,Se.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ts.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(zo.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(zo.REQUEST_CONSTRAINTS)}},Et(mt.prototype,"play",[p5,m5],Object.getOwnPropertyDescriptor(mt.prototype,"play"),mt.prototype),Et(mt.prototype,"stop",[g5],Object.getOwnPropertyDescriptor(mt.prototype,"stop"),mt.prototype),Et(mt.prototype,"setEnabled",[_5,E5,v5],Object.getOwnPropertyDescriptor(mt.prototype,"setEnabled"),mt.prototype),Et(mt.prototype,"setMuted",[y5,w5,C5],Object.getOwnPropertyDescriptor(mt.prototype,"setMuted"),mt.prototype),Et(mt.prototype,"setEncoderConfiguration",[T5,S5],Object.getOwnPropertyDescriptor(mt.prototype,"setEncoderConfiguration"),mt.prototype),Et(mt.prototype,"getStats",[b5],Object.getOwnPropertyDescriptor(mt.prototype,"getStats"),mt.prototype),Et(mt.prototype,"setBeautyEffect",[I5,R5],Object.getOwnPropertyDescriptor(mt.prototype,"setBeautyEffect"),mt.prototype),Et(mt.prototype,"getCurrentFrameData",[O5],Object.getOwnPropertyDescriptor(mt.prototype,"getCurrentFrameData"),mt.prototype),Et(mt.prototype,"getCurrentFrameImage",[N5],Object.getOwnPropertyDescriptor(mt.prototype,"getCurrentFrameImage"),mt.prototype),Et(mt.prototype,"setBitrateLimit",[D5],Object.getOwnPropertyDescriptor(mt.prototype,"setBitrateLimit"),mt.prototype),Et(mt.prototype,"setOptimizationMode",[B5],Object.getOwnPropertyDescriptor(mt.prototype,"setOptimizationMode"),mt.prototype),Et(mt.prototype,"setScalabiltyMode",[L5],Object.getOwnPropertyDescriptor(mt.prototype,"setScalabiltyMode"),mt.prototype),Et(mt.prototype,"updateMediaStreamTrackResolution",[U5],Object.getOwnPropertyDescriptor(mt.prototype,"updateMediaStreamTrackResolution"),mt.prototype),Et(mt.prototype,"pipe",[P5],Object.getOwnPropertyDescriptor(mt.prototype,"pipe"),mt.prototype),Et(mt.prototype,"unpipe",[k5],Object.getOwnPropertyDescriptor(mt.prototype,"unpipe"),mt.prototype),Et(mt.prototype,"close",[x5],Object.getOwnPropertyDescriptor(mt.prototype,"close"),mt.prototype),Et(mt.prototype,"replaceTrack",[M5],Object.getOwnPropertyDescriptor(mt.prototype,"replaceTrack"),mt.prototype),mt),aU=(F5=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),V5=er(),Q5=Ym("CameraVideoTrack","_enabledMutex"),H5=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),j5=er(),K5=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),G5=er(),W5=Ve({argsMap:t=>[t.getTrackId()]}),Lo=class fZ extends dn{get __className__(){return"CameraVideoTrack"}constructor(e,n,r,i,s,o){super(e,BA(n.encoderConfig),i,s,o),se(this,"_config",void 0),se(this,"_originalConstraints",void 0),se(this,"_constraints",void 0),se(this,"_enabled",!0),se(this,"_deviceName","default"),se(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(qm()||WL())&&!function(){const a=yt();if(a.os!==kr.IOS||!a.osVersion)return!1;const A=a.osVersion.split(".");return Number(A[0])===15&&Number(A[1])>=2}()&&v$()&&this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=e.label,this._encoderConfig=BA(this._config.encoderConfig),Vt.on(Xr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Vt.on(Xr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(S.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await Go.getDeviceById(e),r={};r.video=vn({},this._constraints),r.video.deviceId={exact:e},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Qo(r,this.getTrackId())}catch(s){throw S.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Qo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Go.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw S.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}S.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){S.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:vn(vn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Qo(n,this.getTrackId())}catch(i){throw S.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await Qo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=vn({},n.video),S.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(S.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Qo({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await Yt(this,Se.NEED_ENABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),S.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Yt(this,Se.NEED_DISABLE_TRACK,this)}catch(r){throw S.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}S.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new ie(L.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=BA(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const r=sr(this._config);r.encoderConfig=e;const i=uS(r);(hi()||Cs()||Ac())&&(i.deviceId=void 0),S.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const o=new ie(L.UNEXPECTED_ERROR,s.toString());throw S.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,this._hints.indexOf(gn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Yt(this,Se.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(S)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Cs()||Ac())&&this._enabled&&!this._isClosed&&Vt.duringInterruption){const e=async()=>{Vt.off(Xr.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(S.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Vt.on(Xr.IOS_INTERRUPTION_END,e)}else S.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Ig.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,r=Go.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await Qo({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Vt.off(Xr.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Vt.off(Xr.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;e&&(r=vn(vn({},r),BA(e))),r=Qh(r);const i=tn(8,"track-cam-cloned-"),s=new fZ(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Qh(vn(vn({},this._config),{},{encoderConfig:r})),Qh(this._constraints),Qh(this._scalabilityMode),this._optimizationMode,i);return e&&r&&s.setEncoderConfiguration(r),S.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),s}bindProcessorContextEvents(){this.processorContext.on(zo.REQUEST_UPDATE_CONSTRAINTS,async(e,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}),this.processorContext.on(zo.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},Et(Lo.prototype,"setDevice",[F5,V5],Object.getOwnPropertyDescriptor(Lo.prototype,"setDevice"),Lo.prototype),Et(Lo.prototype,"setEnabled",[Q5,H5,j5],Object.getOwnPropertyDescriptor(Lo.prototype,"setEnabled"),Lo.prototype),Et(Lo.prototype,"setEncoderConfiguration",[K5,G5],Object.getOwnPropertyDescriptor(Lo.prototype,"setEncoderConfiguration"),Lo.prototype),Et(Lo.prototype,"close",[W5],Object.getOwnPropertyDescriptor(Lo.prototype,"close"),Lo.prototype),Lo);function pD(t,e,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=vn(vn({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?S.debug("[".concat(t,"] set content hint to"),n.optimizationMode):S.debug("[".concat(t,"] set content hint failed")))):S.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var z5,q5,Y5,X5,ua,J5,$5,Z5,eG,tG,nG,Zi;class pZ extends Y${getUserId(){return this._userId}constructor(e,n,r,i){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(tn(5,""))),se(this,"_userId",void 0),se(this,"_uintId",void 0),se(this,"_isDestroyed",!1),se(this,"store",void 0),se(this,"processor",void 0),se(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,S.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let wm=(z5=Ve({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),q5=Ve({argsMap:t=>[t.getTrackId()]}),Y5=Ve({argsMap:(t,e)=>[t.getTrackId(),e.name]}),X5=Ve({argsMap:t=>[t.getTrackId()]}),Et((ua=class extends pZ{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==ns.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,r){super(t,e,n,r),se(this,"_videoVisibleTimer",null),se(this,"_previousVideoVisibleStatus",void 0),se(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),se(this,"trackMediaType",Rg.VIDEO),se(this,"_videoWidth",void 0),se(this,"_videoHeight",void 0),se(this,"_player",void 0),se(this,"processorDestination",void 0),se(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new oZ(this.getTrackId(),"remote"),this.processorDestination=new sZ(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Pd(()=>{S.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),va(this,Se.GET_STATS)||vn({},q$)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const r=document.getElementById(t);r?t=r:(S.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}S.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=vn(vn({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new Pk(n):this._player=new dZ(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(ym.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r=>{this.safeEmit(ym.VIDEO_STATE_CHANGED,r)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(ym.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},j("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,S.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){AZ(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(kb)}_updatePlayerSource(){S.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),r={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:i,slot:s}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){const o=C$.checkOneElementVisible(i),a=Object.assign({},o);if(a.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=a.visible;const A=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});a.visible?A.onSuccess("Video is visible"):A.onSuccess("Invisible because of ".concat(a.reason))}return a}return}catch(n){throw new ie(L.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new ie(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ts.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ts.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(ef.SEI_RECEIVED,t)}}).prototype,"play",[z5],Object.getOwnPropertyDescriptor(ua.prototype,"play"),ua.prototype),Et(ua.prototype,"stop",[q5],Object.getOwnPropertyDescriptor(ua.prototype,"stop"),ua.prototype),Et(ua.prototype,"pipe",[Y5],Object.getOwnPropertyDescriptor(ua.prototype,"pipe"),ua.prototype),Et(ua.prototype,"unpipe",[X5],Object.getOwnPropertyDescriptor(ua.prototype,"unpipe"),ua.prototype),ua),Cm=(J5=Ve({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),$5=Ve({argsMap:(t,e)=>[t.getTrackId(),e]}),Z5=Ve({argsMap:t=>[t.getTrackId()]}),eG=Ve({argsMap:t=>[t.getTrackId()]}),tG=Ve({argsMap:(t,e)=>[t.getTrackId(),e.name]}),nG=Ve({argsMap:t=>[t.getTrackId()]}),Et((Zi=class extends pZ{get isPlaying(){return this._useAudioElement?Ms.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,r){super(t,e,n,r),se(this,"trackMediaType",Rg.AUDIO),se(this,"_source",void 0),se(this,"_useAudioElement",!0),se(this,"_volume",100),se(this,"processorContext",void 0),se(this,"processorDestination",void 0),se(this,"_played",!1),se(this,"_bypassWebAudio",!1),j("DISABLE_WEBAUDIO")?(this._source=new oU,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new $$(t,!0),j("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(jo.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(ym.FIRST_FRAME_DECODED)}),this.processorContext=new cZ(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new aZ(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(jo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(jo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(jo.ON_AUDIO_BUFFER),this._source.on(jo.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?Ms.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!W$())throw new ie(L.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Ms.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Pd(()=>{S.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),va(this,Se.GET_STATS)||vn({},z$)}play(){S.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(S.debug("[".concat(this.getTrackId(),"] use audio element to play")),Ms.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){S.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Ms.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];S.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ms.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new ie(L.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new ie(L.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new ie(L.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(Ts.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(Ts.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(Ts.ON_TRACK),this.processorDestination.removeAllListeners(Ts.ON_NODE)}}).prototype,"setVolume",[J5],Object.getOwnPropertyDescriptor(Zi.prototype,"setVolume"),Zi.prototype),Et(Zi.prototype,"setPlaybackDevice",[$5],Object.getOwnPropertyDescriptor(Zi.prototype,"setPlaybackDevice"),Zi.prototype),Et(Zi.prototype,"play",[Z5],Object.getOwnPropertyDescriptor(Zi.prototype,"play"),Zi.prototype),Et(Zi.prototype,"stop",[eG],Object.getOwnPropertyDescriptor(Zi.prototype,"stop"),Zi.prototype),Et(Zi.prototype,"pipe",[tG],Object.getOwnPropertyDescriptor(Zi.prototype,"pipe"),Zi.prototype),Et(Zi.prototype,"unpipe",[nG],Object.getOwnPropertyDescriptor(Zi.prototype,"unpipe"),Zi.prototype),Zi);const Rl=new class extends Ln{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),se(this,"_lastHiddenTime",0),se(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),S.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class mZ extends Ln{constructor(e,n){super(),se(this,"trackMediaType",Rg.DATA),se(this,"_version",1),se(this,"_type",3),se(this,"_config",void 0),se(this,"_originDataChannel",void 0),se(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),se(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),se(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return j("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ye((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const r=setTimeout(()=>{var i;n(new ie(L.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new ie(L.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new ie(L.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[YT.OPEN,YT.CLOSE,YT.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),e.addEventListener(n,r)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;e.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class uDe extends mZ{constructor(e){super(e),se(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(j("SHOW_DATASTREAM2_LOG")&&S.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=n.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(YT.MESSAGE,s)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class dDe extends mZ{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function JT(){const t=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>TK.revokeObjectURL(t),0),new Worker(TK.createObjectURL(t))}const DC=new Map,BC=new Map;function hDe(t,e,n){let r=new Uint8Array(t,e,n),i=[],s=0;for(;i.length<n;)s+3<n&&r[s]===0&&r[s+1]===0&&r[s+2]===3&&(r[s+3]===0||r[s+3]===1||r[s+3]===2||r[s+3]===3)?(i.push(r[s],r[s+1],r[s+3]),s+=4):(i.push(r[s]),s++);return new Uint8Array(i)}const LC=new Map;async function fDe(t,e){if(!Ct().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(LC.has(t)||!t.track)return;const n={track:t.track};if(gd()){if(!t.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let i=null;try{i=t.createEncodedStreams()}catch(a){return void S.error("create video-encoded-streams error",a&&a.message)}let s=[];e.on("sei-to-send",a=>{s.push(a)});const o=new TransformStream({transform(a,A){n.controller||(n.controller=A),t.track&&t.track.id!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",r),n.track=t.track,n.track.addEventListener("ended",r));const u=s.shift();u&&(a.data=function(d,f){const m=function(I){const B=I.length;let M=[],H=0;for(;H<B;)H+2<B&&I[H]===0&&I[H+1]===0&&(I[H+2]===0||I[H+2]===1||I[H+2]===2||I[H+2]===3)?(M.push(I[H],I[H+1],3,I[H+2]),H+=3):(M.push(I[H]),H++);return new Uint8Array(M)}(f),g=m.length,v=Math.floor(g/255),y=g%255,w=new Uint8Array(6+v+1+g+d.byteLength);w[0]=0,w[1]=0,w[2]=0,w[3]=1,w[4]=6,w[5]=101;let b=0;for(;b<v;)w[6+b]=255,b++;return w[6+b]=y,b++,w.set(m,6+b),w.set(new Uint8Array(d),6+b+g),w.buffer}(a.data,u)),A.enqueue(a)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(!hi())return;{if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const i=JT(),s=new MessageChannel;await new ye(a=>i.onmessage=A=>{A.data==="registered"&&a(void 0)});const o=new RTCRtpScriptTransform(i,{name:"tx",port:s.port2},[s.port2]);t.transform=o,await new ye(a=>i.onmessage=A=>{A.data==="started"&&a(void 0)}),e.on("sei-to-send",a=>{s.port1.postMessage({sei:a})}),s.port1.onmessage=a=>{var A;a.data.transformed&&t.track&&((A=t.track)===null||A===void 0?void 0:A.id)!==n.track.id&&(S.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",r),n.track=t.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",r)}const i=LC.get(t);if(i){LC.delete(t);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(a){S.warning(a&&a.message)}}}LC.set(t,n),t.track.addEventListener("ended",r)}const K_=new Map;(function(){const t=yt();Gr.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Gr.getStreamFromExtension=t.name===Ut.CHROME&&Number(t.version)>34,Gr.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),Gr.supportMinBitrate=t.name===Ut.CHROME||t.name===Ut.EDGE,Gr.supportSetRtpSenderParameters=function(){const e=yt();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ud()||!(!hi()&&!aS())||e.name===Ut.FIREFOX&&Number(e.version)>=64)}(),t.name===Ut.SAFARI&&(Number(t.version)>=14?Gr.supportDualStream=!0:Gr.supportDualStream=!1),Gr.webAudioMediaStreamDest=function(){const e=yt();return!(e.name===Ut.SAFARI&&Number(e.version)<12)}(),Gr.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Gr.supportWebGL=typeof WebGLRenderingContext<"u",Gr.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ud()||(Gr.webAudioWithAEC=!0),Gr.supportShareAudio=function(){const e=yt();return(e.os===kr.WIN_10||e.os===kr.WIN_81||e.os===kr.WIN_7||e.os===kr.LINUX||e.os===kr.MAC_OS||e.os===kr.CHROMIUM_OS)&&e.name===Ut.CHROME&&Number(e.version)>=74}(),Gr.supportDataChannel=!!(GL(76)||function(e){const n=yt();return!(n.name!==Ut.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||g$(14)),Gr.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!Vn()&&!!e&&e.prototype.setConfiguration instanceof Function}(),Gr.supportWebRTCEncodedTransform=function(){const e=yt();return e.name==="Chrome"&&Number(e.version)>=86||e.name==="Safari"&&Number(e.version)>=15}(),Gr.supportWebRTCInsertableStream=function(){const e=yt();return(e.name===Ut.CHROME||e.name===Ut.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Gr.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Gr.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,Pb(()=>{Gr.supportDualStreamEncoding=function(){const e=yt();return!!j("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&j("CHROME_DUAL_STREAM_USE_ENCODING"))}(),S.info("browser compatibility",JSON.stringify(Gr),JSON.stringify(t))})})();class mf extends Ln{constructor(e,n){super(),N(this,"signal",void 0),N(this,"token",void 0),N(this,"tokenTimeout",void 0),N(this,"tokenInterval",void 0),N(this,"_sequence",0),N(this,"userMap",new Map),N(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const r=()=>{this.signal.connectionState===en.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*j("P2P_TOKEN_INTERVAL"))};r()}async send(e,n,r,i,s){var o,a,A;if(this.userMap.size===0)return;const u=Array.from(Hl(o=this.userMap).call(o))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=(a=i)!==null&&a!==void 0?a:tn(6,""),s=(A=s)!==null&&A!==void 0?A:this._sequence++;const d={_id:i,_type:e,_seq:s,_message:n,token:"".concat(this.token,"_").concat(u)};j("SHOW_P2P_LOG")&&S.debug("send message",d,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(d)).forEach(m=>{this.signal.request(We.DATA_STREAM,{payload:_d(this.encoder.encode(m))})});const f=new ye((m,g)=>{const v=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),b),this.off(vp.ABORT,w),S.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(i)),this.userMap.size===0?g(new ie(L.INVALID_REMOTE_USER)):g(new ie(L.TIMEOUT))},j("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),y=()=>{v&&window.clearTimeout(v),this.off(vp.ABORT,w),r&&m()},w=()=>{v&&window.clearTimeout(v),this.off("res-@".concat(i,"_ack"),y),this.off("res-@".concat(i),b),g(new ie(L.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(i)))};this.once(vp.ABORT,w),this.once("res-@".concat(i,"_ack"),y);const b=(B,M)=>{I=!0,v&&window.clearTimeout(v),this.off("res-@".concat(i,"_ack"),y),this.off(vp.ABORT,w),B==="success"?m(M):g(new ie(L.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(i)))};let I=!1;r||(this.once("res-@".concat(i),b),Zr(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{I||S.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(i,", ").concat(d))}))});try{return await f}catch(m){if(m.code===L.TIMEOUT)return await this.send(e,n,r,i,s);throw m}}onMessage(e){var n;const{_uid:r}=e;let i,s=this.userMap.get(r);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==Jn.CHECK)return;const{token:u}=e;i=new Map,s={uid:r,isStart:!0,token:u,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,s),this.signal.emit(ft.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in e&&"total"in e){var o;const{id:u,total:d}=e,f=(o=i.get(u))!==null&&o!==void 0?o:[];if(f.push(e),i.has(u)||i.set(u,f),f.length!==d)return;{const m=yy(f).call(f,(g,v)=>g.index-v.index).map(g=>g.payload).join("");i.delete(u),(e=JSON.parse(m))._uid=r}}const{_type:a,token:A}=e;if(Te(n=[Jn.ACK,Jn.CHECK]).call(n,a))return a===Jn.CHECK&&this.handleCheckToken(s,A),void this.receiveMessage(e);A==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(e):S.debug('Receive unexpected message", '.concat(A,", cur_token: ").concat(s.token,"_").concat(this.token),e)}check(){const e={_id:tn(6,""),token:this.token,_type:Jn.CHECK};j("SHOW_P2P_LOG")&&S.debug("send message",e),this.signal.request(We.DATA_STREAM,{payload:_d(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:Jn.ACK,token:this.token};j("SHOW_P2P_LOG")&&S.debug("send message",n),this.signal.request(We.DATA_STREAM,{payload:_d(this.encoder.encode(JSON.stringify(n)))})}response(e,n,r){this.send(Jn.RESPONSE,JSON.stringify({success:!r,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(u=>{const{receivedMessagesMap:d,nextExpectedSequenceNumber:f}=u;for(;d.has(f);){const m=d.get(f);d.delete(f),this.receiveMessage(m),u.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:r,_seq:i}=e,s=this.userMap.get(r),{receivedMessagesMap:o,isStart:a,nextExpectedSequenceNumber:A}=s;if(i<A)return this.ack(e._id),void S.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(e._message));o.set(i,e),a&&i===A&&(this.receiveMessage(e),o.delete(A),s.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:r,_message:i,_uid:s}=e;if(j("SHOW_P2P_LOG")&&S.debug("receive message",e),n){let o;switch(e._type!==Jn.ACK&&(i&&(o=JSON.parse(i)),this.ack(e._id)),e._type){case Jn.CANDIDATE:case Jn.CONTROL:this.signal.emit(r,o,s);break;case Jn.PUBLISH:case Jn.UNPUBLISH:case Jn.RESTART_ICE:case Jn.CALL:o.uid=s,fi(this.signal,r,o).then(a=>{this.response(e._id,a)}).catch(()=>{this.response(e._id,void 0,!0)});break;case Jn.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Jn.RESPONSE:{const{success:a,message:A}=o;this.emit("res-@".concat(n),a?"success":"failed",A);break}}}}splitMessage(e){if(e.length<mf.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:r}=JSON.parse(e),i=tn(6,"");let s=0,o=800;const a=Math.ceil(e.length/o);for(;e.length>0;){s++;const A={id:i,index:s,total:a,payload:e.slice(0,o),token:"".concat(this.token,"_").concat(r)};JSON.stringify(A).length>mf.MAX_MESSAGE_SIZE?o-=50:(n.push(A),e=e.slice(o))}return n.map(A=>JSON.stringify(A))}handleCheckToken(e,n){return e.token!==n?(S.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{S.debug("token timeout, ".concat(n)),this.reset(e.uid)},j("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await fi(this.signal,Jn.CALL,void 0),n=await this.send(Jn.CALL,e);this.signal.emit(ze.P2P_CONNECTION,n,!0)}async reset(e,n){const r=this.userMap.get(e);r&&(this.emit(vp.ABORT),this.signal.emit(ft.ON_USER_OFFLINE,{uid:r.uid,reason:NOe.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(S.debug("change local token from ".concat(n," to ").concat(n)),this.token=tn(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(vp.ABORT)}}N(mf,"MAX_SIZE",1),N(mf,"MAX_MESSAGE_SIZE",1024);class rG extends Ln{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===en.CONNECTED?this.emit(ze.WS_CONNECTED):e===en.RECONNECTING?this.emit(ze.WS_RECONNECTING,this._websocketReconnectReason):e===en.CLOSED&&this.emit(ze.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),N(this,"_disconnectedReason",void 0),N(this,"_websocketReconnectReason",void 0),N(this,"_connectionState",en.CLOSED),N(this,"reconnectToken",void 0),N(this,"p2pToken",void 0),N(this,"websocket",void 0),N(this,"openConnectionTime",void 0),N(this,"clientId",void 0),N(this,"lastMsgTime",Date.now()),N(this,"uploadCache",[]),N(this,"uploadCacheInterval",void 0),N(this,"rttRolling",new O$(5)),N(this,"pingpongTimer",void 0),N(this,"pingpongTimeoutCount",0),N(this,"joinResponse",void 0),N(this,"multiIpOption",void 0),N(this,"initError",void 0),N(this,"spec",void 0),N(this,"store",void 0),N(this,"_external_signal",void 0),N(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(ze.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case ft.ON_DATA_STREAM:return void this.handleDataStream(i._message);case ft.MUTE_AUDIO:case ft.MUTE_VIDEO:case ft.ON_P2P_LOST:case ft.ON_USER_ONLINE:return;case ft.ON_USER_OFFLINE:const{uid:s}=i._message;return S.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===ft.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===ft.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Mt.UID_BANNED);break;case 15:this.close(Mt.IP_BANNED);break;case 16:this.close(Mt.CHANNEL_BANNED)}if(i._type===ft.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case xe.ERR_LICENSE_MISSING:this.close(Mt.LICENSE_MISSING);break;case xe.ERR_LICENSE_EXPIRED:this.close(Mt.LICENSE_EXPIRED);break;case xe.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Mt.LICENSE_MINUTES_EXCEEDED);break;case xe.ERR_LICENSE_PERIOD_INVALID:this.close(Mt.LICENSE_PERIOD_INVALID);break;case xe.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Mt.LICENSE_MULTIPLE_SDK_SERVICE);break;case xe.ERR_LICENSE_ILLEGAL:this.close(Mt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new Ik("gateway-".concat(this.clientId),this.spec.retryConfig,!0,j("JOIN_GATEWAY_USE_DUAL_DOMAIN"),j("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===en.CONNECTED&&this.reconnect("retry",li.OFFLINE)}),this.p2pToken=tn(6,""),this._external_signal=new mf(this,this.p2pToken)}async request(e,n,r,i){const s=tn(6,""),o={_id:s,_type:e,_message:n},a=this.websocket.connectionID,A=()=>new ye((v,y)=>{if(this.connectionState===en.CONNECTED)return v();const w=()=>{this.off(ze.WS_CLOSED,b),v()},b=()=>{this.off(ze.WS_CONNECTED,w),y(new ie(L.WS_ABORT))};this.once(ze.WS_CONNECTED,w),this.once(ze.WS_CLOSED,b)});if(this.connectionState!==en.CONNECTING&&this.connectionState!==en.RECONNECTING||e===We.JOIN||e===We.REJOIN||await A(),this.websocket.sendMessage(o,!0),i)return;const u=new ye((v,y)=>{let w=!1;const b=(B,M)=>{w=!0,v({isSuccess:B==="success",message:M||{}}),this.off(ze.WS_CLOSED,I),this.off(ze.WS_RECONNECTING,I),this.emit(ze.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(s),b);const I=()=>{y(new ie(L.WS_ABORT,"type: ".concat(e))),this.off(ze.WS_CLOSED,I),this.off(ze.WS_RECONNECTING,I),this.off("res-@".concat(s),b)};this.once(ze.WS_CLOSED,I),this.once(ze.WS_RECONNECTING,I),Zr(j("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||w||(S.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(ze.REQUEST_TIMEOUT,e,n))})});let d=null;try{d=await u}catch(v){if(this.connectionState===en.CLOSED||e===We.LEAVE)throw new ie(L.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?v.throw():e===We.JOIN||e===We.REJOIN?null:(await A(),await this.request(e,n))}if(d.isSuccess)return d.message;const f=Number(d.message.error_code||d.message.code),m=Sv(f),g=new ie(L.UNEXPECTED_RESPONSE,"".concat(m.desc,": ").concat(d.message.error_str),{code:f,data:d.message,desc:m.desc});return m.action==="success"?d.message:(S.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(f,", message: ").concat(m.desc,", action: ").concat(m.action)),f===xe.ERR_TOO_MANY_BROADCASTERS?((e===We.JOIN||e===We.REJOIN)&&(this.initError=g,this.close()),g.throw()):m.action==="failed"?g.throw():m.action==="quit"?(this.initError=g,this.close(),g.throw()):(f===xe.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=d.message.option,S.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",li.MULTI_IP)):this.reconnect(m.action,li.SERVER_ERROR),e===We.JOIN||e===We.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new ye(r=>{const i=s=>{(!n||n(s))&&(this.off(e,i),r(s))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void S.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Tv.WRTC_STATS,n)}upload(e,n){const r={_type:e,_message:n};try{this.websocket.sendMessage(r)}catch{const s=j("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>s&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==en.CONNECTED)return;const o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},j("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const r={_type:e,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(e,n,r){return await this._external_signal.send(e,n,r)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ye((n,r)=>{this.once(ze.WS_CONNECTED,()=>n(this.joinResponse)),this.once(ze.WS_CLOSED,()=>r(this.initError||new ie(L.WS_ABORT))),this.connectionState=en.CONNECTING,this.websocket.init(e).catch(r)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Mt.LEAVE,this.connectionState=en.CLOSED,S.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=tn(6,""),this._external_signal.clear(),this._external_signal=new mf(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(ze.ABORT_P2P_EXECUTION);const e=await fi(this,ze.REQUEST_JOIN_INFO),n=await this.request(We.JOIN,e);if(!n)return this.emit(ze.REPORT_JOIN_GATEWAY,L.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(ze.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=en.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const r=Hh(e.payload),i=new TextDecoder().decode(r),s=JSON.parse(i);"total"in s&&"id"in s||Te(n=Object.values(Jn)).call(n,s._type)?(s._uid=e.uid,this._external_signal.onMessage(s)):this.emit(ft.ON_DATA_STREAM,e)}catch{this.emit(ft.ON_DATA_STREAM,e)}}handleNotification(e){S.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Sv(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Mt.UID_BANNED),void this.close()):void this.reconnect(n.action,li.SERVER_ERROR);S.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=j("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(S.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>j("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",li.TIMEOUT):this.request(We.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),j("REPORT_STATS")&&this.send(We.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(Ye.RECONNECT_WAITTING_FINISH,e=>{this.emit(ze.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(Ye.RECONNECT_CREATE_CONNECTION,e=>{this.emit(ze.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Ye.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ye.CLOSED,()=>{this.connectionState=en.CLOSED}),this.websocket.on(Ye.FAILED,()=>{this._disconnectedReason=Mt.NETWORK_ERROR,this.connectionState=en.CLOSED}),this.websocket.on(Ye.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===en.CONNECTED?this.connectionState=en.RECONNECTING:this.connectionState=en.CONNECTING}),this.websocket.on(Ye.WILL_RECONNECT,(e,n,r)=>{e!=="retry"?(S.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):S.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(e)}),this.websocket.on(Ye.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(ze.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof ie&&e.code===L.UNEXPECTED_RESPONSE&&e.data.code===xe.ERR_NO_AUTHORIZED)return S.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",li.SERVER_ERROR);S.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",li.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Ye.REQUEST_NEW_URLS,(e,n)=>{fi(this,ze.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(Ye.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var gZ={exports:{}};gZ.exports=(()=>{var t={8:(r,i,s)=>{s.r(i),s.d(i,{Parser:()=>k,Printer:()=>qe,parse:()=>Y,print:()=>Z});const o=`
`,a="".concat("\r").concat(o),A=" ";let u;function d(P){return P>="0"&&P<="9"}function f(P){return P>="!"&&P<="~"}function m(P){return f(P)||P>=""&&P<=""}function g(P){return P==="!"||P>="#"&&P<="'"||P>="*"&&P<="+"||P>="-"&&P<="."||P>="0"&&P<="9"||P>="A"&&P<="Z"||P>="^"&&P<="~"}function v(P){return P>="1"&&P<="9"}function y(P){return P>="A"&&P<="Z"||P>="a"&&P<="z"}function w(P){return P==="d"||P==="h"||P==="m"||P==="s"}function b(P){return P>""&&P<"	"||P>"\v"&&P<"\f"||P>""&&P<""}function I(P){return y(P)||d(P)||P==="+"||P==="/"}function B(P){return d(P)||y(P)||P==="+"||P==="/"||P==="-"||P==="_"}function M(P){return y(P)||d(P)||P==="+"||P==="/"}function H(P,C){var D=Object.keys(P);if(Object.getOwnPropertySymbols){var U=Object.getOwnPropertySymbols(P);C&&(U=U.filter(function(ee){return Object.getOwnPropertyDescriptor(P,ee).enumerable})),D.push.apply(D,U)}return D}function K(P){for(var C=1;C<arguments.length;C++){var D=arguments[C]!=null?arguments[C]:{};C%2?H(Object(D),!0).forEach(function(U){Q(P,U,D[U])}):Object.getOwnPropertyDescriptors?Object.defineProperties(P,Object.getOwnPropertyDescriptors(D)):H(Object(D)).forEach(function(U){Object.defineProperty(P,U,Object.getOwnPropertyDescriptor(D,U))})}return P}function Q(P,C,D){return C in P?Object.defineProperty(P,C,{value:D,enumerable:!0,configurable:!0,writable:!0}):P[C]=D,P}(function(P){P.VERSION="v",P.ORIGIN="o",P.SESSION_NAME="s",P.INFORMATION="i",P.URI="u",P.EMAIL="e",P.PHONE="p",P.CONNECTION="c",P.BANDWIDTH="b",P.TIME="t",P.REPEAT="r",P.ZONE_ADJUSTMENTS="z",P.KEY="k",P.ATTRIBUTE="a",P.MEDIA="m"})(u||(u={}));class F{consumeText(C,D){let U=D;for(;U<C.length;){const ee=C[U];if(ee==="\0"||ee==="\r"||ee===o)break;U+=1}if(U-D==0)throw new Error("Invalid text, at ".concat(C));return U}consumeUnicastAddress(C,D,U){return this.consumeTill(C,D,A)}consumeOneOrMore(C,D,U){let ee=D;for(;U(C[ee]);)ee++;if(ee-D==0)throw new Error("Invalid rule at ".concat(D,"."));return ee}consumeSpace(C,D){if(C[D]===A)return D+1;throw new Error("Invalid space at ".concat(D,"."))}consumeIP4Address(C,D){let U=D;for(let ee=0;ee<4;ee++)if(U=this.consumeDecimalUChar(C,U),ee!==3){if(C[U]!==".")throw new Error("Invalid IP4 address.");U++}return U}consumeDecimalUChar(C,D){let U=D;for(let Ee=0;Ee<3&&d(C[U]);Ee++,U++);if(U-D==0)throw new Error("Invalid decimal uchar.");const ee=parseInt(C.slice(D,U));if(ee>=0&&ee<=255)return U;throw new Error("Invalid decimal uchar")}consumeIP6Address(C,D){let U=this.consumeHexpart(C,D);return C[U]===":"&&(U+=1,U=this.consumeIP4Address(C,U)),U}consumeHexpart(C,D){let U=D;if(C[U]===":"&&C[U+1]===":"){U+=2;try{U=this.consumeHexseq(C,U)}catch{}return U}if(U=this.consumeHexseq(C,U),C[U]===":"&&C[U+1]===":"){U+=2;try{U=this.consumeHexseq(C,U)}catch{}return U}return U}consumeHexseq(C,D){let U=D;for(;U=this.consumeHex4(C,U),C[U]===":"&&C[U+1]!==":";)U+=1;return U}consumeHex4(C,D){let U=0;for(;U<4;U++)if(!((ee=C[D+U])>="0"&&ee<="9"||ee>="a"&&ee<="f"||ee>="A"&&ee<="F")){if(U===0)throw new Error("Invalid hex 4");break}var ee;return D+U}consumeFQDN(C,D){let U=D;for(;d(C[U])||y(C[U])||C[U]==="-"||C[U]===".";)U+=1;if(U-D<4)throw new Error("Invalid FQDN");return U}consumeExtnAddr(C,D){return this.consumeOneOrMore(C,D,m)}consumeMulticastAddress(C,D,U){switch(U){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(C,D);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(C,D);default:try{return this.consumeFQDN(C,D)}catch{return this.consumeExtnAddr(C,D)}}}consumeIP6MulticastAddress(C,D){const U=this.consumeHexpart(C,D);return C[U]==="/"?this.consumeInteger(C,U+1):U}consumeIP4MulticastAddress(C,D){let U=D+3;const ee=C.slice(D,U),Ee=parseInt(ee);if(Ee<224||Ee>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Re=0;Re<3;Re++){if(C[U]!==".")throw new Error("Invalid IP4 multicast address.");U+=1,U=this.consumeDecimalUChar(C,U)}return C[U]==="/"&&(U+=1),U=this.consumeTTL(C,U),C[U]==="/"&&(U=this.consumeInteger(C,U)),U}consumeInteger(C,D){if(!v(C[D]))throw new Error("Invalid integer.");for(D+=1;d(C[D]);)D+=1;return D}consumeTTL(C,D){if(C[D]==="0")return D+1;if(!v(C[D]))throw new Error("Invalid TTL.");D+=1;for(let U=0;U<2&&d(C[D]);U++)D+=1;return D}consumeToken(C,D){return this.consumeOneOrMore(C,D,g)}consumeTime(C,D){let U=D;if(C[U]==="0")return U+1;for(v(C[U])&&(U+=1);d(C[U]);)U++;if(U-D<10)throw new Error("Invalid time");return U}consumeAddress(C,D){return this.consumeTill(C,D,A)}consumeTypedTime(C,D){let U=D;return U=this.consumeOneOrMore(C,U,d),w(C[U])?U+1:U}consumeRepeatInterval(C,D){if(!v(C[D]))throw new Error("Invalid repeat interval");for(D+=1;d(C[D]);)D+=1;return w(C[D])&&(D+=1),D}consumePort(C,D){return this.consumeOneOrMore(C,D,d)}consume(C,D,U){for(let ee=0;ee<U.length;ee++){if(D+ee>=C.length)throw new Error("consume exceeding value length");if(C[D+ee]!==U[ee])throw new Error("consume ".concat(U," failed at ").concat(ee))}return D+U.length}consumeTill(C,D,U){let ee=D;for(;ee<C.length&&(typeof U!="string"||C[ee]!==U)&&(typeof U!="function"||!U(C[ee]));)ee++;return ee}}class k extends F{constructor(){super(),Q(this,"records",[]),Q(this,"currentLine",0)}parse(C){const D=this.probeEOL(C);this.records=C.split(D).filter(Xt=>!!is(Xt).call(Xt)).map(this.parseLine),this.currentLine=0;const U=this.parseVersion(),ee=this.parseOrigin(),Ee=this.parseSessionName(),Re=this.parseInformation(),lt=this.parseUri(),St=this.parseEmail(),Tr=this.parsePhone(),cs=this.parseConnection(),As=this.parseBandWidth(),gr=this.parseTimeFields(),xi=this.parseKey(),vi=this.parseSessionAttribute(),Jt=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:U,origin:ee,sessionName:Ee,information:Re,uri:lt,emails:St,phones:Tr,connection:cs,bandwidths:As,timeFields:gr,key:xi,attributes:vi,mediaDescriptions:Jt}}getCurrentRecord(){const C=this.records[this.currentLine];if(!C)throw new Error("Record doesn't exit.");return C}probeEOL(C){for(let D=0;D<C.length;D++)if(C[D]===o)return C[D-1]==="\r"?a:o;throw new Error("Invalid newline character.")}parseLine(C,D){if(C.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const U=C[0];if(C[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:U,value:C.slice(2),line:D,cur:0}}parseSessionAttribute(){const C=new $;for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==u.ATTRIBUTE)break;const U={attField:this.extractOneOrMore(D,ee=>g(ee)&&ee!==":"),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,U.attValue=this.extractOneOrMore(D,b)),C.parse(U),this.currentLine++}return C.digest()}parseMediaAttributes(C){const D=new ne(C);for(;this.currentLine<this.records.length;){const U=this.getCurrentRecord();if(U.type!==u.ATTRIBUTE)break;const ee={attField:this.extractOneOrMore(U,Ee=>g(Ee)&&Ee!==":"),_cur:0};U.value[U.cur]===":"&&(U.cur+=1,ee.attValue=this.extractOneOrMore(U,b)),D.parse(ee),this.currentLine++}return D.digest()}parseKey(){const C=this.getCurrentRecord();if(C.type===u.KEY){if(C.value==="prompt"||C.value==="clear:"||C.value==="base64:"||C.value==="uri:")return C.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const C=this.getCurrentRecord();if(C.type===u.ZONE_ADJUSTMENTS){const D=[];for(;;)try{const U=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);let ee=!1;C.value[C.cur]==="-"&&(ee=!0,C.cur+=1);const Ee=this.extract(C,this.consumeTypedTime);D.push({time:U,typedTime:Ee,back:ee})}catch{break}if(D.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,D}return[]}parseRepeat(){const C=[];for(;;){const D=this.getCurrentRecord();if(D.type!==u.REPEAT)break;{const U=this.extract(D,this.consumeRepeatInterval),ee=this.parseTypedTime(D);C.push({repeatInterval:U,typedTimes:ee}),this.currentLine++}}return C}parseTypedTime(C){const D=[];for(;;)try{this.consumeSpaceForRecord(C),D.push(this.extract(C,this.consumeTypedTime))}catch{break}if(D.length===0)throw new Error("Invalid typed time.");return D}parseTime(){const C=this.getCurrentRecord(),D=this.extract(C,this.consumeTime);this.consumeSpaceForRecord(C);const U=this.extract(C,this.consumeTime);return this.currentLine++,{startTime:D,stopTime:U}}parseBandWidth(){const C=[];for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==u.BANDWIDTH)break;{const U=this.extractOneOrMore(D,g);if(D.value[D.cur]!==":")throw new Error("Invalid bandwidth field.");D.cur++;const ee=this.extractOneOrMore(D,d);C.push({bwtype:U,bandwidth:ee}),this.currentLine++}}return C}parseVersion(){const C=this.getCurrentRecord();if(C.type!==u.VERSION)throw new Error("first sdp record must be version");const D=C.value.slice(0,this.consumeOneOrMore(C.value,0,d));if(D.length!==C.value.length)throw new Error('invalid proto version, "v='.concat(C.value,'"'));return this.currentLine++,D}parseOrigin(){const C=this.getCurrentRecord();if(C.type!==u.ORIGIN)throw new Error("second line of sdp must be origin");const D=this.extractOneOrMore(C,m);this.consumeSpaceForRecord(C);const U=this.extractOneOrMore(C,d);this.consumeSpaceForRecord(C);const ee=this.extractOneOrMore(C,d);this.consumeSpaceForRecord(C);const Ee=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const Re=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const lt=this.extract(C,this.consumeUnicastAddress);return this.currentLine++,{username:D,sessId:U,sessVersion:ee,nettype:Ee,addrtype:Re,unicastAddress:lt}}parseSessionName(){const C=this.getCurrentRecord();if(C.type===u.SESSION_NAME){const D=this.extract(C,this.consumeText);return this.currentLine++,D}}parseInformation(){const C=this.getCurrentRecord();if(C.type!==u.INFORMATION)return;const D=this.extract(C,this.consumeText);return this.currentLine++,D}parseUri(){const C=this.getCurrentRecord();if(C.type===u.URI)return this.currentLine++,C.value}parseEmail(){const C=[];for(;;){const D=this.getCurrentRecord();if(D.type!==u.EMAIL)break;C.push(D.value),this.currentLine++}return C}parsePhone(){const C=[];for(;;){const D=this.getCurrentRecord();if(D.type!==u.PHONE)break;C.push(D.value),this.currentLine++}return C}parseConnection(){const C=this.getCurrentRecord();if(C.type===u.CONNECTION){const D=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const U=this.extractOneOrMore(C,g);this.consumeSpaceForRecord(C);const ee=this.extract(C,this.consumeAddress);return this.currentLine++,{nettype:D,addrtype:U,address:ee}}}parseMedia(){const C=this.getCurrentRecord(),D=this.extract(C,this.consumeToken);this.consumeSpaceForRecord(C);let U=this.extract(C,this.consumePort);C.value[C.cur]==="/"&&(C.cur+=1,U+=this.extract(C,this.consumeInteger)),this.consumeSpaceForRecord(C);const ee=[];for(ee.push(this.extract(C,this.consumeToken));C.value[C.cur]==="/";)C.cur+=1,ee.push(this.extract(C,this.consumeToken));if(ee.length===0)throw new Error("Invalid proto");const Ee=this.parseFmt(C);return this.currentLine++,{mediaType:D,port:U,protos:ee,fmts:Ee}}parseTimeFields(){const C=[];for(;this.getCurrentRecord().type===u.TIME;){const D=this.parseTime(),U=this.parseRepeat(),ee=this.parseZone();C.push({time:D,repeats:U,zones:ee})}return C}parseMediaDescription(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u.MEDIA;){const D=this.parseMedia(),U=this.parseInformation(),ee=this.parseConnections(),Ee=this.parseBandWidth(),Re=this.parseKey(),lt=this.parseMediaAttributes(D);C.push({media:D,information:U,connections:ee,bandwidths:Ee,key:Re,attributes:lt})}return C}parseConnections(){const C=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u.CONNECTION;)C.push(this.parseConnection());return C}parseFmt(C){const D=[];for(;;)try{this.consumeSpaceForRecord(C),D.push(this.extract(C,this.consumeToken))}catch{break}if(D.length===0)throw new Error("Invalid fmts");return D}extract(C,D){for(var U=arguments.length,ee=new Array(U>2?U-2:0),Ee=2;Ee<U;Ee++)ee[Ee-2]=arguments[Ee];const Re=D.call(this,C.value,C.cur,...ee),lt=C.value.slice(C.cur,Re);return C.cur=Re,lt}extractOneOrMore(C,D){const U=this.consumeOneOrMore(C.value,C.cur,D),ee=C.value.slice(C.cur,U);return C.cur=U,ee}consumeSpaceForRecord(C){if(C.value[C.cur]!==A)throw new Error("Invalid space at ".concat(C.cur,"."));C.cur+=1}}class G extends F{constructor(){super(...arguments),Q(this,"attributes",void 0),Q(this,"digested",!1)}extractOneOrMore(C,D,U){const ee=this.consumeOneOrMore(C.attValue,C._cur,D),Ee=C.attValue.slice(C._cur,ee),[Re,lt]=U||[];if(typeof Re=="number"&&Ee.length<Re)throw new Error("error in length, should be more or equal than ".concat(Re," characters."));if(typeof lt=="number"&&Ee.length>lt)throw new Error("error in length, should be less or equal than ".concat(lt," characters."));return C._cur=ee,Ee}consumeAttributeSpace(C){if(C.attValue[C._cur]!==A)throw new Error("Invalid space at ".concat(C._cur,"."));C._cur+=1}extract(C,D){if(!C.attValue)throw new Error("Nothing to extract from attValue.");for(var U=arguments.length,ee=new Array(U>2?U-2:0),Ee=2;Ee<U;Ee++)ee[Ee-2]=arguments[Ee];const Re=D.call(this,C.attValue,C._cur,...ee),lt=C.attValue.slice(C._cur,Re);return C._cur=Re,lt}atEnd(C){if(!C.attValue)throw new Error;return C._cur>=C.attValue.length}peekChar(C){if(!C.attValue)throw new Error;return C.attValue[C._cur]}peek(C,D){if(!C.attValue)throw new Error;for(let U=0;U<D.length;U++)if(D[U]!==C.attValue[C._cur+U])return!1;return!0}parseIceUfrag(C){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(C,I,[4,256])}parseIcePwd(C){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(C,I,[22,256])}parseIceOptions(C){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const D=[];for(;!this.atEnd(C);){D.push(this.extractOneOrMore(C,I));try{this.consumeAttributeSpace(C)}catch(U){if(this.atEnd(C))break;throw U}}this.attributes.iceOptions=D}parseFingerprint(C){const D=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const U=this.extract(C,this.consumeTill);this.attributes.fingerprints.push({hashFunction:D,fingerprint:U})}parseExtmap(C){const D=this.extractOneOrMore(C,d);let U;this.peekChar(C)==="/"&&(this.extract(C,this.consume,"/"),U=this.extract(C,this.consumeToken)),this.consumeAttributeSpace(C);const ee=this.extract(C,this.consumeTill,A),Ee=K(K({entry:parseInt(D,10)},U&&{direction:U}),{},{extensionName:ee});this.peekChar(C)===A&&(this.consumeAttributeSpace(C),Ee.extensionAttributes=this.extract(C,this.consumeTill)),this.attributes.extmaps.push(Ee)}parseSetup(C){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const D=this.extract(C,this.consumeTill);if(D!=="active"&&D!=="passive"&&D!=="actpass"&&D!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=D}}class $ extends G{constructor(){super(...arguments),Q(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"group":this.parseGroup(C);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"fingerprint":this.parseFingerprint(C);break;case"setup":this.parseSetup(C);break;case"tls-id":this.parseTlsId(C);break;case"identity":this.parseIdentity(C);break;case"extmap":this.parseExtmap(C);break;case"msid-semantic":this.parseMsidSemantic(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(D){throw console.error("parsing session attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),D}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(C){const D=this.extract(C,this.consumeToken),U=[];for(;!this.atEnd(C)&&this.peekChar(C)===A;)this.consumeAttributeSpace(C),U.push(this.extract(C,this.consumeToken));this.attributes.groups.push({semantic:D,identificationTag:U})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(C){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(C,B)}parseIdentity(C){const D=this.extractOneOrMore(C,M),U=[];for(;!this.atEnd(C)&&this.peekChar(C)===A;){this.consumeAttributeSpace(C);const ee=this.extract(C,this.consumeToken);this.extract(C,this.consume,"=");const Ee=this.extractOneOrMore(C,Re=>Re!==A&&b(Re));U.push({name:ee,value:Ee})}this.attributes.identities.push({assertionValue:D,extensions:U})}parseMsidSemantic(C){this.peekChar(C)===A&&this.consumeAttributeSpace(C);const D={semantic:this.extract(C,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(C)}catch{break}if(this.peekChar(C)==="*"){this.extract(C,this.consume,"*"),D.applyForAll=!0;break}{const U=this.extract(C,this.consumeTill,A);D.identifierList.push(U)}}this.attributes.msidSemantic=D}}class ne extends G{constructor(C){super(),Q(this,"attributes",void 0),C.protos.indexOf("RTP")!==-1||C.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(C){if(this.digested)throw new Error("already digested");try{switch(C.attField){case"extmap":this.parseExtmap(C);break;case"setup":this.parseSetup(C);break;case"ice-ufrag":this.parseIceUfrag(C);break;case"ice-pwd":this.parseIcePwd(C);break;case"ice-options":this.parseIceOptions(C);break;case"candidate":this.parseCandidate(C);break;case"remote-candidate":this.parseRemoteCandidate(C);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(C);break;case"rtpmap":this.parseRtpmap(C);break;case"ptime":this.parsePtime(C);break;case"maxptime":this.parseMaxPtime(C);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(C);break;case"ssrc":this.parseSSRC(C);break;case"fmtp":this.parseFmtp(C);break;case"rtcp-fb":this.parseRtcpFb(C);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(C);break;case"mid":this.parseMid(C);break;case"msid":this.parseMsid(C);break;case"imageattr":this.parseImageAttr(C);break;case"rid":this.parseRid(C);break;case"simulcast":this.parseSimulcast(C);break;case"sctp-port":this.parseSctpPort(C);break;case"max-message-size":this.parseMaxMessageSize(C);break;case"ssrc-group":this.parseSSRCGroup(C);break;default:C.ignored=!0,this.attributes.unrecognized.push(C)}}catch(D){throw console.error("parsing media attribute ".concat(C.attField,' error, "a=').concat(C.attField,":").concat(C.attValue,'"')),D}if(!C.ignored&&C.attValue&&!this.atEnd(C))throw new Error("attribute parsing error")}parseCandidate(C){const D=this.extractOneOrMore(C,I,[1,32]);this.consumeAttributeSpace(C);const U=this.extractOneOrMore(C,d,[1,5]);this.consumeAttributeSpace(C);const ee=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const Ee=this.extractOneOrMore(C,d,[1,10]);this.consumeAttributeSpace(C);const Re=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const lt=this.extract(C,this.consumePort);this.consumeAttributeSpace(C),this.extract(C,this.consume,"typ"),this.consumeAttributeSpace(C);const St={foundation:D,componentId:U,transport:ee,priority:Ee,connectionAddress:Re,port:lt,type:this.extract(C,this.consumeToken),extension:{}};for(this.peek(C," raddr")&&(this.extract(C,this.consume," raddr"),this.consumeAttributeSpace(C),St.relAddr=this.extract(C,this.consumeAddress)),this.peek(C," rport")&&(this.extract(C,this.consume," rport"),this.consumeAttributeSpace(C),St.relPort=this.extract(C,this.consumePort));this.peekChar(C)===A;){this.consumeAttributeSpace(C);const Tr=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C),St.extension[Tr]=this.extractOneOrMore(C,f)}this.attributes.candidates.push(St)}parseRemoteCandidate(C){const D=[];for(;;){const U=this.extractOneOrMore(C,d,[1,5]);this.consumeAttributeSpace(C);const ee=this.extract(C,this.consumeAddress);this.consumeAttributeSpace(C);const Ee=this.extract(C,this.consumePort);D.push({componentId:U,connectionAddress:ee,port:Ee});try{this.consumeAttributeSpace(C)}catch{break}}this.attributes.remoteCandidatesList.push(D)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(C){const D=this.extract(C,this.consumeToken);this.consumeAttributeSpace(C);const U=this.extract(C,this.consumeTill,"/");this.extract(C,this.consume,"/");const ee={encodingName:U,clockRate:this.extractOneOrMore(C,d)};this.atEnd(C)||this.peekChar(C)!=="/"||(this.extract(C,this.consume,"/"),ee.encodingParameters=parseInt(this.extract(C,this.consumeTill),10));const Ee=this.attributes.payloads.find(Re=>Re.payloadType===parseInt(D,10));Ee?Ee.rtpMap=ee:this.attributes.payloads.push({payloadType:parseInt(D,10),rtpMap:ee,rtcpFeedbacks:[]})}parsePtime(C){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(C,this.consumeTill)}parseMaxPtime(C){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(C,this.consumeTill)}parseDirection(C){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=C.attField}parseSSRC(C){const D=this.extractOneOrMore(C,d);this.consumeAttributeSpace(C);const U=this.extract(C,this.consumeTill,":");let ee;this.peekChar(C)===":"&&(this.extract(C,this.consume,":"),ee=this.extract(C,this.consumeTill));const Ee=this.attributes.ssrcs.find(Re=>Re.ssrcId===parseInt(D,10));Ee?Ee.attributes[U]=ee:this.attributes.ssrcs.push({ssrcId:parseInt(D,10),attributes:{[U]:ee}})}parseFmtp(C){const D=this.extract(C,this.consumeTill,A);this.consumeAttributeSpace(C);const U=this.extract(C,this.consumeTill),ee={};U.split(";").forEach(Re=>{let[lt,St]=Re.split("=");lt=is(lt).call(lt);const Tr=typeof St=="string"?is(St).call(St):null;typeof lt=="string"&&lt.length>0&&(ee[lt]=Tr)});const Ee=this.attributes.payloads.find(Re=>Re.payloadType===parseInt(D,10));Ee?Ee.fmtp={parameters:ee}:this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[],fmtp:{parameters:ee}})}parseFmtParameters(C){const D={},U=this.extract(C,this.consumeTill,"=");C._cur++;const ee=this.extract(C,this.consumeTill,";");for(D[U]=ee;C.attValue[C._cur]===";";){const Ee=this.extract(C,this.consumeTill,"=");C._cur++;const Re=this.extract(C,this.consumeTill,";");D[Ee]=Re}return D}parseRtcpFb(C){let D="";D=this.peekChar(C)==="*"?this.extract(C,this.consume,"*"):this.extract(C,this.consumeTill,A),this.consumeAttributeSpace(C);const U=this.extract(C,this.consumeTill,A);let ee;if(U==="trr-int")ee={type:U,interval:this.extract(C,this.consumeTill)};else{const Ee={type:U};this.peekChar(C)===A&&(this.consumeAttributeSpace(C),Ee.parameter=this.extract(C,this.consumeToken),this.peekChar(C)===A&&(Ee.additional=this.extract(C,this.consumeTill))),ee=Ee}if(D==="*")this.attributes.rtcpFeedbackWildcards.push(ee);else{const Ee=this.attributes.payloads.find(Re=>Re.payloadType===parseInt(D,10));Ee?Ee.rtcpFeedbacks.push(ee):this.attributes.payloads.push({payloadType:parseInt(D,10),rtcpFeedbacks:[ee]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(C){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const D={port:this.extract(C,this.consumePort)};this.peekChar(C)===A&&(this.consumeAttributeSpace(C),D.netType=this.extractOneOrMore(C,g),this.consumeAttributeSpace(C),D.addressType=this.extractOneOrMore(C,g),this.consumeAttributeSpace(C),D.address=this.extract(C,this.consumeAddress)),this.attributes.rtcp=D}parseMsid(C){const D={id:this.extractOneOrMore(C,g,[1,64])};this.peekChar(C)===A&&(this.consumeAttributeSpace(C),D.appdata=this.extractOneOrMore(C,g,[1,64])),this.attributes.msids.push(D)}parseImageAttr(C){this.attributes.imageattr.push(C.attValue)}parseRid(C){const D=this.extractOneOrMore(C,ee=>y(ee)||d(ee)||ee==="_"||ee==="-");this.consumeAttributeSpace(C);const U={id:D,direction:this.extract(C,this.consumeToken),params:[]};if(this.peekChar(C)===A){if(this.consumeAttributeSpace(C),this.peek(C,"pt=")){this.extract(C,this.consume,"pt=");const ee=[];for(;;){const Ee=this.extract(C,this.consumeToken);ee.push(Ee);try{this.extract(C,this.consume,",")}catch{break}}U.payloads=ee,this.peekChar(C)===A&&this.extract(C,this.consume,A)}for(;;){const ee=this.extract(C,this.consumeToken);switch(ee){case"depend":{const Ee={type:ee,rids:this.extract(C,this.consume,"=").split(",")};U.params.push(Ee);break}default:{const Ee={type:ee};this.peekChar(C)==="="&&(this.extract(C,this.consume,"="),Ee.val=this.extract(C,this.consumeTill,";")),U.params.push(Ee)}}try{this.extract(C,this.consume,";")}catch{break}}}this.attributes.rids.push(U)}parseSimulcast(C){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=C.attValue,this.extract(C,this.consumeTill)}parseSctpPort(C){this.attributes.sctpPort=this.extractOneOrMore(C,d,[1,5])}parseMaxMessageSize(C){this.attributes.maxMessageSize=this.extractOneOrMore(C,d,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(C){this.attributes.mid=this.extract(C,this.consumeToken)}parseSSRCGroup(C){const D=this.extract(C,this.consumeToken),U=[];for(;;)try{this.consumeAttributeSpace(C);const ee=this.extract(C,this.consumeInteger);U.push(parseInt(ee,10))}catch{break}this.attributes.ssrcGroups.push({semantic:D,ssrcIds:U})}}function q(P,C,D){return C in P?Object.defineProperty(P,C,{value:D,enumerable:!0,configurable:!0,writable:!0}):P[C]=D,P}class qe{constructor(){q(this,"eol",a)}print(C,D){let U="";return D&&(this.eol=D),U+=this.printVersion(C.version),U+=this.printOrigin(C.origin),U+=this.printSessionName(C.sessionName),U+=this.printInformation(C.information),U+=this.printUri(C.uri),U+=this.printEmail(C.emails),U+=this.printPhone(C.phones),U+=this.printConnection(C.connection),U+=this.printBandwidth(C.bandwidths),U+=this.printTimeFields(C.timeFields),U+=this.printKey(C.key),U+=this.printSessionAttributes(C.attributes),U+=this.printMediaDescription(C.mediaDescriptions),U}printVersion(C){return"v=".concat(C).concat(this.eol)}printOrigin(C){return"o=".concat(C.username," ").concat(C.sessId," ").concat(C.sessVersion," ").concat(C.nettype," ").concat(C.addrtype," ").concat(C.unicastAddress).concat(this.eol)}printSessionName(C){return C?"s=".concat(C).concat(this.eol):""}printInformation(C){return C?"i=".concat(C).concat(this.eol):""}printUri(C){return C?"u=".concat(C).concat(this.eol):""}printEmail(C){let D="";for(const U of C)D+="e=".concat(U).concat(this.eol);return D}printPhone(C){let D="";for(const U of C)D+="e=".concat(U).concat(this.eol);return D}printConnection(C){return C?"c=".concat(C.nettype," ").concat(C.addrtype," ").concat(C.address).concat(this.eol):""}printBandwidth(C){let D="";for(const U of C)D+="b=".concat(U.bwtype,":").concat(U.bandwidth).concat(this.eol);return D}printTimeFields(C){let D="";for(const U of C){D+="t=".concat(U.time.startTime," ").concat(U.time.startTime).concat(this.eol);for(const ee of U.repeats)D+="r=".concat(ee.repeatInterval," ").concat(ee.typedTimes.join(" ")).concat(this.eol);U.zoneAdjustments&&(D+="z=",D+="z=".concat(U.zoneAdjustments.map(ee=>"".concat(ee.time," ").concat(ee.back?"-":""," ").concat(ee.typedTime)).join(" ")).concat(this.eol),D+=this.eol)}return D}printKey(C){return C?"k=".concat(C).concat(this.eol):""}printAttributes(C){let D="";for(const U of C)D+="a=".concat(U.attField).concat(U.attValue?":".concat(U.attValue):"").concat(this.eol);return D}printMediaDescription(C){let D="";for(const U of C)D+=this.printMedia(U.media),D+=this.printInformation(U.information),D+=this.printConnections(U.connections),D+=this.printBandwidth(U.bandwidths),D+=this.printKey(U.key),D+=this.printMediaAttributes(U);return D}printConnections(C){let D="";for(const U of C)D+=this.printConnection(U);return D}printMedia(C){return"m=".concat(C.mediaType," ").concat(C.port," ").concat(C.protos.join("/")," ").concat(C.fmts.join(" ")).concat(this.eol)}printSessionAttributes(C){return new de(this.eol).print(C)}printMediaAttributes(C){return new J(this.eol).print(C)}}class je{constructor(C){q(this,"eol",void 0),this.eol=C}printIceUfrag(C){return C===void 0?"":"a=ice-ufrag:".concat(C).concat(this.eol)}printIcePwd(C){return C===void 0?"":"a=ice-pwd:".concat(C).concat(this.eol)}printIceOptions(C){return C===void 0?"":"a=ice-options:".concat(C.join(A)).concat(this.eol)}printFingerprints(C){return C.length>0?C.map(D=>"a=fingerprint:".concat(D.hashFunction).concat(A).concat(D.fingerprint)).join(this.eol)+this.eol:""}printExtmap(C){return C.map(D=>"a=extmap:".concat(D.entry).concat(D.direction?"/".concat(D.direction):"").concat(A).concat(D.extensionName).concat(D.extensionAttributes?"".concat(A).concat(D.extensionAttributes):"").concat(this.eol)).join("")}printSetup(C){return C===void 0?"":"a=setup:".concat(C).concat(this.eol)}printUnrecognized(C){return C.map(D=>"a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol)).join("")}}class de extends je{print(C){let D="";return D+=this.printGroups(C.groups),D+=this.printMsidSemantic(C.msidSemantic),D+=this.printIceLite(C.iceLite),D+=this.printIceUfrag(C.iceUfrag),D+=this.printIcePwd(C.icePwd),D+=this.printIceOptions(C.iceOptions),D+=this.printFingerprints(C.fingerprints),D+=this.printSetup(C.setup),D+=this.printTlsId(C.tlsId),D+=this.printIdentity(C.identities),D+=this.printExtmap(C.extmaps),D+=this.printUnrecognized(C.unrecognized),D}printGroups(C){let D="";return C.length>0&&(D+=C.map(U=>"a=group:".concat(U.semantic).concat(U.identificationTag.map(ee=>"".concat(A).concat(ee)).join("")).concat(this.eol)).join("")),D}printIceLite(C){return C===void 0?"":"a=ice-lite"+this.eol}printTlsId(C){return C?"a=tls-id:".concat(C).concat(this.eol):""}printIdentity(C){return C.length===0?"":C.map(D=>"a=identity:".concat(D.assertionValue).concat(D.extensions.map(U=>"".concat(A).concat(U.name).concat(U.value?"=".concat(U.value):"")))).join(this.eol)+this.eol}printMsidSemantic(C){if(!C)return"";let D="a=msid-semantic:".concat(C.semantic);return C.applyForAll?D+="".concat(A,"*"):C.identifierList.length>0&&(D+=C.identifierList.map(U=>"".concat(A).concat(U))),D+this.eol}}class J extends je{print(C){const D=C.attributes;let U="";return U+=this.printRTCP(D.rtcp),U+=this.printIceUfrag(D.iceUfrag),U+=this.printIcePwd(D.icePwd),U+=this.printIceOptions(D.iceOptions),U+=this.printCandidates(D.candidates),U+=this.printRemoteCandidatesList(D.remoteCandidatesList),U+=this.printEndOfCandidates(D.endOfCandidates),U+=this.printFingerprints(D.fingerprints),U+=this.printSetup(D.setup),U+=this.printMid(D.mid),U+=this.printExtmap(D.extmaps),U+=this.printRTPRelated(D),U+=this.printPtime(D.ptime),U+=this.printMaxPtime(D.maxPtime),U+=this.printDirection(D.direction),U+=this.printSSRCGroups(D.ssrcGroups),U+=this.printSSRC(D.ssrcs),U+=this.printRTCPMux(D.rtcpMux),U+=this.printRTCPMuxOnly(D.rtcpMuxOnly),U+=this.printRTCPRsize(D.rtcpRsize),U+=this.printMSId(D.msids),U+=this.printImageattr(D.imageattr),U+=this.printRid(D.rids),U+=this.printSimulcast(D.simulcast),U+=this.printSCTPPort(D.sctpPort),U+=this.printMaxMessageSize(D.maxMessageSize),U+=this.printUnrecognized(D.unrecognized),U}printCandidates(C){return C.map(D=>"a=candidate:".concat(D.foundation).concat(A).concat(D.componentId).concat(A).concat(D.transport).concat(A).concat(D.priority).concat(A).concat(D.connectionAddress).concat(A).concat(D.port).concat(A,"typ").concat(A).concat(D.type).concat(D.relAddr?"".concat(A,"raddr").concat(A).concat(D.relAddr):"").concat(D.relPort?"".concat(A,"rport").concat(A).concat(D.relPort):"").concat(Object.keys(D.extension).map(U=>"".concat(A).concat(U).concat(A).concat(D.extension[U])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(C){return C.map(D=>"a=remote-candidates:".concat(D.join(A)).concat(this.eol)).join("")}printEndOfCandidates(C){return C===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(C){if(!C.payloads)return"";const D=C.payloads;let U="";U+=C.rtcpFeedbackWildcards.map(ee=>this.printRTCPFeedback("*",ee)).join("");for(const ee of D)U+=this.printRtpMap(ee.payloadType,ee.rtpMap),U+=this.printFmtp(ee.payloadType,ee.fmtp),U+=ee.rtcpFeedbacks.map(Ee=>this.printRTCPFeedback(ee.payloadType,Ee)).join("");return U}printFmtp(C,D){if(!D)return"";const U=Object.keys(D.parameters);return U.length===1&&D.parameters[U[0]]===null?"a=fmtp:".concat(C).concat(A).concat(U[0]).concat(this.eol):"a=fmtp:".concat(C).concat(A).concat(Object.keys(D.parameters).map(ee=>"".concat(ee,"=").concat(D.parameters[ee])).join(";")).concat(this.eol)}printRtpMap(C,D){return D?"a=rtpmap:".concat(C).concat(A).concat(D.encodingName,"/").concat(D.clockRate).concat(D.encodingParameters?"/".concat(D.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(C,D){let U="a=rtcp-fb:".concat(C).concat(A),ee=D;return ee.type==="trr-int"?U+="ttr-int".concat(A).concat(ee.interval):(U+="".concat(ee.type),ee.parameter&&(U+="".concat(A).concat(ee.parameter),ee.additional&&(U+="".concat(A).concat(ee.additional)))),U+this.eol}printPtime(C){return C===void 0?"":"a=ptime:".concat(C).concat(this.eol)}printMaxPtime(C){return C===void 0?"":"a=maxptime:".concat(C).concat(this.eol)}printDirection(C){return C===void 0?"":"a=".concat(C).concat(this.eol)}printSSRC(C){return C.map(D=>Object.keys(D.attributes).map(U=>"a=ssrc:".concat(D.ssrcId.toString(10)).concat(A).concat(U).concat(D.attributes[U]?":".concat(D.attributes[U]):"").concat(this.eol)).join("")).join("")}printRTCPMux(C){return C===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(C){return C===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(C){return C===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(C){if(C===void 0)return"";let D="a=rtcp:".concat(C.port);return C.netType&&(D+="".concat(A).concat(C.netType)),C.addressType&&(D+="".concat(A).concat(C.addressType)),C.address&&(D+="".concat(A).concat(C.address)),D+this.eol}printMSId(C){return C.map(D=>"a=msid:".concat(D.id).concat(D.appdata?"".concat(A).concat(D.appdata):"").concat(this.eol)).join("")}printImageattr(C){return C.map(D=>"a=imageattr:".concat(D).concat(this.eol)).join("")}printRid(C){return C.map(D=>{let U="a=rid:".concat(D.id).concat(A).concat(D.direction);return D.payloads&&(U+="".concat(A,"pt=").concat(D.payloads.join(","))),D.params.length>0&&(U+="".concat(A).concat(D.params.map(ee=>ee.type==="depend"?"depend=".concat(ee.rids.join(",")):"".concat(ee.type,"=").concat(ee.val)).join(";"))),U+this.eol}).join("")}printSimulcast(C){return C===void 0?"":"a=simulcast:".concat(C).concat(this.eol)}printSCTPPort(C){return C===void 0?"":"a=sctp-port:".concat(C).concat(this.eol)}printMaxMessageSize(C){return C===void 0?"":"a=max-message-size:".concat(C).concat(this.eol)}printMid(C){return C===void 0?"":"a=mid:".concat(C).concat(this.eol)}printSSRCGroups(C){return C.map(D=>"a=ssrc-group:".concat(D.semantic).concat(D.ssrcIds.map(U=>"".concat(A).concat(U.toString(10))).join("")).concat(this.eol)).join("")}}function Y(P){return new k().parse(P)}function Z(P,C){return new qe().print(P,C)}}},e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var s in i)n.o(i,s)&&!n.o(r,s)&&Object.defineProperty(r,s,{enumerable:!0,get:i[s]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();var Jr=gZ.exports;function cU(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:j("SVC_MODE");if(j("ENABLE_SVC"))return function(e){return e in JL}(t)?t:JL.L1T3}function iG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function sG(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?iG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):iG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Rv(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:a,filterVideoCodec:A}=e,{useXR:u}=n;let d=[],f=[],m=[],g=[],v=!1,y=!1;if(Jr.parse(t).mediaDescriptions.forEach(b=>{r&&r!==b.attributes.direction||(b.media.mediaType!=="video"||v||(f=b.attributes.payloads,g=b.attributes.extmaps,v=!0),b.media.mediaType!=="audio"||y||(d=b.attributes.payloads,m=b.attributes.extmaps,y=!0))}),!g||f.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!m||d.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(f.forEach(b=>{var I;(I=b.rtpMap)!==null&&I!==void 0&&I.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),u&&b.rtcpFeedbacks.push({type:"rrtr"})}),d.forEach(b=>{var I;(I=b.rtpMap)!==null&&I!==void 0&&I.clockRate&&(b.rtpMap.clockRate=parseInt(b.rtpMap.clockRate)),u&&b.rtcpFeedbacks.push({type:"rrtr"})}),i&&(d=d.filter(b=>{var I;return((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())!=="rtx"}),f=f.filter(b=>{var I;return((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())!=="rtx"})),s&&(f=f.filter(b=>{var I;return!/(red)|(ulpfec)|(flexfec)/i.test(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName)||"")})),o&&(d=d.filter(b=>{var I;return!/(red)|(ulpfec)|(flexfec)/i.test(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName)||"")})),a&&(a==null?void 0:a.length)>0&&(d=d.filter(b=>{var I;return Te(a).call(a,((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLowerCase())||"")})),A&&(A==null?void 0:A.length)>0){const b=f.filter(I=>{var B;return Te(A).call(A,((B=I.rtpMap)===null||B===void 0?void 0:B.encodingName.toLowerCase())||"")});f=b.concat(i?[]:Mk(b,f))}const w=j("UNSUPPORTED_VIDEO_CODEC");return w&&w.length>0&&(f=f.filter(b=>!(b.rtpMap&&Te(w).call(w,b.rtpMap.encodingName.toLowerCase())))),{audioCodecs:d,videoCodecs:f,audioExtensions:m,videoExtensions:g}}function od(t){const e=Jr.parse(t);let n,r;for(const i of e.mediaDescriptions){if(!n){const s=i.attributes.iceUfrag,o=i.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:s,icePwd:o}}if(!r){const s=i.attributes.fingerprints;s.length>0&&(r={fingerprints:s})}}if(!r&&e.attributes.fingerprints.length>0&&(r={fingerprints:e.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function _Z(t,e){const n=[],r=t.attributes.ssrcGroups.filter(o=>o.semantic==="FID"),i=t.attributes.ssrcGroups.find(o=>o.semantic==="SIM"),s=t.attributes.ssrcs;if(i)i.ssrcIds.forEach(o=>{var a;const A=(a=r.find(u=>u.ssrcIds[0]===o))===null||a===void 0?void 0:a.ssrcIds[1];n.push({ssrcId:o,rtx:e?A:void 0})});else if(r.length>0){const o=r[0].ssrcIds[0],a=r[0].ssrcIds[1];n.push({ssrcId:o,rtx:e?a:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function oG(t,e,n){const{cname:r}=t;let i;e?i=EZ(e):(i=t.iceParameters.candidates.map(d=>({foundation:d.foundation,componentId:"1",transport:d.protocol,priority:d.priority.toString(),connectionAddress:d.ip,port:d.port.toString(),type:d.type,extension:{}})),S.debug("Using candidates from gateway."));const s={fingerprints:t.dtlsParameters.fingerprints.map(d=>({hashFunction:d.algorithm,fingerprint:d.fingerprint}))},o={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let a;switch(t.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}const A=fS(t.rtpCapabilities),u=[];return Array.isArray(n)&&n.length>0&&n.forEach(d=>{u.push({kind:Ue.VIDEO,ssrcId:d.v,rtx:d.v_rtx,mslabel:"".concat(d.v,"_").concat(d.a)},{kind:Ue.AUDIO,ssrcId:d.a,mslabel:"".concat(d.v,"_").concat(d.a)})}),{dtlsParameters:s,iceParameters:o,candidates:i,rtpCapabilities:A,setup:a,cname:r,preSSRCs:u}}function EZ(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],S.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),S.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function Lh(t,e,n){const r=[],i=[];return t.forEach(s=>{let{ssrcId:o,rtx:a}=s;const A=tn(8,"track-"),u={ssrcId:o,attributes:sG({label:A,mslabel:n=n||tn(10,""),msid:"".concat(n," ").concat(A)},e&&{cname:e})};if(r.push(u),a!==void 0){const d={ssrcId:a,attributes:sG({label:A,mslabel:n,msid:"".concat(n," ").concat(A)},e&&{cname:e})};r.push(d),i.push({semantic:"FID",ssrcIds:[o,a]})}}),t.length>1&&i.push({semantic:"SIM",ssrcIds:t.map(s=>{let{ssrcId:o}=s;return o})}),{ssrcs:r,ssrcGroups:i}}function Zm(t,e){e instanceof xn&&t.attributes.payloads.forEach(n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const s=e._encoderConfig;s&&i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!Vn()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function kk(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function xk(t,e){var n;if(!(e instanceof dn&&e._encoderConfig&&e._hints.indexOf(gn.SCREEN_TRACK)===-1))return;const r=e._encoderConfig;Ct().supportMinBitrate&&r.bitrateMin&&t.attributes.payloads.forEach(i=>{var s,o;Te(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),Ct().supportMinBitrate&&!Te(n=e._hints).call(n,gn.LOW_STREAM)&&r.bitrateMax&&t.attributes.payloads.forEach(i=>{var s,o;Te(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(j("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function vZ(t){if(t.media.mediaType!=="video")return;const e=yt();if(e.name!==Ut.SAFARI&&e.os!==kr.IOS)return;const n=t.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function hS(t,e,n){if(!e)return;let r,i;if(t.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),e.twcc===!0){const s=r.find(o=>o.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s&&(t.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||t.attributes.extmaps.push({entry:s.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(a,A){return A.filter(u=>!!a.find(d=>d.payloadType===u.payloadType&&!!d.rtcpFeedbacks.find(f=>f.type==="transport-cc")))}(i,t.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(A=>A.type==="transport-cc")||a.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(e.twcc===!1){const s=t.attributes.extmaps.findIndex(o=>o.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(o=>{const a=o.rtcpFeedbacks.findIndex(A=>A.type==="transport-cc");a!==-1&&o.rtcpFeedbacks.splice(a,1)})}if(e.remb===!0){const s=r.find(o=>o.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");s&&(t.attributes.extmaps.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||t.attributes.extmaps.push({entry:s.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(a,A){return A.filter(u=>!!a.find(d=>d.payloadType===u.payloadType&&!!d.rtcpFeedbacks.find(f=>f.type==="goog-remb")))}(i,t.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(A=>A.type==="goog-remb")||a.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(e.remb===!1){const s=t.attributes.extmaps.findIndex(o=>o.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");s!==-1&&t.attributes.extmaps.splice(s,1),t.attributes.payloads.forEach(o=>{const a=o.rtcpFeedbacks.findIndex(A=>A.type==="goog-remb");a!==-1&&o.rtcpFeedbacks.splice(a,1)})}}function yZ(t,e,n){if(Vn()||t.media.mediaType!=="video"||!(e instanceof dn)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!j("SIMULCAST")||n==="vp9"&&j("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,i=t.attributes.ssrcs[0],s=t.attributes.ssrcGroups.find(a=>a.semantic==="FID"&&a.ssrcIds[0]===i.ssrcId),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let a=1;a<r;a++)t.attributes.ssrcs.push({ssrcId:i.ssrcId+a,attributes:sr(i.attributes)}),o.ssrcIds.push(i.ssrcId+a),s&&(t.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+a,attributes:sr(i.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+a,s.ssrcIds[1]+a]}));t.attributes.ssrcGroups.unshift(o)}async function wZ(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:s,sendrecv:o}=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;const d=Rv(u,a,A,"sendonly"),f=Rv(u,a,A,"recvonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oc(d,f,"videoExtensions",m,g,v),oc(d,f,"videoCodecs",m,g,v),oc(d,f,"audioExtensions",m,g,v),oc(d,f,"audioCodecs",m,g,v),j("RAISE_H264_BASELINE_PRIORITY")){const y=v.videoCodecs.findIndex(w=>{var b,I;return((b=w.rtpMap)===null||b===void 0?void 0:b.encodingName.toLocaleLowerCase())==="h264"&&((I=w.fmtp)===null||I===void 0?void 0:I.parameters["profile-level-id"])==="42001f"});if(y!==-1){const w=v.videoCodecs.findIndex(b=>{var I;return((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"});if(w<y){S.debug("raising H264 baseline profile priority");const b=v.videoCodecs[y];v.videoCodecs.splice(y,1),v.videoCodecs.splice(w,0,b)}w!==-1&&(g.videoCodecs=g.videoCodecs.filter(b=>{var I,B;return!(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"&&((B=b.fmtp)===null||B===void 0?void 0:B.parameters["profile-level-id"])!=="42001f")})),w!==-1&&j("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(b=>{var I,B;return!(((I=b.rtpMap)===null||I===void 0?void 0:I.encodingName.toLocaleLowerCase())==="h264"&&((B=b.fmtp)===null||B===void 0?void 0:B.parameters["profile-level-id"])!=="42001f")}))}}return{send:m,recv:g,sendrecv:v}}(t,e,r);try{n.close()}catch{}return{send:i,recv:s,sendrecv:o}}function aG(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=Rv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oc(t,e,"videoExtensions",n,r,i),oc(t,e,"videoCodecs",n,r,i),oc(t,e,"audioExtensions",n,r,i),oc(t,e,"audioCodecs",n,r,i),j("RAISE_H264_BASELINE_PRIORITY")){const s=i.videoCodecs.findIndex(o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){const o=i.videoCodecs.findIndex(a=>a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(o<s){S.debug("raising H264 baseline profile priority");const a=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(o,0,a)}o!==-1&&(r.videoCodecs=r.videoCodecs.filter(a=>!(a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a.fmtp&&a.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function oc(t,e,n,r,i,s){if(n==="videoExtensions"||n==="audioExtensions"){const o=[];return t[n].forEach(a=>{e[n].some((A,u)=>{if(a.entry===A.entry&&a.extensionName===A.extensionName)return o.push(u),!0})?s[n].push(a):r[n].push(a)}),void e[n].forEach((a,A)=>{o.indexOf(A)===-1&&i[n].push(a)})}if(n==="videoCodecs"||n==="audioCodecs"){const o=[];return t[n].forEach(a=>{e[n].some((A,u)=>{if(a.payloadType===A.payloadType&&JSON.stringify(a)===JSON.stringify(A))return o.push(u),!0})?s[n].push(a):r[n].push(a)}),void e[n].forEach((a,A)=>{o.indexOf(A)===-1&&i[n].push(a)})}}function fS(t){const{send:e,recv:n,sendrecv:r}=t;if(!r){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let i,s;return e?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...e.audioCodecs,...r.audioCodecs],i.videoCodecs=[...e.videoCodecs,...r.videoCodecs],i.audioExtensions=[...e.audioExtensions,...r.audioExtensions],i.videoExtensions=[...e.videoExtensions,...r.videoExtensions]):i=r,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...r.audioCodecs],s.videoCodecs=[...n.videoCodecs,...r.videoCodecs],s.audioExtensions=[...n.audioExtensions,...r.audioExtensions],s.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):s=r,{send:i,recv:s}}function eg(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function VE(t,e,n,r){let i=[];if(t===Ue.VIDEO){if(j("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=e.videoCodecs.filter(s=>{var o;return Te(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,r)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===j("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let s=[];const o=[],a=[],A=[];if(n.videoCodecs.forEach(u=>{const d=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"";Te(d).call(d,r)?s.push(u):Te(d).call(d,"vp9")?o.push(u):Te(d).call(d,"vp8")?a.push(u):Te(d).call(d,"h264")&&A.push(u)}),s.length===0){let u="";o.length!==0?(s=o,u="vp9"):a.length!==0?(s=a,u="vp8"):A.length!==0&&(s=A,u="h264"),S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(u))}s.length!==0&&(i=e.videoCodecs.filter(u=>s.some(d=>d.payloadType===u.payloadType)))}if(i.length===0&&(S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),i=e.videoCodecs),j("USE_PUB_RTX")||j("USE_SUB_RTX")){const s=Mk(i,e.videoCodecs);i=[...i,...s]}}else i=e.audioCodecs.filter(s=>{var o;return Te(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,r)}),i.length===0&&(S.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=e.audioCodecs.filter(s=>{var o;return Te(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,"opus")}));return i}function Mk(t,e){const n=t.map(r=>r.payloadType.toString());return e.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&Te(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}async function UC(t,e,n){const r=e.toString(),i=TZ(r,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:r});const s=await t.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=CZ(o,n||{}),i==null||i(o||""),await t.setLocalDescription({type:"answer",sdp:o})}function CZ(t,e,n){const r=Jr.parse(t),{useXR:i}=e;return r.mediaDescriptions.forEach(s=>{var o;s.attributes.mid&&(Array.isArray(n)&&!Te(n).call(n,s.attributes.mid)||(s.media.mediaType==="audio"&&eg(s),i&&Te(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach(a=>{a.rtcpFeedbacks.findIndex(A=>A.type==="rrtr")===-1&&a.rtcpFeedbacks.push({type:"rrtr"})})))}),Jr.print(r)}function TZ(t,e,n,r){if(j("SDP_LOGGING"))return S.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(r,`
`),t),e==="offer"?i=>{TZ(i,"answer",n==="local"?"remote":"local",r)}:void 0}function _A(t,e){return typeof j(t)===e?j(t):void 0}function cG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Lu(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?cG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):cG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const mD=new Map;class pDe extends Ln{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(ai.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(ai.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){S.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){super(),N(this,"store",void 0),N(this,"joinInfo",void 0),N(this,"key",void 0),N(this,"ntpOffset",0),N(this,"signal",void 0),N(this,"role",void 0),N(this,"inChannelInfo",{joinAt:null,duration:0}),N(this,"spec",void 0),N(this,"_state","DISCONNECTED"),N(this,"_statsCollector",void 0),N(this,"_disconnectedReason",void 0),N(this,"isSignalRecover",!1),N(this,"hasChangeBGPAddress",!1),N(this,"trafficStatsInterval",void 0),N(this,"networkQualityInterval",void 0),N(this,"_joinGatewayStartTime",0),N(this,"_signalTimeout",!1),N(this,"_clientRoleOptions",void 0),N(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?new rG(Lu(Lu({},n),{},{retryConfig:n.websocketRetryConfig}),e):new FOe(Lu(Lu({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,r){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let s=mD.get(e.cname);if(s||(s=new Map,mD.set(e.cname,s)),this._isProactiveJoin=!0,s.has(e.uid)){const u=new te(L.UID_CONFLICT);throw Le.joinGateway(e.sid,{lts:i,succ:!1,ec:u.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,u}s.set(e.uid,!0),this.joinInfo=e,this.key=n;let o=0;this.joinGatewayStartTime=i;const a=e.proxyServer;try{S.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));const u=e.gatewayAddrs.map(d=>{let{address:f}=d;const[m,g]=f.split(":"),v={host:m,port:g};return e.proxyServer&&(v.proxy=e.proxyServer),v});o=(await this.signal.init(u,r)).uid,S.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u){var A;throw S.error("[".concat(this.store.clientId,"] User join failed"),u.toString()),Le.joinGateway(e.sid,{lts:i,succ:!1,ec:((A=u.data)===null||A===void 0?void 0:A.desc)||u.code,errorMsg:u.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,s.delete(e.uid),this.signal.close(),u}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),S.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u=>{S.warning("[".concat(this.store.clientId,"] get traffic stats error"),u.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(ai.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(ai.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(ai.NETWORK_QUALITY,{uplinkNetworkQuality:Z3(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:Z3(this._statsCollector.trafficStats.B_dnq)}):this.emit(ai.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Mt.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==en.CONNECTED||await function(r,i){return i===1/0?r:ye.race([r,kRe(i)])}(this.signal.request(We.LEAVE,void 0,!0),3e3)}catch(r){S.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==Mt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:j("PUB_EXTEND"),twcc:!!j("PUBLISH_TWCC"),rtx:!!j("USE_PUB_RTX")};try{return(await this.signal.request(We.PUBLISH,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===xe.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw s}}async publishDataChannel(e,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(We.PUBLISH_DATASTREAM,s,!0)}catch(o){if(r&&o.data&&o.data.code===xe.ERR_PUBLISH_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw o}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(We.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(r){S.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ye.all(e.map(n=>this.signal.request(We.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){S.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX")||void 0,extend:j("SUB_EXTEND"),svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return await this.signal.request(We.PRE_SUBSCRIBE,i,!0)}catch(s){if(r&&s.data&&s.data.code===xe.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(e,n,!1);throw s}}async subscribe(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!j("SUBSCRIBE_TWCC"),rtx:!!j("USE_SUB_RTX"),extend:j("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return(await this.signal.request(We.SUBSCRIBE,i,!0))._message}catch(s){if(r&&s.data&&s.data.code===xe.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw s}}async subscribeDataChannel(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(We.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(r&&s.data&&s.data.code===xe.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw s}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!j("USE_SUB_RTX"),twcc:!!j("SUBSCRIBE_TWCC"),svc:Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0};try{return await this.signal.request(We.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===xe.ERR_SUBSCRIBE_REQUEST_INVALID)return S.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw i}}async setVideoProfile(e){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,s=r.width,o=r.height,a=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(a=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(a=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,i||(a=!1)),a?{stream_type:0,width:s,height:o,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(e);if(n)return this.signal.request(We.SET_VIDEO_PROFILE,n);S.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(We.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(r){S.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ye.all(e.map(r=>this.signal.request(We.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){S.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(e){try{await this.signal.request(We.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){S.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=e;return{gatewayEstablishParams:await this.signal.request(We.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(We.GATEWAY_INFO)}async renewToken(e){await this.signal.request(We.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=e);let r,i=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request(We.SET_CLIENT_ROLE,{role:e,level:i,delay:r,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(We.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(We.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(We.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(We.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(We.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,r){if(this.signal instanceof rG)return this.signal.sendExtensionMessage(e,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Lu({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(We.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=mD.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:ci.username,password:ci.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Lu(Lu({},ci),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(We.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&Pb(()=>{this.emit(ai.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new te(L.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let r=j("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);const i=!(Vn()||m$(87)||SK())&&typeof j("ENABLE_PRE_SUB")=="boolean"&&j("ENABLE_PRE_SUB"),s=!SK()&&_A("ENABLE_PREALLOC_PC","boolean"),o=Lu({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ya,browser:navigator.userAgent,process_id:j("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:j("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:{enablePublishedUserList:j("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:j("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof j("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?j("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof j("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?j("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof j("ENABLE_USER_LICENSE_CHECK")=="boolean"?j("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:j("USE_PUB_RTX")===!0||j("USE_SUB_RTX")===!0||void 0,disableFEC:j("DISABLE_FEC"),enableNTPReport:!!j("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!j("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!j("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:_A("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!j("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!j("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:_A("USE_XR","boolean"),enableLossbasedBwe:_A("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!j("ENABLE_AUT_CC")||void 0,enableCCFallback:_A("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:s,preSubNum:i?_A("PRE_SUB_NUM","number"):void 0,enablePubTWCC:_A("PUBLISH_TWCC","boolean"),enableSubTWCC:_A("SUBSCRIBE_TWCC","boolean"),enablePubRTX:_A("USE_PUB_RTX","boolean"),enableSubRTX:_A("USE_SUB_RTX","boolean"),enableSubSVC:j("ENABLE_SVC")?j("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(j("SVC"))&&j("SVC").length!==0?j("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,j("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new te(L.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(ze.WS_RECONNECT_WAITTING_FINISH,e=>{var n;Te(n=["tryNext","recover"]).call(n,e)&&this.joinInfo&&Le.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(ze.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(ze.WS_RECONNECTING,e=>{this.joinInfo&&Le.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||li.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Le.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(ze.WS_CLOSED,e=>{let n;switch(e){case Mt.LEAVE:n=li.LEAVE;break;case Mt.UID_BANNED:case Mt.IP_BANNED:case Mt.CHANNEL_BANNED:case Mt.SERVER_ERROR:n=li.SERVER_ERROR;break;case Mt.FALLBACK:n=li.FALLBACK;break;case Mt.LICENSE_MISSING:case Mt.LICENSE_EXPIRED:case Mt.LICENSE_MINUTES_EXCEEDED:case Mt.LICENSE_PERIOD_INVALID:case Mt.LICENSE_MULTIPLE_SDK_SERVICE:case Mt.LICENSE_ILLEGAL:case Mt.TOKEN_EXPIRE:n=e;break;default:n=li.NETWORK_ERROR}S.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+li.NETWORK_ERROR)),this.joinInfo&&Le.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Mt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==Mt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(ze.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(S.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),Le.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void S.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));Ht("EVENT_REPORT_DOMAIN",e[1]),Ht("EVENT_REPORT_BACKUP_DOMAIN",e[1]),Ht("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(ft.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(ze.REQUEST_RECOVER,(e,n,r)=>{if(!this.joinInfo)return r(new te(L.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,fi(this,ai.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(ze.REQUEST_JOIN_INFO,async e=>{var n;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:r,dtlsParameters:i,rtpCapabilities:s}=await fi(this,ai.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});e(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:s,version:"2"}}))}),this.signal.on(ze.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(ze.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let r,i="";var s;e instanceof te?(r=((s=e.data)===null||s===void 0?void 0:s.desc)||e.code,i=e.message):r=e,Le.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(ze.IS_P2P_DISCONNECTED,e=>{e(Cv(this,ai.IS_P2P_DISCONNECTED))}),this.signal.on(ze.DISCONNECT_P2P,()=>{this.emit(ai.DISCONNECT_P2P)}),this.signal.on(ze.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(ze.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(ze.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(ai.JOIN_RESPONSE,e,n)}),this.signal.on(ze.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=j("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const r=EZ(e);this.emit(ai.PRE_CONNECT_PC,{candidates:r,fingerprint:n})}}})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(We.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(We.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw S.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(We.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(We.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw S.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(e){const n={users:e.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(We.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(e,n){const r={action:e.find(i=>i.stream_type===Lt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(We.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(e,n){const r={action:e.find(i=>i.stream_type===Lt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(We.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(e,n){const r={action:e===Ue.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(We.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(e,n){const r={action:e===Ue.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(We.CONTROL,r,!0,!0)}catch(i){throw S.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(We.RESTART_ICE,n,!0)}catch(r){throw S.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,li.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!j("GATEWAY_WSS_ADDRESS"))return j("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(S.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(We.SET_PARAMETER,{enablePublishAudioFilter:e})}}let PC=0,gD=0;function $c(t,e,n,r){return new ye((i,s)=>{e.timeout=e.timeout||j("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),PC+=DA(e.data)):n&&(e.data.size?PC+=e.data.size:e.data instanceof FormData?PC+=I$(e.data):PC+=DA(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,js.request(e).then(o=>{typeof o.data=="string"?gD+=DA(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?gD+=o.data.byteLength:gD+=DA(JSON.stringify(o.data)),r&&i({data:o.data,headers:o.headers}),i(o.data)}).catch(o=>{js.isCancel(o)?s(new te(L.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new te(L.NETWORK_TIMEOUT,o.message)):o.response?s(new te(L.NETWORK_RESPONSE_ERROR,o.response.status)):s(new te(L.NETWORK_ERROR,o.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(J){var Y=0;return function(){return Y<J.length?{done:!1,value:J[Y++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(J,Y,Z){return J==Array.prototype||J==Object.prototype||(J[Y]=Z.value),J},r,i=function(J){J=[typeof globalThis=="object"&&globalThis,J,typeof window=="object"&&window,typeof self=="object"&&self,typeof gm=="object"&&gm];for(var Y=0;Y<J.length;++Y){var Z=J[Y];if(Z&&Z.Math==Math)return Z}throw Error("Cannot find global object")}(this);function s(J,Y){if(Y)e:{var Z=i;J=J.split(".");for(var P=0;P<J.length-1;P++){var C=J[P];if(!(C in Z))break e;Z=Z[C]}(Y=Y(P=Z[J=J[J.length-1]]))!=P&&Y!=null&&n(Z,J,{configurable:!0,writable:!0,value:Y})}}function o(J){return(J={next:J})[Symbol.iterator]=function(){return this},J}function a(J){var Y=typeof Symbol<"u"&&Symbol.iterator&&J[Symbol.iterator];return Y?Y.call(J):{next:e(J)}}if(s("Symbol",function(J){function Y(C,D){this.A=C,n(this,"description",{configurable:!0,writable:!0,value:D})}if(J)return J;Y.prototype.toString=function(){return this.A};var Z="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",P=0;return function C(D){if(this instanceof C)throw new TypeError("Symbol is not a constructor");return new Y(Z+(D||"")+"_"+P++,D)}}),s("Symbol.iterator",function(J){if(J)return J;J=Symbol("Symbol.iterator");for(var Y="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),Z=0;Z<Y.length;Z++){var P=i[Y[Z]];typeof P=="function"&&typeof P.prototype[J]!="function"&&n(P.prototype,J,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return J}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var A;e:{var u={};try{u.__proto__={a:!0},A=u.a;break e}catch{}A=!1}r=A?function(J,Y){if(J.__proto__=Y,J.__proto__!==Y)throw new TypeError(J+" is not extensible");return J}:null}var d=r;function f(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function m(J){if(J.m)throw new TypeError("Generator is already running");J.m=!0}function g(J,Y){return J.h=3,{value:Y}}function v(J){this.g=new f,this.G=J}function y(J,Y,Z,P){try{var C=Y.call(J.g.j,Z);if(!(C instanceof Object))throw new TypeError("Iterator result "+C+" is not an object");if(!C.done)return J.g.m=!1,C;var D=C.value}catch(U){return J.g.j=null,J.g.s(U),w(J)}return J.g.j=null,P.call(J.g,D),w(J)}function w(J){for(;J.g.h;)try{var Y=J.G(J.g);if(Y)return J.g.m=!1,{value:Y.value,done:!1}}catch(Z){J.g.v=void 0,J.g.s(Z)}if(J.g.m=!1,J.g.l){if(Y=J.g.l,J.g.l=null,Y.F)throw Y.D;return{value:Y.return,done:!0}}return{value:void 0,done:!0}}function b(J){this.next=function(Y){return J.o(Y)},this.throw=function(Y){return J.s(Y)},this.return=function(Y){return function(Z,P){m(Z.g);var C=Z.g.j;return C?y(Z,"return"in C?C.return:function(D){return{value:D,done:!0}},P,Z.g.return):(Z.g.return(P),w(Z))}(J,Y)},this[Symbol.iterator]=function(){return this}}function I(J,Y){return Y=new b(new v(Y)),d&&J.prototype&&d(Y,J.prototype),Y}if(f.prototype.o=function(J){this.v=J},f.prototype.s=function(J){this.l={D:J,F:!0},this.h=this.C||this.u},f.prototype.return=function(J){this.l={return:J},this.h=this.u},v.prototype.o=function(J){return m(this.g),this.g.j?y(this,this.g.j.next,J,this.g.o):(this.g.o(J),w(this))},v.prototype.s=function(J){return m(this.g),this.g.j?y(this,this.g.j.throw,J,this.g.o):(this.g.s(J),w(this))},s("Array.prototype.entries",function(J){return J||function(){return function(Y,Z){Y instanceof String&&(Y+="");var P=0,C=!1,D={next:function(){if(!C&&P<Y.length){var U=P++;return{value:Z(U,Y[U]),done:!1}}return C=!0,{done:!0,value:void 0}}};return D[Symbol.iterator]=function(){return D},D}(this,function(Y,Z){return[Y,Z]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var B=function(J,Y){for(var Z=0;Z<J.length;Z++)Y(J[Z])},M=function(J){return J.replace(/\r?\n|\r/g,`\r
`)},H=function(J,Y,Z){return Y instanceof Blob?(Z=Z!==void 0?Z+"":typeof Y.name=="string"?Y.name:"blob",Y.name===Z&&Object.prototype.toString.call(Y)!=="[object Blob]"||(Y=new File([Y],Z)),[String(J),Y]):[String(J),String(Y)]},K=function(J,Y){if(J.length<Y)throw new TypeError(Y+" argument required, but only "+J.length+" present.")},Q=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,F=Q.FormData,k=Q.XMLHttpRequest&&Q.XMLHttpRequest.prototype.send,G=Q.Request&&Q.fetch,$=Q.navigator&&Q.navigator.sendBeacon,ne=Q.Element&&Q.Element.prototype,q=Q.Symbol&&Symbol.toStringTag;q&&(Blob.prototype[q]||(Blob.prototype[q]="Blob"),"File"in Q&&!File.prototype[q]&&(File.prototype[q]="File"));try{new File([],"")}catch{Q.File=function(Y,Z,P){return Y=new Blob(Y,P||{}),Object.defineProperties(Y,{name:{value:Z},lastModified:{value:+(P&&P.lastModified!==void 0?new Date(P.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),q&&Object.defineProperty(Y,q,{value:"File"}),Y}}var qe=function(J){return J.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},je=function(J){this.i=[];var Y=this;J&&B(J.elements,function(Z){if(Z.name&&!Z.disabled&&Z.type!=="submit"&&Z.type!=="button"&&!Z.matches("form fieldset[disabled] *"))if(Z.type==="file"){var P=Z.files&&Z.files.length?Z.files:[new File([],"",{type:"application/octet-stream"})];B(P,function(C){Y.append(Z.name,C)})}else Z.type==="select-multiple"||Z.type==="select-one"?B(Z.options,function(C){!C.disabled&&C.selected&&Y.append(Z.name,C.value)}):Z.type==="checkbox"||Z.type==="radio"?Z.checked&&Y.append(Z.name,Z.value):(P=Z.type==="textarea"?M(Z.value):Z.value,Y.append(Z.name,P))})};if((t=je.prototype).append=function(J,Y,Z){K(arguments,2),this.i.push(H(J,Y,Z))},t.delete=function(J){K(arguments,1);var Y=[];J=String(J),B(this.i,function(Z){Z[0]!==J&&Y.push(Z)}),this.i=Y},t.entries=function J(){var Y,Z=this;return I(J,function(P){if(P.h==1&&(Y=0),P.h!=3)return Y<Z.i.length?P=g(P,Z.i[Y]):(P.h=0,P=void 0),P;Y++,P.h=2})},t.forEach=function(J,Y){K(arguments,1);for(var Z=a(this),P=Z.next();!P.done;P=Z.next()){var C=a(P.value);P=C.next().value,C=C.next().value,J.call(Y,C,P,this)}},t.get=function(J){K(arguments,1);var Y=this.i;J=String(J);for(var Z=0;Z<Y.length;Z++)if(Y[Z][0]===J)return Y[Z][1];return null},t.getAll=function(J){K(arguments,1);var Y=[];return J=String(J),B(this.i,function(Z){Z[0]===J&&Y.push(Z[1])}),Y},t.has=function(J){K(arguments,1),J=String(J);for(var Y=0;Y<this.i.length;Y++)if(this.i[Y][0]===J)return!0;return!1},t.keys=function J(){var Y,Z,P,C,D=this;return I(J,function(U){if(U.h==1&&(Y=a(D),Z=Y.next()),U.h!=3)return Z.done?void(U.h=0):(P=Z.value,C=a(P),g(U,C.next().value));Z=Y.next(),U.h=2})},t.set=function(J,Y,Z){K(arguments,2),J=String(J);var P=[],C=H(J,Y,Z),D=!0;B(this.i,function(U){U[0]===J?D&&(D=!P.push(C)):P.push(U)}),D&&P.push(C),this.i=P},t.values=function J(){var Y,Z,P,C,D=this;return I(J,function(U){if(U.h==1&&(Y=a(D),Z=Y.next()),U.h!=3)return Z.done?void(U.h=0):(P=Z.value,(C=a(P)).next(),g(U,C.next().value));Z=Y.next(),U.h=2})},je.prototype._asNative=function(){for(var J=new F,Y=a(this),Z=Y.next();!Z.done;Z=Y.next()){var P=a(Z.value);Z=P.next().value,P=P.next().value,J.append(Z,P)}return J},je.prototype._blob=function(){var J="----formdata-polyfill-"+Math.random(),Y=[],Z="--"+J+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(P,C){return typeof P=="string"?Y.push(Z+qe(M(C))+`"\r
\r
`+M(P)+`\r
`):Y.push(Z+qe(M(C))+'"; filename="'+qe(P.name)+`"\r
Content-Type: `+(P.type||"application/octet-stream")+`\r
\r
`,P,`\r
`)}),Y.push("--"+J+"--"),new Blob(Y,{type:"multipart/form-data; boundary="+J})},je.prototype[Symbol.iterator]=function(){return this.entries()},je.prototype.toString=function(){return"[object FormData]"},ne&&!ne.matches&&(ne.matches=ne.matchesSelector||ne.mozMatchesSelector||ne.msMatchesSelector||ne.oMatchesSelector||ne.webkitMatchesSelector||function(J){for(var Y=(J=(this.document||this.ownerDocument).querySelectorAll(J)).length;0<=--Y&&J.item(Y)!==this;);return-1<Y}),q&&(je.prototype[q]="FormData"),k){var de=Q.XMLHttpRequest.prototype.setRequestHeader;Q.XMLHttpRequest.prototype.setRequestHeader=function(J,Y){de.call(this,J,Y),J.toLowerCase()==="content-type"&&(this.B=!0)},Q.XMLHttpRequest.prototype.send=function(J){J instanceof je?(J=J._blob(),this.B||this.setRequestHeader("Content-Type",J.type),k.call(this,J)):k.call(this,J)}}G&&(Q.fetch=function(J,Y){return Y&&Y.body&&Y.body instanceof je&&(Y.body=Y.body._blob()),G.call(this,J,Y)}),$&&(Q.navigator.sendBeacon=function(J,Y){return Y instanceof je&&(Y=Y._asNative()),$.call(this,J,Y)}),Q.FormData=je}})();const Ov=()=>{const t=j("AREAS");return t.length===0&&t.push(Ot.GLOBAL),qc(t).call(t,(e,n,r)=>{const i=SZ(n);return i?r===0?i:"".concat(e,",").concat(i):e},"")},SZ=t=>t===Ot.OVERSEA?"".concat(Di.ASIA,",").concat(Di.EUROPE,",").concat(Di.AFRICA,",").concat(Di.NORTH_AMERICA,",").concat(Di.SOUTH_AMERICA,",").concat(Di.OCEANIA):Di[t],mDe=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const r=Vb[n],i=Object.keys(r);i&&i.map(s=>{s!=="CODE"&&(e[s]=e[s].concat(r[s]))})}),e},$T={GLOBAL:{ASIA:[Ot.CHINA,Ot.JAPAN,Ot.INDIA,Ot.KOREA,Ot.HKMC],EUROPE:[],NORTH_AMERICA:[Ot.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},kC=Object.keys($T[Ot.GLOBAL]),_D=[Ot.CHINA,Ot.NORTH_AMERICA,Ot.EUROPE,Ot.ASIA,Ot.JAPAN,Ot.INDIA,Ot.OCEANIA,Ot.SOUTH_AMERICA,Ot.AFRICA,Ot.KOREA,Ot.HKMC,Ot.US],gDe=function(t,e){let n=[];if(Te(t).call(t,Ot.GLOBAL)){const s=[Ot.GLOBAL,Ot.OVERSEA],o=Object.keys(Vb);if(e===Ot.GLOBAL)throw new te(L.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Ot.CHINA)n=[Ot.OVERSEA];else if(i=e,Te(kC).call(kC,i)){const a=(r=e,$T[Ot.GLOBAL][r]||[]),A=[...s,e,...a];n=o.filter(u=>!Te(A).call(A,u))}else if(function(a){let A=!1;return kC.forEach(u=>{var d;Te(d=$T[Ot.GLOBAL][u]).call(d,a)&&(A=!0)}),A}(e)){const a=function(u){let d;return kC.forEach(f=>{var m;Te(m=$T[Ot.GLOBAL][f]).call(m,u)&&(d=f)}),d}(e),A=[...s,a,e];n=o.filter(u=>!Te(A).call(A,u))}else n=t;n=function(a){const A=[];return _D.forEach(u=>{Te(a).call(a,u)&&A.push(u)}),A.concat(a.filter(u=>!Te(_D).call(_D,u)))}(n)}else n=t;var r,i;return n};function AG(t){var e,n;if(!t&&Te(e=j("AREAS")).call(e,Ot.EXTENSIONS))return S.debug("update area from ap : reset"),void Fk(WRe,!0);if(!Te(n=j("AREAS")).call(n,Ot.GLOBAL)||!t)return;let r=Vb.EXTENSIONS;r&&(r={CODE:SZ(Ot.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},S.debug("update area from ap success: ".concat(t,",config is "),r),Ht("AREAS",[Ot.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?Ht(i,r[i][0]):Ht(i,r[i])}))}function Fk(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Le.reportApiInvoke(null,{name:wr.SET_AREA,options:t,tag:Mn.TRACER});try{let r=[];if(typeof t=="string"&&(r=[t]),Array.isArray(t)&&(t.forEach(s=>{if(!Te(W3).call(W3,s))throw new te(L.INVALID_PARAMS,"invalid area code")}),r=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:s,excludedArea:o}=t;if(!s)throw new te(L.INVALID_PARAMS,"area code is needed");let a=s;typeof s=="string"&&(a=[s]),r=o?gDe(a,o):a}if(!e){if(rd.AREAS){const s=new te(L.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(s),void S.warning("setArea is prohibited because of config-distribute")}if(Te(r).call(r,Ot.GLOBAL)&&j("AREAS")===Ot.EXTENSIONS){const s=new te(L.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(s),void S.warning("setArea is prohibited because of ap extensions")}}Ht("AREAS",r,e);const i=mDe(r);Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?Ht(s,i[s][0]):Ht(s,i[s])}),S.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function lG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function AU(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?lG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let ED=1;function _De(t,e,n,r,i){ED+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:ED,requestId:ED,version:ya,cname:n.cname},o={service_name:e,json_body:JSON.stringify(s)};let a,A,u=t[0];return Jc(async()=>{a=Date.now();const d=await $c(u,{data:o,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(A=Date.now()-a,d.code!==0){const g=new te(L.UNEXPECTED_RESPONSE,"live streaming ap error, code"+d.code,{retry:!0,responseTime:A});throw S.error(g.toString()),g}const f=JSON.parse(d.json_body);if(f.code!==200){const g=new te(L.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(f.code,", reason: ").concat(f.reason),{code:f.code,responseTime:A});throw S.error(g.toString()),g}if(!f.servers||f.servers.length===0){const g=new te(L.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:f.code,responseTime:A});throw S.error(g.toString()),g}const m=function(g,v){return{addressList:g.servers.map(y=>"wss://".concat(y.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(y.wss,"?serviceName=").concat(encodeURIComponent(v))),workerToken:g.workerToken,vid:g.vid}}(f,e);return j("LIVE_STREAMING_ADDRESS")&&(m.addressList=j("LIVE_STREAMING_ADDRESS")instanceof Array?j("LIVE_STREAMING_ADDRESS"):[j("LIVE_STREAMING_ADDRESS")]),AU(AU({},m),{},{responseTime:A})},(d,f)=>(Le.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(d.addressList),firstSuccess:f===0,responseTime:A,serverIp:t[f%t.length]}),!1),(d,f)=>(Le.apworkerEvent(n.sid,{success:!1,sc:d.data&&d.data.code||200,serviceName:e,responseTime:A,serverIp:t[f%t.length]}),!!(d.code!==L.OPERATION_ABORTED&&d.code!==L.UNEXPECTED_RESPONSE||d.data&&d.data.retry)&&(u=t[(f+1)%t.length],!0)),i)}let vD=1;function uG(t,e,n,r){let{url:i,areaCode:s}=t;const{clientId:o,sid:a}=e,A=Date.now();let u;const[d,f]=Qk(e,s,[or.CHOOSE_SERVER]);let m=ar.networkState;return Jc(async()=>{m&&ar.networkState===go.OFFLINE&&ar.onlineWaiter&&await ye.race([ar.onlineWaiter,Zr(r&&r.maxRetryTimeout||hr.maxRetryTimeout)]),m=ar.networkState;const{data:g,headers:v}=await $c(i,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=v.http3==="1"?1:-1,Le.reportResourceTiming(i,a),bZ(g,i,e,A,[or.CHOOSE_SERVER],u);const y=Iv(g,or.CHOOSE_SERVER);return Vk(y),Rk(y,i)},g=>(g&&Le.joinChooseServer(a,{lts:A,succ:!0,csAddr:i,opid:f,serverList:g.gatewayAddrs.map(v=>v.address),ec:null,cid:g.cid.toString(),uid:g.uid.toString(),csIp:g.csIp,unilbsServerIds:[or.CHOOSE_SERVER].toString(),isHttp3:u}),!1),g=>g.code!==L.OPERATION_ABORTED&&(g.code===L.CAN_NOT_GET_GATEWAY_SERVER?g.data.retry:(Le.joinChooseServer(a,{lts:A,succ:!1,csAddr:i,serverList:null,opid:f,ec:g.code,csIp:g.data&&g.data.csIp,unilbsServerIds:[or.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:m}),isHttp3:u}),S.warning("[".concat(o||"sid-".concat(a.slice(0,6)),"] Choose server network error, retry"),g),!0)),r)}function dG(t,e,n,r){let i,{url:s,areaCode:o,serviceIds:a}=t;const A=Date.now(),[u,d]=Qk(e,o,a);let f;return Jc(async()=>{f&&ar.networkState===go.OFFLINE&&ar.onlineWaiter&&await ye.race([ar.onlineWaiter,Zr(r&&r.maxRetryTimeout||hr.maxRetryTimeout)]),f=ar.networkState;const{data:m,headers:g}=await $c(s,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=g.http3==="1"?1:-1,Le.reportResourceTiming(s,e.sid),bZ(m,s,e,A,a,i);const v=Iv(m,or.CHOOSE_SERVER),y=Iv(m,e.cloudProxyServer==="proxy5"?or.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?or.CLOUD_PROXY:or.CLOUD_PROXY_FALLBACK);return Vk(v),{gatewayInfo:Rk(v,s),proxyInfo:y,url:s}},m=>(m.gatewayInfo&&Le.joinChooseServer(e.sid,{lts:A,succ:!0,csAddr:s,serverList:m.gatewayInfo.gatewayAddrs.map(g=>g.address),ec:null,opid:d,cid:m.gatewayInfo.cid.toString(),uid:m.gatewayInfo.uid.toString(),csIp:m.gatewayInfo.csIp,unilbsServerIds:a.toString(),isHttp3:i}),m.proxyInfo&&Le.joinWebProxyAP(e.sid,{lts:A,sucess:1,apServerAddr:s,turnServerAddrList:m.proxyInfo.addresses.map(g=>g.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:a.toString()}),!1),m=>m.code!==L.OPERATION_ABORTED&&(m.code===L.CAN_NOT_GET_GATEWAY_SERVER?m.data.retry:(Le.joinWebProxyAP(e.sid,{lts:A,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:m.code,eventType:e.cloudProxyServer,unilbsServerIds:a.toString(),extend:JSON.stringify({networkState:f})}),S.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),m),!0)),r)}const bZ=(t,e,n,r,i,s)=>{const{sid:o,clientId:a,cloudProxyServer:A}=n,u=[],d=f=>{f.flag===4096?Le.joinChooseServer(o,{lts:r,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:f.error.message,csIp:f.error.data&&f.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s}):f.flag!==1048576&&f.flag!==4194304&&f.flag!==4194310||Le.joinWebProxyAP(o,{lts:r,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:f.error.code,eventType:A,unilbsServerIds:i.toString()})};if(t.response_body.forEach(f=>{const m=f.buffer.code;if(f.uri===23&&m===0&&!f.buffer.edges_services)if(f.buffer.flag===4194310)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),f.buffer.edges_services=[];else{const g={error:new te(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:f.buffer.flag};u.push(g),d(g)}if(m!==0){const g=Xm(m),v={error:new te(L.CAN_NOT_GET_GATEWAY_SERVER,g.desc,{desc:g.desc,retry:g.retry,csIp:t.detail[502]}),flag:f.buffer.flag};f.buffer.flag===4194310?S.warning(v.error.toString()):u.push(v),d(v)}}),u.length)throw S.warning("[".concat(a||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(u.map(f=>"flag: ".concat(f.flag,", message: ").concat(f.error.message,", retry: ").concat(f.error.data.retry)).join(" | "))),new te(L.CAN_NOT_GET_GATEWAY_SERVER,u.map(f=>"flag: ".concat(f.flag,", message: ").concat(f.error.message)).join(" | "),{retry:!!u.find(f=>f.error.data.retry),csIp:t.detail[502],desc:[...new Set(u.map(f=>{var m;return f==null||(m=f.error)===null||m===void 0||(m=m.data)===null||m===void 0?void 0:m.desc}).filter(f=>!!f))]})},Vk=t=>{var e,n,r,i;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new te(L.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(j("AP_AREA")&&((r=t.detail)!==null&&r!==void 0&&r[23]&&typeof((i=t.detail)===null||i===void 0?void 0:i[23])=="string"?AG(t.detail[23].toLowerCase()):AG()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const o=t.detail[19],a=o==null?void 0:o.split(";");for(let A=0;A<a.length;A++){var s;const u=is(s=a[A]).call(s);t.addresses[A]&&a&&(t.addresses[A].fingerprint=u)}}if(j("GATEWAY_ADDRESS")&&j("GATEWAY_ADDRESS").length>0){S.debug("assign gateway address to",j("GATEWAY_ADDRESS"));const o=j("GATEWAY_ADDRESS").map(a=>{var A,u;const d=(A=(u=t.addresses.find(f=>f.ip===a.ip&&f.port===a.port))===null||u===void 0?void 0:u.fingerprint)!==null&&A!==void 0?A:"";return{ip:a.ip,port:a.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:d}});t.addresses=o}},EDe=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const r=Xm(n.buffer.code);throw new te(L.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw S.debug("update ticket request received ap response without response body:",e),new te(L.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},Qk=(t,e,n)=>{const r=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:r,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:AU({6:t.stringUid,11:e,12:j("USE_NEW_TOKEN")?"1":void 0,22:e},t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};i.request_bodies.forEach(o=>{t.multiIP&&t.multiIP.gateway_ip&&(o.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const s=new FormData;return s.append("request",JSON.stringify(i)),[s,r]},vDe=(t,e)=>{const n=Math.floor(Math.random()*1e12),r={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let Tm=0;function Ng(t){return ye.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const Nv=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:s}=t,o=0;const a=e;let A,u=0;const d=async()=>{const f=(()=>{const m=o*a,g=m+a;return n.slice(m,g).map(r)})();s&&s.push(...f);try{A=await Ng(f)}catch(m){if(u+=a,o++,!(u>=n.length))return void await d();i(m)}f.forEach(m=>m.cancel())};return await d(),A},IZ=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:r}=t;const i=e.length;let s=0;const o=async()=>{const a=n(e.shift());try{return await a}catch(A){if(s++,s>=i||r!=null&&r(A))throw A;return o()}};return o()};async function lU(t,e,n,r){return{gatewayInfo:await async function(s,o,a,A){let u=null;const d=[],f=async()=>{const g=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(w=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Ov()})),v=A.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(w=>w.url)}),y=await Nv({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:w=>(S.debug("[".concat(s.clientId,"] Connect to choose_server:"),w.url),uG(w,s,o,a)),allFailedhandler:w=>{throw A.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},v),w[0]},promisesCollector:d});return A.recordJoinChannelService({endTs:Date.now(),status:"success"},v),y},m=async()=>{if(await Zr(1e3),u!==null)return u;const g=j("WEBCS_DOMAIN_BACKUP_LIST").map(w=>({url:s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Ov()})),v=A.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(w=>w.url)}),y=await Nv({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:w=>(S.debug("[".concat(s.clientId,"] Connect to backup choose_server:"),w.url),uG(w,s,o,a)),allFailedhandler:w=>{throw A.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},v),w[0]},promisesCollector:d});return A.recordJoinChannelService({endTs:Date.now(),status:"success"},v),y};try{return u=await Ng([f(),m()]),d.length&&d.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),u}catch(g){throw g[0]}}(t,e,n,r)}}async function hG(t,e,n,r,i){const s=t.cloudProxyServer;if(s==="disabled"){if(t.useLocalAccessPoint)return await lU(t,e,n,i);if(j("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:m,proxyInfo:g}=await pG(t,e,n,i);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:m};const v=g.map(y=>({turnServerURL:y.address,tcpport:y.tcpport||ci.tcpport,udpport:y.udpport||ci.udpport,username:y.username||ci.username,password:y.password||ci.password,forceturn:!1,security:!0}));if(i.useP2P){var o;const y=(o=t.uid)!==null&&o!==void 0?o:m.uid,w="glb:".concat(y.toString()),b=await qL(w),I=g.map(B=>({turnServerURL:B.address,tcpport:B.tcpport||ci.tcpport,udpport:B.udpport||ci.udpport,username:w,password:b,forceturn:!1,security:!0}));v.push(...I)}return t.turnServer={mode:"manual",servers:v},{gatewayInfo:m}}return await lU(t,e,n,i)}const{proxyInfo:a,gatewayInfo:A}=await pG(t,e,n,i),u={gatewayInfo:A},d=a.map(m=>({turnServerURL:m.address,tcpport:s==="proxy3"?void 0:m.tcpport?m.tcpport:ci.tcpport,udpport:s==="proxy4"?void 0:m.udpport?m.udpport:ci.udpport,username:m.username||ci.username,password:m.password||ci.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(i.useP2P){var f;const m=(f=t.uid)!==null&&f!==void 0?f:A.uid,g="glb:".concat(m.toString()),v=await qL(g),y=a.map(w=>({turnServerURL:w.address,tcpport:s==="proxy3"?void 0:w.tcpport||ci.tcpport,udpport:s==="proxy4"?void 0:w.udpport||ci.udpport,username:g,password:v,forceturn:s!=="proxy4",security:s==="proxy5"}));d.push(...y)}return t.turnServer={mode:"manual",servers:d},S.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(s)),u}async function RZ(t,e,n,r,i){const s=j("ACCOUNT_REGISTER").slice(0,j("AJAX_REQUEST_CONCURRENT"));let o=[];o=e.proxyServer?s.map(A=>"https://".concat(e.proxyServer,"/ap/?url=").concat(A+"/api/v1")):s.map(A=>"https://".concat(A,"/api/v1"));const a=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const A=await async function(u,d,f,m,g){const v=Date.now(),y={sid:f.sid,opid:10,appid:f.appId,string_uid:d};let w=u[0];const b=await Jc(()=>$c(w+"".concat(w.indexOf("?")===-1?"?":"&","action=stringuid"),{data:y,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(I,B)=>{if(I.code===0){if(I.uid<=0||I.uid>=Math.pow(2,32))throw S.error("Invalid Uint Uid ".concat(d," => ").concat(I.uid),I),Le.reqUserAccount(y.sid,{lts:v,success:!1,serverAddr:w,stringUid:y.string_uid,uid:I.uid,errorCode:L.INVALID_UINT_UID_FROM_STRING_UID,extend:y}),new te(L.INVALID_UINT_UID_FROM_STRING_UID);return Le.reqUserAccount(y.sid,{lts:v,success:!0,serverAddr:w,stringUid:y.string_uid,uid:I.uid,errorCode:null,extend:y}),!1}const M=Xm(I.code);return M.retry&&(w=u[(B+1)%u.length]),Le.reqUserAccount(y.sid,{lts:v,success:!1,serverAddr:w,stringUid:y.string_uid,uid:I.uid,errorCode:M.desc,extend:y}),M.retry},(I,B)=>I.code!==L.OPERATION_ABORTED&&(Le.reqUserAccount(y.sid,{lts:v,success:!1,serverAddr:w,stringUid:y.string_uid,uid:null,errorCode:I.code,extend:y}),w=u[(B+1)%u.length],!0),g);if(b.code!==0){const I=Xm(b.code);throw new te(L.UNEXPECTED_RESPONSE,I.desc)}return b}(o,t,e,n,r);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},a),A.uid}catch(A){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[A]},a),A}}async function yDe(t,e,n){const r=j("ACCOUNT_REGISTER");let i=[];i=e.proxyServer?r.map(s=>"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1")):r.map(s=>"https://".concat(s,"/api/v1"));try{return await IZ({referenceList:i,asyncMapHandler:o=>async function(a,A,u,d){const f=Date.now(),m={sid:u.sid,opid:10,appid:u.appId,string_uid:A};try{const g=await $c(a+"".concat(a.indexOf("?")===-1?"?":"&","action=stringuid"),{data:m,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(g.code!==0){const v=Xm(g.code);throw new te(L.UNEXPECTED_RESPONSE,"preload sua error:".concat(v.desc),v)}if(g.uid<=0||g.uid>=Math.pow(2,32))throw new te(L.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:f,url:a,req:m,uid:g.uid,elapse:Date.now()-f}}catch(g){throw g}}(o,t,e,n),closeFn:o=>o.code===L.OPERATION_ABORTED||o.code===L.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(s){throw s}}async function wDe(t,e,n){const r=j("CDS_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(A=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(A+"/api/v1"):"https://".concat(A,"/api/v1?action=config")),i=r.map(A=>function(u,d,f,m){const g=yt(),v={flag:64,cipher_method:0,features:{device:g.name,system:g.os,system_general:navigator.userAgent,vendor:d.appId,version:ya,cname:d.cname,sid:d.sid,session_id:d.sid,detail:"",proxyServer:d.proxyServer}};return Jc(()=>$c(u,{data:v,timeout:1e3,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,y=>y.code!==L.OPERATION_ABORTED,m)}(A,t,e,n));let s=null,o=null,a={};try{s=await Ng(i)}catch(A){if(A.code===L.OPERATION_ABORTED)throw A;o=A}if(i.forEach(A=>A.cancel()),Le.reportApiInvoke(t.sid,{name:wr.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{a=function(A){if(!A.test_tags)return{};const u=A.test_tags,d=Object.keys(u),f={};return d.forEach(m=>{var g;const v=is(g=m.slice(4)).call(g),y=JSON.parse(u[m])[1];f[v]=y}),f}(s)}catch{}return a}async function fG(t,e){const n=j("WEBCS_DOMAIN").concat(j("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:Ov(),serviceIds:[or.CHOOSE_SERVER,or.CLOUD_PROXY_FALLBACK]}));try{return await IZ({referenceList:n,asyncMapHandler:i=>async function(s,o,a){let A,{url:u,areaCode:d,serviceIds:f}=s;const m=Date.now(),[g,v]=Qk(o,d,f);let y=ar.networkState;try{y&&ar.networkState===go.OFFLINE&&ar.onlineWaiter&&await ye.race([ar.onlineWaiter,Zr(hr.maxRetryTimeout)]),y=ar.networkState;const{data:w,headers:b}=await $c(u,{data:g,cancelToken:a,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);A=b.http3==="1"?1:-1,(H=>{const K=[];if(H.response_body.forEach(Q=>{const F=Q.buffer.code;if(Q.uri===23&&F===0&&!Q.buffer.edges_services)if(Q.buffer.flag===4194310)Q.buffer.edges_services=[];else{const k={error:new te(L.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:H.detail[502]}),flag:Q.buffer.flag};K.push(k)}if(F!==0){const k=Xm(F),G={error:new te(L.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:H.detail[502]}),flag:Q.buffer.flag};Q.buffer.flag===4194310?S.warning(G.error.toString()):K.push(G)}}),K.length)throw new te(L.CAN_NOT_GET_GATEWAY_SERVER,K.map(Q=>"flag: ".concat(Q.flag,", message: ").concat(Q.error.message)).join(" | "),{retry:!!K.find(Q=>Q.error.data.retry),csIp:H.detail[502],desc:[...new Set(K.map(Q=>{var F;return Q==null||(F=Q.error)===null||F===void 0||(F=F.data)===null||F===void 0?void 0:F.desc}).filter(Q=>!!Q))]})})(w);const B=Iv(w,or.CHOOSE_SERVER),M=Iv(w,or.CLOUD_PROXY_FALLBACK);return Vk(B),{gatewayInfo:Rk(B,u),proxyInfo:M,opid:v,requestTime:m,url:u,isHttp3:A,elapse:Date.now()-m}}catch(w){throw w}}(i,t,e),closeFn:i=>i.code===L.OPERATION_ABORTED||i.code===L.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function pG(t,e,n,r){const i=j("PROXY_SERVER_TYPE3"),s=(g,v,y)=>{let w=y||i;return Array.isArray(w)&&(w=v%2==0?i[1]:i[0]),"https://".concat(w,"/ap/?url=").concat(g)};let o=null;const a=[],A=async()=>{const g=j("WEBCS_DOMAIN").slice(0,j("AJAX_REQUEST_CONCURRENT")).map((w,b)=>{let I;return I=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(w,"/api/v2/transpond/webrtc?v=2"),b,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):s("".concat(w,"/api/v2/transpond/webrtc?v=2"),b),{url:I,areaCode:Ov(),serviceIds:[or.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?or.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?or.CLOUD_PROXY:or.CLOUD_PROXY_FALLBACK]}}),v=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(w=>w.url)}),y=await Nv({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:w=>(S.debug("[".concat(t.clientId,"] Connect to choose_server:"),w.url),dG(w,t,e,n)),allFailedhandler:w=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},v),w[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},v),y},u=async()=>{if(await Zr(1e3),o!==null)return o;const g=j("WEBCS_DOMAIN_BACKUP_LIST").map((w,b)=>{let I;return I=t.cloudProxyServer==="disabled"&&t.proxyServer?s("".concat(w,"/api/v2/transpond/webrtc?v=2"),b,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):s("".concat(w,"/api/v2/transpond/webrtc?v=2"),b),{url:I,areaCode:Ov(),serviceIds:[or.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?or.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?or.CLOUD_PROXY:or.CLOUD_PROXY_FALLBACK]}}),v=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(w=>w.url)}),y=await Nv({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:w=>(S.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),w.url),dG(w,t,e,n)),allFailedhandler:w=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},v),w[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},v),y};let d,f,m;try{({gatewayInfo:d,proxyInfo:f,url:m}=await Ng([A(),u()]))}catch(g){throw g[0]}if(a.length&&a.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),!d||!f)throw new te(L.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=m,t.cloudProxyServer!=="disabled"&&Array.isArray(i)&&m){const g=/^https?:\/\/(.+?)(\/.*)?$/.exec(m)[1];Te(i).call(i,g)&&(t.proxyServer=g,S.setProxyServer(g),Le.setProxyServer(g))}return o={gatewayInfo:d,proxyInfo:await M$(f,d.uid)},o}async function CDe(t,e,n){const r=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(s=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),i=r.map(s=>function(o,a,A,u){const d={command:"convergeAllocateEdge",sid:a.sid,appId:a.appId,token:a.token,ts:Date.now(),version:ya,cname:a.cname,uid:a.uid.toString(),requestId:vD,seq:vD};vD+=1;const f={service_name:"tele_channel",json_body:JSON.stringify(d)};return Jc(async()=>{const m=await $c(o,{data:f,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(m.code!==0){const v=new te(L.UNEXPECTED_RESPONSE,"cross channel ap error, code"+m.code,{retry:!0});throw S.error(v.toString()),v}const g=JSON.parse(m.json_body);if(g.code!==200){const v=new te(L.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(g.code,", reason: ").concat(g.reason));throw S.error(v.toString()),v}if(!g.servers||g.servers.length===0){const v=new te(L.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw S.error(v.toString()),v}return{vid:g.vid,workerToken:g.workerToken,addressList:(j("CHANNEL_MEDIA_RELAY_SERVERS")||g.servers).map(v=>"wss://".concat(v.address.replace(/\./g,"-"),".").concat(j("WORKER_DOMAIN"),":").concat(v.wss))}},void 0,m=>!!(m.code!==L.OPERATION_ABORTED&&m.code!==L.UNEXPECTED_RESPONSE||m.data&&m.data.retry),u)}(s,t,e,n));try{const s=await Ng(i);return i.forEach(o=>o.cancel()),s}catch(s){throw s[0]}}async function TDe(t,e,n){let r=null;const i=[],s=async o=>{const a=j(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(A=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(A+"/api/v2/transpond/webrtc?v=2"):"https://".concat(A,"/api/v2/transpond/webrtc?v=2"));return o&&(await Zr(1e3),r!==null)?r:await Nv({fragementLength:j("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:A=>(S.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),A),function(u,d,f,m){const[g]=vDe(d,[or.CHOOSE_SERVER]);let v=ar.networkState;return Jc(async()=>{v&&ar.networkState===go.OFFLINE&&ar.onlineWaiter&&await ye.race([ar.onlineWaiter,Zr(m&&m.maxRetryTimeout||hr.maxRetryTimeout)]),v=ar.networkState;const y=await $c(u,{data:g,cancelToken:f,headers:{"Content-Type":"multipart/form-data;"}},!0);return EDe(y,u)},()=>!1,y=>y.code!==L.OPERATION_ABORTED&&(y.code===L.UPDATE_TICKET_FAILED?y.data.retry:(S.warning("[".concat(d.clientId,"] update ticket network error, retry"),y),!0)),m)}(A,t,e,n)),allFailedhandler:A=>{throw A[0]},promisesCollector:i})};try{return r=await Ng([s(!1),s(!0)]),i.length&&i.forEach(o=>o.cancel&&typeof o.cancel=="function"&&o.cancel()),r}catch(o){throw o[0]}}function mG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function gG(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class SDe extends Ln{get isSuccess(){return!!this.configs}constructor(){super(),N(this,"configs",void 0),N(this,"joinInfo",void 0),N(this,"cancelToken",void 0),N(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),N(this,"interval",void 0),N(this,"mutex",new Pi("config-distribute")),N(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),j("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},j("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Le.reportApiInvoke(null,{options:void 0,name:wr.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Mn.TRACER}).onSuccess(JSON.stringify(rd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void S.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await wDe(this.joinInfo,this.cancelToken,this.retryConfig),S.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(r){const i=new te(L.NETWORK_RESPONSE_ERROR,r);S.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var n;(n=e)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(ZL.UPDATE_BITRATE_LIMIT,e):this.emit(ZL.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&gG({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var n;const r=yy(n=Object.keys(e).filter(s=>/^webrtc_ng_global_parameter/.test(s))).call(n);for(let s=0;s<r.length;s++)for(let o=r.length-1;o>s;o--){const a=r[o];if(typeof e[a].__priority=="number"){const A=e[a].__priority,u=r[o-1];if(typeof e[u].__priority=="number"){if(!(A>e[u].__priority))continue;{const d=a;r[o]=r[o-1],r[o-1]=d}}else{const d=a;r[o]=r[o-1],r[o-1]=d}}}const i={};r.forEach(s=>{const o=e[s],a=o.__expires;Object.keys(o).forEach(A=>{A==="__priority"||A==="__expires"||Object.prototype.hasOwnProperty.call(i,A)||(i[A]=gG({value:o[A]},a&&{expires:a}))})});try{(function(a){try{const A=Date.now();Object.keys(a).forEach(u=>{switch(u){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(Zn,u)){const{value:d,expires:f}=a[u];if(f&&f<=A)return;rd[u]=d,Zn[u]=d,S.debug("Update global parameters from config distribute",u,d)}}})}catch(A){S.error("Error update config immediately: ".concat(a),A.message)}})(i);const s=JSON.stringify(i),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),S.debug("Caching global parameters ".concat(s))}catch(s){S.error("Error caching global parameters:",s.message)}}}class bDe extends Ln{constructor(){super(...arguments),N(this,"resultStorage",new Map)}setLocalAudioStats(e,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(e,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(r))}setRemoteAudioStats(e,n){const r=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const r=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(e,n,r){if(j("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(e);if(i&&(i.result.push(r),i.result.length>=5)){var s;const o=Te(s=i.result).call(s,!0);i.isPrevNormal&&!o&&this.emit("exception",_G[e],e,n),!i.isPrevNormal&&o&&this.emit("exception",_G[e]+2e3,e+"_RECOVER",n),i.isPrevNormal=o,i.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof yr&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=vo(n._encoderConfig.frameRate));const i=e.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof yr&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const _G={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ui=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function Hk(t,e){this.v=t,this.k=e}function Rt(t){return new Hk(t,0)}var IDe=UX,RDe=zA;nn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=RDe.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var ODe=zA,NDe=Sg;nn({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=ODe.f(this),n=NDe(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var uU=tr(IDe),OZ=bg.f("asyncIterator"),DDe=tr(OZ);function AE(t){var e,n;function r(s,o){try{var a=t[s](o),A=a.value,u=A instanceof Hk;uU.resolve(u?A.v:A).then(function(d){if(u){var f=s==="return"?"return":"next";if(!A.k||d.done)return r(f,d);d=t[f](d).value}i(a.done?"return":"normal",d)},function(d){r("throw",d)})}catch(d){i("throw",d)}}function i(s,o){switch(s){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):n=null}this._invoke=function(s,o){return new uU(function(a,A){var u={key:s,arg:o,resolve:a,reject:A,next:null};n?n=n.next=u:(e=n=u,r(s,o))})},typeof t.return!="function"&&(this.return=void 0)}function Gc(t){return function(){return new AE(t.apply(this,arguments))}}AE.prototype[typeof em=="function"&&DDe||"@@asyncIterator"]=function(){return this},AE.prototype.next=function(t){return this._invoke("next",t)},AE.prototype.throw=function(t){return this._invoke("throw",t)},AE.prototype.return=function(t){return this._invoke("return",t)};var EG=tr(Xc.Object.getOwnPropertySymbols),BDe=nn,LDe=QP.indexOf,UDe=_b,dU=pv([].indexOf),vG=!!dU&&1/dU([1],1,-0)<0;BDe({target:"Array",proto:!0,forced:vG||!UDe("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return vG?dU(this,t,e)||0:LDe(this,t,e)}});var PDe=pc("Array").indexOf,kDe=Is,xDe=PDe,yD=Array.prototype,MDe=function(t){var e=t.indexOf;return t===yD||kDe(yD,t)&&e===yD.indexOf?xDe:e},yG=tr(MDe);function FDe(t,e){if(t==null)return{};var n,r,i=function(o,a){if(o==null)return{};var A,u,d={},f=B$(o);for(u=0;u<f.length;u++)A=f[u],yG(a).call(a,A)>=0||(d[A]=o[A]);return d}(t,e);if(EG){var s=EG(t);for(r=0;r<s.length;r++)n=s[r],yG(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function tc(t){if(Array.isArray(t))return t.map(n=>n);if(!wG(t))return t;const e={};for(const n in t){const r=t[n];wG(r)||Array.isArray(r)?e[n]=tc(r):e[n]=r}return e}function wG(t){return!(typeof t!="object"||Array.isArray(t)||!t)}class wD{constructor(e){N(this,"input",[]),N(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const VA={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Dv={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:VA,remoteCandidate:VA}},NZ={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},DZ={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},BZ={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},LZ={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function CG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function TG(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?CG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):CG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class jk{constructor(e,n){N(this,"onFirstVideoReceived",void 0),N(this,"onFirstVideoDecoded",void 0),N(this,"onFirstAudioReceived",void 0),N(this,"onFirstVideoDecodedTimeout",void 0),N(this,"onFirstAudioDecoded",void 0),N(this,"onSelectedLocalCandidateChanged",void 0),N(this,"onSelectedRemoteCandidateChanged",void 0),N(this,"videoIsReady",!1),N(this,"videoIsReady2",{}),N(this,"pc",void 0),N(this,"options",void 0),N(this,"intervalTimer",void 0),N(this,"stats",tc(Dv)),N(this,"isFirstVideoReceived",{}),N(this,"isFirstVideoDecoded",{}),N(this,"isFirstAudioReceived",{}),N(this,"isFirstAudioDecoded",{}),N(this,"isFirstVideoDecodedTimeout",{}),N(this,"lossRateWindowStats",[]),this.pc=e,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ye(e=>{e({local:TG({},VA),remote:TG({},VA)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,n){this.videoIsReady2[e]=n}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,s=0,o=0,a=0;for(const A of r)e[A].forEach((u,d)=>{if(!this.lossRateWindowStats[n-1][A][d]||!this.lossRateWindowStats[0][A][d])return;const f=this.lossRateWindowStats[n-1][A][d].packets-this.lossRateWindowStats[0][A][d].packets,m=this.lossRateWindowStats[n-1][A][d].packetsLost-this.lossRateWindowStats[0][A][d].packetsLost;A==="videoSend"||A==="audioSend"?(i+=f,o+=m):(s+=f,a+=m),Number.isNaN(f)||Number.isNaN(f)?u.packetLostRate=0:u.packetLostRate=f<=0||m<=0?0:m/(f+m)});e.sendPacketLossRate=i<=0||o<=0?0:o/(i+o),e.recvPacketLossRate=s<=0||a<=0?0:a/(s+a)}}function SG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function VDe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?SG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):SG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class QDe extends jk{constructor(){super(...arguments),N(this,"_stats",Dv),N(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),n=this.statsResponsesToObjects(e);this._stats=tc(Dv);const r=n.filter(s=>s.type==="ssrc");this.processSSRCStats(r);const i=n.find(s=>s.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(n=>{var r;const i=Te(r=n.id).call(r,"send");switch("".concat(n.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const s=tc(DZ);s.codec=n.googCodecName,s.adaptionChangeReason="none",n.googCpuLimitedResolution&&(s.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(s.adaptionChangeReason="bandwidth"),s.avgEncodeMs=Number(n.googAvgEncodeMs),s.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},s.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},s.firsCount=Number(n.googFirReceived),s.nacksCount=Number(n.googNacksReceived),s.plisCount=Number(n.googPlisReceived),s.frameCount=Number(n.framesEncoded),s.bytes=Number(n.bytesSent),s.packets=Number(n.packetsSent),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(s),this._stats.rtt=s.rttMs;break}case"video_recv":{const s=tc(NZ),o=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(s.codec=n.googCodecName,s.targetDelayMs=Number(n.googTargetDelayMs),s.renderDelayMs=Number(n.googRenderDelayMs),s.currentDelayMs=Number(n.googCurrentDelayMs),s.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),s.decodeMs=Number(n.googDecodeMs),s.maxDecodeMs=Number(n.googMaxDecodeMs),s.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},s.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},s.decodeFrameRate=Number(n.googFrameRateDecoded),s.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},s.jitterBufferMs=Number(n.googJitterBufferMs),s.firsCount=Number(n.googFirsSent),s.nacksCount=Number(n.googNacksSent),s.plisCount=Number(n.googPlisSent),s.framesDecodeCount=Number(n.framesDecoded),s.bytes=Number(n.bytesReceived),s.packets=Number(n.packetsReceived),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,s.decodedFrame.width,s.decodedFrame.height),this.isFirstVideoDecoded[s.ssrc]=!0),o){const a=o.stats,A=Date.now()-o.lts;s.framesDecodeFreezeTime=a.framesDecodeFreezeTime,s.framesDecodeInterval=a.framesDecodeInterval,s.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(o.lts=Date.now(),s.framesDecodeInterval=A,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):s.framesDecodeCount<o.stats.framesDecodeCount&&(s.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:VDe({},s),lts:Date.now()}),this._stats.videoRecv.push(s);break}case"audio_recv":{const s=tc(LZ);s.codec=n.googCodecName,s.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,s.decodingCNG=Number(n.googDecodingCNG),s.decodingCTN=Number(n.googDecodingCTN),s.decodingCTSG=Number(n.googDecodingCTSG),s.decodingNormal=Number(n.googDecodingNormal),s.decodingPLC=Number(n.googDecodingPLC),s.decodingPLCCNG=Number(n.googDecodingPLCCNG),s.expandRate=Number(n.googExpandRate),s.accelerateRate=Number(n.googAccelerateRate),s.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),s.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),s.speechExpandRate=Number(n.googSpeechExpandRate),s.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),s.jitterBufferMs=Number(n.googJitterBufferMs),s.jitterMs=Number(n.googJitterReceived),s.bytes=Number(n.bytesReceived),s.packets=Number(n.packetsReceived),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),s.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.decodingNormal>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),this._stats.audioRecv.push(s);break}case"audio_send":{const s=tc(BZ);s.codec=n.googCodecName,s.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,s.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),s.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),s.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),s.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),s.bytes=Number(n.bytesSent),s.packets=Number(n.packetsSent),s.packetsLost=Number(n.packetsLost),s.ssrc=Number(n.ssrc),s.rttMs=Number(n.googRtt||0),this._stats.rtt=s.rttMs,this._stats.audioSend.push(s);break}}})}_getStats(){return new ye((e,n)=>{this.pc.getStats(e,n)})}statsResponsesToObjects(e){const n=[];return e.result().forEach(r=>{const i={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(s=>{i[s]=r.stat(s)}),n.push(i)}),n}}function bG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function vh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class IG extends jk{constructor(){super(...arguments),N(this,"_stats",Dv),N(this,"report",void 0),N(this,"lastDecodeVideoReceiverStats",new Map),N(this,"lastVideoFramesRecv",new Map),N(this,"lastVideoFramesSent",new Map),N(this,"lastVideoFramesDecode",new Map),N(this,"lastVideoFramesOutput",new Map),N(this,"lastVideoJBDelay",new Map),N(this,"lastAudioJBDelay",new Map),N(this,"mediaBytesSent",new Map),N(this,"mediaBytesRetransmit",new Map),N(this,"mediaBytesTargetEncode",new Map),N(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=tc(Dv),this.report.forEach(e=>{switch(e.type){case Bo.OUTBOUND:case Bo.INBOUND:{const n=e.mediaType||e.kind,r=!n&&"frameWidth"in e,i=!n&&!("frameWidth"in e);e.type===Bo.OUTBOUND?n==="audio"||i?this.processAudioOutboundStats(e):(n==="video"||r)&&this.processVideoOutboundStats(e):e.type===Bo.INBOUND&&(n==="audio"||i?this.processAudioInboundStats(e):(n==="video"||r)&&this.processVideoInboundStats(e));break}case Bo.TRANSPORT:{const n=this.report.get(e.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case Bo.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),n={local:vh({},VA),remote:vh({},VA)};return e.forEach(r=>{let i;if(r.type===Bo.TRANSPORT&&(i=e.get(r.selectedCandidatePairId)),r.type===Bo.CANDIDATE_PAIR&&r.selected&&(i=r),i){const s=(o,a)=>{o.type=a.type,o.id=a.id,a.address&&(o.address=a.address),a.candidateType&&(o.candidateType=a.candidateType),a.port&&(o.port=a.port),a.priority&&(o.priority=a.priority),a.protocol&&(o.protocol=a.protocol),a.relayProtocol&&(o.relayProtocol=a.relayProtocol)};if(i.localCandidateId){const o=e.get(i.localCandidateId);o&&s(n.local,o)}if(i.remoteCandidateId){const o=e.get(i.remoteCandidateId);o&&s(n.remote,o)}}}),n}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const n=this.report.get(e.localCandidateId);n&&this.processCandidateStats(n)}if(e.remoteCandidateId){const n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(e){let n;e.type===Bo.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),e.type===Bo.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=e.type,n.id=e.id,e.address&&(n.address=e.address),e.candidateType&&(n.candidateType=e.candidateType),e.port&&(n.port=e.port),e.priority&&(n.priority=e.priority),e.protocol&&(n.protocol=e.protocol),e.relayProtocol&&(n.relayProtocol=e.relayProtocol),e.type===Bo.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(vh({},n),vh({},this.stats.selectedCandidatePair.localCandidate)),e.type===Bo.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(vh({},n),vh({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let n=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);n||(n=tc(LZ),this._stats.audioRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.packetsDiscarded=e.packetsDiscarded,n.bytes=e.bytesReceived,n.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),n.receivedFrames||(n.receivedFrames=e.packetsReceived),n.droppedFrames||(n.droppedFrames=e.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof e.concealedSamples=="number"&&(n.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let n=this._stats.videoRecv.find(a=>a.ssrc===e.ssrc);n||(n=tc(NZ),this._stats.videoRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.framesDecodeCount=e.framesDecoded,n.framesDroppedCount=e.framesDropped,n.totalInterFrameDelay=e.totalInterFrameDelay,n.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,n.totalFreezesDuration=e.totalFreezesDuration;const r=this.lastDecodeVideoReceiverStats.get(n.ssrc),i=this.lastVideoFramesDecode.get(n.ssrc),s=this.lastVideoFramesOutput.get(n.ssrc),o=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const a=n.decodedFrame?n.decodedFrame.width:0,A=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,a,A),this.isFirstVideoDecoded[n.ssrc]=!0}if(r){const a=r.stats,A=o-r.lts;n.framesDecodeFreezeTime=a.framesDecodeFreezeTime,n.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&A>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(r.lts=Date.now(),n.framesDecodeInterval=A,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):n.framesDecodeCount<a.framesDecodeCount&&(n.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?n.qpSumPerFrame=e.qpSum/e.framesDecoded:n.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}i&&o-i.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:o,rate:n.decodeFrameRate})):i?n.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:o,rate:0}),n.framesDroppedCount&&e.framesReceived&&(s&&o-s.lts>=800?(n.outputFrameRate=Math.round((e.framesReceived-n.framesDroppedCount-s.count)/((o-s.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:o,rate:Math.max(n.outputFrameRate,0)})):s?n.outputFrameRate=s.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:o,rate:0})),e.totalDecodeTime&&(n.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(n.framesRateFirefox=e.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:vh({},n),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let n=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);n||(n=tc(DZ),this._stats.videoSend.push(n));const r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{const i=new wD(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const s=new wD(10);s.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,s)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const s=new wD(10);s.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,s)}}if(n.ssrc=e.ssrc,n.bytes=e.bytesSent,n.packets=e.packetsSent,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.frameCount=e.framesEncoded,n.adaptionChangeReason=e.qualityLimitationReason,n.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)n.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const s=e.framesEncoded-i.lastFrameCount,o=e.totalEncodeTime-i.lastEncoderTime;n.avgEncodeMs=1e3*o/s}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?n.qpSumPerFrame=e.qpSum/e.framesEncoded:n.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,n),this.processVideoTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const i=this.findRemoteStatsId(e.ssrc,Bo.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}processAudioOutboundStats(e){let n=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(n||(n=tc(BZ),this._stats.audioSend.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsSent,n.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const r=this.findRemoteStatsId(e.ssrc,Bo.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,n)}}findRemoteStatsId(e,n){var r;const i=Array.from(Hl(r=this.report).call(r)).find(s=>s.type===n&&s.ssrc===e);return i?i.id:null}processVideoMediaSource(e,n){const r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(n.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,n){const r=this.report.get(e);r&&(n.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,n,r){var i,s,o,a;const A=n?this.report.get(n):void 0,u=(i=A==null?void 0:A.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof u!="number")return;let d=(s=A==null?void 0:A.frameWidth)!==null&&s!==void 0?s:e.frameWidth,f=(o=A==null?void 0:A.frameHeight)!==null&&o!==void 0?o:e.frameHeight,m=(a=A==null?void 0:A.framesPerSecond)!==null&&a!==void 0?a:e.framesPerSecond;if(typeof d=="number"&&typeof f=="number"||(d=0,f=0),m==null){const g=Date.now(),v=this.lastVideoFramesSent.get(r.ssrc);v&&g-v.lts>=800?(m=Math.round((u-v.count)/((g-v.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:u,lts:g,rate:m})):v?m=v.rate:this.lastVideoFramesSent.set(r.ssrc,{count:u,lts:g,rate:0})}r.sentFrame={width:d,height:f,frameRate:Math.max(0,m)}}processVideoTrackReceiverStats(e,n,r){var i,s,o,a,A;const u=n?this.report.get(n):void 0,d=(i=u==null?void 0:u.framesReceived)!==null&&i!==void 0?i:e.framesReceived,f=(s=u==null?void 0:u.frameWidth)!==null&&s!==void 0?s:e.frameWidth,m=(o=u==null?void 0:u.frameHeight)!==null&&o!==void 0?o:e.frameHeight,g=(a=u==null?void 0:u.jitterBufferDelay)!==null&&a!==void 0?a:e.jitterBufferDelay,v=(A=u==null?void 0:u.jitterBufferEmittedCount)!==null&&A!==void 0?A:e.jitterBufferEmittedCount;if(typeof d=="number"){const y=this.lastVideoFramesRecv.get(r.ssrc),w=Date.now();r.framesReceivedCount=d;let b=0;y&&w-y.lts>=800?(b=Math.round((d-y.count)/((w-y.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:d,lts:w,rate:b})):y?b=y.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:d,lts:w,rate:0}),r.receivedFrame={width:f||0,height:m||0,frameRate:b||0},r.decodedFrame={width:f||0,height:m||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:f||0,height:m||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(g&&v){const y=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let w=y.jitterBufferMs;const b=v-y.jitterBufferEmittedCount;b>0&&(w=1e3*(g-y.jitterBufferDelay)/b),r.jitterBufferMs=w,r.currentDelayMs=Math.round(w),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:g,jitterBufferEmittedCount:v,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,n,r){var i,s,o,a;const A=n?this.report.get(n):void 0,u=(i=(s=A==null?void 0:A.echoReturnLoss)!==null&&s!==void 0?s:e.echoReturnLoss)!==null&&i!==void 0?i:0,d=(o=(a=A==null?void 0:A.echoReturnLossEnhancement)!==null&&a!==void 0?a:e.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;r.aecReturnLoss=u,r.aecReturnLossEnhancement=d}processAudioTrackReceiverStats(e,n,r){var i,s,o,a,A,u,d;const f=n?this.report.get(n):void 0,m=(i=f==null?void 0:f.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,g=(s=f==null?void 0:f.totalSamplesReceived)!==null&&s!==void 0?s:e.totalSamplesReceived,v=(o=f==null?void 0:f.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,y=(a=f==null?void 0:f.jitterBufferEmittedCount)!==null&&a!==void 0?a:e.jitterBufferEmittedCount,w=(A=f==null?void 0:f.audioLevel)!==null&&A!==void 0?A:e==null?void 0:e.audioLevel,b=(u=f==null?void 0:f.totalSamplesDuration)!==null&&u!==void 0?u:e==null?void 0:e.totalSamplesDuration,I=(d=f==null?void 0:f.concealedSamples)!==null&&d!==void 0?d:e.concealedSamples;if(m&&g&&(r.accelerateRate=m/g),v&&y){const M=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let H=M.jitterBufferMs;const K=y-M.jitterBufferEmittedCount;K>0&&(H=1e3*(v-M.jitterBufferDelay)/K),r.jitterBufferMs=Math.round(H),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:v,jitterBufferEmittedCount:y,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=w;let B=1920;b&&g&&(B=g/b/50,r.receivedFrames=Math.round(g/B)),I&&(r.droppedFrames=Math.round(I/B))}processRemoteInboundStats(e,n){const r=this.report.get(e);r&&(n.packetsLost=r.packetsLost,r.roundTripTime&&(n.rttMs=1e3*r.roundTripTime),r.jitter&&(n.jitterMs=1e3*r.jitter),r.timestamp&&(n.timestamp=r.timestamp))}getCodecFromCodecStats(e){const n=this.report.get(e);if(!n)return"";const r=n.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,n=null,r=null;this.mediaBytesSent.forEach(s=>{e+=s.diffMean()}),this.mediaBytesRetransmit.forEach(s=>{n=n===null?s.diffMean():n+s.diffMean()}),this.mediaBytesTargetEncode.forEach(s=>{r=r===null?s.diffMean():r+s.diffMean()});const i=n!==null?e-n:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}}class HDe extends jk{updateStats(){return ye.resolve()}}function Kk(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const s=function(){const o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null}();return s?s<76?new QDe(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new IG(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(o){if(!window.RTCStatsReport)return!1;const a=o.getStats();return!!(a instanceof ye||function(A){return!!A&&(typeof A=="object"||typeof A=="function")&&typeof A.then=="function"}(a))}(t)?new IG(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new HDe(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}let RG=class{get localCapabilities(){return sr(this._localCapabilities)}get rtpCapabilities(){return sr(this._rtpCapabilities)}get candidates(){return sr(this._candidates)}get iceParameters(){return sr(this._iceParameters)}get dtlsParameters(){return sr(this._dtlsParameters)}constructor(t){N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_iceParameters",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname","o/i14u9pJrxRKAsu"),N(this,"firefoxSsrcMidMap",new Map),t=sr(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:s,direction:o,setup:a,videoCodec:A,audioCodec:u}=t;let d;this.setup=a,d=o===ys.RECEIVE_ONLY?Jr.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Jr.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=s;const f=o===ys.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,m=o===ys.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,g=o===ys.RECEIVE_ONLY?i.send.videoCodecs:VE(Ue.VIDEO,f,m,A),v=o===ys.RECEIVE_ONLY?i.send.audioCodecs:VE(Ue.AUDIO,f,m,u);for(const y of d.mediaDescriptions)y.attributes.iceUfrag=e.iceUfrag,y.attributes.icePwd=e.icePwd,y.attributes.fingerprints=n.fingerprints,y.attributes.candidates=r,y.attributes.setup=this.setup,y.media.mediaType==="application"&&(y.attributes.sctpPort="5000"),y.media.mediaType==="video"&&(y.media.fmts=g.map(w=>w.payloadType.toString(10)),y.attributes.payloads=g,y.attributes.extmaps=f.videoExtensions),y.media.mediaType==="audio"&&(y.media.fmts=v.map(w=>w.payloadType.toString(10)),y.attributes.payloads=v,y.attributes.extmaps=f.audioExtensions,eg(y));this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}toString(){return Jr.print(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:s,ssrcGroups:o}=Lh(e,this.cname,j("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(s);if(a){if(Vn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const A=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const A=this.findAvailableMediaIndex(t,s,r);let u;return A===-1?(u=this.createOrRecycleSendMedia(t,s,o,"sendonly",r,i),this.updateBundleMids()):(u=sr(this.sessionDesc.mediaDescriptions[A]),u.attributes.direction="sendonly",u.attributes.ssrcs=s,u.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(u,i)),Vn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,u.attributes.mid),{needExchangeSDP:!0,mid:u.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const r=[];return t.forEach(i=>{const s=i._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s);let a,A=!1;o===-1?(A=!0,a=this.createOrRecycleRecvMedia(i,[],"recvonly",e,n),this.updateBundleMids()):(a=sr(this.sessionDesc.mediaDescriptions[o]),a.attributes.direction="recvonly"),r.push({mid:a.attributes.mid,needCreateTransceiver:A})}),r}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:r,port:i,type:s,relatedAddress:o,relatedPort:a,priority:A}=new RTCIceCandidate(t),u={foundation:e??"",componentId:"1",transport:n??"",priority:A?A+"":"",connectionAddress:r??"",port:i?i+"":"",type:s?s+"":"",relAddr:o??"",relPort:a?a+"":"",extension:{}};this.candidates.some(d=>d.priority===u.priority&&d.connectionAddress===u.connectionAddress&&d.port===u.port)||(this._candidates.push(u),this.sessionDesc.mediaDescriptions.forEach(d=>{d.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,r,i){const s=t._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,a=VE(s,o,this.localCapabilities.send,s===Ue.AUDIO?i:r),A=s===Ue.VIDEO?o.videoExtensions:o.audioExtensions,u="".concat(++this.currentMidIndex);let d={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};d=this.mungRecvMediaDsec(d,t);const f=this.findFirstClosedMedia(s);if(f){const m=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[m]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Te(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>Te(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Vn()){if(i){const s=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=sr(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,r,i,s){const o=this.rtpCapabilities.send,a=t===Ue.VIDEO?o.videoCodecs:o.audioCodecs,A=t===Ue.VIDEO?o.videoExtensions:o.audioExtensions;Vn()&&(i="".concat(++this.currentMidIndex));let u={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(f=>f.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};u=this.mungSendMediaDesc(u,s);const d=this.findFirstClosedMedia(t);if(d){const f=this.sessionDesc.mediaDescriptions.indexOf(d);this.sessionDesc.mediaDescriptions[f]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}mungRecvMediaDsec(t,e,n){const r=sr(t);return kk(r),Zm(r,e),xk(r,e),vZ(r),hS(r,n,this.localCapabilities.send),r}mungSendMediaDesc(t,e){const n=sr(t);return hS(n,e,this.localCapabilities.recv),eg(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===t);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>Vn()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const jDe=["sdp"];var sn;function OG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Uu(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?OG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):OG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let NG=(sn=class Wp extends U${get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,r){super(e,n),N(this,"direction",void 0),N(this,"name",void 0),N(this,"store",void 0),N(this,"spec",void 0),N(this,"peerConnection",void 0),N(this,"initialOffer",void 0),N(this,"transport",void 0),N(this,"statsFilter",void 0),N(this,"localCandidateCount",0),N(this,"_isInRestartIce",!1),N(this,"mutex",new Pi("P2PConnection-mutex")),N(this,"onLocalCandidate",void 0),N(this,"remoteSDP",void 0),N(this,"pendingCandidates",[]),N(this,"localCapabilities",void 0),N(this,"isReady",!1),N(this,"restartCnt",0),N(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.peerConnection=new RTCPeerConnection(Wp.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??ys.SEND_ONLY,this.name=this.direction===ys.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=Kk(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await wZ();if(this.localCapabilities=fS(n),e){const{sdp:r}=e,i=FDe(e,jDe),s=function(){const d={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},f=Rv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},v={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(oc(f,d,"videoExtensions",m,g,v),oc(f,d,"videoCodecs",m,g,v),oc(f,d,"audioExtensions",m,g,v),oc(f,d,"audioCodecs",m,g,v),j("RAISE_H264_BASELINE_PRIORITY")){const y=v.videoCodecs.findIndex(w=>w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&w.fmtp&&w.fmtp.parameters["profile-level-id"]==="42001f");if(y!==-1){const w=v.videoCodecs.findIndex(b=>b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(w<y){S.debug("raising H264 baseline profile priority");const b=v.videoCodecs[y];v.videoCodecs.splice(y,1),v.videoCodecs.splice(w,0,b)}w!==-1&&j("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(b=>!(b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&b.fmtp&&b.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:m,recv:g,sendrecv:v}}({},{},r);this.remoteSDP=new RG({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const a=od(o.sdp);await this.peerConnection.setLocalDescription(o);const A=await aG({},{},o.sdp);this.localCapabilities=fS(A);const u=this.peerConnection.getTransceivers()[0];return u!=null&&u.receiver&&u.receiver.transport&&this.tryBindTransportEvents(u.receiver.transport),Uu(Uu({},a),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=od(r.sdp);return this.initialOffer=r,Uu(Uu({},i),{},{sdp:r.sdp})}}catch(n){throw new ie(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=e,s=await aG({},{},n);this.remoteSDP=new RG({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new ie(L.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,r){var i=this;return Gc(function*(){const s=yield Rt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[],a=i.remoteSDP.receive(e,n,r);e.forEach((w,b)=>{if(a[b].needCreateTransceiver){const I=i.peerConnection.addTransceiver(w._mediaStreamTrack,{direction:"sendonly"});o.push(I),w._updateRtpTransceiver(I)}else{const I=i.peerConnection.getTransceivers().find(B=>B.mid===a[b].mid);if(!I)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a[b].mid));o.push(I),w._updateRtpTransceiver(I)}}),Vn()&&j("SIMULCAST")===!0&&(yield Rt(i.applySimulcastForFirefox(o,e)));const A=a.map(w=>w.mid),u=yield Rt(i.peerConnection.createOffer()),d=i.mungSendOfferSDP(u.sdp,e,A),f=Jr.parse(d),m=A.map(w=>{const b=f.mediaDescriptions.find(I=>I.attributes.mid===w);if(!b)throw new Error("Cannot extract ssrc from mediaDescription.");return _Z(b,j("USE_PUB_RTX"))}),g=o.map((w,b)=>{const I=A[b];return{localSSRC:m[b],id:I}});yield Rt(i.peerConnection.setLocalDescription({type:"offer",sdp:d}));try{yield g}catch(w){const b=i.remoteSDP.toString();throw yield Rt(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield Rt(i.peerConnection.setRemoteDescription({type:"answer",sdp:b})),yield Rt(i.stopSending(A,!0)),w}yield Rt(i.applySimulcastEncodings(o,e)),yield Rt(i.applySendEncodings(o,e));const v=i.remoteSDP.toString(),y=i.logSDPExchange(d,"offer","local","send");return y==null||y(v),yield Rt(i.setRemoteDescription({type:"answer",sdp:v})),o.map((w,b)=>{const I=A[b];return{localSSRC:m[b],id:I}})}catch(o){throw o instanceof ie?o:new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async stopSending(e,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(A=>e.indexOf(A.mid)!==-1);if(i.length!==e.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));i.map(A=>{var u;A.direction="inactive",(u=A.stop)===null||u===void 0||u.call(A)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const a=this.remoteSDP.toString();o==null||o(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(e,n,r,i);if(o){const A=this.remoteSDP.toString(),u=this.logSDPExchange(A,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:A});const d=await this.peerConnection.createAnswer(),f=this.mungReceiveAnswerSDP(d.sdp,s,e);u==null||u(f||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:f}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find(A=>A.mid===s);if(!a||a.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(s){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(e,n,r,i);if(o){const a=this.remoteSDP.toString(),A=this.logSDPExchange(a,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:a});const u=await this.peerConnection.createAnswer(),d=this.mungReceiveAnswerSDP(u.sdp,s,e);A==null||A(d||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:d}),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(s){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===Rh.Auto&&(this.store.p2pTransport=Rh.SdRtn,Ct().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Wp.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Ct().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Wp.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=od(n.sdp);return this.store.descriptionStart(),this.direction===ys.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===ys.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=od(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o==null||o(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ie(L.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(e,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===e);r.length===1&&(this.isVP8Simulcast(n)?Vn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:Uu(Uu({},VA),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:Uu(Uu({},VA),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;Te(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var s;return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Ub(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&i.iceServers.push(...Wp.turnServerConfigToIceServers(e.turnServer.servers,n,r)),j("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&i.iceServers.push(...Wp.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,r)),Te(s=[Rh.Relay,Rh.SdRtn]).call(s,n)&&(i.iceTransportPolicy="relay"),j("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&Ct().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),S.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],s=e.filter(a=>a.tcpport);S.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(r));const o=s.length>r?s[r]:s[0];switch(n){case Rh.SdRtn:const a=e.filter(u=>{var d;return Te(d=u.username).call(d,"glb:")&&u.turnServerURL==u.turnServerURL}),A=a.length>r?a[r]:a[0];A&&(i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turn:".concat(sm(A.turnServerURL),":").concat(A.tcpport,"?transport=udp")}),i.push({username:A.username,credential:A.password,credentialType:"password",urls:"turns:".concat(sm(A.turnServerURL),":").concat(A.tcpport,"?transport=tcp")}));break;case Rh.Relay:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(sm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(sm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return i}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var r;e!=null&&e.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,e.state))},e.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const r=e==null?void 0:e.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair();S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var r;if(n||(n=this.peerConnection.getSenders().find(d=>d.track===e._mediaStreamTrack)),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ct().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},s={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(e._encoderConfig){var o;const{bitrateMax:d,frameRate:f,scaleResolutionDownBy:m}=e._encoderConfig;d&&(s.maxBitrate=1e3*d),Te(o=e._hints).call(o,gn.LOW_STREAM)&&(f&&(s.maxFramerate=vo(f)),m&&m>=1&&(s.scaleResolutionDownBy=m))}if(j("DSCP_TYPE")&&Ud()){var a;const d=j("DSCP_TYPE");Te(a=["very-low","low","medium","high"]).call(a,d)&&(s.networkPriority=d)}const A=n.getParameters(),u=(r=A.encodings)===null||r===void 0?void 0:r[0];Vn()&&!u&&(i.encodings=[s]),u&&Object.assign(u,s),Object.assign(A,i),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(A.encodings))),await n.setParameters(A)}async applySendEncodings(e,n){try{if(!Ct().supportSetRtpSenderParameters||e.length!==n.length)return;for(let r=0;r<e.length;r++){const i=e[r],s=n[r];s instanceof dn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,r){const i=Jr.parse(e);return n.forEach((s,o)=>{const a=r[o],A=i.mediaDescriptions.find(u=>u.attributes.mid===a);A&&(Zm(A,s),yZ(A,s,this.store.codec))}),Jr.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let A=0;A<e.length;A++){var r,i,s,o,a;const u=e[A],d=n[A];if(d instanceof dn&&!Te(r=d._hints).call(r,gn.LOW_STREAM)&&(i=d._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=d._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=d._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=d._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,f))}}}async applySimulcastEncodings(e,n){if(!Vn()&&e.length===n.length)for(let r=0;r<e.length;r++){const i=n[r];if(i instanceof dn&&this.isVP8Simulcast(i)){const s=e[r],o={},a={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];const A=s.sender.getParameters();await s.sender.setParameters(Object.assign(A,o))}}}isVP8Simulcast(e){var n,r,i,s,o;return!!(e instanceof dn&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Te(n=e._hints).call(n,gn.LOW_STREAM)&&(r=e._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=e._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=e._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,n,r,i){if(j("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();i==null||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async o=>{o.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(e);const s=this.remoteSDP.toString();i==null||i(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var r,i;if(n=(r=n)!==null&&r!==void 0?r:(i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp){var s;const o=(s=Jr.parse(n).mediaDescriptions.find(a=>a.attributes.mid===e))===null||s===void 0?void 0:s.attributes.ssrcs;return o==null?void 0:o[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),Te(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,r){const i=Jr.parse(e),s=i.mediaDescriptions.find(o=>o.attributes.mid===n);return s&&r===Ue.AUDIO&&s.media.mediaType==="audio"&&eg(s),Jr.print(i)}},Oe(sn.prototype,"establish",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"establish"),sn.prototype),Oe(sn.prototype,"connect",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"connect"),sn.prototype),Oe(sn.prototype,"receive",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"receive"),sn.prototype),Oe(sn.prototype,"mockReceive",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"mockReceive"),sn.prototype),Oe(sn.prototype,"stopReceiving",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"stopReceiving"),sn.prototype),Oe(sn.prototype,"restartICE",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"restartICE"),sn.prototype),Oe(sn.prototype,"close",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"close"),sn.prototype),Oe(sn.prototype,"updateEncoderConfig",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"updateEncoderConfig"),sn.prototype),Oe(sn.prototype,"updateSendParameters",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"updateSendParameters"),sn.prototype),Oe(sn.prototype,"replaceTrack",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"replaceTrack"),sn.prototype),Oe(sn.prototype,"muteLocal",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"muteLocal"),sn.prototype),Oe(sn.prototype,"unmuteLocal",[Ga],Object.getOwnPropertyDescriptor(sn.prototype,"unmuteLocal"),sn.prototype),sn);function Ga(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(e));try{for(var o=arguments.length,a=new Array(o),A=0;A<o;A++)a[A]=arguments[A];return await r.apply(this,a)}finally{s()}},n}function hU(t,e){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=vo(e.width),r.height=vo(e.height);const i=vo(e.framerate||15);document.body.append(n),document.body.append(r);let s=t._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const o=r.getContext("2d");if(!o)throw new te(L.UNEXPECTED_ERROR,"can not get canvas context");const a=Ct(),A=r.captureStream(a.supportRequestFrame?0:i).getVideoTracks()[0];A.canvas||(A.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const d=n.videoWidth,f=n.videoHeight/d,m=r.width*f;Math.abs(m-r.height)>=2&&(S.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(m)),r.height=m)}o.drawImage(n,0,0,r.width,r.height),A.requestFrame&&A.requestFrame(),s!==t._mediaStreamTrack&&(s=t._mediaStreamTrack,n.srcObject=new MediaStream([s]))},r.stopCapture=Lk(()=>r.startCapture&&r.startCapture(),i);const u=A.stop;return A.stop=()=>{u.call(A),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),S.debug("clean low stream renderer")},A}var ZT=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(ZT||{}),Ur=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t}(Ur||{}),Nh=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(Nh||{}),Hi=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t}(Hi||{}),Dh=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(Dh||{}),UZ=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(UZ||{}),Vu=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t}(Vu||{}),qa=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t}(qa||{}),PZ=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(PZ||{}),ga=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t}(ga||{});const yl=1e3,yh=3;function ot(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function DG(t){const e={[ga.CONN_TYPE]:0,[ga.RTT]:t.rtt};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[ga.CONN_TYPE]=1),n==="tcp"&&(e[ga.CONN_TYPE]=3),n==="tls"&&(e[ga.CONN_TYPE]=4);break}case"srflx":e[ga.CONN_TYPE]=2}return e}function BG(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class kZ extends Ln{constructor(e){super(),N(this,"store",void 0),N(this,"uploadWRTCStatsTimer",void 0),N(this,"uploadOutboundDenoiserStatsTimer",void 0),N(this,"uploadExtStatsTimer",void 0),N(this,"uploadExtUsageStatsTimer",void 0),N(this,"uploadInboundExtStatsTimer",void 0),N(this,"requestStats",void 0),N(this,"requestTransportStats",void 0),N(this,"requestLocalMedia",void 0),N(this,"requestRemoteMedia",void 0),N(this,"requestAllTracks",void 0),N(this,"requestVideoIsReady",void 0),N(this,"requestUploadStats",void 0),N(this,"requestUpload",void 0),N(this,"uploadOutboundStarted",!1),N(this,"uploadInboundStarted",!1),N(this,"uploadTransportStarted",!1),N(this,"uploadExtensionUsageStarted",!1),N(this,"lastRecvStats",void 0),N(this,"lastSendStats",void 0),N(this,"lastFullRecvStats",void 0),N(this,"lastFullSendStats",void 0),N(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let n,r;if(this.uploadTransportStarted&&(n=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!n&&this.uploadOutboundStarted&&(n=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),n||r){const i={};if(this.uploadTransportStarted&&n){const s=this.getTransportStats(n,r,e);s&&(i.misc=[s])}if(this.uploadOutboundStarted&&n){const s=this.getOutboundStats(n,e?this.lastSendStats:this.lastFullSendStats,e);s&&(i.outbound=[s])}if(this.uploadInboundStarted&&r){const s=this.getInboundStats(r,e?this.lastRecvStats:this.lastFullRecvStats,e);s&&(i.inbound=s)}this.requestUploadStats(i)}this.lastRecvStats=r,this.lastSendStats=n,e||(this.lastFullRecvStats=r,this.lastFullSendStats=n)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==yh),++e===yh+1&&(e=1)},yl)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,r){if(!this.requestStats)return;if(r)return e.rtt==null?void 0:{addition:{[ga.RTT]:e.rtt,[ga.CONN_TYPE]:void 0}};const i=DG(e);if(this.store.useP2P){if(n){const s=DG(n);i[ga.CONN_TYPE]+=s[ga.CONN_TYPE]<<3}i[ga.CONN_TYPE]+=110}else i[ga.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(e,n,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i=this.requestLocalMedia();if(!i||i.length===0)return;let s,o,a;return i.forEach(A=>{let[u,{track:d,ssrcs:f}]=A;switch(u){case Ae.LocalVideoLowTrack:case Ae.LocalVideoTrack:if(u===Ae.LocalVideoTrack){const m=function(y,w,b,I,B){const M=w.videoSend.find(G=>G.ssrc===y);if(!M)return;const H={},{sentFrame:K,inputFrame:Q}=M;if(Q&&K){const G=Q.frameRate,$=K.frameRate;H[Ur.FREEZE]=function(ne,q){let qe=!0;return qe=!(ne<=5)&&(ne<=10?q<3:ne<=20?q<4:q<5),qe}(G,$)?1:0}if(ot(H,Ur.QP_SUM,M.qpSumPerFrame),B)return H;switch(K&&(ot(H,Ur.HEIGHT,K.height),ot(H,Ur.WIDTH,K.width),ot(H,Ur.FRAME_RATE,K.frameRate)),H[Ur.DISABLED]=I._originMediaStreamTrack&&!I._originMediaStreamTrack.enabled||I._mediaStreamTrack&&!I._mediaStreamTrack.enabled?1:0,M.adaptionChangeReason){case"none":H[Ur.ADAPTATION]=0;break;case"cpu":H[Ur.ADAPTATION]=1;break;case"bandwidth":H[Ur.ADAPTATION]=2;break;case"other":H[Ur.ADAPTATION]=3}let F=0;M.adaptionChangeReason&&(F+=BG(M.adaptionChangeReason)),w.qualityLimitationReason&&(F+=BG(w.qualityLimitationReason)<<3),H[Ur.ADAPTATION]=F,H[Ur.PLAYER_STATUS]=dD[I._player?I._player.videoElementStatus:"uninit"],ot(H,Ur.NACKS,M.nacksCount),ot(H,Ur.PLIS,M.plisCount),ot(H,Ur.FIRS,M.firsCount),ot(H,Ur.AVG_ENCODE,M.avgEncodeMs);const k=b&&b.videoSend.find(G=>G.ssrc===y);if(k){let G=B?yl:yl*yh;k.timestamp&&M.timestamp&&(G=M.timestamp-k.timestamp),k.packets!=null&&M.packets!=null&&ot(H,Ur.PACKAGE_RATE,1e3*(M.packets-k.packets)/G),M.packetsLost!=null&&k.packetsLost!=null&&ot(H,Ur.PACKAGE_LOST,M.packetsLost-k.packetsLost),k.bytes!=null&&M.bytes!=null&&ot(H,Ur.BITRATE,8*(M.bytes-k.bytes)/G)}return H}(f[0].ssrcId,e,n,d,r),g=r?null:function(y,w,b){const I=w.videoSend.find(F=>F.ssrc===y);if(!I)return null;const B={},M=I.inputFrame,H=M&&M.height||b&&b.videoHeight||0,K=M&&M.width||b&&b.videoWidth||0,Q=M&&M.frameRate||0;return ot(B,ZT.HEIGHT,H),ot(B,ZT.WIDTH,K),ot(B,ZT.FRAME_RATE,Q),B}(f[0].ssrcId,e,d),v=r?null:function(y){const w={};return ot(w,Ur.RETRANSMIT,y.bitrate.retransmit),ot(w,Ur.TARGET_ENCODED,y.bitrate.targetEncoded),ot(w,Ur.ACTUAL_ENCODED,y.bitrate.actualEncoded),ot(w,Ur.TRANSMIT,y.bitrate.transmit),ot(w,Ur.BANDWIDTH,y.sendBandwidth),w}(e);o=Object.assign({},m,g,v)}else a=r?void 0:function(m,g,v){const y=g.videoSend.find(I=>I.ssrc===m);if(!y)return;const w={},b=y.sentFrame;if(b&&(ot(w,Nh.HEIGHT,b.height),ot(w,Nh.WIDTH,b.width),ot(w,Nh.FRAME_RATE,b.frameRate)),v){const I=v.videoSend.find(B=>B.ssrc===m);if(I){let B=yl*yh;I.timestamp&&y.timestamp&&(B=y.timestamp-I.timestamp),I.packets!=null&&y.packets!=null&&ot(w,Nh.PACKAGE_RATE,1e3*(y.packets-I.packets)/B),y.packetsLost!=null&&I.packetsLost!=null&&ot(w,Nh.PACKAGE_LOST,y.packetsLost-I.packetsLost),I.bytes!=null&&y.bytes!=null&&ot(w,Nh.BITRATE,8*(y.bytes-I.bytes)/B)}}return w}(f[0].ssrcId,e,n);break;case Ae.LocalAudioTrack:s=r?void 0:function(m,g,v,y){const w=g.audioSend.find(H=>H.ssrc===m);if(!w)return;const b={};b[Vu.DISABLED]=y._originMediaStreamTrack&&!y._originMediaStreamTrack.enabled||y._mediaStreamTrack&&!y._mediaStreamTrack.enabled?1:0;const I=100*y._source.getAccurateVolumeLevel(),B=w.inputLevel;if(B!=null){const H=Math.ceil(50*Math.log10(100*B+1));ot(b,Vu.LEVEL,H)}ot(b,UZ.PCM_LEVEL,I),ot(b,Vu.AEC_RETURN_LOSS,w.aecReturnLoss),ot(b,Vu.AEC_RETURN_LOSS_ENH,w.aecReturnLossEnhancement),b[Vu.FREEZE]=0;const M=v&&v.audioSend.find(H=>H.ssrc===m);if(M){let H=yl*yh;M.timestamp&&w.timestamp&&(H=w.timestamp-M.timestamp),M.bytes!=null&&w.bytes!=null&&ot(b,Vu.BITRATE,8*(w.bytes-M.bytes)/H),M.packets!=null&&w.packets!=null&&ot(b,Vu.PACKAGE_RATE,1e3*(w.packets-M.packets)/H)}return b}(f[0].ssrcId,e,n,d)}}),{high:o,low:a,audio:s}}getInboundStats(e,n,r){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],s=[];return i.forEach(o=>{let[a,A]=o;const u={peer:a.uid};if(A.has(Ue.VIDEO)&&a.videoTrack){const d=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,f=a.videoTrack?function(m,g,v,y,w,b,I){var B;const M=g.videoRecv.find($=>$.ssrc===m);if(!M)return;const H={},{receivedFrame:K,outputFrame:Q,decodeFrameRate:F}=M,k=v&&v.videoRecv.find($=>$.ssrc===m);if(H[Hi.FREEZE]=w&&Bv.isRemoteVideoFreeze(y,M,k)?1:0,ot(H,Dh.FRAME_RATE_DECODE,F),ot(H,Hi.QP_SUM,M.qpSumPerFrame),M.framesRateFirefox&&ot(H,Hi.FRAME_RATE,M.framesRateFirefox),K&&ot(H,Hi.FRAME_RATE,K.frameRate),k){const $=g.timestamp-v.timestamp||(I?yl:yh*yl);M.packetsLost!=null&&k.packetsLost!=null&&ot(H,Hi.PACKAGE_LOST,M.packetsLost-k.packetsLost),k.bytes!=null&&M.bytes!=null&&ot(H,Hi.BITRATE,8*(M.bytes-k.bytes)/$),k.packets!=null&&M.packets!=null&&ot(H,Hi.PACKAGE_RATE,1e3*(M.packets-k.packets)/$)}if(I)return H;K?(ot(H,Hi.HEIGHT,K.height),ot(H,Hi.WIDTH,K.width)):y&&(ot(H,Hi.HEIGHT,y._videoHeight||0),ot(H,Hi.WIDTH,y._videoWidth||0)),Q&&ot(H,Dh.FRAME_RATE_OUTPUT,Q.frameRate);const G=(B=y._player)===null||B===void 0?void 0:B.rendFrameRate.toFixed(0);if(G&&ot(H,Dh.FRAME_RATE_RENDER,+G),ot(H,Hi.JITTER_BUFFER,M.jitterBufferMs),ot(H,Hi.CURRENT_DELAY,M.currentDelayMs),ot(H,Hi.FIRS,M.firsCount),ot(H,Hi.NACKS,M.nacksCount),ot(H,Hi.PLIS,M.plisCount),y){H[Hi.DISABLED]=y._originMediaStreamTrack.enabled&&y._mediaStreamTrack.enabled?0:1;const $=y._player;if($){const{freezeTimeCounterList:ne,renderFreezeAccTime:q,videoElementStatus:qe}=$;if(ne&&ne.length>0&&ot(H,Dh.FREEZE_TIME,ne.splice(0,1)[0]),b&&Rl.visibility==="visible"&&qe===ns.PLAYING&&Ct().supportRequestVideoFrameCallback){const je=Math.min(6e3,q);$.renderFreezeAccTime=Math.max(0,q-je),ot(H,Dh.FREEZE_TIME_RENDER,je)}if(typeof M.totalFreezesDuration=="number"){const je=k&&k.totalFreezesDuration?M.totalFreezesDuration-k.totalFreezesDuration:M.totalFreezesDuration;ot(H,Dh.FREEZE_DURATION,1e3*je)}}}if(H[Hi.PLAYER_STATUS]=dD[y._player?y._player.videoElementStatus:"uninit"],k&&M.totalInterFrameDelay!==void 0&&M.totalSquaredInterFrameDelay!==void 0&&k.totalInterFrameDelay!==void 0&&k.totalSquaredInterFrameDelay!==void 0){const $=M.totalInterFrameDelay-k.totalInterFrameDelay,ne=M.totalSquaredInterFrameDelay-k.totalSquaredInterFrameDelay,q=M.framesDecodeCount-k.framesDecodeCount,qe=$/q*1e3,je=Math.round(1e3*Math.sqrt((ne-Math.pow($,2)/q)/q));!isNaN(je)&&qe+je>Math.max(3*qe,qe+150)&&(H[Hi.I_FRAME_DELAY]=je)}return H}(a._videoSSRC,e,n,a.videoTrack,d===!0,this.needUploadRenderFreezeTime,r):void 0;f&&(u.video=f)}if(A.has(Ue.AUDIO)&&a.audioTrack){const d=a.audioTrack?function(f,m,g,v,y){const w=m.audioRecv.find(k=>k.ssrc===f);if(!w)return;const b={},I=g&&g.audioRecv.find(k=>k.ssrc===f),{receivedFrames:B,droppedFrames:M}=w;var H,K;if(ot(b,qa.JITTER,w.jitterMs),B!=null&&M!=null&&(b[qa.FREEZE]=(K=M,(H=B)===0||100*K/H>20?1:0)),I){const k=m.timestamp-g.timestamp||(y?yl:yl*yh);w.packets!=null&&I.packets!=null&&ot(b,qa.PACKAGE_RATE,1e3*(w.packets-I.packets)/k),I.bytes!=null&&w.bytes!=null&&ot(b,qa.BITRATE,8*(w.bytes-I.bytes)/k),w.packetsLost!=null&&I.packetsLost!=null&&ot(b,qa.PACKAGE_LOST,w.packetsLost-I.packetsLost)}if(y)return b;const Q=100*v._source.getAccurateVolumeLevel(),F=w.outputLevel;if(F!=null){const k=Math.ceil(50*Math.log10(100*F+1));ot(b,PZ.LEVEL,k)}if(ot(b,qa.PCM_LEVEL,Q),v&&(b[qa.DISABLED]=v._originMediaStreamTrack.enabled&&v._mediaStreamTrack.enabled?0:1),ot(b,qa.JITTER_BUFFER,w.jitterBufferMs),ot(b,qa.CURRENT_DELAY,w.jitterBufferMs),b[qa.PLAYER_STATUS]=dD[Ms.getPlayerState(v.getTrackId())],I){const k=w.concealedSamples-I.concealedSamples;k>0&&ot(b,qa.CONCEALED_SAMPLES,k)}return b}(a._audioSSRC,e,n,a.audioTrack,r):void 0;d&&(u.audio=d)}(u.video||u.audio)&&s.push(u)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,s}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof dS);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(Tv.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,r]=e;r.has(Ue.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(Ue.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const s=this.requestAllTracks&&this.requestAllTracks()||[];for(const u of s)!u.muted&&u.enabled&&(i=i.concat(await u.getProcessorUsage()));const o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[u,d]of o)d.has(Ue.VIDEO)&&u.videoTrack&&(i=i.concat(await u.videoTrack.getProcessorUsage())),d.has(Ue.AUDIO)&&u.audioTrack&&(i=i.concat(await u.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(u,d){const f={};for(const{id:y,value:w,level:b,direction:I}of u){var m;const B=(m=d.get(y))!==null&&m!==void 0?m:0,M=w===2?B+j("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:B;var g,v;d.set(y,M),f[y]?(w===2&&(f[y].value=w),b>f[y].level&&(f[y].level=b),I==="remote"&&(f[y].remoteUidCount+=1),f[y].totalTs=(g=d.get(y))!==null&&g!==void 0?g:0):f[y]={value:w,level:b,remoteUidCount:I==="local"?0:1,totalTs:(v=d.get(y))!==null&&v!==void 0?v:0}}return Object.keys(f).map(y=>{const{level:w,value:b,totalTs:I}=f[y];return{id:y,level:w,value:b,totalTs:I}})}(i,e);const a=Date.now(),A=a>n?a:n+1;this.requestUpload&&this.requestUpload(Tv.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:A})},j("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class Ju{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){N(this,"uid",void 0),N(this,"_uintid",void 0),N(this,"_trust_in_room_",!0),N(this,"_trust_audio_enabled_state_",!0),N(this,"_trust_video_enabled_state_",!0),N(this,"_trust_audio_mute_state_",!0),N(this,"_trust_video_mute_state_",!0),N(this,"_audio_muted_",!1),N(this,"_video_muted_",!1),N(this,"_audio_enabled_",!0),N(this,"_video_enabled_",!0),N(this,"_audio_added_",!1),N(this,"_video_added_",!1),N(this,"_is_pre_created",!1),N(this,"_video_pre_subscribed",!1),N(this,"_audio_pre_subscribed",!1),N(this,"_trust_video_stream_added_state_",!0),N(this,"_trust_audio_stream_added_state_",!0),N(this,"_audioTrack",void 0),N(this,"_videoTrack",void 0),N(this,"_dataChannels",[]),N(this,"_audioSSRC",void 0),N(this,"_videoSSRC",void 0),N(this,"_audioOrtc",void 0),N(this,"_videoOrtc",void 0),N(this,"_cname",void 0),N(this,"_rtxSsrcId",void 0),N(this,"_videoMid",void 0),N(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}let xc=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});function KDe(t,e){var n;let r;switch(e){case Ae.LocalAudioTrack:r=Lt.Audio;break;case Ae.LocalVideoTrack:r=Te(n=t._hints).call(n,gn.SCREEN_TRACK)?Lt.Screen:Lt.High;break;case Ae.LocalVideoLowTrack:r=Lt.Low}return r}function fU(t){const e=Ct();if(t.some(n=>n._bypassWebAudio))throw new ie(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new ie(L.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function CD(t,e){fU(t);const n=new yr;return t.forEach(r=>n.addAudioTrack(r)),n}var LG,UG,PG,kG,xG,MG,FG,VG,QG,HG,jG,En;function KG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function xC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?KG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let ho=(LG=Bc(xc.SEND_ONLY),UG=Bc(xc.SEND_ONLY),PG=Bc(),kG=Bc(xc.RECEIVE_ONLY),xG=Bc(xc.RECEIVE_ONLY),MG=Bc(xc.RECEIVE_ONLY),FG=Bc(xc.RECEIVE_ONLY),VG=Bc(xc.RECEIVE_ONLY),QG=Bc(xc.RECEIVE_ONLY),HG=Bc(),jG=Bc(xc.RECEIVE_ONLY),En=class extends Ln{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Qe.StateChange,e,this._state)}constructor(t,e){super(),N(this,"isPlanB",!1),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"sendConnection",void 0),N(this,"recvConnection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"statsCollector",void 0),N(this,"dtlsFailedCount",0),N(this,"sendMutex",new Pi("P2PChannel2-send-mutex")),N(this,"recvMutex",new Pi("P2PChannel2-recv-mutex")),N(this,"_state",Bt.Disconnected),N(this,"_restartStates",["disconnected","failed"]),N(this,"reconnectInterval",void 0),N(this,"uploadUnplinkStarted",!1),N(this,"uploadDownlinkStarted",!1),N(this,"uplinkStateUploadInterval",void 0),N(this,"downlinkStatsUploadInterval",void 0),N(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Bt.Connected)return void i(new ie(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const A=this.filterTobeMutedTracks(n);if(A.length===0)return void r();const u=A.find(g=>g[0]==="videoLowTrack");u&&u[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(A.map(g=>{let[,{id:v}]=g;return v}));let d=!1;var o,a;n.trackMediaType==="video"?d=!((o=this.localTrackMap.get(Ae.LocalAudioTrack))===null||o===void 0||!o.track._muted):d=((a=this.localTrackMap.get(Ae.LocalVideoTrack))===null||a===void 0?void 0:a.id)===void 0;const f=this.createMuteMessage(A);await Yt(this,Qe.RequestMuteLocal,f);const m=n.trackMediaType==="video"?id.MUTE_LOCAL_VIDEO:id.MUTE_LOCAL_AUDIO;await Yt(this,Qe.RequestP2PMuteLocal,{action:m,message:f,isMuteAll:d}),r()}catch(A){i(A)}finally{s()}}),N(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Bt.Connected)return void i(new ie(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();await this.sendConnection.unmuteLocal(o.map(u=>{let[,{id:d}]=u;return d}));const a=this.createUnmuteMessage(o),A=n.trackMediaType==="video"?id.UNMUTE_LOCAL_VIDEO:id.UNMUTE_LOCAL_AUDIO;await Yt(this,Qe.RequestP2PMuteLocal,{action:A,message:a}),r()}catch(o){i(o)}finally{s()}}),N(this,"handleUpdateVideoEncoder",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const o=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==Bt.Connected)return void r();const{id:a,track:A}=o;a&&(await this.sendConnection.updateSendParameters(a,A),await this.sendConnection.updateEncoderConfig(a,A),this.emit(Qe.UpdateVideoEncoder,A)),r()}catch(o){i(o)}finally{s()}}),N(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==n||this.state!==Bt.Connected)return void r();const{id:a,track:A}=o;a&&await this.sendConnection.updateSendParameters(a,A),r()}catch(o){i(o)}finally{s()}}),N(this,"handleReplaceTrack",async(n,r,i,s)=>{let o;S.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var a;const u=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:f}]=d;return n===f});if(!this.sendConnection||!u||u[1].id===void 0||this.state!==Bt.Connected)return void r();if(await((a=this.sendConnection)===null||a===void 0?void 0:a.replaceTrack(n,u[1].id)),u[0]===Ae.LocalVideoTrack&&Ct().supportDualStreamEncoding){const d=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(d){const f=n._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=f,d.track._originMediaStreamTrack=f,await new ye((m,g)=>{this.handleReplaceTrack(d.track,m,g,!0)})}}r()}catch(u){i(u)}finally{var A;(A=o)===null||A===void 0||A()}}),N(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),N(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new kZ(t),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},j("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new ie(L.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new ie(L.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new NG(t,this.store,ys.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(e);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=Bt.New,this.sendConnection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new NG(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new ie(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bt.Connected}async addRemoteCandidate(t,e){if(e===ys.RECEIVE_ONLY){if(!this.sendConnection)throw new ie(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new ie(L.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var r=this;return Gc(function*(){const i=yield Rt(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==Bt.Connected){r.throwIfTrackTypeNotMatch(t);const u=t.filter(d=>r.pendingLocalTracks.indexOf(d)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(u))}r.store.pubId=r.store.pubId+1,Ui.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(t,e,n);if(s.length===0)return void(yield Rt(r.tryToUnmuteAudio(t)));s.forEach(u=>{let{track:d,type:f}=u;const m=Date.now();r.store.publish(d.getTrackId(),f===Ae.LocalAudioTrack?"audio":"video",m)}),r.bindLocalTrackEvents(s);const o=yield Rt(r.sendConnection.send(s.map(u=>{let{track:d}=u;return d}),r.store.codec,r.store.audioCodec)),a=(yield Rt(o.next())).value,A=r.createGatewayPublishMessage(s,a);try{yield A}catch(u){throw o.throw(u),(u==null?void 0:u.code)===L.WS_ABORT&&s.forEach(d=>{let{track:f}=d;r.pendingLocalTracks.indexOf(f)===-1&&r.pendingLocalTracks.push(f)}),r.unbindLocalTrackEvents(s),u}yield Rt(o.next()),s.forEach(u=>{let{type:d}=u;r.statsCollector.addLocalStats(d)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(s,a),s.forEach(u=>{let{track:d,type:f}=u;const m=Date.now();r.store.publish(d.getTrackId(),f===Ae.LocalAudioTrack?"audio":"video",void 0,m)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(t){if(!this.sendConnection||this.state!==Bt.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!Te(t).call(t,i)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[s,{track:o}]=i;return{type:s,track:o}})),e.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Bt.Connected)return n&&n[1].track.close(),r;t.forEach(i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:s,ssrcs:o}]=r;const a={stream_type:KDe(s,i),ssrcs:o};s._muted||!s._enabled?e.push(a):n.push(a)}),e.length>0&&e.forEach(r=>{Yt(this,Qe.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{Yt(this,Qe.RequestUnmuteLocal,[r])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Gc(function*(){throw new ie(L.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await fi(this,Qe.RequestRePublish,this.pendingLocalTracks),this.emit(Qe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new ie(L.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,r){var i;if(!this.recvConnection)throw new ie(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(t))!==null&&i!==void 0&&i.has(e))return;const{track:s,mid:o,transceiver:a}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),r);e===Ue.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new Cm(s,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),a&&t._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new wm(s,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),a&&t._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(t,t._videoTrack));const A=this.remoteUserMap.get(t);A?A.set(e,o):this.remoteUserMap.set(t,new Map([[e,o]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const u=this.pendingRemoteTracks.findIndex(d=>{let{user:f,kind:m}=d;return f.uid===t.uid&&e===m});u!==-1&&(this.pendingRemoteTracks.splice(u,1),this.emit(Qe.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,r){if(!this.recvConnection)throw new ie(L.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),r)}async unsubscribe(t,e,n){const r=this.pendingRemoteTracks.filter(s=>{let{user:o,kind:a}=s;return e!==void 0?o.uid===t.uid&&e===a:o.uid===t.uid});if(r.forEach(s=>{const o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)}),this.recvConnection||n||r.forEach(s=>{let{kind:o}=s;var a;if(o===Ue.AUDIO)(a=t._audioTrack)===null||a===void 0||a._destroy(),t._audioTrack=void 0;else if(o===Ue.VIDEO){var A;(A=t._videoTrack)===null||A===void 0||A._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(t,e);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(s=>{let[,{id:o}]=s;return o})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(s=>{let[o,{kind:a}]=s;var A,u;if(a===Ue.VIDEO&&o._videoSSRC&&((A=this.recvConnection)===null||A===void 0||A.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),a===Ue.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),n||((u=o._videoTrack)===null||u===void 0||u._destroy(),o._videoTrack=void 0);else if(a===Ue.AUDIO){var d;this.unbindRemoteTrackEvents(o._audioTrack),!n&&((d=o._audioTrack)===null||d===void 0||d._destroy(),o._audioTrack=void 0)}}),i.forEach(s=>{let[,{kind:o}]=s;Yt(this,Qe.RequestP2PMuteRemote,o)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[Ue.VIDEO,Ue.AUDIO].forEach(r=>{n.has(r)?Yt(this,Qe.RequestP2PUnmuteRemote,r):Yt(this,Qe.RequestP2PMuteRemote,r)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new ie(L.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new ie(L.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new ie(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new ie(L.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const r=e===Ue.VIDEO?t._videoSSRC:t._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||S.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(Ae.LocalAudioTrack);if((e==null?void 0:e.track)instanceof yr){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==Ae.LocalAudioTrack}).filter(r=>{let[i]=r;return!(t&&i===Ae.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(t&&r===Ae.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(t,e,n,r,i){if(t){const o=this.localTrackMap.get(Ae.LocalAudioTrack),a=r?this.localTrackMap.get(Ae.LocalVideoLowTrack):this.localTrackMap.get(Ae.LocalVideoTrack);Le.publish(this.store.sessionId,{eventElapse:Ui.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:o==null?void 0:o.track.getTrackLabel(),videoName:a==null?void 0:a.track.getTrackLabel(),screenshare:(a==null?void 0:a.track._hints.indexOf(gn.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find(A=>A instanceof xn),a=r?(s=this.localTrackMap.get(Ae.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(A=>A instanceof dn);Le.publish(this.store.sessionId,{eventElapse:Ui.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:o==null?void 0:o.getTrackLabel(),videoName:a==null?void 0:a.getTrackLabel(),screenshare:(a==null?void 0:a._hints.indexOf(gn.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(t,e,n,r){const i=r===Ue.VIDEO?n._videoSSRC:n._audioSSRC;i&&Le.subscribe(this.store.sessionId,{succ:t,ec:e,video:r===Ue.VIDEO,audio:r===Ue.AUDIO,peerid:n.uid,subscribeRequestid:r===Ue.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ui.measureFromSubscribeStart(this.store.clientId,i)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Pi("P2PChannel2-send-mutex"),this.sendMutex=new Pi("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ae.LocalAudioTrack);if((t==null?void 0:t.track)instanceof yr){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Bt.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ae.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ae.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof dn||e&&e.track instanceof xn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(Mo(e=this.remoteUserMap).call(e)).find(r=>r.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(Ae.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=yy(t).call(t,(n,r)=>n.level-r.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Bt.Reconnecting,j("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:r}]=t;switch(n){case Ae.LocalVideoTrack:Te(e=r._hints).call(e,gn.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Ae.LocalAudioTrack:r instanceof yr?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Ae.LocalVideoLowTrack:}}),this.emit(Qe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Mo(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(e,r)}),this.emit(Qe.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((t instanceof Ju?t.uid:t)===r.uid&&e===i)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,r;if(t===ys.SEND_ONLY){if(!this.sendConnection)throw new ie(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new ie(L.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(e){const i=await r.restartICE(e);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const s=await fi(this,Qe.RequestP2PRestartICE,{direction:ys.RECEIVE_ONLY,iceParameter:i});await r.restartICE(s),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(Ae.LocalVideoTrack),n=this.localTrackMap.get(Ae.LocalAudioTrack),r=t.videoSend.find(g=>{var v;return g.ssrc===(e==null||(v=e.ssrcs)===null||v===void 0?void 0:v[0].ssrcId)}),i=t.audioSend.find(g=>{var v;return g.ssrc===(n==null||(v=n.ssrcs)===null||v===void 0?void 0:v[0].ssrcId)});if(!r||!i)return 1;const s=va(this,Qe.NeedSignalRTT),o=r?r.rttMs:void 0,a=i?i.rttMs:void 0,A=o&&a?(o+a)/2:o||a,u=(A&&s?(A+s)/2:A||s)||0,d=100*t.sendPacketLossRate*.7/50+.3*u/1500,f=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,m=e==null?void 0:e.track;if(m&&m._encoderConfig&&m._hints.indexOf(gn.SCREEN_TRACK)===-1){const g=m._encoderConfig.bitrateMax,v=t.bitrate.actualEncoded;if(g&&v){const y=(1e3*g-v)/(1e3*g);return D$[y<.15?0:y<.3?1:y<.45?2:y<.6?3:4][f]}}return f}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=t.audioRecv.find(v=>v.ssrc===i),a=t.videoRecv.find(v=>v.ssrc===s);if(!o&&!a)return void(e+=1);const A=va(this,Qe.NeedSignalRTT),u=t.rtt,d=(u&&A?(u+A)/2:u||A)||0,f=o?o.jitterMs:void 0,m=t.recvPacketLossRate;let g=.7*m*100/50+.3*d/1500;f&&(g=.6*m*100/50+.2*d/1500+.2*f/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new ye((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const r=[],i=Ct(),s=this.getAllTracks();t=rm(t=t.filter(A=>s.indexOf(A)===-1));let o=!1,a=!1;for(const A of t){if(A instanceof dn&&(this.localTrackMap.has(Ae.LocalVideoTrack)||o?new ie(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:A,type:Ae.LocalVideoTrack}),o=!0),e)){const u=this.getLowVideoTrack(A,n);r.push({track:u,type:Ae.LocalVideoLowTrack})}if(A instanceof xn){const u=this.localTrackMap.get(Ae.LocalAudioTrack);if(u){if(!(u.track instanceof yr))throw new ie(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(A._bypassWebAudio)throw new ie(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");u.track.addAudioTrack(A),this.bindLocalAudioTrackEvents(A,!0)}else if(a){const d=r.find(f=>{let{type:m}=f;return m===Ae.LocalAudioTrack});if(!(d.track instanceof yr))throw new ie(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(A._bypassWebAudio)throw new ie(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");d.track.addAudioTrack(A)}else{if(!i.webAudioMediaStreamDest||A instanceof yr||A._bypassWebAudio)r.push({track:A,type:Ae.LocalAudioTrack});else{const d=new yr;d.addAudioTrack(A),r.push({track:d,type:Ae.LocalAudioTrack})}a=!0}}}return r}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=rm(t=t.filter(r=>n.indexOf(r)!==-1));for(const r of t){if(r instanceof xn){const i=this.localTrackMap.get(Ae.LocalAudioTrack);if(!i)continue;i.track instanceof yr?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(e.push([Ae.LocalAudioTrack,i]),i.track.close())):e.push([Ae.LocalAudioTrack,i])}if(r instanceof dn){const i=this.localTrackMap.get(Ae.LocalVideoTrack);if(!i)continue;e.push([Ae.LocalVideoTrack,i]);const s=this.localTrackMap.get(Ae.LocalVideoLowTrack);s&&e.push([Ae.LocalVideoLowTrack,s])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:r}=e;switch(r){case Ae.LocalVideoTrack:n.addListener(Se.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Se.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Se.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Ae.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof yr?t.trackList.forEach(n=>{n.addListener(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Se.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Se.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:r}]=e;return{track:r,type:n}})),t.forEach(e=>{let{track:n,type:r}=e;switch(r){case Ae.LocalVideoTrack:n.off(Se.GET_STATS,this.handleGetLocalVideoStats),n.off(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Se.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Se.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Ae.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof yr?t.trackList.forEach(e=>{e.off(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Se.GET_STATS,this.handleGetLocalAudioStats),e.off(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Se.GET_STATS,this.handleGetLocalAudioStats),t.off(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof wm&&e.addListener(Se.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Cm&&e.addListener(Se.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Se.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(Ue.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(Ue.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,r)=>{var i;let s,{track:o,type:a}=n;switch(a){case Ae.LocalAudioTrack:s=Lt.Audio;break;case Ae.LocalVideoTrack:s=Te(i=o._hints).call(i,gn.SCREEN_TRACK)?Lt.Screen:Lt.High;break;case Ae.LocalVideoLowTrack:s=Lt.Low}return{kind:a===Ae.LocalAudioTrack?Ue.AUDIO:Ue.VIDEO,stream_type:s,mid:e[r].id,ssrcs:e[r].localSSRC,isMuted:o.muted||!o.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case Ae.LocalVideoTrack:r=Te(n=s._hints).call(n,gn.SCREEN_TRACK)?Lt.Screen:Lt.High;break;case Ae.LocalAudioTrack:r=Lt.Audio;break;case Ae.LocalVideoLowTrack:r=Lt.Low}return{stream_type:r,ssrcs:o,mid:a}})}assignLocalTracks(t,e){t.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:e[r].id,ssrcs:e[r].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(Qe.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),Te(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await Zr(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Le.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Mn.TRACER}).onSuccess(),this.emit(Qe.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const r=Array.from(Mo(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(ym.FIRST_FRAME_DECODED),Le.firstRemoteFrame(this.store.sessionId,Wr.FIRST_AUDIO_DECODE,Nn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const r=Array.from(Mo(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===e);r&&Le.firstRemoteFrame(this.store.sessionId,Wr.FIRST_AUDIO_RECEIVED,Nn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,r)=>{this.reportVideoFirstFrameDecoded(e,n,r)},t.onFirstVideoReceived=e=>{var n;const r=Array.from(Mo(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===e);r&&Le.firstRemoteFrame(this.store.sessionId,Wr.FIRST_VIDEO_RECEIVED,Nn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const r=e.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Qe.ConnectionTypeChange,r),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(sd(n))," -> ").concat(JSON.stringify(sd(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(sd(n))," -> ").concat(JSON.stringify(sd(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(Qe.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===ys.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,S.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===ys.SEND_ONLY?this.restartICE(t):fi(this,Qe.RequestP2PRestartICE,{direction:ys.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(Ae.LocalAudioTrack);if(t instanceof xn&&(n==null?void 0:n.track)instanceof yr)return n.track.isActive||e.push([Ae.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return t===s});if(r&&(e.push(r),r[0]===Ae.LocalVideoTrack)){const i=this.localTrackMap.get(Ae.LocalVideoLowTrack);i&&e.push([Ae.LocalVideoLowTrack,i])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(Ae.LocalAudioTrack);if(t instanceof xn&&(n==null?void 0:n.track)instanceof yr)return n.track.isActive&&e.push([Ae.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return t===s});if(r)if(r[0]===Ae.LocalVideoTrack){e.push(r);const i=this.localTrackMap.get(Ae.LocalVideoLowTrack);i&&e.push([Ae.LocalVideoLowTrack,i])}else e.push(r);return e}createMuteMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case Ae.LocalAudioTrack:r=Lt.Audio;break;case Ae.LocalVideoTrack:r=Te(n=s._hints).call(n,gn.SCREEN_TRACK)?Lt.Screen:Lt.High;break;case Ae.LocalVideoLowTrack:r=Lt.Low}return{stream_type:r,ssrcs:o,mid:a}})}createUnmuteMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case Ae.LocalAudioTrack:r=Lt.Audio;break;case Ae.LocalVideoTrack:r=Te(n=s._hints).call(n,gn.SCREEN_TRACK)?Lt.Screen:Lt.High;break;case Ae.LocalVideoLowTrack:r=Lt.Low}return{stream_type:r,ssrcs:o,mid:a}})}filterTobeUnSubscribedTracks(t,e){const n=[],r=this.remoteUserMap.get(t);if(!r)return n;if(e){const i=r.get(e);if(!i)return n;n.push([t,{kind:e,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,o]=i;n.push([t,{kind:s,id:o}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case Ue.VIDEO:return void(r._videoSSRC&&e.push({stream_type:Ue.VIDEO,ssrcId:r._videoSSRC}));case Ue.AUDIO:return void(r._audioSSRC&&e.push({stream_type:Ue.AUDIO,ssrcId:r._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:r}]=e;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(Ae.LocalVideoTrack),n=this.localTrackMap.get(Ae.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof xn){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await Yt(this,Qe.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Qe.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Qe.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Zr(Ck(this.dtlsFailedCount,hr)),this.emit(Qe.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Ae.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof dn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof dn).length>1)throw new ie(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof xn).length>1&&(t.some(e=>e instanceof xn&&e._bypassWebAudio)||!Ct().webAudioMediaStreamDest))throw new ie(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof dn&&this.pendingLocalTracks.some(n=>n instanceof dn))throw new ie(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof xn&&this.pendingLocalTracks.some(n=>n instanceof xn)&&(!Ct().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof xn&&n._bypassWebAudio)))throw new ie(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ct().supportDualStreamEncoding,r=xC(xC({},{width:160,height:120,framerate:15,bitrate:50}),e);let i;i=n?t._mediaStreamTrack.clone():hU(t,r);const s=tn(8,"track-low-"),o=new dn(i,xC(xC({},n&&{scaleResolutionDownBy:eU(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(ef.TRANSCEIVER_UPDATED,a=>{t._updateRtpTransceiver(a,$m.LOW_STREAM)}),o._hints.push(gn.LOW_STREAM),t.addListener(Se.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,r){var i;const s=Array.from(Mo(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===t);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,a=o.subscribe.find(A=>A.userId===s.uid&&A.type==="video");Le.firstRemoteVideoDecode(this.store.sessionId,Wr.FIRST_VIDEO_DECODE,Nn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:Ui.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(a==null?void 0:a.subscribeEnd)||0,subscriberStart:(a==null?void 0:a.subscribeStart)||0,videoAddNotify:(a==null?void 0:a.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(t);if(!r)return!1;const i=r.get(e);if(!i)return!1;const s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new ie(L.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new ie(L.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new ie(L.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new ie(L.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new ie(L.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new ie(L.NOT_SUPPORTED)}async preConnect(t){throw new ie(L.NOT_SUPPORTED)}getEstablishParams(){throw new ie(L.NOT_SUPPORTED)}async reSubscribe(t){throw new ie(L.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new ie(L.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===Ae.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,$m.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},Oe(En.prototype,"p2pConnect",[LG],Object.getOwnPropertyDescriptor(En.prototype,"p2pConnect"),En.prototype),Oe(En.prototype,"unpublish",[UG],Object.getOwnPropertyDescriptor(En.prototype,"unpublish"),En.prototype),Oe(En.prototype,"unpublishLowStream",[PG],Object.getOwnPropertyDescriptor(En.prototype,"unpublishLowStream"),En.prototype),Oe(En.prototype,"subscribe",[kG],Object.getOwnPropertyDescriptor(En.prototype,"subscribe"),En.prototype),Oe(En.prototype,"mockSubscribe",[xG],Object.getOwnPropertyDescriptor(En.prototype,"mockSubscribe"),En.prototype),Oe(En.prototype,"unsubscribe",[MG],Object.getOwnPropertyDescriptor(En.prototype,"unsubscribe"),En.prototype),Oe(En.prototype,"muteRemote",[FG],Object.getOwnPropertyDescriptor(En.prototype,"muteRemote"),En.prototype),Oe(En.prototype,"unmuteRemote",[VG],Object.getOwnPropertyDescriptor(En.prototype,"unmuteRemote"),En.prototype),Oe(En.prototype,"hasRemoteMediaWithLock",[QG],Object.getOwnPropertyDescriptor(En.prototype,"hasRemoteMediaWithLock"),En.prototype),Oe(En.prototype,"disconnectForReconnect",[HG],Object.getOwnPropertyDescriptor(En.prototype,"disconnectForReconnect"),En.prototype),Oe(En.prototype,"remoteMediaSsrcChanged",[jG],Object.getOwnPropertyDescriptor(En.prototype,"remoteMediaSsrcChanged"),En.prototype),En);function Bc(t){return function(e,n,r){const i=e[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];switch(t){case xc.SEND_ONLY:{const A=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{A()}}case xc.RECEIVE_ONLY:{const A=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{A()}}default:{const A=await this.sendMutex.lock("From P2PChannel2.".concat(n)),u=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,o)}finally{A(),u()}}}},r}}function GG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function wh(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class Bv{constructor(e){N(this,"store",void 0),N(this,"onStatsException",void 0),N(this,"onUploadPublishDuration",void 0),N(this,"onStatsChanged",void 0),N(this,"localStats",new Map),N(this,"remoteStats",new Map),N(this,"updateStatsInterval",void 0),N(this,"trafficStats",void 0),N(this,"trafficStatsPeerList",[]),N(this,"uplinkStats",void 0),N(this,"exceptionMonitor",void 0),N(this,"p2pChannel",void 0),N(this,"scalabilityMode",JL.L1T1),N(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new bDe,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Ae.LocalAudioTrack)||wh({},rU)}getLocalVideoTrackStats(){return this.localStats.get(Ae.LocalVideoTrack)||wh({},iU)}getRemoteAudioTrackStats(e){const n=(s,o)=>{if(!this.trafficStats)return o;const a=this.trafficStats.peer_delay.find(A=>A.peer_uid===s);return a&&(o.publishDuration=a.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},r={};if(e){var i;const s=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.audioStats;s&&(r[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{audioStats:a}]=s;a&&(r[o]=n(o,a))});return r}getRemoteNetworkQualityStats(e){const n={};if(e){var r;const i=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.networkStats;i&&(n[e]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{networkStats:o}]=i;o&&(n[s]=o)});return n}getRemoteVideoTrackStats(e){const n=(s,o)=>{if(!this.trafficStats)return o;const a=this.trafficStats.peer_delay.find(A=>A.peer_uid===s);return a&&(o.publishDuration=a.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},r={};if(e){var i;const s=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.videoStats;s&&(r[e]=n(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{videoStats:a}]=s;a&&(r[o]=n(o,a))});return r}getRTCStats(){let e=0,n=0,r=0,i=0;const s=this.localStats.get(Ae.LocalAudioTrack);s&&(e+=s.sendBytes,n+=s.sendBitrate);const o=this.localStats.get(Ae.LocalVideoTrack);o&&(e+=o.sendBytes,n+=o.sendBitrate);const a=this.localStats.get(Ae.LocalVideoLowTrack);a&&(e+=a.sendBytes,n+=a.sendBitrate),this.remoteStats.forEach(u=>{let{audioStats:d,videoStats:f}=u;d&&(r+=d.receiveBytes,i+=d.receiveBitrate),f&&(r+=f.receiveBytes,i+=f.receiveBitrate)});let A=1;return this.trafficStats&&(A+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:A,SendBitrate:n,SendBytes:e,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),s=i!=null&&i.videoSSRC?Ui.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,o=i!=null&&i.audioSSRC?Ui.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&S.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,r){if(!e)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,s=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case Ae.LocalVideoTrack:case Ae.LocalVideoLowTrack:{const o=i,a=wh({},iU),A=e.getStats(),u=e.getLocalMedia(r);if(A){const d=A.videoSend.find(f=>f.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(d){const f=e.getLocalVideoSize(),m=e.getEncoderConfig(Ae.LocalVideoTrack);d.codec!=="H264"&&d.codec!=="H265"&&d.codec!=="VP8"&&d.codec!=="VP9"&&d.codec!=="AV1X"&&d.codec!=="AV1"||(a.codecType=d.codec),a.sendBytes=d.bytes,a.sendBitrate=o?8*Math.max(0,a.sendBytes-o.sendBytes):0,d.inputFrame?(a.captureFrameRate=d.inputFrame.frameRate,a.captureResolutionHeight=d.inputFrame.height,a.captureResolutionWidth=d.inputFrame.width):f&&(a.captureResolutionWidth=f.width,a.captureResolutionHeight=f.height),d.sentFrame?(a.sendFrameRate=d.sentFrame.frameRate,a.sendResolutionHeight=d.sentFrame.height,a.sendResolutionWidth=d.sentFrame.width):f&&(a.sendResolutionWidth=f.width,a.sendResolutionHeight=f.height),d.avgEncodeMs&&(a.encodeDelay=d.avgEncodeMs),m&&m.bitrateMax&&(a.targetSendBitrate=1e3*m.bitrateMax),a.sendPackets=d.packets,a.sendPacketsLost=d.packetsLost,a.sendJitterMs=d.jitterMs,a.sendRttMs=d.rttMs,a.totalDuration=o?o.totalDuration+1:1,a.totalFreezeTime=o?o.totalFreezeTime:0,this.isLocalVideoFreeze(d)&&(a.totalFreezeTime+=1),d.scalabilityMode&&this.scalabilityMode!==d.scalabilityMode&&(S.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(d.scalabilityMode)),this.scalabilityMode=d.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var s;this.localStats.set(r,a),((o==null?void 0:o.sendResolutionWidth)!==a.sendResolutionWidth||(o==null?void 0:o.sendResolutionHeight)!==a.sendResolutionHeight)&&((s=this.onStatsChanged)===null||s===void 0||s.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&u&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,u.track,a);break}case Ae.LocalAudioTrack:{const o=i,a=wh({},rU),A=e.getStats(),u=e.getLocalMedia(r);if(A){const d=A.audioSend.find(f=>f.ssrc===(u==null?void 0:u.ssrcs[0].ssrcId));if(d){if(d.codec!=="opus"&&d.codec!=="aac"&&d.codec!=="PCMU"&&d.codec!=="PCMA"&&d.codec!=="G722"||(a.codecType=d.codec),d.inputLevel)a.sendVolumeLevel=Math.round(32767*d.inputLevel);else{const f=e.getLocalAudioVolume();f&&(a.sendVolumeLevel=Math.round(32767*f))}a.sendBytes=d.bytes,a.sendPackets=d.packets,a.sendPacketsLost=d.packetsLost,a.sendJitterMs=d.jitterMs,a.sendRttMs=d.rttMs,a.sendBitrate=o?8*Math.max(0,a.sendBytes-o.sendBytes):0}}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Ae.LocalAudioTrack,a),a&&u&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,u.track,a);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[s,{videoStats:o,audioStats:a,videoPcStats:A}]=n;const u=a,d=o,f=A,m=wh({},z$),g=wh({},q$),v=wh({},rDe),{audioTrack:y,videoTrack:w,audioSSRC:b,videoSSRC:I}=e.getRemoteMedia(s);let B;B=e instanceof ho?e.getStats(!0):e.getStats();const M=(r=B)===null||r===void 0?void 0:r.audioRecv.find(Q=>Q.ssrc===b),H=(i=B)===null||i===void 0?void 0:i.videoRecv.find(Q=>Q.ssrc===I),K=this.trafficStats&&this.trafficStats.peer_delay.find(Q=>Q.peer_uid===s);if(M&&(M.codec!=="opus"&&M.codec!=="aac"&&M.codec!=="PCMU"&&M.codec!=="PCMA"&&M.codec!=="G722"||(m.codecType=M.codec),M.outputLevel?m.receiveLevel=Math.round(32767*M.outputLevel):y&&(m.receiveLevel=Math.round(32767*y.getVolumeLevel())),m.receiveBytes=M.bytes,m.receivePackets=M.packets,m.receivePacketsLost=M.packetsLost,m.receivePacketsDiscarded=M.packetsDiscarded,m.packetLossRate=m.receivePacketsLost/(m.receivePackets+m.receivePacketsLost),m.receiveBitrate=u?8*Math.max(0,m.receiveBytes-u.receiveBytes):0,m.totalDuration=u?u.totalDuration+1:1,m.totalFreezeTime=u?u.totalFreezeTime:0,m.freezeRate=m.totalFreezeTime/m.totalDuration,m.receiveDelay=M.jitterBufferMs,m.totalDuration>10&&Bv.isRemoteAudioFreeze(y)&&(m.totalFreezeTime+=1)),H){H.codec!=="H264"&&H.codec!=="H265"&&H.codec!=="VP8"&&H.codec!=="VP9"&&H.codec!=="AV1X"&&H.codec!=="AV1"||(g.codecType=H.codec),g.receiveBytes=H.bytes,g.receiveBitrate=d?8*Math.max(0,g.receiveBytes-d.receiveBytes):0,g.decodeFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,g.renderFrameRate=H.decodeFrameRate<0?0:H.decodeFrameRate,H.outputFrame&&(g.renderFrameRate=H.outputFrame.frameRate),H.receivedFrame?(g.receiveFrameRate=H.receivedFrame.frameRate,g.receiveResolutionHeight=H.receivedFrame.height,g.receiveResolutionWidth=H.receivedFrame.width):w&&(g.receiveResolutionHeight=w._videoHeight||0,g.receiveResolutionWidth=w._videoWidth||0),H.framesRateFirefox!==void 0&&(g.receiveFrameRate=Math.round(H.framesRateFirefox)),g.receivePackets=H.packets,g.receivePacketsLost=H.packetsLost,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost),g.totalDuration=d?d.totalDuration+1:1,g.totalFreezeTime=d?d.totalFreezeTime:0,g.receiveDelay=H.jitterBufferMs||0;const Q=!!I&&e.getRemoteVideoIsReady(I);w&&Q&&Bv.isRemoteVideoFreeze(w,H,f)&&(g.totalFreezeTime+=1),g.freezeRate=g.totalFreezeTime/g.totalDuration}K&&(m.end2EndDelay=K.B_ad,g.end2EndDelay=K.B_vd,m.transportDelay=K.B_ed,g.transportDelay=K.B_ed,m.currentPacketLossRate=K.B_ealr4/100,g.currentPacketLossRate=K.B_evlr4/100,v.uplinkNetworkQuality=K.B_punq?K.B_punq:0,v.downlinkNetworkQuality=K.B_pdnq?K.B_pdnq:0),this.remoteStats.set(s,{audioStats:m,videoStats:g,videoPcStats:H,networkStats:v}),y&&this.exceptionMonitor.setRemoteAudioStats(y,m),w&&this.exceptionMonitor.setRemoteVideoStats(w,g)})}}class xZ{constructor(){N(this,"destChannelMediaInfos",new Map),N(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){G3(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){G3(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Mb(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function WG(t){if(!(t instanceof xZ))return new te(L.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new te(L.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new te(L.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function zG(t){var e={},n=!1;function r(i,s){return n=!0,{done:!1,value:new Hk(s=new uU(function(o){o(t[i](s))}),1)}}return e[em!==void 0&&qJ||"@@iterator"]=function(){return this},e.next=function(i){return n?(n=!1,i):r("next",i)},typeof t.throw=="function"&&(e.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof t.return=="function"&&(e.return=function(i){return n?(n=!1,i):r("return",i)}),e}var GDe=tr(OZ);function qG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function YG(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var qt;function XG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function MC(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?XG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):XG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let G_=(qt=class lE extends P${get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return Te(n=Object.keys(xb)).call(n,e)}))]}constructor(e,n){super(e,n),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"statsFilter",void 0),N(this,"useRTX",!1),N(this,"localCapabilities",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"establishPromise",void 0),N(this,"mutex",new Pi("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(lE.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=Kk(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=od(e.sdp),r=Rv(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=e,MC(MC({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:e.sdp})}catch(e){throw new ie(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(r){N(this,"sessionDesc",void 0),N(this,"localCapabilities",void 0),N(this,"rtpCapabilities",void 0),N(this,"candidates",void 0),N(this,"iceParameters",void 0),N(this,"dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),r=sr(r);const{iceParameters:i,dtlsParameters:s,candidates:o,rtpCapabilities:a,setup:A,localCapabilities:u,sdkCodec:d,cname:f}=r,m=Jr.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=o,this.iceParameters=i,this.dtlsParameters=s,this.setup=A,this.localCapabilities=u,this.cname=f;for(let g=0;g<m.mediaDescriptions.length;g++){const v=m.mediaDescriptions[g];if(v.attributes.iceUfrag=i.iceUfrag,v.attributes.icePwd=i.icePwd,v.attributes.fingerprints=s.fingerprints,v.attributes.candidates=o,v.attributes.setup=A,v.media.mediaType==="video"){v.media.fmts=a.videoCodecs.map(w=>w.payloadType.toString(10));let y=a.videoCodecs.filter(w=>{var b,I;return(b=w.rtpMap)===null||b===void 0?void 0:Te(I=b.encodingName.toLowerCase()).call(I,d)});y.length===0&&(y=a.videoCodecs),v.attributes.payloads=y,v.attributes.extmaps=a.videoExtensions}v.media.mediaType==="audio"&&(v.media.fmts=a.audioCodecs.map(y=>y.payloadType.toString(10)),v.attributes.payloads=a.audioCodecs,v.attributes.extmaps=a.audioExtensions),m.mediaDescriptions[g]=this.mungMediaDesc(v)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return Jr.print(this.sessionDesc)}send(r,i,s){const{ssrcs:o,ssrcGroups:a}=Lh(i,this.cname),A=this.sessionDesc.mediaDescriptions.find(f=>r===Ue.VIDEO?f.media.mediaType==="video":f.media.mediaType==="audio"),u=o[0].attributes.label,d=o[0].attributes.mslabel;return A.attributes.ssrcs=A.attributes.ssrcs.concat(o),A.attributes.ssrcGroups=A.attributes.ssrcGroups.concat(a),{id:u,mslabel:d}}batchSend(r){return r.map(i=>{let{kind:s,ssrcMsg:o}=i;return this.send(s,o,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const s=[],o=[],a=[];i.attributes.ssrcs.forEach(A=>{Te(r).call(r,A.attributes.label||"")?a.push(A):s.push(A)}),i.attributes.ssrcGroups.forEach(A=>{var u;Te(u=a.map(d=>d.ssrcId)).call(u,A.ssrcIds[0])||o.push(A)}),i.attributes.ssrcs=s,i.attributes.ssrcGroups=o})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(s=>s.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,s){r.forEach((o,a)=>{const A=o._mediaStreamTrack,u=this.sessionDesc.mediaDescriptions.findIndex(f=>f.attributes.mid===A.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],o);this.sessionDesc.mediaDescriptions[u]=d})}stopReceiving(r){}updateCandidates(r){r===_o.TCP?this.candidates.forEach(i=>{this.candidates.findIndex(s=>s.transport==="tcp"&&s.connectionAddress===i.connectionAddress&&s.port===i.port)===-1&&this.candidates.push(YG(YG({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this.candidates=this.candidates.filter(i=>i.transport!=="tcp");for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(r){r=sr(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let s=0;s<r;s++)i.push((this.currentMidIndex+s+1).toString(10));return i}mungRecvMediaDsec(r,i){const s=sr(r);return Zm(s,i),xk(s,i),s}updateRecvMedia(r,i){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===r);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],i);this.sessionDesc.mediaDescriptions[s]=o}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,s){const o=this.sessionDesc.mediaDescriptions.find(A=>r===Ue.VIDEO?A.attributes.mid==="video":A.attributes.mid==="audio");if(o){const A=o.attributes.ssrcs.find(u=>u.attributes.label===i);var a;A&&(A.attributes.label=s,(a=A.attributes.msid)===null||a===void 0||a.replace(i,s))}}mungMediaDesc(r){const i=sr(r);return kk(i),function(s){const o=s.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&s.attributes.extmaps.splice(s.attributes.extmaps.indexOf(o),1),s.attributes.payloads.forEach(a=>{const A=a.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");A!==-1&&a.rtcpFeedbacks.splice(A,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const s of i.attributes.ssrcs)if(s.attributes.label===r)return[s]}}(MC(MC({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new ie(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var r=this;return Gc(function*(){const i=yield Rt(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=e.map(m=>r.peerConnection.addTrack(m._mediaStreamTrack)),o=yield Rt(r.peerConnection.createOffer()),a=Jr.parse(o.sdp),A=e.map(m=>{const g=m._mediaStreamTrack,v=a.mediaDescriptions.find(y=>y.attributes.mid===g.kind);if(!v)throw new Error("Cannot extract ssrc from mediaDescription.");return function(y,w,b){const I=y.attributes.ssrcs.filter(M=>M.attributes.label===w),B=y.attributes.ssrcGroups;if(I.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(B&&I.length>1){const M=B.find(H=>H.ssrcIds.indexOf(I[0].ssrcId)!==-1);return M?[{ssrcId:M.ssrcIds[0],rtx:b?M.ssrcIds[1]:void 0}]:[{ssrcId:I[0].ssrcId}]}return[{ssrcId:I[0].ssrcId}]}(v,g.id,r.useRTX)});let u;try{u=yield A}catch(m){throw s.forEach(g=>{hi()&&g.replaceTrack(null),r.peerConnection.removeTrack(g)}),m}const d=r.mungSendOfferSDP(o.sdp,e);r.remoteSDP.receive(e,n,u);const f=r.remoteSDP.toString();return yield Rt(r.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield Rt(r.applySendEncodings(s,e)),yield Rt(r.peerConnection.setRemoteDescription({type:"answer",sdp:f})),e.map((m,g)=>{const v=m._mediaStreamTrack.id;return{localSSRC:A[g],id:v}})}catch(s){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(s=>{var o;return e.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(s=>{hi()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:s,mslabel:o}=this.remoteSDP.send(e,n,i),a=new ye((d,f)=>{const m=setTimeout(()=>{f(new Error("Cannot receive track, id: ".concat(s)))},1e4),g=v=>{const y=yt();if((y.name==="Safari"&&Number(y.version)===11||Cs())&&v.track.id!==s&&v.streams[0].id===o){var w;const b=v.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(e,s,v.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(m),void d(b)}if(v.track.id===s)return this.peerConnection.removeEventListener("track",g),clearTimeout(m),void d(v.track)};this.peerConnection.addEventListener("track",g)}),A=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:A});const u=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u),{track:await a,id:s}}catch(s){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var i;return e.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(hi()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(s=>s.active=!1),r.setParameters(i)}})}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(s=>{var o;return e.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async s=>{if(hi()&&s.track)s.track.enabled=!0;else{const o=s.getParameters();o.encodings.forEach(a=>a.active=!0),await s.setParameters(o)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Gc(function*(){const r=yield Rt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ct().supportPCSetConfiguration){const A=n.peerConnection.getConfiguration(),u=e===_o.RELAY?"relay":"all";A.iceTransportPolicy!==u&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(u,"]")),A.iceTransportPolicy=u,n.peerConnection.setConfiguration(A))}else if(e===_o.RELAY)return;e!==_o.RELAY&&n.remoteSDP.updateCandidates(e);const i=yield Rt(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=od(i.sdp),{remoteIceParameters:o}=yield s.iceParameters;n.remoteSDP.restartICE(o);const a=n.remoteSDP.toString();yield Rt(n.peerConnection.setLocalDescription(i)),yield Rt(n.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(i){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ie(L.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(e,n){const r=this.peerConnection.getSenders().filter(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===e});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const r=this.peerConnection.getSenders().find(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===n});r&&await r.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new ie(L.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new ie(L.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Ub(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...lE.turnServerConfigToIceServers(e.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...lE.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var r;if(n||(n=this.peerConnection.getSenders().find(u=>{var d;return((d=u.track)===null||d===void 0?void 0:d.id)===e._mediaStreamTrack.id})),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!Ct().supportSetRtpSenderParameters)return S.warn("Browser not support set rtp-sender parameters");const i={},s={};if(e instanceof dn)switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(j("DSCP_TYPE")&&Ud()){var o;const u=j("DSCP_TYPE");Te(o=["very-low","low","medium","high"]).call(o,u)&&(s.networkPriority=u)}const a=n.getParameters(),A=(r=a.encodings)===null||r===void 0?void 0:r[0];A&&Object.assign(A,s),Object.assign(a,i),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await n.setParameters(a)}async applySendEncodings(e,n){try{if(!Ct().supportSetRtpSenderParameters||e.length!==n.length)return;for(let r=0;r<e.length;r++){const i=e[r],s=n[r];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const r=Jr.parse(e);return n.forEach((i,s)=>{const o=i._mediaStreamTrack,a=r.mediaDescriptions.find(A=>A.attributes.mid===o.kind);a&&Zm(a,i)}),Jr.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((s,o)=>{let{id:a,mslabel:A}=s;const{kind:u}=e[o];return new ye((d,f)=>{const m=setTimeout(()=>{f(new Error("Cannot receive track, id: ".concat(a)))},1e4),g=v=>{const y=yt();if(y.name==="Safari"&&Number(y.version)===11&&v.track.id!==a&&v.streams[0].id===A){var w;const b=v.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(u,a,v.track.id),this.peerConnection.removeEventListener("track",g),clearTimeout(m),void d({track:b,id:a})}if(v.track.id===a)return this.peerConnection.removeEventListener("track",g),clearTimeout(m),void d({track:v.track,id:a})};this.peerConnection.addEventListener("track",g)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await ye.all(n)}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(Ct().supportPCSetConfiguration){const n=lE.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Oe(qt.prototype,"connect",[da],Object.getOwnPropertyDescriptor(qt.prototype,"connect"),qt.prototype),Oe(qt.prototype,"stopSending",[da],Object.getOwnPropertyDescriptor(qt.prototype,"stopSending"),qt.prototype),Oe(qt.prototype,"receive",[da],Object.getOwnPropertyDescriptor(qt.prototype,"receive"),qt.prototype),Oe(qt.prototype,"stopReceiving",[da],Object.getOwnPropertyDescriptor(qt.prototype,"stopReceiving"),qt.prototype),Oe(qt.prototype,"muteRemote",[da],Object.getOwnPropertyDescriptor(qt.prototype,"muteRemote"),qt.prototype),Oe(qt.prototype,"unmuteRemote",[da],Object.getOwnPropertyDescriptor(qt.prototype,"unmuteRemote"),qt.prototype),Oe(qt.prototype,"muteLocal",[da],Object.getOwnPropertyDescriptor(qt.prototype,"muteLocal"),qt.prototype),Oe(qt.prototype,"unmuteLocal",[da],Object.getOwnPropertyDescriptor(qt.prototype,"unmuteLocal"),qt.prototype),Oe(qt.prototype,"close",[da],Object.getOwnPropertyDescriptor(qt.prototype,"close"),qt.prototype),Oe(qt.prototype,"updateEncoderConfig",[da],Object.getOwnPropertyDescriptor(qt.prototype,"updateEncoderConfig"),qt.prototype),Oe(qt.prototype,"updateSendParameters",[da],Object.getOwnPropertyDescriptor(qt.prototype,"updateSendParameters"),qt.prototype),Oe(qt.prototype,"replaceTrack",[da],Object.getOwnPropertyDescriptor(qt.prototype,"replaceTrack"),qt.prototype),Oe(qt.prototype,"getRemoteSSRC",[da],Object.getOwnPropertyDescriptor(qt.prototype,"getRemoteSSRC"),qt.prototype),qt);function da(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(e));try{for(var o=arguments.length,a=new Array(o),A=0;A<o;A++)a[A]=arguments[A];return await r.apply(this,a)}finally{s()}},n}function JG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Pu(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?JG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):JG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const W_="9",$G=4e4;class WDe{get localCapabilities(){return sr(this._localCapabilities)}get rtpCapabilities(){return sr(this._rtpCapabilities)}get candidates(){return sr(this._candidates)}get iceParameters(){return sr(this._iceParameters)}get dtlsParameters(){return sr(this._dtlsParameters)}constructor(e){N(this,"sessionDesc",void 0),N(this,"_localCapabilities",void 0),N(this,"_rtpCapabilities",void 0),N(this,"_candidates",void 0),N(this,"_iceParameters",void 0),N(this,"_dtlsParameters",void 0),N(this,"setup",void 0),N(this,"currentMidIndex",void 0),N(this,"cname",void 0),N(this,"firefoxSsrcMidMap",new Map),e=sr(e);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:s,setup:o,localCapabilities:a,cname:A}=e;this._rtpCapabilities=s,this._candidates=i,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=a,this.setup=o,this.cname=A,this.sessionDesc=this.updateRemoteRTPCapabilities(s),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){const n=this.candidates,r=this.dtlsParameters,i=this.iceParameters,s=this.rtpCapabilities.send;let o=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<e;a++){const A=2*a+2e4,u=2*a+$G,{ssrcs:d,ssrcGroups:f}=Lh([{ssrcId:A}],this.cname),{ssrcs:m,ssrcGroups:g}=Lh([{ssrcId:u,rtx:j("USE_SUB_RTX")?u+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:W_,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.videoCodecs.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:n,extmaps:s.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:g,rtcpFeedbackWildcards:[],payloads:s.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:W_,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.audioCodecs.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:n,extmaps:s.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:s.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Jr.print(this.sessionDesc)}send(e,n,r,i){const{ssrcs:s,ssrcGroups:o}=Lh(n,this.cname,j("SYNC_GROUP")?r:void 0),a=this.findPreloadMediaDesc(s);if(a){if(Vn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const A=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const A=this.findAvailableMediaIndex(e,s);let u;return A===-1||A===1&&(hi()||function(){const d=yt();return!(d.name!==Ut.CHROME||!d.osVersion)&&Number(d.version)<=90}())||A===0&&j("USE_SUB_RTX")||w3()?(u=this.createOrRecycleSendMedia(e,s,o,"sendonly",i),this.updateBundleMids()):(u=sr(this.sessionDesc.mediaDescriptions[A]),u.attributes.direction="sendonly",u.attributes.ssrcs=s,u.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(u,i)),Vn()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,u.attributes.mid),{mid:u.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:n}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:n}}batchSend(e){const n=e.map(s=>{let{kind:o,ssrcMsg:a,mslabel:A}=s;return this.send(o,a,A)}),r=[];let i=!1;return n.forEach(s=>{let{mid:o,needExchangeSDP:a}=s;a&&(i=!0),r.push(o)}),{mids:r,needExchangeSDP:i}}stopSending(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(r=>{r.attributes.mid==="0"||Vn()||w3()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(e){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>Te(e).call(e,r.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>Te(e).call(e,r.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="recvonly"})}receive(e,n,r,i){e.forEach((s,o)=>{this.createOrRecycleRecvMedia(s,[],"recvonly",n,r,i[o])}),this.updateBundleMids()}stopReceiving(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const n=this.sessionDesc||Jr.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=e;const r=this.rtpCapabilities.send,i=this.localCapabilities.send;for(const s of n.mediaDescriptions){if(s.attributes.iceUfrag=this._iceParameters.iceUfrag,s.attributes.icePwd=this._iceParameters.icePwd,s.attributes.fingerprints=this._dtlsParameters.fingerprints,s.attributes.candidates=this._candidates,s.attributes.setup=this.setup,s.media.mediaType==="application"&&(s.attributes.sctpPort="5000"),s.media.mediaType==="video"){if(r.videoCodecs.length===0){const o=i.videoCodecs.filter(a=>{var A,u;return(A=a.rtpMap)===null||A===void 0?void 0:Te(u=A.encodingName.toLowerCase()).call(u,"vp8")})||[i.videoCodecs[0]];s.media.fmts=o.map(a=>a.payloadType.toString(10)),s.attributes.payloads=o,s.attributes.extmaps=[]}else if(s.media.fmts=r.videoCodecs.map(o=>o.payloadType.toString(10)),s.attributes.payloads=r.videoCodecs,s.attributes.extmaps=r.videoExtensions,j("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:o,ssrcGroups:a}=Lh([{ssrcId:$G,rtx:j("USE_SUB_RTX")?40001:void 0}],this.cname);s.attributes.ssrcs=o,s.attributes.ssrcGroups=a}}if(s.media.mediaType==="audio"){if(r.audioCodecs.length===0){const o=i.audioCodecs.filter(a=>{var A,u;return(A=a.rtpMap)===null||A===void 0?void 0:Te(u=A.encodingName.toLowerCase()).call(u,"opus")})||[i.audioCodecs[0]];s.media.fmts=o.map(a=>a.payloadType.toString(10)),s.attributes.payloads=o,s.attributes.extmaps=[]}else if(s.media.fmts=r.audioCodecs.map(o=>o.payloadType.toString(10)),s.attributes.payloads=r.audioCodecs,s.attributes.extmaps=r.audioExtensions,eg(s),j("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:o,ssrcGroups:a}=Lh([{ssrcId:2e4}],this.cname);s.attributes.ssrcs=o,s.attributes.ssrcGroups=a}}}return this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){const n=this._candidates.filter(r=>r.transport==="udp");if(e===_o.TCP){if(n.length===0)return;if(j("TCP_CANDIDATE_ONLY")){const r=this._candidates.filter(i=>i.transport==="tcp");n.forEach(i=>{r.findIndex(s=>s.connectionAddress===i.connectionAddress)===-1&&r.push(Pu(Pu({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),this._candidates=r}else{const r=[];n.forEach(i=>{r.push(Pu(Pu({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),this._candidates=[...n,...r]}}else if(e===_o.RELAY){if(n.length!==0)return;{const r=this._candidates.filter(i=>i.transport==="tcp");r.forEach(i=>{n.push(Pu(Pu({},i),{},{foundation:"udpcandidate",priority:Number(i.priority)+1+"",transport:"udp",port:Number(i.port)-90+""}))}),this._candidates=[...n,...r]}}else n.length===0?(this._candidates.filter(r=>r.transport==="tcp").forEach(r=>{n.push(Pu(Pu({},r),{},{foundation:"udpcandidate",priority:Number(r.priority)+1+"",transport:"udp",port:Number(r.port)-90+""}))}),this._candidates=n):this._candidates=this._candidates.filter(r=>r.transport!=="tcp");for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(e){e=sr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let r=0;r<e;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}findAvailableMediaIndex(e,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Vn()){if(i){const s=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(s||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!s||s!==r.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const r of this.sessionDesc.mediaDescriptions)if(r.media.mediaType==="application")return{mediaDesc:r,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),n={media:{mediaType:"application",port:W_,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(n),{mediaDesc:n,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,n,r,i,s,o){const a=e._mediaStreamTrack.kind,A=this.rtpCapabilities.recv,u=VE(a,A,this.localCapabilities.send,a===Ue.VIDEO?i:s),d=a===Ue.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const f="".concat(this.currentMidIndex);let m={media:{mediaType:a,port:W_,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(v=>v.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(f)}};m=this.mungRecvMediaDsec(m,e,o);const g=this.findFirstClosedMedia(a);if(g){const v=this.sessionDesc.mediaDescriptions.indexOf(g);this.sessionDesc.mediaDescriptions[v]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}updateRemoteCodec(e,n,r){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(m=>m.rtpMap&&m.rtpMap.encodingName.toLowerCase()||"").filter(m=>{var g;return Te(g=Object.keys(xb)).call(g,m)}))],s=new Set(n);if(i.every(m=>s.has(m)))return S.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(n)),!1;const o=this._rtpCapabilities.recv.videoCodecs.filter(m=>n.some(g=>{var v;return Te(v=m.rtpMap&&m.rtpMap.encodingName.toLowerCase()||"").call(v,g)}));if(o.length===0)return S.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(n)),!1;const a=[...new Set(o.map(m=>m.rtpMap&&m.rtpMap.encodingName.toLowerCase()||""))];let A;if(S.debug("updateRemoteCodec, from ".concat(i," to ").concat(a)),e.length===0)A=this.sessionDesc.mediaDescriptions.filter(m=>m.media.mediaType==="video"&&m.attributes.direction==="recvonly");else if(A=this.sessionDesc.mediaDescriptions.filter(m=>m.attributes.mid&&Te(e).call(e,m.attributes.mid)&&m.attributes.direction==="recvonly"),A.length!==e.length)return S.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(n)),!1;if(j("USE_PUB_RTX")||j("USE_SUB_RTX")){const m=Mk(o,this.rtpCapabilities.recv.videoCodecs);o.push(...m)}this._rtpCapabilities.recv.videoCodecs=o;const u=this.localCapabilities.send,d=this.rtpCapabilities.recv,f=VE(Ue.VIDEO,d,u,r);return A.forEach(m=>{const g=f.map(v=>v.payloadType.toString(10));S.debug("updateRemoteCodec mid: ".concat(m.attributes.mid,", from ").concat(m.attributes.payloads," to ").concat(f)),m.attributes.payloads=f,m.media.fmts=g}),!0}createOrRecycleSendMedia(e,n,r,i,s){const o=this.rtpCapabilities.send,a=e===Ue.VIDEO?o.videoCodecs:o.audioCodecs,A=e===Ue.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let d={media:{mediaType:e,port:W_,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};d=this.mungSendMediaDesc(d,s);const f=this.findFirstClosedMedia(e);if(f){const m=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[m]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,n,r){const i=sr(e);return kk(i),Zm(i,n),xk(i,n),vZ(i),hS(i,r,this.localCapabilities.send),i}mungSendMediaDesc(e,n){const r=sr(e);return hS(r,n,this.localCapabilities.recv),eg(r),r}updateRecvMedia(e,n){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(n=>Vn()?n.media.port==="0"&&n.media.mediaType===e:n.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(n=>{var r;return((r=n.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}getSSRC(e){var n;return(n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e))===null||n===void 0?void 0:n.attributes.ssrcs}}function ZG(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Ol(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ZG(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ZG(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let QE=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({});var Sm=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(Sm||{});const pS=new Map;function e6(t,e,n,r){let{scale:i}=t;if(i===0&&r===Sm.UP||i>=e.length-1&&r===Sm.DOWN)return t;let s=Ol(Ol({},t),{},{scale:r===Sm.DOWN?++i:--i});switch(n){case"maintain-framerate":s=Ol(Ol({},s),e[i].motion);break;case"maintain-resolution":s=Ol(Ol({},s),e[i].detail);break;case"balanced":s=Ol(Ol({},s),e[i].balanced)}return s}function MZ(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:FZ(e)};pS.set(t,n)}else pS.delete(t)}function FZ(t){const e=Ol({},t),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:s}=e,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:a,MAX_SCALE:A,BITRATE_MIN_THRESHOLD:u,BITRATE_MAX_THRESHOLD:d,BWE_SCALE_UP_THRESHOLD:f,BWE_SCALE_DOWN_THRESHOLD:m,PERF_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_UP_THRESHOLD:v,BALANCE_BITRATE_FACTOR:y,BALANCE_FRAMERATE_FACTOR:w,BALANCE_RESOLUTION_FACTOR:b,MOTION_RESOLUTION_FACTOR:I,MOTION_BITRATE_FACTOR:B,DETAIL_FRAMERATE_FACTOR:M,DETAIL_BITRATE_FACTOR:H}=Sk,K=Math.min(e.frameRate,a),Q=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(m,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(g,1)*K),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:s}}];for(let F=1;F<=A;F++){const k={bwe_up:Math.round(Math.pow(f,F)*n),bwe_down:Math.round(Math.pow(m,F+1)*n),fps_up:Math.round(Math.pow(v,F)*K),fps_down:Math.round(Math.pow(g,F+1)*K)},G={scaleResolutionDownBy:i/Math.pow(b,F),frameRate:Math.max(Math.round(Math.pow(w,F)*r),o),bitrateMax:Math.max(Math.round(Math.pow(y,F)*n),d),bitrateMin:Math.max(Math.round(Math.pow(y,F)*s),u)},$={scaleResolutionDownBy:i/Math.pow(I,F),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(B,F)*n),d),bitrateMin:Math.max(Math.round(Math.pow(B,F)*s),u)},ne={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(M,F)*r),o),bitrateMax:Math.max(Math.round(Math.pow(H,F)*n),d),bitrateMin:Math.max(Math.round(Math.pow(H,F)*s),u)};Q.push({scale:F,threshold:k,balanced:G,motion:$,detail:ne})}return Q}function zDe(t,e,n,r,i,s){const o=pS.get(t)||{overUse:0,underUse:0,adaptationList:FZ(i)},{adaptationList:a}=o;pS.set(t,o);const{OVERUSE_TIMES_THRESHOLD:A,UNDERUSE_TIMES_THRESHOLD:u}=Sk,{scale:d}=r;let f,m;return typeof e=="number"&&e>0&&function(g,v,y,w){if(v>=y.length)return!1;let{threshold:{fps_down:b}}=y[v];return j("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(b=y[0].threshold.fps_down),g<b}(e,d,a,s)&&(o.overUse++,m=QE.CPU,o.overUse>A)||typeof n=="number"&&n>0&&function(g,v,y){if(v>=y.length)return!1;const{threshold:{bwe_down:w}}=y[v];return g<w}(n,d,a)&&(o.overUse++,m=QE.BANDWIDTH,o.overUse>A)?(o.overUse=0,o.underUse=0,f=e6(r,a,s,Sm.DOWN),[f,m]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(g,v,y,w){if(v===0)return;let{threshold:{fps_up:b}}=y[v];return j("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(b=y[1].threshold.fps_up),g>b}(e,d,a,s)&&function(g,v,y){if(v===0)return;const{threshold:{bwe_up:w}}=y[v];return g>w}(n,d,a)&&(o.underUse++,o.underUse>u&&(o.overUse=0,o.underUse=0,f=e6(r,a,s,Sm.UP),f.scale===0&&(m=QE.NONE))),[f,m])}function t6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function TD(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?t6(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):t6(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function qDe(t){var e;return!!j("ENABLE_AG_ADAPTATION")&&!!(t instanceof aU||Te(e=t._hints).call(e,gn.CUSTOM_TRACK))&&(!!j("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const r=yt();if(r.os!==kr.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])>=n}(14)&&_$(17,4)||g$(14)&&E$(17,4,!0)))}const mS=new Map;function FC(t,e){const n=mS.get(t);if(n){const{timer:r}=n;window.clearTimeout(r),mS.delete(t)}e.qualityLimitationReason=QE.NONE,MZ(t)}var gt;function n6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function EA(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?n6(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):n6(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let Lc=(gt=class uE extends P${get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return Te(n=Object.keys(xb)).call(n,e)}))]}constructor(e,n){super(e,n),N(this,"store",void 0),N(this,"peerConnection",void 0),N(this,"id",tn(5,"connection-")),N(this,"remoteSDP",void 0),N(this,"initialOffer",void 0),N(this,"transportEventReceiver",void 0),N(this,"statsFilter",void 0),N(this,"extension",{useXR:j("USE_XR")}),N(this,"localCapabilities",void 0),N(this,"remoteCodecs",void 0),N(this,"localCandidateCount",0),N(this,"allCandidatesReceived",!1),N(this,"isPreallocation",!1),N(this,"preSSRCMap",new Map),N(this,"dataStreamChannelMap",new Map),N(this,"establishPromise",void 0),N(this,"recoveredDataChannelIds",[]),N(this,"currentDataChannelId",1),N(this,"mutex",new Pi("P2PConnection-mutex")),N(this,"qualityLimitationReason",QE.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(uE.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=Kk(this.peerConnection,j("STATS_UPDATE_INTERVAL"),void 0,Vn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);if(r)return{transceiver:r,track:r.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void S.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else S.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=od(e.sdp),r=await wZ({filterRTX:!j("USE_PUB_RTX")&&!j("USE_SUB_RTX"),filterVideoFec:j("FILTER_VIDEO_FEC"),filterAudioFec:j("FILTER_AUDIO_FEC"),filterVideoCodec:j("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=fS(r),this.initialOffer=e,EA(EA({},n),{},{rtpCapabilities:r,offerSDP:e.sdp})}catch(e){throw new ie(L.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new WDe(EA(EA({},e),{},{localCapabilities:this.localCapabilities})),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),r=CZ(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i==null||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const s=this.peerConnection.getTransceivers()[0];if(s!=null&&s.receiver&&this.tryBindTransportEvents(s.receiver),j("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(j("PRELOAD_MEDIA_COUNT"));const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A)}const{preSSRCs:o}=e;if(Array.isArray(o)&&o.length>0){const{mids:a}=this.remoteSDP.batchSend(o.map(A=>({kind:A.kind,ssrcMsg:[{ssrcId:A.ssrcId,rtx:A.rtx}],mslabel:A.mslabel})));a.forEach((A,u)=>{this.preSSRCMap.set(o[u].ssrcId,A)}),await UC(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:r}=e;if(Array.isArray(r)&&r.length>0){const{mids:i}=this.remoteSDP.batchSend(r.map(s=>Object.assign({},{kind:s.kind,ssrcMsg:[{ssrcId:s.ssrcId,rtx:s.rtx}],mslabel:s.mslabel})));i.forEach((s,o)=>{this.preSSRCMap.set(r[o].ssrcId,s)})}await UC(this.peerConnection,this.remoteSDP,this.extension),S.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,r){var i=this;return Gc(function*(){const s=yield Rt(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[];e.forEach(y=>{const w=i.peerConnection.addTransceiver(y._mediaStreamTrack,{direction:"sendonly"});o.push(w),y._updateRtpTransceiver(w)}),Vn()&&j("SIMULCAST")===!0&&(yield Rt(i.applySimulcastForFirefox(o,e)));const a=yield Rt(i.peerConnection.createOffer()),A=i.remoteSDP.predictReceivingMids(e.length),u=i.mungSendOfferSDP(a.sdp,e,A),d=Jr.parse(u),f=A.map(y=>{const w=d.mediaDescriptions.find(b=>b.attributes.mid===y);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return _Z(w,j("USE_PUB_RTX"))});let m;try{m=yield f}catch(y){m=[],i.remoteSDP.receive(e,n,r,m);const w=i.remoteSDP.toString();throw yield Rt(i.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield Rt(i.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield Rt(i.stopSending(A,!0)),y}i.remoteSDP.receive(e,n,r,m);const g=i.remoteSDP.toString(),v=i.logSDPExchange(u,"offer","local","send");return yield Rt(i.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield Rt(i.applySimulcastEncodings(o,e)),yield Rt(i.applySendEncodings(o,e)),v==null||v(g),yield Rt(i.peerConnection.setRemoteDescription({type:"answer",sdp:g})),o.map((y,w)=>{const b=A[w];return{localSSRC:f[w],id:b,transceiver:y}})}catch(o){throw o instanceof ie?o:new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(e);if(r&&r.readyState==="open")S.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:j("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,r)}n.forEach(s=>{s._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),S.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else S.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof ie?r:new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof ie?n:new ie(L.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(A=>e.indexOf(A.mid)!==-1);if(i.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(A=>{var u;FC(this.id+A.mid,this),A.direction="inactive",(u=A.stop)===null||u===void 0||u.call(A)});const s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:s,needExchangeSDP:o}=this.remoteSDP.send(e,n,r,i);o&&(await UC(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const a=this.peerConnection.getTransceivers().find(A=>A.mid===s);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:s,transceiver:a}}catch(s){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(e);return r&&(await UC(this.peerConnection,this.remoteSDP,this.extension),S.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(i=>{const s=this.peerConnection.getTransceivers().find(o=>o.mid===i);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}})}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(s=>{Array.from(this.preSSRCMap.entries()).some(o=>{let[a,A]=o;if(A===s)return this.preSSRCMap.delete(a),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(o=>{o.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(e);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(o,a)=>{o.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(e);const s=this.remoteSDP.toString();i==null||i(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new ie(L.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Gc(function*(){const r=yield Rt(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(Ct().supportPCSetConfiguration){const u=n.peerConnection.getConfiguration(),d=e===_o.RELAY?"relay":"all";u.iceTransportPolicy!==d&&(S.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(d,"]")),u.iceTransportPolicy=d,n.peerConnection.setConfiguration(u))}else if(e===_o.RELAY)return;n.remoteSDP.updateCandidates(e);const i=yield Rt(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const s=od(i.sdp),{remoteIceParameters:o}=yield s.iceParameters;n.remoteSDP.restartICE(o);const a=n.remoteSDP.toString(),A=n.logSDPExchange(i.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Rt(n.peerConnection.setLocalDescription(i)),A==null||A(a),yield Rt(n.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(i){S.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{FC(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return EA(EA({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o==null||o(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(r){throw new ie(L.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(e,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===e);r.length===1&&(this.isVP8Simulcast(n)?Vn()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:EA(EA({},VA),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:EA(EA({},VA),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,S.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},j("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Ub(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...uE.turnServerConfigToIceServers(e.turnServer.servers)),j("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...uE.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),j("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),j("ENABLE_ENCODED_TRANSFORM")&&Ct().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(sm(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!j("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n==null?void 0:n.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:s}=r.getSelectedCandidatePair();S.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(w=>w.track===e._mediaStreamTrack)),!n)return S.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return S.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Ct().supportSetRtpSenderParameters)return S.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}const a=function(y,w){return y.getTransceivers().find(b=>b.sender.track===w||b.receiver.track===w)}(this.peerConnection,e._mediaStreamTrack),A=cDe(e);if(qDe(e)&&a&&n&&A&&this.getLocalVideoStats&&Te(r=["vp8","vp9"]).call(r,this.store.codec)){var u;const y=s.degradationPreference||(Te(u=e._hints).call(u,gn.CUSTOM_TRACK)?j("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(w,b,I,B,M,H){if(FC(w,I),M(b),B!=="balanced"&&B!=="maintain-framerate"&&B!=="maintain-resolution")return;let K=-1;MZ(w,b);const Q=window.setInterval(()=>{const k=mS.get(w);if(!j("ENABLE_AG_ADAPTATION")||!k)return FC(w,I),void M(b);const G=H();if(G.sendPackets>0&&G.OutgoingAvailableBandwidth>0){if(K===-1)return void(K=Date.now());if(Date.now()-K<1e3)return;const $=G.sendFrameRate,ne=G.OutgoingAvailableBandwidth,[q,qe]=zDe(w,$,ne,k.adaptationConfig,b,B);qe&&(I.qualityLimitationReason=qe),q&&k.adaptationConfig.scale!==q.scale&&(S.debug("[".concat(w,"] applyAdaptation: ").concat(I.qualityLimitationReason,`
           sendFps `).concat($,", bwe ").concat(ne,", switch from ").concat(k.adaptationConfig.scale," to ").concat(q.scale," ")),k.adaptationConfig=TD(TD({},k.adaptationConfig),q),M(q))}},j("CHECK_LOCAL_STATS_INTERVAL")),F=TD({},b);mS.set(w,{timer:Q,adaptationConfig:F,originConfig:b,adaptationFunc:M}),S.debug("[".concat(w,"] start adaptation, originConfig: ").concat(JSON.stringify(b),", degradationPreference: ").concat(B))})(this.id+a.mid,A,this,y,w=>{n&&this.updateAdaptation(n,w)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var d;const{bitrateMax:y,frameRate:w,scaleResolutionDownBy:b}=e._encoderConfig;y&&(o.maxBitrate=1e3*y),(Te(d=e._hints).call(d,gn.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(w&&(o.maxFramerate=vo(w)),b&&b>=1&&(o.scaleResolutionDownBy=b))}const{maxFramerate:f}=j("ENCODER_CONFIG_LIMIT");if(f&&typeof f=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,f):f),j("DSCP_TYPE")&&Ud()){var m;const y=j("DSCP_TYPE");Te(m=["very-low","low","medium","high"]).call(m,y)&&(o.networkPriority=y)}const g=n.getParameters(),v=(i=g.encodings)===null||i===void 0?void 0:i[0];Vn()&&!v&&(s.encodings=[o]),v&&Object.assign(v,o),Object.assign(g,s),S.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await n.setParameters(g),await async function(y,w,b){try{var I;if(!Ct().supportSetRtpSenderParameters||!function(Q){return Q==="vp9"}(y)||!j("ENABLE_SVC"))return;const B={},M={},H=w.getParameters(),K=(I=H.encodings)===null||I===void 0?void 0:I[0];M.scalabilityMode=cU(b),K&&Object.assign(K,M),Object.assign(H,B),await w.setParameters(H),S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(H.encodings)))}catch(B){S.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",B)}}(this.store.codec,n,j("SVC_MODE"))}async updateAdaptation(e,n){var r,i;if(!e)return S.debug("[updateAdaptation] no rtpSender found");if(!Ct().supportSetRtpSenderParameters)return S.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const s={},{bitrateMax:o,frameRate:a,scaleResolutionDownBy:A}=n;o&&(s.maxBitrate=1e3*o),a&&(s.maxFramerate=vo(a)),A&&A>=1&&Te(r=["vp8","vp9"]).call(r,this.store.codec)&&(s.scaleResolutionDownBy=A);const u=e.getParameters(),d=(i=u.encodings)===null||i===void 0?void 0:i[0];d&&Object.assign(d,s),Object.assign(u,{});try{await e.setParameters(u),S.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(u.encodings)))}catch(f){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?S.debug("[updateAdaptation] peerConnection not connected}"):S.debug("[updateAdaptation] updateRtpSenderEncodings failed",f):S.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!Ct().supportSetRtpSenderParameters||e.length!==n.length)return;for(let r=0;r<e.length;r++){const i=e[r],s=n[r];s instanceof dn&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{S.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,r){const i=Jr.parse(e);return n.forEach((s,o)=>{const a=r[o],A=i.mediaDescriptions.find(u=>u.attributes.mid===a);A&&(Zm(A,s),yZ(A,s,this.store.codec))}),Jr.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let A=0;A<e.length;A++){var r,i,s,o,a;const u=e[A],d=n[A];if(d instanceof dn&&!Te(r=d._hints).call(r,gn.LOW_STREAM)&&(i=d._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=d._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=d._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=d._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},m={high:1e3*(d._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:m.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:m.high}];const g=u.sender.getParameters();await u.sender.setParameters(Object.assign(g,f))}}}async applySimulcastEncodings(e,n){if(!Vn()&&e.length===n.length)for(let r=0;r<e.length;r++){const i=n[r];if(i instanceof dn&&this.isVP8Simulcast(i)){const s=e[r],o={},a={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];const A=s.sender.getParameters();await s.sender.setParameters(Object.assign(A,o))}}}isVP8Simulcast(e){var n,r,i,s,o;return!!(e instanceof dn&&j("SIMULCAST")&&this.store.codec==="vp8"&&!Te(n=e._hints).call(n,gn.LOW_STREAM)&&(r=e._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=e._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=e._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,n,r,i){if(j("SDP_LOGGING"))return S.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),e),n==="offer"?s=>{this.logSDPExchange(s,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(Ct().supportPCSetConfiguration){const n=uE.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},Oe(gt.prototype,"updateRemoteRTPCapabilities",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"updateRemoteRTPCapabilities"),gt.prototype),Oe(gt.prototype,"connect",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"connect"),gt.prototype),Oe(gt.prototype,"updateRemoteConnect",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"updateRemoteConnect"),gt.prototype),Oe(gt.prototype,"createDataChannels",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"createDataChannels"),gt.prototype),Oe(gt.prototype,"receive",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"receive"),gt.prototype),Oe(gt.prototype,"batchReceive",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"batchReceive"),gt.prototype),Oe(gt.prototype,"stopReceiving",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"stopReceiving"),gt.prototype),Oe(gt.prototype,"muteRemote",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"muteRemote"),gt.prototype),Oe(gt.prototype,"unmuteRemote",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"unmuteRemote"),gt.prototype),Oe(gt.prototype,"muteLocal",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"muteLocal"),gt.prototype),Oe(gt.prototype,"unmuteLocal",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"unmuteLocal"),gt.prototype),Oe(gt.prototype,"close",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"close"),gt.prototype),Oe(gt.prototype,"updateEncoderConfig",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"updateEncoderConfig"),gt.prototype),Oe(gt.prototype,"updateSendParameters",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"updateSendParameters"),gt.prototype),Oe(gt.prototype,"replaceTrack",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"replaceTrack"),gt.prototype),Oe(gt.prototype,"updateAdaptation",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"updateAdaptation"),gt.prototype),Oe(gt.prototype,"getRemoteSSRC",[Us],Object.getOwnPropertyDescriptor(gt.prototype,"getRemoteSSRC"),gt.prototype),gt);function Us(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PConnection.".concat(e));try{for(var o=arguments.length,a=new Array(o),A=0;A<o;A++)a[A]=arguments[A];return await r.apply(this,a)}finally{s()}},n}var At;function r6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function vA(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?r6(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r6(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function i6(t){var e,n,r,i=2;for(typeof Symbol<"u"&&(n=GDe,r=Symbol.iterator);i--;){if(n&&(e=t[n])!=null)return e.call(t);if(r&&(e=t[r])!=null)return new e0(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function e0(t){function e(n){if(Object(n)!==n)return ye.reject(new TypeError(n+" is not an object."));var r=n.done;return ye.resolve(n.value).then(function(i){return{value:i,done:r}})}return e0=function(n){this.s=n,this.n=n.next},e0.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?ye.resolve({value:n,done:!0}):e(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?ye.reject(n):e(r.apply(this.s,arguments))}},new e0(t)}let VC=(At=class extends Ln{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(Qe.StateChange,e,this._state)}constructor(t,e){super(),N(this,"isPlanB",void 0),N(this,"store",void 0),N(this,"statsUploader",void 0),N(this,"connection",void 0),N(this,"localTrackMap",new Map),N(this,"remoteUserMap",new Map),N(this,"localDataChannels",[]),N(this,"remoteDataChannelMap",new Map),N(this,"pendingLocalTracks",[]),N(this,"pendingRemoteTracks",[]),N(this,"pendingLocalDataChannels",[]),N(this,"pendingRemoteDataChannels",[]),N(this,"statsCollector",void 0),N(this,"shouldForwardP2PCreation",void 0),N(this,"iceFailedCount",0),N(this,"dtlsFailedCount",0),N(this,"mutex",new Pi("P2PChannel-mutex")),N(this,"_state",Bt.Disconnected),N(this,"_pcStatsUploadType",j("NEW_ICE_RESTART")?El.FIRST_CONNECTION:El.OLD_FIRST_CONNECTION),N(this,"_isInRestartIce",!1),N(this,"_isStartRestartIce",!1),N(this,"_restartStates",["disconnected","failed"]),N(this,"_restartTimer",void 0),N(this,"_isFirstConnected",!0),N(this,"handleMuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Bt.Connected)return void i(new ie(L.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const o=this.filterTobeMutedTracks(n);if(o.length===0)return void r();const a=o.find(u=>u[0]==="videoLowTrack");a&&a[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(o.map(u=>{let[,{id:d}]=u;return d}));const A=this.createMuteMessage(o);await Yt(this,Qe.RequestMuteLocal,A),r()}catch(o){i(o)}finally{s()}}),N(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Bt.Connected)return void i(new ie(L.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const o=this.filterTobeUnmutedTracks(n);if(o.length===0)return void r();const a=o.find(u=>u[0]==="videoLowTrack");if(a){const u=a[1];if(u.track._originMediaStreamTrack.stop(),!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ct().supportDualStreamEncoding){const d=n._mediaStreamTrack.clone();u.track._mediaStreamTrack=d,u.track._originMediaStreamTrack=d}else{const d=hU(n,Cv(this,Qe.RequestLowStreamParameter));u.track._mediaStreamTrack=d,u.track._originMediaStreamTrack=d}await new ye((d,f)=>{this.handleReplaceTrack(u.track,d,f,!0)})}await this.connection.unmuteLocal(o.map(u=>{let[,{id:d}]=u;return d}));const A=this.createUnmuteMessage(o);await Yt(this,Qe.RequestUnmuteLocal,A),r()}catch(o){i(o)}finally{s()}}),N(this,"handleUpdateVideoEncoder",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const o=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==Bt.Connected)return void r();const{id:a,track:A}=o;await this.connection.updateSendParameters(a,A),await this.connection.updateEncoderConfig(a,A),this.emit(Qe.UpdateVideoEncoder,A),r()}catch(o){i(o)}finally{s()}}),N(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const o=this.localTrackMap.get(Ae.LocalVideoTrack);if(!this.connection||!o||o.track!==n||this.state!==Bt.Connected)return void r();const{id:a,track:A}=o;await this.connection.updateSendParameters(a,A),r()}catch(o){i(o)}finally{s()}}),N(this,"handleReplaceMixingTrack",async(n,r,i,s)=>{if(!this.connection||this.state!==Bt.Connected)return void r();const o=CD([n]);let a;S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(a=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,o),r()}catch(u){i(u)}finally{var A;(A=a)===null||A===void 0||A()}}),N(this,"handleReplaceTrack",async(n,r,i,s)=>{let o;S.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var a;const u=Array.from(this.localTrackMap.entries()).find(d=>{let[,{track:f}]=d;return n===f});if(!this.connection||!u||this.state!==Bt.Connected)return void r();if(await((a=this.connection)===null||a===void 0?void 0:a.replaceTrack(n,u[1].id)),this.isPlanB){const d=u[1];d.id=n._mediaStreamTrack.id,this.localTrackMap.set(u[0],d)}if(u[0]===Ae.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ct().supportDualStreamEncoding){const d=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(d){const f=n._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=f,d.track._originMediaStreamTrack=f,await new ye((m,g)=>{this.handleReplaceTrack(d.track,m,g,!0)})}}r()}catch(u){i(u)}finally{var A;(A=o)===null||A===void 0||A()}}),N(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),N(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),N(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),N(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),N(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new kZ(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!Ct().supportUnifiedPlan||j("CHROME_FORCE_PLAN_B")&&Ud(),this.shouldForwardP2PCreation=j("FORWARD_P2P_CREATION")&&Ct().supportPCSetConfiguration&&yk(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new G_({},this.store):new Lc({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=Bt.New;const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(S.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new G_(t,this.store):new Lc(t,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new ie(L.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=j("NEW_ICE_RESTART")?El.FIRST_CONNECTION:El.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new ie(L.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");j("ENABLE_PREALLOC_PC")&&this.state===Bt.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bt.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(i=>{var s;let[o]=i;return Te(s=[Ae.LocalVideoLowTrack,Ae.LocalVideoTrack]).call(s,o)}),n=e.map(i=>{let[,{id:s}]=i;return s}),r=e.map(i=>{let[s]=i;return s});if(this.connection instanceof Lc){if(Le.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!Te(t).call(t,this.store.codec)){const i=["vp9","vp8","h264"].find(s=>Te(t).call(t,s));i&&(this.store.codec=i,S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof Lc&&this.connection.peerConnectionState!=="closed"&&Te(t=[Bt.New,Bt.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==Bt.Connected){if(this.state===Bt.Disconnected)throw new ie(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var r;Te(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var r=this;return Gc(function*(){const i=yield Rt(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==Bt.Connected){if(r.state===Bt.Disconnected)throw new ie(L.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(t);const o=t.filter(a=>r.pendingLocalTracks.indexOf(a)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(o))}r.store.pubId=r.store.pubId+1,Ui.markPublishStart(r.store.clientId,r.store.pubId);const s=r.filterTobePublishedTracks(t,e,n);if(s.length===0)return void(yield Rt(r.tryToUnmuteAudio(t)));yield*zG(i6(r.doPublish(r.connection,s)))}finally{i()}})()}doPublish(t,e){var n=this;return Gc(function*(){e.forEach(f=>{let{track:m,type:g}=f;const v=Date.now();n.store.publish(m.getTrackId(),g===Ae.LocalAudioTrack?"audio":"video",v)}),n.bindLocalTrackEvents(e);const r=e.map(f=>{let{track:m}=f;return m}),i=yield Rt(t.send(e.map(f=>{let{track:m}=f;return m}),n.store.codec,n.store.audioCodec)),s=(yield Rt(i.next())).value,o=n.createGatewayPublishMessage(e,s);let a;try{a=yield o}catch(f){throw i.throw(f),(f==null?void 0:f.code)===L.WS_ABORT&&e.forEach(m=>{let{track:g}=m;n.pendingLocalTracks.indexOf(g)===-1&&n.pendingLocalTracks.push(g)}),n.unbindLocalTrackEvents(e),f}const A=n.mapPubResToRemoteConfig(o,a),u=(yield Rt(i.next(A))).value,d=j("ENABLE_VIDEO_SEI");r.forEach(async f=>{const m=f.getRTCRtpTransceiver();m&&d&&(f.trackMediaType===Ue.VIDEO?await fDe(m.sender,f):f.trackMediaType===Ue.AUDIO&&await async function(g){if(!Ct().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(DC.has(g)||!g.track)return;const v={track:g.track};if(gd()){if(!g.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let w=null;try{w=g.createEncodedStreams()}catch(I){return void S.error("create audio-encoded-streams error",I&&I.message)}const b=new TransformStream({transform(I,B){v.controller||(v.controller=B),g.track&&g.track.id!==v.track.id&&(S.debug("audio track changed: ".concat(v.track.id," => ").concat(g.track.id)),v.track.removeEventListener("ended",y),v.track=g.track,v.track.addEventListener("ended",y)),B.enqueue(I)}});w.readable.pipeThrough(b).pipeTo(w.writable)}else if(hi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const w=JT(),b=new MessageChannel;await new ye(B=>w.onmessage=M=>{M.data==="registered"&&B(void 0)});const I=new RTCRtpScriptTransform(w,{name:"tx",port:b.port2},[b.port2]);g.transform=I,await new ye(B=>w.onmessage=M=>{M.data==="started"&&B(void 0)}),b.port1.onmessage=B=>{var M;B.data.transformed&&g.track&&((M=g.track)===null||M===void 0?void 0:M.id)!==v.track.id&&(S.debug("audio track changed: ".concat(v.track.id," => ").concat(g.track.id)),v.track.removeEventListener("ended",y),v.track=g.track,v.track.addEventListener("ended",y))},v.worker=w}function y(){if(g.track){if(this.id!==g.track.id)return;g.track.removeEventListener("ended",y)}const w=DC.get(g);if(w){DC.delete(g);try{var b,I;(b=w.controller)===null||b===void 0||b.terminate(),(I=w.worker)===null||I===void 0||I.terminate()}catch(B){S.warning(B&&B.message)}}}DC.set(g,v),g.track.addEventListener("ended",y)}(m.sender))}),e.forEach(f=>{let{type:m}=f;n.statsCollector.addLocalStats(m)}),n.assignLocalTracks(e,u),n.statsUploader.startUploadOutboundStats(),e.forEach(f=>{let{track:m,type:g}=f;const v=Date.now();n.store.publish(m.getTrackId(),g===Ae.LocalAudioTrack?"audio":"video",void 0,v)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n)return;if(!(n.track instanceof dn))return S.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof Lc||this.connection instanceof G_))return S.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:r}=n,i=function(s,o){const a={};return s.height&&s.width&&(a.scaleResolutionDownBy=eU(s,o)),a.maxFramerate=s.framerate?vo(s.framerate):void 0,a.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,a}(t,r);if(r._encoderConfig||(r._encoderConfig={}),e!==Ae.LocalVideoLowTrack||!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ct().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const s=r._originMediaStreamTrack;if(!s.canvas)return S.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(o,a){const A=o.canvas;a.width&&(A.width=vo(a.width)),a.height&&(A.height=vo(a.height)),a.framerate&&(A.stopCapture&&A.stopCapture(),A.stopCapture=Lk(()=>{!A.startCapture&&A.stopCapture&&A.stopCapture(),A.startCapture&&A.startCapture()},vo(a.framerate)))})(s,t)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),S.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(t){var e=this;return Gc(function*(){if(!e.connection||e.state!==Bt.Connected)return;const n=yield Rt(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=e.localTrackMap.get(Ae.LocalVideoTrack);if(!i)throw new ie(L.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(Ae.LocalVideoLowTrack))throw new ie(L.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:e.getLowVideoTrack(i.track,t),type:Ae.LocalVideoLowTrack}];if(yield*zG(i6(e.doPublish(e.connection,s))),i.track.muted||!i.track.enabled){var r;const o=(r=e.localTrackMap.get(Ae.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;o!==void 0&&(yield Rt(e.connection.muteLocal([o])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(S.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await fi(this,Qe.RequestRePublish,this.pendingLocalTracks),this.emit(Qe.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(S.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await fi(this,Qe.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:r}=this.pendingRemoteTracks[e];(r!==Ue.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==Ue.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await fi(this,Qe.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===Ue.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(Qe.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==Bt.Connected)return void t.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==Bt.Connected)return void t.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Bt.Connected)return;const t=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[Ae.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[i,{track:s}]=r;return{type:i,track:s}})),e.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==Bt.Connected)throw new ie(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(t))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(t)?(i=this.remoteDataChannelMap.get(t))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(t,new Map([[r.id,r]]));const s=this.pendingRemoteDataChannels.findIndex(o=>{let{user:a,id:A}=o;return a.uid===t.uid&&A===r.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),n.map(r=>r.id)}async subscribe(t,e,n,r,i){var s;if(!this.connection||this.state!==Bt.Connected)throw new ie(L.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(t))!==null&&s!==void 0&&s.has(e))return;let o,a,A;const u=this.connection.getPreMedia(n);if(u)S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),A=u.transceiver,o=u.track,a=u.id;else if(i){const m=i.find(v=>{let{stream_type:y}=v;return y===e});if(!m)throw new ie(L.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const g=await this.connection.receive(e,m.ssrcs,String(t._uintid),m.attributes);this.connection instanceof Lc&&(A=g.transceiver),o=g.track,a=g.id}else{const m=await this.connection.receive(e,[{ssrcId:n,rtx:r}],String(t._uintid),void 0);this.connection instanceof Lc&&(A=m.transceiver),o=m.track,a=m.id}e===Ue.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(o):(t._audioTrack=new Cm(o,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),A&&t._audioTrack._updateRtpTransceiver(A),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(o):(t._videoTrack=new wm(o,t.uid,t._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),A&&t._videoTrack._updateRtpTransceiver(A),this.bindRemoteTrackEvents(t,t._videoTrack)),j("ENABLE_VIDEO_SEI")&&A&&(e==Ue.VIDEO?await async function(m){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Ct().supportWebRTCEncodedTransform)return void S.warning("browser not support video encoded transform");if(!m.track)return;if(K_.has(m)){const w=K_.get(m);return void(w&&(w.onSei=g.onSei))}const v={track:m.track,onSei:g.onSei};if(gd()){if(!m.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let w=null;try{w=m.createEncodedStreams()}catch(I){return void S.error("create video-encoded-streams error",I&&I.message)}const b=new TransformStream({transform(I,B){v.controller||(v.controller=B),m.track&&m.track.id!==v.track.id&&(S.debug("video track changed: ".concat(v.track.id," => ").concat(m.track.id)),v.track.removeEventListener("ended",y),v.track=m.track,v.track.addEventListener("ended",y));const M=function(H){const K=new DataView(H.data);let Q=0;for(;Q+4<H.data.byteLength;){if(K.getUint8(Q+0)===0&&K.getUint8(Q+1)===0&&K.getUint8(Q+2)===0&&K.getUint8(Q+3)===1&&K.getUint8(Q+4)===6){let F=Q+6,k=0,G=0;for(;(G=K.getUint8(F++))===255;)k+=255;k+=G;const $=hDe(H.data,F,k);return new Uint8Array($)}Q++}return null}(I);M&&v.onSei&&v.onSei(M),B.enqueue(I)}});w.readable.pipeThrough(b).pipeTo(w.writable)}else if(hi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const w=JT(),b=new MessageChannel;await new ye(B=>w.onmessage=M=>{M.data==="registered"&&B(void 0)});const I=new RTCRtpScriptTransform(w,{name:"rx",port:b.port2},[b.port2]);m.transform=I,await new ye(B=>w.onmessage=M=>{M.data==="started"&&B(void 0)}),b.port1.onmessage=B=>{var M;B.data.transformed&&m.track&&((M=m.track)===null||M===void 0?void 0:M.id)!==v.track.id?(S.debug("video track changed: ".concat(v.track.id," => ").concat(m.track.id)),v.track.removeEventListener("ended",y),v.track=m.track,v.track.addEventListener("ended",y)):B.data.sei&&v.onSei&&v.onSei(B.data.sei)},v.worker=w}function y(){if(m.track){if(this.id!==m.track.id)return;m.track.removeEventListener("ended",y)}(function(w){const b=K_.get(w);if(b){K_.delete(w);try{var I,B;(I=b.controller)===null||I===void 0||I.terminate(),(B=b.worker)===null||B===void 0||B.terminate()}catch(M){S.warning(M&&M.message)}}})(m)}K_.set(m,v),m.track.addEventListener("ended",y)}(A.receiver,{onSei:m=>{var g;(g=t._videoTrack)===null||g===void 0||g._onSei(m)}}):e==Ue.AUDIO&&await async function(m){if(!Ct().supportWebRTCEncodedTransform)return void S.warning("browser not support audio encoded transform");if(BC.has(m))return;const g={track:m.track};if(gd()){if(!m.createEncodedStreams)return void S.warning("browser not support createEncodedStreams() API");let y=null;try{y=m.createEncodedStreams()}catch(b){return void S.error("create audio-encoded-streams error",b&&b.message)}const w=new TransformStream({transform(b,I){g.controller||(g.controller=I),m.track&&m.track.id!==g.track.id&&(S.debug("audio track changed: ".concat(g.track.id," => ").concat(m.track.id)),g.track.removeEventListener("ended",v),g.track=m.track,g.track.addEventListener("ended",v)),I.enqueue(b)}});y.readable.pipeThrough(w).pipeTo(y.writable)}else if(hi()){if(typeof RTCRtpScriptTransform>"u")return void S.warning("browser not support RTCRtpScriptTransform");const y=JT(),w=new MessageChannel;await new ye(I=>y.onmessage=B=>{B.data==="registered"&&I(void 0)});const b=new RTCRtpScriptTransform(y,{name:"rx",port:w.port2},[w.port2]);m.transform=b,await new ye(I=>y.onmessage=B=>{B.data==="started"&&I(void 0)}),w.port1.onmessage=I=>{var B;I.data.transformed&&m.track&&((B=m.track)===null||B===void 0?void 0:B.id)!==g.track.id&&(S.debug("audio track changed: ".concat(g.track.id," => ").concat(m.track.id)),g.track.removeEventListener("ended",v),g.track=m.track,g.track.addEventListener("ended",v))},g.worker=y}function v(){m.track.removeEventListener("ended",v),function(y){const w=BC.get(y);if(w){BC.delete(y);try{var b,I;(b=w.controller)===null||b===void 0||b.terminate(),(I=w.worker)===null||I===void 0||I.terminate()}catch(B){S.warning(B&&B.message)}}}(m)}BC.set(m,g),m.track.addEventListener("ended",v)}(A.receiver));const d=this.remoteUserMap.get(t);d?d.set(e,a):this.remoteUserMap.set(t,new Map([[e,a]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const f=this.pendingRemoteTracks.findIndex(m=>{let{user:g,kind:v}=m;return g.uid===t.uid&&e===v});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Qe.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==Bt.Connected)throw new ie(L.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(i=>{var s;let{user:o,mediaType:a}=i;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(a))});const e=[],n=new Map;t.forEach(i=>{if(!this.connection)return;const s=this.connection.getPreMedia(i.ssrcId);s?n.set(i.ssrcId,s):e.push(i)});const r=await this.connection.batchReceive(e.map(i=>{let{user:s,mediaType:o,ssrcId:a,rtxSsrcId:A}=i;return{kind:o,ssrcMsg:[{ssrcId:a,rtx:A}],mslabel:String(s._uintid)}}));e.forEach((i,s)=>{n.set(i.ssrcId,r[s])}),t.forEach(i=>{let{user:s,mediaType:o,ssrcId:a}=i;const A=n.get(a);if(!A)return void S.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(o,", ").concat(a));const{track:u,id:d,transceiver:f}=A;o===Ue.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(u):(s._audioTrack=new Cm(u,s.uid,s._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),f&&s._audioTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(u):(s._videoTrack=new wm(u,s.uid,s._uintid,this.store),S.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),f&&s._videoTrack._updateRtpTransceiver(f),this.bindRemoteTrackEvents(s,s._videoTrack));const m=this.remoteUserMap.get(s);m?m.set(o,d):this.remoteUserMap.set(s,new Map([[o,d]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const g=this.pendingRemoteTracks.findIndex(v=>{let{user:y,kind:w}=v;return y.uid===s.uid&&o===w});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(Qe.MediaReconnectEnd,s.uid))})}async unsubscribe(t,e,n){const r=this.pendingRemoteTracks.filter(o=>{let{user:a,kind:A}=o;return e!==void 0?a.uid===t.uid&&e===A:a.uid===t.uid});if(r.forEach(o=>{const a=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(a,1)}),this.connection&&this.state===Bt.Connected||n||r.forEach(o=>{let{kind:a}=o;var A;if(a===Ue.AUDIO)(A=t._audioTrack)===null||A===void 0||A._destroy(),t._audioTrack=void 0;else if(a===Ue.VIDEO){var u;(u=t._videoTrack)===null||u===void 0||u._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==Bt.Connected)return;const i=this.filterTobeUnSubscribedTracks(t,e);if(i.length===0)return;await this.connection.stopReceiving(i.map(o=>{let[,{id:a}]=o;return a}));const s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(o=>{let[a,{kind:A}]=o;var u,d;if(A===Ue.VIDEO&&a._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),A===Ue.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),n||((d=a._videoTrack)===null||d===void 0||d._destroy(),a._videoTrack=void 0);else if(A===Ue.AUDIO){var f;this.unbindRemoteTrackEvents(a._audioTrack),!n&&((f=a._audioTrack)===null||f===void 0||f._destroy(),a._audioTrack=void 0)}}),s}async unsubscribeDataChannel(t,e){if(e.forEach(i=>{const s=this.pendingRemoteDataChannels.findIndex(o=>o.id===i.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(t);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(i=>i.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:i,mediaType:s}of t){const o=this.pendingRemoteTracks.filter(a=>{let{user:A,kind:u}=a;return s!==void 0?A.uid===i.uid&&s===u:A.uid===i.uid});o.forEach(a=>{const A=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(A,1)}),e=e.concat(o)}if(!this.connection||this.state!==Bt.Connected)return void e.forEach(i=>{let{user:s,kind:o}=i;var a;if(o===Ue.AUDIO)(a=s._audioTrack)===null||a===void 0||a._destroy(),s._audioTrack=void 0;else if(o===Ue.VIDEO){var A;(A=s._videoTrack)===null||A===void 0||A._destroy(),s._videoTrack=void 0}});const n=qc(t).call(t,(i,s)=>{let{user:o,mediaType:a}=s;const A=this.filterTobeUnSubscribedTracks(o,a);return i.concat(A)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(i=>{let[,{id:s}]=i;return s}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[s,{kind:o}]=i;var a,A;if(o===Ue.VIDEO&&s._videoSSRC&&((a=this.connection)===null||a===void 0||a.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===Ue.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(A=s._videoTrack)===null||A===void 0||A._destroy(),s._videoTrack=void 0;else if(o===Ue.AUDIO){var u;this.unbindRemoteTrackEvents(s._audioTrack),(u=s._audioTrack)===null||u===void 0||u._destroy(),s._audioTrack=void 0}}),r}isPreSubScribe(t){return!this.connection||this.state!==Bt.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void S.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const r=e===Ue.VIDEO?t._videoSSRC:t._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||S.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(Ae.LocalAudioTrack);if((e==null?void 0:e.track)instanceof yr){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==Ae.LocalAudioTrack}).filter(r=>{let[i]=r;return!(t&&i===Ae.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(t&&r===Ae.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,r,i){if(t){const o=this.localTrackMap.get(Ae.LocalAudioTrack),a=r?this.localTrackMap.get(Ae.LocalVideoLowTrack):this.localTrackMap.get(Ae.LocalVideoTrack);Le.publish(this.store.sessionId,{eventElapse:Ui.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:o==null?void 0:o.track.getTrackLabel(),videoName:a==null?void 0:a.track.getTrackLabel(),screenshare:(a==null?void 0:a.track._hints.indexOf(gn.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;n||(n=[]);const o=n.find(A=>A instanceof xn),a=r?(s=this.localTrackMap.get(Ae.LocalVideoTrack))===null||s===void 0?void 0:s.track:n.find(A=>A instanceof dn);Le.publish(this.store.sessionId,{eventElapse:Ui.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:o==null?void 0:o.getTrackLabel(),videoName:a==null?void 0:a.getTrackLabel(),screenshare:(a==null?void 0:a._hints.indexOf(gn.SCREEN_TRACK))!==-1,audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(t,e,n,r){const i=r===Ue.VIDEO?n._videoSSRC:n._audioSSRC;i&&Le.subscribe(this.store.sessionId,{succ:t,ec:e,video:r===Ue.VIDEO,audio:r===Ue.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:Ui.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){S.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Pi("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new G_({},this.store):new Lc({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Ae.LocalAudioTrack);if((t==null?void 0:t.track)instanceof yr){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Bt.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Ae.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Ae.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof dn||e&&e.track instanceof xn?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(Mo(e=this.remoteUserMap).call(e)).find(r=>r.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(Ae.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=yy(t).call(t,(n,r)=>n.level-r.level),t}async disconnectForReconnect(){this.connection&&(S.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Bt.Reconnecting,j("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new G_({},this.store):new Lc({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:r}]=t;switch(n){case Ae.LocalVideoTrack:Te(e=r._hints).call(e,gn.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case Ae.LocalAudioTrack:r instanceof yr?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case Ae.LocalVideoLowTrack:}}),this.emit(Qe.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Mo(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(e,r)}),this.emit(Qe.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(Mo(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(e,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),S.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((t instanceof Ju?t.uid:t)===r.uid&&i===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((t instanceof Ju?t.uid:t)===r.uid&&e===i)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return Gc(function*(){if(!e.connection||e.state!==Bt.Connected)return;const n=yield Rt(e.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield Rt(e.connection.restartICE(t));const s=yield Rt(r.next());if(s.done)return;const o=s.value,a=yield o;switch(e.reportPCDisconnectedOrFailed(t),t){case _o.TCP:e._pcStatsUploadType=El.TCP_RESTART;break;case _o.RELAY:e._pcStatsUploadType=El.RELAY_RESTART;break;default:e._pcStatsUploadType=El.OLD_RESTART}e._isInRestartIce=!0,r.next(a)}catch(s){var i;(i=r)===null||i===void 0||i.throw(s)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(Ae.LocalVideoTrack),n=this.localTrackMap.get(Ae.LocalAudioTrack),r=t.videoSend.find(g=>g.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),i=t.audioSend.find(g=>g.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!i)return 1;const s=va(this,Qe.NeedSignalRTT),o=r?r.rttMs:void 0,a=i?i.rttMs:void 0,A=o&&a?(o+a)/2:o||a,u=(A&&s?(A+s)/2:A||s)||0,d=100*t.sendPacketLossRate*.7/50+.3*u/1500,f=d<.17?1:d<.36?2:d<.59?3:d<.1?4:5,m=e==null?void 0:e.track;if(m&&m._encoderConfig&&m._hints.indexOf(gn.SCREEN_TRACK)===-1){const g=m._encoderConfig.bitrateMax,v=t.bitrate.actualEncoded;if(g&&v){const y=(1e3*g-v)/(1e3*g);return D$[y<.15?0:y<.3?1:y<.45?2:y<.6?3:4][f]}}return f}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,s=r._videoSSRC,o=t.audioRecv.find(v=>v.ssrc===i),a=t.videoRecv.find(v=>v.ssrc===s);if(!o&&!a)return void(e+=1);const A=va(this,Qe.NeedSignalRTT),u=t.rtt,d=(u&&A?(u+A)/2:u||A)||0,f=o?o.jitterMs:void 0,m=t.recvPacketLossRate;let g=.7*m*100/50+.3*d/1500;f&&(g=.6*m*100/50+.2*d/1500+.2*f/400),e+=g<.1?1:g<.17?2:g<.36?3:g<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new ye((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(S.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==Bt.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return t===o});if(!r)return;const i=r[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:i}]),this.bindLocalTrackEvents([{track:e,type:i}]),r[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,r[1].id)),this.isPlanB){const s=r[1];s.id=e._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===Ae.LocalVideoTrack&&!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ct().supportDualStreamEncoding){const s=this.localTrackMap.get(Ae.LocalVideoLowTrack);if(s){const o=t._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new ye((a,A)=>{this.handleReplaceTrack(s.track,a,A,!0)})}}}filterTobePublishedTracks(t,e,n){const r=[],i=this.getAllTracks();t=rm(t=t.filter(A=>i.indexOf(A)===-1));let s,o=!1;const a=this.localTrackMap.get(Ae.LocalAudioTrack);for(const A of t){if(A instanceof dn&&(this.localTrackMap.has(Ae.LocalVideoTrack)||o?new ie(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:A,type:Ae.LocalVideoTrack}),o=!0),e)){const u=this.getLowVideoTrack(A,n);r.push({track:u,type:Ae.LocalVideoLowTrack})}if(A instanceof xn)if(a){const u=a.track;if(u instanceof yr)fU([A]),u.addAudioTrack(A),this.bindLocalAudioTrackEvents(A,!0);else{const d=CD([u,A]);S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(d.getTrackId(),"]")),this.replaceTrack(u,d)}}else s instanceof yr?(fU([A]),s.addAudioTrack(A)):s||!A._useAudioElement&&Ct().webAudioMediaStreamDest&&!A._bypassWebAudio?s=CD(s?[A,s]:[A]):s=A}return s&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),r.push({track:s,type:Ae.LocalAudioTrack})),r}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=rm(t=t.filter(r=>n.indexOf(r)!==-1));for(const r of t){if(r instanceof xn){const i=this.localTrackMap.get(Ae.LocalAudioTrack);if(!i)continue;i.track instanceof yr?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(e.push([Ae.LocalAudioTrack,i]),i.track.close())):e.push([Ae.LocalAudioTrack,i])}if(r instanceof dn){const i=this.localTrackMap.get(Ae.LocalVideoTrack);if(!i)continue;e.push([Ae.LocalVideoTrack,i]);const s=this.localTrackMap.get(Ae.LocalVideoLowTrack);s&&e.push([Ae.LocalVideoLowTrack,s])}}return e}filterTobePublishedDataChannels(t){return t=(t=rm(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=rm(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:r}=e;switch(r){case Ae.LocalVideoTrack:n.addListener(Se.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Se.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Se.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Se.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case Ae.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof yr?t.trackList.forEach(n=>{n.addListener(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Se.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(Se.GET_STATS,this.handleGetLocalAudioStats),t.addListener(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Se.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:r}]=e;return{track:r,type:n}})),t.forEach(e=>{let{track:n,type:r}=e;switch(r){case Ae.LocalVideoTrack:n.off(Se.GET_STATS,this.handleGetLocalVideoStats),n.off(Se.GET_RTC_STATS,this.handleGetRTCStats),n.off(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Se.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Se.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Ae.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case Ae.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof yr?t.trackList.forEach(e=>{e.off(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Se.GET_STATS,this.handleGetLocalAudioStats),e.off(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(Se.GET_STATS,this.handleGetLocalAudioStats),t.off(Se.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Se.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Se.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Se.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(Se.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Se.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof wm&&e.addListener(Se.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Cm&&e.addListener(Se.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(Se.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(Ue.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(Ue.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,r)=>{var i;let s,o,{track:a,type:A}=n;switch(A){case Ae.LocalAudioTrack:s=Lt.Audio,o={dtx:a instanceof dS&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Ae.LocalVideoTrack:s=Te(i=a._hints).call(i,gn.SCREEN_TRACK)?Lt.Screen:Lt.High,o=vA(vA({},$3(a)),{},{codec:this.store.codec,svc_mode:cU()});break;case Ae.LocalVideoLowTrack:s=Lt.Low,o=vA(vA({},$3(a)),{},{codec:this.store.codec,svc_mode:cU()})}return{stream_type:s,attributes:o,ssrcs:e[r]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case Ae.LocalVideoTrack:r=Te(n=s._hints).call(n,gn.SCREEN_TRACK)?Lt.Screen:Lt.High;break;case Ae.LocalAudioTrack:r=Lt.Audio;break;case Ae.LocalVideoLowTrack:r=Lt.Low}return{stream_type:r,ssrcs:o,mid:a}})}assignLocalTracks(t,e){t.forEach((n,r)=>{let{track:i,type:s}=n;this.localTrackMap.set(s,{track:i,id:e[r].id,ssrcs:e[r].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(Qe.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),j("NEW_ICE_RESTART")){var n;if(Te(n=this._restartStates).call(n,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=o=>{(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")&&(S.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(o)),va(this,Qe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Qe.RequestRestartICE,o))},i=()=>{t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="checking"&&t.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),S.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Qe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},s=j("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(j("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Ct().supportPCSetConfiguration)r(_o.RELAY),this._restartTimer=window.setTimeout(i,s);else if(Vn())r(_o.UDP),this._restartTimer=window.setTimeout(i,4e3);else{if(r(_o.TCP),Ct().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{r(_o.RELAY),this._restartTimer=window.setTimeout(i,s)},s));this._restartTimer=window.setTimeout(i,s)}},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&j("ICE_RESTART")&&va(this,Qe.QueryClientConnectionState)==="CONNECTED"&&this.emit(Qe.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Qe.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(S.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Qe.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Le.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Mn.TRACER}).onSuccess(),this.emit(Qe.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const r=Array.from(Mo(n=this.remoteUserMap).call(n)).find(s=>s._audioSSRC===e);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(ym.FIRST_FRAME_DECODED),Le.firstRemoteFrame(this.store.sessionId,Wr.FIRST_AUDIO_DECODE,Nn.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:Ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const r=Array.from(Mo(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===e);r&&Le.firstRemoteFrame(this.store.sessionId,Wr.FIRST_AUDIO_RECEIVED,Nn.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:Ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,r)=>{this.reportVideoFirstFrameDecoded(e,n,r)},t.onFirstVideoReceived=e=>{var n;const r=Array.from(Mo(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===e);r&&Le.firstRemoteFrame(this.store.sessionId,Wr.FIRST_VIDEO_RECEIVED,Nn.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:Ui.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const r=e.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(Qe.ConnectionTypeChange,r),S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(sd(n))," -> ").concat(JSON.stringify(sd(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{S.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(sd(n))," -> ").concat(JSON.stringify(sd(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return vA(vA({},e),n)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(Ae.LocalAudioTrack);if(t instanceof xn&&(n==null?void 0:n.track)instanceof yr)return n.track.isActive||e.push([Ae.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return t===s});if(r&&(e.push(r),r[0]===Ae.LocalVideoTrack)){const i=this.localTrackMap.get(Ae.LocalVideoLowTrack);i&&e.push([Ae.LocalVideoLowTrack,i])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(Ae.LocalAudioTrack);if(t instanceof xn&&(n==null?void 0:n.track)instanceof yr)return n.track.isActive&&e.push([Ae.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return t===s});if(r)if(r[0]===Ae.LocalVideoTrack){e.push(r);const i=this.localTrackMap.get(Ae.LocalVideoLowTrack);i&&e.push([Ae.LocalVideoLowTrack,i])}else e.push(r);return e}createMuteMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case Ae.LocalAudioTrack:r=Lt.Audio;break;case Ae.LocalVideoTrack:r=Te(n=s._hints).call(n,gn.SCREEN_TRACK)?Lt.Screen:Lt.High;break;case Ae.LocalVideoLowTrack:r=Lt.Low}return{stream_type:r,ssrcs:o,mid:a}})}createUnmuteMessage(t){return t.map(e=>{var n;let r,[i,{track:s,ssrcs:o,id:a}]=e;switch(i){case Ae.LocalAudioTrack:r=Lt.Audio;break;case Ae.LocalVideoTrack:r=Te(n=s._hints).call(n,gn.SCREEN_TRACK)?Lt.Screen:Lt.High;break;case Ae.LocalVideoLowTrack:r=Lt.Low}return{stream_type:r,ssrcs:o,mid:a}})}filterTobeUnSubscribedTracks(t,e){const n=[],r=this.remoteUserMap.get(t);if(!r)return n;if(e){const i=r.get(e);if(!i)return n;n.push([t,{kind:e,id:i}])}else Array.from(r.entries()).forEach(i=>{let[s,o]=i;n.push([t,{kind:s,id:o}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(t))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[r,{kind:i,id:s}]=n;switch(i){case Ue.VIDEO:return void(r._videoSSRC&&e.push({stream_type:Ue.VIDEO,ssrcId:r._videoSSRC}));case Ue.AUDIO:return void(r._audioSSRC&&e.push({stream_type:Ue.AUDIO,ssrcId:r._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[r,{kind:i}]=n;if(e.has(r)){let s=e.get(r);i===Ue.VIDEO?s|=Pr.Video:s|=Pr.Audio,e.set(r,s)}else i===Ue.VIDEO?e.set(r,Pr.Video):e.set(r,Pr.Audio)}),{users:Array.from(e.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:r}]=e;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(Ae.LocalVideoTrack),n=this.localTrackMap.get(Ae.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e){return t.map((n,r)=>{var i;let{stream_type:s}=n;return(i=e.find(o=>{let{stream_type:a}=o;return s===a}))===null||i===void 0?void 0:i.attributes})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof xn){var e;const r=this.filterTobeUnmutedTracks(t[n]);if(r.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(r.map(s=>{let[,{id:o}]=s;return o})));const i=this.createUnmuteMessage(r);return void await Yt(this,Qe.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(Qe.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(Qe.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Zr(Ck(this.dtlsFailedCount,hr)),this.emit(Qe.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await fi(this,Qe.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(Qe.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Ae.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof dn)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof dn).length>1)throw new ie(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof xn).length>1&&(t.some(e=>e instanceof xn&&e._bypassWebAudio)||!Ct().webAudioMediaStreamDest))throw new ie(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof dn&&this.pendingLocalTracks.some(n=>n instanceof dn))throw new ie(L.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof xn&&this.pendingLocalTracks.some(n=>n instanceof xn)&&(!Ct().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof xn&&n._bypassWebAudio)))throw new ie(L.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!j("DISABLE_DUAL_STREAM_USE_ENCODING")&&Ct().supportDualStreamEncoding,r=vA(vA({},{width:160,height:120,framerate:15,bitrate:50}),e);let i;i=n?t._mediaStreamTrack.clone():hU(t,r);const s=tn(8,"track-low-"),o=new dn(i,vA(vA({},n&&{scaleResolutionDownBy:eU(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,s);return o.on(ef.TRANSCEIVER_UPDATED,a=>{t._updateRtpTransceiver(a,$m.LOW_STREAM)}),o._hints.push(gn.LOW_STREAM),t.on("sei-to-send",a=>{o.emit("sei-to-send",a)}),t.addListener(Se.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Lc){var i,s,o,a;const A=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u,dtlsTransportState:d,peerConnectionState:f}=this.connection,{local:m,remote:g}=await this.connection.getSelectedCandidatePair();Le.pcStats(this.store.sessionId,{startTime:A,eventElapse:t-A||0,iceconnectionsate:u,dtlsstate:d,connectionstate:f,intSucc:e?1:2,error:r,selectedLocalCandidateProtocol:(i=m==null?void 0:m.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=m.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(m.address,":").concat(m.port),selectedRemoteCandidateProtocol:(o=g.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(a=g.candidateType)!==null&&a!==void 0?a:"",selectedRemoteCandidateAddress:"".concat(g.address,":").concat(g.port),restartCnt:n,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(t,e,n,r){var i;const s=Array.from(Mo(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===t);if(s){r||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const o=this.store.keyMetrics,a=o.subscribe.find(A=>A.userId===s.uid&&A.type==="video");Le.firstRemoteVideoDecode(this.store.sessionId,Wr.FIRST_VIDEO_DECODE,Nn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:Ui.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:(a==null?void 0:a.subscribeEnd)||0,subscriberStart:(a==null?void 0:a.subscribeStart)||0,videoAddNotify:(a==null?void 0:a.streamAdded)||0,state:r?1:0,firstFrame:(a==null?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(t);if(!r)return!1;const i=r.get(e);if(!i)return!1;const s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===Ae.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,$m.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(t){this.connection&&this.connection instanceof Lc&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===El.TCP_RESTART&&t===_o.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,El.DISCONNECTED_OR_FAILED)))}},Oe(At.prototype,"startP2PConnection",[es],Object.getOwnPropertyDescriptor(At.prototype,"startP2PConnection"),At.prototype),Oe(At.prototype,"connect",[es],Object.getOwnPropertyDescriptor(At.prototype,"connect"),At.prototype),Oe(At.prototype,"updateRemoteRTPCapabilities",[es],Object.getOwnPropertyDescriptor(At.prototype,"updateRemoteRTPCapabilities"),At.prototype),Oe(At.prototype,"publishDataChannel",[es],Object.getOwnPropertyDescriptor(At.prototype,"publishDataChannel"),At.prototype),Oe(At.prototype,"unpublish",[es],Object.getOwnPropertyDescriptor(At.prototype,"unpublish"),At.prototype),Oe(At.prototype,"unpublishDataChannel",[es],Object.getOwnPropertyDescriptor(At.prototype,"unpublishDataChannel"),At.prototype),Oe(At.prototype,"unpublishLowStream",[es],Object.getOwnPropertyDescriptor(At.prototype,"unpublishLowStream"),At.prototype),Oe(At.prototype,"subscribeDataChannel",[es],Object.getOwnPropertyDescriptor(At.prototype,"subscribeDataChannel"),At.prototype),Oe(At.prototype,"subscribe",[es],Object.getOwnPropertyDescriptor(At.prototype,"subscribe"),At.prototype),Oe(At.prototype,"massSubscribe",[es],Object.getOwnPropertyDescriptor(At.prototype,"massSubscribe"),At.prototype),Oe(At.prototype,"unsubscribe",[es],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribe"),At.prototype),Oe(At.prototype,"unsubscribeDataChannel",[es],Object.getOwnPropertyDescriptor(At.prototype,"unsubscribeDataChannel"),At.prototype),Oe(At.prototype,"massUnsubscribe",[es],Object.getOwnPropertyDescriptor(At.prototype,"massUnsubscribe"),At.prototype),Oe(At.prototype,"muteRemote",[es],Object.getOwnPropertyDescriptor(At.prototype,"muteRemote"),At.prototype),Oe(At.prototype,"unmuteRemote",[es],Object.getOwnPropertyDescriptor(At.prototype,"unmuteRemote"),At.prototype),Oe(At.prototype,"hasRemoteMediaWithLock",[es],Object.getOwnPropertyDescriptor(At.prototype,"hasRemoteMediaWithLock"),At.prototype),Oe(At.prototype,"disconnectForReconnect",[es],Object.getOwnPropertyDescriptor(At.prototype,"disconnectForReconnect"),At.prototype),Oe(At.prototype,"updateBitrateLimit",[es],Object.getOwnPropertyDescriptor(At.prototype,"updateBitrateLimit"),At.prototype),Oe(At.prototype,"remoteMediaSsrcChanged",[es],Object.getOwnPropertyDescriptor(At.prototype,"remoteMediaSsrcChanged"),At.prototype),At);function es(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,s=await i.lock("From P2PChannel.".concat(e));try{for(var o=arguments.length,a=new Array(o),A=0;A<o;A++)a[A]=arguments[A];return await r.apply(this,a)}finally{s()}},n}const VZ={};function z_(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&S.debug("install service ".concat(t.name)),VZ[t.name]=t}function dE(t){const e=VZ[t];if(!e)throw new ie(L.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function s6(t,e){return dE("DataStream").create(t,e)}function o6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function a6(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?o6(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o6(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const YDe=Date.now(),XDe=20,pU=new Map,t0=new Map;async function QZ(t){const e=pU.get(t),n=Array.isArray(e)&&e[e.length-1],r=t0.get(t);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const s=n.sendTs-r.firstSendTs,o=s-(Date.now()-r.firstRecvTs);o>0&&(r.firstRecvTs=Date.now()-s);let a=n.mediaDelay+o;a<=0?(e.pop(),HZ(n.context,i),a=0):a=Math.min(a,XDe),setTimeout(()=>e.length&&QZ(t),a)}function HZ(t,e){t.safeEmit(pt.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function JDe(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return HZ(n,{uid:t.uid,payload:t.payload});const r="".concat(n.id,"-").concat(t.uid),i=pU.get(r)||[],s=i.findIndex(u=>t.sendTs>=u.sendTs),o=a6(a6({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});s===-1?i.push(o):i.splice(s,0,o),pU.set(r,i);let a=!1;var A;t0.has(r)?a=!((A=t0.get(r))===null||A===void 0||!A.isSyncing):t0.set(r,{isSyncing:a,firstRecvTs:0,firstSendTs:0}),a||QZ(r)}const $De=yt().name;function c6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function A6(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?c6(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c6(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const bm="websdk_ng_cache_parameter",ZDe=j("MAX_PRELOAD_ASYNC_LENGTH"),eBe=1e4,Uh=new Map,Ph=[];let SD=null,bD=0,ID=0;const QC=new Map,tBe=function(t,e){const n=[];let r=0;const i=async()=>{const s=n.shift();s&&await s(),n.length>0&&r<e?i():r--};return async function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return new ye(async(A,u)=>{n.push(async()=>{try{const d=await t(...o);A(d)}catch(d){u(d)}}),r<e&&(r++,i())})}}(jZ,ZDe),RD=js.CancelToken.source();async function jZ(t,e,n,r,i,s){try{if(!j("ENABLE_PRELOAD"))return;if(!Ct().supportWebCrypto)return void Pd(()=>{S.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new ie(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&zr(n,"token",1,2047),zr(t,"appid",1,2047),Mb(e),r&&Fb(r);const o=im();S.debug("preload channel ".concat(e,", uid is ").concat(r));const a={appId:t,cname:e,token:n||t,uid:typeof r!="string"?r:null,sid:o,proxyServer:i};let A,u;typeof r=="string"?(a.stringUid=r,[u,A]=await ye.all([yDe(r,{sid:o,appId:t},RD.token),fG(A6(A6({},a),{},{token:n||t,uid:0}),RD.token)]),a.uid=u.uid,A.gatewayInfo.uid=a.uid,A.gatewayInfo.res.uid=a.uid):(s&&(a.stringUid=s),A=await fG(a,RD.token));const d={sid:o,appId:t,cname:e,token:n||t,uid:a.stringUid||r,intUid:a.uid||A.gatewayInfo.uid,stringUid:a.stringUid,ts:Date.now(),sua:u,ap:A};await async function(f){let m;try{f.uid&&KZ({appId:f.appId,cname:f.cname,token:f.token,uid:f.uid,stringUid:f.stringUid});const g=zZ(f),v=await async function(w,b){try{const I=await window.crypto.subtle.importKey("raw",b$(b),"AES-GCM",!1,["encrypt"]),B=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},I,Hh(window.btoa(JSON.stringify(w))));return _d(new Uint8Array(B))}catch{return}}(f,f.token||f.appId);if(!v)return;m=WZ(bm);const y=m?JSON.parse(m):[];y.push({[g]:v}),y.length>j("AP_CACHE_NUM")&&y.shift(),gS(bm,JSON.stringify(y))}catch(g){S.warn("Error caching server parameters:",g.message),gS(bm,"")}}(d),bD++}catch(o){throw ID++,function(a){SD||(SD=window.setTimeout(()=>{let u="";QC.forEach((d,f)=>{u+="".concat(f,": ").concat(d," ;")}),Le.reportApiInvoke(null,{name:wr.PRELOAD,options:{success:bD,failed:ID,err:u}}).onError(a),bD=0,ID=0,QC.clear(),SD=null},eBe));const A=QC.get(a.code)||0;QC.set(a.code,A+1)}(o),o}}async function l6(t){try{const e=KZ(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(r,i){try{const s=await window.crypto.subtle.importKey("raw",b$(i),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,Hh(r));return JSON.parse(window.atob(_d(new Uint8Array(o))))}catch{return}}(e,t.token||t.appId);if(!n||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<j("AP_CACHE_LIFETIME"))return n}catch(e){S.warn("Error get preloadInfo",e.message)}}function KZ(t){let e;try{if(e=WZ(bm),!e)return;const n=JSON.parse(e),r=zZ(t),i=function(o,a){for(let A=o.length-1;A>=0;A--)if(a(o[A]))return A;return-1}(n,o=>r in o);if(i===-1)return;const s=n.splice(i,1)[0];return gS(bm,JSON.stringify(n)),s[r]}catch(n){S.warn("Error delete preload info: ".concat(e),n.message),gS(bm,"")}}function Gk(t){if(t){let e=Uh.get(t);e&&(window.clearTimeout(e),e=null,Uh.delete(t)),Te(Ph).call(Ph,t)||t.cloudProxyServer!=="disabled"||Ph.push(t)}if(Uh.size<j("AP_CACHE_NUM")&&Ph.length>0){const e=Ph.shift();Uh.set(e,window.setTimeout(async()=>{const{appId:n,cname:r,token:i,stringUid:s,uid:o,proxyServer:a}=e;try{await tBe(n,r,i,o,a,s),Uh.has(e)&&Gk(e)}catch(A){S.warn("update preload failed",A.message),GZ(e)}},j("AP_UPDATE_INTERVAL")))}}function GZ(t){const e=Ph.indexOf(t);e!==-1&&Ph.splice(e,1);let n=Uh.get(t);n&&(window.clearTimeout(n),n=null,Uh.delete(t),Gk())}function u6(t,e){const n=t.sua,r=t.ap;e&&n&&Le.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),Le.reportResourceTiming(t.ap.url,t.sid),Le.joinWebProxyAP(t.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[or.CHOOSE_SERVER,or.CLOUD_PROXY_FALLBACK].toString()}),Le.joinChooseServer(t.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[or.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function WZ(t){return window.atob(window.localStorage.getItem(t)||"")}function gS(t,e){window.localStorage.setItem(t,window.btoa(e))}function zZ(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),R$(e)}function nBe(t){let e=function(){const n=sBe.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let i=n.appId;i!==void 0&&(ir(r,10),ku(r,i));let s=n.cid;s!==void 0&&(ir(r,16),ir(r,s));let o=n.cname;o!==void 0&&(ir(r,26),ku(r,o));let a=n.deviceId;a!==void 0&&(ir(r,34),ku(r,a));let A=n.elapse;A!==void 0&&(ir(r,40),xu(r,A));let u=n.fileSize;u!==void 0&&(ir(r,48),xu(r,Ip(u)));let d=n.height;d!==void 0&&(ir(r,56),xu(r,Ip(d)));let f=n.jpg;f!==void 0&&(ir(r,66),ir(r,f.length),d6(r,f));let m=n.networkType;m!==void 0&&(ir(r,72),xu(r,Ip(m)));let g=n.osType;g!==void 0&&(ir(r,80),xu(r,Ip(g)));let v=n.requestId;v!==void 0&&(ir(r,90),ku(r,v));let y=n.sdkVersion;y!==void 0&&(ir(r,98),ku(r,y));let w=n.sequence;w!==void 0&&(ir(r,104),xu(r,Ip(w)));let b=n.sid;b!==void 0&&(ir(r,114),ku(r,b));let I=n.timestamp;I!==void 0&&(ir(r,120),xu(r,I));let B=n.uid;B!==void 0&&(ir(r,128),ir(r,B));let M=n.vid;M!==void 0&&(ir(r,136),ir(r,M));let H=n.width;H!==void 0&&(ir(r,144),xu(r,Ip(H)));let K=n.service;K!==void 0&&(ir(r,152),ir(r,K));let Q=n.callbackData;Q!==void 0&&(ir(r,162),ir(r,Q.length),d6(r,Q));let F=n.ticket;F!==void 0&&(ir(r,170),ku(r,F));let k=n.vendorConfigs;k!==void 0&&(ir(r,178),ku(r,k))}(t,e),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(e)}function rBe(t){return function(n){let r={};e:for(;!oBe(n);){let i=hE(n);switch(i>>>3){case 0:break e;case 1:r.code=hE(n);break;case 2:r.msg=h6(n,hE(n));break;case 3:r.requestId=h6(n,hE(n));break;case 4:r.timestamp=aBe(n,!1);break;default:iBe(n,7&i)}}return r}({bytes:e=t,offset:0,limit:e.length});var e}function iBe(t,e){switch(e){case 0:for(;128&Xa(t););break;case 2:OD(t,hE(t));break;case 5:OD(t,4);break;case 1:OD(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function Ip(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let sBe=[];function OD(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function oBe(t){return t.offset>=t.limit}function Qb(t,e){let n=t.bytes,r=t.offset,i=t.limit,s=r+e;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),t.bytes=o}return t.offset=s,s>i&&(t.limit=s),r}function qZ(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function d6(t,e){let n=Qb(t,e.length);t.bytes.set(e,n)}function h6(t,e){let n=qZ(t,e),r=String.fromCharCode,i=t.bytes,s="",o="";for(let a=0;a<e;a++){let A,u,d,f,m=i[a+n];(128&m)==0?o+=r(m):(224&m)==192?a+1>=e?o+=s:(A=i[a+n+1],(192&A)!=128?o+=s:(f=(31&m)<<6|63&A,f<128?o+=s:(o+=r(f),a++))):(240&m)==224?a+2>=e?o+=s:(A=i[a+n+1],u=i[a+n+2],(49344&(A|u<<8))!=32896?o+=s:(f=(15&m)<<12|(63&A)<<6|63&u,f<2048||f>=55296&&f<=57343?o+=s:(o+=r(f),a+=2))):(248&m)==240?a+3>=e?o+=s:(A=i[a+n+1],u=i[a+n+2],d=i[a+n+3],(12632256&(A|u<<8|d<<16))!=8421504?o+=s:(f=(7&m)<<18|(63&A)<<12|(63&u)<<6|63&d,f<65536||f>1114111?o+=s:(f-=65536,o+=r(55296+(f>>10),56320+(1023&f)),a+=3))):o+=s}return o}function ku(t,e){let n=e.length,r=0;for(let o=0;o<n;o++){let a=e.charCodeAt(o);a>=55296&&a<=56319&&o+1<n&&(a=(a<<10)+e.charCodeAt(++o)-56613888),r+=a<128?1:a<2048?2:a<65536?3:4}ir(t,r);let i=Qb(t,r),s=t.bytes;for(let o=0;o<n;o++){let a=e.charCodeAt(o);a>=55296&&a<=56319&&o+1<n&&(a=(a<<10)+e.charCodeAt(++o)-56613888),a<128?s[i++]=a:(a<2048?s[i++]=a>>6&31|192:(a<65536?s[i++]=a>>12&15|224:(s[i++]=a>>18&7|240,s[i++]=a>>12&63|128),s[i++]=a>>6&63|128),s[i++]=63&a|128)}}function Xa(t){return t.bytes[qZ(t,1)]}function f6(t,e){let n=Qb(t,1);t.bytes[n]=e}function hE(t){let e,n=0,r=0;do e=Xa(t),n<32&&(r|=(127&e)<<n),n+=7;while(128&e);return r}function ir(t,e){for(e>>>=0;e>=128;)f6(t,127&e|128),e>>>=7;f6(t,e)}function aBe(t,e){let n,r=0,i=0,s=0;return n=Xa(t),r=127&n,128&n&&(n=Xa(t),r|=(127&n)<<7,128&n&&(n=Xa(t),r|=(127&n)<<14,128&n&&(n=Xa(t),r|=(127&n)<<21,128&n&&(n=Xa(t),i=127&n,128&n&&(n=Xa(t),i|=(127&n)<<7,128&n&&(n=Xa(t),i|=(127&n)<<14,128&n&&(n=Xa(t),i|=(127&n)<<21,128&n&&(n=Xa(t),s=127&n,128&n&&(n=Xa(t),s|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|s<<24,unsigned:e}}function xu(t,e){let n=e.low>>>0,r=(e.low>>>28|e.high<<4)>>>0,i=e.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=Qb(t,s),a=t.bytes;switch(s){case 10:a[o+9]=i>>>7&1;case 9:a[o+8]=s!==9?128|i:127&i;case 8:a[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:a[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:a[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:a[o+4]=s!==5?128|r:127&r;case 4:a[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:a[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:a[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:a[o]=s!==1?128|n:127&n}}const p6={},m6={},_S=4294967296,cBe=_S*_S,ABe=cBe/2;YZ(0,!0);const g6=YZ(0),lBe=Lv(0,-2147483648,!1),uBe=Lv(-1,2147483647,!1);function YZ(t,e){let n,r,i;return e?(i=0<=(t>>>=0)&&t<256)&&(r=m6[t],r)?r:(n=Lv(t,0,!0),i&&(m6[t]=n),n):(i=-128<=(t|=0)&&t<128)&&(r=p6[t],r)?r:(n=Lv(t,t<0?-1:0,!1),i&&(p6[t]=n),n)}function Lv(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function dBe(t,e){if(isNaN(t))return g6;{if(t<=-9223372036854776e3)return lBe;if(t+1>=ABe)return uBe}return t<0?g6:Lv(t%_S|0,t/_S|0,e)}function _6(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}class Wk extends Ln{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(kc.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),N(this,"name","AgoraRTCImageModeration"),N(this,"_connectionState",ha.CONNECTING),N(this,"_sequence",0),N(this,"_moderationStartTime",void 0),N(this,"_workerConnection",void 0),N(this,"_workerMessageLengthLimit",void 0),N(this,"_qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",js.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"_moderationInterval",void 0),N(this,"_moderationTimer",null),N(this,"_moderationMode",1),N(this,"_quality",1),N(this,"_qualityTimer",null),N(this,"_ticket",void 0),N(this,"_moderationIntervalMinimum",void 0),N(this,"_uploadFailedNum",0),N(this,"_uploadNum",0),N(this,"_uploadTimer",null),N(this,"_extraInfo",void 0),N(this,"_vendor",""),N(this,"_encoder",new TextEncoder),N(this,"_moderationId",void 0),N(this,"inspectImage",()=>{if(this.connectionState!==ha.CONNECTED)throw new te(L.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ha.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=tn(5,"image-moderation-"),this._workerMessageLengthLimit=j("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=j("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=j("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new bv("worker-"+this._moderationId,hr),this.on(kc.STATE_CHANGE,(r,i)=>{S.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Ep[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(kc.STATE_CHANGE,Ep.CONNECT_AP),this._connectInfo=e;const r=this._cancelTokenSource.token;return this._retryConfig=n,new ye((i,s)=>{this.on(kc.CONNECTION_STATE_CHANGE,(o,a)=>{o===ha.CONNECTED&&i()}),this.requestAP(e,r,n).then(o=>{this.connectWorker(o)}).catch(o=>{s(o)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),S.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===ha.CONNECTED&&this.inspectImage()}async requestAP(e,n,r){const i=j("WEBCS_DOMAIN").map(A=>"https://".concat(A,"/api/v1")),s=await function(A,u,d,f){let{appId:m,areaCode:g,cname:v,sid:y,token:w,uid:b}=u;Tm++;const I="moderation_plugin",B={service_name:I,json_body:JSON.stringify({appId:m,areaCode:g,cname:v,command:"allocateEdge",requestId:Tm,seq:Tm,sid:y,appToken:w,ts:Date.now(),uid:b+""})};let M,H,K=A[0];return Jc(async()=>{M=Date.now();const Q=await $c(K,{data:B,cancelToken:d,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(H=Date.now()-M,Q.code!==0){const G=new te(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Q.code,{retry:!0,responseTime:H});throw S.error(G.toString()),G}const F=JSON.parse(Q.json_body);if(F.code!==200){const G=new te(L.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(F.code,", reason: ").concat(F.reason),{code:F.code,responseTime:H});throw S.error(G.toString()),G}if(!F.servers||!Array.isArray(F.servers)||F.servers.length===0){const G=new te(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:F.code,responseTime:H});throw S.error(G.toString()),G}if(!F.servers.some(G=>!!G.wss)){const G=new te(L.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:F.code,responseTime:H});throw S.error(G.toString()),G}const k=j("IMAGE_MODERATION_WORKER_HOST");return{addressList:F.servers.map(G=>{let{address:$,wss:ne}=G;if($&&ne)return"wss://".concat($.replace(/\./g,"-"),".").concat(k,":").concat(ne,"/moderation")}).filter(G=>!!G),workerToken:F.workerToken,vid:F.vid,ticket:F.appTicket,responseTime:H}},(Q,F)=>(Le.apworkerEvent(y,{success:!0,sc:200,serviceName:I,responseDetail:JSON.stringify(Q.addressList),firstSuccess:F===0,responseTime:H,serverIp:A[F%A.length]}),!1),(Q,F)=>(Le.apworkerEvent(y,{success:!1,sc:Q.data&&Q.data.code||200,serviceName:I,responseTime:H,serverIp:A[F%A.length]}),!!(Q.code!==L.OPERATION_ABORTED&&Q.code!==L.UNEXPECTED_RESPONSE||Q.data&&Q.data.retry)&&(K=A[(F+1)%A.length],!0)),f)}(i,e,n,r);this.emit(kc.STATE_CHANGE,Ep.AP_CONNECTED);const{addressList:o,ticket:a}=s;return this._ticket=a,o}async connectWorker(e){this.emit(kc.STATE_CHANGE,Ep.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Ye.CONNECTED,async()=>{this.emit(kc.STATE_CHANGE,Ep.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ha.CONNECTED}),this._workerConnection.on(Ye.CLOSED,()=>{this.connectionState=ha.CLOSED}),this._workerConnection.on(Ye.FAILED,()=>{this.connectionState=ha.CLOSED}),this._workerConnection.on(Ye.RECONNECTING,()=>{this.connectionState=this.connectionState===ha.CONNECTED?ha.RECONNECTING:ha.CONNECTING}),this._workerConnection.on(Ye.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=rBe(new Uint8Array(e.data));j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,S.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Le.reportApiInvoke(this._connectInfo.sid||null,{name:wr.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Mn.TRACER}).onError(new te(L.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},j("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else S.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ye.WILL_RECONNECT,(e,n,r)=>{e==="recover"&&r(e),r("tryNext")}),this._workerConnection.on(Ye.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=va(this,kc.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(e,n);this._workerConnection.sendMessage(r,!0,!0)}else j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&S.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:r,cname:i,cid:s,vid:o,sid:a,uid:A}=n;const u=Date.now(),d=await e.getCurrentFrameImage("image/jpeg",this.quality),f=await lZ(d,r,i),m=this._sequence+"-"+s+"-"+A+"-"+u+"-"+tn(12,""),g={appId:r,cid:s,cname:i,deviceId:"",elapse:Wk.intToLong(Number(u-this._moderationStartTime)),fileSize:d.buffer.byteLength,height:d.height,width:d.width,jpg:f,networkType:6,osType:7,requestId:m,sdkVersion:"4.22.0",sequence:this._sequence,sid:a,timestamp:dBe(u),uid:A,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete g.callbackData;const v=nBe(g);if(v.byteLength<this._workerMessageLengthLimit){if(j("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const y=function(w){for(var b=1;b<arguments.length;b++){var I=arguments[b]!=null?arguments[b]:{};b%2?_6(Object(I),!0).forEach(function(B){N(w,B,I[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(I)):_6(Object(I)).forEach(function(B){Object.defineProperty(w,B,Object.getOwnPropertyDescriptor(I,B))})}return w}({},g);delete y.jpg,S.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(y))}return v}{const y=this.quality*this._qualityRatio;return this.quality=y,await this.generateRequestData(e,{appId:r,cname:i,cid:s,vid:o,sid:a,uid:A})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=js.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ha.CLOSED,this.emit(kc.STATE_CHANGE,Ep.CLOSED)}}function XZ(t){if(jt(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new te(L.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new te(L.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const hBe={name:"ImageModeration",create:function(t){let{config:e}=t;return XZ(e),new Wk(e)}};var E6,v6,y6,w6,C6,T6,S6,b6,I6,R6,O6,N6,D6,B6,L6,U6,P6,k6,x6,M6,F6,V6,Q6,H6,j6,K6,G6,W6,z6,q6,Y6,X6,J6,$6,Z6,e8,t8,n8,r8,i8,Ce;function s8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Mc(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?s8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}Pi.setLogger(S);let fBe=(E6=Ve(),v6=Ve({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof am))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),y6=Ve({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==Rg.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),w6=Ve({argsMap:(t,e,n,r)=>[typeof e=="object"?e.uid:e,n,r]}),C6=Ve({argsMap:(t,e,n)=>[e,n]}),T6=Ve({argsMap:(t,e)=>e.map(n=>{let{user:r,mediaType:i}=n;return[r==null?void 0:r.uid,i]})}),S6=Ve({argsMap:(t,e,n,r)=>[typeof e=="object"?e.uid:e,n,r]}),b6=Ve({argsMap:(t,e)=>e.map(n=>{let{user:r,mediaType:i}=n;return{uid:r==null?void 0:r.uid,mediaType:i}})}),I6=Ve(),R6=Ve(),O6=Ve(),N6=Ve(),D6=Ve(),B6=Ve(),L6=Ve(),U6=Ve(),P6=Ve(),k6=Ve(),x6=Ve(),M6=Ve(),F6=Ve(),V6=Ve(),Q6=Ve({argsMap:(t,e)=>[e]}),H6=Ve(),j6=Ve(),K6=Ve(),G6=Ve(),W6=Ve(),z6=Ve(),q6=Ve(),Y6=Ve(),X6=Ve({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),J6=Ve(),$6=Ve(),Z6=Ve(),e8=Ve(),t8=Ve(),n8=Ve(),r8=Ve({reportResult:!0}),i8=Ve(),Ce=class extends Ln{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t){let e;if(super(),N(this,"store",void 0),N(this,"_uid",void 0),N(this,"_channelName",void 0),N(this,"_uintUid",void 0),N(this,"_users",[]),N(this,"_config",void 0),N(this,"_clientId",void 0),N(this,"_appId",void 0),N(this,"_sessionId",null),N(this,"_key",void 0),N(this,"_rtmConfig",{}),N(this,"_joinInfo",void 0),N(this,"_gateway",void 0),N(this,"_statsCollector",void 0),N(this,"_configDistribute",void 0),N(this,"_leaveMutex",new Pi("client-leave")),N(this,"_publishMutex",new Pi("client-publish")),N(this,"_renewTokenMutex",new Pi("client-renewtoken")),N(this,"_subscribeMutex",new Pi("client-subscribe")),N(this,"_encryptionMode","none"),N(this,"_encryptionSecret",null),N(this,"_encryptionSalt",null),N(this,"_encryptDataStream",!1),N(this,"_encryptDataStreamKey",null),N(this,"_encryptDataStreamIv",null),N(this,"_proxyServer",void 0),N(this,"_turnServer",{servers:[],mode:"auto"}),N(this,"_cloudProxyServerMode","disabled"),N(this,"_isDualStreamEnabled",!1),N(this,"_defaultStreamFallbackType",void 0),N(this,"_lowStreamParameter",void 0),N(this,"_streamFallbackTypeCacheMap",new Map),N(this,"_remoteStreamTypeCacheMap",new Map),N(this,"_axiosCancelSource",js.CancelToken.source()),N(this,"_audioVolumeIndicationInterval",void 0),N(this,"_networkQualityInterval",void 0),N(this,"_userOfflineTimeout",void 0),N(this,"_streamRemovedTimeout",void 0),N(this,"_liveTranscodeStreamingClient",void 0),N(this,"_liveRawStreamingClient",void 0),N(this,"_channelMediaRelayClient",void 0),N(this,"_networkQualitySensitivity","normal"),N(this,"_p2pChannel",void 0),N(this,"_useLocalAccessPoint",!1),N(this,"_setLocalAPVersion",void 0),N(this,"_joinAndNotLeaveYet",!1),N(this,"_numberOfJoinCount",0),N(this,"_remoteDefaultVideoStreamType",void 0),N(this,"_inspect",void 0),N(this,"_moderation",void 0),N(this,"_license",void 0),N(this,"_pendingPublishedUsers",[]),N(this,"ntpAlignErrorCount",0),N(this,"remoteInboundOffset",0),N(this,"_handleLocalTrackEnable",(n,r,i)=>{this.publish(n,!1).then(r).catch(i)}),N(this,"_handleLocalTrackDisable",(n,r,i)=>{this.unpublish(n).then(r).catch(i)}),N(this,"_handleUserOnline",n=>{if(j("BLOCK_LOCAL_CLIENT")&&gh(n.uid,this.channelName))return void S.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&S.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const r=this._users.find(i=>i.uid===n.uid);if(r)r._trust_in_room_=!0,r._is_pre_created&&(r._is_pre_created=!1,this.safeEmit(pt.USER_JOINED,r));else{const i=new Ju(n.uid,n.uint_id||n.uid);this._users.push(i),S.debug("[".concat(this._clientId,"] user online"),n.uid),this.safeEmit(pt.USER_JOINED,i)}}),N(this,"_handleUserOffline",n=>{if(j("BLOCK_LOCAL_CLIENT")&&gh(n.uid,this.channelName))return;const r=this._users.find(i=>i.uid===n.uid);r&&(this._handleRemoveStream(n),this._handleRemoveDataChannels(n),r._audio_pre_subscribed||r._video_pre_subscribed?r._is_pre_created=!0:cS(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),S.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.safeEmit(pt.USER_LEAVED,r,n.reason))}),N(this,"_handleAddAudioOrVideoStream",(n,r,i,s,o,a,A)=>{if(j("BLOCK_LOCAL_CLIENT")&&gh(r,this.channelName))return;const u=this._users.find(f=>f.uid===r);if(!u)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(u.uid,n,void 0,void 0,void 0,Date.now());const d=n==="audio"?u.hasAudio:u.hasVideo;u._uintid||(u._uintid=o||r),n==="audio"?u._trust_audio_stream_added_state_=!0:u._trust_video_stream_added_state_=!0,n==="audio"?(u._audio_added_=!0,i!==void 0&&(u._audioSSRC=i),s!==void 0&&(u._cname=s),a&&(u._audioOrtc=a)):(u._video_added_=!0,i!==void 0&&(u._videoSSRC=i),s!==void 0&&(u._cname=s),A!==void 0&&(u._rtxSsrcId=A),a&&(u._videoOrtc=a)),(n==="audio"?u.hasAudio:u.hasVideo)&&!d&&(S.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published ").concat(n)),this.safeEmit(pt.USER_PUBLISHED,u,n)),n==="video"?Le.onGatewayStream(this._sessionId,Wr.ON_ADD_VIDEO_STREAM,Nn.ON_ADD_VIDEO_STREAM,{peer:o||r,ssrc:u._videoSSRC}):Le.onGatewayStream(this._sessionId,Wr.ON_ADD_AUDIO_STREAM,Nn.ON_ADD_AUDIO_STREAM,{peer:o||r,ssrc:u._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(u,n,i).then(f=>{if(f&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(u.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof VC))return this._p2pChannel.unsubscribe(u,n,!0).then(()=>this._subscribe(u,n,!0).catch(m=>{S.error("[".concat(this._clientId,"] resubscribe error"),m.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(u,n)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(u.uid," after reconnect.")),this._subscribe(u,n,!0).catch(f=>{S.error("[".concat(this._clientId,"] resubscribe error"),f.toString())}))}),N(this,"_handleRemoveStream",n=>{if(j("BLOCK_LOCAL_CLIENT")&&gh(n.uid,this.channelName))return;const r=this._users.find(s=>s.uid===n.uid);if(!r)return void S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));S.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let i=()=>{};r.hasAudio&&r.hasVideo?i=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(pt.USER_UNPUBLISHED,r,"audio"),S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(pt.USER_UNPUBLISHED,r,"video")}:r.hasVideo?i=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(pt.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(i=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(pt.USER_UNPUBLISHED,r,"audio")}),r._video_pre_subscribed||r._audio_pre_subscribed||(r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel instanceof VC&&this._p2pChannel.unsubscribe(r).then(s=>{if(s)return this._gateway.unsubscribe(s,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0),Le.onGatewayStream(this._sessionId,Wr.ON_REMOVE_STREAM,Nn.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),i()}),N(this,"_handleSetStreamLocalEnable",(n,r,i)=>{if(j("BLOCK_LOCAL_CLIENT")&&gh(r,this.channelName))return;const s=this._users.find(A=>A.uid===r);if(!s)return void S.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));S.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(i?"enabled":"disabled"," with uid ").concat(r));const o=n==="audio"?s.hasAudio:s.hasVideo;if(n==="audio"){s._trust_audio_enabled_state_=!0;const A=s._audio_enabled_;if(s._audio_enabled_=i,s._audio_enabled_===A)return;{const u=s._audio_enabled_?"enable-local-audio":"disable-local-audio";S.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(u)),this.safeEmit(pt.USER_INFO_UPDATED,r,u)}}else{s._trust_video_enabled_state_=!0;const A=s._video_enabled_;if(s._video_enabled_=i,s._video_enabled_===A)return;{const u=s._video_enabled_?"enable-local-video":"disable-local-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(u)),this.safeEmit(pt.USER_INFO_UPDATED,r,u)}}const a=n==="audio"?s.hasAudio:s.hasVideo;return o!==a?!o&&a?(S.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(n)),void this.safeEmit(pt.USER_PUBLISHED,s,n)):(n==="video"&&s._videoTrack&&s._videoTrack._destroy(),n==="audio"&&s._audioTrack,this._p2pChannel.muteRemote(s,n),S.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(n)),void this.safeEmit(pt.USER_UNPUBLISHED,s,n)):void 0}),N(this,"_handleMuteStream",(n,r,i)=>{if(j("BLOCK_LOCAL_CLIENT")&&gh(n,this.channelName))return;S.debug("[".concat(this._clientId,"] receive mute message"),n,r,i);const s=this._users.find(A=>A.uid===n);if(!s)return void S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const o=r==="audio"?s.hasAudio:s.hasVideo;if(r==="audio"){s._trust_audio_mute_state_=!0;const A=s._audio_muted_;if(s._audio_muted_=i,s._audio_muted_===A)return;{const u=s._audio_muted_?"mute-audio":"unmute-audio";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(u)),this.safeEmit(pt.USER_INFO_UPDATED,n,u)}}else{s._trust_video_mute_state_=!0;const A=s._video_muted_;if(s._video_muted_=i,s._video_muted_===A)return;{const u=s._video_muted_?"mute-video":"unmute-video";S.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(u)),this.safeEmit(pt.USER_INFO_UPDATED,n,u)}}const a=r==="audio"?s.hasAudio:s.hasVideo;if(o!==a){if(!o&&a)return(r==="audio"?s._audioSSRC:s._videoSSRC)?(S.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(r)),void this.safeEmit(pt.USER_PUBLISHED,s,r)):void S.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));r==="video"&&s._videoTrack&&!s._video_pre_subscribed&&s._videoTrack._destroy(),r==="audio"&&s._audioTrack,this._p2pChannel.muteRemote(s,r),S.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(r)),this.safeEmit(pt.USER_UNPUBLISHED,s,r)}}),N(this,"_handleP2PLost",async n=>{S.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():S.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),N(this,"_handleTokenWillExpire",()=>{S.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(pt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),N(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),S.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),N(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(pt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(pt.NETWORK_QUALITY,n)}),N(this,"_handleP2PAddAudioOrVideoStream",(n,r,i,s)=>{const o=this._users.find(A=>A.uid===r);if(!o)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));S.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(o.uid,n,void 0,void 0,void 0,Date.now());const a=n==="audio"?o.hasAudio:o.hasVideo;n==="audio"?o._trust_audio_stream_added_state_=!0:o._trust_video_stream_added_state_=!0,n==="audio"?(o._audio_added_=!0,i!==void 0&&(o._audioSSRC=i),s!==void 0&&(o._audioMid=s)):(o._video_added_=!0,i!==void 0&&(o._videoSSRC=i),s!==void 0&&(o._videoMid=s)),(n==="audio"?o.hasAudio:o.hasVideo)&&!a&&(S.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published ").concat(n)),this.safeEmit(pt.USER_PUBLISHED,o,n)),this._p2pChannel.hasPendingRemoteMedia(o,n)&&(S.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(o.uid," after reconnect.")),this._subscribe(o,n,!0).catch(A=>{S.error("[".concat(this._clientId,"] resubscribe error"),A.toString())}))}),this._config=t,this._clientId=tn(5,"client-"),this.store=new FRe(t.codec,t.audioCodec,t.mode,this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),S.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ya," build: ").concat(bk,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{I3(t.clientRoleOptions),e=Object.assign({},t.clientRoleOptions)}catch(n){S.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new Bv(this.store),this._statsCollector.onStatsException=(n,r,i)=>{S.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(r,", uid: ").concat(i)),this.safeEmit(pt.EXCEPTION,{code:n,msg:r,uid:i})},this._statsCollector.onUploadPublishDuration=(n,r,i,s)=>{const o=this._users.find(a=>a.uid===n);o&&Le.peerPublishStatus(this._sessionId,{subscribeElapse:s,audioPublishDuration:r,videoPublishDuration:i,peer:o._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new pDe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||hr,httpRetryConfig:t.httpRetryConfig||hr,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:e}),this._configDistribute=new SDe,this.store.useP2P?(this._p2pChannel=new ho(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new VC(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,r,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Ht("JOIN_GATEWAY_USE_443PORT_ONLY",s),Ht("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const a=this._gateway.signal.websocket;return a instanceof Ik&&(a.use443PortOnly=s,a.tryDoubleDomain=o),async function(A,u,d){_C.get(A)||_C.set(A,[]),EC.get(A)||EC.set(A,u),fA.get(A)||fA.set(A,0);const f=_C.get(A),m=EC.get(A);if(!f||!m)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(fA.get(A)===m){const b=yv();f.push(b),await b.promise}fA.set(A,fA.get(A)+1);for(var g=arguments.length,v=new Array(g>3?g-3:0),y=3;y<g;y++)v[y-3]=arguments[y];const w=await d(...v);return fA.set(A,fA.get(A)-1),fA.get(A)===m-1&&f.length>0&&(f[0].resolve(),f.shift()),fA.get(A)===0&&(_C.set(A,[]),EC.set(A,0),fA.set(A,0)),w}("client.join",j("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,r,i)}async join(t,e,n,r,i){const s=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const o=(yC||yC||(yC=(window.location.protocol.split(":")[0]||"").toUpperCase(),yC))==="HTTPS",a=U3()?window.isSecureContext:"Browser Not Support";(!U3()&&!o||!window.isSecureContext)&&S.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),S.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Le.setAppId(t);try{if(!n&&n!==null)throw new te(L.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&zr(n,"token",1,2047),zr(t,"appid",1,2047),Mb(e),r&&Fb(r),i&&zr(i,"optionalInfo",1,2047)}catch(y){throw Le.reportApiInvoke(im(),{name:wr.JOIN,options:[t,e,n,r],states:{isHttps:o,isSecureContext:a},tag:Mn.TRACER}).onError(y),y}if(this._leaveMutex.isLocked&&(S.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),S.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const y=new te(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Le.reportApiInvoke(im(),{name:wr.JOIN,options:[t,e,n,r],states:{isHttps:o,isSecureContext:a},tag:Mn.TRACER}).onError(y),y}this._gateway.state="CONNECTING";const A=await l6({appId:t,cname:e,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new te(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const u=(A==null?void 0:A.sid)||im();S.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(s)),this._sessionId||(this._sessionId=u,this.store.sessionId=this._sessionId);const d=Le.reportApiInvoke(u,{name:wr.JOIN,options:[t,e,n,r],states:{isHttps:o,isSecureContext:a},tag:Mn.TRACER}),f=Mc(Mc({},this._rtmConfig),{},{clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!A},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(f.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(f.stringUid=r,this._uintUid?(f.uid=this._uintUid,this._uintUid=void 0):f.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(f.aesmode=this._encryptionMode,f.aespassword=await(async y=>{const w=function(M){const H=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),K=new Uint8Array(new ArrayBuffer(H.length));for(let Q=0;Q<H.length;Q+=1)K[Q]=H.charCodeAt(Q);return K}(),b=await window.crypto.subtle.importKey("spki",w,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),I=wk(y),B=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},b,I);return function(M){let H="";for(let K=0;K<M.length;K+=1)H+=String.fromCharCode(M[K]);return window.btoa(H)}(new Uint8Array(B))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new te(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(f.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const y=new TextEncoder,w=j("USE_PURE_ENCRYPTION_MASTER_KEY")?y.encode(f.appId+this._encryptionSecret+this._encryptionSecret):y.encode(f.appId+f.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(b,I,B){const M=await window.crypto.subtle.importKey("raw",I,"PBKDF2",!1,["deriveBits","deriveKey"]),H=b==="aes-128-gcm2"?128:256,K=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:k3,hash:"SHA-256",salt:B},M,H+VRe);return new Uint8Array(K).subarray(H/8)}(this._encryptionMode,w,Hh(this._encryptionSalt)),this._encryptDataStreamKey=await async function(b,I,B){const M=await window.crypto.subtle.importKey("raw",I,"PBKDF2",!1,["deriveBits","deriveKey"]),H=b==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:k3,hash:"SHA-256",salt:B},M,{name:"AES-GCM",length:H},!0,["encrypt","decrypt"])}(this._encryptionMode,w,Hh(this._encryptionSalt))}else a?S.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):S.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,S.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:f.stringUid});const m=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&m===this._sessionId&&Le.joinChannelTimeout(this._sessionId,5)},5e3);try{var g;let y;const w=f.cloudProxyServer;if(Te(g=["proxy3","proxy4","proxy5"]).call(g,w)){const H=j("PROXY_SERVER_TYPE3");Array.isArray(H)?f.proxyServer=H[0]:f.proxyServer=H}if(Le.setProxyServer(f.proxyServer),S.setProxyServer(f.proxyServer),this.store.requestAPStart(),A){if(S.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(f.stringUid?", ".concat(f.stringUid," => ").concat(A.intUid):""," ")),f.stringUid&&!f.uid&&(f.uid=A.intUid),y={gatewayInfo:A.ap.gatewayInfo},j("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&f.turnServer.mode==="auto")if(A.ap.proxyInfo.addresses.length===0)S.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const H=(await M$(A.ap.proxyInfo,A.ap.gatewayInfo.uid)).map(K=>({turnServerURL:K.address,tcpport:K.tcpport||ci.tcpport,udpport:K.udpport||ci.udpport,username:K.username||ci.username,password:K.password||ci.password,forceturn:!1,security:!0}));f.turnServer={mode:"manual",servers:H}}u6(A,f.stringUid)}else{if(f.stringUid&&!f.uid){let H;[H,y]=await ye.all([RZ(f.stringUid,f,this._axiosCancelSource.token,this._config.httpRetryConfig||hr,this.store),hG(f,this._axiosCancelSource.token,this._config.httpRetryConfig||hr,!0,this.store)]),S.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(f.stringUid," => ").concat(H)),f.uid=H,y.gatewayInfo.uid=H,y.gatewayInfo.res.uid=H}else y=await hG(f,this._axiosCancelSource.token,this._config.httpRetryConfig||hr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new te(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(f,this._axiosCancelSource.token),this._configDistribute.on(ZL.UPDATE_BITRATE_LIMIT,H=>{this._p2pChannel.updateBitrateLimit(H)})},0),this._key=n||t;const b=y.gatewayInfo,I=f.uid?f.uid:b.uid;this._joinInfo=Mc(Mc({},f),{},{cid:b.cid,uid:I,vid:b.vid,apResponse:b.res,apGatewayAddress:b.apGatewayAddress,uni_lbs_ip:b.uni_lbs_ip,gatewayAddrs:b.gatewayAddrs}),this.store.intUid=I;const B=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new te(L.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));d.onSuccess(B),this._appId=t,this._channelName=f.cname,this._uid=B,this.store.uid=B,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(hi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const M=f.stringUid?"string uid: ".concat(f.stringUid,",uid: ").concat(f.uid):"uid: ".concat(this._uid);return S.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(M)),setTimeout(()=>{S.startUpload()},5e3),this.store.joinEnd(),v=this,Te(Yu).call(Yu,v)||Yu.push(v),this._cloudProxyServerMode==="disabled"&&Ct().supportWebCrypto&&j("ENABLE_PRELOAD")&&Gk(this._joinInfo),B}catch(y){const w=Array.isArray(y)?y[0]:y;throw w&&w.code===L.OPERATION_ABORTED?S.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),w):S.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),w),w.code!==L.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),d.onError(w),w}var v}_joinGateway(){if(!this._joinInfo||!this._key)throw new te(L.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!j("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){S.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(hi()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=Yu.indexOf(e);n!==-1&&Yu.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return S.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED"),S.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof am))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new te(L.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new te(L.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof am))throw new te(L.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&e)throw new te(L.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}S.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(i=>{const s=this._configDistribute.getBitrateLimit();i instanceof dn&&s&&i.setBitrateLimit(s.uplink)});try{await this._publishHighStream(n),S.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw S.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(t){jt(t.id,"id",0,65535,!0),Ll(t.ordered,"ordered"),zr(t.metadata,"metadata",0,512),S.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===t.id)!==-1)throw new te(L.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new te(L.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new te(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(i){return s6(i,!1)}(t),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new te(L.CREATE_DATACHANNEL_ERROR);try{await ye.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await n._waitTillOpen()}catch(i){if(i.code!==L.DISCONNECT_P2P)throw i}}return S.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw S.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new te(L.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof am))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);S.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof ho){const r=await this._p2pChannel.unpublish(e);r&&await this._gateway.sendExtensionMessage(Jn.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(e);r&&await this._gateway.unpublish(r,this._uid),S.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw S.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),S.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),S.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(r=>"".concat(r.id))))}catch(n){throw S.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof Ju)){const r=this.remoteUsers.find(i=>i.uid===t);if(!r)throw new te(L.INVALID_REMOTE_USER,"user is not in the channel");t=r}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(Rr(e,"mediaType",["audio","video"]),this._p2pChannel instanceof ho)throw new te(L.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new te(L.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===Ue.AUDIO,r=e===Ue.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:s,ortc:o,rtxSsrcId:a,cname:A,uint_id:u}=await this._gateway.presubscribe(t,e,!0);if(s==null)throw new te(L.UNEXPECTED_RESPONSE,"no ssrc id");let d=this._users.find(m=>m.uid===t);d||(d=new Ju(t,u||t),d._is_pre_created=!0,this._users.push(d)),A&&(d._cname=A),d._uintid||(d._uintid=u||t),n&&(d._audioSSRC=s,d._audio_pre_subscribed=!0,o&&(d._audioOrtc=o)),r&&(d._videoSSRC=s,d._video_pre_subscribed=!0,o&&(d._videoOrtc=o),a!=null&&(d._rtxSsrcId=a)),S.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(d,e,s,a,o);const f=n?d._audioTrack:d._videoTrack;if(!f)throw new te(L.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(d._trust_audio_stream_added_state_=!0,d._audio_added_=!0),r&&(d._trust_video_stream_added_state_=!0,d._video_added_=!0),f}catch(s){throw S.error("[".concat(this._clientId,"] presub user ").concat(t," error"),s),s}finally{i()}}async _subscribeDataChannel(t,e){var n;if(jt(e,"channelId",0,65535,!0),!this._joinInfo)throw new te(L.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===t))throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new te(L.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new te(L.INVALID_REMOTE_USER,"user is not published");const i=(n=t._dataChannels)===null||n===void 0?void 0:n.find(a=>a.id===e);if(!i)throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new te(L.REMOTE_USER_IS_NOT_PUBLISHED);const s=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const a=await this._p2pChannel.subscribeDataChannel(t,[i]);if(a&&Te(a).call(a,i.id))try{var o;if(typeof i._originDataChannelId!="number")throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new te(L.CREATE_DATACHANNEL_ERROR);const A={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(o=i.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(t.uid,A,!0),await i._waitTillOpen()}catch(A){if((A==null?void 0:A.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[i]),A;await this._p2pChannel.unsubscribeDataChannel(t,[i]),this._p2pChannel.setPendingRemoteDataChannel(t,i.id)}return S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),i}finally{s()}}async _p2pSubscribe(t,e,n){if(Rr(e,"mediaType",["audio","video"]),!this._joinInfo)throw new te(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(s=>s===t)){const s=new te(L.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),s}if(!t.hasAudio&&!t.hasVideo){const s=new te(L.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),s}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const s=new te(L.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),s}const i=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const o=e==="audio"?t._audioSSRC:t._videoSSRC,a=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this._p2pChannel instanceof ho&&await this._p2pChannel.subscribe(t,e,o,a)}catch(o){throw o}S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(o=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});const s=e==="audio"?t._audioTrack:t._videoTrack;if(!s)throw new te(L.UNEXPECTED_ERROR,"can not find remote track in user object");return s}catch(s){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),s),s}finally{i()}}async _subscribe(t,e,n){if(this._p2pChannel instanceof ho)return this._p2pSubscribe(t,e);if(Rr(e,"mediaType",["audio","video"]),!this._joinInfo)throw new te(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===t)){const u=new te(L.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),u}if(!t.hasAudio&&!t.hasVideo){const u=new te(L.INVALID_REMOTE_USER,"user is not published");throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),u}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const u=new te(L.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),u}let i=e==="audio"?t._audioSSRC:t._videoSSRC,s=e==="audio"?t._audioOrtc:t._videoOrtc,o=e==="video"?t._rtxSsrcId:void 0,a={stream_type:e==="audio"?Ue.AUDIO:Ue.VIDEO,ssrcId:i};const A=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const d=e==="audio"?t._audioSSRC:t._videoSSRC;d!==void 0&&d!==i&&(i=d,s=e==="audio"?t._audioOrtc:t._videoOrtc,o=e==="video"?t._rtxSsrcId:void 0,a={stream_type:e==="audio"?Ue.AUDIO:Ue.VIDEO,ssrcId:i}),Ui.markSubscribeStart(this.store.clientId,i),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,i,o,s);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(t.uid,a,!0)}catch(f){if((f==null?void 0:f.code)!==L.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),f;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(d){throw this._p2pChannel.reportSubscribeEvent(!1,d==null?void 0:d.code,t,e),d}S.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(d=>{S.warning("[".concat(this._clientId,"] auto set fallback failed"),d)});const u=e==="audio"?t._audioTrack:t._videoTrack;if(!u)throw new te(L.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw S.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),u),u}finally{A()}}async massSubscribe(t){if(Nl(t,"subscribeList"),!this._joinInfo)throw new te(L.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,r=await this._subscribeMutex.lock();S.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(a=>{let{user:A,mediaType:u}=a;return"user: ".concat(A==null?void 0:A.uid,", mediaType: ").concat(u)}).join("; ")));const i=(t=[...t]).map(a=>{let{user:A,mediaType:u}=a;return{user:A,mediaType:u}}),s=await this._p2pChannel.globalLock();try{var o;for(let A=t.length-1;A>=0;A--){const u=t[A],{user:d,mediaType:f}=u;if(Rr(f,"mediaType",["audio","video"]),!d){const y=new te(L.INVALID_PARAMS,"user property does not exist in subscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),y}if(!this._users.find(y=>y===d)){const y=new te(L.INVALID_REMOTE_USER,"user is not in the channel");S.error("[".concat(this._clientId,"] can not massSubscribe ").concat(d.uid,", this user is not in the channel")),i[A].error=y,t.splice(A,1);continue}if(f==="audio"&&(!d.hasAudio||d._audioSSRC===void 0)||f==="video"&&(!d.hasVideo||d._videoSSRC===void 0)){const y=new te(L.REMOTE_USER_IS_NOT_PUBLISHED);S.error("[".concat(this._clientId,"] can not subscribe ").concat(d.uid," with mediaType ").concat(f,", remote user is not published")),i[A].error=y,t.splice(A,1);continue}const g=Pr.Video|Pr.LwoVideo,v=n.get(d);if(v){if(f==="video"?v&g:v&Pr.Audio){t.splice(A,1),S.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(d.uid,", mediaType:").concat(f," twice"));continue}n.set(d,v|(f==="video"?g:Pr.Audio))}else n.set(d,f==="video"?g:Pr.Audio)}for(let A=t.length-1;A>=0;A--){const u=t[A],{user:d,mediaType:f}=u,m=Pr.Video|Pr.LwoVideo;if(this._p2pChannel.hasRemoteMedia(d,f)){await this._p2pChannel.unmuteRemoteNoLock(d,f);const g=n.get(d);n.set(d,f==="video"?g^m:g^Pr.Audio),t.splice(A,1)}}this.store.massSubscribe(t.map(A=>({userId:A.user.uid,type:A.mediaType})),e);let a=qc(o=Array.from(n.entries())).call(o,(A,u)=>{let[d,f]=u;if(f===0)return A;const m={stream_id:d.uid,stream_type:f};return f&Pr.Audio&&(m.audio_ssrc=d._audioSSRC),f&Pr.Video&&(m.video_ssrc=d._videoSSRC),A.push(m),A},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(u=>{let{user:d,mediaType:f}=u;return{user:d,mediaType:f,ssrcId:f===Ue.VIDEO?d._videoSSRC:d._audioSSRC,rtxSsrcId:f===Ue.VIDEO?d._rtxSsrcId:void 0}}));const A=new Map;if(a=a.filter(u=>u.video_ssrc&&!this._p2pChannel.isPreSubScribe(u.video_ssrc)||u.audio_ssrc&&!this._p2pChannel.isPreSubScribe(u.audio_ssrc)||!u.video_ssrc&&!u.audio_ssrc),a.length>0){const u=await this._gateway.subscribeAll(a,!0);((u==null?void 0:u.users)||[]).forEach(d=>{let{stream_id:f,video_error_code:m,audio_error_code:g,error_code:v}=d;(m||g||v)&&A.set(f,{video_error_code:m,audio_error_code:g,error_code:v})})}if(Array.from(A.entries()).length>0){const u=[];Array.from(A.entries()).forEach(d=>{let[f,m]=d;const g=this.remoteUsers.find(v=>v.uid===f);if(g){let v;m.error_code||m.video_error_code&&m.audio_error_code?v=void 0:m.video_error_code?v=Ue.VIDEO:m.audio_error_code&&(v=Ue.AUDIO),u.push({user:g,mediaType:v})}}),u.length>0&&await this._p2pChannel.massUnsubscribeNoLock(u)}for(const u of i){const d=A.get(u.user.uid);if(d){const f=d.error_code||u.mediaType==="audio"&&d.audio_error_code||u.mediaType==="video"&&d.video_error_code;if(f){const m=Sv(f);S.error("user:".concat(u.user.uid," mediaType:").concat(u.mediaType," has massSubscribe error ").concat(m.desc)),u.error=new te(L.SUBSCRIBE_FAILED,"code ".concat(f,": ").concat(m.desc))}}u.error||(u.mediaType==="video"?u.track=u.user.videoTrack:u.track=u.user.audioTrack)}return this.store.massSubscribe(i.filter(u=>!u.error).map(u=>({userId:u.user.uid,type:u.mediaType})),void 0,Date.now()),i.forEach(u=>{var d;Le.subscribe(this.store.sessionId,{succ:!!u.error,ec:((d=u.error)===null||d===void 0?void 0:d.code)||null,video:u.mediaType===Ue.VIDEO,audio:u.mediaType===Ue.AUDIO,peerid:u.user.uid,subscribeRequestid:u.mediaType===Ue.VIDEO?u.user._videoSSRC:u.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(u.user._videoSSRC)},!0)}),S.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(u=>{let{user:d,mediaType:f}=u;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(f)}).join("; "))),i}catch(A){throw await this._p2pChannel.massUnsubscribeNoLock(t),A}}finally{s(),r()}}async unsubscribe(t,e,n){if(!(t instanceof Ju)){const s=this.remoteUsers.find(o=>o.uid===t);if(!s)throw new te(L.INVALID_REMOTE_USER,"user is not in the channel");t=s}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&Rr(e,"mediaType",["audio","video"]),!this._joinInfo)throw new te(L.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(s=>s===t)){const s=new te(L.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),s}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof ho)await this._p2pChannel.unsubscribe(t,e);else{const s=await this._p2pChannel.unsubscribe(t,e);s&&await this._gateway.unsubscribe(s,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&cS(this._users,t),S.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(s){if(s.code===L.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),s.toString()),s}finally{i()}}async _unsubscribeDataChannel(t,e){if(e&&jt(e,"id",0,65535,!0),!this._joinInfo)throw new te(L.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===t)){const i=new te(L.INVALID_REMOTE_USER,"user is not in the channel");throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),i}let r;if(typeof e=="number"){const i=t._dataChannels.find(s=>s.id===e);i&&(r=[i])}else r=t._dataChannels;if(r===void 0){const i=new te(L.REMOTE_USER_IS_NOT_PUBLISHED);throw S.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),i}S.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(t,r);i&&await this._gateway.unsubscribeDataChannel(i,t.uid),S.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===L.DISCONNECT_P2P)return void S.warning("disconnecting p2p, abort unsubscribe request.");throw S.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),i.toString()),i}}async massUnsubscribe(t){if(Nl(t,"unsubscribeList"),!this._joinInfo)throw new te(L.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");S.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(i,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:r,mediaType:i}=t[n];if(!r){const a=new te(L.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw S.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),a}if(Rr(i,"mediaType",["video","audio",void 0]),!this._users.find(a=>a===r)){S.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),t.splice(n,1);continue}const o=Pr.Video|Pr.LwoVideo;if(e.has(r)){const a=e.get(r);let A;switch(i){case"video":A=a&o;break;case"audio":A=a&Pr.Audio;break;default:A=a&(Pr.Audio|o)}if(A){S.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),t.splice(n,1);continue}i?i==="audio"?e.set(r,a|Pr.Audio):i==="video"&&e.set(r,a|o):e.set(r,a|Pr.Audio|o)}else i?i==="audio"?e.set(r,Pr.Audio):i==="video"&&e.set(r,o):e.set(r,Pr.Audio|o)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),S.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(r=>{let{user:i,mediaType:s}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(s,";")}).join()))}catch(n){if(n.code===L.DISCONNECT_P2P)return void S.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw S.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new ie(L.INVALID_PARAMS);On(n.width)||kN(n.width,"streamParameter.width"),On(n.height)||kN(n.height,"streamParameter.height"),On(n.framerate)||kN(n.framerate,"streamParameter.framerate"),On(n.bitrate)||jt(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&S.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),S.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Ae.LocalVideoLowTrack)}async enableDualStream(){if(!Ct().supportDualStream)throw Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new te(L.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new te(L.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),S.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new te(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Ae.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,Le.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),S.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(n){Rr(n,"role",["audience","host"])}(t),e&&I3(e),this.mode==="rtc"||this.mode==="p2p")throw S.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new te(L.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new te(L.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new te(L.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(t,e),this._config.role=t,S.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(zr(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new te(L.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new te(L.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,Le.setProxyServer(this._proxyServer),S.setProxyServer(this._proxyServer),S.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new te(L.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new te(L.INVALID_OPERATION,"You have already set the proxy")}if(Ub(t))return this._turnServer={servers:t,mode:"original-manual"},void S.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>S$(n)),this._turnServer={servers:t,mode:"manual"},S.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new te(L.INVALID_OPERATION,"you should set license before join channel");if(zr(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new te(L.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,S.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new te(L.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new te(L.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new te(L.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new te(L.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new te(L.INVALID_OPERATION,"Stop proxy server after leave channel");Le.setProxyServer(),S.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",S.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new te(L.INVALID_PARAMS,"accessPoints is required.");Nl(t.accessPoints.serverList,"accessPoints.serverList"),zr(t.accessPoints.domain,"accessPoints.domain");const e=(m,g)=>{jt(m,g,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new te(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");j("CLOSE_AFB_FOR_LOCAL_AP")&&(Ht("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ht("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=t.accessPoints.domain,s=t.accessPoints.serverList.map(m=>r.test(m)?"".concat(m.replace(/\./g,"-"),".").concat(i):m),o=s.map(m=>"".concat(m,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ht("WEBCS_DOMAIN",o),Ht("WEBCS_DOMAIN_BACKUP_LIST",o),Ht("GATEWAY_DOMAINS",[i]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Nl(t.report.hostname,"report.hostname"),Ht("EVENT_REPORT_DOMAIN",t.report.hostname[0]),Ht("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(Ht("EVENT_REPORT_DOMAIN",s[0]),Ht("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let a=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),a=t.report.port),Ht("STATS_COLLECTOR_PORT",a),t.report?Ht("ENABLE_EVENT_REPORT",!0):Ht("ENABLE_EVENT_REPORT",!1);let A="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Nl(t.log.hostname,"log.hostname"),A=t.log.hostname[0]):A=s[0];let u=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),u=t.log.port),Ht("LOG_UPLOAD_SERVER","".concat(A,":").concat(u));let d=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Nl(t.cds.hostname,"cds.hostname"),d=t.cds.hostname):d=s;let f=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),f=t.cds.port),Ht("CDS_AP",d.map(m=>"".concat(m,":").concat(f))),t.cds?Ht("ENABLE_CONFIG_DISTRIBUTE",!0):Ht("ENABLE_CONFIG_DISTRIBUTE",!1),S.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(Nl(t,"serverList"),zr(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new te(L.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(e):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ht("WEBCS_DOMAIN",t),Ht("WEBCS_DOMAIN_BACKUP_LIST",t),Ht("GATEWAY_DOMAINS",[e]),Ht("EVENT_REPORT_DOMAIN",t[0]),Ht("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),Ht("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),S.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Rr(t,"streamType",[0,1]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw S.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else S.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Rr(e,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(r=>r.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw S.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Rr(e,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw S.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}S.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,r){(function(s){Rr(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),zr(e,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(Te(i).call(i,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new te(L.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new te(L.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Ll(r,"encryptDataStream"),!Te(i).call(i,t))throw new te(L.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||S.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=_d(n))}async renewToken(t){if(zr(t,"token",1,2047),!this._key||!this._joinInfo)throw new te(L.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(j("USE_NEW_TOKEN")){S.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await TDe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||hr);S.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:r})}else S.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});S.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=e,this._joinInfo.token=e,S.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?S.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(pt.VOLUME_INDICATOR,t)},j("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new te(L.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new te(L.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new te(L.LIVE_STREAMING_TASK_CONFLICT);const n=e?xl.TRANSCODE:xl.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(xl.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new te(L.INVALID_PARAMS,"can not find live streaming url to stop");await ye.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){WG(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){WG(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new te(L.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const i=new TextEncoder;t.payload=i.encode(t.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Te(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(r=!0,t.payload=await async function(i,s,o){var a;const A=qc(a=Array.from(o)).call(a,(y,w)=>y+w,0),u={serverTs:0,seq:QRe++,length:o.length,checkSum:A},d=new Uint8Array(L3(A,2)),f=new ArrayBuffer(_p),m=new DataView(f);m.setUint32(0,u.serverTs),m.setUint16(4,u.seq),m.setUint16(6,u.length),m.setUint16(8,u.checkSum);const g=16-o.length%16;o=O3(o,new Uint8Array(g));const v=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:P3,additionalData:d},s,o);return O3(new Uint8Array(f),new Uint8Array(v))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new te(L.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(We.DATA_STREAM,{payload:_d(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-YDe},!n)}sendMetadata(t){if(!this._joinInfo)throw new te(L.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new te(L.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(We.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:_d(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(jRe),!this._joinInfo)throw new te(L.INVALID_OPERATION,"can not send custom report, not joined");await Le.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Rr(e.spatialLayer,"spatialLayer",[0,1,2,3]),Rr(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw S.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(Ll(e,"apRTM"),jt(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,S.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(S.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=js.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&GZ(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Pi("client-publish"),this._subscribeMutex=new Pi("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const r=t||im();t?S.debug("[".concat(this._clientId,"] new Session ").concat(r)):S.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=t?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r;const s={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};Le.sessionInit(this._sessionId,Mc({cname:e.channel,appid:e.appId},s)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new te(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&j("FORCE_TURN")&&!j("TURN_ENABLE_TCP")&&!j("TURN_ENABLE_UDP"))throw new te(L.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");S.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof ho){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(Jn.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var e;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==L.DISCONNECT_P2P)throw n.throw(s),s}await n.next(((e=i)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of t)i instanceof dn&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new te(L.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new te(L.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));S.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var e;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(s){if(s.code!==L.DISCONNECT_P2P)throw n.throw(s),s}n.next(((e=i)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===L.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new te(L.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},dE("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,s)=>{Le.reportApiInvoke(this._sessionId,{name:wr.ON_LIVE_STREAM_ERROR,options:[i,s],tag:Mn.TRACER}).onSuccess(),this.safeEmit(pt.LIVE_STREAMING_ERROR,i,s)},n.onLiveStreamWarning=(i,s)=>{Le.reportApiInvoke(this._sessionId,{name:wr.ON_LIVE_STREAM_WARNING,options:[i,s],tag:Mn.TRACER}).onSuccess(),this.safeEmit(pt.LIVE_STREAMING_WARNING,i,s)},n.on($L.REQUEST_WORKER_MANAGER_LIST,(i,s,o)=>{if(!this._joinInfo)return o(new te(L.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(a,A,u,d){const f=j("UAP_AP").slice(0,j("AJAX_REQUEST_CONCURRENT")).map(m=>A.proxyServer?"https://".concat(A.proxyServer,"/ap/?url=").concat(m+"/api/v1?action=uap"):"https://".concat(m,"/api/v1?action=uap"));return await _De(f,a,A,u,d)})(i,this._joinInfo,this._axiosCancelSource.token,hr).then(s).catch(o)}),n};return t===xl.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new te(L.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},dE("ChannelMediaRelay").create(t));r.on("state",i=>{i===Xs.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(pt.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(pt.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,s)=>{var o;i==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:r}=t,i=[];if(e){const s=[];this._users.forEach(o=>{o._dataChannels.forEach(a=>{n.every(A=>A.uid!==o._uintid||A.stream_id!==a.id)&&s.push({uid:o._uintid,stream_id:a.id,ordered:a.ordered,max_retrans_times:a.maxRetransmits,metadata:a.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(n)&&n.length>0&&n.forEach(s=>{const{uid:o,stream_id:a,ordered:A,max_retrans_times:u,metadata:d}=s,f=this._users.find(m=>m._uintid===o);if(!f)return void S.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(S.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),Te(i).call(i,f)||i.push(f),f._uintid||(f._uintid=o),f._dataChannels.findIndex(m=>m.id===s.stream_id)===-1){const m={id:a,ordered:!!A,maxRetransmits:u,metadata:d},g=function(v){return s6(v,!0)}(m);f._dataChannels.push(g),S.info("[".concat(this._clientId,"] remote user ").concat(f.uid," published datachannel")),e||this.safeEmit(pt.USER_PUBLISHED,f,"datachannel",m)}this._p2pChannel.hasPendingRemoteDataChannel(f,s.stream_id)&&(S.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(f.uid," after reconnect.")),this._subscribeDataChannel(f,s.stream_id).catch(m=>{S.error("[".concat(this._clientId,"] resubscribe datachannel error"),m.toString())}))}),e&&(this.safeEmit(pt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(s=>{const{uid:o,stream_id:a}=s,A=this._users.find(d=>d._uintid===o);if(!A)return void S.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const u=A._dataChannels.find(d=>d.id===s.stream_id);u&&(S.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(A,[u]).then(d=>{if(A._dataChannels=A._dataChannels.filter(f=>f!==u),d)return this._gateway.unsubscribeDataChannel(d,A.uid)}),S.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(u.id)),this.safeEmit(pt.USER_UNPUBLISHED,A,"datachannel",u._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){S.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{S.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(r=>{this.safeEmit(pt.USER_UNPUBLISHED,e,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,e.uid)}),n()}}else S.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(ai.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(ai.CONNECTION_STATE_CHANGE,(t,e,n)=>{var r;if(n===Mt.FALLBACK)return;const i=()=>{this.safeEmit(pt.CONNECTION_STATE_CHANGE,t,e,n)};if(Le.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:wr.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:Mn.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),S.info("[".concat(this._clientId,"] connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void i();if(t==="RECONNECTING")this._users.forEach(o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((o,a)=>{this._gateway.setStreamFallbackOption(a,o).catch(A=>{S.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),A)})}),this._remoteStreamTypeCacheMap.forEach((o,a)=>{this._gateway.setRemoteVideoStreamType(a,o).catch(A=>{S.warning("[".concat(this._clientId,"] auto set remote stream type failed"),A)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{S.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(o=>{S.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(o=>!o._trust_in_room_).forEach(o=>{S.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(o=>{o._trust_audio_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Ue.AUDIO,!1)),o._trust_video_mute_state_||(S.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,Ue.VIDEO,!1)),o._trust_audio_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(S.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(S.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(S.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))}))},1e3))}i()}),this._gateway.on(ai.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new te(L.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await l6(Mc(Mc({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,u6(r),this._joinInfo.preload=!0):(n=await lU(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||hr,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:o}=s;const[a,A]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:a,port:A}):i.push({host:a,port:A})}),t(i)}catch(n){e(n)}}),this._gateway.on(ai.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(pt.NETWORK_QUALITY,t)}),this._gateway.on(ai.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(pt.STREAM_TYPE_CHANGED,t,e),Le.reportApiInvoke(this._sessionId,{name:wr.STREAM_TYPE_CHANGE,options:[t,e],tag:Mn.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(ai.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(ai.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let r=await this._p2pChannel.getEstablishParams();j("ENABLE_PREALLOC_PC")&&r||(r=await this._p2pChannel.startP2PConnection(t)),e(r)}catch(r){n(r)}}),this._gateway.on(ai.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;const n=oG(t.ortc,e,t.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(n)}),this._gateway.on(ai.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var r;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:i,cid:s}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(s,"_").concat(i),icePwd:"".concat(s,"_").concat(i)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=j("FINGERPRINT"))!==null&&r!==void 0?r:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(ft.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(ft.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(ft.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(ft.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(ft.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(ft.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(ft.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(ft.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(ft.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,Ue.AUDIO,!0)),this._gateway.signal.on(ft.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,Ue.AUDIO,!1)),this._gateway.signal.on(ft.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,Ue.VIDEO,!0)),this._gateway.signal.on(ft.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,Ue.VIDEO,!1)),this._gateway.signal.on(ft.RECEIVE_METADATA,t=>{const e=Hh(t.metadata);this.safeEmit(pt.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(ft.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=Hh(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Te(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<_p)throw new te(L.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(_p));n=await async function(s,o,a){const A=a.subarray(0,_p),u=A.slice(8,_p),d=(u[0]<<8)+u[1],f=(A[6]<<8)+A[7],m=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:s,tagLength:P3,additionalData:new Uint8Array(L3(d,2))},o,a.subarray(_p));return new Uint8Array(m).subarray(0,f)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(t.ordered||t.syncWithAudio){const i=this._p2pChannel.getStats(),s=this.remoteUsers.find(a=>a.uid===t.uid),o=i==null?void 0:i.audioRecv.find(a=>a.ssrc===(s==null?void 0:s._audioSSRC));r=o==null?void 0:o.jitterBufferMs}r==null&&(r=0),JDe(Mc(Mc({},t),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(ft.ON_CRYPT_ERROR,()=>{Pd(()=>{S.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(pt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(ft.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(ft.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{S.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Mt.TOKEN_EXPIRE),this.safeEmit(pt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(ft.ON_STREAM_FALLBACK_UPDATE,t=>{S.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(pt.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(ft.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),S.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(ft.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(ft.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(ze.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case We.PUBLISH:{if(!e)return;const i=e.ortc;if(i){var n,r;const s=i.some(A=>{let{stream_type:u}=A;return u===Lt.Audio}),o=i.some(A=>{let{stream_type:u}=A;return u!==Lt.Audio}),a=i.some(A=>{let{stream_type:u}=A;return u===Lt.Screen||u===Lt.ScreenLow});e.state==="offer"&&Le.publish(this._joinInfo.sid,{eventElapse:Ui.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:L.TIMEOUT,audio:s,video:o,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:s?(n=i.find(A=>{let{stream_type:u}=A;return u===Lt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:o?(r=i.find(A=>{let{stream_type:u}=A;return u!==Lt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case We.SUBSCRIBE:e&&Le.subscribe(this._joinInfo.sid,{succ:!1,ec:L.TIMEOUT,audio:e.stream_type===Ue.AUDIO,video:e.stream_type===Ue.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:Ui.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(ft.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(ft.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;j("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(r=>!gh(r.string_id||r.stream_id,this.channelName)));const e=[],n=[];for(const r of t.users){let i=this._users.find(d=>d._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Ju(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.getListeners(pt.PUBLISHED_USER_LIST).length===0&&(S.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(pt.USER_JOINED,i)));const s=Pr.Audio&r.stream_type,o=(Pr.Video|Pr.LwoVideo)&r.stream_type,a=(65280&r.stream_type)!=0,A=s&&i.hasAudio,u=o&&i.hasVideo;o&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),s&&!A&&this.getListeners(pt.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(pt.USER_PUBLISHED,i,"audio")),o&&!u&&this.getListeners(pt.PUBLISHED_USER_LIST).length===0&&(S.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(pt.USER_PUBLISHED,i,"video")),(s&&!A||o&&!u||a)&&e.push(i),o&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(S.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{S.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(pt.PUBLISHED_USER_LIST).length>0?j("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(S.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(r=>r.uid).join(", "))),this.safeEmit(pt.PUBLISHED_USER_LIST,e)):S.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(ft.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof VC&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var r;return Te(r=Object.keys(xb)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(ft.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Jn.PUBLISH,(t,e,n)=>{const{uid:r}=t;t.forEach(i=>{const{kind:s,ssrcs:o,mid:a,isMuted:A}=i;this._handleP2PAddAudioOrVideoStream(s,r,o[0].ssrcId,a);const u=this._users.find(d=>d.uid===r);return u&&this._p2pChannel instanceof ho?this._p2pChannel.mockSubscribe(u,s,o[0].ssrcId,a).then(()=>{e()}).catch(n):e(),this._handleMuteStream(r,s,!!A)})}),this._gateway.signal.on(Jn.CALL,async(t,e,n)=>{if(this._p2pChannel instanceof ho)try{var r;e(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},t))}catch(i){n(i)}}),this._gateway.signal.on(ze.P2P_CONNECTION,async t=>{this._p2pChannel instanceof ho&&await this._p2pChannel.p2pConnect(t)}),this._gateway.signal.on(Jn.UNPUBLISH,async(t,e,n)=>{if(this._p2pChannel instanceof ho){const{unpubMsg:r,uid:i}=t,s=this._users.find(o=>o.uid===i);if(!s)return S.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void e();try{r.forEach(async o=>{let{stream_type:a}=o;const A=a===Lt.Audio?Ue.AUDIO:Ue.VIDEO;await this._p2pChannel.unsubscribe(s,A),this._handleMuteStream(i,A,!0)}),e()}catch(o){n(o)}}}),this._gateway.signal.on(Jn.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case id.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,Ue.VIDEO,!0);break;case id.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,Ue.AUDIO,!0);break;case id.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,Ue.VIDEO,!1);break;case id.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,Ue.AUDIO,!1)}}),this._gateway.signal.on(Jn.RESTART_ICE,async(t,e,n)=>{if(this._p2pChannel instanceof ho)try{const{direction:r,iceParameter:i}=t;r!==ys.SEND_ONLY||i?e(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),e())}catch(r){n(r)}}),this._gateway.signal.on(Jn.CANDIDATE,t=>{if(this._p2pChannel instanceof ho){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(Qe.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:r}=t;e(await this._gateway.sendExtensionMessage(Jn.RESTART_ICE,t,r===ys.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(Qe.LocalCandidate,t=>{this._gateway.sendExtensionMessage(Jn.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(Qe.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(Jn.CONTROL,t,!0),e()}catch(r){n(r)}}),this._p2pChannel.on(Qe.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===L.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(Qe.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===L.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(Qe.StateChange,(t,e)=>{e===Bt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Qe.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===L.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(Qe.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===L.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(Qe.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(Qe.RequestRePublishDataChannel,(t,e,n)=>{ye.all(t.map(async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==L.DISCONNECT_P2P)throw s}})).then(e).catch(n)}),this._p2pChannel.on(Qe.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:r,kind:i}of t)i===Ue.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");e()}catch(r){n(r)}}),this._p2pChannel.on(Qe.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(Qe.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(Qe.MediaReconnectStart,t=>{this.safeEmit(pt.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(Qe.MediaReconnectEnd,t=>{this.safeEmit(pt.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(Qe.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(Qe.RequestRestartICE,async t=>{if(this._p2pChannel instanceof ho)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(o){return void e.throw(o)}const{iceParameters:s}=function(o){const a=o.iceParameters;return{iceParameters:{iceUfrag:a.iceUfrag,icePwd:a.icePwd}}}(i);await e.next({remoteIceParameters:s})}),this._p2pChannel.on(Qe.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Qe.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:r}),o=oG(i,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Qe.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(Qe.P2PLost,()=>{this.safeEmit(pt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Qe.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(Qe.ConnectionTypeChange,t=>{this.safeEmit(pt.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(Qe.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Qe.QueryClientConnectionState,t=>{t(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new te(L.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new te(L.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},dE("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:s,token:o,uid:a,cid:A,vid:u}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:s,token:o,uid:a,cid:A,vid:u?Number(u):0},hr)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(Vr.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(pt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===za.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(pt.CONTENT_INSPECT_ERROR,new te(L.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Vr.INSPECT_RESULT,(e,n)=>{var r;if((n==null?void 0:n.code)===L.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return S.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(pt.CONTENT_INSPECT_RESULT,e,n)}),t.on(Vr.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new te(L.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Ll(t,"enabled"),t){if(!e)throw new te(L.INVALID_PARAMS,"config is required");if(XZ(e),!this._joinInfo)throw new te(L.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const r=(n={config:e},dE("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:s,sid:o,token:a,uid:A,cid:u,vid:d}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:s,sid:o,token:a,uid:A,cid:u,vid:d?Number(d):0},hr)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new te(L.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(t){t.on(kc.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(pt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===ha.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new te(L.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(kc.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){Rr(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new te(L.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,S.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return S.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Ll(t,"enabled"),Ht("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Oe(Ce.prototype,"leave",[E6],Object.getOwnPropertyDescriptor(Ce.prototype,"leave"),Ce.prototype),Oe(Ce.prototype,"publish",[v6],Object.getOwnPropertyDescriptor(Ce.prototype,"publish"),Ce.prototype),Oe(Ce.prototype,"unpublish",[y6],Object.getOwnPropertyDescriptor(Ce.prototype,"unpublish"),Ce.prototype),Oe(Ce.prototype,"subscribe",[w6],Object.getOwnPropertyDescriptor(Ce.prototype,"subscribe"),Ce.prototype),Oe(Ce.prototype,"presubscribe",[C6],Object.getOwnPropertyDescriptor(Ce.prototype,"presubscribe"),Ce.prototype),Oe(Ce.prototype,"massSubscribe",[T6],Object.getOwnPropertyDescriptor(Ce.prototype,"massSubscribe"),Ce.prototype),Oe(Ce.prototype,"unsubscribe",[S6],Object.getOwnPropertyDescriptor(Ce.prototype,"unsubscribe"),Ce.prototype),Oe(Ce.prototype,"massUnsubscribe",[b6],Object.getOwnPropertyDescriptor(Ce.prototype,"massUnsubscribe"),Ce.prototype),Oe(Ce.prototype,"setLowStreamParameter",[I6],Object.getOwnPropertyDescriptor(Ce.prototype,"setLowStreamParameter"),Ce.prototype),Oe(Ce.prototype,"enableDualStream",[R6],Object.getOwnPropertyDescriptor(Ce.prototype,"enableDualStream"),Ce.prototype),Oe(Ce.prototype,"disableDualStream",[O6],Object.getOwnPropertyDescriptor(Ce.prototype,"disableDualStream"),Ce.prototype),Oe(Ce.prototype,"setClientRole",[N6],Object.getOwnPropertyDescriptor(Ce.prototype,"setClientRole"),Ce.prototype),Oe(Ce.prototype,"setProxyServer",[D6],Object.getOwnPropertyDescriptor(Ce.prototype,"setProxyServer"),Ce.prototype),Oe(Ce.prototype,"setTurnServer",[B6],Object.getOwnPropertyDescriptor(Ce.prototype,"setTurnServer"),Ce.prototype),Oe(Ce.prototype,"setLicense",[L6],Object.getOwnPropertyDescriptor(Ce.prototype,"setLicense"),Ce.prototype),Oe(Ce.prototype,"startProxyServer",[U6],Object.getOwnPropertyDescriptor(Ce.prototype,"startProxyServer"),Ce.prototype),Oe(Ce.prototype,"stopProxyServer",[P6],Object.getOwnPropertyDescriptor(Ce.prototype,"stopProxyServer"),Ce.prototype),Oe(Ce.prototype,"setLocalAccessPointsV2",[k6],Object.getOwnPropertyDescriptor(Ce.prototype,"setLocalAccessPointsV2"),Ce.prototype),Oe(Ce.prototype,"setLocalAccessPoints",[x6],Object.getOwnPropertyDescriptor(Ce.prototype,"setLocalAccessPoints"),Ce.prototype),Oe(Ce.prototype,"setRemoteDefaultVideoStreamType",[M6],Object.getOwnPropertyDescriptor(Ce.prototype,"setRemoteDefaultVideoStreamType"),Ce.prototype),Oe(Ce.prototype,"setRemoteVideoStreamType",[F6],Object.getOwnPropertyDescriptor(Ce.prototype,"setRemoteVideoStreamType"),Ce.prototype),Oe(Ce.prototype,"setStreamFallbackOption",[V6],Object.getOwnPropertyDescriptor(Ce.prototype,"setStreamFallbackOption"),Ce.prototype),Oe(Ce.prototype,"setEncryptionConfig",[Q6],Object.getOwnPropertyDescriptor(Ce.prototype,"setEncryptionConfig"),Ce.prototype),Oe(Ce.prototype,"renewToken",[H6],Object.getOwnPropertyDescriptor(Ce.prototype,"renewToken"),Ce.prototype),Oe(Ce.prototype,"enableAudioVolumeIndicator",[j6],Object.getOwnPropertyDescriptor(Ce.prototype,"enableAudioVolumeIndicator"),Ce.prototype),Oe(Ce.prototype,"startLiveStreaming",[K6],Object.getOwnPropertyDescriptor(Ce.prototype,"startLiveStreaming"),Ce.prototype),Oe(Ce.prototype,"setLiveTranscoding",[G6],Object.getOwnPropertyDescriptor(Ce.prototype,"setLiveTranscoding"),Ce.prototype),Oe(Ce.prototype,"stopLiveStreaming",[W6],Object.getOwnPropertyDescriptor(Ce.prototype,"stopLiveStreaming"),Ce.prototype),Oe(Ce.prototype,"startChannelMediaRelay",[z6],Object.getOwnPropertyDescriptor(Ce.prototype,"startChannelMediaRelay"),Ce.prototype),Oe(Ce.prototype,"updateChannelMediaRelay",[q6],Object.getOwnPropertyDescriptor(Ce.prototype,"updateChannelMediaRelay"),Ce.prototype),Oe(Ce.prototype,"stopChannelMediaRelay",[Y6],Object.getOwnPropertyDescriptor(Ce.prototype,"stopChannelMediaRelay"),Ce.prototype),Oe(Ce.prototype,"sendCustomReportMessage",[X6],Object.getOwnPropertyDescriptor(Ce.prototype,"sendCustomReportMessage"),Ce.prototype),Oe(Ce.prototype,"pickSVCLayer",[J6],Object.getOwnPropertyDescriptor(Ce.prototype,"pickSVCLayer"),Ce.prototype),Oe(Ce.prototype,"setRTMConfig",[$6],Object.getOwnPropertyDescriptor(Ce.prototype,"setRTMConfig"),Ce.prototype),Oe(Ce.prototype,"enableContentInspect",[Z6],Object.getOwnPropertyDescriptor(Ce.prototype,"enableContentInspect"),Ce.prototype),Oe(Ce.prototype,"disableContentInspect",[e8],Object.getOwnPropertyDescriptor(Ce.prototype,"disableContentInspect"),Ce.prototype),Oe(Ce.prototype,"setImageModeration",[t8],Object.getOwnPropertyDescriptor(Ce.prototype,"setImageModeration"),Ce.prototype),Oe(Ce.prototype,"setP2PTransport",[n8],Object.getOwnPropertyDescriptor(Ce.prototype,"setP2PTransport"),Ce.prototype),Oe(Ce.prototype,"getJoinChannelServiceRecords",[r8],Object.getOwnPropertyDescriptor(Ce.prototype,"getJoinChannelServiceRecords"),Ce.prototype),Oe(Ce.prototype,"setPublishAudioFilterEnabled",[i8],Object.getOwnPropertyDescriptor(Ce.prototype,"setPublishAudioFilterEnabled"),Ce.prototype),Ce);class Uv{constructor(e,n){N(this,"id",0),N(this,"element",void 0),N(this,"peerPair",void 0),N(this,"context",void 0),N(this,"audioPlayerElement",void 0),N(this,"audioTrack",void 0),Uv.count+=1,this.id=Uv.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(r,i)=>{const s=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(s),r.iceGatheringState==="complete"?r.localDescription:new ye(o=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&o(r.localDescription)}})},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await e(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await e(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new te(L.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(i){throw new te(L.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new te(L.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){S.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var o8,HC;N(Uv,"count",0);const pBe=window.AudioContext||window.webkitAudioContext,mBe=new(o8=Ve({report:Le}),Oe((HC=class{constructor(){N(this,"units",[]),N(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return S.debug("the system does not need to process local aec"),-1;this.context||(this.context=new pBe);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new Uv(t,this.context),this.units.push(e)),e.startEchoCancellation(),S.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return yt().name!==Ut.SAFARI}}).prototype,"processExternalMediaAEC",[o8],Object.getOwnPropertyDescriptor(HC.prototype,"processExternalMediaAEC"),HC.prototype),HC);function a8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function c8(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?a8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const ND=window||document;function JZ(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!ND)return;const n=Dn._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const r=i=>{if(!(i&&i.blockedURI&&(Dn.onSecurityPolicyViolation||Dn.getListeners(bA.SECURITY_POLICY_VIOLATION).length>0)))return;const s=i.blockedURI;j("CSP_DETECTED_HOSTNAME_LIST").some(o=>Te(s).call(s,o))&&(Dn.onSecurityPolicyViolation&&typeof Dn.onSecurityPolicyViolation=="function"&&Dn.onSecurityPolicyViolation(i),Dn.getListeners(bA.SECURITY_POLICY_VIOLATION).length>0&&Dn.safeEmit(bA.SECURITY_POLICY_VIOLATION,i))};n&&ND.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||Dn.getListeners(bA.SECURITY_POLICY_VIOLATION).length>0)&&ND.addEventListener("securitypolicyviolation",r),Dn._cspEventHandlerPointer=r}var gBe=Is,_Be=n$,A8=RegExp.prototype,EBe=function(t){return t===A8||gBe(A8,t)?_Be(t):t.flags},ts=tr(EBe);function Dg(t){let e=t.length;for(;--e>=0;)t[e]=0}const zk=256,$Z=286,HE=30,jE=15,mU=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),n0=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),vBe=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),l8=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Dl=new Array(576);Dg(Dl);const KE=new Array(60);Dg(KE);const Pv=new Array(512);Dg(Pv);const kv=new Array(256);Dg(kv);const qk=new Array(29);Dg(qk);const ES=new Array(HE);function DD(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let u8,d8,h8;function BD(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}Dg(ES);const ZZ=t=>t<256?Pv[t]:Pv[256+(t>>>7)],xv=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Ho=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,xv(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},IA=(t,e,n)=>{Ho(t,n[2*e],n[2*e+1])},eee=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},tee=(t,e,n)=>{const r=new Array(16);let i,s,o=0;for(i=1;i<=jE;i++)o=o+n[i-1]<<1,r[i]=o;for(s=0;s<=e;s++){let a=t[2*s+1];a!==0&&(t[2*s]=eee(r[a]++,a))}},nee=t=>{let e;for(e=0;e<$Z;e++)t.dyn_ltree[2*e]=0;for(e=0;e<HE;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},ree=t=>{t.bi_valid>8?xv(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},f8=(t,e,n,r)=>{const i=2*e,s=2*n;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},LD=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&f8(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!f8(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},p8=(t,e,n)=>{let r,i,s,o,a=0;if(t.sym_next!==0)do r=255&t.pending_buf[t.sym_buf+a++],r+=(255&t.pending_buf[t.sym_buf+a++])<<8,i=t.pending_buf[t.sym_buf+a++],r===0?IA(t,i,e):(s=kv[i],IA(t,s+zk+1,e),o=mU[s],o!==0&&(i-=qk[s],Ho(t,i,o)),r--,s=ZZ(r),IA(t,s,n),o=n0[s],o!==0&&(r-=ES[s],Ho(t,r,o)));while(a<t.sym_next);IA(t,256,e)},UD=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,A,u=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<s;o++)n[2*o]!==0?(t.heap[++t.heap_len]=u=o,t.depth[o]=0):n[2*o+1]=0;for(;t.heap_len<2;)A=t.heap[++t.heap_len]=u<2?++u:0,n[2*A]=1,t.depth[A]=0,t.opt_len--,i&&(t.static_len-=r[2*A+1]);for(e.max_code=u,o=t.heap_len>>1;o>=1;o--)LD(t,n,o);A=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],LD(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[2*A]=n[2*o]+n[2*a],t.depth[A]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[2*o+1]=n[2*a+1]=A,t.heap[1]=A++,LD(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((d,f)=>{const m=f.dyn_tree,g=f.max_code,v=f.stat_desc.static_tree,y=f.stat_desc.has_stree,w=f.stat_desc.extra_bits,b=f.stat_desc.extra_base,I=f.stat_desc.max_length;let B,M,H,K,Q,F,k=0;for(K=0;K<=jE;K++)d.bl_count[K]=0;for(m[2*d.heap[d.heap_max]+1]=0,B=d.heap_max+1;B<573;B++)M=d.heap[B],K=m[2*m[2*M+1]+1]+1,K>I&&(K=I,k++),m[2*M+1]=K,M>g||(d.bl_count[K]++,Q=0,M>=b&&(Q=w[M-b]),F=m[2*M],d.opt_len+=F*(K+Q),y&&(d.static_len+=F*(v[2*M+1]+Q)));if(k!==0){do{for(K=I-1;d.bl_count[K]===0;)K--;d.bl_count[K]--,d.bl_count[K+1]+=2,d.bl_count[I]--,k-=2}while(k>0);for(K=I;K!==0;K--)for(M=d.bl_count[K];M!==0;)H=d.heap[--B],H>g||(m[2*H+1]!==K&&(d.opt_len+=(K-m[2*H+1])*m[2*H],m[2*H+1]=K),M--)}})(t,e),tee(n,u,t.bl_count)},m8=(t,e,n)=>{let r,i,s=-1,o=e[1],a=0,A=7,u=4;for(o===0&&(A=138,u=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=e[2*(r+1)+1],++a<A&&i===o||(a<u?t.bl_tree[2*i]+=a:i!==0?(i!==s&&t.bl_tree[2*i]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,s=i,o===0?(A=138,u=3):i===o?(A=6,u=3):(A=7,u=4))},g8=(t,e,n)=>{let r,i,s=-1,o=e[1],a=0,A=7,u=4;for(o===0&&(A=138,u=3),r=0;r<=n;r++)if(i=o,o=e[2*(r+1)+1],!(++a<A&&i===o)){if(a<u)do IA(t,i,t.bl_tree);while(--a!=0);else i!==0?(i!==s&&(IA(t,i,t.bl_tree),a--),IA(t,16,t.bl_tree),Ho(t,a-3,2)):a<=10?(IA(t,17,t.bl_tree),Ho(t,a-3,3)):(IA(t,18,t.bl_tree),Ho(t,a-11,7));a=0,s=i,o===0?(A=138,u=3):i===o?(A=6,u=3):(A=7,u=4)}};let _8=!1;const iee=(t,e,n,r)=>{Ho(t,0+(r?1:0),3),ree(t),xv(t,n),xv(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var yBe=t=>{_8||((()=>{let e,n,r,i,s;const o=new Array(16);for(r=0,i=0;i<28;i++)for(qk[i]=r,e=0;e<1<<mU[i];e++)kv[r++]=i;for(kv[r-1]=i,s=0,i=0;i<16;i++)for(ES[i]=s,e=0;e<1<<n0[i];e++)Pv[s++]=i;for(s>>=7;i<HE;i++)for(ES[i]=s<<7,e=0;e<1<<n0[i]-7;e++)Pv[256+s++]=i;for(n=0;n<=jE;n++)o[n]=0;for(e=0;e<=143;)Dl[2*e+1]=8,e++,o[8]++;for(;e<=255;)Dl[2*e+1]=9,e++,o[9]++;for(;e<=279;)Dl[2*e+1]=7,e++,o[7]++;for(;e<=287;)Dl[2*e+1]=8,e++,o[8]++;for(tee(Dl,287,o),e=0;e<HE;e++)KE[2*e+1]=5,KE[2*e]=eee(e,5);u8=new DD(Dl,mU,257,$Z,jE),d8=new DD(KE,n0,0,HE,jE),h8=new DD(new Array(0),vBe,0,19,7)})(),_8=!0),t.l_desc=new BD(t.dyn_ltree,u8),t.d_desc=new BD(t.dyn_dtree,d8),t.bl_desc=new BD(t.bl_tree,h8),t.bi_buf=0,t.bi_valid=0,nee(t)},wBe=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(a=>{let A,u=4093624447;for(A=0;A<=31;A++,u>>>=1)if(1&u&&a.dyn_ltree[2*A]!==0)return 0;if(a.dyn_ltree[18]!==0||a.dyn_ltree[20]!==0||a.dyn_ltree[26]!==0)return 1;for(A=32;A<zk;A++)if(a.dyn_ltree[2*A]!==0)return 1;return 0})(t)),UD(t,t.l_desc),UD(t,t.d_desc),o=(a=>{let A;for(m8(a,a.dyn_ltree,a.l_desc.max_code),m8(a,a.dyn_dtree,a.d_desc.max_code),UD(a,a.bl_desc),A=18;A>=3&&a.bl_tree[2*l8[A]+1]===0;A--);return a.opt_len+=3*(A+1)+5+5+4,A})(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?iee(t,e,n,r):t.strategy===4||s===i?(Ho(t,2+(r?1:0),3),p8(t,Dl,KE)):(Ho(t,4+(r?1:0),3),((a,A,u,d)=>{let f;for(Ho(a,A-257,5),Ho(a,u-1,5),Ho(a,d-4,4),f=0;f<d;f++)Ho(a,a.bl_tree[2*l8[f]+1],3);g8(a,a.dyn_ltree,A-1),g8(a,a.dyn_dtree,u-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),p8(t,t.dyn_ltree,t.dyn_dtree)),nee(t),r&&ree(t)},CBe=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(kv[n]+zk+1)]++,t.dyn_dtree[2*ZZ(e)]++),t.sym_next===t.sym_end),TBe=t=>{Ho(t,2,3),IA(t,256,Dl),(e=>{e.bi_valid===16?(xv(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},SBe={_tr_init:yBe,_tr_stored_block:iee,_tr_flush_block:wBe,_tr_tally:CBe,_tr_align:TBe},Mv=(t,e,n,r)=>{let i=65535&t|0,s=t>>>16&65535|0,o=0;for(;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};const bBe=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var _s=(t,e,n,r)=>{const i=bBe,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[255&(t^e[o])];return-1^t},gf={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Hb={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:IBe,_tr_stored_block:gU,_tr_flush_block:RBe,_tr_tally:Ed,_tr_align:OBe}=SBe,{Z_NO_FLUSH:vd,Z_PARTIAL_FLUSH:NBe,Z_FULL_FLUSH:DBe,Z_FINISH:nc,Z_BLOCK:E8,Z_OK:ks,Z_STREAM_END:v8,Z_STREAM_ERROR:kA,Z_DATA_ERROR:BBe,Z_BUF_ERROR:PD,Z_DEFAULT_COMPRESSION:LBe,Z_FILTERED:UBe,Z_HUFFMAN_ONLY:jC,Z_RLE:PBe,Z_FIXED:kBe,Z_DEFAULT_STRATEGY:xBe,Z_UNKNOWN:MBe,Z_DEFLATED:jb}=Hb,_U=286,FBe=30,VBe=19,QBe=2*_U+1,HBe=15,Kh=258,xA=262,tg=42,Gh=113,fE=666,Wh=(t,e)=>(t.msg=gf[e],e),y8=t=>2*t-(t>4?9:0),$u=t=>{let e=t.length;for(;--e>=0;)t[e]=0},jBe=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let yd=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const ma=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},_a=(t,e)=>{RBe(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,ma(t.strm)},zn=(t,e)=>{t.pending_buf[t.pending++]=e},q_=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},EU=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=Mv(t.adler,e,i,n):t.state.wrap===2&&(t.adler=_s(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},see=(t,e)=>{let n,r,i=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match;const A=t.strstart>t.w_size-xA?t.strstart-(t.w_size-xA):0,u=t.window,d=t.w_mask,f=t.prev,m=t.strstart+Kh;let g=u[s+o-1],v=u[s+o];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do if(n=e,u[n+o]===v&&u[n+o-1]===g&&u[n]===u[s]&&u[++n]===u[s+1]){s+=2,n++;do;while(u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&s<m);if(r=Kh-(m-s),s=m-Kh,r>o){if(t.match_start=e,o=r,r>=a)break;g=u[s+o-1],v=u[s+o]}}while((e=f[e&d])>A&&--i!=0);return o<=t.lookahead?o:t.lookahead},ng=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-xA)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),jBe(t),r+=e),t.strm.avail_in===0)break;if(n=EU(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=yd(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=yd(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<xA&&t.strm.avail_in!==0)},oee=(t,e)=>{let n,r,i,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o=0,a=t.strm.avail_in;do{if(n=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i||(i=t.strm.avail_out-i,r=t.strstart-t.block_start,n>r+t.strm.avail_in&&(n=r+t.strm.avail_in),n>i&&(n=i),n<s&&(n===0&&e!==nc||e===vd||n!==r+t.strm.avail_in)))break;o=e===nc&&n===r+t.strm.avail_in?1:0,gU(t,0,0,o),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,ma(t.strm),r&&(r>n&&(r=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+r),t.strm.next_out),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r,t.block_start+=r,n-=r),n&&(EU(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(o===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?4:e!==vd&&e!==nc&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(EU(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,s=i>t.w_size?t.w_size:i,r=t.strstart-t.block_start,(r>=s||(r||e===nc)&&e!==vd&&t.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,o=e===nc&&t.strm.avail_in===0&&n===r?1:0,gU(t,t.block_start,n,o),t.block_start+=n,ma(t.strm)),o?3:1)},kD=(t,e)=>{let n,r;for(;;){if(t.lookahead<xA){if(ng(t),t.lookahead<xA&&e===vd)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=yd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-xA&&(t.match_length=see(t,n)),t.match_length>=3)if(r=Ed(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=yd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=yd(t,t.ins_h,t.window[t.strstart+1]);else r=Ed(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(_a(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===nc?(_a(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(_a(t,!1),t.strm.avail_out===0)?1:2},Rp=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<xA){if(ng(t),t.lookahead<xA&&e===vd)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=yd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-xA&&(t.match_length=see(t,n),t.match_length<=5&&(t.strategy===UBe||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,r=Ed(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=yd(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(_a(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(r=Ed(t,0,t.window[t.strstart-1]),r&&_a(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Ed(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===nc?(_a(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(_a(t,!1),t.strm.avail_out===0)?1:2};function yA(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const pE=[new yA(0,0,0,0,oee),new yA(4,4,8,4,kD),new yA(4,5,16,8,kD),new yA(4,6,32,32,kD),new yA(4,4,16,16,Rp),new yA(8,16,32,32,Rp),new yA(8,16,128,128,Rp),new yA(8,32,128,256,Rp),new yA(32,128,258,1024,Rp),new yA(32,258,258,4096,Rp)];function KBe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=jb,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*QBe),this.dyn_dtree=new Uint16Array(2*(2*FBe+1)),this.bl_tree=new Uint16Array(2*(2*VBe+1)),$u(this.dyn_ltree),$u(this.dyn_dtree),$u(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(HBe+1),this.heap=new Uint16Array(2*_U+1),$u(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*_U+1),$u(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Fv=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==tg&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Gh&&e.status!==fE?1:0},aee=t=>{if(Fv(t))return Wh(t,kA);t.total_in=t.total_out=0,t.data_type=MBe;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?tg:Gh,t.adler=e.wrap===2?0:1,e.last_flush=-2,IBe(e),ks},cee=t=>{const e=aee(t);return e===ks&&(n=>{n.window_size=2*n.w_size,$u(n.head),n.max_lazy_match=pE[n.level].max_lazy,n.good_match=pE[n.level].good_length,n.nice_match=pE[n.level].nice_length,n.max_chain_length=pE[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},w8=(t,e,n,r,i,s)=>{if(!t)return kA;let o=1;if(e===LBe&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>9||n!==jb||r<8||r>15||e<0||e>9||s<0||s>kBe||r===8&&o!==1)return Wh(t,kA);r===8&&(r=9);const a=new KBe;return t.state=a,a.strm=t,a.status=tg,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=s,a.method=n,cee(t)};var GBe=(t,e)=>{if(Fv(t)||e>E8||e<0)return t?Wh(t,kA):kA;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===fE&&e!==nc)return Wh(t,t.avail_out===0?PD:kA);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(ma(t),t.avail_out===0)return n.last_flush=-1,ks}else if(t.avail_in===0&&y8(e)<=y8(r)&&e!==nc)return Wh(t,PD);if(n.status===fE&&t.avail_in!==0)return Wh(t,PD);if(n.status===tg&&n.wrap===0&&(n.status=Gh),n.status===tg){let i=jb+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=jC||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=s<<6,n.strstart!==0&&(i|=32),i+=31-i%31,q_(n,i),n.strstart!==0&&(q_(n,t.adler>>>16),q_(n,65535&t.adler)),t.adler=1,n.status=Gh,ma(t),n.pending!==0)return n.last_flush=-1,ks}if(n.status===57){if(t.adler=0,zn(n,31),zn(n,139),zn(n,8),n.gzhead)zn(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),zn(n,255&n.gzhead.time),zn(n,n.gzhead.time>>8&255),zn(n,n.gzhead.time>>16&255),zn(n,n.gzhead.time>>24&255),zn(n,n.level===9?2:n.strategy>=jC||n.level<2?4:0),zn(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(zn(n,255&n.gzhead.extra.length),zn(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=_s(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(zn(n,0),zn(n,0),zn(n,0),zn(n,0),zn(n,0),zn(n,n.level===9?2:n.strategy>=jC||n.level<2?4:0),zn(n,3),n.status=Gh,ma(t),n.pending!==0)return n.last_flush=-1,ks}if(n.status===69){if(n.gzhead.extra){let i=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=_s(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,ma(t),n.pending!==0)return n.last_flush=-1,ks;i=0,s-=a}let o=new Uint8Array(n.gzhead.extra);n.pending_buf.set(o.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>i&&(t.adler=_s(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=_s(t.adler,n.pending_buf,n.pending-s,s)),ma(t),n.pending!==0)return n.last_flush=-1,ks;s=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,zn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=_s(t.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(t.adler=_s(t.adler,n.pending_buf,n.pending-s,s)),ma(t),n.pending!==0)return n.last_flush=-1,ks;s=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,zn(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>s&&(t.adler=_s(t.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ma(t),n.pending!==0))return n.last_flush=-1,ks;zn(n,255&t.adler),zn(n,t.adler>>8&255),t.adler=0}if(n.status=Gh,ma(t),n.pending!==0)return n.last_flush=-1,ks}if(t.avail_in!==0||n.lookahead!==0||e!==vd&&n.status!==fE){let i=n.level===0?oee(n,e):n.strategy===jC?((s,o)=>{let a;for(;;){if(s.lookahead===0&&(ng(s),s.lookahead===0)){if(o===vd)return 1;break}if(s.match_length=0,a=Ed(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,a&&(_a(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===nc?(_a(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(_a(s,!1),s.strm.avail_out===0)?1:2})(n,e):n.strategy===PBe?((s,o)=>{let a,A,u,d;const f=s.window;for(;;){if(s.lookahead<=Kh){if(ng(s),s.lookahead<=Kh&&o===vd)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(u=s.strstart-1,A=f[u],A===f[++u]&&A===f[++u]&&A===f[++u])){d=s.strstart+Kh;do;while(A===f[++u]&&A===f[++u]&&A===f[++u]&&A===f[++u]&&A===f[++u]&&A===f[++u]&&A===f[++u]&&A===f[++u]&&u<d);s.match_length=Kh-(d-u),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(a=Ed(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(a=Ed(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),a&&(_a(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===nc?(_a(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(_a(s,!1),s.strm.avail_out===0)?1:2})(n,e):pE[n.level].func(n,e);if(i!==3&&i!==4||(n.status=fE),i===1||i===3)return t.avail_out===0&&(n.last_flush=-1),ks;if(i===2&&(e===NBe?OBe(n):e!==E8&&(gU(n,0,0,!1),e===DBe&&($u(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),ma(t),t.avail_out===0))return n.last_flush=-1,ks}return e!==nc?ks:n.wrap<=0?v8:(n.wrap===2?(zn(n,255&t.adler),zn(n,t.adler>>8&255),zn(n,t.adler>>16&255),zn(n,t.adler>>24&255),zn(n,255&t.total_in),zn(n,t.total_in>>8&255),zn(n,t.total_in>>16&255),zn(n,t.total_in>>24&255)):(q_(n,t.adler>>>16),q_(n,65535&t.adler)),ma(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?ks:v8)},WBe=(t,e)=>{let n=e.length;if(Fv(t))return kA;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==tg||r.lookahead)return kA;if(i===1&&(t.adler=Mv(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&($u(r.head),r.strstart=0,r.block_start=0,r.insert=0);let A=new Uint8Array(r.w_size);A.set(e.subarray(n-r.w_size,n),0),e=A,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,ng(r);r.lookahead>=3;){let A=r.strstart,u=r.lookahead-2;do r.ins_h=yd(r,r.ins_h,r.window[A+3-1]),r.prev[A&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=A,A++;while(--u);r.strstart=A,r.lookahead=2,ng(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,ks},GE={deflateInit:(t,e)=>w8(t,e,jb,15,8,xBe),deflateInit2:w8,deflateReset:cee,deflateResetKeep:aee,deflateSetHeader:(t,e)=>Fv(t)||t.state.wrap!==2?kA:(t.state.gzhead=e,ks),deflate:GBe,deflateEnd:t=>{if(Fv(t))return kA;const e=t.state.status;return t.state=null,e===Gh?Wh(t,BBe):ks},deflateSetDictionary:WBe,deflateInfo:"pako deflate (from Nodeca project)"};const zBe=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Kb={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)zBe(n,r)&&(t[r]=n[r])}}return t},flattenChunks:t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let o=t[r];n.set(o,i),i+=o.length}return n}};let Aee=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Aee=!1}const Vv=new Uint8Array(256);for(let t=0;t<256;t++)Vv[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Vv[254]=Vv[254]=1;var Qv={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=t.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(64512&n)==55296&&i+1<o&&(r=t.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let o=t[r++];if(o<128){s[i++]=o;continue}let a=Vv[o];if(a>4)s[i++]=65533,r+=a-1;else{for(o&=a===2?31:a===3?15:7;a>1&&r<n;)o=o<<6|63&t[r++],a--;a>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,a)=>{if(a<65534&&o.subarray&&Aee)return String.fromCharCode.apply(null,o.length===a?o:o.subarray(0,a));let A="";for(let u=0;u<a;u++)A+=String.fromCharCode(o[u]);return A})(s,i)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+Vv[t[n]]>e?n:e}},lee=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const uee=Object.prototype.toString,{Z_NO_FLUSH:qBe,Z_SYNC_FLUSH:YBe,Z_FULL_FLUSH:XBe,Z_FINISH:JBe,Z_OK:vS,Z_STREAM_END:$Be,Z_DEFAULT_COMPRESSION:ZBe,Z_DEFAULT_STRATEGY:eLe,Z_DEFLATED:tLe}=Hb;function r0(t){this.options=Kb.assign({level:ZBe,method:tLe,chunkSize:16384,windowBits:15,memLevel:8,strategy:eLe},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lee,this.strm.avail_out=0;let n=GE.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==vS)throw new Error(gf[n]);if(e.header&&GE.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(r=typeof e.dictionary=="string"?Qv.string2buf(e.dictionary):uee.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=GE.deflateSetDictionary(this.strm,r),n!==vS)throw new Error(gf[n]);this._dict_set=!0}}function nLe(t,e){const n=new r0(e);if(n.push(t,!0),n.err)throw n.msg||gf[n.err];return n.result}r0.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=e===~~e?e:e===!0?JBe:qBe,typeof t=="string"?n.input=Qv.string2buf(t):uee.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===YBe||s===XBe)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=GE.deflate(n,s),i===$Be)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=GE.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===vS;if(n.avail_out!==0){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},r0.prototype.onData=function(t){this.chunks.push(t)},r0.prototype.onEnd=function(t){t===vS&&(this.result=Kb.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var rLe={deflate:nLe};const KC=16209;var iLe=function(t,e){let n,r,i,s,o,a,A,u,d,f,m,g,v,y,w,b,I,B,M,H,K,Q,F,k;const G=t.state;n=t.next_in,F=t.input,r=n+(t.avail_in-5),i=t.next_out,k=t.output,s=i-(e-t.avail_out),o=i+(t.avail_out-257),a=G.dmax,A=G.wsize,u=G.whave,d=G.wnext,f=G.window,m=G.hold,g=G.bits,v=G.lencode,y=G.distcode,w=(1<<G.lenbits)-1,b=(1<<G.distbits)-1;e:do{g<15&&(m+=F[n++]<<g,g+=8,m+=F[n++]<<g,g+=8),I=v[m&w];t:for(;;){if(B=I>>>24,m>>>=B,g-=B,B=I>>>16&255,B===0)k[i++]=65535&I;else{if(!(16&B)){if((64&B)==0){I=v[(65535&I)+(m&(1<<B)-1)];continue t}if(32&B){G.mode=16191;break e}t.msg="invalid literal/length code",G.mode=KC;break e}M=65535&I,B&=15,B&&(g<B&&(m+=F[n++]<<g,g+=8),M+=m&(1<<B)-1,m>>>=B,g-=B),g<15&&(m+=F[n++]<<g,g+=8,m+=F[n++]<<g,g+=8),I=y[m&b];n:for(;;){if(B=I>>>24,m>>>=B,g-=B,B=I>>>16&255,!(16&B)){if((64&B)==0){I=y[(65535&I)+(m&(1<<B)-1)];continue n}t.msg="invalid distance code",G.mode=KC;break e}if(H=65535&I,B&=15,g<B&&(m+=F[n++]<<g,g+=8,g<B&&(m+=F[n++]<<g,g+=8)),H+=m&(1<<B)-1,H>a){t.msg="invalid distance too far back",G.mode=KC;break e}if(m>>>=B,g-=B,B=i-s,H>B){if(B=H-B,B>u&&G.sane){t.msg="invalid distance too far back",G.mode=KC;break e}if(K=0,Q=f,d===0){if(K+=A-B,B<M){M-=B;do k[i++]=f[K++];while(--B);K=i-H,Q=k}}else if(d<B){if(K+=A+d-B,B-=d,B<M){M-=B;do k[i++]=f[K++];while(--B);if(K=0,d<M){B=d,M-=B;do k[i++]=f[K++];while(--B);K=i-H,Q=k}}}else if(K+=d-B,B<M){M-=B;do k[i++]=f[K++];while(--B);K=i-H,Q=k}for(;M>2;)k[i++]=Q[K++],k[i++]=Q[K++],k[i++]=Q[K++],M-=3;M&&(k[i++]=Q[K++],M>1&&(k[i++]=Q[K++]))}else{K=i-H;do k[i++]=k[K++],k[i++]=k[K++],k[i++]=k[K++],M-=3;while(M>2);M&&(k[i++]=k[K++],M>1&&(k[i++]=k[K++]))}break}}break}}while(n<r&&i<o);M=g>>3,n-=M,g-=M<<3,m&=(1<<g)-1,t.next_in=n,t.next_out=i,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=i<o?o-i+257:257-(i-o),G.hold=m,G.bits=g};const GC=15,sLe=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),oLe=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),aLe=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),cLe=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var WE=(t,e,n,r,i,s,o,a)=>{const A=a.bits;let u,d,f,m,g,v,y=0,w=0,b=0,I=0,B=0,M=0,H=0,K=0,Q=0,F=0,k=null;const G=new Uint16Array(16),$=new Uint16Array(16);let ne,q,qe,je=null;for(y=0;y<=GC;y++)G[y]=0;for(w=0;w<r;w++)G[e[n+w]]++;for(B=A,I=GC;I>=1&&G[I]===0;I--);if(B>I&&(B=I),I===0)return i[s++]=20971520,i[s++]=20971520,a.bits=1,0;for(b=1;b<I&&G[b]===0;b++);for(B<b&&(B=b),K=1,y=1;y<=GC;y++)if(K<<=1,K-=G[y],K<0)return-1;if(K>0&&(t===0||I!==1))return-1;for($[1]=0,y=1;y<GC;y++)$[y+1]=$[y]+G[y];for(w=0;w<r;w++)e[n+w]!==0&&(o[$[e[n+w]]++]=w);if(t===0?(k=je=o,v=20):t===1?(k=sLe,je=oLe,v=257):(k=aLe,je=cLe,v=0),F=0,w=0,y=b,g=s,M=B,H=0,f=-1,Q=1<<B,m=Q-1,t===1&&Q>852||t===2&&Q>592)return 1;for(;;){ne=y-H,o[w]+1<v?(q=0,qe=o[w]):o[w]>=v?(q=je[o[w]-v],qe=k[o[w]-v]):(q=96,qe=0),u=1<<y-H,d=1<<M,b=d;do d-=u,i[g+(F>>H)+d]=ne<<24|q<<16|qe|0;while(d!==0);for(u=1<<y-1;F&u;)u>>=1;if(u!==0?(F&=u-1,F+=u):F=0,w++,--G[y]==0){if(y===I)break;y=e[n+o[w]]}if(y>B&&(F&m)!==f){for(H===0&&(H=B),g+=b,M=y-H,K=1<<M;M+H<I&&(K-=G[M+H],!(K<=0));)M++,K<<=1;if(Q+=1<<M,t===1&&Q>852||t===2&&Q>592)return 1;f=F&m,i[f]=B<<24|M<<16|g-s|0}}return F!==0&&(i[g+F]=y-H<<24|64<<16|0),a.bits=B,0};const{Z_FINISH:C8,Z_BLOCK:ALe,Z_TREES:WC,Z_OK:tf,Z_STREAM_END:lLe,Z_NEED_DICT:uLe,Z_STREAM_ERROR:rc,Z_DATA_ERROR:dee,Z_MEM_ERROR:hee,Z_BUF_ERROR:dLe,Z_DEFLATED:T8}=Hb,Gb=16180,yS=16190,wl=16191,xD=16192,MD=16194,zC=16199,qC=16200,FD=16206,Mr=16209,S8=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function hLe(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const nf=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Gb||e.mode>16211?1:0},fee=t=>{if(nf(t))return rc;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Gb,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,tf},pee=t=>{if(nf(t))return rc;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,fee(t)},mee=(t,e)=>{let n;if(nf(t))return rc;const r=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?rc:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,pee(t))},b8=(t,e)=>{if(!t)return rc;const n=new hLe;t.state=n,n.strm=t,n.window=null,n.mode=Gb;const r=mee(t,e);return r!==tf&&(t.state=null),r};let VD,QD,I8=!0;const fLe=t=>{if(I8){VD=new Int32Array(512),QD=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(WE(1,t.lens,0,288,VD,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;WE(2,t.lens,0,32,QD,0,t.work,{bits:5}),I8=!1}t.lencode=VD,t.lenbits=9,t.distcode=QD,t.distbits=5},gee=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var pLe=(t,e)=>{let n,r,i,s,o,a,A,u,d,f,m,g,v,y,w,b,I,B,M,H,K,Q,F=0;const k=new Uint8Array(4);let G,$;const ne=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(nf(t)||!t.output||!t.input&&t.avail_in!==0)return rc;n=t.state,n.mode===wl&&(n.mode=xD),o=t.next_out,i=t.output,A=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,u=n.hold,d=n.bits,f=a,m=A,Q=tf;e:for(;;)switch(n.mode){case Gb:if(n.wrap===0){n.mode=xD;break}for(;d<16;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}if(2&n.wrap&&u===35615){n.wbits===0&&(n.wbits=15),n.check=0,k[0]=255&u,k[1]=u>>>8&255,n.check=_s(n.check,k,2,0),u=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",n.mode=Mr;break}if((15&u)!==T8){t.msg="unknown compression method",n.mode=Mr;break}if(u>>>=4,d-=4,K=8+(15&u),n.wbits===0&&(n.wbits=K),K>15||K>n.wbits){t.msg="invalid window size",n.mode=Mr;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&u?16189:wl,u=0,d=0;break;case 16181:for(;d<16;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}if(n.flags=u,(255&ts(n))!==T8){t.msg="unknown compression method",n.mode=Mr;break}if(57344&ts(n)){t.msg="unknown header flags set",n.mode=Mr;break}n.head&&(n.head.text=u>>8&1),512&ts(n)&&4&n.wrap&&(k[0]=255&u,k[1]=u>>>8&255,n.check=_s(n.check,k,2,0)),u=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}n.head&&(n.head.time=u),512&ts(n)&&4&n.wrap&&(k[0]=255&u,k[1]=u>>>8&255,k[2]=u>>>16&255,k[3]=u>>>24&255,n.check=_s(n.check,k,4,0)),u=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&ts(n)&&4&n.wrap&&(k[0]=255&u,k[1]=u>>>8&255,n.check=_s(n.check,k,2,0)),u=0,d=0,n.mode=16184;case 16184:if(1024&ts(n)){for(;d<16;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}n.length=u,n.head&&(n.head.extra_len=u),512&ts(n)&&4&n.wrap&&(k[0]=255&u,k[1]=u>>>8&255,n.check=_s(n.check,k,2,0)),u=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&ts(n)&&(g=n.length,g>a&&(g=a),g&&(n.head&&(K=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+g),K)),512&ts(n)&&4&n.wrap&&(n.check=_s(n.check,r,g,s)),a-=g,s+=g,n.length-=g),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&ts(n)){if(a===0)break e;g=0;do K=r[s+g++],n.head&&K&&n.length<65536&&(n.head.name+=String.fromCharCode(K));while(K&&g<a);if(512&ts(n)&&4&n.wrap&&(n.check=_s(n.check,r,g,s)),a-=g,s+=g,K)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&ts(n)){if(a===0)break e;g=0;do K=r[s+g++],n.head&&K&&n.length<65536&&(n.head.comment+=String.fromCharCode(K));while(K&&g<a);if(512&ts(n)&&4&n.wrap&&(n.check=_s(n.check,r,g,s)),a-=g,s+=g,K)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&ts(n)){for(;d<16;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}if(4&n.wrap&&u!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Mr;break}u=0,d=0}n.head&&(n.head.hcrc=ts(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=wl;break;case 16189:for(;d<32;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}t.adler=n.check=S8(u),u=0,d=0,n.mode=yS;case yS:if(n.havedict===0)return t.next_out=o,t.avail_out=A,t.next_in=s,t.avail_in=a,n.hold=u,n.bits=d,uLe;t.adler=n.check=1,n.mode=wl;case wl:if(e===ALe||e===WC)break e;case xD:if(n.last){u>>>=7&d,d-=7&d,n.mode=FD;break}for(;d<3;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}switch(n.last=1&u,u>>>=1,d-=1,3&u){case 0:n.mode=16193;break;case 1:if(fLe(n),n.mode=zC,e===WC){u>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=Mr}u>>>=2,d-=2;break;case 16193:for(u>>>=7&d,d-=7&d;d<32;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}if((65535&u)!=(u>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Mr;break}if(n.length=65535&u,u=0,d=0,n.mode=MD,e===WC)break e;case MD:n.mode=16195;case 16195:if(g=n.length,g){if(g>a&&(g=a),g>A&&(g=A),g===0)break e;i.set(r.subarray(s,s+g),o),a-=g,s+=g,A-=g,o+=g,n.length-=g;break}n.mode=wl;break;case 16196:for(;d<14;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}if(n.nlen=257+(31&u),u>>>=5,d-=5,n.ndist=1+(31&u),u>>>=5,d-=5,n.ncode=4+(15&u),u>>>=4,d-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Mr;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}n.lens[ne[n.have++]]=7&u,u>>>=3,d-=3}for(;n.have<19;)n.lens[ne[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,G={bits:n.lenbits},Q=WE(0,n.lens,0,19,n.lencode,0,n.work,G),n.lenbits=G.bits,Q){t.msg="invalid code lengths set",n.mode=Mr;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;F=n.lencode[u&(1<<n.lenbits)-1],w=F>>>24,b=F>>>16&255,I=65535&F,!(w<=d);){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}if(I<16)u>>>=w,d-=w,n.lens[n.have++]=I;else{if(I===16){for($=w+2;d<$;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}if(u>>>=w,d-=w,n.have===0){t.msg="invalid bit length repeat",n.mode=Mr;break}K=n.lens[n.have-1],g=3+(3&u),u>>>=2,d-=2}else if(I===17){for($=w+3;d<$;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}u>>>=w,d-=w,K=0,g=3+(7&u),u>>>=3,d-=3}else{for($=w+7;d<$;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}u>>>=w,d-=w,K=0,g=11+(127&u),u>>>=7,d-=7}if(n.have+g>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Mr;break}for(;g--;)n.lens[n.have++]=K}}if(n.mode===Mr)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=Mr;break}if(n.lenbits=9,G={bits:n.lenbits},Q=WE(1,n.lens,0,n.nlen,n.lencode,0,n.work,G),n.lenbits=G.bits,Q){t.msg="invalid literal/lengths set",n.mode=Mr;break}if(n.distbits=6,n.distcode=n.distdyn,G={bits:n.distbits},Q=WE(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,G),n.distbits=G.bits,Q){t.msg="invalid distances set",n.mode=Mr;break}if(n.mode=zC,e===WC)break e;case zC:n.mode=qC;case qC:if(a>=6&&A>=258){t.next_out=o,t.avail_out=A,t.next_in=s,t.avail_in=a,n.hold=u,n.bits=d,iLe(t,m),o=t.next_out,i=t.output,A=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,u=n.hold,d=n.bits,n.mode===wl&&(n.back=-1);break}for(n.back=0;F=n.lencode[u&(1<<n.lenbits)-1],w=F>>>24,b=F>>>16&255,I=65535&F,!(w<=d);){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}if(b&&(240&b)==0){for(B=w,M=b,H=I;F=n.lencode[H+((u&(1<<B+M)-1)>>B)],w=F>>>24,b=F>>>16&255,I=65535&F,!(B+w<=d);){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}u>>>=B,d-=B,n.back+=B}if(u>>>=w,d-=w,n.back+=w,n.length=I,b===0){n.mode=16205;break}if(32&b){n.back=-1,n.mode=wl;break}if(64&b){t.msg="invalid literal/length code",n.mode=Mr;break}n.extra=15&b,n.mode=16201;case 16201:if(n.extra){for($=n.extra;d<$;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;F=n.distcode[u&(1<<n.distbits)-1],w=F>>>24,b=F>>>16&255,I=65535&F,!(w<=d);){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}if((240&b)==0){for(B=w,M=b,H=I;F=n.distcode[H+((u&(1<<B+M)-1)>>B)],w=F>>>24,b=F>>>16&255,I=65535&F,!(B+w<=d);){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}u>>>=B,d-=B,n.back+=B}if(u>>>=w,d-=w,n.back+=w,64&b){t.msg="invalid distance code",n.mode=Mr;break}n.offset=I,n.extra=15&b,n.mode=16203;case 16203:if(n.extra){for($=n.extra;d<$;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Mr;break}n.mode=16204;case 16204:if(A===0)break e;if(g=m-A,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Mr;break}g>n.wnext?(g-=n.wnext,v=n.wsize-g):v=n.wnext-g,g>n.length&&(g=n.length),y=n.window}else y=i,v=o-n.offset,g=n.length;g>A&&(g=A),A-=g,n.length-=g;do i[o++]=y[v++];while(--g);n.length===0&&(n.mode=qC);break;case 16205:if(A===0)break e;i[o++]=n.length,A--,n.mode=qC;break;case FD:if(n.wrap){for(;d<32;){if(a===0)break e;a--,u|=r[s++]<<d,d+=8}if(m-=A,t.total_out+=m,n.total+=m,4&n.wrap&&m&&(t.adler=n.check=ts(n)?_s(n.check,i,m,o-m):Mv(n.check,i,m,o-m)),m=A,4&n.wrap&&(ts(n)?u:S8(u))!==n.check){t.msg="incorrect data check",n.mode=Mr;break}u=0,d=0}n.mode=16207;case 16207:if(n.wrap&&ts(n)){for(;d<32;){if(a===0)break e;a--,u+=r[s++]<<d,d+=8}if(4&n.wrap&&u!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Mr;break}u=0,d=0}n.mode=16208;case 16208:Q=lLe;break e;case Mr:Q=dee;break e;case 16210:return hee;default:return rc}return t.next_out=o,t.avail_out=A,t.next_in=s,t.avail_in=a,n.hold=u,n.bits=d,(n.wsize||m!==t.avail_out&&n.mode<Mr&&(n.mode<FD||e!==C8))&&gee(t,t.output,t.next_out,m-t.avail_out),f-=t.avail_in,m-=t.avail_out,t.total_in+=f,t.total_out+=m,n.total+=m,4&n.wrap&&m&&(t.adler=n.check=ts(n)?_s(n.check,i,m,t.next_out-m):Mv(n.check,i,m,t.next_out-m)),t.data_type=n.bits+(n.last?64:0)+(n.mode===wl?128:0)+(n.mode===zC||n.mode===MD?256:0),(f===0&&m===0||e===C8)&&Q===tf&&(Q=dLe),Q},Bl={inflateReset:pee,inflateReset2:mee,inflateResetKeep:fee,inflateInit:t=>b8(t,15),inflateInit2:b8,inflate:pLe,inflateEnd:t=>{if(nf(t))return rc;let e=t.state;return e.window&&(e.window=null),t.state=null,tf},inflateGetHeader:(t,e)=>{if(nf(t))return rc;const n=t.state;return(2&n.wrap)==0?rc:(n.head=e,e.done=!1,tf)},inflateSetDictionary:(t,e)=>{const n=e.length;let r,i,s;return nf(t)?rc:(r=t.state,r.wrap!==0&&r.mode!==yS?rc:r.mode===yS&&(i=1,i=Mv(i,e,n,0),i!==r.check)?dee:(s=gee(t,e,n,n),s?(r.mode=16210,hee):(r.havedict=1,tf)))},inflateInfo:"pako inflate (from Nodeca project)"},mLe=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const _ee=Object.prototype.toString,{Z_NO_FLUSH:gLe,Z_FINISH:_Le,Z_OK:zE,Z_STREAM_END:HD,Z_NEED_DICT:jD,Z_STREAM_ERROR:ELe,Z_DATA_ERROR:R8,Z_MEM_ERROR:vLe}=Hb;function i0(t){this.options=Kb.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lee,this.strm.avail_out=0;let n=Bl.inflateInit2(this.strm,e.windowBits);if(n!==zE)throw new Error(gf[n]);if(this.header=new mLe,Bl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=Qv.string2buf(e.dictionary):_ee.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Bl.inflateSetDictionary(this.strm,e.dictionary),n!==zE)))throw new Error(gf[n])}function yLe(t,e){const n=new i0(e);if(n.push(t),n.err)throw n.msg||gf[n.err];return n.result}i0.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=e===~~e?e:e===!0?_Le:gLe,_ee.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=Bl.inflate(n,o),s===jD&&i&&(s=Bl.inflateSetDictionary(n,i),s===zE?s=Bl.inflate(n,o):s===R8&&(s=jD));n.avail_in>0&&s===HD&&n.state.wrap>0&&t[n.next_in]!==0;)Bl.inflateReset(n),s=Bl.inflate(n,o);switch(s){case ELe:case R8:case jD:case vLe:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||s===HD))if(this.options.to==="string"){let A=Qv.utf8border(n.output,n.next_out),u=n.next_out-A,d=Qv.buf2string(n.output,A);n.next_out=u,n.avail_out=r-u,u&&n.output.set(n.output.subarray(A,A+u),0),this.onData(d)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==zE||a!==0){if(s===HD)return s=Bl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},i0.prototype.onData=function(t){this.chunks.push(t)},i0.prototype.onEnd=function(t){t===zE&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Kb.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var wLe={inflate:yLe};const{deflate:CLe}=rLe,{inflate:TLe}=wLe;var SLe=CLe,bLe=TLe,Eee=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(Eee||{});class ILe{constructor(){N(this,"_sequence",0),N(this,"_startTime",Date.now()),N(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const a=new Uint8Array(4);a.set([1,0,0,0]);const A={id:0,length:4,data:a.buffer},u={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[A]};n.commonPacketHeader.extension=1,n.extension=u,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;j("SHOW_DATASTREAM2_LOG")&&S.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),s=new DataView(r);let o=0;if(s.setUint16(o,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),o+=2,s.setUint32(o,n.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,n.commonStreamHeader,!0),o+=2,n.extension){const a=this.serializeExtension(n.extension);i.set(new Uint8Array(a),o),o+=a.byteLength}if(i.set(new Uint8Array(n.payload),o),o+=n.payload.byteLength,o!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let r=0;const i=n.getUint16(r,!0);r+=2;const s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let o,a;if(r+=4,j("SHOW_DATASTREAM2_LOG")&&S.debug("receive data header: ".concat(JSON.stringify(s))),n.getUint16(r,!0),r+=2,s.extension){a=this.deserializeExtension(e.slice(r)),r+=2+a.length,o=e.slice(r);let A=!1;if(a.datas.length>0){const u=a.datas.find(d=>d.id===0);u&&(A=(1&new DataView(u.data).getUint32(0,!0))==1)}o=A?this.decompress(o):o}else o=e.slice(8);return o}serializeExtension(e){const{profile:n,length:r,datas:i}=e,s=new ArrayBuffer(r+2),o=new Uint8Array(s),a=new DataView(s);let A=0;if(a.setUint8(A++,n),a.setUint8(A++,r),i.forEach(u=>{n?(a.setUint8(A++,u.id),a.setUint8(A++,u.length),o.set(new Uint8Array(u.data),A),A+=u.data.byteLength):(a.setUint8(A++,u.id|u.length<<4),o.set(new Uint8Array(u.data),A),A+=u.data.byteLength)}),A!==r+2)throw Error("serialize extension error, is ".concat(A,"!==").concat(r+2));return s}deserializeExtension(e){const n=new DataView(e);let r=0;const i=n.getUint8(r);r++;const s=n.getUint8(r);r++;const o=i===Eee.TWO_BYTE,a=[],A=new DataView(e,2);let u=0;for(;u<s;){let d=0,f=0,m=new ArrayBuffer(0);o?(d=A.getUint8(u),u++,f=A.getUint8(u),u++):(d=15&A.getUint8(u),f=A.getUint8(u)>>4,u++),f>0&&(m=A.buffer.slice(u+2,u+2+f),u+=m.byteLength),a.push({id:d,length:f,data:m})}if(u!==s)throw Error("parse error");return{profile:i,length:s,datas:a}}decompress(e){return bLe(new Uint8Array(e))}compress(e){return SLe(new Uint8Array(e))}}const RLe={name:"DataStream",create:(t,e)=>{const n=e?new uDe(t):new dDe(t);return n.useDataStream(new ILe),n}};class OLe extends Ln{constructor(e,n,r){super(),N(this,"ws",void 0),N(this,"requestId",1),N(this,"heartBeatTimer",void 0),N(this,"joinInfo",void 0),N(this,"clientId",void 0),N(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),N(this,"onClose",i=>{this.emit("close"),this.dispose()}),N(this,"onMessage",i=>{const s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=e,this.clientId=n,this.ws=new bv("cross-channel-".concat(this.clientId),r),this.ws.on(Ye.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ye.CONNECTED,this.onOpen),this.ws.on(Ye.ON_MESSAGE,this.onMessage),this.ws.on(Ye.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new ye((n,r)=>{const i=window.setTimeout(()=>{r(new te(L.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,s=>{window.clearTimeout(i),s.state&&s.state!==0?r(new te(L.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new te(L.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new te(L.WS_DISCONNECT);const n=()=>new ye((o,a)=>{this.ws.once(Ye.CLOSED,()=>a(new te(L.WS_ABORT))),this.ws.once(Ye.CONNECTED,o)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(e),i=new ye((o,a)=>{const A=()=>{a(new te(L.WS_ABORT))};this.ws.once(Ye.RECONNECTING,A),this.ws.once(Ye.CLOSED,A),this.once("req_".concat(r),o),Zr(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Ye.RECONNECTING,A),this.ws.off(Ye.CLOSED,A),a(new te(L.TIMEOUT,"cross channel ws request timeout"))})}),s=await i;if(!s||s.code!==200)throw new te(L.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(e){this.ws.removeAllListeners(Ye.REQUEST_NEW_URLS),this.ws.on(Ye.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class NLe extends Ln{set state(e){e!==this._state&&(e!==Xs.RELAY_STATE_FAILURE&&(this.errorCode=Kp.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,r,i,s){super(),N(this,"joinInfo",void 0),N(this,"sid",void 0),N(this,"clientId",void 0),N(this,"cancelToken",js.CancelToken.source()),N(this,"workerToken",void 0),N(this,"requestId",0),N(this,"signal",void 0),N(this,"prevChannelMediaConfig",void 0),N(this,"httpRetryConfig",void 0),N(this,"_resolution",void 0),N(this,"_state",Xs.RELAY_STATE_IDLE),N(this,"errorCode",Kp.RELAY_OK),N(this,"onStatus",o=>{S.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",bl.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",bl.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Kp.SRC_TOKEN_EXPIRED,this.state=Xs.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Kp.DEST_TOKEN_EXPIRED,this.state=Xs.RELAY_STATE_FAILURE))}),N(this,"onReconnect",async()=>{S.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",bl.NETWORK_DISCONNECTED),this.state=Xs.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o=>{this.state!==Xs.RELAY_STATE_IDLE&&(S.error("auto restart channel media relay failed",o.toString()),this.errorCode=Kp.SERVER_CONNECTION_LOST,this.state=Xs.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=im(),this.signal=new OLe(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(e){if(this.state!==Xs.RELAY_STATE_IDLE)throw new te(L.INVALID_OPERATION);this.state=Xs.RELAY_STATE_CONNECTING,await this.connect(),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new te(L.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new te(L.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new te(L.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Xs.RELAY_STATE_RUNNING)throw new te(L.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Xs.RELAY_STATE_RUNNING)throw new te(L.INVALID_OPERATION);const n=this.genMessage(ps.SetVideoProfile);await this.signal.request(n),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),S.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Xs.RELAY_STATE_IDLE,this.dispose()}dispose(){S.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=js.CancelToken.source(),this.state=Xs.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await CDe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",bl.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(ps.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(ps.SetSdkProfile,e);await this.signal.request(r),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(ps.SetSourceChannel,e);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",bl.PACKET_JOINED_SRC_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const s=this.genMessage(ps.SetSourceUserId,e);await this.signal.request(s),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(ps.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",bl.PACKET_JOINED_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage(ps.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",bl.PACKET_SENT_TO_DEST_CHANNEL),this.state=Xs.RELAY_STATE_RUNNING,S.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(ps.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",bl.PACKET_UPDATE_DEST_CHANNEL),S.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(ps.StopPacketTransfer);await this.signal.request(e),S.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const r=[],i=[],s=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ya,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.22.0"&&(o.sdkVersion="0.0.1");let a=null,A=null;switch(e){case ps.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case ps.SetSourceChannel:if(A=n&&n.getSrcChannelMediaInfo(),!A)throw new te(L.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:A.channelName,token:A.token||this.joinInfo.appId},o;case ps.SetSourceUserId:if(A=n&&n.getSrcChannelMediaInfo(),!A)throw new te(L.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:A.uid+""},o;case ps.SetDestChannel:if(a=n&&n.getDestChannelMediaInfo(),!a)throw new te(L.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(u=>{r.push(u.channelName),i.push(u.uid+""),s.push(u.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:s},o;case ps.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case ps.Reconnect:return o.clientRequest={command:"Reconnect"},o;case ps.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case ps.UpdateDestChannel:if(a=n&&n.getDestChannelMediaInfo(),!a)throw new te(L.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(u=>{r.push(u.channelName),i.push(u.uid+""),s.push(u.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:s},o;case ps.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const DLe={name:"ChannelMediaRelay",create:function(t){return new NLe(t.joinInfo,t.clientId,t.websocketRetryConfig||hr,t.httpRetryConfig||hr,t.resolution)}};function O8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Y_(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?O8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class BLe extends Ln{constructor(e,n,r,i){super(),N(this,"spec",void 0),N(this,"token",void 0),N(this,"websocket",void 0),N(this,"pingpongTimer",void 0),N(this,"reconnectMode","retry"),N(this,"serviceMode",void 0),N(this,"reqId",0),N(this,"commandReqId",0),N(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),N(this,"handleWebSocketMessage",s=>{if(!s.data)return;const o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(Le.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===xl.TRANSCODE?1:2}),this.emit(Xu.PUBLISH_STREAM_STATUS,o))}),this.spec=n,this.token=e,this.serviceMode=i,this.websocket=new bv("live-streaming",r),this.websocket.on(Ye.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ye.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ye.REQUEST_NEW_URLS,(s,o)=>{fi(this,Xu.REQUEST_NEW_ADDRESS).then(s).catch(o)}),this.websocket.on(Ye.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,r,i){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new te(L.UNEXPECTED_ERROR);const a=Y_({command:e,sdkVersion:ya==="4.22.0"?"0.0.1":ya,seq:o,requestId:o,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new te(L.WS_DISCONNECT);const A=()=>new ye((m,g)=>{this.websocket.once(Ye.CLOSED,()=>g(new te(L.WS_ABORT))),this.websocket.once(Ye.CONNECTED,m)});this.websocket.state!=="connected"&&await A(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const u=new ye((m,g)=>{const v=()=>{g(new te(L.WS_ABORT))};this.websocket.once(Ye.RECONNECTING,v),this.websocket.once(Ye.CLOSED,v),this.once("@".concat(o,"-").concat(this.spec.sid),y=>{m(y)})});i&&Le.workerEvent(this.spec.sid,Y_(Y_({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const d=Date.now();this.websocket.sendMessage(a);let f=null;try{f=await u}catch(m){if(this.websocket.state==="closed")throw m;return await A(),await this.request(e,n,r)}return i&&Le.workerEvent(this.spec.sid,Y_(Y_({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(f.serverResponse),serverCode:f.code,success:f.code===200,responseTime:Date.now()-d})),f.code!==200&&this.handleResponseError(f),f}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=ya==="4.22.0"?"0.0.1":ya;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Er.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void S.warning("live stream response already exists stream");case Er.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Er.LIVE_STREAM_RESPONSE_BAD_STREAM:case Er.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new te(L.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Er.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new te(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Er.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new te(L.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Er.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new te(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Xu.WARNING,n,e.serverResponse.url)}case Er.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new te(L.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Xu.WARNING,n,e.serverResponse.url)}case Er.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new te(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Er.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new te(L.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Er.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new te(L.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Xu.WARNING,n,e.serverResponse.url)}case Er.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new te(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Er.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new te(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Er.LIVE_STREAM_RESPONSE_WORKER_LOST:case Er.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new te(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Er.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new te(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new te(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Er.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Er.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Er.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Er.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new te(L.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(kb)},6e3)}}function N8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Ys(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?N8(Object(n),!0).forEach(function(r){N(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N8(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class LLe extends Ln{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:hr,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:hr;super(),N(this,"onLiveStreamWarning",void 0),N(this,"onLiveStreamError",void 0),N(this,"spec",void 0),N(this,"retryTimeout",1e4),N(this,"connection",void 0),N(this,"httpRetryConfig",void 0),N(this,"wsRetryConfig",void 0),N(this,"streamingTasks",new Map),N(this,"isStartingStreamingTask",!1),N(this,"taskMutex",new Pi("live-streaming")),N(this,"cancelToken",js.CancelToken.source()),N(this,"transcodingConfig",void 0),N(this,"uapResponse",void 0),N(this,"lastTaskId",1),N(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=Ys(Ys({},OOe),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(S.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(o=>Ys(Ys(Ys({},ROe),o),{},{zOrder:o.zOrder?o.zOrder+1:1}))),function(o){On(o.width)||jt(o.width,"config.width",0,1e4),On(o.height)||jt(o.height,"config.height",0,1e4),On(o.videoBitrate)||jt(o.videoBitrate,"config.videoBitrate",1,1e6),On(o.videoFrameRate)||jt(o.videoFrameRate,"config.videoFrameRate"),On(o.lowLatency)||Ll(o.lowLatency,"config.lowLatency"),On(o.audioSampleRate)||Rr(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),On(o.audioBitrate)||jt(o.audioBitrate,"config.audioBitrate",1,128),On(o.audioChannels)||Rr(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),On(o.videoGop)||jt(o.videoGop,"config.videoGop"),On(o.videoCodecProfile)||Rr(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),On(o.userCount)||jt(o.userCount,"config.userCount",0,17),On(o.backgroundColor)||jt(o.backgroundColor,"config.backgroundColor",0,16777215),On(o.userConfigExtraInfo)||zr(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!On(o.transcodingUsers)&&(Nl(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach((a,A)=>{Fb(a.uid),On(a.x)||jt(a.x,"transcodingUser[".concat(A,"].x"),0,1e4),On(a.y)||jt(a.y,"transcodingUser[".concat(A,"].y"),0,1e4),On(a.width)||jt(a.width,"transcodingUser[".concat(A,"].width"),0,1e4),On(a.height)||jt(a.height,"transcodingUser[".concat(A,"].height"),0,1e4),On(a.zOrder)||jt(a.zOrder-1,"transcodingUser[".concat(A,"].zOrder"),0,100),On(a.alpha)||jt(a.alpha,"transcodingUser[".concat(A,"].alpha"),0,1,!1)})),On(o.watermark)||WN(o.watermark,"watermark"),On(o.backgroundImage)||WN(o.backgroundImage,"backgroundImage"),o.images&&!On(o.images)&&(Nl(o.images,"config.images"),o.images.forEach((a,A)=>{WN(a,"images[".concat(A,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(o=>Ys(Ys(Ys({},GN),o),{},{zOrder:255}))),n.backgroundImage&&(r.push(Ys(Ys(Ys({},GN),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(Ys(Ys(Ys({},GN),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(o=>Ys({},o)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map(o=>typeof o.uid=="number"?ye.resolve(o.uid):RZ(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ye.all(i)).forEach((o,a)=>{n.userConfigs&&n.userConfigs[a]&&(n.userConfigs[a].uid=o)}),this.transcodingConfig=n,this.connection)try{var s;const o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Hl(s=this.streamingTasks).call(s)).map(a=>a.taskId).join("#")});S.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(a=>{S.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,o).then(()=>{S.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(a.url," success"))}).catch(A=>{S.error("[".concat(this.spec.clientId,"] live streaming republish failed"),a.url,A.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,A)})})}}async startLiveStreamingTask(e,n,r){if(!this.transcodingConfig&&n===xl.TRANSCODE)throw new te(L.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};S.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const s=await this.taskMutex.lock();if(!this.connection&&r)return void s();if(this.streamingTasks.get(e)&&!r)return s(),new te(L.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(a){throw s(),a}switch(n){case xl.TRANSCODE:i.transcodingConfig=Ys({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const a=new ye((u,d)=>{Zr(this.retryTimeout).then(()=>{if(r)return d(r);const f=this.statusError.get(e);return f?(this.statusError.delete(e),d(f)):void 0})}),A=await ye.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:n===xl.TRANSCODE?1:2,requestByUser:!r,tid:o.toString()}),a]);this.isStartingStreamingTask=!1,S.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(A.code)),this.streamingTasks.set(e,{clientRequest:i,mode:n,url:e,taskId:o}),s()}catch(a){if(s(),this.isStartingStreamingTask=!1,!a.data||!a.data.retry||r)throw a;return a.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,a)):await this.startLiveStreamingTask(e,n,a)}}stopLiveStreamingTask(e){return new ye((n,r)=>{const i=this.streamingTasks.get(e);if(!i||!this.connection)return new te(L.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const s=i.mode;i.abortTask=()=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:s===xl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o=>{S.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var e;const n=Array.from(Hl(e=this.streamingTasks).call(e));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=js.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new te(L.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await fi(this,$L.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new BLe(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(Xu.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(Xu.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(Xu.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new te(L.UNEXPECTED_ERROR,"can not get new live streaming address list"));fi(this,$L.REQUEST_WORKER_MANAGER_LIST,e).then(s=>{this.uapResponse=s,r(s.addressList)}).catch(i)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=e.reason;switch(e.code){case Er.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Er.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Er.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Er.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const o=new te(L.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(r)return S.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,o);if(!this.isStartingStreamingTask)return;this.statusError.set(n,o)}case Er.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new te(L.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,o)}case Er.LIVE_STREAM_RESPONSE_WORKER_LOST:case Er.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();const o=Array.from(Hl(s=this.streamingTasks).call(s));for(const a of o)a.abortTask?a.abortTask():(S.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,new te(L.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{S.debug("[".concat(this.spec.clientId,"] republish live stream success"),a.url)}).catch(A=>{S.error(A.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,A)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const ULe={name:"LiveStreaming",create:function(t){return new LLe(t.joinInfo,t.websocketRetryConfig||hr,t.httpRetryConfig||hr)}};function PLe(t){let e=D8();return function(n,r){let i=n.appId;i!==void 0&&(xt(r,10),CA(r,i));let s=n.cid;s!==void 0&&(xt(r,16),xt(r,s));let o=n.cname;o!==void 0&&(xt(r,26),CA(r,o));let a=n.deviceId;a!==void 0&&(xt(r,34),CA(r,a));let A=n.elapse;A!==void 0&&(xt(r,40),Mu(r,A));let u=n.fileSize;u!==void 0&&(xt(r,48),Mu(r,Op(u)));let d=n.height;d!==void 0&&(xt(r,56),Mu(r,Op(d)));let f=n.jpg;f!==void 0&&(xt(r,66),xt(r,f.length),function(de,J){let Y=Bg(de,J.length);de.bytes.set(J,Y)}(r,f));let m=n.networkType;m!==void 0&&(xt(r,72),Mu(r,Op(m)));let g=n.osType;g!==void 0&&(xt(r,80),Mu(r,Op(g)));let v=n.requestId;v!==void 0&&(xt(r,90),CA(r,v));let y=n.sdkVersion;y!==void 0&&(xt(r,98),CA(r,y));let w=n.sequence;w!==void 0&&(xt(r,104),Mu(r,Op(w)));let b=n.sid;b!==void 0&&(xt(r,114),CA(r,b));let I=n.timestamp;I!==void 0&&(xt(r,120),Mu(r,I));let B=n.uid;B!==void 0&&(xt(r,128),xt(r,B));let M=n.vid;M!==void 0&&(xt(r,136),xt(r,M));let H=n.width;H!==void 0&&(xt(r,144),Mu(r,Op(H)));let K=n.service;K!==void 0&&(xt(r,152),xt(r,K));let Q=n.callbackData;Q!==void 0&&(xt(r,162),CA(r,Q));let F=n.jpgEncryption;F!==void 0&&(xt(r,168),xt(r,F));let k=n.requestType;k!==void 0&&(xt(r,176),xt(r,k));let G=n.scorePorn;G!==void 0&&(xt(r,185),WD(r,G));let $=n.scoreSexy;$!==void 0&&(xt(r,193),WD(r,$));let ne=n.scoreNeutral;ne!==void 0&&(xt(r,201),WD(r,ne));let q=n.scene;q!==void 0&&(xt(r,208),xt(r,q));let qe=n.ossFilePrefix;qe!==void 0&&(xt(r,218),CA(r,qe));let je=n.serviceVendor;if(je!==void 0)for(let de of je){xt(r,226);let J=D8();MLe(de,J),xt(r,J.limit),HLe(r,J),QLe(J)}}(t,e),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(e)}function kLe(t){return function(n){let r={};e:for(;!wee(n);){let i=RA(n);switch(i>>>3){case 0:break e;case 1:r.code=RA(n);break;case 2:r.msg=Cee(n,RA(n));break;case 3:{let s=FLe(n);r.data=xLe(n),n.limit=s;break}default:vee(n,7&i)}}return r}({bytes:e=t,offset:0,limit:e.length});var e}function xLe(t){let e={};e:for(;!wee(t);){let n=RA(t);switch(n>>>3){case 0:break e;case 1:e.requestId=Cee(t,RA(t));break;case 2:e.requestType=RA(t)>>>0;break;case 3:e.scorePorn=GD(t);break;case 4:e.scoreSexy=GD(t);break;case 5:e.scoreNeutral=GD(t);break;case 6:e.requestScene=RA(t)>>>0;break;case 7:e.scene=RA(t)>>>0;break;default:vee(t,7&n)}}return e}function MLe(t,e){let n=t.service;n!==void 0&&(xt(e,8),xt(e,n));let r=t.vendor;r!==void 0&&(xt(e,16),xt(e,r));let i=t.token;i!==void 0&&(xt(e,26),CA(e,i));let s=t.callbackUrl;s!==void 0&&(xt(e,34),CA(e,s))}function FLe(t){let e=RA(t),n=t.limit;return t.limit=t.offset+e,n}function vee(t,e){switch(e){case 0:for(;128&Tee(t););break;case 2:KD(t,RA(t));break;case 5:KD(t,4);break;case 1:KD(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let VLe=new Float32Array(1);new Uint8Array(VLe.buffer);let Yk=new Float64Array(1),Zs=new Uint8Array(Yk.buffer);function Op(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let yee=[];function D8(){const t=yee.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function QLe(t){yee.push(t)}function KD(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function wee(t){return t.offset>=t.limit}function Bg(t,e){let n=t.bytes,r=t.offset,i=t.limit,s=r+e;if(s>n.length){let o=new Uint8Array(2*s);o.set(n),t.bytes=o}return t.offset=s,s>i&&(t.limit=s),r}function Xk(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function Cee(t,e){let n=Xk(t,e),r=String.fromCharCode,i=t.bytes,s="",o="";for(let a=0;a<e;a++){let A,u,d,f,m=i[a+n];(128&m)==0?o+=r(m):(224&m)==192?a+1>=e?o+=s:(A=i[a+n+1],(192&A)!=128?o+=s:(f=(31&m)<<6|63&A,f<128?o+=s:(o+=r(f),a++))):(240&m)==224?a+2>=e?o+=s:(A=i[a+n+1],u=i[a+n+2],(49344&(A|u<<8))!=32896?o+=s:(f=(15&m)<<12|(63&A)<<6|63&u,f<2048||f>=55296&&f<=57343?o+=s:(o+=r(f),a+=2))):(248&m)==240?a+3>=e?o+=s:(A=i[a+n+1],u=i[a+n+2],d=i[a+n+3],(12632256&(A|u<<8|d<<16))!=8421504?o+=s:(f=(7&m)<<18|(63&A)<<12|(63&u)<<6|63&d,f<65536||f>1114111?o+=s:(f-=65536,o+=r(55296+(f>>10),56320+(1023&f)),a+=3))):o+=s}return o}function CA(t,e){let n=e.length,r=0;for(let o=0;o<n;o++){let a=e.charCodeAt(o);a>=55296&&a<=56319&&o+1<n&&(a=(a<<10)+e.charCodeAt(++o)-56613888),r+=a<128?1:a<2048?2:a<65536?3:4}xt(t,r);let i=Bg(t,r),s=t.bytes;for(let o=0;o<n;o++){let a=e.charCodeAt(o);a>=55296&&a<=56319&&o+1<n&&(a=(a<<10)+e.charCodeAt(++o)-56613888),a<128?s[i++]=a:(a<2048?s[i++]=a>>6&31|192:(a<65536?s[i++]=a>>12&15|224:(s[i++]=a>>18&7|240,s[i++]=a>>12&63|128),s[i++]=a>>6&63|128),s[i++]=63&a|128)}}function HLe(t,e){let n=Bg(t,e.limit),r=t.bytes,i=e.bytes;for(let s=0,o=e.limit;s<o;s++)r[s+n]=i[s]}function Tee(t){return t.bytes[Xk(t,1)]}function B8(t,e){let n=Bg(t,1);t.bytes[n]=e}function GD(t){let e=Xk(t,8),n=t.bytes;return Zs[0]=n[e++],Zs[1]=n[e++],Zs[2]=n[e++],Zs[3]=n[e++],Zs[4]=n[e++],Zs[5]=n[e++],Zs[6]=n[e++],Zs[7]=n[e++],Yk[0]}function WD(t,e){let n=Bg(t,8),r=t.bytes;Yk[0]=e,r[n++]=Zs[0],r[n++]=Zs[1],r[n++]=Zs[2],r[n++]=Zs[3],r[n++]=Zs[4],r[n++]=Zs[5],r[n++]=Zs[6],r[n++]=Zs[7]}function RA(t){let e,n=0,r=0;do e=Tee(t),n<32&&(r|=(127&e)<<n),n+=7;while(128&e);return r}function xt(t,e){for(e>>>=0;e>=128;)B8(t,127&e|128),e>>>=7;B8(t,e)}function Mu(t,e){let n=e.low>>>0,r=(e.low>>>28|e.high<<4)>>>0,i=e.high>>>24,s=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,o=Bg(t,s),a=t.bytes;switch(s){case 10:a[o+9]=i>>>7&1;case 9:a[o+8]=s!==9?128|i:127&i;case 8:a[o+7]=s!==8?r>>>21|128:r>>>21&127;case 7:a[o+6]=s!==7?r>>>14|128:r>>>14&127;case 6:a[o+5]=s!==6?r>>>7|128:r>>>7&127;case 5:a[o+4]=s!==5?128|r:127&r;case 4:a[o+3]=s!==4?n>>>21|128:n>>>21&127;case 3:a[o+2]=s!==3?n>>>14|128:n>>>14&127;case 2:a[o+1]=s!==2?n>>>7|128:n>>>7&127;case 1:a[o]=s!==1?128|n:127&n}}function L8(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}const jLe=new Map([["moderation",1],["supervise",2]]);function U8(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}class KLe extends Ln{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Vr.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=qc(n=e.map(r=>jLe.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),N(this,"name","AgoraRTCVideoContentInspect"),N(this,"_connectionState",za.CONNECTING),N(this,"_innerConnectionState",void 0),N(this,"sequence",0),N(this,"inspectStartTime",void 0),N(this,"workerManagerConnection",void 0),N(this,"workerConnection",void 0),N(this,"workerMessageLengthLimit",void 0),N(this,"inspectIntervalMinimum",void 0),N(this,"qualityRatio",void 0),N(this,"_connectInfo",void 0),N(this,"_cancelTokenSource",js.CancelToken.source()),N(this,"_retryConfig",void 0),N(this,"wmSequence",0),N(this,"inspectInterval",void 0),N(this,"inspectTimer",null),N(this,"ossFilePrefix",void 0),N(this,"extraInfo",void 0),N(this,"_inspectType",void 0),N(this,"_inspectMode",void 0),N(this,"_quality",1),N(this,"qualityTimer",null),N(this,"_inspectId",void 0),N(this,"_needWorkUrlOnly",!1),N(this,"inspectImage",()=>{if(this.connectionState!==za.CONNECTED)throw new te(L.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===za.CONNECTED?this.requestToInspectImage():S.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=tn(5,"inspect-"),this.workerMessageLengthLimit=j("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=j("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=j("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new bv("worker-manager-"+this._inspectId,hr),this.on(Vr.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,S.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Va[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new bv("worker-"+this._inspectId,hr),this.handleWorkerEvents()}async init(e,n){this.emit(Vr.STATE_CHANGE,Va.CONNECT_AP),this._connectInfo=e;const r=this._cancelTokenSource.token;return this._retryConfig=n,new ye((i,s)=>{this.on(Vr.CONNECTION_STATE_CHANGE,(o,a)=>{a===za.CONNECTED&&i()}),this.requestAP(e,r,n).then(o=>{this.connectWorkerManager(o)}).catch(o=>{s(o)})})}async requestAP(e,n,r){const i=j("WEBCS_DOMAIN").map(a=>"https://".concat(a,"/api/v1")),s=await function(a,A,u,d){let{appId:f,areaCode:m,cname:g,sid:v,token:y,uid:w}=A;Tm++;const b="image_moderation_api",I={service_name:b,json_body:JSON.stringify({appId:f,areaCode:m,cname:g,command:"allocateEdge",requestId:Tm,seq:Tm,sid:v,token:y,ts:Date.now(),uid:w+""})};let B,M,H=a[0];return Jc(async()=>{B=Date.now();const K=await $c(H,{data:I,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(M=Date.now()-B,K.code!==0){const G=new te(L.UNEXPECTED_RESPONSE,"image inspect ap error, code"+K.code,{retry:!0,responseTime:M});throw S.error(G.toString()),G}const Q=JSON.parse(K.json_body);if(Q.code!==200){const G=new te(L.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Q.code,", reason: ").concat(Q.reason),{code:Q.code,responseTime:M});throw S.error(G.toString()),G}if(!Q.servers||!Array.isArray(Q.servers)||Q.servers.length===0){const G=new te(L.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Q.code,responseTime:M});throw S.error(G.toString()),G}const F=j("VIDEO_INSPECT_WORKER_MANAGER_HOST"),k=j("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Q.servers.map(G=>{let{address:$,wss:ne}=G;if($&&ne)return"wss://".concat($.replace(/\./g,"-"),".").concat(F,":").concat(k||ne)}).filter(G=>!!G),workerToken:Q.workerToken,vid:Q.vid,responseTime:M}},(K,Q)=>(Le.apworkerEvent(v,{success:!0,sc:200,serviceName:b,responseDetail:JSON.stringify(K.addressList),firstSuccess:Q===0,responseTime:M,serverIp:a[Q%a.length]}),!1),(K,Q)=>(Le.apworkerEvent(v,{success:!1,sc:K.data&&K.data.code||200,serviceName:b,responseTime:M,serverIp:a[Q%a.length]}),!!(K.code!==L.OPERATION_ABORTED&&K.code!==L.UNEXPECTED_RESPONSE||K.data&&K.data.retry)&&(H=a[(Q+1)%a.length],!0)),d)}(i,e,n,r);this.emit(Vr.STATE_CHANGE,Va.AP_CONNECTED);const{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Vr.STATE_CHANGE,Va.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ye.CONNECTED,async()=>{this.emit(Vr.STATE_CHANGE,Va.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ye.CLOSED,()=>{this._innerConnectionState<Va.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ye.FAILED,()=>{this._innerConnectionState<Va.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ye.RECONNECTING,()=>{this._innerConnectionState<Va.GET_WORKER_MANAGER_RESPONSE&&S.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ye.ON_MESSAGE,async e=>{this.emit(Vr.STATE_CHANGE,Va.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(e.data);if(r.code!==200)throw S.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new te(L.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw S.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new te(L.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=j("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,s=n.replace(/:\d+\/?$/,":".concat(i));this.emit(Vr.STATE_CHANGE,Va.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(Vr.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(Ye.WILL_RECONNECT,(e,n,r)=>{r(e)}),this.workerManagerConnection.on(Ye.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Ye.CONNECTED,async()=>{this.emit(Vr.STATE_CHANGE,Va.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=za.CONNECTED}),this.workerConnection.on(Ye.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const r=kLe(new Uint8Array(e.data));if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&S.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Vr.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},s=qc(n=Object.keys(i)).call(n,(a,A)=>i[a]>i[A]?a:A,"porn"),o=Object.keys(i).find(a=>a===s);this.emit(Vr.INSPECT_RESULT,o)}else this.emit(Vr.INSPECT_RESULT,void 0,new te(L.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Vr.INSPECT_RESULT,void 0,new te(L.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else S.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Vr.INSPECT_RESULT,void 0,new te(L.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ye.CLOSED,()=>{this.connectionState=za.CLOSED}),this.workerConnection.on(Ye.FAILED,()=>{this.connectionState=za.CLOSED}),this.workerConnection.on(Ye.RECONNECTING,()=>{this.connectionState=this.connectionState===za.CONNECTED?za.RECONNECTING:za.CONNECTING}),this.workerConnection.on(Ye.WILL_RECONNECT,(e,n,r)=>{e==="recover"&&r(e),r("tryNext")}),this.workerConnection.on(Ye.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(Vr.REQUEST_NEW_WORKER_URL,r=>{e([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}async requestToInspectImage(){this.sequence++;const e=va(this,Vr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Vr.INSPECT_RESULT,void 0,new te(L.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(e,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Vr.INSPECT_RESULT,void 0,new te(L.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:r,cname:i,cid:s,vid:o,sid:a,uid:A}=n;const u=Date.now(),d=await e.getCurrentFrameImage("image/jpeg",this.quality),f=await lZ(d,r,i),m=this.sequence+"-"+s+"-"+A+"-"+u+"-"+tn(12,""),g={appId:r,cid:s,cname:i,deviceId:"",elapse:U8(Number(u-this.inspectStartTime)),fileSize:f.byteLength,jpgEncryption:2,height:d.height,width:d.width,jpg:f,networkType:6,osType:7,requestId:m,sdkVersion:"4.22.0",sequence:this.sequence,sid:a,timestamp:U8(u),uid:A,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete g.callbackData,this.ossFilePrefix===void 0&&delete g.ossFilePrefix;const v=PLe(g);if(v.byteLength<this.workerMessageLengthLimit){if(j("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const y=function(w){for(var b=1;b<arguments.length;b++){var I=arguments[b]!=null?arguments[b]:{};b%2?L8(Object(I),!0).forEach(function(B){N(w,B,I[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(I)):L8(Object(I)).forEach(function(B){Object.defineProperty(w,B,Object.getOwnPropertyDescriptor(I,B))})}return w}({},g);delete y.jpg,S.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(y))}return v}{const y=this.quality*this.qualityRatio;return this.quality=y,await this.generateRequestData(e,{appId:r,cname:i,cid:s,vid:o,sid:a,uid:A})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=js.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=za.CLOSED,this.emit(Vr.STATE_CHANGE,Va.CLOSED)}}const GLe={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new te(L.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new te(L.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach(i=>{var s;if(!Te(s=["supervise","moderation"]).call(s,i))throw new te(L.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new te(L.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new KLe(e)}};Ht("PROCESS_ID","process-".concat(tn(8,""),"-").concat(tn(4,""),"-").concat(tn(4,""),"-").concat(tn(4,""),"-").concat(tn(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void S.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();S.debug("Loading global parameters from cache",e),Object.keys(e).forEach(r=>{if(Object.prototype.hasOwnProperty.call(Zn,r)){const{value:i,expires:s}=e[r];if(s&&s<=n)return;rd[r]=i,Zn[r]=i}})}catch(e){S.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(rd.AREAS)&&rd.AREAS.length>0&&Fk(rd.AREAS,!0);const P8=(t,e,n)=>{S.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),Ht(t,e,n)};z_(DLe,!1),z_(ULe,!1),z_(hBe,!1),z_(GLe,!1),z_(RLe,!1);const Dn=function(t){const e=new Ln,n=t,r={getListeners:e.getListeners.bind(e),on:(i,s)=>(function(o,a){o===bA.SECURITY_POLICY_VIOLATION&&JZ(a,!0)}(i,s),e.on.bind(e)(i,s)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return c8(c8({},n),r)}({__TRACK_LIST__:Gp,VERSION:ya,BUILD:bk,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:P8,getParameter:j,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(r){let i;return Ct().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(e);if(!n)return t;e.close(),e=null,t=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(n)}catch(e){throw new te(L.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=Le.reportApiInvoke(null,{name:wr.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Mn.TRACER});let e=!1;try{const s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,a=window.WebSocket;e=!!(s&&o&&a),e&&yk()&&m$(75)&&new s().close()}catch(s){return S.error("check system requirement failed: ",s),!1}let n=!1;const r=yt();r.name===Ut.CHROME&&Number(r.version)>=58&&(Fc.engine.name!=="WebKit"||function(){const s=yt();if(aS()){if(s.os===kr.MAC_OS)return!0;if(s.os===kr.IOS){const o=Fc.os.version&&Fc.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1}())&&(n=!0),(r.name===Ut.FIREFOX&&Number(r.version)>=56||r.name===Ut.OPERA&&Number(r.version)>=45||r.name===Ut.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(Cs()||Ac())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||v$()||yt().name===Ut.QQ)&&(n=!0),S.debug("checkSystemRequirements, api:",e,"browser",n);const i=e&&n;return t.onSuccess(i),i},getDevices:function(t){return Go.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Go.getRecordingDevices(t)},getCameras:function(t){return Go.getCamerasDevices(t)},getElectronScreenSources:eZ,getPlaybackDevices:function(t){return Go.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Le.reportApiInvoke(null,{name:wr.CREATE_CLIENT,options:[e],tag:Mn.TRACER});try{(function(r){Rr(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Rr(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&Rr(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&zr(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&S$(r.turnServer),r.httpRetryConfig!==void 0&&b3(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&b3(r.websocketRetryConfig)})(e)}catch(r){throw n.onError(r),r}return(_$(16,0)||E$(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",S.debug("browser not support vp9, force use vp8")),Ht("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),n.onSuccess(),new fBe(Mc(Mc({forceWaitGatewayResponse:!0},e),{},{role:Te(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=j("CAMERA_CAPTURE_CONFIG"),n=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.CREATE_CAM_VIDEO_TRACK,options:[vn({},t),e]});e&&(t.encoderConfig=e);const r=uS(t),i=tn(8,"track-cam-");let s=null;S.info("start create camera video track with config",JSON.stringify(t),"trackId",i);try{s=(await Qo({video:r},i)).getVideoTracks()[0]||null}catch(a){throw n.onError(a),a}if(!s){const a=new ie(L.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(a),a.throw(S)}t.optimizationMode&&pD(i,s,t,BA(t.encoderConfig));const o=new aU(s,t,r,t.scalabiltyMode?NC(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return n.onSuccess(o.getTrackId()),S.info("create camera video success, trackId:",i),o},createCustomVideoTrack:function(t){const e=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),n=new dn(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?NC(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,tn(8,"track-cus-"),[gn.CUSTOM_TRACK]);return e.onSuccess(n.getTrackId()),S.info("create custom video track success with config",t,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.CREATE_SCREEN_VIDEO_TRACK,options:[vn({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const r=function(d){const f={};d.screenSourceType&&(f.mediaSource=d.screenSourceType),d.extensionId&&gd()&&(f.extensionId=d.extensionId);const{displaySurface:m,selfBrowserSurface:g,surfaceSwitching:v,systemAudio:y}=d;(GL(107)||v3(107)||y3(93))&&(m&&(Rr(m,"displaySurface",["browser","window","monitor"]),f.displaySurface=m),g?(Rr(g,"selfBrowserSurface",["exclude","include"]),f.selfBrowserSurface=g):f.selfBrowserSurface="include",v&&(Rr(v,"surfaceSwitching",["exclude","include"]),f.surfaceSwitching=v)),(GL(105)||v3(105)||y3(91))&&y&&(Rr(y,"systemAudio",["exclude","include"]),f.systemAudio=y),d.electronScreenSourceId&&(f.sourceId=d.electronScreenSourceId);const w=d.encoderConfig?uD(d.encoderConfig):null;return f.mandatory={chromeMediaSource:"desktop",maxWidth:w?w.width:void 0,maxHeight:w?w.height:void 0},w&&(w.frameRate&&(typeof w.frameRate=="number"?(f.mandatory.maxFrameRate=w.frameRate,f.mandatory.minFrameRate=w.frameRate):(f.mandatory.maxFrameRate=w.frameRate.max||w.frameRate.ideal||w.frameRate.exact||void 0,f.mandatory.minFrameRate=w.frameRate.min||w.frameRate.ideal||w.frameRate.exact||void 0),f.frameRate=w.frameRate),w.width&&(f.width=w.width),w.height&&(f.height=w.height)),f}(t),i=tn(8,"track-scr-v-");let s=null,o=null;const a=Ct();if(!a.supportShareAudio&&e==="enable"){const d=new ie(L.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(d),d.throw(S)}S.info("start create screen video track with config",t,"withAudio",e,"trackId",i);try{const d=await Qo({screen:r,screenAudio:e==="auto"?a.supportShareAudio:e==="enable"},i);s=d.getVideoTracks()[0]||null,o=d.getAudioTracks()[0]||null}catch(d){throw n.onError(d),d}if(!s){const d=new ie(L.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(d),d.throw(S)}if(!o&&e==="enable"){s&&s.stop();const d=new ie(L.SHARE_AUDIO_NOT_ALLOWED);return n.onError(d),d.throw(S)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(pD(i,s,t,t.encoderConfig&&uD(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const A=new dn(s,t.encoderConfig?uD(t.encoderConfig):{},t.scalabiltyMode?NC(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[gn.SCREEN_TRACK]);if(!o)return n.onSuccess(A.getTrackId()),S.info("create screen video track success","video:",A.getTrackId()),A;const u=new xn(o,void 0,tn(8,"track-scr-a-"),!1);return n.onSuccess([A.getTrackId(),u.getTrackId()]),S.info("create screen video track success","video:",A.getTrackId(),"audio:",u.getTrackId()),[A,u]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=j("CAMERA_CAPTURE_CONFIG"),r=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const i=uS(e),s=OK(t),o=tn(8,"track-mic-"),a=tn(8,"track-cam-");let A=null,u=null;S.info("start create camera video track(".concat(a,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const m=await Qo({audio:s,video:i},"".concat(o,"-").concat(a));A=m.getAudioTracks()[0],u=m.getVideoTracks()[0]}catch(m){throw r.onError(m),m}if(!A||!u){const m=new ie(L.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(m),m.throw(S)}e.optimizationMode&&pD(a,u,e,BA(e.encoderConfig));const d=new dS(A,t,s,o),f=new aU(u,e,i,e.scalabiltyMode?NC(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a);return r.onSuccess([d.getTrackId(),f.getTrackId()]),S.info("create camera video track(".concat(a,") and microphone audio track(").concat(o,") success")),[d,f]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.CREATE_MIC_AUDIO_TRACK,options:[t]}),n=OK(t),r=tn(8,"track-mic-");let i=null;S.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{i=(await Qo({audio:n},r)).getAudioTracks()[0]||null}catch(o){throw e.onError(o),o}if(!i){const o=new ie(L.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(o),o.throw(S)}const s=new dS(i,t,n,r);return e.onSuccess(s.getTrackId()),S.info("create microphone audio track success, trackId:",r),s},createCustomAudioTrack:function(t){const e=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),n=new xn(t.mediaStreamTrack,t.encoderConfig?lS(t.encoderConfig):{},tn(8,"track-cus-"),!1);return S.info("create custom audio track success with config",t,"trackId",n.getTrackId()),e.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:r}=t;let{source:i}=t;const s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":i,cacheOnlineFile:n,encoderConfig:r},o=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(j("DISABLE_WEBAUDIO"))throw new ie(L.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const a=tn(8,"track-buf-");S.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",a);const A=i;if(!(i instanceof AudioBuffer))try{i=await async function(f,m){let g=null;if(typeof f=="string"){const y=h5.get(f);if(y)return S.debug("use cached audio resource: ",f),y;try{g=(await Jc(()=>js.get(f,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(w){throw new ie(L.FETCH_AUDIO_FILE_FAILED,w.toString())}}else g=await new ye((w,b)=>{const I=new FileReader;I.onload=B=>{B.target?w(B.target.result):b(new ie(L.READ_LOCAL_AUDIO_FILE_ERROR))},I.onerror=()=>{b(new ie(L.READ_LOCAL_AUDIO_FILE_ERROR))},I.readAsArrayBuffer(f)});const v=await function(y){const w=Og();return new ye((b,I)=>{w.decodeAudioData(y,B=>{b(B)},B=>{I(new ie(L.DECODE_AUDIO_FILE_FAILED,B.toString()))})})}(g);return typeof f=="string"&&m&&h5.set(f,v),v}(i,n)}catch(f){return o.onError(f),f.throw(S)}const u=new lDe(i),d=new ADe(A,u,r?lS(r):{},a);return S.info("create buffer source audio track success, trackId:",a),o.onSuccess(d.getTrackId()),d},setAppType:function(t){if(S.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw S.debug("Invalid appType"),new te(L.INVALID_PARAMS,"invalid app type",t);Ht("APP_TYPE",Math.floor(t))},setLogLevel:function(t){S.setLogLevel(t)},enableLogUpload:function(){j("USE_NEW_LOG")?Ht("UPLOAD_LOG",!0):S.enableLogUpload()},disableLogUpload:function(){j("USE_NEW_LOG")?Ht("UPLOAD_LOG",!1):S.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new xZ},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof xn||t instanceof Cm)){const A=new te(L.INVALID_TRACK,"the parameter is not a audio track");return n.onError(A),A.throw()}e&&e<1e3&&(e=1e3);const r=t instanceof xn?t.getTrackLabel():"remote_track",i=t.getVolumeLevel();let s=i,o=i;const a=Date.now();return new ye(A=>{const u=setInterval(()=>{const d=t.getVolumeLevel();s=d>s?d:s,o=d<o?d:o;const f=s-o>1e-4,m=Date.now()-a;if(f||m>e){clearInterval(u);const g=f,v={duration:m,deviceLabel:r,maxVolumeLevel:s,result:g};S.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(v))),n.onSuccess(v),A(g)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=Le.reportApiInvoke(null,{tag:Mn.TRACER,name:wr.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof dn||t instanceof wm)){const f=new te(L.INVALID_TRACK,"the parameter is not a video track");return n.onError(f),f.throw()}e&&e<1e3&&(e=1e3);const r=t instanceof dn?t.getTrackLabel():"remote_track",i=t.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(hi()||aS())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let a=0,A=0;try{const f=Date.now();a=await function(m,g,v,y){let w,b=0,I=null;return new ye((B,M)=>{function H(){b>y&&w&&(w(),B(b));const K=v.getContext("2d");if(!K){const k=new te(L.UNEXPECTED_ERROR,"can not get canvas 2d context.");return S.error(k.toString()),void M(k)}K.drawImage(m,0,0,160,120);const Q=K.getImageData(0,0,v.width,v.height),F=Math.floor(Q.data.length/3);if(I){for(let k=0;k<F;k+=3)if(Q.data[k]!==I[k])return b+=1,void(I=Q.data);I=Q.data}else I=Q.data}setTimeout(()=>{w&&(w(),B(b))},g),w=Lk(()=>{H()},30)})}(s,e,o,4),A=Date.now()-f}catch(f){throw n.onError(f),f}$De===Ut.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const u=a>4,d={duration:A,changedPicNum:a,deviceLabel:r,result:u};return S.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(d))),n.onSuccess(d),u},setArea:Fk,audioElementPlayCenter:Ms,resumeAudioContext:function(){Ms.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){mBe.processExternalMediaAEC(t)},registerExtensions:function(t){const e=j("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!Te(e).call(e,n.name)&&e.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=S.extLog,r.reporter.hookApiInvoke=Le.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=j(i)})}),P8("PLUGIN_INFO",e)},ChannelMediaRelayError:Kp,ChannelMediaRelayEvent:bl,ChannelMediaRelayState:Xs,RemoteStreamFallbackType:nDe,RemoteStreamType:tDe,ConnectionDisconnectedReason:Mt,AudienceLatencyLevelType:PRe,AREAS:Ot,preload:async function(t,e,n,r){return jZ(t,e,n,r)}});Object.defineProperties(Dn,{onAudioAutoplayFailed:{get:()=>xo.onAudioAutoplayFailed,set:t=>{xo.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>xo.onAutoplayFailed,set:t=>{xo.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Dn._onSecurityPolicyViolation,set(t){Dn._onSecurityPolicyViolation=t,JZ(t)}},__CLIENT_LIST__:{get:()=>j("SHOW_GLOBAL_CLIENT_LIST")?Yu:[]}}),Go.on(jh.CAMERA_DEVICE_CHANGED,t=>{S.info("camera device changed",JSON.stringify(t)),Dn.onCameraChanged&&Dn.onCameraChanged(t),Dn.safeEmit(bA.CAMERA_CHANGED,t)}),Go.on(jh.RECORDING_DEVICE_CHANGED,t=>{S.info("microphone device changed",JSON.stringify(t)),Dn.onMicrophoneChanged&&Dn.onMicrophoneChanged(t),Dn.safeEmit(bA.MICROPHONE_CHANGED,t)}),Go.on(jh.PLAYOUT_DEVICE_CHANGED,t=>{S.debug("playout device changed",JSON.stringify(t)),Dn.onPlaybackDeviceChanged&&Dn.onPlaybackDeviceChanged(t),Dn.safeEmit(bA.PLAYBACK_DEVICE_CHANGED,t)}),Ms.onAutoplayFailed=()=>{S.info("detect audio element autoplay failed"),xo.onAudioAutoplayFailed&&xo.onAudioAutoplayFailed()},Vt.on("autoplay-failed",()=>{S.info("detect webaudio autoplay failed"),xo.onAudioAutoplayFailed&&xo.onAudioAutoplayFailed(),Dn.safeEmit(bA.AUTOPLAY_FAILED)}),Vt.on(Xr.STATE_CHANGE,(t,e)=>{S.info("audio context state changed: ".concat(e," => ").concat(t)),Dn.onAudioContextStateChanged&&Dn.onAudioContextStateChanged(t,e),Dn.safeEmit(bA.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),ar.on(nm.NETWORK_STATE_CHANGE,(t,e)=>{S.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=Dn);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WLe=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),zLe=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,r)=>r?r.toUpperCase():n.toLowerCase()),k8=t=>{const e=zLe(t);return e.charAt(0).toUpperCase()+e.slice(1)},See=(...t)=>t.filter((e,n,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===n).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var qLe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YLe=X.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:s,iconNode:o,...a},A)=>X.createElement("svg",{ref:A,...qLe,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:See("lucide",i),...a},[...o.map(([u,d])=>X.createElement(u,d)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qn=(t,e)=>{const n=X.forwardRef(({className:r,...i},s)=>X.createElement(YLe,{ref:s,iconNode:e,className:See(`lucide-${WLe(k8(t))}`,`lucide-${t}`,r),...i}));return n.displayName=k8(t),n};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XLe=[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],bee=Qn("camera",XLe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JLe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],$Le=Qn("check",JLe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZLe=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],x8=Qn("circle-check-big",ZLe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eUe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],M8=Qn("circle-stop",eUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tUe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],nUe=Qn("circle",tUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rUe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],Iee=Qn("clock",rUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iUe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],F8=Qn("copy",iUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sUe=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],oUe=Qn("crown",sUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aUe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],cUe=Qn("grid-3x3",aUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AUe=[["path",{d:"M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2",key:"1fvzgz"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2",key:"1kc0my"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8",key:"10h0bg"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]],lUe=Qn("hand",AUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uUe=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],dUe=Qn("loader-circle",uUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hUe=[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]],fUe=Qn("maximize-2",hUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pUe=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]],Ree=Qn("message-square",pUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mUe=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],Oee=Qn("mic-off",mUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gUe=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],Nee=Qn("mic",gUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _Ue=[["rect",{x:"5",y:"2",width:"14",height:"20",rx:"7",key:"11ol66"}],["path",{d:"M12 6v4",key:"16clxf"}]],EUe=Qn("mouse",_Ue);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vUe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]],yUe=Qn("panels-top-left",vUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wUe=[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]],CUe=Qn("phone",wUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TUe=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],SUe=Qn("refresh-cw",TUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bUe=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],vU=Qn("share-2",bUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IUe=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],RUe=Qn("shield",IUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OUe=[["path",{d:"m10 20-1.25-2.5L6 18",key:"18frcb"}],["path",{d:"M10 4 8.75 6.5 6 6",key:"7mghy3"}],["path",{d:"m14 20 1.25-2.5L18 18",key:"1chtki"}],["path",{d:"m14 4 1.25 2.5L18 6",key:"1b4wsy"}],["path",{d:"m17 21-3-6h-4",key:"15hhxa"}],["path",{d:"m17 3-3 6 1.5 3",key:"11697g"}],["path",{d:"M2 12h6.5L10 9",key:"kv9z4n"}],["path",{d:"m20 10-1.5 2 1.5 2",key:"1swlpi"}],["path",{d:"M22 12h-6.5L14 15",key:"1mxi28"}],["path",{d:"m4 10 1.5 2L4 14",key:"k9enpj"}],["path",{d:"m7 21 3-6-1.5-3",key:"j8hb9u"}],["path",{d:"m7 3 3 6h4",key:"1otusx"}]],NUe=Qn("snowflake",OUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DUe=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],zD=Qn("square-pen",DUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BUe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],V8=Qn("user-check",BUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LUe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],UUe=Qn("user-plus",LUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PUe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],yU=Qn("user-x",PUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kUe=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],qE=Qn("users",kUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xUe=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Dee=Qn("video-off",xUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MUe=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],Bee=Qn("video",MUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FUe=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Hv=Qn("x",FUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VUe=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],Lee=Qn("zoom-in",VUe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QUe=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],HUe=Qn("zoom-out",QUe),jUe=({callId:t,database:e,clientRef:n,localAudioTrackRef:r,remoteVideoContainerRef:i,channelRef:s,recordingRef:o,screenShareRef:a,isMuted:A,setIsMuted:u,stopVideoState:d,setStopVideoState:f,isVideoFrozen:m,setIsVideoFrozen:g,setFreezeOverlayVisible:v,frozenFrame:y,setFrozenFrame:w,isScreenSharing:b,setIsScreenSharing:I,isRecording:B,setIsRecording:M,toggleChat:H,endCall:K,setARHandActive:Q,isARHandActive:F,cursorActive:k,setCursorActive:G})=>{const $=X.useCallback(()=>{r.current&&(r.current.setEnabled(!A),u(!A))},[r,A,u]),ne=X.useCallback(()=>{f(d==="stop"?"start":"stop")},[d,f]),q=X.useCallback(async()=>{var Z;try{const P=!m;if(g(P),v(P),P){const C=document.createElement("canvas"),D=(Z=i.current)==null?void 0:Z.querySelector("video");if(D){C.width=D.videoWidth,C.height=D.videoHeight,C.getContext("2d").drawImage(D,0,0);const ee=C.toDataURL();if(w(ee),t){const Ee=Ke(e,`videoCalls/${t}`);await vr(Ee,{freeze:"on",frozenFrame:ee,lastUpdated:new Date().toISOString()}),console.log("Freeze state updated to ON")}}}else if(w(null),t){const C=Ke(e,`videoCalls/${t}`);await vr(C,{freeze:"off",lastUpdated:new Date().toISOString()}),console.log("Freeze state updated to OFF")}}catch(P){console.error("Error toggling freeze:",P),g(!m),v(!m)}},[t,e,m,g,v,w,i]),qe=X.useCallback(async Z=>{var P;if(t)try{const C=Ke(e,`videoCalls/${t}`),U=((P=(await Ni(C)).val())==null?void 0:P.zoomLevel)||1;let ee=Z==="zoomin"?U+.1:U-.1;ee=Math.max(.5,Math.min(ee,2)),await vr(C,{zoomLevel:ee,lastUpdated:new Date().toISOString()})}catch(C){console.error("Error updating zoom level:",C)}},[t,e]),je=async()=>{var Z,P;try{b?await((P=a.current)==null?void 0:P.stopScreenShare()):await((Z=a.current)==null?void 0:Z.startScreenShare())}catch(C){console.error("Error toggling screen share:",C)}},de=async()=>{try{if(B)o.current&&(await o.current.stop(),o.current=null),M(!1);else{const Z=i.current.captureStream();o.current=new MediaRecorder(Z,{mimeType:"video/webm;codecs=vp9"});const P=[];o.current.ondataavailable=C=>P.push(C.data),o.current.onstop=()=>{const C=new Blob(P,{type:"video/webm"}),D=URL.createObjectURL(C),U=document.createElement("a");U.href=D,U.download=`video-call-recording-${new Date().toISOString()}.webm`,U.click(),URL.revokeObjectURL(D)},o.current.start(),M(!0)}}catch(Z){console.error("Error toggling recording:",Z)}},J=X.useCallback(()=>{if(!i.current)return;const Z=i.current.querySelector("video");if(!Z)return;const P=document.createElement("canvas");P.width=Z.videoWidth,P.height=Z.videoHeight,P.getContext("2d").drawImage(Z,0,0);const D=P.toDataURL("image/jpeg"),U=document.createElement("a");U.href=D,U.download=`screenshot-${new Date().toISOString()}.jpg`,U.click()},[i]),Y=X.useCallback(async()=>{const Z=!F;try{if(Q(Z),t){const P=Ke(e,`videoCalls/${t}`);await vr(P,{arHandActive:Z,lastUpdated:new Date().toISOString()}),console.log("AR Hand state updated:",Z)}}catch(P){console.error("Error toggling AR Hand:",P),Q(!Z)}},[t,e,F,Q]);return X.useEffect(()=>{if(!t)return;const Z=Ke(e,`videoCalls/${t}`),P=mo(Z,C=>{if(C.exists()){const D=C.val();D.arHandActive!==void 0&&(Q(D.arHandActive),console.log("AR Hand state synced:",D.arHandActive))}});return()=>P()},[t,e,Q]),X.useEffect(()=>{if(!t)return;const Z=Ke(e,`videoCalls/${t}`),P=mo(Z,C=>{if(C.exists()){const D=C.val();if(D.freeze!==void 0){const U=D.freeze==="on";console.log("Freeze state changed:",U),g(U),v(U),D.frozenFrame&&U?w(D.frozenFrame):U||w(null)}}});return()=>P()},[t,e,g,v,w]),X.useEffect(()=>{if(!t||!i.current)return;const Z=Ke(e,`videoCalls/${t}`),P=mo(Z,C=>{var D;if(C.exists()){const U=C.val();if(U.zoomLevel!==void 0){const ee=(D=i.current)==null?void 0:D.querySelector("video");ee&&(ee.style.transform=`scale(${U.zoomLevel})`)}}});return()=>P()},[t,e,i]),R.jsx("div",{className:"fixed bottom-0 left-0 right-0 flex justify-center items-center p-4 bg-black bg-opacity-50 backdrop-blur-sm",children:R.jsxs("div",{className:"flex space-x-4",children:[R.jsx(Wa,{icon:R.jsxs("div",{className:"relative",children:[A?R.jsx(Oee,{className:"text-red-400"}):R.jsx(Nee,{}),A&&R.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"})]}),label:A?"Unmute":"Mute",onClick:$,className:`
            ${A?"bg-red-500 hover:bg-red-600":"hover:bg-gray-700"}
            transition-all duration-300
            transform hover:scale-105
            active:scale-95
            shadow-lg
            ${A?"shadow-red-500/50":"shadow-gray-500/30"}
          `}),R.jsx(Wa,{icon:R.jsxs("div",{className:"relative",children:[d==="stop"?R.jsx(Bee,{className:"text-green-400"}):R.jsx(Dee,{className:"text-red-400"}),d!=="stop"&&R.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"})]}),label:d==="stop"?"Video On":"Video Off",onClick:ne,className:`
            ${d!=="stop"?"bg-red-500 hover:bg-red-600":"hover:bg-gray-700"}
            transition-all duration-300
            transform hover:scale-105
            active:scale-95
            shadow-lg
            ${d!=="stop"?"shadow-red-500/50":"shadow-gray-500/30"}
          `}),R.jsx(Wa,{icon:R.jsxs("div",{className:"relative",children:[R.jsx(NUe,{className:`transform transition-all duration-300 ${m?"rotate-180 scale-110 text-blue-400 animate-pulse":"rotate-0 scale-100 text-gray-400"}`}),m&&R.jsxs(R.Fragment,{children:[R.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),R.jsx("div",{className:"absolute inset-0 bg-blue-500/20 rounded-full animate-ping"})]})]}),label:m?"Unfreeze":"Freeze",onClick:q,className:`
            relative overflow-hidden
            ${m?"bg-blue-500 hover:bg-blue-600":"hover:bg-gray-700"}
            transition-all duration-300
            transform hover:scale-105
            active:scale-95
            shadow-lg
            ${m?"shadow-blue-500/50":"shadow-gray-500/30"}
            ${m?"ring-2 ring-blue-400 ring-opacity-50":""}
          `}),R.jsxs("div",{className:"flex space-x-2",children:[R.jsx(Wa,{icon:R.jsx(Lee,{className:"text-gray-400"}),label:"Zoom In",onClick:()=>qe("zoomin"),className:"hover:bg-gray-700 transition-all duration-300 transform hover:scale-105 active:scale-95"}),R.jsx(Wa,{icon:R.jsx(HUe,{className:"text-gray-400"}),label:"Zoom Out",onClick:()=>qe("zoomout"),className:"hover:bg-gray-700 transition-all duration-300 transform hover:scale-105 active:scale-95"})]}),R.jsx(Wa,{icon:R.jsxs("div",{className:"relative",children:[b?R.jsx(M8,{className:"text-blue-400"}):R.jsx(vU,{}),b&&R.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-blue-500 rounded-full animate-pulse"})]}),label:b?"Stop Sharing":"Share Screen",onClick:je,className:`
            ${b?"bg-blue-500 hover:bg-blue-600":"hover:bg-gray-700"}
            transition-all duration-300
            transform hover:scale-105
            active:scale-95
            shadow-lg
            ${b?"shadow-blue-500/50":"shadow-gray-500/30"}
          `}),R.jsx(Wa,{icon:R.jsx(Ree,{}),label:"Chat",onClick:H,className:"hover:bg-gray-700 transition-all duration-300 transform hover:scale-105 active:scale-95"}),R.jsx(Wa,{icon:R.jsx(bee,{}),label:"Photo",onClick:J,className:"hover:bg-gray-700 transition-all duration-300 transform hover:scale-105 active:scale-95"}),R.jsx(Wa,{icon:R.jsxs("div",{className:"relative",children:[B?R.jsx(M8,{className:"text-red-400"}):R.jsx(nUe,{className:"text-red-400"}),B&&R.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-pulse"})]}),label:B?"Stop Recording":"Start Recording",onClick:de,className:`
            ${B?"bg-red-500 hover:bg-red-600":"hover:bg-gray-700"}
            transition-all duration-300
            transform hover:scale-105
            active:scale-95
            shadow-lg
            ${B?"shadow-red-500/50":"shadow-gray-500/30"}
          `}),R.jsx(Wa,{icon:R.jsxs("div",{className:"relative",children:[R.jsx(EUe,{className:`${k?"text-blue-400":""}`}),k&&R.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-blue-500 rounded-full animate-pulse"})]}),label:k?"Disable Cursor":"Enable Cursor",onClick:()=>G(!k),className:`
            ${k?"bg-blue-500 hover:bg-blue-600":"hover:bg-gray-700"}
            transition-all duration-300
            transform hover:scale-105
            active:scale-95
            shadow-lg
            ${k?"shadow-blue-500/50":"shadow-gray-500/30"}
          `}),R.jsx(Wa,{icon:R.jsxs("div",{className:"relative",children:[R.jsx(lUe,{className:`transform transition-all duration-300 ${F?"rotate-12 scale-110 text-blue-400":"rotate-0 scale-100"}`}),F&&R.jsx("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-green-500 rounded-full animate-pulse"})]}),label:F?"Deactivate AR Hand":"Activate AR Hand",onClick:Y,className:`
            ${F?"bg-blue-500 hover:bg-blue-600":"hover:bg-gray-700"}
            transition-all duration-300
            transform hover:scale-105
            active:scale-95
            shadow-lg
            ${F?"shadow-blue-500/50":"shadow-gray-500/30"}
          `}),R.jsx(Wa,{icon:R.jsx(CUe,{className:"text-red-400"}),label:"End Call",onClick:K,className:"bg-red-500 hover:bg-red-600 transition-all duration-300 transform hover:scale-105 active:scale-95 shadow-lg shadow-red-500/50"})]})})},Wa=({icon:t,label:e,onClick:n,className:r=""})=>R.jsx("button",{onClick:n,className:`
      p-2 rounded-full 
      hover:bg-gray-700 
      transition-all duration-200
      ${r}
    `,title:e,children:t}),KUe=({callId:t,database:e,agoraEngine:n,remoteVideos:r,remoteVideoContainerRef:i,uidRef:s,annotations:o,setAnnotations:a,isVideoFrozen:A,frozenFrameRef:u,frozenFrame:d,isARHandActive:f,combinedCanvasRef:m,isRemoteVideoFrozen:g})=>{const[v,y]=X.useState(!1),[w,b]=X.useState(null),I=X.useRef(null),B=X.useRef(!1),M=X.useRef(0),H=X.useRef(0);X.useEffect(()=>{n&&n.on("stream-message",(Y,Z)=>{try{const P=JSON.parse(new TextDecoder().decode(Z));(P.type==="annotation"||P.type==="clear-annotations")&&J(P)}catch(P){console.error("Error handling stream message:",P)}})},[n]),X.useEffect(()=>{const Y=I.current;if(!Y)return;const Z=Re=>G(Re),P=Re=>$(Re),C=()=>ne(),D=()=>ne(),U=Re=>{Re.preventDefault(),G(Re)},ee=Re=>{Re.preventDefault(),$(Re)},Ee=()=>ne();return v&&(Y.addEventListener("mousedown",Z),Y.addEventListener("mousemove",P),Y.addEventListener("mouseup",C),Y.addEventListener("mouseout",D),Y.addEventListener("touchstart",U),Y.addEventListener("touchmove",ee),Y.addEventListener("touchend",Ee)),()=>{Y.removeEventListener("mousedown",Z),Y.removeEventListener("mousemove",P),Y.removeEventListener("mouseup",C),Y.removeEventListener("mouseout",D),Y.removeEventListener("touchstart",U),Y.removeEventListener("touchmove",ee),Y.removeEventListener("touchend",Ee)}},[v]),X.useEffect(()=>{const Y=()=>{setTimeout(()=>{v&&w&&(w==="frozen"?F():Q())},100)};return window.addEventListener("resize",Y),()=>window.removeEventListener("resize",Y)},[v,w]);const K=Y=>{v&&w===Y?(y(!1),b(null),k(),je()):(y(!0),b(Y),Y==="frozen"?F():Q())},Q=()=>{const Y=i.current,Z=I.current;if(!Y||!Z)return;const P=Y.getBoundingClientRect(),C=Math.round(P.width),D=Math.round(P.height);Z.width=C,Z.height=D,Z.style.position="absolute",Z.style.left="50%",Z.style.top="50%",Z.style.transform="translate(-50%, -50%)",Z.style.width=`${C}px`,Z.style.height=`${D}px`,Z.style.zIndex="30",Z.style.display="block",Z.style.pointerEvents="auto",Z.style.backgroundColor="transparent",Z.getContext("2d").clearRect(0,0,Z.width,Z.height)},F=()=>{const Y=u==null?void 0:u.current,Z=I.current;if(!Y||!Z)return;const P=Y.getBoundingClientRect(),C=Math.round(P.width),D=Math.round(P.height);Z.width=C,Z.height=D,Z.style.position="absolute",Z.style.left="0",Z.style.top="0",Z.style.width=`${C}px`,Z.style.height=`${D}px`,Z.style.zIndex="35",Z.style.display="block",Z.style.pointerEvents="auto",Z.style.backgroundColor="transparent",Z.getContext("2d").clearRect(0,0,Z.width,Z.height)},k=()=>{const Y=I.current;if(!Y)return;Y.getContext("2d").clearRect(0,0,Y.width,Y.height),Y.style.display="none"},G=Y=>{if(!v)return;B.current=!0;const{offsetX:Z,offsetY:P}=q(Y);M.current=Z,H.current=P},$=Y=>{if(!B.current||!v)return;const Z=I.current;if(!Z)return;const P=Z.getContext("2d"),{offsetX:C,offsetY:D}=q(Y);P.beginPath(),P.moveTo(M.current,H.current),P.lineTo(C,D),P.strokeStyle="#FF0000",P.lineWidth=3,P.stroke(),qe({fromX:M.current/Z.width,fromY:H.current/Z.height,toX:C/Z.width,toY:D/Z.height}),M.current=C,H.current=D},ne=()=>{B.current=!1},q=Y=>{const Z=I.current;if(!Z)return{offsetX:0,offsetY:0};if(Y.type.includes("touch")){const P=Z.getBoundingClientRect(),C=Y.touches[0]||Y.changedTouches[0];return{offsetX:C.clientX-P.left,offsetY:C.clientY-P.top}}else return{offsetX:Y.offsetX||0,offsetY:Y.offsetY||0}},qe=async Y=>{try{if(!w||!n)return;const Z=JSON.stringify({type:"annotation",targetUid:w==="ar"?s.current:w,sourceUid:s.current,points:Y}),C=new TextEncoder().encode(Z);await n.sendStreamMessage(C)}catch(Z){console.error("Error sending annotation data:",Z)}},je=async()=>{try{if(!n||!s.current)return;const Y=JSON.stringify({type:"clear-annotations",sourceUid:s.current}),P=new TextEncoder().encode(Y);await n.sendStreamMessage(P)}catch(Y){console.error("Error sending clear annotations message:",Y)}},de=Y=>{const Z=o[Y]||[];if(Z.length===0)return null;let P;if(Y==="ar"&&m&&m.current)P=m.current.getBoundingClientRect();else{const C=document.querySelector(".w-[790px].h-[480px]")||document.querySelector(".relative.w-[790px].h-[480px]");if(!C)return null;P=C.getBoundingClientRect()}return R.jsx("svg",{style:{position:"absolute",left:P.left,top:P.top,width:P.width,height:P.height,pointerEvents:"none",zIndex:20},children:Z.map((C,D)=>{const U=C.points||{},ee=U.fromX*P.width,Ee=U.fromY*P.height,Re=U.toX*P.width,lt=U.toY*P.height;return R.jsx("line",{x1:ee,y1:Ee,x2:Re,y2:lt,stroke:"red",strokeWidth:"3"},`anno-${Y}-${D}`)})})},J=Y=>{const{sourceUid:Z,points:P,type:C}=Y;if(C==="clear-annotations"){a(D=>{const U={...D};return delete U[Z],U});return}C==="annotation"&&(a(D=>{const U={id:Date.now(),points:P,timestamp:Date.now()},ee=Y.targetUid||Z;return{...D,[ee]:[...D[ee]||[],U]}}),setTimeout(()=>{a(D=>{const U=Y.targetUid||Z,ee=D[U]||[];if(ee.length===0)return D;const Ee=ee.slice(1);return{...D,[U]:Ee}})},3e3))};return R.jsxs(R.Fragment,{children:[!A&&R.jsxs(R.Fragment,{children:[R.jsx("canvas",{ref:I,className:"absolute z-30",style:{display:v?"block":"none"}}),Object.keys(r).map(Y=>R.jsxs("div",{className:"relative w-full h-full flex justify-center items-center",children:[R.jsx("div",{className:`absolute bottom-3 right-3 p-2 rounded-full ${v&&w===Y?"bg-red-600":"bg-blue-600"} z-40`,children:R.jsx(zD,{size:24,className:"cursor-pointer text-white",onClick:()=>K(Y)})}),R.jsx("div",{id:`player-${Y}`,className:"absolute inset-0 w-full h-full"}),de(Y)]},Y)),(f||o.ar&&o.ar.length>0)&&R.jsxs("div",{className:"relative w-full h-full flex justify-center items-center",children:[R.jsx("div",{className:`absolute bottom-3 right-3 p-2 rounded-full ${v&&w==="ar"?"bg-red-600":"bg-blue-600"} z-40`,children:R.jsx(zD,{size:24,className:"cursor-pointer text-white",onClick:()=>K("ar"),title:"Annotate on AR Feed"})}),R.jsx("canvas",{ref:I,className:"absolute z-30",style:{display:v&&w==="ar"?"block":"none"}}),de("ar")]})]}),A&&(d||f)&&R.jsxs("div",{className:"absolute inset-0 z-20 pointer-events-none flex items-center justify-center",style:{userSelect:"none",touchAction:"none"},ref:f?null:u,children:[f&&u&&R.jsx("canvas",{ref:I,className:"absolute",style:{display:v&&w==="frozen"?"block":"none",pointerEvents:v&&w==="frozen"?"auto":"none",zIndex:35}}),!f&&d&&R.jsxs(R.Fragment,{children:[R.jsx("img",{src:typeof d=="string"?d:"",alt:"Frozen Frame",style:{width:"100%",height:"100%",objectFit:"cover",position:"absolute",top:0,left:0,pointerEvents:"none",zIndex:30},draggable:!1}),R.jsx("canvas",{ref:I,className:"absolute",style:{display:v&&w==="frozen"?"block":"none",pointerEvents:v&&w==="frozen"?"auto":"none",zIndex:35}})]}),R.jsx("div",{className:`absolute bottom-3 right-3 p-2 rounded-full ${v&&w==="frozen"?"bg-red-600":"bg-blue-600"} cursor-pointer shadow-lg`,style:{pointerEvents:"auto",zIndex:40},onClick:Y=>{Y.stopPropagation(),K("frozen")},title:"Toggle Annotation on Frozen Frame",children:R.jsx(zD,{size:24,className:"text-white"})})]}),v&&R.jsxs("div",{className:"absolute top-20 left-1/2 transform -translate-x-1/2 bg-red-600 text-white px-4 py-2 rounded-md shadow-lg z-50",children:["Annotation Mode: Drawing on ",w?`User ${w}`:"Remote Video"]})]})},GUe=({waitingUsers:t,admitUser:e,denyUser:n,admitAll:r,denyAll:i})=>!t||t.length===0?R.jsxs("div",{className:"p-4 text-center bg-gray-800 rounded-lg shadow-lg border border-gray-700",children:[R.jsx(qE,{className:"mx-auto text-gray-400 mb-2",size:24}),R.jsx("p",{className:"text-gray-400",children:"No users waiting to join"})]}):R.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg border border-gray-700 overflow-hidden",children:[R.jsxs("div",{className:"bg-gray-700 px-4 py-3 flex justify-between items-center",children:[R.jsxs("div",{className:"flex items-center",children:[R.jsx(qE,{className:"text-blue-400 mr-2",size:20}),R.jsx("h3",{className:"font-semibold text-white",children:"Waiting Room"}),R.jsx("span",{className:"ml-2 bg-blue-600 text-white text-xs px-2 py-1 rounded-full",children:t.length})]}),R.jsxs("div",{className:"flex space-x-2",children:[R.jsxs("button",{onClick:r,className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-md text-sm flex items-center",children:[R.jsx(V8,{size:16,className:"mr-1"}),"Admit All"]}),R.jsxs("button",{onClick:i,className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-md text-sm flex items-center",children:[R.jsx(yU,{size:16,className:"mr-1"}),"Deny All"]})]})]}),R.jsx("div",{className:"max-h-60 overflow-y-auto",children:t.map(s=>R.jsxs("div",{className:"border-b border-gray-700 px-4 py-3 flex justify-between items-center",children:[R.jsx("div",{children:R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold mr-3",children:(s.name||s.id).charAt(0).toUpperCase()}),R.jsxs("div",{children:[R.jsx("p",{className:"font-medium text-white",children:s.name||`User ${s.id.substring(0,6)}`}),R.jsxs("div",{className:"flex items-center text-xs text-gray-400",children:[R.jsx(Iee,{size:12,className:"mr-1"}),R.jsxs("span",{children:["Waiting for ",Math.floor((Date.now()-s.joinTime)/6e4)," min"]})]})]})]})}),R.jsxs("div",{className:"flex space-x-2",children:[R.jsx("button",{onClick:()=>e(s.id),className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded-full","aria-label":"Admit user",children:R.jsx(V8,{size:16})}),R.jsx("button",{onClick:()=>n(s.id),className:"bg-red-600 hover:bg-red-700 text-white p-2 rounded-full","aria-label":"Deny user",children:R.jsx(yU,{size:16})})]})]},s.id))})]}),WUe=({participants:t,localUser:e,userRole:n,onToggleMute:r,onToggleVideo:i,onToggleSpotlight:s,onTogglePin:o,onPromoteUser:a,onDemoteUser:A,onRemoveUser:u,onSendDirectMessage:d,raisedHands:f=[],onLowerHand:m,onClose:g})=>{const v=n==="host",[y,w]=X.useState({});X.useEffect(()=>{const M=async()=>{const H={};await Promise.all(Object.keys(t).map(async K=>{if(!y[K])try{const Q=Ke(et,`users/${K}`),F=await Ni(Q);if(F.exists()){const k=F.val();H[K]=k.name||k.displayName||k.email||K}else H[K]=K}catch{H[K]=K}})),w(K=>({...K,...H}))};t&&Object.keys(t).length>0&&M()},[t]);const b=Object.values(t).filter(M=>M.role==="host"),I=Object.values(t).filter(M=>M.role==="participant"),B=Object.values(t).filter(M=>M.role==="observer");return R.jsxs("div",{className:"fixed right-0 top-[60px] bottom-[76px] w-80 bg-gray-800 shadow-xl z-50 flex flex-col",children:[R.jsxs("div",{className:"flex justify-between items-center p-4 bg-gray-700 border-b border-gray-600",children:[R.jsxs("h3",{className:"text-white font-semibold",children:["Participants (",Object.keys(t).length+1,")"]}),R.jsx("button",{onClick:g,className:"text-gray-300 hover:text-white transition-colors",children:R.jsx(Hv,{size:20})})]}),R.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[b.length>0&&R.jsxs("div",{className:"space-y-2",children:[R.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wider",children:"Host"}),b.map(M=>R.jsx(qD,{participant:M,isLocalUser:M.id===(e==null?void 0:e.id),isHost:!0,onToggleMute:r,onToggleVideo:i,onSendDirectMessage:d},M.id))]}),I.length>0&&R.jsxs("div",{className:"space-y-2",children:[R.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wider",children:"Participants"}),I.map(M=>R.jsx(qD,{participant:M,isLocalUser:M.id===(e==null?void 0:e.id),isHost:v,onToggleMute:r,onToggleVideo:i,onSendDirectMessage:d,onPromoteUser:a,onDemoteUser:A,onRemoveUser:u},M.id))]}),B.length>0&&R.jsxs("div",{className:"space-y-2",children:[R.jsx("div",{className:"text-xs text-gray-400 uppercase tracking-wider",children:"Observers"}),B.map(M=>R.jsx(qD,{participant:M,isLocalUser:M.id===(e==null?void 0:e.id),isHost:v,onToggleMute:r,onToggleVideo:i,onSendDirectMessage:d,onPromoteUser:a,onDemoteUser:A,onRemoveUser:u},M.id))]})]})]})},qD=({participant:t,isLocalUser:e,isHost:n,onToggleMute:r,onToggleVideo:i,onSendDirectMessage:s,onPromoteUser:o,onDemoteUser:a,onRemoveUser:A})=>{const u=(t==null?void 0:t.licenseId)||(t==null?void 0:t.id)||"Unknown",d=u.charAt(0).toUpperCase();return R.jsxs("div",{className:"flex items-center p-2 bg-gray-700 rounded mx-1 hover:bg-gray-600 transition-colors",children:[R.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 bg-blue-500 rounded-full flex items-center justify-center mr-2 flex-shrink-0",children:d}),R.jsxs("div",{className:"flex-1 min-w-0",children:[R.jsxs("div",{className:"font-bold text-sm sm:text-base truncate",children:[u,e&&" (You)"]}),R.jsxs("div",{className:"text-xs sm:text-sm text-gray-400 flex items-center",children:[R.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 mr-1"}),R.jsx("span",{children:"Online"})]})]}),R.jsxs("div",{className:"flex space-x-1 sm:space-x-2 ml-1",children:[R.jsxs("div",{className:"flex items-center space-x-1",children:[t!=null&&t.isMuted?R.jsx(Oee,{size:16,className:"text-red-500"}):R.jsx(Nee,{size:16,className:"text-green-500"}),t!=null&&t.hasVideo?R.jsx(Bee,{size:16,className:"text-green-500"}):R.jsx(Dee,{size:16,className:"text-red-500"})]}),R.jsx("button",{onClick:()=>s(t==null?void 0:t.id),className:"text-white p-1",title:"Send message",children:R.jsx(Ree,{size:16})}),n&&!e&&R.jsxs("div",{className:"flex items-center space-x-1",children:[R.jsx("button",{onClick:()=>o(t==null?void 0:t.id),className:"text-white p-1",title:"Promote to host",children:R.jsx(oUe,{size:16})}),R.jsx("button",{onClick:()=>A(t==null?void 0:t.id),className:"text-white p-1 hover:text-red-500",title:"Remove participant",children:R.jsx(Hv,{size:16})})]})]})]})};/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var wU=function(t,e){return wU=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},wU(t,e)};function Zc(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");wU(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var CU=function(){return CU=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},CU.apply(this,arguments)};function po(t,e,n,r){function i(s){return s instanceof n?s:new n(function(o){o(s)})}return new(n||(n=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(f){o(f)}}function A(d){try{u(r.throw(d))}catch(f){o(f)}}function u(d){d.done?s(d.value):i(d.value).then(a,A)}u((r=r.apply(t,[])).next())})}function Js(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(d){return A([u,d])}}function A(u){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,i=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(s=n.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){n.label=u[1];break}if(u[0]===6&&n.label<s[1]){n.label=s[1],s=u;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(u);break}s[2]&&n.ops.pop(),n.trys.pop();continue}u=e.call(t,n)}catch(d){u=[6,d],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function YC(t,e,n){if(arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||e)}var $l=function(){function t(e,n,r,i){this.left=e,this.top=n,this.width=r,this.height=i}return t.prototype.add=function(e,n,r,i){return new t(this.left+e,this.top+n,this.width+r,this.height+i)},t.fromClientRect=function(e,n){return new t(n.left+e.windowBounds.left,n.top+e.windowBounds.top,n.width,n.height)},t.fromDOMRectList=function(e,n){var r=Array.from(n).find(function(i){return i.width!==0});return r?new t(r.left+e.windowBounds.left,r.top+e.windowBounds.top,r.width,r.height):t.EMPTY},t.EMPTY=new t(0,0,0,0),t}(),Wb=function(t,e){return $l.fromClientRect(t,e.getBoundingClientRect())},zUe=function(t){var e=t.body,n=t.documentElement;if(!e||!n)throw new Error("Unable to get document size");var r=Math.max(Math.max(e.scrollWidth,n.scrollWidth),Math.max(e.offsetWidth,n.offsetWidth),Math.max(e.clientWidth,n.clientWidth)),i=Math.max(Math.max(e.scrollHeight,n.scrollHeight),Math.max(e.offsetHeight,n.offsetHeight),Math.max(e.clientHeight,n.clientHeight));return new $l(0,0,r,i)},zb=function(t){for(var e=[],n=0,r=t.length;n<r;){var i=t.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var s=t.charCodeAt(n++);(s&64512)===56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),n--)}else e.push(i)}return e},Bi=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var n=t.length;if(!n)return"";for(var r=[],i=-1,s="";++i<n;){var o=t[i];o<=65535?r.push(o):(o-=65536,r.push((o>>10)+55296,o%1024+56320)),(i+1===n||r.length>16384)&&(s+=String.fromCharCode.apply(String,r),r.length=0)}return s},Q8="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",qUe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var XC=0;XC<Q8.length;XC++)qUe[Q8.charCodeAt(XC)]=XC;var H8="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",mE=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var JC=0;JC<H8.length;JC++)mE[H8.charCodeAt(JC)]=JC;var YUe=function(t){var e=t.length*.75,n=t.length,r,i=0,s,o,a,A;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);var u=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),d=Array.isArray(u)?u:new Uint8Array(u);for(r=0;r<n;r+=4)s=mE[t.charCodeAt(r)],o=mE[t.charCodeAt(r+1)],a=mE[t.charCodeAt(r+2)],A=mE[t.charCodeAt(r+3)],d[i++]=s<<2|o>>4,d[i++]=(o&15)<<4|a>>2,d[i++]=(a&3)<<6|A&63;return u},XUe=function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n.push(t[r+1]<<8|t[r]);return n},JUe=function(t){for(var e=t.length,n=[],r=0;r<e;r+=4)n.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return n},rf=5,Jk=11,YD=2,$Ue=Jk-rf,Uee=65536>>rf,ZUe=1<<rf,XD=ZUe-1,e1e=1024>>rf,t1e=Uee+e1e,n1e=t1e,r1e=32,i1e=n1e+r1e,s1e=65536>>Jk,o1e=1<<$Ue,a1e=o1e-1,j8=function(t,e,n){return t.slice?t.slice(e,n):new Uint16Array(Array.prototype.slice.call(t,e,n))},c1e=function(t,e,n){return t.slice?t.slice(e,n):new Uint32Array(Array.prototype.slice.call(t,e,n))},A1e=function(t,e){var n=YUe(t),r=Array.isArray(n)?JUe(n):new Uint32Array(n),i=Array.isArray(n)?XUe(n):new Uint16Array(n),s=24,o=j8(i,s/2,r[4]/2),a=r[5]===2?j8(i,(s+r[4])/2):c1e(r,Math.ceil((s+r[4])/4));return new l1e(r[0],r[1],r[2],r[3],o,a)},l1e=function(){function t(e,n,r,i,s,o){this.initialValue=e,this.errorValue=n,this.highStart=r,this.highValueIndex=i,this.index=s,this.data=o}return t.prototype.get=function(e){var n;if(e>=0){if(e<55296||e>56319&&e<=65535)return n=this.index[e>>rf],n=(n<<YD)+(e&XD),this.data[n];if(e<=65535)return n=this.index[Uee+(e-55296>>rf)],n=(n<<YD)+(e&XD),this.data[n];if(e<this.highStart)return n=i1e-s1e+(e>>Jk),n=this.index[n],n+=e>>rf&a1e,n=this.index[n],n=(n<<YD)+(e&XD),this.data[n];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),K8="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u1e=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var $C=0;$C<K8.length;$C++)u1e[K8.charCodeAt($C)]=$C;var d1e="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",G8=50,h1e=1,Pee=2,kee=3,f1e=4,p1e=5,W8=7,xee=8,z8=9,ad=10,TU=11,q8=12,SU=13,m1e=14,gE=15,bU=16,ZC=17,X_=18,g1e=19,Y8=20,IU=21,J_=22,JD=23,Np=24,fa=25,_E=26,EE=27,Dp=28,_1e=29,kh=30,E1e=31,eT=32,tT=33,RU=34,OU=35,NU=36,jv=37,DU=38,s0=39,o0=40,$D=41,Mee=42,v1e=43,y1e=[9001,65288],Fee="!",pn="",nT="",BU=A1e(d1e),Cl=[kh,NU],LU=[h1e,Pee,kee,p1e],Vee=[ad,xee],X8=[EE,_E],w1e=LU.concat(Vee),J8=[DU,s0,o0,RU,OU],C1e=[gE,SU],T1e=function(t,e){e===void 0&&(e="strict");var n=[],r=[],i=[];return t.forEach(function(s,o){var a=BU.get(s);if(a>G8?(i.push(!0),a-=G8):i.push(!1),["normal","auto","loose"].indexOf(e)!==-1&&[8208,8211,12316,12448].indexOf(s)!==-1)return r.push(o),n.push(bU);if(a===f1e||a===TU){if(o===0)return r.push(o),n.push(kh);var A=n[o-1];return w1e.indexOf(A)===-1?(r.push(r[o-1]),n.push(A)):(r.push(o),n.push(kh))}if(r.push(o),a===E1e)return n.push(e==="strict"?IU:jv);if(a===Mee||a===_1e)return n.push(kh);if(a===v1e)return s>=131072&&s<=196605||s>=196608&&s<=262141?n.push(jv):n.push(kh);n.push(a)}),[r,n,i]},ZD=function(t,e,n,r){var i=r[n];if(Array.isArray(t)?t.indexOf(i)!==-1:t===i)for(var s=n;s<=r.length;){s++;var o=r[s];if(o===e)return!0;if(o!==ad)break}if(i===ad)for(var s=n;s>0;){s--;var a=r[s];if(Array.isArray(t)?t.indexOf(a)!==-1:t===a)for(var A=n;A<=r.length;){A++;var o=r[A];if(o===e)return!0;if(o!==ad)break}if(a!==ad)break}return!1},$8=function(t,e){for(var n=t;n>=0;){var r=e[n];if(r===ad)n--;else return r}return 0},S1e=function(t,e,n,r,i){if(n[r]===0)return pn;var s=r-1;if(Array.isArray(i)&&i[s]===!0)return pn;var o=s-1,a=s+1,A=e[s],u=o>=0?e[o]:0,d=e[a];if(A===Pee&&d===kee)return pn;if(LU.indexOf(A)!==-1)return Fee;if(LU.indexOf(d)!==-1||Vee.indexOf(d)!==-1)return pn;if($8(s,e)===xee)return nT;if(BU.get(t[s])===TU||(A===eT||A===tT)&&BU.get(t[a])===TU||A===W8||d===W8||A===z8||[ad,SU,gE].indexOf(A)===-1&&d===z8||[ZC,X_,g1e,Np,Dp].indexOf(d)!==-1||$8(s,e)===J_||ZD(JD,J_,s,e)||ZD([ZC,X_],IU,s,e)||ZD(q8,q8,s,e))return pn;if(A===ad)return nT;if(A===JD||d===JD)return pn;if(d===bU||A===bU)return nT;if([SU,gE,IU].indexOf(d)!==-1||A===m1e||u===NU&&C1e.indexOf(A)!==-1||A===Dp&&d===NU||d===Y8||Cl.indexOf(d)!==-1&&A===fa||Cl.indexOf(A)!==-1&&d===fa||A===EE&&[jv,eT,tT].indexOf(d)!==-1||[jv,eT,tT].indexOf(A)!==-1&&d===_E||Cl.indexOf(A)!==-1&&X8.indexOf(d)!==-1||X8.indexOf(A)!==-1&&Cl.indexOf(d)!==-1||[EE,_E].indexOf(A)!==-1&&(d===fa||[J_,gE].indexOf(d)!==-1&&e[a+1]===fa)||[J_,gE].indexOf(A)!==-1&&d===fa||A===fa&&[fa,Dp,Np].indexOf(d)!==-1)return pn;if([fa,Dp,Np,ZC,X_].indexOf(d)!==-1)for(var f=s;f>=0;){var m=e[f];if(m===fa)return pn;if([Dp,Np].indexOf(m)!==-1)f--;else break}if([EE,_E].indexOf(d)!==-1)for(var f=[ZC,X_].indexOf(A)!==-1?o:s;f>=0;){var m=e[f];if(m===fa)return pn;if([Dp,Np].indexOf(m)!==-1)f--;else break}if(DU===A&&[DU,s0,RU,OU].indexOf(d)!==-1||[s0,RU].indexOf(A)!==-1&&[s0,o0].indexOf(d)!==-1||[o0,OU].indexOf(A)!==-1&&d===o0||J8.indexOf(A)!==-1&&[Y8,_E].indexOf(d)!==-1||J8.indexOf(d)!==-1&&A===EE||Cl.indexOf(A)!==-1&&Cl.indexOf(d)!==-1||A===Np&&Cl.indexOf(d)!==-1||Cl.concat(fa).indexOf(A)!==-1&&d===J_&&y1e.indexOf(t[a])===-1||Cl.concat(fa).indexOf(d)!==-1&&A===X_)return pn;if(A===$D&&d===$D){for(var g=n[s],v=1;g>0&&(g--,e[g]===$D);)v++;if(v%2!==0)return pn}return A===eT&&d===tT?pn:nT},b1e=function(t,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var n=T1e(t,e.lineBreak),r=n[0],i=n[1],s=n[2];(e.wordBreak==="break-all"||e.wordBreak==="break-word")&&(i=i.map(function(a){return[fa,kh,Mee].indexOf(a)!==-1?jv:a}));var o=e.wordBreak==="keep-all"?s.map(function(a,A){return a&&t[A]>=19968&&t[A]<=40959}):void 0;return[r,i,o]},I1e=function(){function t(e,n,r,i){this.codePoints=e,this.required=n===Fee,this.start=r,this.end=i}return t.prototype.slice=function(){return Bi.apply(void 0,this.codePoints.slice(this.start,this.end))},t}(),R1e=function(t,e){var n=zb(t),r=b1e(n,e),i=r[0],s=r[1],o=r[2],a=n.length,A=0,u=0;return{next:function(){if(u>=a)return{done:!0,value:null};for(var d=pn;u<a&&(d=S1e(n,s,i,++u,o))===pn;);if(d!==pn||u===a){var f=new I1e(n,d,A,u);return A=u,{value:f,done:!1}}return{done:!0,value:null}}}},O1e=1,N1e=2,Iy=4,Z8=8,wS=10,eW=47,YE=92,D1e=9,B1e=32,rT=34,$_=61,L1e=35,U1e=36,P1e=37,iT=39,sT=40,Z_=41,k1e=95,Fo=45,x1e=33,M1e=60,F1e=62,V1e=64,Q1e=91,H1e=93,j1e=61,K1e=123,oT=63,G1e=125,tW=124,W1e=126,z1e=128,nW=65533,eB=42,zh=43,q1e=44,Y1e=58,X1e=59,Kv=46,J1e=0,$1e=8,Z1e=11,ePe=14,tPe=31,nPe=127,wA=-1,Qee=48,Hee=97,jee=101,rPe=102,iPe=117,sPe=122,Kee=65,Gee=69,Wee=70,oPe=85,aPe=90,eo=function(t){return t>=Qee&&t<=57},cPe=function(t){return t>=55296&&t<=57343},Bp=function(t){return eo(t)||t>=Kee&&t<=Wee||t>=Hee&&t<=rPe},APe=function(t){return t>=Hee&&t<=sPe},lPe=function(t){return t>=Kee&&t<=aPe},uPe=function(t){return APe(t)||lPe(t)},dPe=function(t){return t>=z1e},aT=function(t){return t===wS||t===D1e||t===B1e},CS=function(t){return uPe(t)||dPe(t)||t===k1e},rW=function(t){return CS(t)||eo(t)||t===Fo},hPe=function(t){return t>=J1e&&t<=$1e||t===Z1e||t>=ePe&&t<=tPe||t===nPe},ju=function(t,e){return t!==YE?!1:e!==wS},cT=function(t,e,n){return t===Fo?CS(e)||ju(e,n):CS(t)?!0:!!(t===YE&&ju(t,e))},tB=function(t,e,n){return t===zh||t===Fo?eo(e)?!0:e===Kv&&eo(n):eo(t===Kv?e:t)},fPe=function(t){var e=0,n=1;(t[e]===zh||t[e]===Fo)&&(t[e]===Fo&&(n=-1),e++);for(var r=[];eo(t[e]);)r.push(t[e++]);var i=r.length?parseInt(Bi.apply(void 0,r),10):0;t[e]===Kv&&e++;for(var s=[];eo(t[e]);)s.push(t[e++]);var o=s.length,a=o?parseInt(Bi.apply(void 0,s),10):0;(t[e]===Gee||t[e]===jee)&&e++;var A=1;(t[e]===zh||t[e]===Fo)&&(t[e]===Fo&&(A=-1),e++);for(var u=[];eo(t[e]);)u.push(t[e++]);var d=u.length?parseInt(Bi.apply(void 0,u),10):0;return n*(i+a*Math.pow(10,-o))*Math.pow(10,A*d)},pPe={type:2},mPe={type:3},gPe={type:4},_Pe={type:13},EPe={type:8},vPe={type:21},yPe={type:9},wPe={type:10},CPe={type:11},TPe={type:12},SPe={type:14},AT={type:23},bPe={type:1},IPe={type:25},RPe={type:24},OPe={type:26},NPe={type:27},DPe={type:28},BPe={type:29},LPe={type:31},UU={type:32},zee=function(){function t(){this._value=[]}return t.prototype.write=function(e){this._value=this._value.concat(zb(e))},t.prototype.read=function(){for(var e=[],n=this.consumeToken();n!==UU;)e.push(n),n=this.consumeToken();return e},t.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case rT:return this.consumeStringToken(rT);case L1e:var n=this.peekCodePoint(0),r=this.peekCodePoint(1),i=this.peekCodePoint(2);if(rW(n)||ju(r,i)){var s=cT(n,r,i)?N1e:O1e,o=this.consumeName();return{type:5,value:o,flags:s}}break;case U1e:if(this.peekCodePoint(0)===$_)return this.consumeCodePoint(),_Pe;break;case iT:return this.consumeStringToken(iT);case sT:return pPe;case Z_:return mPe;case eB:if(this.peekCodePoint(0)===$_)return this.consumeCodePoint(),SPe;break;case zh:if(tB(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case q1e:return gPe;case Fo:var a=e,A=this.peekCodePoint(0),u=this.peekCodePoint(1);if(tB(a,A,u))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(cT(a,A,u))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(A===Fo&&u===F1e)return this.consumeCodePoint(),this.consumeCodePoint(),RPe;break;case Kv:if(tB(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case eW:if(this.peekCodePoint(0)===eB)for(this.consumeCodePoint();;){var d=this.consumeCodePoint();if(d===eB&&(d=this.consumeCodePoint(),d===eW))return this.consumeToken();if(d===wA)return this.consumeToken()}break;case Y1e:return OPe;case X1e:return NPe;case M1e:if(this.peekCodePoint(0)===x1e&&this.peekCodePoint(1)===Fo&&this.peekCodePoint(2)===Fo)return this.consumeCodePoint(),this.consumeCodePoint(),IPe;break;case V1e:var f=this.peekCodePoint(0),m=this.peekCodePoint(1),g=this.peekCodePoint(2);if(cT(f,m,g)){var o=this.consumeName();return{type:7,value:o}}break;case Q1e:return DPe;case YE:if(ju(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case H1e:return BPe;case j1e:if(this.peekCodePoint(0)===$_)return this.consumeCodePoint(),EPe;break;case K1e:return CPe;case G1e:return TPe;case iPe:case oPe:var v=this.peekCodePoint(0),y=this.peekCodePoint(1);return v===zh&&(Bp(y)||y===oT)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case tW:if(this.peekCodePoint(0)===$_)return this.consumeCodePoint(),yPe;if(this.peekCodePoint(0)===tW)return this.consumeCodePoint(),vPe;break;case W1e:if(this.peekCodePoint(0)===$_)return this.consumeCodePoint(),wPe;break;case wA:return UU}return aT(e)?(this.consumeWhiteSpace(),LPe):eo(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):CS(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:Bi(e)}},t.prototype.consumeCodePoint=function(){var e=this._value.shift();return typeof e>"u"?-1:e},t.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},t.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},t.prototype.consumeUnicodeRangeToken=function(){for(var e=[],n=this.consumeCodePoint();Bp(n)&&e.length<6;)e.push(n),n=this.consumeCodePoint();for(var r=!1;n===oT&&e.length<6;)e.push(n),n=this.consumeCodePoint(),r=!0;if(r){var i=parseInt(Bi.apply(void 0,e.map(function(A){return A===oT?Qee:A})),16),s=parseInt(Bi.apply(void 0,e.map(function(A){return A===oT?Wee:A})),16);return{type:30,start:i,end:s}}var o=parseInt(Bi.apply(void 0,e),16);if(this.peekCodePoint(0)===Fo&&Bp(this.peekCodePoint(1))){this.consumeCodePoint(),n=this.consumeCodePoint();for(var a=[];Bp(n)&&a.length<6;)a.push(n),n=this.consumeCodePoint();var s=parseInt(Bi.apply(void 0,a),16);return{type:30,start:o,end:s}}else return{type:30,start:o,end:o}},t.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return e.toLowerCase()==="url"&&this.peekCodePoint(0)===sT?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===sT?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},t.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===wA)return{type:22,value:""};var n=this.peekCodePoint(0);if(n===iT||n===rT){var r=this.consumeStringToken(this.consumeCodePoint());return r.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===wA||this.peekCodePoint(0)===Z_)?(this.consumeCodePoint(),{type:22,value:r.value}):(this.consumeBadUrlRemnants(),AT)}for(;;){var i=this.consumeCodePoint();if(i===wA||i===Z_)return{type:22,value:Bi.apply(void 0,e)};if(aT(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===wA||this.peekCodePoint(0)===Z_?(this.consumeCodePoint(),{type:22,value:Bi.apply(void 0,e)}):(this.consumeBadUrlRemnants(),AT);if(i===rT||i===iT||i===sT||hPe(i))return this.consumeBadUrlRemnants(),AT;if(i===YE)if(ju(i,this.peekCodePoint(0)))e.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),AT;else e.push(i)}},t.prototype.consumeWhiteSpace=function(){for(;aT(this.peekCodePoint(0));)this.consumeCodePoint()},t.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===Z_||e===wA)return;ju(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},t.prototype.consumeStringSlice=function(e){for(var n=5e4,r="";e>0;){var i=Math.min(n,e);r+=Bi.apply(void 0,this._value.splice(0,i)),e-=i}return this._value.shift(),r},t.prototype.consumeStringToken=function(e){var n="",r=0;do{var i=this._value[r];if(i===wA||i===void 0||i===e)return n+=this.consumeStringSlice(r),{type:0,value:n};if(i===wS)return this._value.splice(0,r),bPe;if(i===YE){var s=this._value[r+1];s!==wA&&s!==void 0&&(s===wS?(n+=this.consumeStringSlice(r),r=-1,this._value.shift()):ju(i,s)&&(n+=this.consumeStringSlice(r),n+=Bi(this.consumeEscapedCodePoint()),r=-1))}r++}while(!0)},t.prototype.consumeNumber=function(){var e=[],n=Iy,r=this.peekCodePoint(0);for((r===zh||r===Fo)&&e.push(this.consumeCodePoint());eo(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(r===Kv&&eo(i))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),n=Z8;eo(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0),i=this.peekCodePoint(1);var s=this.peekCodePoint(2);if((r===Gee||r===jee)&&((i===zh||i===Fo)&&eo(s)||eo(i)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),n=Z8;eo(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[fPe(e),n]},t.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),n=e[0],r=e[1],i=this.peekCodePoint(0),s=this.peekCodePoint(1),o=this.peekCodePoint(2);if(cT(i,s,o)){var a=this.consumeName();return{type:15,number:n,flags:r,unit:a}}return i===P1e?(this.consumeCodePoint(),{type:16,number:n,flags:r}):{type:17,number:n,flags:r}},t.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(Bp(e)){for(var n=Bi(e);Bp(this.peekCodePoint(0))&&n.length<6;)n+=Bi(this.consumeCodePoint());aT(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(n,16);return r===0||cPe(r)||r>1114111?nW:r}return e===wA?nW:e},t.prototype.consumeName=function(){for(var e="";;){var n=this.consumeCodePoint();if(rW(n))e+=Bi(n);else if(ju(n,this.peekCodePoint(0)))e+=Bi(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(n),e}},t}(),qee=function(){function t(e){this._tokens=e}return t.create=function(e){var n=new zee;return n.write(e),new t(n.read())},t.parseValue=function(e){return t.create(e).parseComponentValue()},t.parseValues=function(e){return t.create(e).parseComponentValues()},t.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===31;)e=this.consumeToken();if(e.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var n=this.consumeComponentValue();do e=this.consumeToken();while(e.type===31);if(e.type===32)return n;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},t.prototype.parseComponentValues=function(){for(var e=[];;){var n=this.consumeComponentValue();if(n.type===32)return e;e.push(n),e.push()}},t.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},t.prototype.consumeSimpleBlock=function(e){for(var n={type:e,values:[]},r=this.consumeToken();;){if(r.type===32||PPe(r,e))return n;this.reconsumeToken(r),n.values.push(this.consumeComponentValue()),r=this.consumeToken()}},t.prototype.consumeFunction=function(e){for(var n={name:e.value,values:[],type:18};;){var r=this.consumeToken();if(r.type===32||r.type===3)return n;this.reconsumeToken(r),n.values.push(this.consumeComponentValue())}},t.prototype.consumeToken=function(){var e=this._tokens.shift();return typeof e>"u"?UU:e},t.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},t}(),Ry=function(t){return t.type===15},Lg=function(t){return t.type===17},fr=function(t){return t.type===20},UPe=function(t){return t.type===0},PU=function(t,e){return fr(t)&&t.value===e},Yee=function(t){return t.type!==31},rg=function(t){return t.type!==31&&t.type!==4},YA=function(t){var e=[],n=[];return t.forEach(function(r){if(r.type===4){if(n.length===0)throw new Error("Error parsing function args, zero tokens for arg");e.push(n),n=[];return}r.type!==31&&n.push(r)}),n.length&&e.push(n),e},PPe=function(t,e){return e===11&&t.type===12||e===28&&t.type===29?!0:e===2&&t.type===3},kd=function(t){return t.type===17||t.type===15},Ki=function(t){return t.type===16||kd(t)},Xee=function(t){return t.length>1?[t[0],t[1]]:[t[0]]},Vs={type:17,number:0,flags:Iy},$k={type:16,number:50,flags:Iy},cd={type:16,number:100,flags:Iy},vE=function(t,e,n){var r=t[0],i=t[1];return[Dr(r,e),Dr(typeof i<"u"?i:r,n)]},Dr=function(t,e){if(t.type===16)return t.number/100*e;if(Ry(t))switch(t.unit){case"rem":case"em":return 16*t.number;case"px":default:return t.number}return t.number},Jee="deg",$ee="grad",Zee="rad",ete="turn",qb={name:"angle",parse:function(t,e){if(e.type===15)switch(e.unit){case Jee:return Math.PI*e.number/180;case $ee:return Math.PI/200*e.number;case Zee:return e.number;case ete:return Math.PI*2*e.number}throw new Error("Unsupported angle type")}},tte=function(t){return t.type===15&&(t.unit===Jee||t.unit===$ee||t.unit===Zee||t.unit===ete)},nte=function(t){var e=t.filter(fr).map(function(n){return n.value}).join(" ");switch(e){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Vs,Vs];case"to top":case"bottom":return ac(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Vs,cd];case"to right":case"left":return ac(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[cd,cd];case"to bottom":case"top":return ac(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[cd,Vs];case"to left":case"right":return ac(270)}return 0},ac=function(t){return Math.PI*t/180},wd={name:"color",parse:function(t,e){if(e.type===18){var n=kPe[e.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return n(t,e.values)}if(e.type===5){if(e.value.length===3){var r=e.value.substring(0,1),i=e.value.substring(1,2),s=e.value.substring(2,3);return Ad(parseInt(r+r,16),parseInt(i+i,16),parseInt(s+s,16),1)}if(e.value.length===4){var r=e.value.substring(0,1),i=e.value.substring(1,2),s=e.value.substring(2,3),o=e.value.substring(3,4);return Ad(parseInt(r+r,16),parseInt(i+i,16),parseInt(s+s,16),parseInt(o+o,16)/255)}if(e.value.length===6){var r=e.value.substring(0,2),i=e.value.substring(2,4),s=e.value.substring(4,6);return Ad(parseInt(r,16),parseInt(i,16),parseInt(s,16),1)}if(e.value.length===8){var r=e.value.substring(0,2),i=e.value.substring(2,4),s=e.value.substring(4,6),o=e.value.substring(6,8);return Ad(parseInt(r,16),parseInt(i,16),parseInt(s,16),parseInt(o,16)/255)}}if(e.type===20){var a=jl[e.value.toUpperCase()];if(typeof a<"u")return a}return jl.TRANSPARENT}},Cd=function(t){return(255&t)===0},ms=function(t){var e=255&t,n=255&t>>8,r=255&t>>16,i=255&t>>24;return e<255?"rgba("+i+","+r+","+n+","+e/255+")":"rgb("+i+","+r+","+n+")"},Ad=function(t,e,n,r){return(t<<24|e<<16|n<<8|Math.round(r*255)<<0)>>>0},iW=function(t,e){if(t.type===17)return t.number;if(t.type===16){var n=e===3?1:255;return e===3?t.number/100*n:Math.round(t.number/100*n)}return 0},sW=function(t,e){var n=e.filter(rg);if(n.length===3){var r=n.map(iW),i=r[0],s=r[1],o=r[2];return Ad(i,s,o,1)}if(n.length===4){var a=n.map(iW),i=a[0],s=a[1],o=a[2],A=a[3];return Ad(i,s,o,A)}return 0};function nB(t,e,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(e-t)*n*6+t:n<1/2?e:n<2/3?(e-t)*6*(2/3-n)+t:t}var oW=function(t,e){var n=e.filter(rg),r=n[0],i=n[1],s=n[2],o=n[3],a=(r.type===17?ac(r.number):qb.parse(t,r))/(Math.PI*2),A=Ki(i)?i.number/100:0,u=Ki(s)?s.number/100:0,d=typeof o<"u"&&Ki(o)?Dr(o,1):1;if(A===0)return Ad(u*255,u*255,u*255,1);var f=u<=.5?u*(A+1):u+A-u*A,m=u*2-f,g=nB(m,f,a+1/3),v=nB(m,f,a),y=nB(m,f,a-1/3);return Ad(g*255,v*255,y*255,d)},kPe={hsl:oW,hsla:oW,rgb:sW,rgba:sW},XE=function(t,e){return wd.parse(t,qee.create(e).parseComponentValue())},jl={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},xPe={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map(function(n){if(fr(n))switch(n.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},MPe={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Yb=function(t,e){var n=wd.parse(t,e[0]),r=e[1];return r&&Ki(r)?{color:n,stop:r}:{color:n,stop:null}},aW=function(t,e){var n=t[0],r=t[t.length-1];n.stop===null&&(n.stop=Vs),r.stop===null&&(r.stop=cd);for(var i=[],s=0,o=0;o<t.length;o++){var a=t[o].stop;if(a!==null){var A=Dr(a,e);A>s?i.push(A):i.push(s),s=A}else i.push(null)}for(var u=null,o=0;o<i.length;o++){var d=i[o];if(d===null)u===null&&(u=o);else if(u!==null){for(var f=o-u,m=i[u-1],g=(d-m)/(f+1),v=1;v<=f;v++)i[u+v-1]=g*v;u=null}}return t.map(function(y,w){var b=y.color;return{color:b,stop:Math.max(Math.min(1,i[w]/e),0)}})},FPe=function(t,e,n){var r=e/2,i=n/2,s=Dr(t[0],e)-r,o=i-Dr(t[1],n);return(Math.atan2(o,s)+Math.PI*2)%(Math.PI*2)},VPe=function(t,e,n){var r=typeof t=="number"?t:FPe(t,e,n),i=Math.abs(e*Math.sin(r))+Math.abs(n*Math.cos(r)),s=e/2,o=n/2,a=i/2,A=Math.sin(r-Math.PI/2)*a,u=Math.cos(r-Math.PI/2)*a;return[i,s-u,s+u,o-A,o+A]},Pc=function(t,e){return Math.sqrt(t*t+e*e)},cW=function(t,e,n,r,i){var s=[[0,0],[0,e],[t,0],[t,e]];return s.reduce(function(o,a){var A=a[0],u=a[1],d=Pc(n-A,r-u);return(i?d<o.optimumDistance:d>o.optimumDistance)?{optimumCorner:a,optimumDistance:d}:o},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},QPe=function(t,e,n,r,i){var s=0,o=0;switch(t.size){case 0:t.shape===0?s=o=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(n),Math.abs(n-i)):t.shape===1&&(s=Math.min(Math.abs(e),Math.abs(e-r)),o=Math.min(Math.abs(n),Math.abs(n-i)));break;case 2:if(t.shape===0)s=o=Math.min(Pc(e,n),Pc(e,n-i),Pc(e-r,n),Pc(e-r,n-i));else if(t.shape===1){var a=Math.min(Math.abs(n),Math.abs(n-i))/Math.min(Math.abs(e),Math.abs(e-r)),A=cW(r,i,e,n,!0),u=A[0],d=A[1];s=Pc(u-e,(d-n)/a),o=a*s}break;case 1:t.shape===0?s=o=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(n),Math.abs(n-i)):t.shape===1&&(s=Math.max(Math.abs(e),Math.abs(e-r)),o=Math.max(Math.abs(n),Math.abs(n-i)));break;case 3:if(t.shape===0)s=o=Math.max(Pc(e,n),Pc(e,n-i),Pc(e-r,n),Pc(e-r,n-i));else if(t.shape===1){var a=Math.max(Math.abs(n),Math.abs(n-i))/Math.max(Math.abs(e),Math.abs(e-r)),f=cW(r,i,e,n,!1),u=f[0],d=f[1];s=Pc(u-e,(d-n)/a),o=a*s}break}return Array.isArray(t.size)&&(s=Dr(t.size[0],r),o=t.size.length===2?Dr(t.size[1],i):s),[s,o]},HPe=function(t,e){var n=ac(180),r=[];return YA(e).forEach(function(i,s){if(s===0){var o=i[0];if(o.type===20&&o.value==="to"){n=nte(i);return}else if(tte(o)){n=qb.parse(t,o);return}}var a=Yb(t,i);r.push(a)}),{angle:n,stops:r,type:1}},lT=function(t,e){var n=ac(180),r=[];return YA(e).forEach(function(i,s){if(s===0){var o=i[0];if(o.type===20&&["top","left","right","bottom"].indexOf(o.value)!==-1){n=nte(i);return}else if(tte(o)){n=(qb.parse(t,o)+ac(270))%ac(360);return}}var a=Yb(t,i);r.push(a)}),{angle:n,stops:r,type:1}},jPe=function(t,e){var n=ac(180),r=[],i=1,s=0,o=3,a=[];return YA(e).forEach(function(A,u){var d=A[0];if(u===0){if(fr(d)&&d.value==="linear"){i=1;return}else if(fr(d)&&d.value==="radial"){i=2;return}}if(d.type===18){if(d.name==="from"){var f=wd.parse(t,d.values[0]);r.push({stop:Vs,color:f})}else if(d.name==="to"){var f=wd.parse(t,d.values[0]);r.push({stop:cd,color:f})}else if(d.name==="color-stop"){var m=d.values.filter(rg);if(m.length===2){var f=wd.parse(t,m[1]),g=m[0];Lg(g)&&r.push({stop:{type:16,number:g.number*100,flags:g.flags},color:f})}}}}),i===1?{angle:(n+ac(180))%ac(360),stops:r,type:i}:{size:o,shape:s,stops:r,position:a,type:i}},rte="closest-side",ite="farthest-side",ste="closest-corner",ote="farthest-corner",ate="circle",cte="ellipse",Ate="cover",lte="contain",KPe=function(t,e){var n=0,r=3,i=[],s=[];return YA(e).forEach(function(o,a){var A=!0;if(a===0){var u=!1;A=o.reduce(function(f,m){if(u)if(fr(m))switch(m.value){case"center":return s.push($k),f;case"top":case"left":return s.push(Vs),f;case"right":case"bottom":return s.push(cd),f}else(Ki(m)||kd(m))&&s.push(m);else if(fr(m))switch(m.value){case ate:return n=0,!1;case cte:return n=1,!1;case"at":return u=!0,!1;case rte:return r=0,!1;case Ate:case ite:return r=1,!1;case lte:case ste:return r=2,!1;case ote:return r=3,!1}else if(kd(m)||Ki(m))return Array.isArray(r)||(r=[]),r.push(m),!1;return f},A)}if(A){var d=Yb(t,o);i.push(d)}}),{size:r,shape:n,stops:i,position:s,type:2}},uT=function(t,e){var n=0,r=3,i=[],s=[];return YA(e).forEach(function(o,a){var A=!0;if(a===0?A=o.reduce(function(d,f){if(fr(f))switch(f.value){case"center":return s.push($k),!1;case"top":case"left":return s.push(Vs),!1;case"right":case"bottom":return s.push(cd),!1}else if(Ki(f)||kd(f))return s.push(f),!1;return d},A):a===1&&(A=o.reduce(function(d,f){if(fr(f))switch(f.value){case ate:return n=0,!1;case cte:return n=1,!1;case lte:case rte:return r=0,!1;case ite:return r=1,!1;case ste:return r=2,!1;case Ate:case ote:return r=3,!1}else if(kd(f)||Ki(f))return Array.isArray(r)||(r=[]),r.push(f),!1;return d},A)),A){var u=Yb(t,o);i.push(u)}}),{size:r,shape:n,stops:i,position:s,type:2}},GPe=function(t){return t.type===1},WPe=function(t){return t.type===2},Zk={name:"image",parse:function(t,e){if(e.type===22){var n={url:e.value,type:0};return t.cache.addImage(e.value),n}if(e.type===18){var r=ute[e.name];if(typeof r>"u")throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return r(t,e.values)}throw new Error("Unsupported image type "+e.type)}};function zPe(t){return!(t.type===20&&t.value==="none")&&(t.type!==18||!!ute[t.name])}var ute={"linear-gradient":HPe,"-moz-linear-gradient":lT,"-ms-linear-gradient":lT,"-o-linear-gradient":lT,"-webkit-linear-gradient":lT,"radial-gradient":KPe,"-moz-radial-gradient":uT,"-ms-radial-gradient":uT,"-o-radial-gradient":uT,"-webkit-radial-gradient":uT,"-webkit-gradient":jPe},qPe={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(e.length===0)return[];var n=e[0];return n.type===20&&n.value==="none"?[]:e.filter(function(r){return rg(r)&&zPe(r)}).map(function(r){return Zk.parse(t,r)})}},YPe={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map(function(n){if(fr(n))switch(n.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},XPe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(t,e){return YA(e).map(function(n){return n.filter(Ki)}).map(Xee)}},JPe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(t,e){return YA(e).map(function(n){return n.filter(fr).map(function(r){return r.value}).join(" ")}).map($Pe)}},$Pe=function(t){switch(t){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},Im;(function(t){t.AUTO="auto",t.CONTAIN="contain",t.COVER="cover"})(Im||(Im={}));var ZPe={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(t,e){return YA(e).map(function(n){return n.filter(eke)})}},eke=function(t){return fr(t)||Ki(t)},Xb=function(t){return{name:"border-"+t+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},tke=Xb("top"),nke=Xb("right"),rke=Xb("bottom"),ike=Xb("left"),Jb=function(t){return{name:"border-radius-"+t,initialValue:"0 0",prefix:!1,type:1,parse:function(e,n){return Xee(n.filter(Ki))}}},ske=Jb("top-left"),oke=Jb("top-right"),ake=Jb("bottom-right"),cke=Jb("bottom-left"),$b=function(t){return{name:"border-"+t+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,n){switch(n){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Ake=$b("top"),lke=$b("right"),uke=$b("bottom"),dke=$b("left"),Zb=function(t){return{name:"border-"+t+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,n){return Ry(n)?n.number:0}}},hke=Zb("top"),fke=Zb("right"),pke=Zb("bottom"),mke=Zb("left"),gke={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},_ke={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(t,e){switch(e){case"rtl":return 1;case"ltr":default:return 0}}},Eke={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(t,e){return e.filter(fr).reduce(function(n,r){return n|vke(r.value)},0)}},vke=function(t){switch(t){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},yke={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},wke={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(t,e){return e.type===20&&e.value==="normal"?0:e.type===17||e.type===15?e.number:0}},TS;(function(t){t.NORMAL="normal",t.STRICT="strict"})(TS||(TS={}));var Cke={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"strict":return TS.STRICT;case"normal":default:return TS.NORMAL}}},Tke={name:"line-height",initialValue:"normal",prefix:!1,type:4},AW=function(t,e){return fr(t)&&t.value==="normal"?1.2*e:t.type===17?e*t.number:Ki(t)?Dr(t,e):e},Ske={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(t,e){return e.type===20&&e.value==="none"?null:Zk.parse(t,e)}},bke={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(t,e){switch(e){case"inside":return 0;case"outside":default:return 1}}},kU={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},eI=function(t){return{name:"margin-"+t,initialValue:"0",prefix:!1,type:4}},Ike=eI("top"),Rke=eI("right"),Oke=eI("bottom"),Nke=eI("left"),Dke={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(t,e){return e.filter(fr).map(function(n){switch(n.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},Bke={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"break-word":return"break-word";case"normal":default:return"normal"}}},tI=function(t){return{name:"padding-"+t,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Lke=tI("top"),Uke=tI("right"),Pke=tI("bottom"),kke=tI("left"),xke={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(t,e){switch(e){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},Mke={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(t,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Fke={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.length===1&&PU(e[0],"none")?[]:YA(e).map(function(n){for(var r={color:jl.TRANSPARENT,offsetX:Vs,offsetY:Vs,blur:Vs},i=0,s=0;s<n.length;s++){var o=n[s];kd(o)?(i===0?r.offsetX=o:i===1?r.offsetY=o:r.blur=o,i++):r.color=wd.parse(t,o)}return r})}},Vke={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Qke={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(t,e){if(e.type===20&&e.value==="none")return null;if(e.type===18){var n=Kke[e.name];if(typeof n>"u")throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return n(e.values)}return null}},Hke=function(t){var e=t.filter(function(n){return n.type===17}).map(function(n){return n.number});return e.length===6?e:null},jke=function(t){var e=t.filter(function(A){return A.type===17}).map(function(A){return A.number}),n=e[0],r=e[1];e[2],e[3];var i=e[4],s=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var o=e[12],a=e[13];return e[14],e[15],e.length===16?[n,r,i,s,o,a]:null},Kke={matrix:Hke,matrix3d:jke},lW={type:16,number:50,flags:Iy},Gke=[lW,lW],Wke={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(t,e){var n=e.filter(Ki);return n.length!==2?Gke:[n[0],n[1]]}},zke={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},JE;(function(t){t.NORMAL="normal",t.BREAK_ALL="break-all",t.KEEP_ALL="keep-all"})(JE||(JE={}));var qke={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"break-all":return JE.BREAK_ALL;case"keep-all":return JE.KEEP_ALL;case"normal":default:return JE.NORMAL}}},Yke={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(t,e){if(e.type===20)return{auto:!0,order:0};if(Lg(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},dte={name:"time",parse:function(t,e){if(e.type===15)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")}},Xke={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(t,e){return Lg(e)?e.number:1}},Jke={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},$ke={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(t,e){return e.filter(fr).map(function(n){switch(n.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(n){return n!==0})}},Zke={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(t,e){var n=[],r=[];return e.forEach(function(i){switch(i.type){case 20:case 0:n.push(i.value);break;case 17:n.push(i.number.toString());break;case 4:r.push(n.join(" ")),n.length=0;break}}),n.length&&r.push(n.join(" ")),r.map(function(i){return i.indexOf(" ")===-1?i:"'"+i+"'"})}},exe={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},txe={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(t,e){if(Lg(e))return e.number;if(fr(e))switch(e.value){case"bold":return 700;case"normal":default:return 400}return 400}},nxe={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.filter(fr).map(function(n){return n.value})}},rxe={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},ss=function(t,e){return(t&e)!==0},ixe={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(e.length===0)return[];var n=e[0];return n.type===20&&n.value==="none"?[]:e}},sxe={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(e.length===0)return null;var n=e[0];if(n.type===20&&n.value==="none")return null;for(var r=[],i=e.filter(Yee),s=0;s<i.length;s++){var o=i[s],a=i[s+1];if(o.type===20){var A=a&&Lg(a)?a.number:1;r.push({counter:o.value,increment:A})}}return r}},oxe={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(e.length===0)return[];for(var n=[],r=e.filter(Yee),i=0;i<r.length;i++){var s=r[i],o=r[i+1];if(fr(s)&&s.value!=="none"){var a=o&&Lg(o)?o.number:0;n.push({counter:s.value,reset:a})}}return n}},axe={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(t,e){return e.filter(Ry).map(function(n){return dte.parse(t,n)})}},cxe={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(e.length===0)return null;var n=e[0];if(n.type===20&&n.value==="none")return null;var r=[],i=e.filter(UPe);if(i.length%2!==0)return null;for(var s=0;s<i.length;s+=2){var o=i[s].value,a=i[s+1].value;r.push({open:o,close:a})}return r}},uW=function(t,e,n){if(!t)return"";var r=t[Math.min(e,t.length-1)];return r?n?r.open:r.close:""},Axe={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.length===1&&PU(e[0],"none")?[]:YA(e).map(function(n){for(var r={color:255,offsetX:Vs,offsetY:Vs,blur:Vs,spread:Vs,inset:!1},i=0,s=0;s<n.length;s++){var o=n[s];PU(o,"inset")?r.inset=!0:kd(o)?(i===0?r.offsetX=o:i===1?r.offsetY=o:i===2?r.blur=o:r.spread=o,i++):r.color=wd.parse(t,o)}return r})}},lxe={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(t,e){var n=[0,1,2],r=[];return e.filter(fr).forEach(function(i){switch(i.value){case"stroke":r.push(1);break;case"fill":r.push(0);break;case"markers":r.push(2);break}}),n.forEach(function(i){r.indexOf(i)===-1&&r.push(i)}),r}},uxe={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},dxe={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Ry(e)?e.number:0}},hxe=function(){function t(e,n){var r,i;this.animationDuration=Ze(e,axe,n.animationDuration),this.backgroundClip=Ze(e,xPe,n.backgroundClip),this.backgroundColor=Ze(e,MPe,n.backgroundColor),this.backgroundImage=Ze(e,qPe,n.backgroundImage),this.backgroundOrigin=Ze(e,YPe,n.backgroundOrigin),this.backgroundPosition=Ze(e,XPe,n.backgroundPosition),this.backgroundRepeat=Ze(e,JPe,n.backgroundRepeat),this.backgroundSize=Ze(e,ZPe,n.backgroundSize),this.borderTopColor=Ze(e,tke,n.borderTopColor),this.borderRightColor=Ze(e,nke,n.borderRightColor),this.borderBottomColor=Ze(e,rke,n.borderBottomColor),this.borderLeftColor=Ze(e,ike,n.borderLeftColor),this.borderTopLeftRadius=Ze(e,ske,n.borderTopLeftRadius),this.borderTopRightRadius=Ze(e,oke,n.borderTopRightRadius),this.borderBottomRightRadius=Ze(e,ake,n.borderBottomRightRadius),this.borderBottomLeftRadius=Ze(e,cke,n.borderBottomLeftRadius),this.borderTopStyle=Ze(e,Ake,n.borderTopStyle),this.borderRightStyle=Ze(e,lke,n.borderRightStyle),this.borderBottomStyle=Ze(e,uke,n.borderBottomStyle),this.borderLeftStyle=Ze(e,dke,n.borderLeftStyle),this.borderTopWidth=Ze(e,hke,n.borderTopWidth),this.borderRightWidth=Ze(e,fke,n.borderRightWidth),this.borderBottomWidth=Ze(e,pke,n.borderBottomWidth),this.borderLeftWidth=Ze(e,mke,n.borderLeftWidth),this.boxShadow=Ze(e,Axe,n.boxShadow),this.color=Ze(e,gke,n.color),this.direction=Ze(e,_ke,n.direction),this.display=Ze(e,Eke,n.display),this.float=Ze(e,yke,n.cssFloat),this.fontFamily=Ze(e,Zke,n.fontFamily),this.fontSize=Ze(e,exe,n.fontSize),this.fontStyle=Ze(e,rxe,n.fontStyle),this.fontVariant=Ze(e,nxe,n.fontVariant),this.fontWeight=Ze(e,txe,n.fontWeight),this.letterSpacing=Ze(e,wke,n.letterSpacing),this.lineBreak=Ze(e,Cke,n.lineBreak),this.lineHeight=Ze(e,Tke,n.lineHeight),this.listStyleImage=Ze(e,Ske,n.listStyleImage),this.listStylePosition=Ze(e,bke,n.listStylePosition),this.listStyleType=Ze(e,kU,n.listStyleType),this.marginTop=Ze(e,Ike,n.marginTop),this.marginRight=Ze(e,Rke,n.marginRight),this.marginBottom=Ze(e,Oke,n.marginBottom),this.marginLeft=Ze(e,Nke,n.marginLeft),this.opacity=Ze(e,Xke,n.opacity);var s=Ze(e,Dke,n.overflow);this.overflowX=s[0],this.overflowY=s[s.length>1?1:0],this.overflowWrap=Ze(e,Bke,n.overflowWrap),this.paddingTop=Ze(e,Lke,n.paddingTop),this.paddingRight=Ze(e,Uke,n.paddingRight),this.paddingBottom=Ze(e,Pke,n.paddingBottom),this.paddingLeft=Ze(e,kke,n.paddingLeft),this.paintOrder=Ze(e,lxe,n.paintOrder),this.position=Ze(e,Mke,n.position),this.textAlign=Ze(e,xke,n.textAlign),this.textDecorationColor=Ze(e,Jke,(r=n.textDecorationColor)!==null&&r!==void 0?r:n.color),this.textDecorationLine=Ze(e,$ke,(i=n.textDecorationLine)!==null&&i!==void 0?i:n.textDecoration),this.textShadow=Ze(e,Fke,n.textShadow),this.textTransform=Ze(e,Vke,n.textTransform),this.transform=Ze(e,Qke,n.transform),this.transformOrigin=Ze(e,Wke,n.transformOrigin),this.visibility=Ze(e,zke,n.visibility),this.webkitTextStrokeColor=Ze(e,uxe,n.webkitTextStrokeColor),this.webkitTextStrokeWidth=Ze(e,dxe,n.webkitTextStrokeWidth),this.wordBreak=Ze(e,qke,n.wordBreak),this.zIndex=Ze(e,Yke,n.zIndex)}return t.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},t.prototype.isTransparent=function(){return Cd(this.backgroundColor)},t.prototype.isTransformed=function(){return this.transform!==null},t.prototype.isPositioned=function(){return this.position!==0},t.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},t.prototype.isFloating=function(){return this.float!==0},t.prototype.isInlineLevel=function(){return ss(this.display,4)||ss(this.display,33554432)||ss(this.display,268435456)||ss(this.display,536870912)||ss(this.display,67108864)||ss(this.display,134217728)},t}(),fxe=function(){function t(e,n){this.content=Ze(e,ixe,n.content),this.quotes=Ze(e,cxe,n.quotes)}return t}(),dW=function(){function t(e,n){this.counterIncrement=Ze(e,sxe,n.counterIncrement),this.counterReset=Ze(e,oxe,n.counterReset)}return t}(),Ze=function(t,e,n){var r=new zee,i=n!==null&&typeof n<"u"?n.toString():e.initialValue;r.write(i);var s=new qee(r.read());switch(e.type){case 2:var o=s.parseComponentValue();return e.parse(t,fr(o)?o.value:e.initialValue);case 0:return e.parse(t,s.parseComponentValue());case 1:return e.parse(t,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(e.format){case"angle":return qb.parse(t,s.parseComponentValue());case"color":return wd.parse(t,s.parseComponentValue());case"image":return Zk.parse(t,s.parseComponentValue());case"length":var a=s.parseComponentValue();return kd(a)?a:Vs;case"length-percentage":var A=s.parseComponentValue();return Ki(A)?A:Vs;case"time":return dte.parse(t,s.parseComponentValue())}break}},pxe="data-html2canvas-debug",mxe=function(t){var e=t.getAttribute(pxe);switch(e){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},xU=function(t,e){var n=mxe(t);return n===1||e===n},XA=function(){function t(e,n){if(this.context=e,this.textNodes=[],this.elements=[],this.flags=0,xU(n,3))debugger;this.styles=new hxe(e,window.getComputedStyle(n,null)),VU(n)&&(this.styles.animationDuration.some(function(r){return r>0})&&(n.style.animationDuration="0s"),this.styles.transform!==null&&(n.style.transform="none")),this.bounds=Wb(this.context,n),xU(n,4)&&(this.flags|=16)}return t}(),gxe="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",hW="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",yE=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var dT=0;dT<hW.length;dT++)yE[hW.charCodeAt(dT)]=dT;var _xe=function(t){var e=t.length*.75,n=t.length,r,i=0,s,o,a,A;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);var u=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&typeof Uint8Array.prototype.slice<"u"?new ArrayBuffer(e):new Array(e),d=Array.isArray(u)?u:new Uint8Array(u);for(r=0;r<n;r+=4)s=yE[t.charCodeAt(r)],o=yE[t.charCodeAt(r+1)],a=yE[t.charCodeAt(r+2)],A=yE[t.charCodeAt(r+3)],d[i++]=s<<2|o>>4,d[i++]=(o&15)<<4|a>>2,d[i++]=(a&3)<<6|A&63;return u},Exe=function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n.push(t[r+1]<<8|t[r]);return n},vxe=function(t){for(var e=t.length,n=[],r=0;r<e;r+=4)n.push(t[r+3]<<24|t[r+2]<<16|t[r+1]<<8|t[r]);return n},sf=5,ex=11,rB=2,yxe=ex-sf,hte=65536>>sf,wxe=1<<sf,iB=wxe-1,Cxe=1024>>sf,Txe=hte+Cxe,Sxe=Txe,bxe=32,Ixe=Sxe+bxe,Rxe=65536>>ex,Oxe=1<<yxe,Nxe=Oxe-1,fW=function(t,e,n){return t.slice?t.slice(e,n):new Uint16Array(Array.prototype.slice.call(t,e,n))},Dxe=function(t,e,n){return t.slice?t.slice(e,n):new Uint32Array(Array.prototype.slice.call(t,e,n))},Bxe=function(t,e){var n=_xe(t),r=Array.isArray(n)?vxe(n):new Uint32Array(n),i=Array.isArray(n)?Exe(n):new Uint16Array(n),s=24,o=fW(i,s/2,r[4]/2),a=r[5]===2?fW(i,(s+r[4])/2):Dxe(r,Math.ceil((s+r[4])/4));return new Lxe(r[0],r[1],r[2],r[3],o,a)},Lxe=function(){function t(e,n,r,i,s,o){this.initialValue=e,this.errorValue=n,this.highStart=r,this.highValueIndex=i,this.index=s,this.data=o}return t.prototype.get=function(e){var n;if(e>=0){if(e<55296||e>56319&&e<=65535)return n=this.index[e>>sf],n=(n<<rB)+(e&iB),this.data[n];if(e<=65535)return n=this.index[hte+(e-55296>>sf)],n=(n<<rB)+(e&iB),this.data[n];if(e<this.highStart)return n=Ixe-Rxe+(e>>ex),n=this.index[n],n+=e>>sf&Nxe,n=this.index[n],n=(n<<rB)+(e&iB),this.data[n];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),pW="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Uxe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(var hT=0;hT<pW.length;hT++)Uxe[pW.charCodeAt(hT)]=hT;var Pxe=1,sB=2,oB=3,mW=4,gW=5,kxe=7,_W=8,aB=9,cB=10,EW=11,vW=12,yW=13,wW=14,AB=15,xxe=function(t){for(var e=[],n=0,r=t.length;n<r;){var i=t.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var s=t.charCodeAt(n++);(s&64512)===56320?e.push(((i&1023)<<10)+(s&1023)+65536):(e.push(i),n--)}else e.push(i)}return e},Mxe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var n=t.length;if(!n)return"";for(var r=[],i=-1,s="";++i<n;){var o=t[i];o<=65535?r.push(o):(o-=65536,r.push((o>>10)+55296,o%1024+56320)),(i+1===n||r.length>16384)&&(s+=String.fromCharCode.apply(String,r),r.length=0)}return s},Fxe=Bxe(gxe),$a="",lB="",Vxe=function(t){return Fxe.get(t)},Qxe=function(t,e,n){var r=n-2,i=e[r],s=e[n-1],o=e[n];if(s===sB&&o===oB)return $a;if(s===sB||s===oB||s===mW||o===sB||o===oB||o===mW)return lB;if(s===_W&&[_W,aB,EW,vW].indexOf(o)!==-1||(s===EW||s===aB)&&(o===aB||o===cB)||(s===vW||s===cB)&&o===cB||o===yW||o===gW||o===kxe||s===Pxe)return $a;if(s===yW&&o===wW){for(;i===gW;)i=e[--r];if(i===wW)return $a}if(s===AB&&o===AB){for(var a=0;i===AB;)a++,i=e[--r];if(a%2===0)return $a}return lB},Hxe=function(t){var e=xxe(t),n=e.length,r=0,i=0,s=e.map(Vxe);return{next:function(){if(r>=n)return{done:!0,value:null};for(var o=$a;r<n&&(o=Qxe(e,s,++r))===$a;);if(o!==$a||r===n){var a=Mxe.apply(null,e.slice(i,r));return i=r,{value:a,done:!1}}return{done:!0,value:null}}}},jxe=function(t){for(var e=Hxe(t),n=[],r;!(r=e.next()).done;)r.value&&n.push(r.value.slice());return n},Kxe=function(t){var e=123;if(t.createRange){var n=t.createRange();if(n.getBoundingClientRect){var r=t.createElement("boundtest");r.style.height=e+"px",r.style.display="block",t.body.appendChild(r),n.selectNode(r);var i=n.getBoundingClientRect(),s=Math.round(i.height);if(t.body.removeChild(r),s===e)return!0}}return!1},Gxe=function(t){var e=t.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",t.body.appendChild(e);var n=t.createRange();e.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var r=e.firstChild,i=zb(r.data).map(function(A){return Bi(A)}),s=0,o={},a=i.every(function(A,u){n.setStart(r,s),n.setEnd(r,s+A.length);var d=n.getBoundingClientRect();s+=A.length;var f=d.x>o.x||d.y>o.y;return o=d,u===0?!0:f});return t.body.removeChild(e),a},Wxe=function(){return typeof new Image().crossOrigin<"u"},zxe=function(){return typeof new XMLHttpRequest().responseType=="string"},qxe=function(t){var e=new Image,n=t.createElement("canvas"),r=n.getContext("2d");if(!r)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(e,0,0),n.toDataURL()}catch{return!1}return!0},CW=function(t){return t[0]===0&&t[1]===255&&t[2]===0&&t[3]===255},Yxe=function(t){var e=t.createElement("canvas"),n=100;e.width=n,e.height=n;var r=e.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,n,n);var i=new Image,s=e.toDataURL();i.src=s;var o=MU(n,n,0,0,i);return r.fillStyle="red",r.fillRect(0,0,n,n),TW(o).then(function(a){r.drawImage(a,0,0);var A=r.getImageData(0,0,n,n).data;r.fillStyle="red",r.fillRect(0,0,n,n);var u=t.createElement("div");return u.style.backgroundImage="url("+s+")",u.style.height=n+"px",CW(A)?TW(MU(n,n,0,0,u)):Promise.reject(!1)}).then(function(a){return r.drawImage(a,0,0),CW(r.getImageData(0,0,n,n).data)}).catch(function(){return!1})},MU=function(t,e,n,r,i){var s="http://www.w3.org/2000/svg",o=document.createElementNS(s,"svg"),a=document.createElementNS(s,"foreignObject");return o.setAttributeNS(null,"width",t.toString()),o.setAttributeNS(null,"height",e.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",n.toString()),a.setAttributeNS(null,"y",r.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),o.appendChild(a),a.appendChild(i),o},TW=function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){return e(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(t))})},xs={get SUPPORT_RANGE_BOUNDS(){var t=Kxe(document);return Object.defineProperty(xs,"SUPPORT_RANGE_BOUNDS",{value:t}),t},get SUPPORT_WORD_BREAKING(){var t=xs.SUPPORT_RANGE_BOUNDS&&Gxe(document);return Object.defineProperty(xs,"SUPPORT_WORD_BREAKING",{value:t}),t},get SUPPORT_SVG_DRAWING(){var t=qxe(document);return Object.defineProperty(xs,"SUPPORT_SVG_DRAWING",{value:t}),t},get SUPPORT_FOREIGNOBJECT_DRAWING(){var t=typeof Array.from=="function"&&typeof window.fetch=="function"?Yxe(document):Promise.resolve(!1);return Object.defineProperty(xs,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:t}),t},get SUPPORT_CORS_IMAGES(){var t=Wxe();return Object.defineProperty(xs,"SUPPORT_CORS_IMAGES",{value:t}),t},get SUPPORT_RESPONSE_TYPE(){var t=zxe();return Object.defineProperty(xs,"SUPPORT_RESPONSE_TYPE",{value:t}),t},get SUPPORT_CORS_XHR(){var t="withCredentials"in new XMLHttpRequest;return Object.defineProperty(xs,"SUPPORT_CORS_XHR",{value:t}),t},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var t=!!(typeof Intl<"u"&&Intl.Segmenter);return Object.defineProperty(xs,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:t}),t}},$E=function(){function t(e,n){this.text=e,this.bounds=n}return t}(),Xxe=function(t,e,n,r){var i=Zxe(e,n),s=[],o=0;return i.forEach(function(a){if(n.textDecorationLine.length||a.trim().length>0)if(xs.SUPPORT_RANGE_BOUNDS){var A=SW(r,o,a.length).getClientRects();if(A.length>1){var u=tx(a),d=0;u.forEach(function(m){s.push(new $E(m,$l.fromDOMRectList(t,SW(r,d+o,m.length).getClientRects()))),d+=m.length})}else s.push(new $E(a,$l.fromDOMRectList(t,A)))}else{var f=r.splitText(a.length);s.push(new $E(a,Jxe(t,r))),r=f}else xs.SUPPORT_RANGE_BOUNDS||(r=r.splitText(a.length));o+=a.length}),s},Jxe=function(t,e){var n=e.ownerDocument;if(n){var r=n.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));var i=e.parentNode;if(i){i.replaceChild(r,e);var s=Wb(t,r);return r.firstChild&&i.replaceChild(r.firstChild,r),s}}return $l.EMPTY},SW=function(t,e,n){var r=t.ownerDocument;if(!r)throw new Error("Node has no owner document");var i=r.createRange();return i.setStart(t,e),i.setEnd(t,e+n),i},tx=function(t){if(xs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(t)).map(function(n){return n.segment})}return jxe(t)},$xe=function(t,e){if(xs.SUPPORT_NATIVE_TEXT_SEGMENTATION){var n=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(n.segment(t)).map(function(r){return r.segment})}return tMe(t,e)},Zxe=function(t,e){return e.letterSpacing!==0?tx(t):$xe(t,e)},eMe=[32,160,4961,65792,65793,4153,4241],tMe=function(t,e){for(var n=R1e(t,{lineBreak:e.lineBreak,wordBreak:e.overflowWrap==="break-word"?"break-word":e.wordBreak}),r=[],i,s=function(){if(i.value){var o=i.value.slice(),a=zb(o),A="";a.forEach(function(u){eMe.indexOf(u)===-1?A+=Bi(u):(A.length&&r.push(A),r.push(Bi(u)),A="")}),A.length&&r.push(A)}};!(i=n.next()).done;)s();return r},nMe=function(){function t(e,n,r){this.text=rMe(n.data,r.textTransform),this.textBounds=Xxe(e,this.text,r,n)}return t}(),rMe=function(t,e){switch(e){case 1:return t.toLowerCase();case 3:return t.replace(iMe,sMe);case 2:return t.toUpperCase();default:return t}},iMe=/(^|\s|:|-|\(|\))([a-z])/g,sMe=function(t,e,n){return t.length>0?e+n.toUpperCase():t},fte=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.src=r.currentSrc||r.src,i.intrinsicWidth=r.naturalWidth,i.intrinsicHeight=r.naturalHeight,i.context.cache.addImage(i.src),i}return e}(XA),pte=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.canvas=r,i.intrinsicWidth=r.width,i.intrinsicHeight=r.height,i}return e}(XA),mte=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this,s=new XMLSerializer,o=Wb(n,r);return r.setAttribute("width",o.width+"px"),r.setAttribute("height",o.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(s.serializeToString(r)),i.intrinsicWidth=r.width.baseVal.value,i.intrinsicHeight=r.height.baseVal.value,i.context.cache.addImage(i.svg),i}return e}(XA),gte=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.value=r.value,i}return e}(XA),FU=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.start=r.start,i.reversed=typeof r.reversed=="boolean"&&r.reversed===!0,i}return e}(XA),oMe=[{type:15,flags:0,unit:"px",number:3}],aMe=[{type:16,flags:0,number:50}],cMe=function(t){return t.width>t.height?new $l(t.left+(t.width-t.height)/2,t.top,t.height,t.height):t.width<t.height?new $l(t.left,t.top+(t.height-t.width)/2,t.width,t.width):t},AMe=function(t){var e=t.type===lMe?new Array(t.value.length+1).join(""):t.value;return e.length===0?t.placeholder||"":e},SS="checkbox",bS="radio",lMe="password",bW=707406591,nx=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this;switch(i.type=r.type.toLowerCase(),i.checked=r.checked,i.value=AMe(r),(i.type===SS||i.type===bS)&&(i.styles.backgroundColor=3739148031,i.styles.borderTopColor=i.styles.borderRightColor=i.styles.borderBottomColor=i.styles.borderLeftColor=2779096575,i.styles.borderTopWidth=i.styles.borderRightWidth=i.styles.borderBottomWidth=i.styles.borderLeftWidth=1,i.styles.borderTopStyle=i.styles.borderRightStyle=i.styles.borderBottomStyle=i.styles.borderLeftStyle=1,i.styles.backgroundClip=[0],i.styles.backgroundOrigin=[0],i.bounds=cMe(i.bounds)),i.type){case SS:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=oMe;break;case bS:i.styles.borderTopRightRadius=i.styles.borderTopLeftRadius=i.styles.borderBottomRightRadius=i.styles.borderBottomLeftRadius=aMe;break}return i}return e}(XA),_te=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this,s=r.options[r.selectedIndex||0];return i.value=s&&s.text||"",i}return e}(XA),Ete=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.value=r.value,i}return e}(XA),vte=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this;i.src=r.src,i.width=parseInt(r.width,10)||0,i.height=parseInt(r.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(r.contentWindow&&r.contentWindow.document&&r.contentWindow.document.documentElement){i.tree=wte(n,r.contentWindow.document.documentElement);var s=r.contentWindow.document.documentElement?XE(n,getComputedStyle(r.contentWindow.document.documentElement).backgroundColor):jl.TRANSPARENT,o=r.contentWindow.document.body?XE(n,getComputedStyle(r.contentWindow.document.body).backgroundColor):jl.TRANSPARENT;i.backgroundColor=Cd(s)?Cd(o)?i.styles.backgroundColor:o:s}}catch{}return i}return e}(XA),uMe=["OL","UL","MENU"],a0=function(t,e,n,r){for(var i=e.firstChild,s=void 0;i;i=s)if(s=i.nextSibling,Cte(i)&&i.data.trim().length>0)n.textNodes.push(new nMe(t,i,n.styles));else if(cm(i))if(Ite(i)&&i.assignedNodes)i.assignedNodes().forEach(function(a){return a0(t,a,n,r)});else{var o=yte(t,i);o.styles.isVisible()&&(dMe(i,o,r)?o.flags|=4:hMe(o.styles)&&(o.flags|=2),uMe.indexOf(i.tagName)!==-1&&(o.flags|=8),n.elements.push(o),i.slot,i.shadowRoot?a0(t,i.shadowRoot,o,r):!IS(i)&&!Tte(i)&&!RS(i)&&a0(t,i,o,r))}},yte=function(t,e){return QU(e)?new fte(t,e):Ste(e)?new pte(t,e):Tte(e)?new mte(t,e):fMe(e)?new gte(t,e):pMe(e)?new FU(t,e):mMe(e)?new nx(t,e):RS(e)?new _te(t,e):IS(e)?new Ete(t,e):bte(e)?new vte(t,e):new XA(t,e)},wte=function(t,e){var n=yte(t,e);return n.flags|=4,a0(t,e,n,n),n},dMe=function(t,e,n){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||rx(t)&&n.styles.isTransparent()},hMe=function(t){return t.isPositioned()||t.isFloating()},Cte=function(t){return t.nodeType===Node.TEXT_NODE},cm=function(t){return t.nodeType===Node.ELEMENT_NODE},VU=function(t){return cm(t)&&typeof t.style<"u"&&!c0(t)},c0=function(t){return typeof t.className=="object"},fMe=function(t){return t.tagName==="LI"},pMe=function(t){return t.tagName==="OL"},mMe=function(t){return t.tagName==="INPUT"},gMe=function(t){return t.tagName==="HTML"},Tte=function(t){return t.tagName==="svg"},rx=function(t){return t.tagName==="BODY"},Ste=function(t){return t.tagName==="CANVAS"},IW=function(t){return t.tagName==="VIDEO"},QU=function(t){return t.tagName==="IMG"},bte=function(t){return t.tagName==="IFRAME"},RW=function(t){return t.tagName==="STYLE"},_Me=function(t){return t.tagName==="SCRIPT"},IS=function(t){return t.tagName==="TEXTAREA"},RS=function(t){return t.tagName==="SELECT"},Ite=function(t){return t.tagName==="SLOT"},OW=function(t){return t.tagName.indexOf("-")>0},EMe=function(){function t(){this.counters={}}return t.prototype.getCounterValue=function(e){var n=this.counters[e];return n&&n.length?n[n.length-1]:1},t.prototype.getCounterValues=function(e){var n=this.counters[e];return n||[]},t.prototype.pop=function(e){var n=this;e.forEach(function(r){return n.counters[r].pop()})},t.prototype.parse=function(e){var n=this,r=e.counterIncrement,i=e.counterReset,s=!0;r!==null&&r.forEach(function(a){var A=n.counters[a.counter];A&&a.increment!==0&&(s=!1,A.length||A.push(1),A[Math.max(0,A.length-1)]+=a.increment)});var o=[];return s&&i.forEach(function(a){var A=n.counters[a.counter];o.push(a.counter),A||(A=n.counters[a.counter]=[]),A.push(a.reset)}),o},t}(),NW={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},DW={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},vMe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},yMe={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Lp=function(t,e,n,r,i,s){return t<e||t>n?Gv(t,i,s.length>0):r.integers.reduce(function(o,a,A){for(;t>=a;)t-=a,o+=r.values[A];return o},"")+s},Rte=function(t,e,n,r){var i="";do n||t--,i=r(t)+i,t/=e;while(t*e>=e);return i},Oi=function(t,e,n,r,i){var s=n-e+1;return(t<0?"-":"")+(Rte(Math.abs(t),s,r,function(o){return Bi(Math.floor(o%s)+e)})+i)},Ch=function(t,e,n){n===void 0&&(n=". ");var r=e.length;return Rte(Math.abs(t),r,!1,function(i){return e[Math.floor(i%r)]})+n},zp=1,Qu=2,Hu=4,wE=8,Tl=function(t,e,n,r,i,s){if(t<-9999||t>9999)return Gv(t,4,i.length>0);var o=Math.abs(t),a=i;if(o===0)return e[0]+a;for(var A=0;o>0&&A<=4;A++){var u=o%10;u===0&&ss(s,zp)&&a!==""?a=e[u]+a:u>1||u===1&&A===0||u===1&&A===1&&ss(s,Qu)||u===1&&A===1&&ss(s,Hu)&&t>100||u===1&&A>1&&ss(s,wE)?a=e[u]+(A>0?n[A-1]:"")+a:u===1&&A>0&&(a=n[A-1]+a),o=Math.floor(o/10)}return(t<0?r:"")+a},BW="",LW="",UW="",uB="",Gv=function(t,e,n){var r=n?". ":"",i=n?"":"",s=n?", ":"",o=n?" ":"";switch(e){case 0:return""+o;case 1:return""+o;case 2:return""+o;case 5:var a=Oi(t,48,57,!0,r);return a.length<4?"0"+a:a;case 4:return Ch(t,"",i);case 6:return Lp(t,1,3999,NW,3,r).toLowerCase();case 7:return Lp(t,1,3999,NW,3,r);case 8:return Oi(t,945,969,!1,r);case 9:return Oi(t,97,122,!1,r);case 10:return Oi(t,65,90,!1,r);case 11:return Oi(t,1632,1641,!0,r);case 12:case 49:return Lp(t,1,9999,DW,3,r);case 35:return Lp(t,1,9999,DW,3,r).toLowerCase();case 13:return Oi(t,2534,2543,!0,r);case 14:case 30:return Oi(t,6112,6121,!0,r);case 15:return Ch(t,"",i);case 16:return Ch(t,"",i);case 17:case 48:return Tl(t,"",BW,"",i,Qu|Hu|wE);case 47:return Tl(t,"",LW,"",i,zp|Qu|Hu|wE);case 42:return Tl(t,"",BW,"",i,Qu|Hu|wE);case 41:return Tl(t,"",LW,"",i,zp|Qu|Hu|wE);case 26:return Tl(t,"","",UW,i,0);case 25:return Tl(t,"","",UW,i,zp|Qu|Hu);case 31:return Tl(t,"","",uB,s,zp|Qu|Hu);case 33:return Tl(t,"","",uB,s,0);case 32:return Tl(t,"","",uB,s,zp|Qu|Hu);case 18:return Oi(t,2406,2415,!0,r);case 20:return Lp(t,1,19999,yMe,3,r);case 21:return Oi(t,2790,2799,!0,r);case 22:return Oi(t,2662,2671,!0,r);case 22:return Lp(t,1,10999,vMe,3,r);case 23:return Ch(t,"");case 24:return Ch(t,"");case 27:return Oi(t,3302,3311,!0,r);case 28:return Ch(t,"",i);case 29:return Ch(t,"",i);case 34:return Oi(t,3792,3801,!0,r);case 37:return Oi(t,6160,6169,!0,r);case 38:return Oi(t,4160,4169,!0,r);case 39:return Oi(t,2918,2927,!0,r);case 40:return Oi(t,1776,1785,!0,r);case 43:return Oi(t,3046,3055,!0,r);case 44:return Oi(t,3174,3183,!0,r);case 45:return Oi(t,3664,3673,!0,r);case 46:return Oi(t,3872,3881,!0,r);case 3:default:return Oi(t,48,57,!0,r)}},Ote="data-html2canvas-ignore",PW=function(){function t(e,n,r){if(this.context=e,this.options=r,this.scrolledElements=[],this.referenceElement=n,this.counters=new EMe,this.quoteDepth=0,!n.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(n.ownerDocument.documentElement,!1)}return t.prototype.toIFrame=function(e,n){var r=this,i=wMe(e,n);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var s=e.defaultView.pageXOffset,o=e.defaultView.pageYOffset,a=i.contentWindow,A=a.document,u=SMe(i).then(function(){return po(r,void 0,void 0,function(){var d,f;return Js(this,function(m){switch(m.label){case 0:return this.scrolledElements.forEach(OMe),a&&(a.scrollTo(n.left,n.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(a.scrollY!==n.top||a.scrollX!==n.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(a.scrollX-n.left,a.scrollY-n.top,0,0))),d=this.options.onclone,f=this.clonedReferenceElement,typeof f>"u"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:A.fonts&&A.fonts.ready?[4,A.fonts.ready]:[3,2];case 1:m.sent(),m.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,TMe(A)]:[3,4];case 3:m.sent(),m.label=4;case 4:return typeof d=="function"?[2,Promise.resolve().then(function(){return d(A,f)}).then(function(){return i})]:[2,i]}})})});return A.open(),A.write(IMe(document.doctype)+"<html></html>"),RMe(this.referenceElement.ownerDocument,s,o),A.replaceChild(A.adoptNode(this.documentElement),A.documentElement),A.close(),u},t.prototype.createElementClone=function(e){if(xU(e,2))debugger;if(Ste(e))return this.createCanvasClone(e);if(IW(e))return this.createVideoClone(e);if(RW(e))return this.createStyleClone(e);var n=e.cloneNode(!1);return QU(n)&&(QU(e)&&e.currentSrc&&e.currentSrc!==e.src&&(n.src=e.currentSrc,n.srcset=""),n.loading==="lazy"&&(n.loading="eager")),OW(n)?this.createCustomElementClone(n):n},t.prototype.createCustomElementClone=function(e){var n=document.createElement("html2canvascustomelement");return dB(e.style,n),n},t.prototype.createStyleClone=function(e){try{var n=e.sheet;if(n&&n.cssRules){var r=[].slice.call(n.cssRules,0).reduce(function(s,o){return o&&typeof o.cssText=="string"?s+o.cssText:s},""),i=e.cloneNode(!1);return i.textContent=r,i}}catch(s){if(this.context.logger.error("Unable to access cssRules property",s),s.name!=="SecurityError")throw s}return e.cloneNode(!1)},t.prototype.createCanvasClone=function(e){var n;if(this.options.inlineImages&&e.ownerDocument){var r=e.ownerDocument.createElement("img");try{return r.src=e.toDataURL(),r}catch{this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var i=e.cloneNode(!1);try{i.width=e.width,i.height=e.height;var s=e.getContext("2d"),o=i.getContext("2d");if(o)if(!this.options.allowTaint&&s)o.putImageData(s.getImageData(0,0,e.width,e.height),0,0);else{var a=(n=e.getContext("webgl2"))!==null&&n!==void 0?n:e.getContext("webgl");if(a){var A=a.getContextAttributes();(A==null?void 0:A.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}o.drawImage(e,0,0)}return i}catch{this.context.logger.info("Unable to clone canvas as it is tainted",e)}return i},t.prototype.createVideoClone=function(e){var n=e.ownerDocument.createElement("canvas");n.width=e.offsetWidth,n.height=e.offsetHeight;var r=n.getContext("2d");try{return r&&(r.drawImage(e,0,0,n.width,n.height),this.options.allowTaint||r.getImageData(0,0,n.width,n.height)),n}catch{this.context.logger.info("Unable to clone video as it is tainted",e)}var i=e.ownerDocument.createElement("canvas");return i.width=e.offsetWidth,i.height=e.offsetHeight,i},t.prototype.appendChildNode=function(e,n,r){(!cm(n)||!_Me(n)&&!n.hasAttribute(Ote)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(n)))&&(!this.options.copyStyles||!cm(n)||!RW(n))&&e.appendChild(this.cloneNode(n,r))},t.prototype.cloneChildNodes=function(e,n,r){for(var i=this,s=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;s;s=s.nextSibling)if(cm(s)&&Ite(s)&&typeof s.assignedNodes=="function"){var o=s.assignedNodes();o.length&&o.forEach(function(a){return i.appendChildNode(n,a,r)})}else this.appendChildNode(n,s,r)},t.prototype.cloneNode=function(e,n){if(Cte(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var r=e.ownerDocument.defaultView;if(r&&cm(e)&&(VU(e)||c0(e))){var i=this.createElementClone(e);i.style.transitionProperty="none";var s=r.getComputedStyle(e),o=r.getComputedStyle(e,":before"),a=r.getComputedStyle(e,":after");this.referenceElement===e&&VU(i)&&(this.clonedReferenceElement=i),rx(i)&&BMe(i);var A=this.counters.parse(new dW(this.context,s)),u=this.resolvePseudoContent(e,i,o,ZE.BEFORE);OW(e)&&(n=!0),IW(e)||this.cloneChildNodes(e,i,n),u&&i.insertBefore(u,i.firstChild);var d=this.resolvePseudoContent(e,i,a,ZE.AFTER);return d&&i.appendChild(d),this.counters.pop(A),(s&&(this.options.copyStyles||c0(e))&&!bte(e)||n)&&dB(s,i),(e.scrollTop!==0||e.scrollLeft!==0)&&this.scrolledElements.push([i,e.scrollLeft,e.scrollTop]),(IS(e)||RS(e))&&(IS(i)||RS(i))&&(i.value=e.value),i}return e.cloneNode(!1)},t.prototype.resolvePseudoContent=function(e,n,r,i){var s=this;if(r){var o=r.content,a=n.ownerDocument;if(!(!a||!o||o==="none"||o==="-moz-alt-content"||r.display==="none")){this.counters.parse(new dW(this.context,r));var A=new fxe(this.context,r),u=a.createElement("html2canvaspseudoelement");dB(r,u),A.content.forEach(function(f){if(f.type===0)u.appendChild(a.createTextNode(f.value));else if(f.type===22){var m=a.createElement("img");m.src=f.value,m.style.opacity="1",u.appendChild(m)}else if(f.type===18){if(f.name==="attr"){var g=f.values.filter(fr);g.length&&u.appendChild(a.createTextNode(e.getAttribute(g[0].value)||""))}else if(f.name==="counter"){var v=f.values.filter(rg),y=v[0],w=v[1];if(y&&fr(y)){var b=s.counters.getCounterValue(y.value),I=w&&fr(w)?kU.parse(s.context,w.value):3;u.appendChild(a.createTextNode(Gv(b,I,!1)))}}else if(f.name==="counters"){var B=f.values.filter(rg),y=B[0],M=B[1],w=B[2];if(y&&fr(y)){var H=s.counters.getCounterValues(y.value),K=w&&fr(w)?kU.parse(s.context,w.value):3,Q=M&&M.type===0?M.value:"",F=H.map(function($){return Gv($,K,!1)}).join(Q);u.appendChild(a.createTextNode(F))}}}else if(f.type===20)switch(f.value){case"open-quote":u.appendChild(a.createTextNode(uW(A.quotes,s.quoteDepth++,!0)));break;case"close-quote":u.appendChild(a.createTextNode(uW(A.quotes,--s.quoteDepth,!1)));break;default:u.appendChild(a.createTextNode(f.value))}}),u.className=HU+" "+jU;var d=i===ZE.BEFORE?" "+HU:" "+jU;return c0(n)?n.className.baseValue+=d:n.className+=d,u}}},t.destroy=function(e){return e.parentNode?(e.parentNode.removeChild(e),!0):!1},t}(),ZE;(function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER"})(ZE||(ZE={}));var wMe=function(t,e){var n=t.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=e.width.toString(),n.height=e.height.toString(),n.scrolling="no",n.setAttribute(Ote,"true"),t.body.appendChild(n),n},CMe=function(t){return new Promise(function(e){if(t.complete){e();return}if(!t.src){e();return}t.onload=e,t.onerror=e})},TMe=function(t){return Promise.all([].slice.call(t.images,0).map(CMe))},SMe=function(t){return new Promise(function(e,n){var r=t.contentWindow;if(!r)return n("No window assigned for iframe");var i=r.document;r.onload=t.onload=function(){r.onload=t.onload=null;var s=setInterval(function(){i.body.childNodes.length>0&&i.readyState==="complete"&&(clearInterval(s),e(t))},50)}})},bMe=["all","d","content"],dB=function(t,e){for(var n=t.length-1;n>=0;n--){var r=t.item(n);bMe.indexOf(r)===-1&&e.style.setProperty(r,t.getPropertyValue(r))}return e},IMe=function(t){var e="";return t&&(e+="<!DOCTYPE ",t.name&&(e+=t.name),t.internalSubset&&(e+=t.internalSubset),t.publicId&&(e+='"'+t.publicId+'"'),t.systemId&&(e+='"'+t.systemId+'"'),e+=">"),e},RMe=function(t,e,n){t&&t.defaultView&&(e!==t.defaultView.pageXOffset||n!==t.defaultView.pageYOffset)&&t.defaultView.scrollTo(e,n)},OMe=function(t){var e=t[0],n=t[1],r=t[2];e.scrollLeft=n,e.scrollTop=r},NMe=":before",DMe=":after",HU="___html2canvas___pseudoelement_before",jU="___html2canvas___pseudoelement_after",kW=`{
    content: "" !important;
    display: none !important;
}`,BMe=function(t){LMe(t,"."+HU+NMe+kW+`
         .`+jU+DMe+kW)},LMe=function(t,e){var n=t.ownerDocument;if(n){var r=n.createElement("style");r.textContent=e,t.appendChild(r)}},Nte=function(){function t(){}return t.getOrigin=function(e){var n=t._link;return n?(n.href=e,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},t.isSameOrigin=function(e){return t.getOrigin(e)===t._origin},t.setContext=function(e){t._link=e.document.createElement("a"),t._origin=t.getOrigin(e.location.href)},t._origin="about:blank",t}(),UMe=function(){function t(e,n){this.context=e,this._options=n,this._cache={}}return t.prototype.addImage=function(e){var n=Promise.resolve();return this.has(e)||(fB(e)||MMe(e))&&(this._cache[e]=this.loadImage(e)).catch(function(){}),n},t.prototype.match=function(e){return this._cache[e]},t.prototype.loadImage=function(e){return po(this,void 0,void 0,function(){var n,r,i,s,o=this;return Js(this,function(a){switch(a.label){case 0:return n=Nte.isSameOrigin(e),r=!hB(e)&&this._options.useCORS===!0&&xs.SUPPORT_CORS_IMAGES&&!n,i=!hB(e)&&!n&&!fB(e)&&typeof this._options.proxy=="string"&&xs.SUPPORT_CORS_XHR&&!r,!n&&this._options.allowTaint===!1&&!hB(e)&&!fB(e)&&!i&&!r?[2]:(s=e,i?[4,this.proxy(s)]:[3,2]);case 1:s=a.sent(),a.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(A,u){var d=new Image;d.onload=function(){return A(d)},d.onerror=u,(FMe(s)||r)&&(d.crossOrigin="anonymous"),d.src=s,d.complete===!0&&setTimeout(function(){return A(d)},500),o._options.imageTimeout>0&&setTimeout(function(){return u("Timed out ("+o._options.imageTimeout+"ms) loading image")},o._options.imageTimeout)})];case 3:return[2,a.sent()]}})})},t.prototype.has=function(e){return typeof this._cache[e]<"u"},t.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},t.prototype.proxy=function(e){var n=this,r=this._options.proxy;if(!r)throw new Error("No proxy defined");var i=e.substring(0,256);return new Promise(function(s,o){var a=xs.SUPPORT_RESPONSE_TYPE?"blob":"text",A=new XMLHttpRequest;A.onload=function(){if(A.status===200)if(a==="text")s(A.response);else{var f=new FileReader;f.addEventListener("load",function(){return s(f.result)},!1),f.addEventListener("error",function(m){return o(m)},!1),f.readAsDataURL(A.response)}else o("Failed to proxy resource "+i+" with status code "+A.status)},A.onerror=o;var u=r.indexOf("?")>-1?"&":"?";if(A.open("GET",""+r+u+"url="+encodeURIComponent(e)+"&responseType="+a),a!=="text"&&A instanceof XMLHttpRequest&&(A.responseType=a),n._options.imageTimeout){var d=n._options.imageTimeout;A.timeout=d,A.ontimeout=function(){return o("Timed out ("+d+"ms) proxying "+i)}}A.send()})},t}(),PMe=/^data:image\/svg\+xml/i,kMe=/^data:image\/.*;base64,/i,xMe=/^data:image\/.*/i,MMe=function(t){return xs.SUPPORT_SVG_DRAWING||!VMe(t)},hB=function(t){return xMe.test(t)},FMe=function(t){return kMe.test(t)},fB=function(t){return t.substr(0,4)==="blob"},VMe=function(t){return t.substr(-3).toLowerCase()==="svg"||PMe.test(t)},Je=function(){function t(e,n){this.type=0,this.x=e,this.y=n}return t.prototype.add=function(e,n){return new t(this.x+e,this.y+n)},t}(),Up=function(t,e,n){return new Je(t.x+(e.x-t.x)*n,t.y+(e.y-t.y)*n)},fT=function(){function t(e,n,r,i){this.type=1,this.start=e,this.startControl=n,this.endControl=r,this.end=i}return t.prototype.subdivide=function(e,n){var r=Up(this.start,this.startControl,e),i=Up(this.startControl,this.endControl,e),s=Up(this.endControl,this.end,e),o=Up(r,i,e),a=Up(i,s,e),A=Up(o,a,e);return n?new t(this.start,r,o,A):new t(A,a,s,this.end)},t.prototype.add=function(e,n){return new t(this.start.add(e,n),this.startControl.add(e,n),this.endControl.add(e,n),this.end.add(e,n))},t.prototype.reverse=function(){return new t(this.end,this.endControl,this.startControl,this.start)},t}(),Za=function(t){return t.type===1},QMe=function(){function t(e){var n=e.styles,r=e.bounds,i=vE(n.borderTopLeftRadius,r.width,r.height),s=i[0],o=i[1],a=vE(n.borderTopRightRadius,r.width,r.height),A=a[0],u=a[1],d=vE(n.borderBottomRightRadius,r.width,r.height),f=d[0],m=d[1],g=vE(n.borderBottomLeftRadius,r.width,r.height),v=g[0],y=g[1],w=[];w.push((s+A)/r.width),w.push((v+f)/r.width),w.push((o+y)/r.height),w.push((u+m)/r.height);var b=Math.max.apply(Math,w);b>1&&(s/=b,o/=b,A/=b,u/=b,f/=b,m/=b,v/=b,y/=b);var I=r.width-A,B=r.height-m,M=r.width-f,H=r.height-y,K=n.borderTopWidth,Q=n.borderRightWidth,F=n.borderBottomWidth,k=n.borderLeftWidth,G=Dr(n.paddingTop,e.bounds.width),$=Dr(n.paddingRight,e.bounds.width),ne=Dr(n.paddingBottom,e.bounds.width),q=Dr(n.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=s>0||o>0?Fr(r.left+k/3,r.top+K/3,s-k/3,o-K/3,Xn.TOP_LEFT):new Je(r.left+k/3,r.top+K/3),this.topRightBorderDoubleOuterBox=s>0||o>0?Fr(r.left+I,r.top+K/3,A-Q/3,u-K/3,Xn.TOP_RIGHT):new Je(r.left+r.width-Q/3,r.top+K/3),this.bottomRightBorderDoubleOuterBox=f>0||m>0?Fr(r.left+M,r.top+B,f-Q/3,m-F/3,Xn.BOTTOM_RIGHT):new Je(r.left+r.width-Q/3,r.top+r.height-F/3),this.bottomLeftBorderDoubleOuterBox=v>0||y>0?Fr(r.left+k/3,r.top+H,v-k/3,y-F/3,Xn.BOTTOM_LEFT):new Je(r.left+k/3,r.top+r.height-F/3),this.topLeftBorderDoubleInnerBox=s>0||o>0?Fr(r.left+k*2/3,r.top+K*2/3,s-k*2/3,o-K*2/3,Xn.TOP_LEFT):new Je(r.left+k*2/3,r.top+K*2/3),this.topRightBorderDoubleInnerBox=s>0||o>0?Fr(r.left+I,r.top+K*2/3,A-Q*2/3,u-K*2/3,Xn.TOP_RIGHT):new Je(r.left+r.width-Q*2/3,r.top+K*2/3),this.bottomRightBorderDoubleInnerBox=f>0||m>0?Fr(r.left+M,r.top+B,f-Q*2/3,m-F*2/3,Xn.BOTTOM_RIGHT):new Je(r.left+r.width-Q*2/3,r.top+r.height-F*2/3),this.bottomLeftBorderDoubleInnerBox=v>0||y>0?Fr(r.left+k*2/3,r.top+H,v-k*2/3,y-F*2/3,Xn.BOTTOM_LEFT):new Je(r.left+k*2/3,r.top+r.height-F*2/3),this.topLeftBorderStroke=s>0||o>0?Fr(r.left+k/2,r.top+K/2,s-k/2,o-K/2,Xn.TOP_LEFT):new Je(r.left+k/2,r.top+K/2),this.topRightBorderStroke=s>0||o>0?Fr(r.left+I,r.top+K/2,A-Q/2,u-K/2,Xn.TOP_RIGHT):new Je(r.left+r.width-Q/2,r.top+K/2),this.bottomRightBorderStroke=f>0||m>0?Fr(r.left+M,r.top+B,f-Q/2,m-F/2,Xn.BOTTOM_RIGHT):new Je(r.left+r.width-Q/2,r.top+r.height-F/2),this.bottomLeftBorderStroke=v>0||y>0?Fr(r.left+k/2,r.top+H,v-k/2,y-F/2,Xn.BOTTOM_LEFT):new Je(r.left+k/2,r.top+r.height-F/2),this.topLeftBorderBox=s>0||o>0?Fr(r.left,r.top,s,o,Xn.TOP_LEFT):new Je(r.left,r.top),this.topRightBorderBox=A>0||u>0?Fr(r.left+I,r.top,A,u,Xn.TOP_RIGHT):new Je(r.left+r.width,r.top),this.bottomRightBorderBox=f>0||m>0?Fr(r.left+M,r.top+B,f,m,Xn.BOTTOM_RIGHT):new Je(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=v>0||y>0?Fr(r.left,r.top+H,v,y,Xn.BOTTOM_LEFT):new Je(r.left,r.top+r.height),this.topLeftPaddingBox=s>0||o>0?Fr(r.left+k,r.top+K,Math.max(0,s-k),Math.max(0,o-K),Xn.TOP_LEFT):new Je(r.left+k,r.top+K),this.topRightPaddingBox=A>0||u>0?Fr(r.left+Math.min(I,r.width-Q),r.top+K,I>r.width+Q?0:Math.max(0,A-Q),Math.max(0,u-K),Xn.TOP_RIGHT):new Je(r.left+r.width-Q,r.top+K),this.bottomRightPaddingBox=f>0||m>0?Fr(r.left+Math.min(M,r.width-k),r.top+Math.min(B,r.height-F),Math.max(0,f-Q),Math.max(0,m-F),Xn.BOTTOM_RIGHT):new Je(r.left+r.width-Q,r.top+r.height-F),this.bottomLeftPaddingBox=v>0||y>0?Fr(r.left+k,r.top+Math.min(H,r.height-F),Math.max(0,v-k),Math.max(0,y-F),Xn.BOTTOM_LEFT):new Je(r.left+k,r.top+r.height-F),this.topLeftContentBox=s>0||o>0?Fr(r.left+k+q,r.top+K+G,Math.max(0,s-(k+q)),Math.max(0,o-(K+G)),Xn.TOP_LEFT):new Je(r.left+k+q,r.top+K+G),this.topRightContentBox=A>0||u>0?Fr(r.left+Math.min(I,r.width+k+q),r.top+K+G,I>r.width+k+q?0:A-k+q,u-(K+G),Xn.TOP_RIGHT):new Je(r.left+r.width-(Q+$),r.top+K+G),this.bottomRightContentBox=f>0||m>0?Fr(r.left+Math.min(M,r.width-(k+q)),r.top+Math.min(B,r.height+K+G),Math.max(0,f-(Q+$)),m-(F+ne),Xn.BOTTOM_RIGHT):new Je(r.left+r.width-(Q+$),r.top+r.height-(F+ne)),this.bottomLeftContentBox=v>0||y>0?Fr(r.left+k+q,r.top+H,Math.max(0,v-(k+q)),y-(F+ne),Xn.BOTTOM_LEFT):new Je(r.left+k+q,r.top+r.height-(F+ne))}return t}(),Xn;(function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",t[t.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(Xn||(Xn={}));var Fr=function(t,e,n,r,i){var s=4*((Math.sqrt(2)-1)/3),o=n*s,a=r*s,A=t+n,u=e+r;switch(i){case Xn.TOP_LEFT:return new fT(new Je(t,u),new Je(t,u-a),new Je(A-o,e),new Je(A,e));case Xn.TOP_RIGHT:return new fT(new Je(t,e),new Je(t+o,e),new Je(A,u-a),new Je(A,u));case Xn.BOTTOM_RIGHT:return new fT(new Je(A,e),new Je(A,e+a),new Je(t+o,u),new Je(t,u));case Xn.BOTTOM_LEFT:default:return new fT(new Je(A,u),new Je(A-o,u),new Je(t,e+a),new Je(t,e))}},OS=function(t){return[t.topLeftBorderBox,t.topRightBorderBox,t.bottomRightBorderBox,t.bottomLeftBorderBox]},HMe=function(t){return[t.topLeftContentBox,t.topRightContentBox,t.bottomRightContentBox,t.bottomLeftContentBox]},NS=function(t){return[t.topLeftPaddingBox,t.topRightPaddingBox,t.bottomRightPaddingBox,t.bottomLeftPaddingBox]},jMe=function(){function t(e,n,r){this.offsetX=e,this.offsetY=n,this.matrix=r,this.type=0,this.target=6}return t}(),pT=function(){function t(e,n){this.path=e,this.target=n,this.type=1}return t}(),KMe=function(){function t(e){this.opacity=e,this.type=2,this.target=6}return t}(),GMe=function(t){return t.type===0},Dte=function(t){return t.type===1},WMe=function(t){return t.type===2},xW=function(t,e){return t.length===e.length?t.some(function(n,r){return n===e[r]}):!1},zMe=function(t,e,n,r,i){return t.map(function(s,o){switch(o){case 0:return s.add(e,n);case 1:return s.add(e+r,n);case 2:return s.add(e+r,n+i);case 3:return s.add(e,n+i)}return s})},Bte=function(){function t(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return t}(),Lte=function(){function t(e,n){if(this.container=e,this.parent=n,this.effects=[],this.curves=new QMe(this.container),this.container.styles.opacity<1&&this.effects.push(new KMe(this.container.styles.opacity)),this.container.styles.transform!==null){var r=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,s=this.container.styles.transform;this.effects.push(new jMe(r,i,s))}if(this.container.styles.overflowX!==0){var o=OS(this.curves),a=NS(this.curves);xW(o,a)?this.effects.push(new pT(o,6)):(this.effects.push(new pT(o,2)),this.effects.push(new pT(a,4)))}}return t.prototype.getEffects=function(e){for(var n=[2,3].indexOf(this.container.styles.position)===-1,r=this.parent,i=this.effects.slice(0);r;){var s=r.effects.filter(function(A){return!Dte(A)});if(n||r.container.styles.position!==0||!r.parent){if(i.unshift.apply(i,s),n=[2,3].indexOf(r.container.styles.position)===-1,r.container.styles.overflowX!==0){var o=OS(r.curves),a=NS(r.curves);xW(o,a)||i.unshift(new pT(a,6))}}else i.unshift.apply(i,s);r=r.parent}return i.filter(function(A){return ss(A.target,e)})},t}(),KU=function(t,e,n,r){t.container.elements.forEach(function(i){var s=ss(i.flags,4),o=ss(i.flags,2),a=new Lte(i,t);ss(i.styles.display,2048)&&r.push(a);var A=ss(i.flags,8)?[]:r;if(s||o){var u=s||i.styles.isPositioned()?n:e,d=new Bte(a);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var f=i.styles.zIndex.order;if(f<0){var m=0;u.negativeZIndex.some(function(v,y){return f>v.element.container.styles.zIndex.order?(m=y,!1):m>0}),u.negativeZIndex.splice(m,0,d)}else if(f>0){var g=0;u.positiveZIndex.some(function(v,y){return f>=v.element.container.styles.zIndex.order?(g=y+1,!1):g>0}),u.positiveZIndex.splice(g,0,d)}else u.zeroOrAutoZIndexOrTransformedOrOpacity.push(d)}else i.styles.isFloating()?u.nonPositionedFloats.push(d):u.nonPositionedInlineLevel.push(d);KU(a,d,s?d:n,A)}else i.styles.isInlineLevel()?e.inlineLevel.push(a):e.nonInlineLevel.push(a),KU(a,e,n,A);ss(i.flags,8)&&Ute(i,A)})},Ute=function(t,e){for(var n=t instanceof FU?t.start:1,r=t instanceof FU?t.reversed:!1,i=0;i<e.length;i++){var s=e[i];s.container instanceof gte&&typeof s.container.value=="number"&&s.container.value!==0&&(n=s.container.value),s.listValue=Gv(n,s.container.styles.listStyleType,!0),n+=r?-1:1}},qMe=function(t){var e=new Lte(t,null),n=new Bte(e),r=[];return KU(e,n,n,r),Ute(e.container,r),n},MW=function(t,e){switch(e){case 0:return cc(t.topLeftBorderBox,t.topLeftPaddingBox,t.topRightBorderBox,t.topRightPaddingBox);case 1:return cc(t.topRightBorderBox,t.topRightPaddingBox,t.bottomRightBorderBox,t.bottomRightPaddingBox);case 2:return cc(t.bottomRightBorderBox,t.bottomRightPaddingBox,t.bottomLeftBorderBox,t.bottomLeftPaddingBox);case 3:default:return cc(t.bottomLeftBorderBox,t.bottomLeftPaddingBox,t.topLeftBorderBox,t.topLeftPaddingBox)}},YMe=function(t,e){switch(e){case 0:return cc(t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox,t.topRightBorderBox,t.topRightBorderDoubleOuterBox);case 1:return cc(t.topRightBorderBox,t.topRightBorderDoubleOuterBox,t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox);case 2:return cc(t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox,t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox);case 3:default:return cc(t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox,t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox)}},XMe=function(t,e){switch(e){case 0:return cc(t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox,t.topRightBorderDoubleInnerBox,t.topRightPaddingBox);case 1:return cc(t.topRightBorderDoubleInnerBox,t.topRightPaddingBox,t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox);case 2:return cc(t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox,t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox);case 3:default:return cc(t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox,t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox)}},JMe=function(t,e){switch(e){case 0:return mT(t.topLeftBorderStroke,t.topRightBorderStroke);case 1:return mT(t.topRightBorderStroke,t.bottomRightBorderStroke);case 2:return mT(t.bottomRightBorderStroke,t.bottomLeftBorderStroke);case 3:default:return mT(t.bottomLeftBorderStroke,t.topLeftBorderStroke)}},mT=function(t,e){var n=[];return Za(t)?n.push(t.subdivide(.5,!1)):n.push(t),Za(e)?n.push(e.subdivide(.5,!0)):n.push(e),n},cc=function(t,e,n,r){var i=[];return Za(t)?i.push(t.subdivide(.5,!1)):i.push(t),Za(n)?i.push(n.subdivide(.5,!0)):i.push(n),Za(r)?i.push(r.subdivide(.5,!0).reverse()):i.push(r),Za(e)?i.push(e.subdivide(.5,!1).reverse()):i.push(e),i},Pte=function(t){var e=t.bounds,n=t.styles;return e.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},DS=function(t){var e=t.styles,n=t.bounds,r=Dr(e.paddingLeft,n.width),i=Dr(e.paddingRight,n.width),s=Dr(e.paddingTop,n.width),o=Dr(e.paddingBottom,n.width);return n.add(r+e.borderLeftWidth,s+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+i),-(e.borderTopWidth+e.borderBottomWidth+s+o))},$Me=function(t,e){return t===0?e.bounds:t===2?DS(e):Pte(e)},ZMe=function(t,e){return t===0?e.bounds:t===2?DS(e):Pte(e)},pB=function(t,e,n){var r=$Me(qp(t.styles.backgroundOrigin,e),t),i=ZMe(qp(t.styles.backgroundClip,e),t),s=e2e(qp(t.styles.backgroundSize,e),n,r),o=s[0],a=s[1],A=vE(qp(t.styles.backgroundPosition,e),r.width-o,r.height-a),u=t2e(qp(t.styles.backgroundRepeat,e),A,s,r,i),d=Math.round(r.left+A[0]),f=Math.round(r.top+A[1]);return[u,d,f,o,a]},Pp=function(t){return fr(t)&&t.value===Im.AUTO},gT=function(t){return typeof t=="number"},e2e=function(t,e,n){var r=e[0],i=e[1],s=e[2],o=t[0],a=t[1];if(!o)return[0,0];if(Ki(o)&&a&&Ki(a))return[Dr(o,n.width),Dr(a,n.height)];var A=gT(s);if(fr(o)&&(o.value===Im.CONTAIN||o.value===Im.COVER)){if(gT(s)){var u=n.width/n.height;return u<s!=(o.value===Im.COVER)?[n.width,n.width/s]:[n.height*s,n.height]}return[n.width,n.height]}var d=gT(r),f=gT(i),m=d||f;if(Pp(o)&&(!a||Pp(a))){if(d&&f)return[r,i];if(!A&&!m)return[n.width,n.height];if(m&&A){var g=d?r:i*s,v=f?i:r/s;return[g,v]}var y=d?r:n.width,w=f?i:n.height;return[y,w]}if(A){var b=0,I=0;return Ki(o)?b=Dr(o,n.width):Ki(a)&&(I=Dr(a,n.height)),Pp(o)?b=I*s:(!a||Pp(a))&&(I=b/s),[b,I]}var B=null,M=null;if(Ki(o)?B=Dr(o,n.width):a&&Ki(a)&&(M=Dr(a,n.height)),B!==null&&(!a||Pp(a))&&(M=d&&f?B/r*i:n.height),M!==null&&Pp(o)&&(B=d&&f?M/i*r:n.width),B!==null&&M!==null)return[B,M];throw new Error("Unable to calculate background-size for element")},qp=function(t,e){var n=t[e];return typeof n>"u"?t[0]:n},t2e=function(t,e,n,r,i){var s=e[0],o=e[1],a=n[0],A=n[1];switch(t){case 2:return[new Je(Math.round(r.left),Math.round(r.top+o)),new Je(Math.round(r.left+r.width),Math.round(r.top+o)),new Je(Math.round(r.left+r.width),Math.round(A+r.top+o)),new Je(Math.round(r.left),Math.round(A+r.top+o))];case 3:return[new Je(Math.round(r.left+s),Math.round(r.top)),new Je(Math.round(r.left+s+a),Math.round(r.top)),new Je(Math.round(r.left+s+a),Math.round(r.height+r.top)),new Je(Math.round(r.left+s),Math.round(r.height+r.top))];case 1:return[new Je(Math.round(r.left+s),Math.round(r.top+o)),new Je(Math.round(r.left+s+a),Math.round(r.top+o)),new Je(Math.round(r.left+s+a),Math.round(r.top+o+A)),new Je(Math.round(r.left+s),Math.round(r.top+o+A))];default:return[new Je(Math.round(i.left),Math.round(i.top)),new Je(Math.round(i.left+i.width),Math.round(i.top)),new Je(Math.round(i.left+i.width),Math.round(i.height+i.top)),new Je(Math.round(i.left),Math.round(i.height+i.top))]}},n2e="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",FW="Hidden Text",r2e=function(){function t(e){this._data={},this._document=e}return t.prototype.parseMetrics=function(e,n){var r=this._document.createElement("div"),i=this._document.createElement("img"),s=this._document.createElement("span"),o=this._document.body;r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=n,r.style.margin="0",r.style.padding="0",r.style.whiteSpace="nowrap",o.appendChild(r),i.src=n2e,i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",s.style.fontFamily=e,s.style.fontSize=n,s.style.margin="0",s.style.padding="0",s.appendChild(this._document.createTextNode(FW)),r.appendChild(s),r.appendChild(i);var a=i.offsetTop-s.offsetTop+2;r.removeChild(s),r.appendChild(this._document.createTextNode(FW)),r.style.lineHeight="normal",i.style.verticalAlign="super";var A=i.offsetTop-r.offsetTop+2;return o.removeChild(r),{baseline:a,middle:A}},t.prototype.getMetrics=function(e,n){var r=e+" "+n;return typeof this._data[r]>"u"&&(this._data[r]=this.parseMetrics(e,n)),this._data[r]},t}(),kte=function(){function t(e,n){this.context=e,this.options=n}return t}(),i2e=1e4,s2e=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i._activeEffects=[],i.canvas=r.canvas?r.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),r.canvas||(i.canvas.width=Math.floor(r.width*r.scale),i.canvas.height=Math.floor(r.height*r.scale),i.canvas.style.width=r.width+"px",i.canvas.style.height=r.height+"px"),i.fontMetrics=new r2e(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-r.x,-r.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+r.width+"x"+r.height+") with scale "+r.scale),i}return e.prototype.applyEffects=function(n){for(var r=this;this._activeEffects.length;)this.popEffect();n.forEach(function(i){return r.applyEffect(i)})},e.prototype.applyEffect=function(n){this.ctx.save(),WMe(n)&&(this.ctx.globalAlpha=n.opacity),GMe(n)&&(this.ctx.translate(n.offsetX,n.offsetY),this.ctx.transform(n.matrix[0],n.matrix[1],n.matrix[2],n.matrix[3],n.matrix[4],n.matrix[5]),this.ctx.translate(-n.offsetX,-n.offsetY)),Dte(n)&&(this.path(n.path),this.ctx.clip()),this._activeEffects.push(n)},e.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},e.prototype.renderStack=function(n){return po(this,void 0,void 0,function(){var r;return Js(this,function(i){switch(i.label){case 0:return r=n.element.container.styles,r.isVisible()?[4,this.renderStackContent(n)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.renderNode=function(n){return po(this,void 0,void 0,function(){return Js(this,function(r){switch(r.label){case 0:if(ss(n.container.flags,16))debugger;return n.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(n)]:[3,3];case 1:return r.sent(),[4,this.renderNodeContent(n)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.renderTextWithLetterSpacing=function(n,r,i){var s=this;if(r===0)this.ctx.fillText(n.text,n.bounds.left,n.bounds.top+i);else{var o=tx(n.text);o.reduce(function(a,A){return s.ctx.fillText(A,a,n.bounds.top+i),a+s.ctx.measureText(A).width},n.bounds.left)}},e.prototype.createFontStyle=function(n){var r=n.fontVariant.filter(function(o){return o==="normal"||o==="small-caps"}).join(""),i=l2e(n.fontFamily).join(", "),s=Ry(n.fontSize)?""+n.fontSize.number+n.fontSize.unit:n.fontSize.number+"px";return[[n.fontStyle,r,n.fontWeight,s,i].join(" "),i,s]},e.prototype.renderTextNode=function(n,r){return po(this,void 0,void 0,function(){var i,s,o,a,A,u,d,f,m=this;return Js(this,function(g){return i=this.createFontStyle(r),s=i[0],o=i[1],a=i[2],this.ctx.font=s,this.ctx.direction=r.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",A=this.fontMetrics.getMetrics(o,a),u=A.baseline,d=A.middle,f=r.paintOrder,n.textBounds.forEach(function(v){f.forEach(function(y){switch(y){case 0:m.ctx.fillStyle=ms(r.color),m.renderTextWithLetterSpacing(v,r.letterSpacing,u);var w=r.textShadow;w.length&&v.text.trim().length&&(w.slice(0).reverse().forEach(function(b){m.ctx.shadowColor=ms(b.color),m.ctx.shadowOffsetX=b.offsetX.number*m.options.scale,m.ctx.shadowOffsetY=b.offsetY.number*m.options.scale,m.ctx.shadowBlur=b.blur.number,m.renderTextWithLetterSpacing(v,r.letterSpacing,u)}),m.ctx.shadowColor="",m.ctx.shadowOffsetX=0,m.ctx.shadowOffsetY=0,m.ctx.shadowBlur=0),r.textDecorationLine.length&&(m.ctx.fillStyle=ms(r.textDecorationColor||r.color),r.textDecorationLine.forEach(function(b){switch(b){case 1:m.ctx.fillRect(v.bounds.left,Math.round(v.bounds.top+u),v.bounds.width,1);break;case 2:m.ctx.fillRect(v.bounds.left,Math.round(v.bounds.top),v.bounds.width,1);break;case 3:m.ctx.fillRect(v.bounds.left,Math.ceil(v.bounds.top+d),v.bounds.width,1);break}}));break;case 1:r.webkitTextStrokeWidth&&v.text.trim().length&&(m.ctx.strokeStyle=ms(r.webkitTextStrokeColor),m.ctx.lineWidth=r.webkitTextStrokeWidth,m.ctx.lineJoin=window.chrome?"miter":"round",m.ctx.strokeText(v.text,v.bounds.left,v.bounds.top+u)),m.ctx.strokeStyle="",m.ctx.lineWidth=0,m.ctx.lineJoin="miter";break}})}),[2]})})},e.prototype.renderReplacedElement=function(n,r,i){if(i&&n.intrinsicWidth>0&&n.intrinsicHeight>0){var s=DS(n),o=NS(r);this.path(o),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(i,0,0,n.intrinsicWidth,n.intrinsicHeight,s.left,s.top,s.width,s.height),this.ctx.restore()}},e.prototype.renderNodeContent=function(n){return po(this,void 0,void 0,function(){var r,i,s,o,a,A,I,I,u,d,f,m,M,g,v,H,y,w,b,I,B,M,H;return Js(this,function(K){switch(K.label){case 0:this.applyEffects(n.getEffects(4)),r=n.container,i=n.curves,s=r.styles,o=0,a=r.textNodes,K.label=1;case 1:return o<a.length?(A=a[o],[4,this.renderTextNode(A,s)]):[3,4];case 2:K.sent(),K.label=3;case 3:return o++,[3,1];case 4:if(!(r instanceof fte))return[3,8];K.label=5;case 5:return K.trys.push([5,7,,8]),[4,this.context.cache.match(r.src)];case 6:return I=K.sent(),this.renderReplacedElement(r,i,I),[3,8];case 7:return K.sent(),this.context.logger.error("Error loading image "+r.src),[3,8];case 8:if(r instanceof pte&&this.renderReplacedElement(r,i,r.canvas),!(r instanceof mte))return[3,12];K.label=9;case 9:return K.trys.push([9,11,,12]),[4,this.context.cache.match(r.svg)];case 10:return I=K.sent(),this.renderReplacedElement(r,i,I),[3,12];case 11:return K.sent(),this.context.logger.error("Error loading svg "+r.svg.substring(0,255)),[3,12];case 12:return r instanceof vte&&r.tree?(u=new e(this.context,{scale:this.options.scale,backgroundColor:r.backgroundColor,x:0,y:0,width:r.width,height:r.height}),[4,u.render(r.tree)]):[3,14];case 13:d=K.sent(),r.width&&r.height&&this.ctx.drawImage(d,0,0,r.width,r.height,r.bounds.left,r.bounds.top,r.bounds.width,r.bounds.height),K.label=14;case 14:if(r instanceof nx&&(f=Math.min(r.bounds.width,r.bounds.height),r.type===SS?r.checked&&(this.ctx.save(),this.path([new Je(r.bounds.left+f*.39363,r.bounds.top+f*.79),new Je(r.bounds.left+f*.16,r.bounds.top+f*.5549),new Je(r.bounds.left+f*.27347,r.bounds.top+f*.44071),new Je(r.bounds.left+f*.39694,r.bounds.top+f*.5649),new Je(r.bounds.left+f*.72983,r.bounds.top+f*.23),new Je(r.bounds.left+f*.84,r.bounds.top+f*.34085),new Je(r.bounds.left+f*.39363,r.bounds.top+f*.79)]),this.ctx.fillStyle=ms(bW),this.ctx.fill(),this.ctx.restore()):r.type===bS&&r.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.bounds.left+f/2,r.bounds.top+f/2,f/4,0,Math.PI*2,!0),this.ctx.fillStyle=ms(bW),this.ctx.fill(),this.ctx.restore())),o2e(r)&&r.value.length){switch(m=this.createFontStyle(s),M=m[0],g=m[1],v=this.fontMetrics.getMetrics(M,g).baseline,this.ctx.font=M,this.ctx.fillStyle=ms(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=c2e(r.styles.textAlign),H=DS(r),y=0,r.styles.textAlign){case 1:y+=H.width/2;break;case 2:y+=H.width;break}w=H.add(y,0,0,-H.height/2+1),this.ctx.save(),this.path([new Je(H.left,H.top),new Je(H.left+H.width,H.top),new Je(H.left+H.width,H.top+H.height),new Je(H.left,H.top+H.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new $E(r.value,w),s.letterSpacing,v),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!ss(r.styles.display,2048))return[3,20];if(r.styles.listStyleImage===null)return[3,19];if(b=r.styles.listStyleImage,b.type!==0)return[3,18];I=void 0,B=b.url,K.label=15;case 15:return K.trys.push([15,17,,18]),[4,this.context.cache.match(B)];case 16:return I=K.sent(),this.ctx.drawImage(I,r.bounds.left-(I.width+10),r.bounds.top),[3,18];case 17:return K.sent(),this.context.logger.error("Error loading list-style-image "+B),[3,18];case 18:return[3,20];case 19:n.listValue&&r.styles.listStyleType!==-1&&(M=this.createFontStyle(s)[0],this.ctx.font=M,this.ctx.fillStyle=ms(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",H=new $l(r.bounds.left,r.bounds.top+Dr(r.styles.paddingTop,r.bounds.width),r.bounds.width,AW(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new $E(n.listValue,H),s.letterSpacing,AW(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),K.label=20;case 20:return[2]}})})},e.prototype.renderStackContent=function(n){return po(this,void 0,void 0,function(){var r,i,b,s,o,b,a,A,b,u,d,b,f,m,b,g,v,b,y,w,b;return Js(this,function(I){switch(I.label){case 0:if(ss(n.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(n.element)];case 1:I.sent(),r=0,i=n.negativeZIndex,I.label=2;case 2:return r<i.length?(b=i[r],[4,this.renderStack(b)]):[3,5];case 3:I.sent(),I.label=4;case 4:return r++,[3,2];case 5:return[4,this.renderNodeContent(n.element)];case 6:I.sent(),s=0,o=n.nonInlineLevel,I.label=7;case 7:return s<o.length?(b=o[s],[4,this.renderNode(b)]):[3,10];case 8:I.sent(),I.label=9;case 9:return s++,[3,7];case 10:a=0,A=n.nonPositionedFloats,I.label=11;case 11:return a<A.length?(b=A[a],[4,this.renderStack(b)]):[3,14];case 12:I.sent(),I.label=13;case 13:return a++,[3,11];case 14:u=0,d=n.nonPositionedInlineLevel,I.label=15;case 15:return u<d.length?(b=d[u],[4,this.renderStack(b)]):[3,18];case 16:I.sent(),I.label=17;case 17:return u++,[3,15];case 18:f=0,m=n.inlineLevel,I.label=19;case 19:return f<m.length?(b=m[f],[4,this.renderNode(b)]):[3,22];case 20:I.sent(),I.label=21;case 21:return f++,[3,19];case 22:g=0,v=n.zeroOrAutoZIndexOrTransformedOrOpacity,I.label=23;case 23:return g<v.length?(b=v[g],[4,this.renderStack(b)]):[3,26];case 24:I.sent(),I.label=25;case 25:return g++,[3,23];case 26:y=0,w=n.positiveZIndex,I.label=27;case 27:return y<w.length?(b=w[y],[4,this.renderStack(b)]):[3,30];case 28:I.sent(),I.label=29;case 29:return y++,[3,27];case 30:return[2]}})})},e.prototype.mask=function(n){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(n.slice(0).reverse()),this.ctx.closePath()},e.prototype.path=function(n){this.ctx.beginPath(),this.formatPath(n),this.ctx.closePath()},e.prototype.formatPath=function(n){var r=this;n.forEach(function(i,s){var o=Za(i)?i.start:i;s===0?r.ctx.moveTo(o.x,o.y):r.ctx.lineTo(o.x,o.y),Za(i)&&r.ctx.bezierCurveTo(i.startControl.x,i.startControl.y,i.endControl.x,i.endControl.y,i.end.x,i.end.y)})},e.prototype.renderRepeat=function(n,r,i,s){this.path(n),this.ctx.fillStyle=r,this.ctx.translate(i,s),this.ctx.fill(),this.ctx.translate(-i,-s)},e.prototype.resizeImage=function(n,r,i){var s;if(n.width===r&&n.height===i)return n;var o=(s=this.canvas.ownerDocument)!==null&&s!==void 0?s:document,a=o.createElement("canvas");a.width=Math.max(1,r),a.height=Math.max(1,i);var A=a.getContext("2d");return A.drawImage(n,0,0,n.width,n.height,0,0,r,i),a},e.prototype.renderBackgroundImage=function(n){return po(this,void 0,void 0,function(){var r,i,s,o,a,A;return Js(this,function(u){switch(u.label){case 0:r=n.styles.backgroundImage.length-1,i=function(d){var f,m,g,G,de,J,q,qe,F,v,G,de,J,q,qe,y,w,b,I,B,M,H,K,Q,F,k,G,$,ne,q,qe,je,de,J,Y,Z,P,C,D,U,ee,Ee;return Js(this,function(Re){switch(Re.label){case 0:if(d.type!==0)return[3,5];f=void 0,m=d.url,Re.label=1;case 1:return Re.trys.push([1,3,,4]),[4,s.context.cache.match(m)];case 2:return f=Re.sent(),[3,4];case 3:return Re.sent(),s.context.logger.error("Error loading background-image "+m),[3,4];case 4:return f&&(g=pB(n,r,[f.width,f.height,f.width/f.height]),G=g[0],de=g[1],J=g[2],q=g[3],qe=g[4],F=s.ctx.createPattern(s.resizeImage(f,q,qe),"repeat"),s.renderRepeat(G,F,de,J)),[3,6];case 5:GPe(d)?(v=pB(n,r,[null,null,null]),G=v[0],de=v[1],J=v[2],q=v[3],qe=v[4],y=VPe(d.angle,q,qe),w=y[0],b=y[1],I=y[2],B=y[3],M=y[4],H=document.createElement("canvas"),H.width=q,H.height=qe,K=H.getContext("2d"),Q=K.createLinearGradient(b,B,I,M),aW(d.stops,w).forEach(function(lt){return Q.addColorStop(lt.stop,ms(lt.color))}),K.fillStyle=Q,K.fillRect(0,0,q,qe),q>0&&qe>0&&(F=s.ctx.createPattern(H,"repeat"),s.renderRepeat(G,F,de,J))):WPe(d)&&(k=pB(n,r,[null,null,null]),G=k[0],$=k[1],ne=k[2],q=k[3],qe=k[4],je=d.position.length===0?[$k]:d.position,de=Dr(je[0],q),J=Dr(je[je.length-1],qe),Y=QPe(d,de,J,q,qe),Z=Y[0],P=Y[1],Z>0&&P>0&&(C=s.ctx.createRadialGradient($+de,ne+J,0,$+de,ne+J,Z),aW(d.stops,Z*2).forEach(function(lt){return C.addColorStop(lt.stop,ms(lt.color))}),s.path(G),s.ctx.fillStyle=C,Z!==P?(D=n.bounds.left+.5*n.bounds.width,U=n.bounds.top+.5*n.bounds.height,ee=P/Z,Ee=1/ee,s.ctx.save(),s.ctx.translate(D,U),s.ctx.transform(1,0,0,ee,0,0),s.ctx.translate(-D,-U),s.ctx.fillRect($,Ee*(ne-U)+U,q,qe*Ee),s.ctx.restore()):s.ctx.fill())),Re.label=6;case 6:return r--,[2]}})},s=this,o=0,a=n.styles.backgroundImage.slice(0).reverse(),u.label=1;case 1:return o<a.length?(A=a[o],[5,i(A)]):[3,4];case 2:u.sent(),u.label=3;case 3:return o++,[3,1];case 4:return[2]}})})},e.prototype.renderSolidBorder=function(n,r,i){return po(this,void 0,void 0,function(){return Js(this,function(s){return this.path(MW(i,r)),this.ctx.fillStyle=ms(n),this.ctx.fill(),[2]})})},e.prototype.renderDoubleBorder=function(n,r,i,s){return po(this,void 0,void 0,function(){var o,a;return Js(this,function(A){switch(A.label){case 0:return r<3?[4,this.renderSolidBorder(n,i,s)]:[3,2];case 1:return A.sent(),[2];case 2:return o=YMe(s,i),this.path(o),this.ctx.fillStyle=ms(n),this.ctx.fill(),a=XMe(s,i),this.path(a),this.ctx.fill(),[2]}})})},e.prototype.renderNodeBackgroundAndBorders=function(n){return po(this,void 0,void 0,function(){var r,i,s,o,a,A,u,d,f=this;return Js(this,function(m){switch(m.label){case 0:return this.applyEffects(n.getEffects(2)),r=n.container.styles,i=!Cd(r.backgroundColor)||r.backgroundImage.length,s=[{style:r.borderTopStyle,color:r.borderTopColor,width:r.borderTopWidth},{style:r.borderRightStyle,color:r.borderRightColor,width:r.borderRightWidth},{style:r.borderBottomStyle,color:r.borderBottomColor,width:r.borderBottomWidth},{style:r.borderLeftStyle,color:r.borderLeftColor,width:r.borderLeftWidth}],o=a2e(qp(r.backgroundClip,0),n.curves),i||r.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),Cd(r.backgroundColor)||(this.ctx.fillStyle=ms(r.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(n.container)]):[3,2];case 1:m.sent(),this.ctx.restore(),r.boxShadow.slice(0).reverse().forEach(function(g){f.ctx.save();var v=OS(n.curves),y=g.inset?0:i2e,w=zMe(v,-y+(g.inset?1:-1)*g.spread.number,(g.inset?1:-1)*g.spread.number,g.spread.number*(g.inset?-2:2),g.spread.number*(g.inset?-2:2));g.inset?(f.path(v),f.ctx.clip(),f.mask(w)):(f.mask(v),f.ctx.clip(),f.path(w)),f.ctx.shadowOffsetX=g.offsetX.number+y,f.ctx.shadowOffsetY=g.offsetY.number,f.ctx.shadowColor=ms(g.color),f.ctx.shadowBlur=g.blur.number,f.ctx.fillStyle=g.inset?ms(g.color):"rgba(0,0,0,1)",f.ctx.fill(),f.ctx.restore()}),m.label=2;case 2:a=0,A=0,u=s,m.label=3;case 3:return A<u.length?(d=u[A],d.style!==0&&!Cd(d.color)&&d.width>0?d.style!==2?[3,5]:[4,this.renderDashedDottedBorder(d.color,d.width,a,n.curves,2)]:[3,11]):[3,13];case 4:return m.sent(),[3,11];case 5:return d.style!==3?[3,7]:[4,this.renderDashedDottedBorder(d.color,d.width,a,n.curves,3)];case 6:return m.sent(),[3,11];case 7:return d.style!==4?[3,9]:[4,this.renderDoubleBorder(d.color,d.width,a,n.curves)];case 8:return m.sent(),[3,11];case 9:return[4,this.renderSolidBorder(d.color,a,n.curves)];case 10:m.sent(),m.label=11;case 11:a++,m.label=12;case 12:return A++,[3,3];case 13:return[2]}})})},e.prototype.renderDashedDottedBorder=function(n,r,i,s,o){return po(this,void 0,void 0,function(){var a,A,u,d,f,m,g,v,y,w,b,I,B,M,H,K,H,K;return Js(this,function(Q){return this.ctx.save(),a=JMe(s,i),A=MW(s,i),o===2&&(this.path(A),this.ctx.clip()),Za(A[0])?(u=A[0].start.x,d=A[0].start.y):(u=A[0].x,d=A[0].y),Za(A[1])?(f=A[1].end.x,m=A[1].end.y):(f=A[1].x,m=A[1].y),i===0||i===2?g=Math.abs(u-f):g=Math.abs(d-m),this.ctx.beginPath(),o===3?this.formatPath(a):this.formatPath(A.slice(0,2)),v=r<3?r*3:r*2,y=r<3?r*2:r,o===3&&(v=r,y=r),w=!0,g<=v*2?w=!1:g<=v*2+y?(b=g/(2*v+y),v*=b,y*=b):(I=Math.floor((g+y)/(v+y)),B=(g-I*v)/(I-1),M=(g-(I+1)*v)/I,y=M<=0||Math.abs(y-B)<Math.abs(y-M)?B:M),w&&(o===3?this.ctx.setLineDash([0,v+y]):this.ctx.setLineDash([v,y])),o===3?(this.ctx.lineCap="round",this.ctx.lineWidth=r):this.ctx.lineWidth=r*2+1.1,this.ctx.strokeStyle=ms(n),this.ctx.stroke(),this.ctx.setLineDash([]),o===2&&(Za(A[0])&&(H=A[3],K=A[0],this.ctx.beginPath(),this.formatPath([new Je(H.end.x,H.end.y),new Je(K.start.x,K.start.y)]),this.ctx.stroke()),Za(A[1])&&(H=A[1],K=A[2],this.ctx.beginPath(),this.formatPath([new Je(H.end.x,H.end.y),new Je(K.start.x,K.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},e.prototype.render=function(n){return po(this,void 0,void 0,function(){var r;return Js(this,function(i){switch(i.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ms(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),r=qMe(n),[4,this.renderStack(r)];case 1:return i.sent(),this.applyEffects([]),[2,this.canvas]}})})},e}(kte),o2e=function(t){return t instanceof Ete||t instanceof _te?!0:t instanceof nx&&t.type!==bS&&t.type!==SS},a2e=function(t,e){switch(t){case 0:return OS(e);case 2:return HMe(e);case 1:default:return NS(e)}},c2e=function(t){switch(t){case 1:return"center";case 2:return"right";case 0:default:return"left"}},A2e=["-apple-system","system-ui"],l2e=function(t){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?t.filter(function(e){return A2e.indexOf(e)===-1}):t},u2e=function(t){Zc(e,t);function e(n,r){var i=t.call(this,n,r)||this;return i.canvas=r.canvas?r.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=r,i.canvas.width=Math.floor(r.width*r.scale),i.canvas.height=Math.floor(r.height*r.scale),i.canvas.style.width=r.width+"px",i.canvas.style.height=r.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-r.x,-r.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+r.width+"x"+r.height+" at "+r.x+","+r.y+") with scale "+r.scale),i}return e.prototype.render=function(n){return po(this,void 0,void 0,function(){var r,i;return Js(this,function(s){switch(s.label){case 0:return r=MU(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,n),[4,d2e(r)];case 1:return i=s.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ms(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(i,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},e}(kte),d2e=function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){e(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(t))})},h2e=function(){function t(e){var n=e.id,r=e.enabled;this.id=n,this.enabled=r,this.start=Date.now()}return t.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&(typeof window<"u"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,YC([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},t.prototype.getTime=function(){return Date.now()-this.start},t.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&typeof window<"u"&&window.console&&typeof console.info=="function"&&console.info.apply(console,YC([this.id,this.getTime()+"ms"],e))},t.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&(typeof window<"u"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,YC([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},t.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.enabled&&(typeof window<"u"&&window.console&&typeof console.error=="function"?console.error.apply(console,YC([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},t.instances={},t}(),f2e=function(){function t(e,n){var r;this.windowBounds=n,this.instanceName="#"+t.instanceCount++,this.logger=new h2e({id:this.instanceName,enabled:e.logging}),this.cache=(r=e.cache)!==null&&r!==void 0?r:new UMe(this,e)}return t.instanceCount=1,t}(),VW=function(t,e){return e===void 0&&(e={}),p2e(t,e)};typeof window<"u"&&Nte.setContext(window);var p2e=function(t,e){return po(void 0,void 0,void 0,function(){var n,r,i,s,o,a,A,u,d,f,m,g,v,y,w,b,I,B,M,H,Q,K,Q,F,k,G,$,ne,q,qe,je,de,J,Y,Z,P,C,D,U,ee;return Js(this,function(Ee){switch(Ee.label){case 0:if(!t||typeof t!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(n=t.ownerDocument,!n)throw new Error("Element is not attached to a Document");if(r=n.defaultView,!r)throw new Error("Document is not attached to a Window");return i={allowTaint:(F=e.allowTaint)!==null&&F!==void 0?F:!1,imageTimeout:(k=e.imageTimeout)!==null&&k!==void 0?k:15e3,proxy:e.proxy,useCORS:(G=e.useCORS)!==null&&G!==void 0?G:!1},s=CU({logging:($=e.logging)!==null&&$!==void 0?$:!0,cache:e.cache},i),o={windowWidth:(ne=e.windowWidth)!==null&&ne!==void 0?ne:r.innerWidth,windowHeight:(q=e.windowHeight)!==null&&q!==void 0?q:r.innerHeight,scrollX:(qe=e.scrollX)!==null&&qe!==void 0?qe:r.pageXOffset,scrollY:(je=e.scrollY)!==null&&je!==void 0?je:r.pageYOffset},a=new $l(o.scrollX,o.scrollY,o.windowWidth,o.windowHeight),A=new f2e(s,a),u=(de=e.foreignObjectRendering)!==null&&de!==void 0?de:!1,d={allowTaint:(J=e.allowTaint)!==null&&J!==void 0?J:!1,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:u,copyStyles:u},A.logger.debug("Starting document clone with size "+a.width+"x"+a.height+" scrolled to "+-a.left+","+-a.top),f=new PW(A,t,d),m=f.clonedReferenceElement,m?[4,f.toIFrame(n,a)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return g=Ee.sent(),v=rx(m)||gMe(m)?zUe(m.ownerDocument):Wb(A,m),y=v.width,w=v.height,b=v.left,I=v.top,B=m2e(A,m,e.backgroundColor),M={canvas:e.canvas,backgroundColor:B,scale:(Z=(Y=e.scale)!==null&&Y!==void 0?Y:r.devicePixelRatio)!==null&&Z!==void 0?Z:1,x:((P=e.x)!==null&&P!==void 0?P:0)+b,y:((C=e.y)!==null&&C!==void 0?C:0)+I,width:(D=e.width)!==null&&D!==void 0?D:Math.ceil(y),height:(U=e.height)!==null&&U!==void 0?U:Math.ceil(w)},u?(A.logger.debug("Document cloned, using foreign object rendering"),Q=new u2e(A,M),[4,Q.render(m)]):[3,3];case 2:return H=Ee.sent(),[3,5];case 3:return A.logger.debug("Document cloned, element located at "+b+","+I+" with size "+y+"x"+w+" using computed rendering"),A.logger.debug("Starting DOM parsing"),K=wte(A,m),B===K.styles.backgroundColor&&(K.styles.backgroundColor=jl.TRANSPARENT),A.logger.debug("Starting renderer for element at "+M.x+","+M.y+" with size "+M.width+"x"+M.height),Q=new s2e(A,M),[4,Q.render(K)];case 4:H=Ee.sent(),Ee.label=5;case 5:return(!((ee=e.removeContainer)!==null&&ee!==void 0)||ee)&&(PW.destroy(g)||A.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),A.logger.debug("Finished rendering"),[2,H]}})})},m2e=function(t,e,n){var r=e.ownerDocument,i=r.documentElement?XE(t,getComputedStyle(r.documentElement).backgroundColor):jl.TRANSPARENT,s=r.body?XE(t,getComputedStyle(r.body).backgroundColor):jl.TRANSPARENT,o=typeof n=="string"?XE(t,n):n===null?jl.TRANSPARENT:4294967295;return e===r.documentElement?Cd(i)?Cd(s)?o:s:i:o};const g2e=({onSubmit:t,onClose:e,isOpen:n=!0})=>{console.log("Dialog render. isOpen:",n);const[r,i]=X.useState(""),[s,o]=X.useState("");X.useEffect(()=>{if(n){const A=setTimeout(()=>{const u=document.getElementById("call-title-input");u&&u.focus()},100);return()=>clearTimeout(A)}},[n]);const a=A=>{if(A.preventDefault(),!r.trim()){o("Please enter a title for this call");return}t(r.trim())};return R.jsxs(R.Fragment,{children:[console.log("Rendering dialog, isOpen:",n),n&&R.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:R.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-11/12 max-w-md",children:[R.jsxs("div",{className:"flex justify-between items-center border-b border-gray-200 dark:border-gray-700 p-4",children:[R.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-white",children:"Enter Video Call Title"}),R.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:R.jsx(Hv,{size:20})})]}),R.jsx("div",{className:"p-6",children:R.jsxs("form",{onSubmit:a,children:[R.jsxs("div",{className:"mb-4",children:[R.jsx("label",{htmlFor:"call-title-input",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Call Purpose"}),R.jsx("input",{id:"call-title-input",type:"text",value:r,onChange:A=>{i(A.target.value),o("")},placeholder:"e.g. Patient Consultation",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:!0}),s&&R.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:s})]}),R.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[R.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-200 dark:hover:bg-gray-600",children:"Cancel"}),R.jsx("button",{type:"submit",className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white  bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Save"})]})]})})]})})]})},A0={isActive:!1,isFrozen:!1,capturedFrame:null,freezeInProgress:!1,fallbackImage:null,createFallbackImage:()=>{try{const t=document.createElement("canvas");t.width=640,t.height=480;const e=t.getContext("2d"),n=e.createLinearGradient(0,0,640,480);return n.addColorStop(0,"#1a365d"),n.addColorStop(1,"#2a4365"),e.fillStyle=n,e.fillRect(0,0,640,480),e.font="24px Arial",e.fillStyle="white",e.textAlign="center",e.fillText("Video Feed Frozen",320,220),e.font="16px Arial",e.fillText(new Date().toLocaleTimeString(),320,250),t.toDataURL("image/jpeg",.9)}catch(t){return console.error("Error creating fallback image:",t),null}},initialize:()=>{A0.fallbackImage=A0.createFallbackImage(),window.FreezeManager=A0}};A0.initialize();function QW(){const t="/signin",e="https://client-admin-6ac45.web.app/",[n,r]=X.useState(!1),[i,s]=X.useState(!1),o=X.useRef(null),a=X.useRef(null),[A,u]=X.useState(0),[d,f]=X.useState(0);return X.useEffect(()=>{o.current&&u(o.current.offsetWidth),a.current&&f(a.current.offsetWidth)},[]),R.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-blue-950 to-blue-950 overflow-hidden relative",children:[R.jsx("div",{className:"absolute inset-0 z-0 opacity-50"}),R.jsxs("div",{className:"relative z-10",children:[R.jsxs("header",{className:"flex justify-between items-center p-4 md:p-6",children:[R.jsx("div",{className:"flex items-center",children:R.jsx("img",{src:UP,alt:"XRAI Logo",className:"w-35 h-28"})}),R.jsx("div",{className:"flex items-center gap-4"})]}),R.jsxs("div",{className:"bg-blue-950 text-white py-2 px-4 text-center text-sm",children:[R.jsx("span",{className:"mr-2",children:""}),"Remote Collaboration upgraded: comprehensive progress in key capabilities."]}),R.jsxs("main",{className:"max-w-6xl mx-auto px-4 pt-16 pb-24 text-center",children:[R.jsx("h1",{className:"text-purple-500  text-6xl md:text-6xl font-bold mb-4",children:"XRAI VISION"}),R.jsx("h2",{className:"text-white text-3xl md:text-3xl font-medium mb-16",children:"Remote Colloboration"}),R.jsxs("div",{className:"grid md:grid-cols-2 gap-6 max-w-4xl mx-auto",children:[R.jsxs(ZU,{to:t,className:"bg-white rounded-xl p-8 shadow-lg hover:shadow-xl transition-shadow text-left",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),children:[R.jsx("h3",{ref:o,className:"text-purple-500 text-2xl font-bold mb-2",children:"User Login"}),R.jsx("div",{style:{width:A},className:`h-[2px] bg-blue-500 mb-4 transition-opacity duration-300 ${n?"opacity-100":"opacity-0"}`}),R.jsxs("p",{className:"text-gray-600",children:["Access to Remote Collaboration platform.",R.jsx("br",{})]})]}),R.jsxs("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"bg-white rounded-xl p-8 shadow-lg hover:shadow-xl transition-shadow text-left",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:[R.jsx("h3",{ref:a,className:"text-purple-500 text-2xl font-bold mb-2",children:"Admin Login"}),R.jsx("div",{style:{width:d},className:`h-[2px] bg-blue-500 mb-4 transition-opacity duration-300 ${i?"opacity-100":"opacity-0"}`}),R.jsx("p",{className:"text-gray-600",children:"Manage your team's users, licenses, and subscriptions with ease."})]})]})]})]})]})}const _2e=X.forwardRef(({clientRef:t,isScreenSharing:e,setIsScreenSharing:n,setRemoteVideos:r,remoteVideoContainerRef:i,localVideoTrackRef:s},o)=>{const a=X.useRef(null),A=X.useRef(null),u=async()=>{try{if(!t.current){console.error("Agora client not initialized");return}s.current&&(A.current=s.current,await t.current.unpublish(s.current));const f=await Dn.createScreenVideoTrack({encoderConfig:{width:1920,height:1080,frameRate:30,bitrateMin:1e3,bitrateMax:3e3},optimizationMode:"detail"});a.current=f;let m=document.getElementById("screen-share-container");if(!m){if(m=document.createElement("div"),m.id="screen-share-container",m.className="screen-share-container",m.style.width="100%",m.style.height="100%",m.style.position="relative",m.style.zIndex="1",!i.current){const g=document.createElement("div");g.id="remote-video-container",g.className="remote-video-container",document.body.appendChild(g),i.current=g}i.current.appendChild(m)}i.current.classList.add("screen-sharing-active"),await f.play(m),console.log("Screen track playing successfully"),await t.current.publish(f),console.log("Screen sharing track published successfully"),r(g=>({...g,screen:f})),n(!0),f.on("track-ended",()=>{console.log("Screen sharing ended by user"),d()}),f.on("track-error",g=>{console.error("Screen sharing error:",g),d()})}catch(f){console.error("Error starting screen share:",f),n(!1),a.current&&(a.current.close(),a.current=null),A.current&&await t.current.publish(A.current)}},d=async()=>{try{if(a.current){console.log("Stopping screen share - unpublishing track");try{await t.current.unpublish(a.current),console.log("Successfully unpublished screen track")}catch(m){console.error("Error unpublishing screen track:",m)}try{a.current.close(),console.log("Successfully closed screen track")}catch(m){console.error("Error closing screen track:",m)}a.current=null,r(m=>{const g={...m};return delete g.screen,g});const f=document.getElementById("screen-share-container");if(f?(f.remove(),console.log("Removed screen container")):console.log("Screen container not found for removal"),i.current&&i.current.classList.remove("screen-sharing-active"),A.current){console.log("Republishing original video track");try{await t.current.publish(A.current),console.log("Successfully republished original video track")}catch(m){console.error("Error republishing original video track:",m)}A.current=null}else console.log("No original video track to republish")}else console.log("No screen track found to stop");n(!1),console.log("Screen sharing state set to false")}catch(f){console.error("Error stopping screen share:",f),n(!1)}};return X.useImperativeHandle(o,()=>({startScreenShare:u,stopScreenShare:d})),X.useEffect(()=>()=>{if(a.current){console.log("Component unmounting, cleaning up screen share");try{t.current&&t.current.connectionState==="CONNECTED"&&t.current.unpublish(a.current),a.current.close(),a.current=null,n(!1),console.log("Forced cleanup completed on unmount")}catch(f){console.error("Error during forced cleanup:",f)}}},[]),null}),E2e=({callId:t,uid:e,cursorActive:n,setCursorActive:r})=>{const[i,s]=X.useState({x:0,y:0}),[o,a]=X.useState({x:0,y:0}),[A,u]=X.useState({}),d=X.useRef({x:0,y:0,time:0}),f=X.useRef(/Android/i.test(navigator.userAgent)),m=y=>{if(y.touches&&y.touches.length>0){const w=y.touches[0]||y.changedTouches[0],b=y.target.getBoundingClientRect(),I=window.innerWidth/b.width,B=window.innerHeight/b.height;return{x:w.clientX*I,y:w.clientY*B}}else return{x:y.clientX,y:y.clientY}},g=y=>{if(!n)return;const w=performance.now(),b=w-d.current.time,I=m(y);if(b>0){const B=I.x-d.current.x,M=I.y-d.current.y,H=B/b,K=M/b;a({x:H,y:K}),s({x:I.x,y:I.y}),b>(f.current?32:16)&&v(I.x,I.y)}d.current={x:I.x,y:I.y,time:w}},v=(y,w)=>{if(!(!n||!t))try{const b={x:y/window.innerWidth,y:w/window.innerHeight,userId:e,timestamp:Date.now(),deviceType:f.current?"android":"desktop"},I=Ke(et,`videoCalls/${t}/cursors/${e}`);vr(I,b)}catch(b){console.error("Error sending cursor position:",b)}};return X.useEffect(()=>(n?(f.current||(document.body.style.cursor="none"),document.addEventListener("pointermove",g,{passive:!0}),document.addEventListener("touchmove",g,{passive:!0})):(f.current||(document.body.style.cursor="auto"),document.removeEventListener("pointermove",g),document.removeEventListener("touchmove",g)),()=>{f.current||(document.body.style.cursor="auto"),document.removeEventListener("pointermove",g),document.removeEventListener("touchmove",g)}),[n]),X.useEffect(()=>{if(!t)return;const y=Ke(et,`videoCalls/${t}/cursors`),w=mo(y,b=>{if(b.exists()){const I=b.val(),B=Date.now(),M={};Object.entries(I).forEach(([H,K])=>{H!==e&&B-K.timestamp<2e3&&(M[H]=K)}),u(M)}else u({})});return()=>{if(w(),t&&e){const b=Ke(et,`videoCalls/${t}/cursors/${e}`);Ih(b)}}},[t,e]),R.jsxs(R.Fragment,{children:[n&&R.jsxs(R.Fragment,{children:[R.jsx("div",{style:{position:"fixed",left:i.x,top:i.y,pointerEvents:"none",zIndex:9999,width:f.current?"32px":"24px",height:f.current?"32px":"24px",transform:"translate(-50%, -50%)",touchAction:"none"},children:R.jsx("svg",{viewBox:"0 0 24 24",fill:"white",xmlns:"http://www.w3.org/2000/svg",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 2px rgba(0, 0, 0, 0.5))"},children:R.jsx("path",{d:"M5 3L19 12L13 14L11 19L5 3Z"})})}),!f.current&&R.jsx("div",{style:{position:"fixed",left:i.x,top:i.y,pointerEvents:"none",zIndex:9998,width:"12px",height:"12px",backgroundColor:"rgba(34, 197, 94, 0.4)",borderRadius:"50%",transform:"translate3d(-50%, -50%, 0)",transition:"all 0.1s ease",filter:"blur(2px)",touchAction:"none"}})]}),Object.entries(A).map(([y,w])=>{const b=w.x*window.innerWidth,I=w.y*window.innerHeight;return R.jsx("div",{style:{position:"fixed",left:b,top:I,pointerEvents:"none",zIndex:9996,width:w.deviceType==="android"?"32px":"24px",height:w.deviceType==="android"?"32px":"24px",transform:"translate(-50%, -50%)",touchAction:"none"},children:R.jsx("svg",{viewBox:"0 0 24 24",fill:"#22c55e",xmlns:"http://www.w3.org/2000/svg",style:{width:"100%",height:"100%",filter:"drop-shadow(0 0 2px rgba(0, 0, 0, 0.5))"},children:R.jsx("path",{d:"M5 3L19 12L13 14L11 19L5 3Z"})})},y)})]})},Vc={isActive:!1,isFrozen:!1,capturedFrame:null,freezeInProgress:!1,fallbackImage:null,createFallbackImage:()=>{try{const t=document.createElement("canvas");t.width=640,t.height=480;const e=t.getContext("2d"),n=e.createLinearGradient(0,0,640,480);return n.addColorStop(0,"#1a365d"),n.addColorStop(1,"#2a4365"),e.fillStyle=n,e.fillRect(0,0,640,480),e.font="24px Arial",e.fillStyle="white",e.textAlign="center",e.fillText("Video Feed Frozen",320,220),e.font="16px Arial",e.fillText(new Date().toLocaleTimeString(),320,250),t.toDataURL("image/jpeg",.9)}catch(t){return console.error("Error creating fallback image:",t),null}},initialize:()=>{Vc.fallbackImage=Vc.createFallbackImage(),window.FreezeManager=Vc}};Vc.initialize();const v2e=({onCallEnd:t})=>{var ra,Ic,Oa;const[e,n]=X.useState([]),[r,i]=X.useState(""),[s,o]=X.useState(!1),[a,A]=X.useState(""),[u,d]=X.useState(!1),[f,m]=X.useState(!1),[g,v]=X.useState(!1),[y,w]=X.useState(!1),[b,I]=X.useState(!1),[B,M]=X.useState(null),[H,K]=X.useState(null),[Q,F]=X.useState(null),[k,G]=X.useState({}),[$,ne]=X.useState(null),[q,qe]=X.useState(!1),[je,de]=X.useState(0),[J,Y]=X.useState("Remote Consultation"),[Z,P]=X.useState(!1),[C,D]=X.useState(!1),[U,ee]=X.useState(null),[Ee,Re]=X.useState({}),[lt,St]=X.useState(!1),[Tr,cs]=X.useState(null),[As,gr]=X.useState(!0),[xi,vi]=X.useState(!1),[Jt,Xt]=X.useState(!0),[dt,Ar]=X.useState(!1),[yi,Pt]=X.useState(!1),[st,Sr]=X.useState([]),[br,ei]=X.useState([]),[Ks,qn]=X.useState(!1),[yn,Rs]=X.useState(""),[wi,Ia]=X.useState(!1),[Rf,eA]=X.useState(null),[ti,He]=X.useState(!1),[Xe,kt]=X.useState(null),Nt=X.useRef(null),[_n,Br]=X.useState(!1),Ci=X.useRef(null),[fn,Un]=X.useState("participant"),[Mi,Ti]=X.useState({}),[Kd,Gs]=X.useState({canShareScreen:!0,canRecord:!1,canAnnotate:!0,canSendMessages:!0,canInviteOthers:!1}),[Yo,gc]=X.useState(!0),[Co,Hn]=X.useState([]),[jr,Lr]=X.useState(!1),[To,ru]=X.useState(!1),[Gd,_c]=X.useState([]),[Ec,vc]=X.useState(null),[Si,So]=X.useState("grid"),[Wi,Xo]=X.useState([]),$t=X.useRef(null),jn=X.useRef(null),yc=X.useRef(null),Os=X.useRef(null),Jo=X.useRef(B);X.useRef(null);const wc=X.useRef(null),zi=X.useRef(null),tA=X.useRef(null),$o=X.useRef(null);X.useRef(!1),X.useRef(0),X.useRef(0);const Wd=X.useRef(null),Cc=X.useRef(null),Zo=X.useRef(null),ni=X.useRef(null),[ea]=xie(),Ge=ea.get("callId"),Kt=ea.get("uid"),nA=ea.get("title"),JA=og(),zd="de690d378ebd4634a39ed1a2c3d6e663",iu=null;X.useEffect(()=>{if(Ge){const oe=Ke(et,`videoCalls/${Ge}`);mo(oe,pe=>{if(pe.exists()){const ve=pe.val();He(ve.arHandActive||!1)}})}},[Ge]),X.useEffect(()=>((async()=>{try{const he=(await Dn.getDevices()).filter(Pe=>Pe.kind==="videoinput").find(Pe=>Pe.label.toLowerCase().includes("ipevo"));if(!he){A(" Please connect the IPEVO camera to proceed with AR Hand.");return}if(ti){const Pe=await Dn.createCameraVideoTrack({cameraId:he.deviceId});kt(Pe),Pe.play(Nt.current);const $e=document.getElementById("combinedCanvas"),Gt=$e.getContext("2d"),ct=setInterval(()=>{const Pn=document.querySelector('[id^="player-"] video');Pn&&Nt.current&&($e.width=Pn.videoWidth||640,$e.height=Pn.videoHeight||480,Gt.clearRect(0,0,$e.width,$e.height),Gt.drawImage(Pn,0,0,$e.width,$e.height),Gt.globalAlpha=.5,Gt.drawImage(Nt.current,0,0,$e.width,$e.height),Gt.globalAlpha=1)},1e3/30),it=$e.captureStream(30).getVideoTracks()[0],Kn=Dn.createCustomVideoTrack({mediaStreamTrack:it});yc.current=Kn,await $t.current.publish([Kn])}else Xe&&(Xe.stop(),Xe.close(),kt(null)),yc.current&&(await $t.current.unpublish([yc.current]),yc.current.close(),setLocalVideoTrackRef(null))}catch(pe){console.error("Error initializing AR Hand camera:",pe)}})(),()=>{Xe&&(Xe.stop(),Xe.close(),kt(null))}),[ti]),X.useEffect(()=>{let oe;return ti&&(oe=setInterval(()=>{const ve=ni.current;if(!ve)return;const he=ve.getContext("2d"),Pe=document.querySelector('[id^="player-"] video');Pe&&Nt.current&&(ve.width=Pe.videoWidth||640,ve.height=Pe.videoHeight||480,he.clearRect(0,0,ve.width,ve.height),he.drawImage(Pe,0,0,ve.width,ve.height),he.globalAlpha=.5,he.drawImage(Nt.current,0,0,ve.width,ve.height),he.globalAlpha=1)},1e3/30)),()=>{oe&&clearInterval(oe)}},[ti]);const qi=()=>{console.log("Ending call...");try{zi.current&&vr(zi.current,{endCall:"true"}),jn.current&&(jn.current.close(),jn.current=null),window._screenTrack&&(window._screenTrack.close(),window._screenTrack=null),$t.current&&$t.current.leave().then(()=>{console.log("Successfully left the channel")}).catch(oe=>{console.error("Error leaving channel:",oe)}),tA.current&&clearInterval(tA.current),Ia(!0)}catch(oe){console.error("Error ending call:",oe),Ia(!0)}},rA=()=>{var pe;console.log("[ICE] REBUILD: Starting full media connection rebuild"),Ar(!0);const oe=((pe=$t.current)==null?void 0:pe.remoteUsers)||[];if(console.log(`[ICE] REBUILD: Found ${oe.length} remote users`),oe.length===0){console.log("[ICE] REBUILD: No remote users found, will try again in 1 second"),setTimeout(rA,1e3);return}oe.forEach(ve=>{if(ve.videoTrack){const he=document.getElementById(`player-${ve.uid}`);if(he)try{console.log(`[ICE] REBUILD: Reinitializing video for ${ve.uid}`);try{ve.videoTrack.stop()}catch(Pe){console.log(`[ICE] REBUILD: Ignoring stop error: ${Pe.message}`)}setTimeout(()=>{try{ve.videoTrack.play(he.id,{fit:"cover"}),console.log(`[ICE] REBUILD: Successfully rebuilt video for ${ve.uid}`),G(Pe=>({...Pe,[ve.uid]:ve.videoTrack}))}catch(Pe){console.error(`[ICE] REBUILD: Failed to play video for ${ve.uid}:`,Pe)}},200)}catch(Pe){console.warn(`[ICE] REBUILD: Error handling video for ${ve.uid}:`,Pe)}else console.warn(`[ICE] REBUILD: Could not find player div for user ${ve.uid}`)}if(ve.audioTrack)try{console.log(`[ICE] REBUILD: Reinitializing audio for ${ve.uid}`);try{ve.audioTrack.stop()}catch(he){console.log(` REBUILD: Ignoring audio stop error: ${he.message}`)}setTimeout(()=>{try{ve.audioTrack.play(),console.log(` REBUILD: Successfully rebuilt audio for ${ve.uid}`)}catch(he){console.warn(" REBUILD: Error playing audio:",he)}},200)}catch(he){console.warn(` REBUILD: Error handling audio for ${ve.uid}:`,he)}}),console.log(" REBUILD: Media connection rebuild completed")};X.useEffect(()=>{const oe=()=>{$o.current&&clearTimeout($o.current),gr(!0),$o.current=setTimeout(()=>{gr(!1)},5e3)};oe();const pe=()=>oe();return document.addEventListener("mousemove",pe),document.addEventListener("click",pe),document.addEventListener("keydown",pe),()=>{$o.current&&clearTimeout($o.current),document.removeEventListener("mousemove",pe),document.removeEventListener("click",pe),document.removeEventListener("keydown",pe)}},[]);const Ug=()=>{document.fullscreenElement?document.exitFullscreen&&(document.exitFullscreen(),vi(!1)):(Zo.current.requestFullscreen().catch(oe=>{console.error(`Error attempting to enable full-screen mode: ${oe.message}`)}),vi(!0))};X.useEffect(()=>{const oe=()=>{vi(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",oe),()=>{document.removeEventListener("fullscreenchange",oe)}},[]),X.useEffect(()=>{Y(nA||"Remote Consultation"),Kt&&(Wd.current=Kt)},[nA,Kt]),X.useEffect(()=>{if(Ge){const oe=Ke(et,`videoCalls/${Ge}/endCall`),pe=mo(oe,ve=>{ve.exists()&&ve.val()==="true"&&qi()});return()=>pe()}},[Ge,qi]),X.useEffect(()=>{var oe,pe;if(Ge){zi.current=Ke(et,`videoCalls/${Ge}`);const ve=((oe=_l.currentUser)==null?void 0:oe.displayName)||`User ${Kt.substring(0,6)}`;(pe=_l.currentUser)!=null&&pe.uid;const he=Ke(et,`calls/${Ge}`);Ni(he).then(ct=>{if(!ct.exists()){qr(he,{createdAt:Date.now(),createdBy:Kt,waitingRoomEnabled:!0,viewMode:"grid",raisedHands:[],pinnedUsers:[],spotlightUser:null});const Wt=Ke(et,`calls/${Ge}/participants/${Kt}`);qr(Wt,{name:ve,licenseId:Kt,joinTime:Date.now(),role:"host",isMuted:!1,hasVideo:!0,networkQuality:5}),Un("host"),Gs({canShareScreen:!0,canRecord:!0,canAnnotate:!0,canSendMessages:!0,canInviteOthers:!0})}}),(async()=>{await ri(Ge)})(),Ni(zi.current).then(ct=>{ct.exists()&&ct.val().purpose&&Y(ct.val().purpose)}),tA.current=setInterval(()=>{de(ct=>ct+1)},1e3);const $e=Ke(et,`videoCalls/${Ge}/annotations`),Gt=mo($e,ct=>{ct.exists()&&Re(ct.val())});return()=>{$t.current&&$t.current.leave(),jn.current&&jn.current.close(),tA.current&&clearInterval(tA.current),Gt()}}},[Ge]),X.useEffect(()=>{if(Ge){const oe=Ke(et,`videoCalls/${Ge}/freeze`),pe=mo(oe,ve=>{const he=ve.val();console.log(" Firebase freeze state changed:",he);const Pe=he==="on";m(Pe),qe(Pe),console.log(" Updated local state - isVideoFrozen:",Pe),Pe&&!B?(console.log(" No frozen frame available, capturing video frame"),su()):Pe||(console.log(" FIREBASE UNFREEZE DETECTED"),Ar(!0),rA(),setTimeout(()=>{console.log(" First scheduled rebuild (500ms)"),rA(),setTimeout(()=>{console.log(" Second scheduled rebuild (1500ms)"),rA(),setTimeout(()=>{console.log(" Final scheduled task: clearing frozen frame (3000ms)"),M(null),window.FreezeManager&&(window.FreezeManager.capturedFrame=null)},1500)},1e3)},500))});return()=>pe()}},[Ge,B]),X.useEffect(()=>{if(Ge){const oe=Ke(et,`videoCalls/${Ge}`);Ni(oe).then(pe=>{var ve;ne(((ve=pe.val())==null?void 0:ve.stopVideo)||"stop")})}},[Ge]);const su=()=>{if(console.log(" captureVideoFrame function called"),Vc.capturedFrame)return console.log(" Using existing cached frame"),M(Vc.capturedFrame),Vc.capturedFrame;console.log(" No cached frame found, attempting to capture new frame");try{if(Os.current){const pe=document.querySelectorAll("video"),ve=Os.current.querySelectorAll("video");for(const he of[...pe,...ve])if(he&&he.videoWidth&&he.videoHeight&&!he.paused){const Pe=document.createElement("canvas");Pe.width=he.videoWidth,Pe.height=he.videoHeight,Pe.getContext("2d").drawImage(he,0,0,Pe.width,Pe.height);const Gt=Pe.toDataURL("image/jpeg",.9);return console.log(" Successfully captured video frame"),Vc.capturedFrame=Gt,M(Gt),Ar(!0),console.log(" Setting wasInCall=true during freeze"),zi.current&&vr(zi.current,{frozenFrameUrl:Gt}),Gt}}}catch(pe){console.warn("First capture approach failed:",pe)}if(typeof VW<"u")try{const pe=Os.current;pe&&VW(pe,{useCORS:!0,allowTaint:!0,backgroundColor:"#000000"}).then(ve=>{const he=ve.toDataURL("image/jpeg",.9);console.log(" Successfully captured frame using html2canvas"),Vc.capturedFrame=he,M(he),Ar(!0),console.log(" Setting wasInCall=true during freeze (html2canvas method)"),zi.current&&vr(zi.current,{frozenFrameUrl:he})})}catch(pe){console.warn("HTML2Canvas approach failed:",pe)}const oe=Vc.fallbackImage||Vc.createFallbackImage();return oe&&(M(oe),zi.current&&vr(zi.current,{frozenFrameUrl:oe})),null},qd=oe=>{const pe=Math.floor(oe/3600),ve=Math.floor(oe%3600/60),he=oe%60;return[pe>0?pe.toString().padStart(2,"0"):null,ve.toString().padStart(2,"0"),he.toString().padStart(2,"0")].filter(Boolean).join(":")},iA=()=>{navigator.clipboard.writeText(Ge),P(!0),setTimeout(()=>P(!1),2e3)},Of=()=>{const oe=`${window.location.origin}/join?callId=${Ge}`;navigator.share?navigator.share({title:`Join ${J}`,text:"Join my video call session",url:oe}).catch(pe=>console.error("Share failed:",pe)):(navigator.clipboard.writeText(oe),P(!0),setTimeout(()=>P(!1),2e3))},ri=async oe=>{$t.current=Dn.createClient({mode:"rtc",codec:"vp8",statsReportInterval:0}),Cc.current=$t.current;try{await $t.current.join(zd,oe,iu,null),console.log("Successfully joined Agora channel:",oe),St(!0),$t.current.on("user-published",$A),$t.current.on("user-unpublished",sA),$t.current.on("user-left",Tc),$t.current.on("exception",pe=>{console.warn("Agora exception:",pe)}),await oo(),zi.current&&Ni(zi.current).then(pe=>{pe.exists()||qr(zi.current,{freeze:"off",annotations:{},frozenFrameUrl:null})})}catch(pe){console.error("Agora initialization error:",pe),A("Failed to join call"),St(!1)}},oo=async()=>{var oe,pe;try{jn.current=await Dn.createMicrophoneAudioTrack(),jn.current.setMuted(u),await $t.current.publish([jn.current]),console.log(" Published audio track"),console.log(` Published audio track, video will be handled by useEffect. AR Hand: ${ti}, muted: ${u}`)}catch(ve){console.error(" Error during joinChannelAndPublishTracks:",ve),(oe=ve.message)!=null&&oe.includes("video")?A("Failed to access camera. Please check camera permissions."):(pe=ve.message)!=null&&pe.includes("audio")?A("Failed to access microphone. Please check audio permissions."):A("Failed to join channel with audio/video."),setTimeout(()=>A(""),4e3)}},$A=async(oe,pe)=>{console.log(`User ${oe.uid} published ${pe}`);try{if(await $t.current.subscribe(oe,pe),console.log(`Subscribed to ${pe} track from user ${oe.uid}`),pe==="video"&&oe.videoTrack){console.log(` Video track details for user ${oe.uid}:`,{trackId:oe.videoTrack.getTrackId(),enabled:oe.videoTrack.isEnabled,muted:oe.videoTrack.muted});const ve=Os.current;if(!ve){console.error("Remote video container not available");return}let he=document.getElementById(`player-${oe.uid}`);if(!he){if(console.log(` Creating stable video container for user ${oe.uid}`),he=document.createElement("div"),he.id=`player-${oe.uid}`,he.className="video-stabilizer",Si==="grid")he.style.position="relative",he.style.width="100%",he.style.height="100%",he.style.aspectRatio="16/9";else if(Si==="speaker"){const it=Ec===oe.uid,Kn=Wi.includes(oe.uid);if(it||Kn||!Ec&&!Wi.length)he.style.position="absolute",he.style.inset="0",he.style.width="100%",he.style.height="100%",he.style.zIndex="10",he.style.transition="all 0.3s ease-in-out";else{const Pn=Object.keys(k).length,Gn=document.createElement("div");Gn.id="thumbnails-area",Gn.style.position="absolute",Gn.style.bottom="20px",Gn.style.left="50%",Gn.style.transform="translateX(-50%)",Gn.style.zIndex="20",Gn.style.display="flex",Gn.style.justifyContent="center",Gn.style.gap="10px",he.style.position="relative",he.style.width="160px",he.style.height="90px",he.style.zIndex="20",he.style.borderRadius="8px",he.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.3)",he.style.border="2px solid rgba(255, 255, 255, 0.1)",he.style.transition="all 0.3s ease",he.addEventListener("mouseenter",()=>{he.style.border="2px solid rgba(59, 130, 246, 0.8)",he.style.transform="scale(1.05)"}),he.addEventListener("mouseleave",()=>{he.style.border="2px solid rgba(255, 255, 255, 0.1)",he.style.transform="scale(1)"}),he.addEventListener("click",()=>{ta(oe.uid)})}}else if(Si==="sidebar")if(Ec===oe.uid||Wi.includes(oe.uid)||!Ec&&!Wi.length&&Object.keys(k)[0]===oe.uid)he.style.position="absolute",he.style.left="0",he.style.top="0",he.style.width="75%",he.style.height="100%",he.style.transition="all 0.3s ease";else{const Kn=Object.keys(k).filter(bi=>bi!==Ec&&!Wi.includes(bi)),Pn=Kn.indexOf(oe.uid),Gn=Kn.length||1;he.style.position="absolute",he.style.right="0",he.style.top=`${Pn/Gn*100}%`,he.style.width="25%",he.style.height=`${100/Gn}%`,he.style.borderBottom="1px solid rgba(255, 255, 255, 0.1)",he.style.transition="all 0.3s ease",he.addEventListener("click",()=>{ta(oe.uid)})}else he.style.position="absolute",he.style.inset="0",he.style.width="100%",he.style.height="100%";if(he.style.transform="translateZ(0)",he.style.willChange="transform",he.style.backfaceVisibility="hidden",he.style.objectFit="cover",ve.appendChild(he),Gd.includes(oe.uid)){const it=document.createElement("div");it.className="hand-indicator",it.style.position="absolute",it.style.top="10px",it.style.left="10px",it.style.backgroundColor="#EAB308",it.style.borderRadius="50%",it.style.width="32px",it.style.height="32px",it.style.display="flex",it.style.alignItems="center",it.style.justifyContent="center",it.style.zIndex="30",it.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-hand"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0"></path><path d="M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2"></path><path d="M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8"></path><path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"></path></svg>',he.appendChild(it)}const Pe=Mi[oe.uid]||{},$e=Pe.role||"participant",Gt=Pe.name||`User ${oe.uid.toString().substring(0,6)}`,ct=document.createElement("div");ct.className="name-badge",ct.style.position="absolute",ct.style.bottom="10px",ct.style.left="10px",ct.style.backgroundColor="rgba(0, 0, 0, 0.6)",ct.style.backdropFilter="blur(4px)",ct.style.borderRadius="4px",ct.style.padding="4px 8px",ct.style.display="flex",ct.style.alignItems="center",ct.style.zIndex="30";const Wt=$e==="host"?"#EAB308":$e==="participant"?"#3B82F6":"#6B7280";ct.innerHTML=`
            <span style="font-size: 12px; color: white; margin-right: 4px;">${Gt}</span>
            <span style="font-size: 10px; background-color: ${Wt}; color: white; padding: 2px 4px; border-radius: 4px;">${$e}</span>
          `,he.appendChild(ct),console.log(` Attempting to play video for user ${oe.uid} in element: ${he.id}`);try{oe.videoTrack.play(he.id,{fit:"cover"}),console.log(` Video playback initiated for user ${oe.uid}`);const it=he.querySelector("video");it?(it.addEventListener("playing",()=>{console.log(` Video is now playing for user ${oe.uid}`)}),it.addEventListener("error",Kn=>{console.error(` Error in video playback for user ${oe.uid}:`,Kn)})):console.warn(` Could not find video element in player div for user ${oe.uid}`),console.log(` Adding video track for user ${oe.uid} to remoteVideos state`),G(Kn=>{const Pn={...Kn,[oe.uid]:oe.videoTrack};return console.log(" Updated remoteVideos state:",Pn),Pn})}catch(it){console.error(` Failed to play video for user ${oe.uid}:`,it)}}}if(pe==="audio"){console.log(` Playing audio for user ${oe.uid}`);try{oe.audioTrack.play(),console.log(` Audio playback initiated for user ${oe.uid}`)}catch(ve){console.error(` Failed to play audio for user ${oe.uid}:`,ve)}}}catch(ve){console.error("Error handling user published event:",ve)}},sA=(oe,pe)=>{pe==="video"&&G(ve=>{const he={...ve};return delete he[oe.uid],he})},Tc=oe=>{console.log(`User ${oe.uid} left`);const pe=document.getElementById(`player-${oe.uid}`);pe&&pe.parentNode&&pe.parentNode.removeChild(pe),G(ve=>{const he={...ve};return delete he[oe.uid],he}),U===oe.uid&&(D(!1),ee(null))},Yn=()=>{o(!1)},ZA=oe=>{ei(pe=>pe.includes(oe)?pe.filter(ve=>ve!==oe):[...pe,oe])},ao=async()=>{console.log("Fetching available users..."),qn(!0);try{const oe=ea.get("uid")||(_l.currentUser?_l.currentUser.uid:null);if(!oe){console.error("No user ID available"),qn(!1);return}let pe=[];try{const he=Ke(et,`videoCalls/${Ge}`),Pe=await Ni(he);if(Pe.exists()){const $e=Pe.val();$e.users&&(Array.isArray($e.users)?pe=$e.users:typeof $e.users=="object"&&(pe=Object.keys($e.users))),console.log("Active participants:",pe)}}catch(he){console.error("Error fetching active participants:",he)}let ve=[];try{const he=Ke(et,"active_users"),Pe=await Ni(he);Pe.exists()&&Pe.forEach($e=>{const Gt=$e.key;Gt!==oe&&!pe.includes(Gt)&&ve.push(Gt)})}catch(he){console.error("Error fetching online users:",he)}if(ve.length===0)try{const he=Ke(et,"users"),Pe=await Ni(he);Pe.exists()&&Pe.forEach($e=>{const Gt=$e.key;Gt!==oe&&!pe.includes(Gt)&&ve.push(Gt)})}catch(he){console.error("Error fetching all users:",he)}console.log("Users available to invite:",ve),Sr(ve),ve.length===0&&(console.log("No users found in database, using test users for development"),Sr(["user1","user2","user3","user4","user5"]))}catch(oe){console.error("Error in fetchAvailableUsers:",oe),Sr(["test1","test2","test3"])}finally{qn(!1)}},el=async()=>{var oe;if(br.length!==0){qn(!0);try{const pe=((oe=_l.currentUser)==null?void 0:oe.uid)||Kt;let ve=pe;try{const ct=Ke(et,`users/${pe}`),Wt=await Ni(ct);if(Wt.exists()){const it=Wt.val();(it.name||it.displayName||it.email)&&(ve=it.name||it.displayName||it.email)}}catch(ct){console.log("Could not fetch sender name",ct)}const he=Ke(et,`videoCalls/${Ge}`),Pe=await Ni(he),Gt=(Pe.exists()?Pe.val():{}).title||ea.get("title")||"Untitled Call";await Promise.all(br.map(async ct=>{const Wt=Ke(et,`active_users/${ct}/incoming_calls`),it=bh(Wt);await qr(it,{id:it.key,roomId:Ge,userId:pe,name:ve,status:"pending",timestamp:Date.now(),title:Gt,isNew:!0,type:"invitation"}),await vr(Ke(et,`videoCalls/${Ge}`),{[`users/${ct}`]:{invited:!0,invitedBy:pe,invitedAt:Date.now(),status:"invited"}});const Kn=Ke(et,`active_users/${ct}/notifications`);await qr(Kn,{type:"call_invitation",callId:Ge,senderId:pe,senderName:ve,message:`${ve} is inviting you to join a call: ${Gt}`,timestamp:Date.now()})})),Pt(!1),ei([])}catch(pe){console.error("Error sending invitations:",pe),alert("Failed to send invitations: "+pe.message)}finally{qn(!1)}}},Yd=(oe,pe)=>{if(!Ge)return;const ve=Ke(et,`calls/${Ge}/participants/${oe}`);vr(ve,{role:pe}).then(()=>{Ti(he=>({...he,[oe]:{...he[oe]||{},role:pe}})),oe===Kt&&(Un(pe),Gs({canShareScreen:pe==="host"||pe==="participant",canRecord:pe==="host",canAnnotate:pe==="host"||pe==="participant",canSendMessages:pe==="host"||pe==="participant",canInviteOthers:pe==="host"}))}).catch(he=>{console.error("Error updating user role:",he)})},Xd=oe=>{if(!Ge)return;const pe=Ke(et,`calls/${Ge}`);vr(pe,{waitingRoomEnabled:oe}).then(()=>{gc(oe)}).catch(ve=>{console.error("Error toggling waiting room:",ve)})},Jd=oe=>{if(!Ge)return;const pe=Ke(et,`calls/${Ge}/waitingRoom/${oe}`);Ni(pe).then(ve=>{if(ve.exists()){const he=ve.val(),Pe={};Pe[`calls/${Ge}/waitingRoom/${oe}`]=null,Pe[`calls/${Ge}/participants/${oe}`]={...he,licenseId:oe,id:oe,joinTime:Date.now(),role:"participant"},vr(Ke(et),Pe).then(()=>{Hn($e=>$e.filter(Gt=>Gt.id!==oe))}).catch($e=>{console.error("Error admitting user:",$e)})}})},Pg=oe=>{if(!Ge)return;const pe=Ke(et,`calls/${Ge}/waitingRoom/${oe}`);vr(pe,{denied:!0}).then(()=>{Hn(ve=>ve.filter(he=>he.id!==oe))}).catch(ve=>{console.error("Error denying user:",ve)})},kg=()=>{if(!Ge||Co.length===0)return;const oe={};Co.forEach(pe=>{oe[`calls/${Ge}/waitingRoom/${pe.id}`]=null,oe[`calls/${Ge}/participants/${pe.id}`]={name:pe.name,licenseId:pe.id,id:pe.id,joinTime:Date.now(),role:"participant"}}),vr(Ke(et),oe).then(()=>{Hn([])}).catch(pe=>{console.error("Error admitting all users:",pe)})},ou=()=>{if(!Ge||Co.length===0)return;const oe={};Co.forEach(pe=>{oe[`calls/${Ge}/waitingRoom/${pe.id}/denied`]=!0}),vr(Ke(et),oe).then(()=>{Hn([])}).catch(pe=>{console.error("Error denying all users:",pe)})},Sc=()=>{ru(oe=>!oe)},bo=oe=>{if(!Ge)return;const pe=Ke(et,`calls/${Ge}/participants/${oe}`);Ni(pe).then(ve=>{if(ve.exists()){const he=ve.val();vr(pe,{isMuted:!he.isMuted}).then(()=>{Ti(Pe=>({...Pe,[oe]:{...Pe[oe]||{},isMuted:!he.isMuted}}))})}})},bc=oe=>{if(!Ge)return;const pe=Ke(et,`calls/${Ge}/participants/${oe}`);Ni(pe).then(ve=>{if(ve.exists()){const he=ve.val();vr(pe,{hasVideo:!he.hasVideo}).then(()=>{Ti(Pe=>({...Pe,[oe]:{...Pe[oe]||{},hasVideo:!he.hasVideo}}))})}})},ta=oe=>{if(Ge)if(Ec===oe){vc(null);const pe=Ke(et,`calls/${Ge}`);vr(pe,{spotlightUser:null})}else{vc(oe);const pe=Ke(et,`calls/${Ge}`);vr(pe,{spotlightUser:oe})}},$d=oe=>{if(!Ge)return;const pe=Wi.includes(oe);let ve;if(pe?ve=Wi.filter(he=>he!==oe):ve=[...Wi,oe],Xo(ve),fn==="host"){const he=Ke(et,`calls/${Ge}`);vr(he,{pinnedUsers:ve})}},Ra=oe=>{if(!Ge)return;_c(ve=>ve.filter(he=>he!==oe));const pe=Ke(et,`calls/${Ge}`);vr(pe,{raisedHands:Gd.filter(ve=>ve!==oe)})},au=oe=>{if(["grid","speaker","sidebar"].includes(oe)&&(So(oe),fn==="host"&&Ge)){const pe=Ke(et,`calls/${Ge}`);vr(pe,{viewMode:oe})}},tl=oe=>{if(!Ge||fn!=="host")return;const pe=Ke(et,`calls/${Ge}/participants/${oe}`);vr(pe,{removed:!0}).then(()=>{const ve={...Mi};delete ve[oe],Ti(ve)})},na=oe=>{s||o(!0),console.log(`Setting up direct message to user ${oe}`)};X.useEffect(()=>{if(!Ge)return;const oe=Ke(et,`calls/${Ge}/participants`),pe=mo(oe,ct=>{if(ct.exists()){const Wt=ct.val();if(Ti(Wt),Wt[Kt]&&Wt[Kt].role){Un(Wt[Kt].role);const it=Wt[Kt].role;Gs({canShareScreen:it==="host"||it==="participant",canRecord:it==="host",canAnnotate:it==="host"||it==="participant",canSendMessages:it==="host"||it==="participant",canInviteOthers:it==="host"})}}}),ve=Ke(et,`calls/${Ge}/waitingRoom`),he=mo(ve,ct=>{if(ct.exists()){const Wt=ct.val(),it=Object.entries(Wt).filter(([,Kn])=>!Kn.denied).map(([Kn,Pn])=>({id:Kn,name:Pn.name||`User ${Kn.substring(0,6)}`,joinTime:Pn.joinTime||Date.now()}));Hn(it),fn==="host"&&it.length>0&&!jr&&Lr(!0)}else Hn([])}),Pe=Ke(et,`calls/${Ge}`),$e=mo(Pe,ct=>{if(ct.exists()){const Wt=ct.val();"waitingRoomEnabled"in Wt&&gc(Wt.waitingRoomEnabled),"spotlightUser"in Wt&&vc(Wt.spotlightUser),"raisedHands"in Wt&&_c(Wt.raisedHands||[]),"viewMode"in Wt&&fn!=="host"&&So(Wt.viewMode),"pinnedUsers"in Wt&&Xo(Wt.pinnedUsers||[])}});return(async()=>{var ct,Wt;if(!(!Ge||!Kt))try{const it=Ke(et,`calls/${Ge}`),Kn=await Ni(it);if(Kn.exists()){const Pn=Kn.val(),Gn=await Ni(Ke(et,`calls/${Ge}/participants/${Kt}`));if(Gn.exists()){const Ro=Gn.val();Un(Ro.role||"participant");const Na=Ro.role||"participant";Gs({canShareScreen:Na==="host"||Na==="participant",canRecord:Na==="host",canAnnotate:Na==="host"||Na==="participant",canSendMessages:Na==="host"||Na==="participant",canInviteOthers:Na==="host"});return}const bi=((ct=_l.currentUser)==null?void 0:ct.displayName)||`User ${Kt.substring(0,6)}`;if(Pn.waitingRoomEnabled&&Pn.createdBy!==Kt){const Ro=Ke(et,`calls/${Ge}/waitingRoom/${Kt}`);await qr(Ro,{name:bi,joinTime:Date.now()}),console.log("User added to waiting room")}else{const Ro=Ke(et,`calls/${Ge}/participants/${Kt}`);await qr(Ro,{name:bi,licenseId:Kt,joinTime:Date.now(),role:"participant",isMuted:!1,hasVideo:!0,networkQuality:5}),Un("participant"),console.log("User added as participant")}}else{await qr(it,{createdAt:Date.now(),createdBy:Kt,waitingRoomEnabled:!0,viewMode:"grid",raisedHands:[],pinnedUsers:[],spotlightUser:null});const Pn=Ke(et,`calls/${Ge}/participants/${Kt}`),Gn=((Wt=_l.currentUser)==null?void 0:Wt.displayName)||`User ${Kt.substring(0,6)}`;await qr(Pn,{name:Gn,licenseId:Kt,joinTime:Date.now(),role:"host",isMuted:!1,hasVideo:!0,networkQuality:5}),Un("host"),Gs({canShareScreen:!0,canRecord:!0,canAnnotate:!0,canSendMessages:!0,canInviteOthers:!0}),console.log("Call created, user added as host")}}catch(it){console.error("Error handling participant joining:",it)}})(),()=>{pe(),he(),$e()}},[Ge,Kt,fn,jr]),X.useEffect(()=>{var Pe,$e,Gt,ct;const oe=Object.keys(k).length,pe=(($e=(Pe=$t.current)==null?void 0:Pe.remoteUsers)==null?void 0:$e.length)>0,ve=(ct=(Gt=$t.current)==null?void 0:Gt.remoteUsers)==null?void 0:ct.some(Wt=>Wt.audioTrack),he=f||B!==null;console.log(` Call state check: remoteVideos=${oe}, remoteUsers=${pe}, audioTracks=${ve}, wasInCall=${dt}, frozenStatus=${he}`),(oe>0||pe||ve||he)&&!dt&&(console.log(" Setting wasInCall to true due to detected participants or recent unfreeze"),Ar(!0))},[k,B,f]),X.useEffect(()=>{var oe,pe;dt||(pe=(oe=$t.current)==null?void 0:oe.remoteUsers)!=null&&pe.some(he=>he.audioTrack)&&Object.keys(k).length===0&&(console.log(" AUDIO ONLY DETECTED: Setting wasInCall=true even though video is not visible yet"),Ar(!0))},[(ra=$t.current)==null?void 0:ra.remoteUsers]),X.useEffect(()=>{const oe=Object.keys(k).length;oe===1&&Si!=="speaker"?So("speaker"):oe>1&&Si==="speaker"&&So("grid")},[k,Si]);const Io=oe=>{Ia(!1),typeof t=="function"&&t(),JA("/dashboard")},nl=()=>{Ia(!1),typeof t=="function"&&t(),JA("/dashboard")};return X.useEffect(()=>{if(!f&&B){const oe=Os.current;let pe=!1,ve;if(oe){const he=oe.querySelector("video");if(he){const Pe=()=>{pe||(pe=!0,setTimeout(()=>M(null),100),he.removeEventListener("playing",Pe),ve&&clearTimeout(ve))};return he.addEventListener("playing",Pe),ve=setTimeout(()=>{pe||(pe=!0,M(null),he.removeEventListener("playing",Pe))},2e3),()=>{he.removeEventListener("playing",Pe),ve&&clearTimeout(ve)}}else return ve=setTimeout(()=>M(null),2e3),()=>clearTimeout(ve)}}},[f,B]),R.jsxs("div",{ref:Zo,className:"relative w-full h-screen overflow-hidden bg-black",children:[R.jsx(E2e,{callId:Ge,uid:Kt,cursorActive:_n,setCursorActive:Br}),R.jsx("div",{className:`absolute top-0 left-0 right-0 z-50 transition-opacity duration-300 ease-in-out ${As?"opacity-100":"opacity-0"}`,children:R.jsx("div",{className:"mx-auto max-w-5xl px-4 pt-6",children:R.jsxs("div",{className:"bg-gradient-to-r from-gray-900/90 via-gray-800/90 to-gray-900/90 backdrop-blur-xl rounded-3xl shadow-2xl border border-white/5 px-6 py-4 flex items-center justify-between",children:[R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"mr-4",children:R.jsx("div",{className:"w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-700 flex items-center justify-center shadow-lg shadow-blue-900/30 border border-blue-400/20",children:R.jsx(RUe,{size:24,className:"text-white drop-shadow filter-shadow"})})}),R.jsxs("div",{children:[R.jsx("h1",{className:"text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-blue-100",children:J}),R.jsxs("div",{className:"flex items-center text-gray-300 text-sm mt-1.5",children:[R.jsxs("div",{className:"flex items-center bg-gray-800/50 rounded-full px-2.5 py-1 border border-white/10 shadow-inner",children:[R.jsx(Iee,{size:12,className:"mr-1.5 text-blue-400"}),R.jsx("span",{className:"font-medium text-xs text-blue-100",children:qd(je)})]}),R.jsx("span",{className:"mx-2 text-gray-500",children:""}),R.jsxs("div",{className:"flex items-center",children:[R.jsx("div",{className:"h-2 w-2 rounded-full bg-green-500 mr-1.5 animate-pulse shadow-sm shadow-green-500/50"}),R.jsx("span",{className:"text-gray-400",children:"Secure Connection"})]})]})]})]}),R.jsxs("div",{className:"flex items-center space-x-3",children:[R.jsxs("div",{className:"flex items-center bg-gray-800/70 backdrop-blur-sm px-3 py-2 rounded-xl border border-white/5 shadow-lg",children:[R.jsx("span",{className:"text-gray-400 mr-2 text-sm font-medium",children:"Room:"}),R.jsx("span",{className:"text-blue-400 font-mono font-medium tracking-wide",children:Ge==null?void 0:Ge.substring(0,8)}),R.jsx("button",{onClick:iA,className:"ml-2 text-gray-400 hover:text-white bg-gray-700/70 hover:bg-gray-600/70 rounded-full p-1.5 transition-colors border border-white/5",children:Z?R.jsx(x8,{size:14,className:"text-green-500"}):R.jsx(F8,{size:14})})]}),R.jsx("button",{onClick:Ug,className:"p-2.5 rounded-xl bg-gray-800/70 hover:bg-gray-700/80 text-gray-300 hover:text-white transition-colors border border-white/5 shadow-lg",title:"Toggle fullscreen",children:R.jsx(Lee,{size:18})}),R.jsxs("button",{onClick:Of,className:"flex items-center bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-4 py-2.5 rounded-xl transition-transform hover:scale-105 shadow-lg shadow-blue-900/20 hover:shadow-blue-900/40 border border-blue-400/20",children:[R.jsx(vU,{size:16,className:"mr-2 drop-shadow-sm"}),R.jsx("span",{className:"font-medium drop-shadow-sm",children:"Invite"})]})]})]})})}),R.jsx("div",{className:"absolute inset-0 pt-[60px] pb-[76px]",children:R.jsxs("div",{className:"relative w-full h-full flex items-center justify-center bg-gradient-to-b from-gray-900 to-gray-800",children:[" ",(fn==="host"||fn==="participant")&&R.jsxs("div",{className:"absolute top-4 left-4 z-30 flex items-center bg-gray-800/80 backdrop-blur-sm rounded-xl shadow-lg border border-gray-700 p-1",children:[R.jsx("button",{onClick:()=>au("grid"),className:`p-2 rounded-lg flex items-center ${Si==="grid"?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"}`,title:"Grid View",children:R.jsx(cUe,{size:18})}),R.jsx("button",{onClick:()=>au("speaker"),className:`p-2 rounded-lg flex items-center ${Si==="speaker"?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"}`,title:"Speaker View",children:R.jsx(fUe,{size:18})}),R.jsx("button",{onClick:()=>au("sidebar"),className:`p-2 rounded-lg flex items-center ${Si==="sidebar"?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"}`,title:"Sidebar View",children:R.jsx(yUe,{size:18})})]}),R.jsxs("button",{onClick:Sc,className:"absolute top-4 right-4 z-50 flex items-center bg-gray-800/80 backdrop-blur-sm rounded-lg shadow-lg border border-gray-700 p-2 md:top-6 md:right-6 md:p-4 sm:top-2 sm:right-2 sm:p-1 sm:text-xs",title:"Participants",children:[R.jsx(qE,{size:18,className:"mr-2 sm:w-4 sm:h-4 md:w-6 md:h-6"}),R.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:Object.keys(Mi).length})]})," ",R.jsxs("div",{className:"relative w-full h-full max-w-[1920px] max-h-[1080px] overflow-hidden",children:[" ",R.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[" ",R.jsxs("div",{ref:Os,className:`absolute inset-0 bg-black ${Si==="grid"?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1":Si==="speaker"?"flex items-center justify-center":Si==="sidebar"?"flex flex-row":""}`,style:{transform:"translateZ(0)",willChange:"transform",backfaceVisibility:"hidden",zIndex:10,transition:"all 0.3s ease"},children:[R.jsx(_2e,{ref:Ci,clientRef:$t,isScreenSharing:y,setIsScreenSharing:w,setRemoteVideos:G,remoteVideoContainerRef:Os,localVideoTrackRef:yc}),(()=>{var Wt,it,Kn,Pn;const oe=Object.keys(k).length;console.log(` Remote video status: ${oe} tracks available`,Object.keys(k).map(Gn=>{var bi,Ro;return{uid:Gn,enabled:(bi=k[Gn])==null?void 0:bi.isEnabled,muted:(Ro=k[Gn])==null?void 0:Ro.muted}}));const pe=((it=(Wt=Os.current)==null?void 0:Wt.querySelectorAll("video"))==null?void 0:it.length)>0;console.log(` Has active video elements: ${pe}`);const ve=((Pn=(Kn=$t.current)==null?void 0:Kn.remoteUsers)==null?void 0:Pn.some(Gn=>Gn.audioTrack))||!1,he=f||B!==null,Pe=B!==null&&!f,$e=lt&&je<5,Gt=oe===0&&!he&&!Pe&&!dt&&!ve&&!$e,ct=pe||oe>0||he||ve;return console.log(` Decision: showWaitingForParticipants=${Gt}, hasVideoPlaying=${ct}, isVideoFrozen=${f}, wasRecentlyFrozen=${he}`),Gt?R.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-b from-gray-900 to-gray-800",children:[R.jsx("div",{className:"mb-6",children:R.jsx(bee,{className:"w-16 h-16 text-blue-400 animate-pulse"})}),R.jsx("h2",{className:"text-2xl font-semibold text-white mb-2",children:"Waiting for participants..."}),R.jsx("p",{className:"text-gray-400",children:"Your call is ready. Share the call link to invite others."}),R.jsxs("div",{className:"mt-8 flex items-center space-x-3",children:[R.jsxs("div",{className:"flex items-center bg-gray-800/70 backdrop-blur px-4 py-2 rounded-lg border border-gray-700",children:[R.jsx("span",{className:"text-gray-300 mr-2 font-medium",children:"ID:"}),R.jsx("span",{className:"text-blue-400 font-mono",children:Ge}),R.jsx("button",{onClick:iA,className:"ml-3 text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-700/50",children:Z?R.jsx(x8,{size:18,className:"text-green-500"}):R.jsx(F8,{size:18})})]}),R.jsxs("button",{onClick:Of,className:"flex items-center bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full border border-white/35 transition-colors shadow-lg",children:[R.jsx(vU,{size:18,className:"mr-2"}),R.jsx("span",{children:"Share Invite"})]})]})]}):!ct&&!f?R.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60",children:R.jsxs("div",{className:"flex flex-col items-center",children:[R.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),R.jsx("p",{className:"mt-4 text-gray-300 text-sm",children:"Connecting video stream..."})]})}):null})()]}),R.jsx("div",{className:"absolute top-0 left-0 right-0 z-20 px-4 py-3 bg-gradient-to-b from-gray-900/90 to-transparent",children:R.jsx("div",{className:"flex items-center justify-between",children:R.jsxs("div",{className:"flex items-center space-x-3",children:[" ",R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),R.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Live"})]}),b&&R.jsxs("div",{className:"flex items-center space-x-2",children:[R.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),R.jsx("span",{className:"text-sm font-medium text-gray-200",children:"Recording"})]})]})})}),f&&ti&&R.jsx("canvas",{ref:ni,id:"combinedCanvasFreezeOverlay",className:"absolute inset-0 z-10 w-full h-full",style:{objectFit:"cover",pointerEvents:"none"}}),R.jsx(KUe,{callId:Ge,database:et,agoraEngine:Cc.current,remoteVideos:k,remoteVideoContainerRef:Os,uidRef:Wd,annotations:Ee,setAnnotations:Re,isVideoFrozen:f,frozenFrameRef:ti&&f?ni:Jo,frozenFrame:ti&&f?null:B,isRemoteVideoFrozen:g}),f&&!ti&&B&&R.jsxs("div",{className:"absolute inset-0 z-10 flex items-center justify-center bg-black/70",children:[R.jsx("img",{src:B,alt:"Frozen Frame",className:"w-full h-full object-cover",style:{pointerEvents:"none"}}),R.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:R.jsx("span",{className:"text-white text-2xl font-bold bg-black/60 px-6 py-2 rounded-lg",children:"Video Frozen"})})]}),g&&R.jsx("div",{className:"absolute inset-0 z-30 backdrop-blur-sm bg-black/40 flex items-center justify-center",children:R.jsxs("div",{className:"text-center px-6 py-4 rounded-lg bg-gray-900/80 backdrop-blur-lg border border-gray-700",children:[R.jsx(VideoOff,{size:32,className:"mx-auto mb-2 text-yellow-500"}),R.jsx("p",{className:"text-gray-200",children:"Video connection interrupted"}),R.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Attempting to reconnect..."})]})})]})]})]})}),ti&&R.jsx("canvas",{ref:ni,id:"combinedCanvas",className:"absolute inset-0 w-full h-full",style:{objectFit:"cover",zIndex:10,pointerEvents:"none"}}),R.jsx("video",{ref:Nt,autoPlay:!0,playsInline:!0,style:{display:"none"}}),R.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gray-800/95 backdrop-blur-sm p-4 flex justify-center space-x-4 z-40 border-t border-gray-700",children:R.jsx(jUe,{callId:Ge,database:et,clientRef:$t,localAudioTrackRef:jn,remoteVideoContainerRef:Os,channelRef:zi,recordingRef:wc,screenShareRef:Ci,isMuted:u,setIsMuted:d,stopVideoState:$,setStopVideoState:ne,isVideoFrozen:f,setIsVideoFrozen:m,setFreezeOverlayVisible:qe,frozenFrame:B,setFrozenFrame:M,isScreenSharing:y,setIsScreenSharing:w,isRecording:b,setIsRecording:I,toggleChat:()=>o(!s),endCall:qi,setARHandActive:He,isARHandActive:ti,cursorActive:_n,setCursorActive:Br})}),s&&R.jsx("div",{className:"fixed right-0 top-[60px] bottom-[76px] w-80 bg-gray-800 shadow-xl z-50",children:R.jsx(C7,{callId:Ge,database:et,userId:((Ic=_l.currentUser)==null?void 0:Ic.uid)||Kt||"anonymous",userName:((Oa=_l.currentUser)==null?void 0:Oa.displayName)||`${(Kt==null?void 0:Kt.substring(0,20))||"Anonymous"}`,onCloseChat:Yn})})," ",R.jsxs("div",{className:"fixed top-4 right-4 z-50 flex items-center bg-green-600 text-white px-4 py-2 rounded-lg cursor-pointer font-bold shadow-lg gap-2 md:top-6 md:right-6 md:px-6 md:py-3 md:text-base sm:top-2 sm:right-2 sm:px-2 sm:py-1 sm:text-xs",style:{boxShadow:"0 4px 8px rgba(0,0,0,0.3)"},onClick:()=>{console.log("Invite button clicked"),Pt(!0),ao()},children:[R.jsx(UUe,{size:20,className:"sm:w-4 sm:h-4 md:w-6 md:h-6"}),R.jsx("span",{className:"hidden sm:inline",children:"Add User"})]}),yi&&R.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60]",children:R.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-96 max-w-full max-h-[80vh] flex flex-col",children:[R.jsxs("div",{className:"flex justify-between items-center mb-4",children:[R.jsx("h2",{className:"text-xl font-bold text-white",children:"Invite Users to Call"}),R.jsx("button",{onClick:()=>Pt(!1),className:"text-gray-400 hover:text-white",children:R.jsx(Hv,{size:24})})]}),R.jsx("div",{className:"mb-4",children:R.jsx("input",{type:"text",placeholder:"Search contacts...",value:yn,onChange:oe=>Rs(oe.target.value),className:"w-full px-4 py-2 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),Ks?R.jsx("div",{className:"flex justify-center py-4",children:R.jsx(dUe,{className:"animate-spin text-blue-500",size:24})}):R.jsxs(R.Fragment,{children:[st.length===0?R.jsxs("div",{className:"text-center py-8 text-gray-400",children:[R.jsx(yU,{size:48,className:"mx-auto mb-2"}),R.jsx("p",{children:"No contacts available to invite"}),R.jsxs("button",{onClick:ao,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[R.jsx(SUe,{size:16,className:"inline mr-2"}),"Refresh Contacts"]})]}):R.jsx("div",{className:"flex-1 overflow-y-auto my-4 space-y-2",children:st.filter(oe=>typeof oe=="string"&&oe.toLowerCase().includes(yn.toLowerCase())).map(oe=>R.jsxs("div",{className:`flex items-center p-3 rounded-md cursor-pointer transition-colors bg-gray-700 hover:bg-gray-600 ${br.includes(oe)?"bg-blue-600":""}`,onClick:()=>ZA(oe),children:[R.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold mr-3",children:oe.charAt(0).toUpperCase()}),R.jsx("div",{className:"flex-1",children:R.jsx("p",{className:"font-medium",children:oe})}),br.includes(oe)&&R.jsx($Le,{size:20,className:"ml-2 text-white"})]},oe))}),R.jsxs("div",{className:"flex justify-end pt-4 border-t border-gray-700",children:[R.jsx("button",{onClick:()=>Pt(!1),className:"px-4 py-2 text-gray-300 mr-2 hover:text-white transition-colors",children:"Cancel"}),R.jsxs("button",{onClick:el,disabled:br.length===0,className:`px-4 py-2 rounded-md ${br.length===0?"bg-gray-600 text-gray-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:["Invite Selected (",br.length,")"]})]})]})]})}),jr&&Co.length>0&&fn==="host"&&R.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[55]",children:R.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-96 max-w-full max-h-[80vh] flex flex-col",children:[R.jsxs("div",{className:"flex justify-between items-center mb-4",children:[R.jsxs("h2",{className:"text-xl font-bold text-white flex items-center",children:[R.jsx(qE,{size:20,className:"text-blue-400 mr-2"}),"Waiting Room",R.jsx("span",{className:"ml-2 bg-blue-600 text-white text-xs px-2 py-1 rounded-full",children:Co.length})]}),R.jsx("button",{onClick:()=>Lr(!1),className:"text-gray-400 hover:text-white p-1 rounded-full hover:bg-gray-700",children:R.jsx(Hv,{size:20})})]}),R.jsx("div",{className:"flex-1 overflow-y-auto",children:R.jsx(GUe,{waitingUsers:Co,admitUser:Jd,denyUser:Pg,admitAll:kg,denyAll:ou})}),R.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t border-gray-700",children:[R.jsxs("label",{className:"flex items-center",children:[R.jsx("input",{type:"checkbox",checked:Yo,onChange:oe=>Xd(oe.target.checked),className:"w-4 h-4 rounded-sm text-blue-600 border-gray-600 bg-gray-700 focus:ring-blue-500 focus:ring-offset-gray-800"}),R.jsx("span",{className:"ml-2 text-sm text-gray-300",children:"Enable waiting room"})]}),R.jsx("button",{onClick:()=>Lr(!1),className:"px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 transition-colors",children:"Close"})]})]})}),To&&R.jsx("div",{className:"fixed right-0 top-[60px] bottom-[76px] z-50 flex items-start justify-end p-4",children:R.jsx(WUe,{participants:Mi,localUser:{uid:Kt},userRole:fn,onToggleMute:bo,onToggleVideo:bc,onToggleSpotlight:ta,onTogglePin:$d,onPromoteUser:oe=>Yd(oe,"host"),onDemoteUser:oe=>Yd(oe,"participant"),onRemoveUser:tl,onSendDirectMessage:na,raisedHands:Gd,onLowerHand:Ra,onClose:()=>ru(!1)})}),fn==="host"&&Yo&&Co.length>0&&R.jsxs("div",{className:"fixed top-20 right-4 z-50 bg-blue-600 text-white px-3 py-2 rounded-lg shadow-lg cursor-pointer flex items-center animate-pulse",onClick:()=>Lr(!0),children:[R.jsx(qE,{size:18,className:"mr-2"}),R.jsxs("span",{className:"font-medium",children:[Co.length," waiting"]})]}),wi&&R.jsx(g2e,{isOpen:wi,onSubmit:Io,onClose:nl})]})},y2e=()=>{const[t,e]=X.useState(!1),[n,r]=X.useState(null),i=o=>{e(!0),r(o)},s=()=>{e(!1),r(null)};return R.jsx(Bie,{children:R.jsxs(aie,{children:[R.jsx(kp,{path:"/",element:R.jsx(QW,{user:n,onLogout:s})}),R.jsx(kp,{path:"/signin",element:t?R.jsx(Vw,{to:"/dashboard"}):R.jsx(hge,{onSignIn:i})}),R.jsx(kp,{path:"/dashboard",element:t?R.jsx(Bge,{user:n,onLogout:s}):R.jsx(Vw,{to:"/signin"})}),R.jsx(kp,{path:"/video-call",element:t?R.jsx(v2e,{user:n,onCallEnd:()=>{}}):R.jsx(Vw,{to:"/signin"})}),R.jsx(kp,{path:"/mainpage",element:t?R.jsx(QW,{user:n,onLogout:s}):R.jsx(Vw,{to:"/signin"})})]})})};gre.createRoot(document.getElementById("root")).render(R.jsx(X.StrictMode,{children:R.jsx(y2e,{})}));
